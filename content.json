{"meta":{"title":"tutulp's blog","subtitle":"","description":"tutulpçš„åšå®¢ç½‘ç«™","author":"tutulp","url":"http://example.com","root":"/"},"pages":[{"title":"æ‰€æœ‰åˆ†ç±»","date":"2025-03-03T14:24:26.345Z","updated":"2025-03-03T14:24:26.345Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"","date":"2025-03-04T06:48:14.039Z","updated":"2025-03-04T06:48:14.039Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"tutulp ä»æ­¤å¤©è¾¹å°½æ²‰äº‘ï¼Œ é£å·æ®‹é˜³æ²¡æ—§ç—• é‚®ç®±ï¼šn199m992@163.comQQï¼š2061867903githubï¼šhttps://github.com/tutuLPgiteeï¼šhttps://gitee.com/tutuLP"},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2025-03-03T14:24:13.215Z","updated":"2025-03-03T14:24:13.215Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"go-zero","slug":"source/åç«¯/go-zero","date":"2025-08-25T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/26/source/åç«¯/go-zero/","permalink":"http://example.com/2025/08/26/source/%E5%90%8E%E7%AB%AF/go-zero/","excerpt":"","text":"go-zeroæ–‡æ¡£ï¼šhttps://go-zero.dev/docs/tutorials ç¯å¢ƒå®‰è£…1234567891011121314151617181920212223242526272829303132333435363738394041# å®‰è£…å™¨å®‰è£…https://go.dev/dl/go versiongo env -w GOPROXY=https://goproxy.cn,directgo env GOPROXY## linuxç¯å¢ƒå˜é‡~/.bash_profileæœ«å°¾æ·»åŠ export PATH=$PATH:/usr/local/go/bin source ~/.bash_profile# å®‰è£…go-zero è„šæ‰‹æ¶ goctlgo install github.com/zeromicro/go-zero/tools/goctl@latestgoctl --version## linuxç¯å¢ƒå˜é‡echo &#x27;export PATH=$PATH:$(go env GOPATH)/bin&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc## mac ç¯å¢ƒå˜é‡echo &#x27;export PATH=$PATH:$(go env GOPATH)/bin&#x27; &gt;&gt; ~/.zshrcsource ~/.zshrc# ä»£ç ç”Ÿæˆå·¥å…· protocgoctl env check --install --verbose --force # éœ€é­”æ³•goctl env check --verbose# å®‰è£…go-zeromkdir &lt;project name&gt; &amp;&amp; cd &lt;project name&gt; # project name ä¸ºå…·ä½“å€¼go mod init &lt;module name&gt; # module name ä¸ºå…·ä½“å€¼go get -u github.com/zeromicro/go-zero@latest# å®‰è£…etcdhttps://github.com/etcd-io/etcd/releasessudo mv etcd etcdctl /usr/local/bin/## ä¸´æ—¶å¯åŠ¨ï¼ˆå…³é—­ç»ˆç«¯ååœæ­¢ï¼‰etcd## ç¼–è¾‘é…ç½®æ–‡ä»¶ ~/.zshrcexport ETCDCTL_API=3export ETCDCTL_ENDPOINTS=http://localhost:2379source ~/.zshrc# vscode æ’ä»¶ï¼šgoctl æ–°å»ºé¡¹ç›®12345678910go mod init spark mkdir api &amp; cd apigoctl api go -api &lt;spark.api&gt; -dir .# etcdgoctl rpc protoc user.proto --go_out=. --go-grpc_out=. --zrpc_out=.# rungo mod tidygo run shorturl.go -f etc/shorturl-api.yaml apiæ–‡ä»¶demo12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152syntax = &quot;v1&quot;type ( LoginReq &#123; phone string `json:&quot;phone&quot;` password string `json:&quot;password&quot;` &#125; LoginResp &#123; access_token string `json:&quot;access_token&quot;` refresh_token string `json:&quot;refresh_token&quot;` &#125; GetUserInfoResp &#123; public_id string `json:&quot;public_id&quot;` username string `json:&quot;username&quot;` avatar_url string `json:&quot;avatar_url&quot;` gender int `json:&quot;gender&quot;` birthday string `json:&quot;birthday&quot;` country string `json:&quot;country&quot;` last_login_ip string `json:&quot;last_login_ip&quot;` status string `json:&quot;status&quot;` ext_json string `json:&quot;ext_json&quot;` &#125;)// type (// Test &#123;// username string `json:&quot;username&quot;`// password string `json:&quot;password&quot;`// &#125;// )@server ( prefix: /api group: user)service main &#123; @doc &quot;ç™»å½•&quot; @handler login post /user (LoginReq) returns (LoginResp) @doc &quot;è·å–ç”¨æˆ·ä¿¡æ¯&quot; @handler getUserInfo get /user returns (GetUserInfoResp)&#125;// @server (// prefix: /api// group: test// )// service main &#123;// @handler test// get /test returns (Test)// &#125; rpc demo12345678910111213141516171819202122232425262728293031323334353637383940414243444546syntax = &quot;proto3&quot;;package user;option go_package = &quot;./user&quot;;message loginReq &#123; string phone = 1; string password = 2;&#125;message loginResp &#123; string access_token = 1; string refresh_token = 2;&#125;message getUserInfoReq &#123; string access_token = 1;&#125;message getUserInfoResp &#123; string public_id = 1; string username = 2; string avatar_url = 3; int32 gender = 4; string birthday = 5; string country = 6; string last_login_ip = 7; int32 status = 8; string ext_json = 9;&#125;message refreshRep &#123; string refresh_token = 1;&#125;message refreshResp &#123; string access_token = 1; string refresh_token = 2;&#125;service user &#123; rpc login(loginReq) returns(loginResp); rpc getUserInfo(getUserInfoReq) returns(getUserInfoResp); rpc refreshToken(refreshRep) returns(refreshResp);&#125; mysqlgoctl model mysql ddl â€“src usersql.sql â€“dir . 1234567891011121314151617181920212223CREATE TABLE user ( user_id BIGINT NOT NULL COMMENT &#x27;ç”¨æˆ·å”¯ä¸€IDï¼Œé›ªèŠ±ç®—æ³•&#x27;, public_id VARCHAR(64) UNIQUE COMMENT &#x27;å¤–éƒ¨å¯è§id&#x27;, username VARCHAR(64) UNIQUE COMMENT &#x27;ç”¨æˆ·åï¼Œå”¯ä¸€&#x27;, email VARCHAR(128) UNIQUE COMMENT &#x27;é‚®ç®±åœ°å€&#x27;, phone VARCHAR(32) UNIQUE COMMENT &#x27;æ‰‹æœºå·ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰&#x27;, password_hash VARCHAR(128) NOT NULL COMMENT &#x27;å¯†ç å“ˆå¸Œ&#x27;, avatar_url VARCHAR(256) COMMENT &#x27;å¤´åƒURL&#x27;, gender TINYINT COMMENT &#x27;æ€§åˆ«ï¼š0-æœªçŸ¥ 1-ç”· 2-å¥³&#x27;, birthday DATE COMMENT &#x27;å‡ºç”Ÿæ—¥æœŸ&#x27;, country VARCHAR(64) COMMENT &#x27;å›½å®¶/åœ°åŒº&#x27;, register_ip VARCHAR(45) COMMENT &#x27;æ³¨å†ŒIP&#x27;, register_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;æ³¨å†Œæ—¶é—´&#x27;, last_login_time DATETIME COMMENT &#x27;ä¸Šæ¬¡ç™»å½•æ—¶é—´&#x27;, last_login_ip VARCHAR(45) COMMENT &#x27;ä¸Šæ¬¡ç™»å½•IP&#x27;, status TINYINT NOT NULL DEFAULT 1 COMMENT &#x27;è´¦å·çŠ¶æ€ï¼š0-ç¦ç”¨ 1-å¯ç”¨ 2-æ³¨é”€&#x27;, ext_json JSON COMMENT &#x27;æ‰©å±•ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·æ ‡ç­¾ã€åå¥½ç­‰ï¼‰&#x27;, PRIMARY KEY (`user_id`), INDEX idx_email (email), INDEX idx_phone (phone), INDEX idx_status (status), INDEX idx_last_login_time (last_login_time)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT = &#x27;ç”¨æˆ·ä¿¡æ¯è¡¨&#x27;;","categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"}],"tags":[{"name":"go-zero","slug":"go-zero","permalink":"http://example.com/tags/go-zero/"}]},{"title":"æœåŠ¡å™¨+SSH","slug":"source/å·¥å…·-ç¯å¢ƒ/è¿œç¨‹","date":"2025-08-19T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/20/source/å·¥å…·-ç¯å¢ƒ/è¿œç¨‹/","permalink":"http://example.com/2025/08/20/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/%E8%BF%9C%E7%A8%8B/","excerpt":"","text":"é…ç½®sshå¯†é’¥ æ¨èä½¿ç”¨ED25519 ç®—æ³•ï¼Œä¸æ¨è RSA ç®—æ³• æŸ¥çœ‹å·²å­˜åœ¨å¯†é’¥ 12cat ~/.ssh/id_ed25519.pubcat ~/.ssh/id_rsa.pub ç”Ÿæˆå¯†é’¥ 12ssh-keygen -t ed25519 -C &quot;&lt;æ³¨é‡Šå†…å®¹&gt;&quot;ssh-keygen -t rsa -C &quot;&lt;æ³¨é‡Šå†…å®¹&gt;&quot; ä½¿ç”¨ è¿œç¨‹ä»“åº“é…ç½®å…¬é’¥ è¿œç¨‹è¿æ¥æœåŠ¡å™¨ 123456789101112# ~/.ssh/configHost any_name HostName &lt;æœåŠ¡å™¨åœ°å€&gt; User &lt;ç”¨æˆ·å&gt; # ï½/.ssh/authorized_keyså°†å…¬é’¥å¡«åœ¨æ­¤å¤„cat ~/.ssh/id_rsa.pub | ssh user@remote_host &#x27;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys&#x27;# testssh any_name äº‘æœåŠ¡å™¨é˜¿é‡Œäº‘å®‰å…¨ä¸­å¿ƒï¼šhttps://home.console.aliyun.com/home/dashboard/securitycenter é˜¿é‡Œäº‘æœåŠ¡å™¨å‘Šè­¦å¤„ç†ï¼š https://yundun.console.aliyun.com/?p=sas#/overview/home/cn-hangzhou","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"è¿œç¨‹","slug":"è¿œç¨‹","permalink":"http://example.com/tags/%E8%BF%9C%E7%A8%8B/"}]},{"title":"DAWéŸ³ä¹ç¼–è¾‘","slug":"source/å·¥å…·-ç¯å¢ƒ/DAW","date":"2025-08-18T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/19/source/å·¥å…·-ç¯å¢ƒ/DAW/","permalink":"http://example.com/2025/08/19/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/DAW/","excerpt":"","text":"DAWé€‰æ‹© cakewalk GarageBand MAC Logic Pro MAC FL Studio https://www.image-line.com/ ä»˜è´¹ reaper ä»˜è´¹ luna cakewalkhttps://www.cakewalk.com/ lunahttps://www.uaudio.com/ https://www.uaudio.com/products/luna","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"DAW","slug":"DAW","permalink":"http://example.com/tags/DAW/"}]},{"title":"mysql","slug":"source/å·¥å…·-ç¯å¢ƒ/mysql","date":"2025-08-04T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/05/source/å·¥å…·-ç¯å¢ƒ/mysql/","permalink":"http://example.com/2025/08/05/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/mysql/","excerpt":"","text":"docker&#x2F;podmanä¸­æ‰¾å›å¯†ç podman inspect mysql ä½¿ç”¨é…ç½®ä¸­çš„å¯†ç ç›´æ¥ç™»å½• æŸ¥çœ‹å…¶ä¸­MYSQL_ROOT_PASSWORD&#x3D;yourpassword å¦‚æœ1çš„æ–¹æ³•ä¸è¡Œï¼ŒæŸ¥çœ‹æŒ‚è½½å·ï¼Œä½¿ç”¨è¿è¡Œå®¹å™¨çš„æ–¹æ³• å­—æ®µHostConfig-Bindsä¸­æŸ¥çœ‹æŒ‚è½½å· c8ab1db06cc555dd1085e8f461da0e7c728ebb04a485e124a5aa840d6338ee9c:&#x2F;var&#x2F;lib&#x2F;mysql è·³è¿‡æƒé™éªŒè¯12345678910111213141516171819podman stop mysql#è·³è¿‡æƒé™éªŒè¯podman run -d --name mysql-recovery \\ -e MYSQL_ALLOW_EMPTY_PASSWORD=yes \\ -v c8ab1db06cc555dd1085e8f461da0e7c728ebb04a485e124a5aa840d6338ee9c:/var/lib/mysql \\ -p 3306:3306 \\ mysql:latest \\ --skip-grant-tablespodman exec -it mysql-recovery mysqlFLUSH PRIVILEGES;ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;newpassword&#x27;;podman stop mysql-recoverypodman rm mysql-recoverypodman start mysql","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"http://example.com/tags/mysql/"}]},{"title":"docker","slug":"source/å·¥å…·-ç¯å¢ƒ/Docker","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/04/source/å·¥å…·-ç¯å¢ƒ/Docker/","permalink":"http://example.com/2025/08/04/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/Docker/","excerpt":"","text":"Installcentos å¸è½½æ—§ç‰ˆ 12345678yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine é…ç½®Dockerçš„yumåº“ 123yum install -y yum-utils# é…ç½®Dockerçš„yumæºyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo å®‰è£…Docker 12345678yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugindocker -v systemctl start docker# è®¾ç½®å¼€æœºè‡ªå¯systemctl enable docker MacOSmacosï¼šhttps://juejin.cn/post/7530868895767920675 é•œåƒåŠ é€Ÿ é•œåƒåœ°å€ï¼šhttps://www.wxy97.com/archives/b5b225b6-7741-4560-be2f-2e6a4f671d9b é•œåƒåœ°å€ 2ï¼šhttps://1ms.run é˜¿é‡Œé•œåƒ(æ²¡ç”¨è¿‡ï¼Œä¼°è®¡ä¸è¡Œ)ï¼šhttps://cr.console.aliyun.com/cn-hangzhou/instances/mirrors centos12345678910111213# åˆ›å»ºç›®å½•mkdir -p /etc/docker# å¤åˆ¶å†…å®¹ï¼Œæ³¨æ„æŠŠå…¶ä¸­çš„é•œåƒåŠ é€Ÿåœ°å€æ”¹æˆä½ è‡ªå·±çš„tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123; &quot;registry-mirrors&quot;: [&quot;https://1l76bl56.mirror.aliyuncs.com&quot;]&#125;EOF# é‡æ–°åŠ è½½é…ç½®systemctl daemon-reload# é‡å¯Dockersystemctl restart docker éƒ¨ç½²mysql123456docker run -d \\ --name mysql \\ -p 3306:3306 \\ -e TZ=Asia/Shanghai \\ -e MYSQL_ROOT_PASSWORD=123 \\ mysql ä¸‹è½½çš„æ˜¯å®‰è£…å¥½çš„mysql-&#x3D;&#x3D;é•œåƒ&#x3D;&#x3D;(åŒ…å«åº”ç”¨-ç¯å¢ƒ-é…ç½®-å‡½æ•°åº“) dockeråœ¨è¿è¡Œé•œåƒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒ-å®¹å™¨ å¯ä»¥æ¢ä¸ªåå­—æ¢ä¸ªç«¯å£3307:3306å†æ¬¡è¿è¡Œä¸€ä¸ªé•œåƒ docker psæŸ¥çœ‹è¿è¡Œçš„é•œåƒ é•œåƒä»“åº“:å…¨çƒDocker Hub åä¸º è…¾è®¯ ali å…¬å¸ç§æœ å‘½ä»¤è§£è¯» docker run -d ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ-d å®¹å™¨åå°è¿è¡Œ â€“name mysql : å®¹å™¨åå­— -p 3306:3306 : è®¾ç½®ç«¯å£æ˜ å°„ã€‚ å‰é¢æ˜¯å®¿ä¸»ç«¯å£ åé¢æ˜¯å®¹å™¨ç«¯å£ å®¹å™¨å†…ç«¯å£å¾€å¾€æ˜¯ç”±å®¹å™¨å†…çš„è¿›ç¨‹å†³å®šï¼Œä¾‹å¦‚MySQLè¿›ç¨‹é»˜è®¤ç«¯å£æ˜¯3306ï¼Œå› æ­¤å®¹å™¨å†…ç«¯å£ä¸€å®šæ˜¯3306ï¼›è€Œå®¿ä¸»æœºç«¯å£åˆ™å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¸€èˆ¬ä¸å®¹å™¨å†…ä¿æŒä¸€è‡´ã€‚ -e TZ&#x3D;Asia&#x2F;Shanghai : é…ç½®å®¹å™¨å†…è¿›ç¨‹è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°-ç¯å¢ƒå˜é‡ æ ¼å¼ï¼š-e KEY&#x3D;VALUEï¼ŒKEYå’ŒVALUEéƒ½ç”±å®¹å™¨å†…è¿›ç¨‹å†³å®š docker hubä¸ŠæŸ¥ æ¡ˆä¾‹ä¸­ï¼ŒTZ&#x3D;Asia&#x2F;Shanghaiæ˜¯è®¾ç½®æ—¶åŒºï¼›MYSQL_ROOT_PASSWORD&#x3D;123æ˜¯è®¾ç½®MySQLé»˜è®¤å¯†ç  mysql: è®¾ç½®é•œåƒåç§°ï¼ŒDockerä¼šæ ¹æ®è¿™ä¸ªåå­—æœç´¢å¹¶ä¸‹è½½é•œåƒ æ ¼å¼ï¼šREPOSITORY:TAGï¼Œä¾‹å¦‚mysql:8.0ï¼Œå…¶ä¸­REPOSITORYä¸ºé•œåƒåï¼ŒTAGæ˜¯ç‰ˆæœ¬å· åœ¨æœªæŒ‡å®šTAGçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯mysql:latest DockeråŸºç¡€Dockerå®˜æ–¹æ–‡æ¡£ï¼š https://docs.docker.com/ å¸¸è§å‘½ä»¤https://docs.docker.com/engine/reference/commandline/cli/ å‘½ä»¤ä»‹ç»å…¶ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„å‘½ä»¤æœ‰ï¼š å‘½ä»¤ è¯´æ˜ æ–‡æ¡£åœ°å€ docker pull æ‹‰å–é•œåƒ docker pull docker push æ¨é€é•œåƒåˆ°DockerRegistry docker push docker images æŸ¥çœ‹æœ¬åœ°é•œåƒ docker images docker rmi åˆ é™¤æœ¬åœ°é•œåƒ docker rmi docker run åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆä¸èƒ½é‡å¤åˆ›å»ºï¼‰ docker run docker stop åœæ­¢æŒ‡å®šå®¹å™¨ docker stop docker start å¯åŠ¨æŒ‡å®šå®¹å™¨ docker start docker restart é‡æ–°å¯åŠ¨å®¹å™¨ docker restart docker rm åˆ é™¤æŒ‡å®šå®¹å™¨ docs.docker.com docker ps æŸ¥çœ‹å®¹å™¨ docker ps docker logs æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿— docker logs docker exec è¿›å…¥å®¹å™¨ docker exec docker save ä¿å­˜é•œåƒåˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶ docker save docker load åŠ è½½æœ¬åœ°å‹ç¼©æ–‡ä»¶åˆ°é•œåƒ docker load docker inspect æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect 1234# Dockerå¼€æœºè‡ªå¯systemctl enable docker# Dockerå®¹å™¨å¼€æœºè‡ªå¯docker update --restart=always [å®¹å™¨å/å®¹å™¨id] æ¼”ç¤ºNginxdocker save -o nginx.tar nginx:lastestå°±ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿå­˜ä¸€ä¸ªnginx.tarçš„æ–‡ä»¶ï¼Œå¯ä»¥æ‹·è´åˆ°åˆ«çš„æœºå™¨ä¸Šä½¿ç”¨ docker rmi nginx:lastest åˆ é™¤é•œåƒ docker load -i naginx.tar ä½¿ç”¨åˆšæ‰æ‰“åŒ…çš„æ–‡ä»¶ docker logs -f nginxæŒç»­æŸ¥çœ‹æ—¥å¿—-ç”¨äºè°ƒè¯• é•œåƒå‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨åˆ«äººå‡†å¤‡å¥½çš„é•œåƒï¼Œé‚£å¦‚æœæˆ‘è¦éƒ¨ç½²ä¸€ä¸ªé¡¹ç›®ï¼ŒæŠŠå®ƒæ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ é•œåƒç»“æ„é•œåƒä¸­åŒ…å«äº†ç¨‹åºè¿è¡Œéœ€è¦çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ã€ä¾èµ–ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦ä»0éƒ¨ç½²ä¸€ä¸ªJavaåº”ç”¨ï¼Œå¤§æ¦‚æµç¨‹æ˜¯è¿™æ ·ï¼š å‡†å¤‡ä¸€ä¸ªlinuxæœåŠ¡ï¼ˆCentOSæˆ–è€…Ubuntuå‡å¯ï¼‰ å®‰è£…å¹¶é…ç½®JDK ä¸Šä¼ JaråŒ… è¿è¡ŒjaråŒ… é‚£å› æ­¤ï¼Œæˆ‘ä»¬æ‰“åŒ…é•œåƒä¹Ÿæ˜¯åˆ†æˆè¿™ä¹ˆå‡ æ­¥ï¼š å‡†å¤‡Linuxè¿è¡Œç¯å¢ƒï¼ˆjavaé¡¹ç›®å¹¶ä¸éœ€è¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä»…ä»…æ˜¯åŸºç¡€è¿è¡Œç¯å¢ƒå³å¯ï¼‰ å®‰è£…å¹¶é…ç½®JDK æ‹·è´jaråŒ… é…ç½®å¯åŠ¨è„šæœ¬ ä¸Šè¿°æ­¥éª¤ä¸­çš„æ¯ä¸€æ¬¡æ“ä½œå…¶å®éƒ½æ˜¯åœ¨ç”Ÿäº§ä¸€äº›æ–‡ä»¶ï¼ˆç³»ç»Ÿè¿è¡Œç¯å¢ƒã€å‡½æ•°åº“ã€é…ç½®æœ€ç»ˆéƒ½æ˜¯ç£ç›˜æ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥é•œåƒå°±æ˜¯ä¸€å †æ–‡ä»¶çš„é›†åˆã€‚ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé•œåƒæ–‡ä»¶ä¸æ˜¯éšæ„å †æ”¾çš„ï¼Œè€Œæ˜¯æŒ‰ç…§æ“ä½œçš„æ­¥éª¤åˆ†å±‚å åŠ è€Œæˆï¼Œæ¯ä¸€å±‚å½¢æˆçš„æ–‡ä»¶éƒ½ä¼šå•ç‹¬æ‰“åŒ…å¹¶æ ‡è®°ä¸€ä¸ªå”¯ä¸€idï¼Œç§°ä¸ºLayerï¼ˆå±‚ï¼‰ã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬æ„å»ºæ—¶ç”¨åˆ°çš„æŸäº›å±‚å…¶ä»–äººå·²ç»åˆ¶ä½œè¿‡ï¼Œå°±å¯ä»¥ç›´æ¥æ‹·è´ä½¿ç”¨è¿™äº›å±‚ï¼Œè€Œä¸ç”¨é‡å¤åˆ¶ä½œã€‚ ä¾‹å¦‚ï¼Œç¬¬ä¸€æ­¥ä¸­éœ€è¦çš„Linuxè¿è¡Œç¯å¢ƒï¼Œé€šç”¨æ€§å°±å¾ˆå¼ºï¼Œæ‰€ä»¥Dockerå®˜æ–¹å°±åˆ¶ä½œäº†è¿™æ ·çš„åªåŒ…å«Linuxè¿è¡Œç¯å¢ƒçš„é•œåƒã€‚æˆ‘ä»¬åœ¨åˆ¶ä½œjavaé•œåƒæ—¶ï¼Œå°±æ— éœ€é‡å¤åˆ¶ä½œï¼Œç›´æ¥ä½¿ç”¨Dockerå®˜æ–¹æä¾›çš„CentOSæˆ–Ubuntué•œåƒä½œä¸ºåŸºç¡€é•œåƒã€‚ç„¶åå†æ­å»ºå…¶å®ƒå±‚å³å¯ï¼Œè¿™æ ·é€å±‚æ­å»º Dockerfileç”±äºåˆ¶ä½œé•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é€å±‚å¤„ç†å’Œæ‰“åŒ…ï¼ŒDockerå°±æä¾›äº†è‡ªåŠ¨æ‰“åŒ…é•œåƒçš„åŠŸèƒ½ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ‰“åŒ…çš„è¿‡ç¨‹ï¼Œæ¯ä¸€å±‚è¦åšçš„äº‹æƒ…ç”¨å›ºå®šçš„è¯­æ³•å†™ä¸‹æ¥ï¼Œäº¤ç»™Dockerå»æ‰§è¡Œå³å¯ã€‚ è€Œè¿™ç§è®°å½•é•œåƒç»“æ„çš„æ–‡ä»¶å°±ç§°ä¸ºDockerfileï¼Œå…¶å¯¹åº”çš„è¯­æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.docker.com/engine/reference/builder/ å…¶ä¸­çš„è¯­æ³•æ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼š æŒ‡ä»¤ è¯´æ˜ ç¤ºä¾‹ FROM æŒ‡å®šåŸºç¡€é•œåƒ FROM centos:6 ENV è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯åœ¨åé¢æŒ‡ä»¤ä½¿ç”¨ ENV key value COPY æ‹·è´æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½• COPY ./xx.jar /tmp/app.jar RUN æ‰§è¡ŒLinuxçš„shellå‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯å®‰è£…è¿‡ç¨‹çš„å‘½ä»¤ RUN yum install gcc EXPOSE æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£ï¼Œæ˜¯ç»™é•œåƒä½¿ç”¨è€…çœ‹çš„(å‘Šè¯‰ä½¿ç”¨è€…ç”¨è¿™ä¸ªç«¯å£åšæ˜ å°„) EXPOSE 8080 ENTRYPOINT é•œåƒä¸­åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ï¼Œå®¹å™¨è¿è¡Œæ—¶è°ƒç”¨ ENTRYPOINT java -jar xx.jar ä¾‹å¦‚ï¼Œè¦åŸºäºUbuntué•œåƒæ¥æ„å»ºä¸€ä¸ªJavaåº”ç”¨ï¼Œå…¶Dockerfileå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021# æŒ‡å®šåŸºç¡€é•œåƒFROM ubuntu:16.04# é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•ã€å®¹å™¨å†…æ—¶åŒºENV JAVA_DIR=/usr/localENV TZ=Asia/Shanghai# æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…COPY ./jdk8.tar.gz $JAVA_DIR/COPY ./docker-demo.jar /tmp/app.jar# è®¾å®šæ—¶åŒºRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone# å®‰è£…JDKRUN cd $JAVA_DIR \\ &amp;&amp; tar -xf ./jdk8.tar.gz \\ &amp;&amp; mv ./jdk1.8.0_144 ./java8# é…ç½®ç¯å¢ƒå˜é‡ENV JAVA_HOME=$JAVA_DIR/java8ENV PATH=$PATH:$JAVA_HOME/bin# æŒ‡å®šé¡¹ç›®ç›‘å¬çš„ç«¯å£EXPOSE 8080# å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;] åŒå­¦ä»¬æ€è€ƒä¸€ä¸‹ï¼šä»¥åæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šå¾ˆå¤šjavaé¡¹ç›®éœ€è¦æ‰“åŒ…ä¸ºé•œåƒï¼Œä»–ä»¬éƒ½éœ€è¦Linuxç³»ç»Ÿç¯å¢ƒã€JDKç¯å¢ƒè¿™ä¸¤å±‚ï¼Œåªæœ‰ä¸Šé¢çš„3å±‚ä¸åŒï¼ˆå› ä¸ºjaråŒ…ä¸åŒï¼‰ã€‚å¦‚æœæ¯æ¬¡åˆ¶ä½œjavaé•œåƒéƒ½é‡å¤åˆ¶ä½œå‰ä¸¤å±‚é•œåƒï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ã€‚ æ‰€ä»¥ï¼Œå°±æœ‰äººæä¾›äº†åŸºç¡€çš„ç³»ç»ŸåŠ JDKç¯å¢ƒï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šåˆ¶ä½œjavaé•œåƒï¼Œå°±å¯ä»¥çœå»JDKçš„é…ç½®äº†ï¼š 123456789# åŸºç¡€é•œåƒ-éœ€è¦å…ˆä¸‹è½½FROM openjdk:11.0-jre-buster# è®¾å®šæ—¶åŒº(å¯æœ‰å¯æ— )ENV TZ=Asia/ShanghaiRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone# æ‹·è´jaråŒ…COPY docker-demo.jar /app.jar# å…¥å£ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;] æ„å»ºé•œåƒå½“Dockerfileæ–‡ä»¶å†™å¥½ä»¥åï¼Œå°±å¯ä»¥åˆ©ç”¨å‘½ä»¤æ¥æ„å»ºé•œåƒäº†ã€‚ åœ¨è¯¾å‰èµ„æ–™ä¸­ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€ä¸ªdemoé¡¹ç›®åŠå¯¹åº”çš„Dockerfileï¼š é¦–å…ˆï¼Œæˆ‘ä»¬å°†docker-demo.jaråŒ…ä»¥åŠDockerfileæ‹·è´åˆ°è™šæ‹Ÿæœºçš„/root/demoç›®å½•ï¼š 1234# è¿›å…¥é•œåƒç›®å½•cd /root/demo# å¼€å§‹æ„å»ºdocker build -t docker-demo:1.0 . å‘½ä»¤è¯´æ˜ï¼š docker build : å°±æ˜¯æ„å»ºä¸€ä¸ªdockeré•œåƒ -t docker-demo:1.0 ï¼š-tå‚æ•°æ˜¯æŒ‡å®šé•œåƒçš„åç§°ï¼ˆrepositoryå’Œtagï¼‰ . : æœ€åçš„ç‚¹æ˜¯æŒ‡æ„å»ºæ—¶Dockerfileæ‰€åœ¨è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬è¿›å…¥äº†demoç›®å½•ï¼Œæ‰€ä»¥æŒ‡å®šçš„æ˜¯.ä»£è¡¨å½“å‰ç›®å½•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šDockerfileç›®å½•ï¼š # ç›´æ¥æŒ‡å®šDockerfileç›®å½• docker build -t docker-demo:1.0 /root/demo 1234567891011æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š```Bash# æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼šdocker images# ç»“æœREPOSITORY TAG IMAGE ID CREATED SIZEdocker-demo 1.0 d6ab0b9e64b9 27 minutes ago 327MBnginx latest 605c77e624dd 16 months ago 141MBmysql latest 3218b38490ce 17 months ago 516MB ç„¶åå°è¯•è¿è¡Œè¯¥é•œåƒï¼š 12345678910111213# 1.åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨docker run -d --name dd -p 8090:8090 docker-demo:1.0# 2.æŸ¥çœ‹å®¹å™¨dps# ç»“æœCONTAINER ID IMAGE PORTS STATUS NAMES78a000447b49 docker-demo:1.0 0.0.0.0:8080-&gt;8080/tcp, :::8090-&gt;8090/tcp Up 2 seconds ddf63cfead8502 mysql 0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp Up 2 hours mysql# 3.è®¿é—®curl localhost:8080/hello/count# ç»“æœï¼š&lt;h5&gt;æ¬¢è¿è®¿é—®é»‘é©¬å•†åŸ, è¿™æ˜¯æ‚¨ç¬¬1æ¬¡è®¿é—®&lt;h5&gt; ç½‘ç»œé¡¹ç›®å¾€å¾€éœ€è¦è®¿é—®å…¶å®ƒå„ç§ä¸­é—´ä»¶ï¼Œä¾‹å¦‚MySQLã€Redisç­‰ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„å®¹å™¨ä¹‹é—´èƒ½å¦äº’ç›¸è®¿é—®å‘¢ï¼Ÿ 123456# 1.ç”¨åŸºæœ¬å‘½ä»¤ï¼Œå¯»æ‰¾Networks.bridge.IPAddresså±æ€§docker inspect mysql# ä¹Ÿå¯ä»¥ä½¿ç”¨formatè¿‡æ»¤ç»“æœdocker inspect --format=&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;println .IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; mysql# å¾—åˆ°IPåœ°å€å¦‚ä¸‹ï¼š172.17.0.2 åœ¨åŒä¸€ä¸ªç½‘æ®µä¸­ ä½†æ˜¯ï¼Œå®¹å™¨çš„ç½‘ç»œIPå…¶å®æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„IPï¼Œå…¶å€¼å¹¶ä¸å›ºå®šä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®šï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¼€å‘æ—¶å†™æ­»æŸä¸ªIPï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½MySQLå®¹å™¨çš„IPä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿æ¥ä¼šå¤±è´¥ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»å€ŸåŠ©äºdockerçš„ç½‘ç»œåŠŸèƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š https://docs.docker.com/engine/reference/commandline/network/ å¸¸è§å‘½ä»¤æœ‰ï¼š å‘½ä»¤ è¯´æ˜ æ–‡æ¡£åœ°å€ docker network create åˆ›å»ºä¸€ä¸ªç½‘ç»œ docker network create docker network ls æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ docs.docker.com docker network rm åˆ é™¤æŒ‡å®šç½‘ç»œ docs.docker.com docker network prune æ¸…é™¤æœªä½¿ç”¨çš„ç½‘ç»œ docs.docker.com docker network connect ä½¿æŒ‡å®šå®¹å™¨è¿æ¥åŠ å…¥æŸç½‘ç»œ docs.docker.com docker network disconnect ä½¿æŒ‡å®šå®¹å™¨è¿æ¥ç¦»å¼€æŸç½‘ç»œ docker network disconnect docker network inspect æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯ docker network inspect åˆ›å»ºå¥½dockeråä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªdocker 0çš„è™šæ‹Ÿçš„ç½‘å¡172.17.0.1&#x2F;16 é»˜è®¤å®¹å™¨æ˜¯ä»¥ç½‘æ¡¥è¿æ¥åˆ°è™šæ‹Ÿç½‘ç»œä¸­.å®¹å™¨å¯ä»¥äº’è¿å¹¶ä¸”å¯ä»¥é€šè¿‡å®¹å™¨åäº’è” 123456789101112131415161718192021222324252627282930313233# 1.é¦–å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªç½‘ç»œdocker network create hmall# 2.ç„¶åæŸ¥çœ‹ç½‘ç»œdocker network ls# ç»“æœï¼šNETWORK ID NAME DRIVER SCOPE639bc44d0a87 bridge bridge local403f16ec62a2 hmall bridge local0dc0f72a0fbb host host localcd8d3e8df47b none null local# å…¶ä¸­ï¼Œé™¤äº†hmallä»¥å¤–ï¼Œå…¶å®ƒéƒ½æ˜¯é»˜è®¤çš„ç½‘ç»œ# 3.è®©ddå’Œmysqléƒ½åŠ å…¥è¯¥ç½‘ç»œï¼Œæ³¨æ„ï¼Œåœ¨åŠ å…¥ç½‘ç»œæ—¶å¯ä»¥é€šè¿‡--aliasç»™å®¹å™¨èµ·åˆ«å# 3.1.mysqlå®¹å™¨ï¼ŒæŒ‡å®šåˆ«åä¸ºdbï¼Œå¦å¤–æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªåˆ«åæ˜¯å®¹å™¨ådocker network connect hmall mysql --alias db# 3.2.dbå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaé¡¹ç›®docker network connect hmall dd# 4.è¿›å…¥ddå®¹å™¨ï¼Œå°è¯•åˆ©ç”¨åˆ«åè®¿é—®db# 4.1.è¿›å…¥å®¹å™¨docker exec -it dd bash# 4.2.ç”¨dbåˆ«åè®¿é—®ping db# ç»“æœPING db (172.18.0.2) 56(84) bytes of data.64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.070 ms64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.056 ms# 4.3.ç”¨å®¹å™¨åè®¿é—®ping mysql# ç»“æœï¼šPING mysql (172.18.0.2) 56(84) bytes of data.64 bytes from mysql.hmall (172.18.0.2): icmp_seq=1 ttl=64 time=0.044 ms64 bytes from mysql.hmall (172.18.0.2): icmp_seq=2 ttl=64 time=0.054 ms æ€»ç»“ï¼š åœ¨è‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå¯ä»¥ç»™å®¹å™¨èµ·å¤šä¸ªåˆ«åï¼Œé»˜è®¤çš„åˆ«åæ˜¯å®¹å™¨åæœ¬èº« åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡åˆ«åäº’ç›¸è®¿é—® ip addr å¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºçš„ç½‘å¡é»˜è®¤åªæœ‰l0 ens(è™šæ‹ŸæœºçœŸå®ip) docker0 å¤šä¸€ä¸ªæˆ‘ä»¬è®¾ç½®çš„æ–°çš„ç½‘æ¡¥ DockerComposeå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªç®€å•çš„javaé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«3ä¸ªå®¹å™¨ï¼š MySQL Nginx Javaé¡¹ç›® è€Œç¨å¾®å¤æ‚çš„é¡¹ç›®ï¼Œå…¶ä¸­è¿˜ä¼šæœ‰å„ç§å„æ ·çš„å…¶å®ƒä¸­é—´ä»¶ï¼Œéœ€è¦éƒ¨ç½²çš„ä¸œè¥¿è¿œä¸æ­¢3ä¸ªã€‚å¦‚æœè¿˜åƒä¹‹å‰é‚£æ ·æ‰‹åŠ¨çš„é€ä¸€éƒ¨ç½²ï¼Œå°±å¤ªéº»çƒ¦äº†ã€‚ è€ŒDocker Composeå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å¤šä¸ªç›¸äº’å…³è”çš„Dockerå®¹å™¨çš„å¿«é€Ÿéƒ¨ç½²ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ã€‚ åŸºæœ¬è¯­æ³•docker-compose.ymlæ–‡ä»¶çš„åŸºæœ¬è¯­æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.docker.com/compose/compose-file/compose-file-v3/ docker-composeæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªç›¸äº’å…³è”çš„åº”ç”¨å®¹å™¨ï¼Œæ¯ä¸€ä¸ªåº”ç”¨å®¹å™¨è¢«ç§°ä¸ºä¸€ä¸ªæœåŠ¡ï¼ˆserviceï¼‰ã€‚ç”±äºserviceå°±æ˜¯åœ¨å®šä¹‰æŸä¸ªåº”ç”¨çš„è¿è¡Œæ—¶å‚æ•°ï¼Œå› æ­¤ä¸docker runå‚æ•°éå¸¸ç›¸ä¼¼ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨docker runéƒ¨ç½²MySQLçš„å‘½ä»¤å¦‚ä¸‹ï¼š 12345678910docker run -d \\ --name mysql \\ -p 3306:3306 \\ -e TZ=Asia/Shanghai \\ -e MYSQL_ROOT_PASSWORD=123 \\ -v ./mysql/data:/var/lib/mysql \\ -v ./mysql/conf:/etc/mysql/conf.d \\ -v ./mysql/init:/docker-entrypoint-initdb.d \\ --network hmall mysql å¦‚æœç”¨docker-compose.ymlæ–‡ä»¶æ¥å®šä¹‰ï¼Œå°±æ˜¯è¿™æ ·ï¼š 12345678910111213141516171819version: &quot;3.8&quot;services: mysql: image: mysql container_name: mysql ports: - &quot;3306:3306&quot; environment: TZ: Asia/Shanghai MYSQL_ROOT_PASSWORD: 123 volumes: - &quot;./mysql/conf:/etc/mysql/conf.d&quot; - &quot;./mysql/data:/var/lib/mysql&quot; networks: - newnetworks: new: name: hmall å¯¹æ¯”å¦‚ä¸‹ï¼š docker run å‚æ•° docker compose æŒ‡ä»¤ è¯´æ˜ â€“name container_name å®¹å™¨åç§° -p ports ç«¯å£æ˜ å°„ -e environment ç¯å¢ƒå˜é‡ -v volumes æ•°æ®å·é…ç½® â€“network networks ç½‘ç»œ æ˜ç™½äº†å…¶ä¸­çš„å¯¹åº”å…³ç³»ï¼Œç›¸ä¿¡ç¼–å†™docker-composeæ–‡ä»¶åº”è¯¥éš¾ä¸å€’å¤§å®¶ã€‚ é»‘é©¬å•†åŸéƒ¨ç½²æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344version: &quot;3.8&quot;services: mysql: image: mysql container_name: mysql ports: - &quot;3306:3306&quot; environment: TZ: Asia/Shanghai MYSQL_ROOT_PASSWORD: 123 volumes: - &quot;./mysql/conf:/etc/mysql/conf.d&quot; - &quot;./mysql/data:/var/lib/mysql&quot; - &quot;./mysql/init:/docker-entrypoint-initdb.d&quot; networks: - hm-net hmall: build: context: . dockerfile: Dockerfile container_name: hmall ports: - &quot;8080:8080&quot; networks: - hm-net depends_on: - mysql nginx: image: nginx container_name: nginx ports: - &quot;18080:18080&quot; - &quot;18081:18081&quot; volumes: - &quot;./nginx/nginx.conf:/etc/nginx/nginx.conf&quot; - &quot;./nginx/html:/usr/share/nginx/html&quot; depends_on: - hmall networks: - hm-netnetworks: hm-net: name: hmall åŸºç¡€å‘½ä»¤ç¼–å†™å¥½docker-compose.ymlæ–‡ä»¶ï¼Œå°±å¯ä»¥éƒ¨ç½²é¡¹ç›®äº†ã€‚å¸¸è§çš„å‘½ä»¤ï¼š https://docs.docker.com/compose/reference/ åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š 1docker compose [OPTIONS] [COMMAND] å…¶ä¸­ï¼ŒOPTIONSå’ŒCOMMANDéƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ï¼š ç±»å‹ å‚æ•°æˆ–æŒ‡ä»¤ è¯´æ˜ Options -f æŒ‡å®šcomposeæ–‡ä»¶çš„è·¯å¾„å’Œåç§° -p æŒ‡å®šprojectåç§°ã€‚projectå°±æ˜¯å½“å‰composeæ–‡ä»¶ä¸­è®¾ç½®çš„å¤šä¸ªserviceçš„é›†åˆï¼Œæ˜¯é€»è¾‘æ¦‚å¿µ Commands up åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰serviceå®¹å™¨ down åœæ­¢å¹¶ç§»é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œ ps åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„å®¹å™¨ logs æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿— stop åœæ­¢å®¹å™¨ start å¯åŠ¨å®¹å™¨ restart é‡å¯å®¹å™¨ top æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹ exec åœ¨æŒ‡å®šçš„è¿è¡Œä¸­å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ æ•™å­¦æ¼”ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# 1.è¿›å…¥rootç›®å½•cd /root# 2.åˆ é™¤æ—§å®¹å™¨docker rm -f $(docker ps -qa)# 3.åˆ é™¤hmallé•œåƒdocker rmi hmall# 4.æ¸…ç©ºMySQLæ•°æ®rm -rf mysql/data# 5.å¯åŠ¨æ‰€æœ‰, -d å‚æ•°æ˜¯åå°å¯åŠ¨docker compose up -d# ç»“æœï¼š[+] Building 15.5s (8/8) FINISHED =&gt; [internal] load build definition from Dockerfile 0.0s =&gt; =&gt; transferring dockerfile: 358B 0.0s =&gt; [internal] load .dockerignore 0.0s =&gt; =&gt; transferring context: 2B 0.0s =&gt; [internal] load metadata for docker.io/library/openjdk:11.0-jre-buster 15.4s =&gt; [1/3] FROM docker.io/library/openjdk:11.0-jre-buster@sha256:3546a17e6fb4ff4fa681c3 0.0s =&gt; [internal] load build context 0.0s =&gt; =&gt; transferring context: 98B 0.0s =&gt; CACHED [2/3] RUN ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo 0.0s =&gt; CACHED [3/3] COPY hm-service.jar /app.jar 0.0s =&gt; exporting to image 0.0s =&gt; =&gt; exporting layers 0.0s =&gt; =&gt; writing image sha256:32eebee16acde22550232f2eb80c69d2ce813ed099640e4cfed2193f71 0.0s =&gt; =&gt; naming to docker.io/library/root-hmall 0.0s[+] Running 4/4 âœ” Network hmall Created 0.2s âœ” Container mysql Started 0.5s âœ” Container hmall Started 0.9s âœ” Container nginx Started 1.5s# 6.æŸ¥çœ‹é•œåƒdocker compose images# ç»“æœCONTAINER REPOSITORY TAG IMAGE ID SIZEhmall root-hmall latest 32eebee16acd 362MBmysql mysql latest 3218b38490ce 516MBnginx nginx latest 605c77e624dd 141MB# 7.æŸ¥çœ‹å®¹å™¨docker compose ps# ç»“æœNAME IMAGE COMMAND SERVICE CREATED STATUS PORTShmall root-hmall &quot;java -jar /app.jar&quot; hmall 54 seconds ago Up 52 seconds 0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcpmysql mysql &quot;docker-entrypoint.sâ€¦&quot; mysql 54 seconds ago Up 53 seconds 0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcpnginx nginx &quot;/docker-entrypoint.â€¦&quot; nginx 54 seconds ago Up 52 seconds 80/tcp, 0.0.0.0:18080-18081-&gt;18080-18081/tcp, :::18080-18081-&gt;18080-18081/tcp æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttp://yourIp:8080","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"container","slug":"container","permalink":"http://example.com/tags/container/"}]},{"title":"milkdown","slug":"source/å‰ç«¯/Milkdown","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2025/08/04/source/å‰ç«¯/Milkdown/","permalink":"http://example.com/2025/08/04/source/%E5%89%8D%E7%AB%AF/Milkdown/","excerpt":"","text":"Editor@milkdown&#x2F;kit çº¯å‡€ç‰ˆæ²¡æœ‰æ’ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980&lt;template&gt; &lt;div class=&quot;add-page&quot;&gt; &lt;div class=&quot;editor-container&quot;&gt; &lt;div id=&quot;milkdown-editor&quot; class=&quot;milkdown-editor&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; Editor, rootCtx &#125; from &quot;@milkdown/kit/core&quot;;import &#123; commonmark &#125; from &quot;@milkdown/kit/preset/commonmark&quot;;import &#123; onMounted, onUnmounted &#125; from &quot;vue&quot;;import &quot;@milkdown/kit/prose/view/style/prosemirror.css&quot;;import &#123; history &#125; from &quot;@milkdown/kit/plugin/history&quot;;import &#123; nord &#125; from &quot;@milkdown/theme-nord&quot;;import &quot;@milkdown/theme-nord/style.css&quot;;let editor = null;onMounted(async () =&gt; &#123; try &#123; // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹å¹¶æŒ‚è½½åˆ°æŒ‡å®šå…ƒç´  editor = await Editor.make() .config(nord) .config((ctx) =&gt; &#123; ctx.set(rootCtx, document.getElementById(&quot;milkdown-editor&quot;)); &#125;) .use(commonmark) .use(history) .create(); console.log(&quot;Editor created successfully&quot;); &#125; catch (error) &#123; console.error(&quot;Failed to create editor:&quot;, error); &#125;&#125;);onUnmounted(() =&gt; &#123; if (editor) &#123; editor.destroy(); &#125;&#125;);&lt;/script&gt;&lt;style scoped&gt;.add-page &#123; padding: 20px; height: calc(100vh - 120px); /* å‡å»å¯¼èˆªæ é«˜åº¦ */ background: #f5f5f5;&#125;.editor-container &#123; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); height: 100%; overflow: hidden;&#125;.milkdown-editor &#123; height: 100%; width: 100%; padding: 16px; box-sizing: border-box;&#125;/* ç¡®ä¿ Milkdown ç¼–è¾‘å™¨å†…å®¹æ­£ç¡®æ˜¾ç¤º */:deep(.milkdown) &#123; height: 100%; outline: none;&#125;:deep(.ProseMirror) &#123; height: 100%; outline: none; padding: 0; margin: 0;&#125;&lt;/style&gt; @milkdown&#x2F;crepe å†…ç½®ç‰ˆä½¿ç”¨äº†å¾ˆå¤šæ’ä»¶ https://milkdown.dev/docs/api/crepe crepeçš„å¯ç”¨æ–¹æ³•console.log(â€œCrepe å¯ç”¨æ–¹æ³•:â€, Object.getOwnPropertyNames(crepe)); [ â€œaddFeatureâ€, â€œcreateâ€, â€œdestroyâ€, â€œsetReadonlyâ€, â€œgetMarkdownâ€, â€œonâ€] 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;template&gt; &lt;div class=&quot;add-page&quot;&gt; &lt;div class=&quot;editor-container&quot;&gt; &lt;div id=&quot;milkdown-editor&quot; class=&quot;milkdown-editor&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; onMounted, onUnmounted &#125; from &quot;vue&quot;;import &#123; Crepe &#125; from &quot;@milkdown/crepe&quot;;import &quot;@milkdown/crepe/theme/common/style.css&quot;;/** * Available themes: * frame, classic, nord * frame-dark, classic-dark, nord-dark */import &quot;@milkdown/crepe/theme/frame.css&quot;;let crepe = null;onMounted(() =&gt; &#123; // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹ crepe = new Crepe(&#123; root: &quot;#milkdown-editor&quot;, defaultValue: &quot;# å¼€å§‹ç¼–å†™æ‚¨çš„å†…å®¹\\n\\nåœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„æ–‡æœ¬...&quot;, &#125;); crepe .create() .then(() =&gt; &#123; console.log(&quot;Milkdownç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ&quot;); &#125;) .catch((error) =&gt; &#123; console.error(&quot;ç¼–è¾‘å™¨åˆ›å»ºå¤±è´¥:&quot;, error); &#125;);&#125;);onUnmounted(() =&gt; &#123; // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†ç¼–è¾‘å™¨ if (crepe) &#123; crepe.destroy(); crepe = null; &#125;&#125;);&lt;/script&gt;&lt;style scoped&gt;.add-page &#123; padding: 20px; height: calc(100vh - 120px); /* å‡å»å¯¼èˆªæ é«˜åº¦ */ background: #f5f5f5;&#125;.editor-container &#123; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); height: 100%; overflow: hidden;&#125;.milkdown-editor &#123; height: 100%; width: 100%;&#125;&lt;/style&gt; æ’ä»¶7.xç‰ˆæœ¬çš„milkdownç°åœ¨å¥½åƒå·²ç»ä¸æä¾›å·¥å…·æ æ’ä»¶äº† åªæœ‰é€‰ä¸­æ–‡å­—çš„å·¥å…·å’Œ&#x2F;å”¤èµ·å·¥å…· ç°åœ¨åªèƒ½è‡ªå®šä¹‰å®ç° Editorç‰ˆçš„è‡ªå®šä¹‰æ’ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146&lt;template&gt; &lt;div class=&quot;add-page&quot;&gt; &lt;div class=&quot;editor-container&quot;&gt; &lt;div class=&quot;custom-toolbar&quot;&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleBold&quot; title=&quot;ç²—ä½“&quot;&gt; &lt;strong&gt;B&lt;/strong&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleItalic&quot; title=&quot;æ–œä½“&quot;&gt; &lt;em&gt;I&lt;/em&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleCode&quot; title=&quot;ä»£ç &quot;&gt; &lt;code&gt;&amp;lt;/&amp;gt;&lt;/code&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleStrikethrough&quot; title=&quot;åˆ é™¤çº¿&quot;&gt; &lt;s&gt;S&lt;/s&gt; &lt;/button&gt; &lt;/div&gt; &lt;div id=&quot;milkdown-editor&quot; class=&quot;milkdown-editor&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; onMounted, onUnmounted &#125; from &quot;vue&quot;;import &#123; Editor, rootCtx, commandsCtx &#125; from &quot;@milkdown/core&quot;;import &#123; commonmark &#125; from &quot;@milkdown/preset-commonmark&quot;;import &#123; nord &#125; from &quot;@milkdown/theme-nord&quot;;import &#123; toggleStrongCommand, toggleEmphasisCommand, toggleInlineCodeCommand,&#125; from &quot;@milkdown/preset-commonmark&quot;;import &quot;@milkdown/theme-nord/style.css&quot;;let editor = null;let commands = null;// å·¥å…·æ æŒ‰é’®å¤„ç†å‡½æ•°const toggleBold = () =&gt; &#123; if (commands) &#123; commands.call(toggleStrongCommand.key); &#125;&#125;;const toggleItalic = () =&gt; &#123; if (commands) &#123; commands.call(toggleEmphasisCommand.key); &#125;&#125;;const toggleCode = () =&gt; &#123; if (commands) &#123; commands.call(toggleInlineCodeCommand.key); &#125;&#125;;const toggleStrikethrough = () =&gt; &#123; // åˆ é™¤çº¿åŠŸèƒ½éœ€è¦é¢å¤–çš„æ’ä»¶æ”¯æŒ console.log(&quot;åˆ é™¤çº¿åŠŸèƒ½éœ€è¦é¢å¤–æ’ä»¶&quot;);&#125;;onMounted(() =&gt; &#123; // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹ editor = Editor.make() .use(commonmark) .use(nord) .config((ctx) =&gt; &#123; ctx.set(rootCtx, document.querySelector(&quot;#milkdown-editor&quot;)); commands = ctx.get(commandsCtx); &#125;) .create() .then(() =&gt; &#123; console.log(&quot;Milkdownç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ&quot;); &#125;) .catch((error) =&gt; &#123; console.error(&quot;ç¼–è¾‘å™¨åˆ›å»ºå¤±è´¥:&quot;, error); &#125;);&#125;);onUnmounted(() =&gt; &#123; // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†ç¼–è¾‘å™¨ if (editor) &#123; editor.destroy(); editor = null; commands = null; &#125;&#125;);&lt;/script&gt;&lt;style scoped&gt;.add-page &#123; padding: 20px; height: calc(100vh - 120px); /* å‡å»å¯¼èˆªæ é«˜åº¦ */ background: #f5f5f5;&#125;.editor-container &#123; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); height: 100%; overflow: hidden; display: flex; flex-direction: column;&#125;.custom-toolbar &#123; display: flex; align-items: center; padding: 8px 12px; border-bottom: 1px solid #e0e0e0; background: #fafafa; gap: 4px;&#125;.toolbar-btn &#123; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: 1px solid #d0d0d0; background: white; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s ease;&#125;.toolbar-btn:hover &#123; background: #f0f0f0; border-color: #b0b0b0;&#125;.toolbar-btn:active &#123; background: #e0e0e0; transform: translateY(1px);&#125;.milkdown-editor &#123; flex: 1; width: 100%; overflow: auto;&#125;&lt;/style&gt; crepeç‰ˆçš„è‡ªå®šä¹‰å·¥å…·æ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150&lt;template&gt; &lt;div class=&quot;add-page&quot;&gt; &lt;div class=&quot;editor-container&quot;&gt; &lt;div class=&quot;custom-toolbar&quot;&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleBold&quot; title=&quot;ç²—ä½“&quot;&gt; &lt;strong&gt;B&lt;/strong&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleItalic&quot; title=&quot;æ–œä½“&quot;&gt; &lt;em&gt;I&lt;/em&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleCode&quot; title=&quot;ä»£ç &quot;&gt; &lt;code&gt;&amp;lt;/&amp;gt;&lt;/code&gt; &lt;/button&gt; &lt;button class=&quot;toolbar-btn&quot; @click=&quot;toggleStrikethrough&quot; title=&quot;åˆ é™¤çº¿&quot;&gt; &lt;s&gt;S&lt;/s&gt; &lt;/button&gt; &lt;/div&gt; &lt;div id=&quot;milkdown-editor&quot; class=&quot;milkdown-editor&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; onMounted, onUnmounted &#125; from &quot;vue&quot;;import &#123; Crepe &#125; from &quot;@milkdown/crepe&quot;;import &#123; commandsCtx &#125; from &quot;@milkdown/core&quot;;import &#123; toggleStrongCommand, toggleEmphasisCommand, toggleInlineCodeCommand,&#125; from &quot;@milkdown/preset-commonmark&quot;;import &quot;@milkdown/crepe/theme/common/style.css&quot;;import &quot;@milkdown/crepe/theme/frame.css&quot;;let crepe = null;let commands = null;// å·¥å…·æ æŒ‰é’®å¤„ç†å‡½æ•°const toggleBold = () =&gt; &#123; if (commands) &#123; commands.call(toggleStrongCommand.key); &#125;&#125;;const toggleItalic = () =&gt; &#123; if (commands) &#123; commands.call(toggleEmphasisCommand.key); &#125;&#125;;const toggleCode = () =&gt; &#123; if (commands) &#123; commands.call(toggleInlineCodeCommand.key); &#125;&#125;;const toggleStrikethrough = () =&gt; &#123; // åˆ é™¤çº¿åŠŸèƒ½éœ€è¦é¢å¤–çš„æ’ä»¶æ”¯æŒ console.log(&quot;åˆ é™¤çº¿åŠŸèƒ½éœ€è¦é¢å¤–æ’ä»¶&quot;);&#125;;onMounted(() =&gt; &#123; // åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹ crepe = new Crepe(&#123; root: &quot;#milkdown-editor&quot;, defaultValue: &quot;# å¼€å§‹ç¼–å†™æ‚¨çš„å†…å®¹\\n\\nåœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„æ–‡æœ¬...&quot;, &#125;); crepe .create() .then(() =&gt; &#123; console.log(&quot;Milkdownç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ&quot;); // è·å–å‘½ä»¤ç®¡ç†å™¨ if (crepe.editor &amp;&amp; crepe.editor.action) &#123; crepe.editor.action((ctx) =&gt; &#123; commands = ctx.get(commandsCtx); &#125;); &#125; &#125;) .catch((error) =&gt; &#123; console.error(&quot;ç¼–è¾‘å™¨åˆ›å»ºå¤±è´¥:&quot;, error); &#125;);&#125;);onUnmounted(() =&gt; &#123; // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†ç¼–è¾‘å™¨ if (crepe) &#123; crepe.destroy(); crepe = null; commands = null; &#125;&#125;);&lt;/script&gt;&lt;style scoped&gt;.add-page &#123; padding: 20px; height: calc(100vh - 120px); /* å‡å»å¯¼èˆªæ é«˜åº¦ */ background: #f5f5f5;&#125;.editor-container &#123; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); height: 100%; overflow: hidden; display: flex; flex-direction: column;&#125;.custom-toolbar &#123; display: flex; align-items: center; padding: 8px 12px; border-bottom: 1px solid #e0e0e0; background: #fafafa; gap: 4px;&#125;.toolbar-btn &#123; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: 1px solid #d0d0d0; background: white; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s ease;&#125;.toolbar-btn:hover &#123; background: #f0f0f0; border-color: #b0b0b0;&#125;.toolbar-btn:active &#123; background: #e0e0e0; transform: translateY(1px);&#125;.milkdown-editor &#123; flex: 1; width: 100%; overflow: auto;&#125;&lt;/style&gt; å†…å®¹ä¸»é¢˜+ä»£ç å—ä¸»é¢˜ï¼Œé«˜äº® 123456789101112131415161718192021# å¼€å§‹ç¼–å†™æ‚¨çš„å†…å®¹åœ¨è¿™é‡Œè¾“å…¥æ‚¨çš„æ–‡æœ¬...&lt;br /&gt;```C++# include&lt;iostream&gt;int main()&#123; return 0;&#125;```&gt; è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæµ‹è¯•~~ä»£ç é«˜äº®~~***ä»€ä¹ˆ\\ä½ è¯´ xlsxå¯¼å…¥ xlsx + file-saver è¡¨æ ¼å¯¼å‡º å¾®ä¿¡ç™»å½• ææ–™åº“ æˆå“åº“ ææ–™è®¾è®¡ï¼š å¤šå°‘é’±ä¸€å•ä½ å•ä½ä¸ºé¢ç§¯æˆ–è€…æ•°é‡ æˆå¹³åº“ï¼šæ™®é€šæˆå“ã€éæ ‡æˆå¹³(ä»ææ–™ä¸­ç»„) åªæœ‰ä¸€ä¸ªä»·æ ¼ï¼ŒæŒ‰æ•°é‡ç®— æŠ¥ä»·ï¼šä»æˆå¹³åº“ä¸­é€‰æ‹©&#x2F;é‡æ–°ç»„ä»· ææ–™ï¼š æ ‡å‡†è§„æ ¼ é•¿ 5ç±³ æ ‡å‡†ä»·æ ¼ 50å— å®½ 1ç±³ å•ä»· 10å…ƒ å•ä½ï¼šå¹³æ–¹ç±³ å…¬å¼ï¼šæ ‡å‡†ä»·æ ¼&#x2F;é•¿*å®½ å¯é€‰æ‹©å…¬å¼ expr-eval æˆå“ï¼š xxx è§„æ ¼ï¼šxå•ä½ yå•ä½ ä»·æ ¼ xå•ä½ å…¬å¼ï¼š é¢ç§¯&#x3D;é•¿*å®½ é€‰æ‹©ææ–™ xx å•ä»·ï¼š10 å…ƒ&#x2F;å¹³æ–¹ç±³ ç”¨é‡ï¼š xå¹³æ–¹ç±³ (æ‰©å±•æŒ‰é’®) â€‹ ç”¨é‡ï¼š x*2å¹³æ–¹ç±³ yy å•ä»·ï¼š10 å…ƒ&#x2F;ä¸ª ç”¨é‡ï¼š yä¸ª å…¶ä»–markdownç»„ä»¶é™æ€ç«™ç‚¹ç”Ÿæˆï¼šhttps://vuepress.vuejs.org/zh/guide/introduction.html ç¼–è¾‘å™¨ï¼šhttps://tiptap.dev/ ç¼–è¾‘å™¨ï¼š(å·¦å³åˆ†å±æ˜¾ç¤º)http://editor.md.ipandao.com/ ç¼–è¾‘å™¨ï¼š(å·¦å³åˆ†å±)https://imzbf.github.io/md-editor-v3/zh-CN å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼šhttps://www.wangeditor.com/","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"milkdown","slug":"milkdown","permalink":"http://example.com/tags/milkdown/"}]},{"title":"ruståœ£ç»","slug":"source/Rust/RustBible","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2025/08/04/source/Rust/RustBible/","permalink":"http://example.com/2025/08/04/source/Rust/RustBible/","excerpt":"","text":"Rustè¯­è¨€åœ£ç»(è¯»ä¹¦ç¬”è®°)åŸºç¡€å…¥é—¨å˜é‡ç»‘å®šä¸è§£æ„å˜é‡ç»‘å®šlet a = &quot;hello world&quot; å˜é‡å¯å˜æ€§Rust çš„å˜é‡åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯å˜çš„, ä½ å¯ä»¥é€šè¿‡ mut å…³é”®å­—è®©å˜é‡å˜ä¸ºå¯å˜çš„ 1let mut x = 5; // å˜é‡ x æ˜¯å¯å˜çš„ ä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡ä¸è­¦å‘Šæœªä½¿ç”¨çš„å˜é‡ 1let _x = 5; å˜é‡è§£æ„let è¡¨è¾¾å¼ä¸ä»…ä»…ç”¨äºå˜é‡çš„ç»‘å®šï¼Œè¿˜èƒ½è¿›è¡Œå¤æ‚å˜é‡çš„è§£æ„ï¼šä»ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„å˜é‡ä¸­ï¼ŒåŒ¹é…å‡ºè¯¥å˜é‡çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼š 123456789101112let (a, mut b): (bool,bool) = (true, false);struct Struct &#123; e: i32&#125;fn main() &#123; let (a, b, c, d, e); (a, b) = (1, 2); [c, .., d, _] = [1, 2, 3, 4, 5]; Struct &#123; e, .. &#125; = Struct &#123; e: 5 &#125;; assert_eq!([1, 2, 1, 4, 5], [a, b, c, d, e]);&#125; å¸¸é‡ å¸¸é‡ä¸å…è®¸ä½¿ç”¨ mut å¸¸é‡ä½¿ç”¨ const å…³é”®å­—è€Œä¸æ˜¯ let å…³é”®å­—æ¥å£°æ˜ï¼Œå¹¶ä¸”å€¼çš„ç±»å‹å¿…é¡»æ ‡æ³¨ 1const MAX_POINTS: u32 = 100_000; Rust å¸¸é‡çš„å‘½åçº¦å®šæ˜¯å…¨éƒ¨å­—æ¯éƒ½ä½¿ç”¨å¤§å†™ï¼Œå¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ï¼Œå¦å¤–å¯¹æ•°å­—å­—é¢é‡å¯æ’å…¥ä¸‹åˆ’çº¿ä»¥æé«˜å¯è¯»æ€§ å˜é‡é®è”½(shadowing)Rust å…è®¸å£°æ˜ç›¸åŒçš„å˜é‡åï¼Œåœ¨åé¢å£°æ˜çš„å˜é‡ä¼šé®è”½æ‰å‰é¢å£°æ˜çš„ 1234// å­—ç¬¦ä¸²ç±»å‹let spaces = &quot; &quot;;// usizeæ•°å€¼ç±»å‹let spaces = spaces.len(); å¦‚æœè¿™é‡Œæ²¡æœ‰ä½¿ç”¨letæ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºä¸èƒ½æ”¹å˜å˜é‡çš„ç±»å‹ åŸºæœ¬ç±»å‹Rust æ¯ä¸ªå€¼éƒ½æœ‰å…¶ç¡®åˆ‡çš„æ•°æ®ç±»å‹ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šåŸºæœ¬ç±»å‹å’Œå¤åˆç±»å‹, åŸºæœ¬ç±»å‹ç”±ä»¥ä¸‹ç»„æˆï¼š æ•°å€¼ç±»å‹: æœ‰ç¬¦å·æ•´æ•° (i8, i16, i32, i64, isize)ã€ æ— ç¬¦å·æ•´æ•° (u8, u16, u32, u64, usize) ã€æµ®ç‚¹æ•° (f32, f64)ã€ä»¥åŠæœ‰ç†æ•°ã€å¤æ•° å­—ç¬¦ä¸²ï¼šå­—ç¬¦ä¸²å­—é¢é‡å’Œå­—ç¬¦ä¸²åˆ‡ç‰‡ &amp;str å¸ƒå°”ç±»å‹ï¼š true å’Œ false å­—ç¬¦ç±»å‹: è¡¨ç¤ºå•ä¸ª Unicode å­—ç¬¦ï¼Œå­˜å‚¨ä¸º 4 ä¸ªå­—èŠ‚ å•å…ƒç±»å‹: å³ () ï¼Œå…¶å”¯ä¸€çš„å€¼ä¹Ÿæ˜¯ () æ•°å€¼ç±»å‹æ•´æ•°ç±»å‹Rust æ•´å‹é»˜è®¤ä½¿ç”¨ i32 æ¯ä¸ªæœ‰ç¬¦å·ç±»å‹è§„å®šçš„æ•°å­—èŒƒå›´æ˜¯ -(2^n - 1^) ~ 2^n - 1^ - 1æ— ç¬¦å·ç±»å‹å¯ä»¥å­˜å‚¨çš„æ•°å­—èŒƒå›´æ˜¯ 0 ~ 2^n^ - 1 isize usize cpuæ˜¯å¤šå°‘ä½ä»–ä»¬å°±æ˜¯å¤šå°‘ä½ æ•´å‹æº¢å‡ºï¼šdebugæ¨¡å¼ä¸‹ï¼Œè§¦å‘*panicï¼Œ*releaseä¸‹ï¼ŒæŒ‰ç…§è¡¥ç å¾ªç¯æº¢å‡ºå¤„ç†æ˜¾ç¤ºå¤„ç†æº¢å‡ºï¼š ä½¿ç”¨ wrapping_* æ–¹æ³•åœ¨æ‰€æœ‰æ¨¡å¼ä¸‹éƒ½æŒ‰ç…§è¡¥ç å¾ªç¯æº¢å‡ºè§„åˆ™å¤„ç†ï¼Œä¾‹å¦‚ wrapping_add å¦‚æœä½¿ç”¨ checked_* æ–¹æ³•æ—¶å‘ç”Ÿæº¢å‡ºï¼Œåˆ™è¿”å› None å€¼ ä½¿ç”¨ overflowing_* æ–¹æ³•è¿”å›è¯¥å€¼å’Œä¸€ä¸ªæŒ‡ç¤ºæ˜¯å¦å­˜åœ¨æº¢å‡ºçš„å¸ƒå°”å€¼ ä½¿ç”¨ saturating_* æ–¹æ³•ï¼Œå¯ä»¥é™å®šè®¡ç®—åçš„ç»“æœä¸è¶…è¿‡ç›®æ ‡ç±»å‹çš„æœ€å¤§å€¼æˆ–ä½äºæœ€å°å€¼ æµ®ç‚¹ç±»å‹é»˜è®¤æµ®ç‚¹ç±»å‹æ˜¯ f64 æµ®ç‚¹æ•°æ ¹æ® IEEE-754 æ ‡å‡†å®ç°ã€‚f32ç±»å‹æ˜¯å•ç²¾åº¦æµ®ç‚¹å‹ï¼Œf64 ä¸ºåŒç²¾åº¦ã€‚ æµ®ç‚¹æ•°è¿ç®—åº”é¿å…æµ‹è¯•ç›¸ç­‰æ€§ï¼Œä¸”å½“ç»“æœåœ¨æ•°å­¦ä¸Šå¯èƒ½å­˜åœ¨æœªå®šä¹‰æ—¶ï¼Œè¦æ ¼å¤–å°å¿ƒã€‚ NaNå¯¹äºæ•°å­¦ä¸Šæœªå®šä¹‰çš„ç»“æœï¼Œä¾‹å¦‚å¯¹è´Ÿæ•°å–å¹³æ–¹æ ¹ -42.1.sqrt() ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªç‰¹æ®Šçš„ç»“æœï¼šRust çš„æµ®ç‚¹æ•°ç±»å‹ä½¿ç”¨ NaN (not a number)æ¥å¤„ç†è¿™äº›æƒ…å†µã€‚ æ‰€æœ‰è·Ÿ NaN äº¤äº’çš„æ“ä½œï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª NaNï¼Œè€Œä¸” NaN ä¸èƒ½ç”¨æ¥æ¯”è¾ƒ 1234fn main() &#123; let x = (-42.0_f32).sqrt(); assert_eq!(x, x); // panic&#125; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ is_nan() ç­‰æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°å€¼æ˜¯å¦æ˜¯ NaN 1if x.is_nan() æ•°å­—è¿ç®—1234567891011121314151617181920212223242526fn main() &#123; // ç¼–è¯‘å™¨ä¼šè¿›è¡Œè‡ªåŠ¨æ¨å¯¼ï¼Œç»™äºˆtwenty i32çš„ç±»å‹ let twenty = 20; // ç±»å‹æ ‡æ³¨ let twenty_one: i32 = 21; // é€šè¿‡ç±»å‹åç¼€çš„æ–¹å¼è¿›è¡Œç±»å‹æ ‡æ³¨ï¼š22æ˜¯i32ç±»å‹ let twenty_two = 22i32; // åªæœ‰åŒæ ·ç±»å‹ï¼Œæ‰èƒ½è¿ç®— let addition = twenty + twenty_one + twenty_two; println!(&quot;&#123;&#125; + &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;, twenty, twenty_one, twenty_two, addition); // å¯¹äºè¾ƒé•¿çš„æ•°å­—ï¼Œå¯ä»¥ç”¨_è¿›è¡Œåˆ†å‰²ï¼Œæå‡å¯è¯»æ€§ let one_million: i64 = 1_000_000; println!(&quot;&#123;&#125;&quot;, one_million.pow(2)); // å®šä¹‰ä¸€ä¸ªf32æ•°ç»„ï¼Œå…¶ä¸­42.0ä¼šè‡ªåŠ¨è¢«æ¨å¯¼ä¸ºf32ç±»å‹ let forty_twos = [ 42.0, 42f32, 42.0_f32, ]; // æ‰“å°æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå€¼ï¼Œå¹¶æ§åˆ¶å°æ•°ä½ä¸º2ä½ println!(&quot;&#123;:.2&#125;&quot;, forty_twos[0]);&#125; ä½è¿ç®—Rust çš„è¿ç®—åŸºæœ¬ä¸Šå’Œå…¶ä»–è¯­è¨€ä¸€æ · 1234567891011121314151617181920212223fn main() &#123; // äºŒè¿›åˆ¶ä¸º00000010 let a:i32 = 2; // äºŒè¿›åˆ¶ä¸º00000011 let b:i32 = 3; println!(&quot;(a &amp; b) value is &#123;&#125;&quot;, a &amp; b); println!(&quot;(a | b) value is &#123;&#125;&quot;, a | b); println!(&quot;(a ^ b) value is &#123;&#125;&quot;, a ^ b); println!(&quot;(!b) value is &#123;&#125; &quot;, !b); println!(&quot;(a &lt;&lt; b) value is &#123;&#125;&quot;, a &lt;&lt; b); println!(&quot;(a &gt;&gt; b) value is &#123;&#125;&quot;, a &gt;&gt; b); let mut a = a; // æ³¨æ„è¿™äº›è®¡ç®—ç¬¦é™¤äº†!ä¹‹å¤–éƒ½å¯ä»¥åŠ ä¸Š=è¿›è¡Œèµ‹å€¼ (å› ä¸º!=è¦ç”¨æ¥åˆ¤æ–­ä¸ç­‰äº) a &lt;&lt;= b; println!(&quot;(a &lt;&lt; b) value is &#123;&#125;&quot;, a);&#125; åºåˆ—(Range)è¿ç»­æ•°å€¼ï¼Œå¸¸ç”¨äºå¾ªç¯ &#x20;1..5ï¼Œç”Ÿæˆä» 1 åˆ° 4 çš„è¿ç»­æ•°å­—ï¼Œä¸åŒ…å« 5 ï¼› 1..=5ï¼Œç”Ÿæˆä» 1 åˆ° 5 çš„è¿ç»­æ•°å­—ï¼ŒåŒ…å« 5 123for i in 1..=5 &#123; println!(&quot;&#123;&#125;&quot;,i);&#125; åºåˆ—åªå…è®¸ç”¨äºæ•°å­—æˆ–å­—ç¬¦ç±»å‹ 123for i in &#x27;a&#x27;..=&#x27;z&#x27; &#123; println!(&quot;&#123;&#125;&quot;,i);&#125; æœ‰ç†æ•°å’Œå¤æ•°æœ‰ç†æ•°å’Œå¤æ•°å¹¶æœªåŒ…å«åœ¨æ ‡å‡†åº“ä¸­ï¼Œç¤¾åŒºå·²å¼€å‘å‡ºé«˜è´¨é‡çš„æ•°å€¼åº“ï¼š numã€‚ åœ¨ Cargo.toml ä¸­çš„ [dependencies] ä¸‹æ·»åŠ ä¸€è¡Œ num = &quot;0.4.0&quot; 123456789use num::complex::Complex;fn main() &#123; let a = Complex &#123; re: 2.1, im: -1.2 &#125;; let b = Complex::new(11.1, 22.2); let result = a + b; println!(&quot;&#123;&#125; + &#123;&#125;i&quot;, result.re, result.im)&#125; å­—ç¬¦ã€å¸ƒå°”ã€å•å…ƒç±»å‹å­—ç¬¦ç±»å‹(char)123456fn main() &#123; let c = &#x27;z&#x27;; let z = &#x27;â„¤&#x27;; let g = &#x27;å›½&#x27;; let heart_eyed_cat = &#x27;ğŸ˜»&#x27;;&#125; Rust çš„å­—ç¬¦ä¸ä»…ä»…æ˜¯ ASCIIï¼Œæ‰€æœ‰çš„ Unicode å€¼éƒ½å¯ä»¥ä½œä¸º Rust å­—ç¬¦ï¼ŒåŒ…æ‹¬å•ä¸ªçš„ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€emoji è¡¨æƒ…ç¬¦å·ç­‰ç­‰ ç”±äº Unicode éƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ç¼–ç ï¼Œå› æ­¤å­—ç¬¦ç±»å‹ä¹Ÿæ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ 1234fn main() &#123; let x = &#x27;ä¸­&#x27;; println!(&quot;å­—ç¬¦&#x27;ä¸­&#x27;å ç”¨äº†&#123;&#125;å­—èŠ‚çš„å†…å­˜å¤§å°&quot;,std::mem::size_of_val(&amp;x));&#125; å¸ƒå°”(bool)Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseï¼Œå¸ƒå°”å€¼å ç”¨å†…å­˜çš„å¤§å°ä¸º 1 ä¸ªå­—èŠ‚ï¼š 1234567fn main() &#123; let t = true; let f: bool = false; // ä½¿ç”¨ç±»å‹æ ‡æ³¨,æ˜¾å¼æŒ‡å®šfçš„ç±»å‹ if f &#123; println!(&quot;è¿™æ˜¯æ®µæ¯«æ— æ„ä¹‰çš„ä»£ç &quot;); &#125;&#125; å•å…ƒç±»å‹å•å…ƒç±»å‹å°±æ˜¯ () ï¼Œå”¯ä¸€çš„å€¼ä¹Ÿæ˜¯ ()ã€‚ä¸Šé¢ç»å¸¸ç”¨åˆ°çš„ main å‡½æ•°å°±è¿”å›è¿™ä¸ªå•å…ƒç±»å‹ (), åœ¨ Rust ä¸­ï¼Œæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°æ˜¯æœ‰å•ç‹¬çš„å®šä¹‰çš„ï¼šå‘æ•£å‡½æ•°( diverge function )ï¼Œé¡¾åæ€ä¹‰ï¼Œæ— æ³•æ”¶æ•›çš„å‡½æ•° println!() çš„è¿”å›å€¼ä¹Ÿæ˜¯å•å…ƒç±»å‹ () è¯­å¥ä¸è¡¨è¾¾å¼Rust çš„å‡½æ•°ä½“æ˜¯ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆï¼Œæœ€åç”±ä¸€ä¸ªè¡¨è¾¾å¼æ¥è¿”å›å€¼ 12345fn add_with_extra(x: i32, y: i32) -&gt; i32 &#123; let x = x + 1; // è¯­å¥ let y = y + 5; // è¯­å¥ x + y // è¡¨è¾¾å¼&#125; è¯­å¥è¯­å¥å®Œæˆä¸€ä¸ªå…·ä½“çš„æ“ä½œï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿”å›å€¼ 123let a = 8;let b: Vec&lt;f64&gt; = Vec::new();let (a, c) = (&quot;hi&quot;, false); è¡¨è¾¾å¼è¡¨è¾¾å¼ä¼šè¿›è¡Œæ±‚å€¼ï¼Œç„¶åè¿”å›ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ 5 + 6ï¼Œåœ¨æ±‚å€¼åï¼Œè¿”å›å€¼ 11ï¼Œå› æ­¤å®ƒå°±æ˜¯ä¸€æ¡è¡¨è¾¾å¼ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ˜¯è¡¨è¾¾å¼ï¼Œå› ä¸ºä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè°ƒç”¨å®ä¹Ÿæ˜¯è¡¨è¾¾å¼ï¼Œç”¨èŠ±æ‹¬å·åŒ…è£¹æœ€ç»ˆè¿”å›ä¸€ä¸ªå€¼çš„è¯­å¥å—ä¹Ÿæ˜¯è¡¨è¾¾å¼ï¼Œæ€»ä¹‹ï¼Œèƒ½è¿”å›å€¼ï¼Œå®ƒå°±æ˜¯è¡¨è¾¾å¼: è¡¨è¾¾å¼ä¸èƒ½åŒ…å«åˆ†å·ã€‚è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¸€æ—¦ä½ åœ¨è¡¨è¾¾å¼ååŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±ä¼šå˜æˆä¸€æ¡è¯­å¥ï¼Œå†ä¹Ÿä¸ä¼šè¿”å›ä¸€ä¸ªå€¼ è¡¨è¾¾å¼å¦‚æœä¸è¿”å›ä»»ä½•å€¼ï¼Œä¼šéšå¼åœ°è¿”å›ä¸€ä¸ª () 12345678910111213141516fn main() &#123; assert_eq!(ret_unit_type(), ())&#125;fn ret_unit_type() &#123; let x = 1; // if è¯­å¥å—ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› æ­¤å¯ä»¥ç”¨äºèµ‹å€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å› // ç±»ä¼¼ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œåœ¨Rusté‡Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ let y = if x % 2 == 1 &#123; &quot;odd&quot; &#125; else &#123; &quot;even&quot; &#125;; // æˆ–è€…å†™æˆä¸€è¡Œ let z = if x % 2 == 1 &#123; &quot;odd&quot; &#125; else &#123; &quot;even&quot; &#125;;&#125; å‡½æ•°å…ˆçœ‹ä¸‹é¢çš„å‡½æ•°å£°æ˜ï¼š 123fn add(i: i32, j: i32) -&gt; i32 &#123; i + j&#125; å£°æ˜å‡½æ•°çš„å…³é”®å­— fn ,å‡½æ•°å add()ï¼Œå‚æ•° i å’Œ jï¼Œå‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹éƒ½æ˜¯ i32 è¦ç‚¹ å‡½æ•°åå’Œå˜é‡åä½¿ç”¨è›‡å½¢å‘½åæ³•(snake case)ï¼Œä¾‹å¦‚ fn add_two() -&gt; &#123;&#125; å‡½æ•°çš„ä½ç½®å¯ä»¥éšä¾¿æ”¾ï¼ŒRust ä¸å…³å¿ƒæˆ‘ä»¬åœ¨å“ªé‡Œå®šä¹‰äº†å‡½æ•°ï¼Œåªè¦æœ‰å®šä¹‰å³å¯ æ¯ä¸ªå‡½æ•°å‚æ•°éƒ½éœ€è¦æ ‡æ³¨ç±»å‹ å‡½æ•°è¿”å›åœ¨ Rust ä¸­å‡½æ•°å°±æ˜¯è¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°çš„è¿”å›å€¼ç›´æ¥èµ‹ç»™è°ƒç”¨è€…ã€‚ å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å‡½æ•°ä½“æœ€åä¸€æ¡è¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ return æå‰è¿”å› æ— è¿”å›å€¼å•å…ƒç±»å‹ ()ï¼Œæ˜¯ä¸€ä¸ªé›¶é•¿åº¦çš„å…ƒç»„ã€‚å®ƒæ²¡å•¥ä½œç”¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨æ¥è¡¨è¾¾ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼š å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª () é€šè¿‡ ; ç»“å°¾çš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ª () ä¸‹é¢çš„ report å‡½æ•°ä¼šéšå¼è¿”å›ä¸€ä¸ª ()ï¼š 12345use std::fmt::Debug;fn report&lt;T: Debug&gt;(item: T) &#123; println!(&quot;&#123;:?&#125;&quot;, item);&#125; å‘æ•£å‡½æ•°å½“ç”¨ ! ä½œå‡½æ•°è¿”å›ç±»å‹çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°æ°¸ä¸è¿”å›( diverge function )ï¼Œç‰¹åˆ«çš„ï¼Œè¿™ç§è¯­æ³•å¾€å¾€ç”¨åšä¼šå¯¼è‡´ç¨‹åºå´©æºƒçš„å‡½æ•°ï¼š 123fn dead_end() -&gt; ! &#123; panic!(&quot;ä½ å·²ç»åˆ°äº†ç©·é€”æœ«è·¯ï¼Œå´©æºƒå§ï¼&quot;);&#125; æ‰€æœ‰æƒå’Œå€Ÿç”¨æ‰€æœ‰æƒæ ˆ(Stack)ä¸å †(Heap)æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ å¯¹äºå¤§å°æœªçŸ¥æˆ–è€…å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå­˜å‚¨åœ¨å †ä¸Šã€‚å½“å‘å †ä¸Šæ”¾å…¥æ•°æ®æ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„æŒ‡é’ˆ, è¯¥è¿‡ç¨‹è¢«ç§°ä¸ºåœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚æ¥ç€ï¼Œè¯¥æŒ‡é’ˆä¼šè¢«æ¨å…¥æ ˆä¸­ï¼Œå› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œåœ¨åç»­ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å°†é€šè¿‡æ ˆä¸­çš„æŒ‡é’ˆï¼Œæ¥è·å–æ•°æ®åœ¨å †ä¸Šçš„å®é™…å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®è¯¥æ•°æ® æ‰€æœ‰æƒåŸåˆ™å…³äºæ‰€æœ‰æƒçš„è§„åˆ™ï¼Œé¦–å…ˆè¯·è°¨è®°ä»¥ä¸‹è§„åˆ™ï¼š Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€… ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€… å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop) String ç±»å‹ï¼Œæˆ‘ä»¬é€šè¿‡ let s = &quot;Hello&quot; æ¥å£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œç±»å‹ä¸º &amp;strï¼Œå­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼Œä¸”å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–ç æ—¶å¾—çŸ¥ã€‚ä¸ºæ­¤ï¼ŒRust ä¸ºæˆ‘ä»¬æä¾›åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹: String, è¯¥ç±»å‹è¢«åˆ†é…åˆ°å †ä¸Šï¼Œå› æ­¤å¯ä»¥åŠ¨æ€ä¼¸ç¼©ï¼Œä¹Ÿå°±èƒ½å­˜å‚¨åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬ ç”¨ä¸‹é¢çš„æ–¹æ³•åŸºäºå­—ç¬¦ä¸²å­—é¢é‡æ¥åˆ›å»º String ç±»å‹: 1let s = String::from(&quot;hello&quot;); :: æ˜¯ä¸€ç§è°ƒç”¨æ“ä½œç¬¦ï¼Œè¿™é‡Œè¡¨ç¤ºè°ƒç”¨ String ä¸­çš„ from æ–¹æ³•ã€‚String å­˜å‚¨åœ¨å †ä¸Šæ˜¯åŠ¨æ€çš„ï¼Œä½ å¯ä»¥è¿™æ ·ä¿®æ”¹å®ƒï¼š 123let mut s = String::from(&quot;hello&quot;);s.push_str(&quot;, world!&quot;); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼println!(&quot;&#123;&#125;&quot;, s); // å°†æ‰“å° `hello, world!` å˜é‡ç»‘å®šçš„æ•°æ®äº¤äº’12let x = 5;let y = x; ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒRust ä¼šç›´æ¥åœ¨æ ˆä¸­æ‹·è´ä¸€ä»½ï¼Œx å’Œ y éƒ½åœ¨æ ˆä¸­ï¼Œå¹¶ä¸”éƒ½ç»‘å®šäº†å€¼ 5ã€‚åœ¨ Rust ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼ã€‚å†çœ‹ä¸‹é¢çš„ä»£ç ï¼š 12let s1 = String::from(&quot;hello&quot;);let s2 = s1; String ç±»å‹æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œç”±å­˜å‚¨åœ¨æ ˆä¸­çš„å †æŒ‡é’ˆã€å­—ç¬¦ä¸²é•¿åº¦ã€å­—ç¬¦ä¸²å®¹é‡å…±åŒç»„æˆã€‚å †æŒ‡é’ˆæŒ‡å‘äº†çœŸå®å­˜å‚¨å­—ç¬¦ä¸²å†…å®¹çš„å †å†…å­˜ï¼Œå®¹é‡æ˜¯å †å†…å­˜åˆ†é…ç©ºé—´çš„å¤§å°ï¼Œé•¿åº¦æ˜¯ç›®å‰å·²ç»ä½¿ç”¨çš„å¤§å°ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œs1 å’Œ s2 éƒ½æŒ‡å‘äº†å †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œé‚£å®ƒçš„æ‰€æœ‰è€…åˆ°åº•æ˜¯è°å‘¢ï¼Ÿå½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒä»¬é‡Šæ”¾çš„åŒä¸€ä¸ªå †åœ°å€ä¸Šçš„å€¼ï¼Œä¼šå¼•å‘äºŒæ¬¡é‡Šæ”¾çš„é”™è¯¯ï¼ŒRust è¿™æ ·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“ s1 èµ‹äºˆ s2 ä¹‹åï¼Œs1 å°±ä¼šé©¬ä¸Šå¤±æ•ˆï¼Œæˆ–è€…è¯´ï¼Œs1 æŠŠ String çš„æ‰€æœ‰æƒè½¬ç§»åˆ°äº† s2 123let s1 = String::from(&quot;hello&quot;);let s2 = s1;println!(&quot;&#123;&#125;, world!&quot;, s1); // æŠ¥é”™ å¦‚æœæƒ³è¦åœ¨å †å†…å­˜ä¸Šåˆ›å»ºå€¼çš„å‰¯æœ¬ï¼ŒRust æä¾›äº†ä¸€ä¸ª clone æ–¹æ³• 123let s1 = String::from(&quot;hello&quot;);let s2 = s1.clone();println!(&quot;s1 = &#123;&#125;, s2 = &#123;&#125;&quot;, s1, s2); Rust æœ‰ä¸€ä¸ªå«åš Copy çš„ç‰¹å¾ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·åœ¨æ ˆä¸­å­˜å‚¨çš„ç±»å‹ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ‹¥æœ‰ Copy ç‰¹å¾ï¼Œä¸€ä¸ªæ—§çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ ä»»ä½•åŸºæœ¬ç±»å‹çš„ç»„åˆå¯ä»¥ Copy ï¼Œä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹æ˜¯å¯ä»¥ Copy çš„ å‡½æ•°ä¼ å€¼ä¸è¿”å›å°†å€¼ä¼ é€’ç»™å‡½æ•°ï¼Œä¸€æ ·ä¼šå‘ç”Ÿ ç§»åŠ¨ æˆ–è€… å¤åˆ¶ 123456789101112131415161718192021fn main() &#123; let s = String::from(&quot;hello&quot;); // s è¿›å…¥ä½œç”¨åŸŸ takes_ownership(s); // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ... // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ let x = 5; // x è¿›å…¥ä½œç”¨åŸŸ makes_copy(x); // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x&#125; // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œfn takes_ownership(some_string: String) &#123; // some_string è¿›å…¥ä½œç”¨åŸŸ println!(&quot;&#123;&#125;&quot;, some_string);&#125; // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾fn makes_copy(some_integer: i32) &#123; // some_integer è¿›å…¥ä½œç”¨åŸŸ println!(&quot;&#123;&#125;&quot;, some_integer);&#125; // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ å‡½æ•°è¿”å›å€¼ä¹Ÿæœ‰æ‰€æœ‰æƒ 12345678910111213141516171819202122232425fn main() &#123; let s1 = gives_ownership(); // gives_ownership å°†è¿”å›å€¼ // ç§»ç»™ s1 let s2 = String::from(&quot;hello&quot;); // s2 è¿›å…¥ä½œç”¨åŸŸ let s3 = takes_and_gives_back(s2); // s2 è¢«ç§»åŠ¨åˆ° // takes_and_gives_back ä¸­, // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3&#125; // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒfn gives_ownership() -&gt; String &#123; // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™ // è°ƒç”¨å®ƒçš„å‡½æ•° let some_string = String::from(&quot;hello&quot;); // some_string è¿›å…¥ä½œç”¨åŸŸ. some_string // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°&#125;// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼fn takes_and_gives_back(a_string: String) -&gt; String &#123; // a_string è¿›å…¥ä½œç”¨åŸŸ a_string // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°&#125; å¼•ç”¨å’Œå€Ÿç”¨åœ¨ Rust ä¸­ï¼Œè·å–å˜é‡çš„å¼•ç”¨ï¼Œç§°ä¹‹ä¸ºå€Ÿç”¨(borrowing) å¼•ç”¨ä¸è§£å¼•ç”¨å¸¸è§„å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘äº†å¯¹è±¡å­˜å‚¨çš„å†…å­˜åœ°å€ 1234567fn main() &#123; let x = 5; let y = &amp;x; // y æ˜¯ x çš„ä¸€ä¸ªå¼•ç”¨ assert_eq!(5, x); assert_eq!(5, *y);&#125; å¦‚æœå¸Œæœ›å¯¹ y çš„å€¼åšå‡ºæ–­è¨€ï¼Œå¿…é¡»ä½¿ç”¨ *y æ¥è§£å‡ºå¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯è§£å¼•ç”¨ï¼‰ ä¸å¯å˜å¼•ç”¨12345678fn main() &#123; let s1 = String::from(&quot;hello&quot;); let len = calculate_length(&amp;s1); // é€šè¿‡å¼•ç”¨ï¼Œä¸ä¼ é€’æ‰€æœ‰æƒ println!(&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;, s1, len);&#125;fn calculate_length(s: &amp;String) -&gt; usize &#123; s.len()&#125; å¼•ç”¨æ˜¯ä¸å¯å˜çš„ï¼Œ&amp; ç¬¦å·å³æ˜¯å¼•ç”¨ï¼Œå®ƒä»¬å…è®¸ä½ ä½¿ç”¨å€¼ï¼Œä½†æ˜¯ä¸è·å–æ‰€æœ‰æƒ å¯å˜å¼•ç”¨1234567fn main() &#123; let mut s = String::from(&quot;hello&quot;); // å¯å˜ç±»å‹ change(&amp;mut s); // å‚æ•°ä¸ºå¯å˜å¼•ç”¨&#125;fn change(some_string: &amp;mut String) &#123; // å£°æ˜å¯å˜å¼•ç”¨å‚æ•° some_string.push_str(&quot;, world&quot;);&#125; å¯å˜å¼•ç”¨æœ‰é™åˆ¶ï¼šåŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼ŒåŒæ—¶ï¼Œå¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨ æ‚¬å‚å¼•ç”¨(Dangling References)æ‚¬å‚å¼•ç”¨ä¹Ÿå«åšæ‚¬å‚æŒ‡é’ˆï¼Œæ„æ€ä¸ºæŒ‡é’ˆæŒ‡å‘æŸä¸ªå€¼åï¼Œè¿™ä¸ªå€¼è¢«é‡Šæ”¾æ‰äº†ï¼Œè€ŒæŒ‡é’ˆä»ç„¶å­˜åœ¨ï¼Œå…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½ä¸å­˜åœ¨ä»»ä½•å€¼æˆ–å·²è¢«å…¶å®ƒå˜é‡é‡æ–°ä½¿ç”¨ å€Ÿç”¨è§„åˆ™æ€»ç»“æ€»çš„æ¥è¯´ï¼Œå€Ÿç”¨è§„åˆ™å¦‚ä¸‹ï¼š åŒä¸€æ—¶åˆ»ï¼Œä½ åªèƒ½æ‹¥æœ‰è¦ä¹ˆä¸€ä¸ªå¯å˜å¼•ç”¨, è¦ä¹ˆä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨ å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ å¤åˆç±»å‹å¤åˆç±»å‹æ˜¯ç”±å…¶å®ƒç±»å‹ç»„åˆè€Œæˆçš„ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ç»“æ„ä½“ struct å’Œæšä¸¾ enum å­—ç¬¦ä¸²ä¸åˆ‡ç‰‡åˆ‡ç‰‡(slice)åˆ‡ç‰‡( slice ) å…è®¸ä½ å¼•ç”¨é›†åˆä¸­éƒ¨åˆ†è¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸æ˜¯å¼•ç”¨æ•´ä¸ªé›†åˆï¼Œå¯¹äºå­—ç¬¦ä¸²è€Œè¨€ï¼Œåˆ‡ç‰‡å°±æ˜¯å¯¹ String ç±»å‹ä¸­æŸä¸€éƒ¨åˆ†çš„å¼•ç”¨ åˆ‡ç‰‡ç±»å‹ï¼š&amp;[T] 1234let s = String::from(&quot;hello world&quot;);let hello = &amp;s[0..5];let world = &amp;s[6..11]; è¿™å°±æ˜¯åˆ›å»ºåˆ‡ç‰‡çš„è¯­æ³•ï¼Œä½¿ç”¨æ–¹æ‹¬å·åŒ…æ‹¬çš„ä¸€ä¸ªåºåˆ—ï¼š[å¼€å§‹ç´¢å¼•..ç»ˆæ­¢ç´¢å¼•]ï¼Œå·¦é—­å³å¼€ï¼Œåœ¨åˆ‡ç‰‡æ•°æ®ç»“æ„å†…éƒ¨ä¼šä¿å­˜å¼€å§‹çš„ä½ç½®å’Œåˆ‡ç‰‡çš„é•¿åº¦ï¼Œå…¶ä¸­é•¿åº¦æ˜¯é€šè¿‡ ç»ˆæ­¢ç´¢å¼• - å¼€å§‹ç´¢å¼• çš„æ–¹å¼è®¡ç®—å¾—æ¥çš„ åœ¨ä½¿ç”¨ Rust çš„ .. range åºåˆ—è¯­æ³•æ—¶ï¼Œå¯ä»¥çœç•¥å¼€å¤´å’Œç»“å°¾&#x20; æ³¨æ„ï¼š åˆ‡ç‰‡çš„ç´¢å¼•å¿…é¡»è½åœ¨å­—ç¬¦ä¹‹é—´çš„è¾¹ç•Œä½ç½®ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·ç¨‹åºå´©æºƒ å› ä¸ºåˆ‡ç‰‡æ˜¯å¯¹é›†åˆçš„éƒ¨åˆ†å¼•ç”¨ï¼Œå› æ­¤ä¸ä»…ä»…å­—ç¬¦ä¸²æœ‰åˆ‡ç‰‡ï¼Œå…¶å®ƒé›†åˆç±»å‹ä¹Ÿæœ‰ï¼Œä¾‹å¦‚æ•°ç»„ï¼š 123let a = [1, 2, 3, 4, 5];let slice = &amp;a[1..3];assert_eq!(slice, &amp;[2, 3]); å­—ç¬¦ä¸²å­—é¢é‡æ˜¯åˆ‡ç‰‡å­—ç¬¦ä¸²å­—é¢é‡çš„ç±»å‹å…¶å®å°±æ˜¯ &amp;str 1let s = &quot;Hello, world!&quot;; // s -&gt; &amp;str è¯¥åˆ‡ç‰‡æŒ‡å‘äº†ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æŸä¸ªç‚¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸º &amp;str æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ 123let mut s = &quot;hello&quot;;s = &quot;world&quot;;//å°±ç®—å£°æ˜ä¸ºmutï¼Œä¹Ÿä¸èƒ½æ”¹å˜ï¼Œè¿™é‡Œæ˜¯é‡æ–°ç»‘å®šäº†ï¼Œä¸å…è®¸s[0] = &#x27;H&#x27;; ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²å­—ç¬¦ä¸²æ˜¯ç”±å­—ç¬¦ç»„æˆçš„è¿ç»­é›†åˆï¼ŒRust ä¸­çš„å­—ç¬¦æ˜¯ Unicode ç±»å‹ï¼Œå› æ­¤æ¯ä¸ªå­—ç¬¦å æ® 4 ä¸ªå­—èŠ‚å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­ä¸ä¸€æ ·ï¼Œå­—ç¬¦ä¸²æ˜¯ UTF-8 ç¼–ç ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ‰€å çš„å­—èŠ‚æ•°æ˜¯å˜åŒ–çš„(1 - 4) å½“ Rust ç”¨æˆ·æåˆ°å­—ç¬¦ä¸²æ—¶ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯ String ç±»å‹å’Œ &amp;str å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹éƒ½æ˜¯ UTF-8 ç¼–ç  é™¤äº† String ç±»å‹çš„å­—ç¬¦ä¸²ï¼ŒRust çš„æ ‡å‡†åº“è¿˜æä¾›äº†å…¶ä»–ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ OsStringï¼Œ OsStrï¼Œ CsString å’Œ CsStr ç­‰ï¼Œæ³¨æ„åˆ°è¿™äº›åå­—éƒ½ä»¥ String æˆ–è€… Str ç»“å°¾äº†å—ï¼Ÿå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯å…·æœ‰æ‰€æœ‰æƒå’Œè¢«å€Ÿç”¨çš„å˜é‡ String ä¸ &amp;str çš„è½¬æ¢ä» &amp;str ç±»å‹ç”Ÿæˆ String ç±»å‹çš„æ“ä½œï¼š String::from(&quot;hello,world&quot;) &quot;hello,world&quot;.to_string() å°† String ç±»å‹è½¬ä¸º &amp;str ç±»å‹ï¼Œå¯ä»¥ç›´æ¥å–å¼•ç”¨ 12345678910fn main() &#123; let s = String::from(&quot;hello,world!&quot;); say_hello(&amp;s); say_hello(&amp;s[..]); say_hello(s.as_str());&#125;fn say_hello(s: &amp;str) &#123; println!(&quot;&#123;&#125;&quot;,s);&#125; å­—ç¬¦ä¸²ç´¢å¼•åœ¨ Rust ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æ–¹å¼è®¿é—®å­—ç¬¦ä¸²çš„æŸä¸ªå­—ç¬¦æˆ–è€…å­ä¸²ï¼Œå­—ç¬¦ä¸²çš„åº•å±‚çš„æ•°æ®å­˜å‚¨æ ¼å¼å®é™…ä¸Šæ˜¯ [ u8 ]ï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªè‹±æ–‡å­—æ¯åœ¨ UTF-8 ç¼–ç ä¸­ä»…å ç”¨ 1 ä¸ªå­—èŠ‚ï¼Œä½†å¤§éƒ¨åˆ†ä¸­æ–‡å  3 ä¸ªå­—èŠ‚ï¼Œè¿™æ ·çš„è®¿é—®å°±ä¼šæŠ¥é”™ã€‚ å­—ç¬¦ä¸²åˆ‡ç‰‡å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯éå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºåˆ‡ç‰‡çš„ç´¢å¼•æ˜¯é€šè¿‡å­—èŠ‚æ¥è¿›è¡Œï¼Œé‡åˆ°ä¸­æ–‡ï¼Œæˆ–å…¶ä»–éè‹±æ–‡å­—ç¬¦ï¼Œå¾ˆå®¹æ˜“æŠ¥é”™å¯¼è‡´ç¨‹åº panic æ“ä½œå­—ç¬¦ä¸² è¿½åŠ  (Push) åœ¨å­—ç¬¦ä¸²å°¾éƒ¨å¯ä»¥ä½¿ç”¨ push() æ–¹æ³•è¿½åŠ å­—ç¬¦ charï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ push_str() æ–¹æ³•è¿½åŠ å­—ç¬¦ä¸²å­—é¢é‡ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯åœ¨åŸæœ‰çš„å­—ç¬¦ä¸²ä¸Šè¿½åŠ ï¼Œå¹¶ä¸ä¼šè¿”å›æ–°çš„å­—ç¬¦ä¸²ã€‚éœ€è¦mutä¿®é¥°ä¸ºå¯å˜ 123let mut s = String::from(&quot;Hello &quot;);s.push_str(&quot;rust&quot;);s.push(&#x27;!&#x27;); æ’å…¥ (Insert) ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ’å…¥çš„ç´¢å¼• 123let mut s = String::from(&quot;Hello rust!&quot;);s.insert(5, &#x27;,&#x27;);s.insert_str(6, &quot; I like&quot;); æ›¿æ¢ (Replace) æŠŠå­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ä¸²æ›¿æ¢æˆå…¶å®ƒçš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ replace() æ–¹æ³•ï¼Œæ›¿æ¢ç›¸å…³çš„æ“ä½œæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š replace è¯¥æ–¹æ³•å¯é€‚ç”¨äº String å’Œ &amp;str ç±»å‹ã€‚replace() æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–°çš„å­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•ä¼šæ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ã€‚ 12345fn main() &#123; let string_replace = String::from(&quot;I like rust. Learning rust is my favorite!&quot;); let new_string_replace = string_replace.replace(&quot;rust&quot;, &quot;RUST&quot;); dbg!(new_string_replace);&#125; replacen è¯¥æ–¹æ³•å¯é€‚ç”¨äº String å’Œ &amp;str ç±»å‹ã€‚replacen() æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªå‚æ•°ä¸ replace() æ–¹æ³•ä¸€æ ·ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™è¡¨ç¤ºæ›¿æ¢çš„ä¸ªæ•°ã€‚è¯¥æ–¹æ³•æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸² 12345fn main() &#123; let string_replace = &quot;I like rust. Learning rust is my favorite!&quot;; let new_string_replacen = string_replace.replacen(&quot;rust&quot;, &quot;RUST&quot;, 1); dbg!(new_string_replacen);&#125; replace_range è¯¥æ–¹æ³•ä»…é€‚ç”¨äº String ç±»å‹ã€‚replace_range æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ›¿æ¢å­—ç¬¦ä¸²çš„èŒƒå›´ï¼ˆRangeï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–°çš„å­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•æ˜¯ç›´æ¥æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šè¿”å›æ–°çš„å­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•éœ€è¦ä½¿ç”¨ mut å…³é”®å­—ä¿®é¥°ã€‚ 12345fn main() &#123; let mut string_replace_range = String::from(&quot;I like rust!&quot;); string_replace_range.replace_range(7..8, &quot;R&quot;); dbg!(string_replace_range);&#125; åˆ é™¤ (Delete) ä¸å­—ç¬¦ä¸²åˆ é™¤ç›¸å…³çš„æ–¹æ³•æœ‰ 4 ä¸ªï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ pop()ï¼Œremove()ï¼Œtruncate()ï¼Œclear()ã€‚è¿™å››ä¸ªæ–¹æ³•ä»…é€‚ç”¨äº String ç±»å‹ pop â€”â€” åˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦ è¯¥æ–¹æ³•æ˜¯ç›´æ¥æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å­˜åœ¨è¿”å›å€¼ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ª Option ç±»å‹ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™è¿”å› None 12345678fn main() &#123; let mut string_pop = String::from(&quot;rust pop ä¸­æ–‡!&quot;); let p1 = string_pop.pop(); let p2 = string_pop.pop(); dbg!(p1); dbg!(p2); dbg!(string_pop);&#125; remove â€”â€” åˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²ä¸­æŒ‡å®šä½ç½®çš„å­—ç¬¦ è¯¥æ–¹æ³•æ˜¯ç›´æ¥æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å­˜åœ¨è¿”å›å€¼ï¼Œå…¶è¿”å›å€¼æ˜¯åˆ é™¤ä½ç½®çš„å­—ç¬¦ä¸²ï¼Œåªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¯¥å­—ç¬¦èµ·å§‹ç´¢å¼•ä½ç½®ã€‚remove() æ–¹æ³•æ˜¯æŒ‰ç…§å­—èŠ‚æ¥å¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå¦‚æœå‚æ•°æ‰€ç»™çš„ä½ç½®ä¸æ˜¯åˆæ³•çš„å­—ç¬¦è¾¹ç•Œï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚ 1234567891011121314 fn main() &#123; let mut string_remove = String::from(&quot;æµ‹è¯•removeæ–¹æ³•&quot;); println!( &quot;string_remove å  &#123;&#125; ä¸ªå­—èŠ‚&quot;, std::mem::size_of_val(string_remove.as_str()) ); // åˆ é™¤ç¬¬ä¸€ä¸ªæ±‰å­— string_remove.remove(0); // ä¸‹é¢ä»£ç ä¼šå‘ç”Ÿé”™è¯¯ // string_remove.remove(1); // ç›´æ¥åˆ é™¤ç¬¬äºŒä¸ªæ±‰å­— // string_remove.remove(3); dbg!(string_remove);&#125; truncate â€”â€” åˆ é™¤å­—ç¬¦ä¸²ä¸­ä»æŒ‡å®šä½ç½®å¼€å§‹åˆ°ç»“å°¾çš„å…¨éƒ¨å­—ç¬¦ è¯¥æ–¹æ³•æ˜¯ç›´æ¥æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ã€‚æ— è¿”å›å€¼ã€‚ truncate() æ–¹æ³•æ˜¯æŒ‰ç…§å­—èŠ‚æ¥å¤„ç†å­—ç¬¦ä¸²çš„ï¼Œå¦‚æœå‚æ•°æ‰€ç»™çš„ä½ç½®ä¸æ˜¯åˆæ³•çš„å­—ç¬¦è¾¹ç•Œï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚ 12345fn main() &#123; let mut string_truncate = String::from(&quot;æµ‹è¯•truncate&quot;); string_truncate.truncate(3); dbg!(string_truncate);&#125; clear â€”â€” æ¸…ç©ºå­—ç¬¦ä¸² è¯¥æ–¹æ³•æ˜¯ç›´æ¥æ“ä½œåŸæ¥çš„å­—ç¬¦ä¸²ã€‚è°ƒç”¨åï¼Œåˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œç›¸å½“äº truncate() æ–¹æ³•å‚æ•°ä¸º 0 çš„æ—¶å€™ 12345fn main() &#123; let mut string_clear = String::from(&quot;string clear&quot;); string_clear.clear(); dbg!(string_clear);&#125; è¿æ¥ (Concatenate) ä½¿ç”¨ + æˆ–è€… += è¿æ¥å­—ç¬¦ä¸² ä½¿ç”¨ + æˆ–è€… += è¿æ¥å­—ç¬¦ä¸²ï¼Œè¦æ±‚å³è¾¹çš„å‚æ•°å¿…é¡»ä¸ºå­—ç¬¦ä¸²çš„åˆ‡ç‰‡å¼•ç”¨ï¼ˆSliceï¼‰ç±»å‹ï¼Œ+ å’Œ += éƒ½æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚æ‰€ä»¥å˜é‡å£°æ˜å¯ä»¥ä¸éœ€è¦ mut å…³é”®å­—ä¿®é¥°ã€‚ 12345678910fn main() &#123; let string_append = String::from(&quot;hello &quot;); let string_rust = String::from(&quot;rust&quot;); // &amp;string_rustä¼šè‡ªåŠ¨è§£å¼•ç”¨ä¸º&amp;str let result = string_append + &amp;string_rust; let mut result = result + &quot;!&quot;; result += &quot;!!!&quot;; println!(&quot;è¿æ¥å­—ç¬¦ä¸² + -&gt; &#123;&#125;&quot;, result);&#125; ä½¿ç”¨ format! è¿æ¥å­—ç¬¦ä¸² format! è¿™ç§æ–¹å¼é€‚ç”¨äº String å’Œ &amp;str 123456fn main() &#123; let s1 = &quot;hello&quot;; let s2 = String::from(&quot;rust&quot;); let s = format!(&quot;&#123;&#125; &#123;&#125;!&quot;, s1, s2); println!(&quot;&#123;&#125;&quot;, s);&#125; å­—ç¬¦ä¸²è½¬ä¹‰æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬ä¹‰çš„æ–¹å¼ \\ è¾“å‡º ASCII å’Œ Unicode å­—ç¬¦ 123456789101112131415161718192021fn main() &#123; // é€šè¿‡ \\ + å­—ç¬¦çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œè½¬ä¹‰è¾“å‡ºä¸€ä¸ªå­—ç¬¦ let byte_escape = &quot;I&#x27;m writing \\x52\\x75\\x73\\x74!&quot;; println!(&quot;What are you doing\\x3F (\\\\x3F means ?) &#123;&#125;&quot;, byte_escape); // \\u å¯ä»¥è¾“å‡ºä¸€ä¸ª unicode å­—ç¬¦ let unicode_codepoint = &quot;\\u&#123;211D&#125;&quot;; let character_name = &quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;; println!( &quot;Unicode character &#123;&#125; (U+211D) is called &#123;&#125;&quot;, unicode_codepoint, character_name ); // æ¢è¡Œäº†ä¹Ÿä¼šä¿æŒä¹‹å‰çš„å­—ç¬¦ä¸²æ ¼å¼ let long_string = &quot;String literals can span multiple lines. The linebreak and indentation here -&gt;\\ &lt;- can be escaped too!&quot;; println!(&quot;&#123;&#125;&quot;, long_string);&#125; å¸Œæœ›ä¿æŒå­—ç¬¦ä¸²çš„åŸæ ·ï¼Œä¸è¦è½¬ä¹‰: 12345678910111213fn main() &#123; println!(&quot;&#123;&#125;&quot;, &quot;hello \\\\x52\\\\x75\\\\x73\\\\x74&quot;); let raw_str = r&quot;Escapes don&#x27;t work here: \\x3F \\u&#123;211D&#125;&quot;; println!(&quot;&#123;&#125;&quot;, raw_str); // å¦‚æœå­—ç¬¦ä¸²åŒ…å«åŒå¼•å·ï¼Œå¯ä»¥åœ¨å¼€å¤´å’Œç»“å°¾åŠ  # let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#; println!(&quot;&#123;&#125;&quot;, quotes); // å¦‚æœè¿˜æ˜¯æœ‰æ­§ä¹‰ï¼Œå¯ä»¥ç»§ç»­å¢åŠ ï¼Œæ²¡æœ‰é™åˆ¶ let longer_delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###; println!(&quot;&#123;&#125;&quot;, longer_delimiter);&#125; æ“ä½œ UTF-8 å­—ç¬¦ä¸² å­—ç¬¦ å¦‚æœä½ æƒ³è¦ä»¥ Unicode å­—ç¬¦çš„æ–¹å¼éå†å­—ç¬¦ä¸²ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ chars æ–¹æ³• 12345678for c in &quot;ä¸­å›½äºº&quot;.chars() &#123; println!(&quot;&#123;&#125;&quot;, c);&#125;/** ä¸­ å›½ äºº*/ å­—èŠ‚ å­—èŠ‚è¿”å›å­—ç¬¦ä¸²çš„åº•å±‚å­—èŠ‚æ•°ç»„è¡¨ç°å½¢å¼ 123456789101112131415for b in &quot;ä¸­å›½äºº&quot;.bytes() &#123; println!(&quot;&#123;&#125;&quot;, b);&#125;/** 228 184 173 229 155 189 228 186 186 */ è·å–å­ä¸² ä» UTF-8 å­—ç¬¦ä¸²ä¸­è·å–å­ä¸²æ˜¯è¾ƒä¸ºå¤æ‚çš„äº‹æƒ…ï¼Œä½¿ç”¨æ ‡å‡†åº“ä½ æ˜¯åšä¸åˆ°çš„ã€‚ ä½ éœ€è¦åœ¨ crates.io ä¸Šæœç´¢ utf8 æ¥å¯»æ‰¾æƒ³è¦çš„åŠŸèƒ½ã€‚å¯ä»¥è€ƒè™‘å°è¯•ä¸‹è¿™ä¸ªåº“ï¼šutf8_sliceã€‚ å…ƒç»„å…ƒç»„æ˜¯ç”±å¤šç§ç±»å‹ç»„åˆåˆ°ä¸€èµ·å½¢æˆçš„ï¼Œå› æ­¤å®ƒæ˜¯å¤åˆç±»å‹ï¼Œå…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå…ƒç»„ä¸­å…ƒç´ çš„é¡ºåºä¹Ÿæ˜¯å›ºå®šçš„ã€‚ 123fn main() &#123; let tup: (i32, f64, u8) = (500, 6.4, 1);&#125; ç”¨æ¨¡å¼åŒ¹é…è§£æ„å…ƒç»„12345fn main() &#123; let tup = (500, 6.4, 1); let (x, y, z) = tup; println!(&quot;The value of y is: &#123;&#125;&quot;, y);&#125; ç”¨ . æ¥è®¿é—®å…ƒç»„å¦‚æœåªæƒ³è¦è®¿é—®æŸä¸ªç‰¹å®šå…ƒç´ ï¼ŒRust æä¾›äº† . çš„è®¿é—®æ–¹å¼ï¼š 123456789fn main() &#123; let x: (i32, f64, u8) = (500, 6.4, 1); let five_hundred = x.0; let six_point_four = x.1; let one = x.2;&#125; å…ƒç»„çš„ç´¢å¼•ä» 0 å¼€å§‹ å…ƒç»„çš„ä½¿ç”¨ç¤ºä¾‹å…ƒç»„åœ¨å‡½æ•°è¿”å›å€¼åœºæ™¯å¾ˆå¸¸ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…ƒç»„è¿”å›å¤šä¸ªå€¼ï¼š 12345678910111213fn main() &#123; let s1 = String::from(&quot;hello&quot;); let (s2, len) = calculate_length(s1); println!(&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;, s2, len);&#125;fn calculate_length(s: String) -&gt; (String, usize) &#123; let length = s.len(); // len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ (s, length)&#125; ç»“æ„ä½“ç»“æ„ä½“ struct æ˜¯ä¸€ç§æ›´é«˜çº§çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”±å…¶å®ƒæ•°æ®ç±»å‹ç»„åˆè€Œæ¥ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„æŠ½è±¡é—®é¢˜ ç»“æ„ä½“è¯­æ³• å®šä¹‰ç»“æ„ä½“ ä¸€ä¸ªç»“æ„ä½“ç”±å‡ éƒ¨åˆ†ç»„æˆï¼š é€šè¿‡å…³é”®å­— struct å®šä¹‰ ä¸€ä¸ªæ¸…æ™°æ˜ç¡®çš„ç»“æ„ä½“ åç§° å‡ ä¸ªæœ‰åå­—çš„ç»“æ„ä½“ å­—æ®µ 123456struct User &#123; active: bool, username: String, email: String, sign_in_count: u64,&#125; åˆ›å»ºç»“æ„ä½“å®ä¾‹ åˆ›å»º User ç»“æ„ä½“çš„å®ä¾‹: 123456let user1 = User &#123; email: String::from(&quot;someone@example.com&quot;), username: String::from(&quot;someusername123&quot;), active: true, sign_in_count: 1,&#125;; æ³¨æ„ï¼š åˆå§‹åŒ–å®ä¾‹æ—¶ï¼Œæ¯ä¸ªå­—æ®µéƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ– åˆå§‹åŒ–æ—¶çš„å­—æ®µé¡ºåºä¸éœ€è¦å’Œç»“æ„ä½“å®šä¹‰æ—¶çš„é¡ºåºä¸€è‡´ è®¿é—®ç»“æ„ä½“å­—æ®µ é€šè¿‡ . æ“ä½œç¬¦å³å¯è®¿é—®ç»“æ„ä½“å®ä¾‹å†…éƒ¨çš„å­—æ®µå€¼ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å®ƒä»¬ï¼š 12345678let mut user1 = User &#123; email: String::from(&quot;someone@example.com&quot;), username: String::from(&quot;someusername123&quot;), active: true, sign_in_count: 1,&#125;;user1.email = String::from(&quot;anotheremail@example.com&quot;); Rust ä¸æ”¯æŒå°†æŸä¸ªç»“æ„ä½“æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜ã€‚ ç®€åŒ–ç»“æ„ä½“åˆ›å»º 12345678fn build_user(email: String, username: String) -&gt; User &#123; User &#123; email: email, username: username, active: true, sign_in_count: 1, &#125;&#125; é€šè¿‡ä¸Šé¢çš„å‡½æ•°æˆ‘ä»¬å¯ä»¥ç®€åŒ–ç»“æ„ä½“å®ä¾‹çš„åˆ›å»ºï¼Œå¦å¤–ï¼Œå‚æ•°ä¹Ÿå¯ä»¥ç®€åŒ–ï¼Œç±»ä¼¼äº TypeScript 12345678fn build_user(email: String, username: String) -&gt; User &#123; User &#123; email, username, active: true, sign_in_count: 1, &#125;&#125; ç»“æ„ä½“æ›´æ–°è¯­æ³• åœ¨å®é™…å¼€å‘åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ä¸€ä¸ªç»“æ„ä½“å®ä¾‹æ¥åˆ›å»ºå¦å¤–ä¸€ä¸ªå®ä¾‹å‘¢? Rust ä¸ºæˆ‘ä»¬æä¾›äº†ç»“æ„ä½“æ›´æ–°è¯­æ³•ï¼š 1234let user2 = User &#123; email: String::from(&quot;another@example.com&quot;), ..user1&#125;; éœ€è¦æ³¨æ„çš„æ˜¯ ..user1 å¿…é¡»åœ¨ç»“æ„ä½“çš„å°¾éƒ¨ä½¿ç”¨ã€‚ ä¸Šé¢çš„æ“ä½œä¼šå¯¼è‡´ user1 ä¸­çš„ username æ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå·²ç»å‘ç”Ÿäº†æ‰€æœ‰æƒè½¬ç§»ï¼Œå…¶ä»–å­—æ®µä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºå…·æœ‰ Copy ç‰¹æ€§è€Œå‘ç”Ÿäº†å€¼æ‹·è´ã€‚æ‰€ä»¥ï¼ŒæŠŠç»“æ„ä½“ä¸­å…·æœ‰æ‰€æœ‰æƒçš„å­—æ®µè½¬ç§»å‡ºå»åï¼Œå°†æ— æ³•å†è®¿é—®è¯¥å­—æ®µï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®å…¶å®ƒçš„å­—æ®µã€‚ å…ƒç»„ç»“æ„ä½“(Tuple Struct)ç»“æ„ä½“å¿…é¡»è¦æœ‰åç§°ï¼Œä½†æ˜¯ç»“æ„ä½“çš„å­—æ®µå¯ä»¥æ²¡æœ‰åç§°ï¼Œè¿™ç§ç»“æ„ä½“é•¿å¾—å¾ˆåƒå…ƒç»„ï¼Œå› æ­¤è¢«ç§°ä¸ºå…ƒç»„ç»“æ„ä½“ï¼Œä¾‹å¦‚ï¼š 12345struct Color(i32, i32, i32);struct Point(i32, i32, i32);let black = Color(0, 0, 0);let origin = Point(0, 0, 0); å•å…ƒç»“æ„ä½“(Unit-like Struct)ä¹‹å‰è®²è¿‡çš„å•¥ä¹Ÿæ²¡æœ‰ç”¨çš„å•å…ƒç±»å‹ï¼Œå•å…ƒç»“æ„ä½“å°±è·Ÿå®ƒå¾ˆåƒï¼Œæ²¡æœ‰ä»»ä½•å­—æ®µå’Œå±æ€§ å¦‚æœä½ å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œä¸”å¹¶ä¸å…³å¿ƒè¯¥ç±»å‹çš„å†…å®¹, åªå…³å¿ƒå®ƒçš„è¡Œä¸ºæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ å•å…ƒç»“æ„ä½“ï¼š 12345678struct AlwaysEqual;let subject = AlwaysEqual;// æˆ‘ä»¬ä¸å…³å¿ƒ AlwaysEqual çš„å­—æ®µæ•°æ®ï¼Œåªå…³å¿ƒå®ƒçš„è¡Œä¸ºï¼Œå› æ­¤å°†å®ƒå£°æ˜ä¸ºå•å…ƒç»“æ„ä½“ï¼Œç„¶åå†ä¸ºå®ƒå®ç°æŸä¸ªç‰¹å¾impl SomeTrait for AlwaysEqual &#123;&#125; ç»“æ„ä½“æ•°æ®çš„æ‰€æœ‰æƒä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ String ç±»å‹è€ŒéåŸºäºå¼•ç”¨çš„ &amp;str ç±»å‹ï¼Œå½“ç„¶ï¼Œç»“æ„ä½“å±æ€§å¯ä»¥å‘å…¶ä»–æ•°æ®æºå€Ÿç”¨æ•°æ®ï¼Œä½†éœ€è¦æ ‡è®°ç”Ÿå‘½å‘¨æœŸã€‚ ä½¿ç”¨ #[derive(Debug)] æ¥æ‰“å°ç»“æ„ä½“çš„ä¿¡æ¯åœ¨ä½¿ç”¨ println!() æ–¹æ³•è¿›è¡Œæ‰“å°æ—¶ï¼Œå ä½ç¬¦ä½¿ç”¨ &#123;&#125; åªèƒ½æ‰“å°ç®€å•ç±»å‹ï¼Œå¦‚æœæƒ³è¦æ‰“å°ç±»ä¼¼ç»“æ„ä½“è¿™ç§ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨ &#123;:?&#125; è¿™æ ·çš„å ä½ç¬¦ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œç»“æ„ä½“æ²¡æœ‰å®ç° Display ç‰¹å¾ï¼Œè€ŒåŸºæœ¬ç±»å‹ï¼Œéƒ½é»˜è®¤å®ç°äº†è¯¥ç‰¹å¾ã€‚ æ‰‹åŠ¨å®ç° Display ç‰¹å¾æ˜æ˜¾ä¸æ˜æ™ºï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ #[derive(Debug)] è¿™æ ·çš„æ´¾ç”Ÿå®ç° 1234567891011121314#[derive(Debug)]struct Rectangle &#123; width: u32, height: u32,&#125;fn main() &#123; let rect1 = Rectangle &#123; width: 30, height: 50, &#125;; println!(&quot;rect1 is &#123;:?&#125;&quot;, rect1);&#125; å¦‚æœç»“æ„ä½“è¶³å¤Ÿå¤æ‚ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰æ›´å¥½çš„è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ &#123;:#?&#125; æ¥æ›¿ä»£ &#123;:?&#125; è¿˜æœ‰ä¸€ä¸ªç®€å•çš„è¾“å‡º debug ä¿¡æ¯çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ dbg! å®ï¼Œå®ƒä¼šæ‹¿èµ°è¡¨è¾¾å¼çš„æ‰€æœ‰æƒï¼Œç„¶åæ‰“å°å‡ºç›¸åº”çš„æ–‡ä»¶åã€è¡Œå·ç­‰ debug ä¿¡æ¯ï¼Œå½“ç„¶è¿˜æœ‰æˆ‘ä»¬éœ€è¦çš„è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒæœ€ç»ˆè¿˜ä¼šæŠŠè¡¨è¾¾å¼å€¼çš„æ‰€æœ‰æƒè¿”å›ï¼ 1234567891011121314151617181920212223#[derive(Debug)]struct Rectangle &#123; width: u32, height: u32,&#125;fn main() &#123; let scale = 2; let rect1 = Rectangle &#123; width: dbg!(30 * scale), height: 50, &#125;; dbg!(&amp;rect1);&#125;/** $ cargo run [src/main.rs:10] 30 * scale = 60 [src/main.rs:14] &amp;rect1 = Rectangle &#123; width: 60, height: 50, &#125; */ æšä¸¾æšä¸¾(enum æˆ– enumeration)å…è®¸ä½ é€šè¿‡åˆ—ä¸¾å¯èƒ½çš„æˆå‘˜æ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæšä¸¾ç±»å‹æ˜¯ä¸€ä¸ªç±»å‹ï¼Œå®ƒä¼šåŒ…å«æ‰€æœ‰å¯èƒ½çš„æšä¸¾æˆå‘˜, è€Œæšä¸¾å€¼æ˜¯è¯¥ç±»å‹ä¸­çš„å…·ä½“æŸä¸ªæˆå‘˜çš„å®ä¾‹ã€‚ 123456enum PokerSuit &#123; Clubs, Spades, Diamonds, Hearts,&#125; æšä¸¾å€¼æˆ‘ä»¬æ¥åˆ›å»ºæšä¸¾ç±»å‹çš„æˆå‘˜å®ä¾‹ï¼š 12let heart = PokerSuit::Hearts;let diamond = PokerSuit::Diamonds; é€šè¿‡ :: æ“ä½œç¬¦æ¥è®¿é—® PokerSuit ä¸‹çš„å…·ä½“æˆå‘˜ 1234567891011fn main() &#123; let heart = PokerSuit::Hearts; let diamond = PokerSuit::Diamonds; print_suit(heart); print_suit(diamond);&#125;fn print_suit(card: PokerSuit) &#123; println!(&quot;&#123;:?&#125;&quot;,card);&#125; é‚£å¦‚ä½•ä¸ºæšä¸¾æ·»åŠ æšä¸¾å€¼å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ struct æ¥è¡¨ç¤ºï¼Œä½† Rust æä¾›äº†æ›´ä¼˜é›…çš„æ–¹å¼ 1234567891011enum PokerCard &#123; Clubs(u8), Spades(u8), Diamonds(u8), Hearts(u8),&#125;fn main() &#123; let c1 = PokerCard::Spades(5); let c2 = PokerCard::Diamonds(13);&#125; æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†æ•°æ®ä¿¡æ¯å…³è”åˆ°æšä¸¾æˆå‘˜ä¸Šï¼Œä¸ä»…å¦‚æ­¤ï¼ŒåŒä¸€ä¸ªæšä¸¾ç±»å‹ä¸‹çš„ä¸åŒæˆå‘˜è¿˜èƒ½æŒæœ‰ä¸åŒçš„æ•°æ®ç±»å‹ 1234567891011enum PokerCard &#123; Clubs(u8), Spades(u8), Diamonds(char), Hearts(char),&#125;fn main() &#123; let c1 = PokerCard::Spades(5); let c2 = PokerCard::Diamonds(&#x27;A&#x27;);&#125; Rust æ ‡å‡†åº“ä¸­è¡¨ç¤º IP åœ°å€çš„æšä¸¾è¿™æ ·å®šä¹‰ï¼š 123456789101112struct Ipv4Addr &#123; // --snip--&#125;struct Ipv6Addr &#123; // --snip--&#125;enum IpAddr &#123; V4(Ipv4Addr), V6(Ipv6Addr),&#125; å¯ä»¥çœ‹å‡ºï¼Œä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥æšä¸¾æˆå‘˜ä¸­: ä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å€¼ã€ç»“æ„ä½“ç”šè‡³å¦ä¸€ä¸ªæšä¸¾ã€‚ åŒä¸€åŒ–ç±»å‹1234enum Websocket &#123; Tcp(Websocket&lt;TcpStream&gt;), Tls(Websocket&lt;native_tls::TlsStream&lt;TcpStream&gt;&gt;),&#125; ä½¿ç”¨æšä¸¾å®šä¹‰äº†ä¸¤ç§ä¸åŒçš„é•¿è¿æ¥æ–¹å¼ Option æšä¸¾ç”¨äºå¤„ç†ç©ºå€¼åœ¨ Rust ä¸­ï¼Œæ²¡æœ‰å…¶ä»–è¯­è¨€ä¸­çš„ null å€¼ï¼Œè€Œæ”¹ä¸ºä½¿ç”¨ Option æšä¸¾å˜é‡æ¥è¡¨è¿°è¿™ç§ç»“æœ Option æšä¸¾åŒ…å«ä¸¤ä¸ªæˆå‘˜ï¼Œä¸€ä¸ªæˆå‘˜è¡¨ç¤ºå«æœ‰å€¼ï¼šSome(T), å¦ä¸€ä¸ªè¡¨ç¤ºæ²¡æœ‰å€¼ï¼šNone 1234enum Option&lt;T&gt; &#123; Some(T), None,&#125; æ•°ç»„åœ¨ Rust ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ•°ç»„æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯é•¿åº¦å›ºå®šçš„ array(æ•°ç»„)ï¼Œç¬¬äºŒç§æ˜¯å¯åŠ¨æ€å¢é•¿çš„ä½†æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ Vector(åŠ¨æ€æ•°ç»„)ã€‚ String å’Œ Vector åœ¨ Rust ä¸­éƒ½æ˜¯é«˜çº§ç±»å‹ï¼šé›†åˆç±»å‹ã€‚ åˆ›å»ºæ•°ç»„åœ¨ Rust ä¸­ï¼Œæ•°ç»„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š 123fn main() &#123; let a = [1, 2, 3, 4, 5];&#125; æ•°ç»„ Array å…ƒç´ ç±»å‹å¤§å°å›ºå®šï¼Œä¸”é•¿åº¦ä¹Ÿæ˜¯å›ºå®šï¼Œå› æ­¤å­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ€§èƒ½ä¹Ÿä¼šéå¸¸ä¼˜ç§€ã€‚åŠ¨æ€æ•°ç»„ Vector æ˜¯å­˜å‚¨åœ¨å †ä¸Šï¼Œå› æ­¤é•¿åº¦å¯ä»¥åŠ¨æ€æ”¹å˜ã€‚å½“ä½ ä¸ç¡®å®šæ˜¯ä½¿ç”¨æ•°ç»„è¿˜æ˜¯åŠ¨æ€æ•°ç»„æ—¶ï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨åè€… 123// æœˆä»½æ˜¯å›ºå®šçš„ï¼Œè¿™é‡Œä½¿ç”¨ Arraylet months = [&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;]; ä¸ºæ•°ç»„å£°æ˜ç±»å‹ï¼š 1let a: [i32; 5] = [1, 2, 3, 4, 5]; è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•åˆå§‹åŒ–ä¸€ä¸ªæŸä¸ªå€¼é‡å¤å‡ºç° N æ¬¡çš„æ•°ç»„ï¼š 1let a = [3; 5]; è®¿é—®æ•°ç»„å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•çš„æ–¹å¼æ¥è®¿é—®å­˜æ”¾å…¶ä¸­çš„å…ƒç´ ï¼š 12345fn main() &#123; let a = [9, 8, 7, 6, 5]; let first = a[0]; // è·å–aæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  let second = a[1]; // è·å–ç¬¬äºŒä¸ªå…ƒç´ &#125; å¦‚æœä½¿ç”¨è¶…å‡ºæ•°ç»„èŒƒå›´çš„ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ , åˆ™ä¼šè®¿é—®åˆ°ä¸å­˜åœ¨çš„æ•°ç»„å…ƒç´ ï¼Œæœ€ç»ˆç¨‹åºä¼šå´©æºƒé€€å‡ºï¼š 123456789101112use std::io;fn main() &#123; let a = [1, 2, 3, 4, 5]; println!(&quot;Please enter an array index.&quot;); let mut index = String::new(); // è¯»å–æ§åˆ¶å°çš„è¾“å‡º io::stdin().read_line(&amp;mut index).expect(&quot;Failed to read line&quot;); let index: usize = index.trim().parse().expect(&quot;Index entered was not a number&quot;); let element = a[index]; println!( &quot;The value of the element at index &#123;&#125; is: &#123;&#125;&quot;,index, element);&#125; å½“ä½ å°è¯•ä½¿ç”¨ç´¢å¼•è®¿é—®å…ƒç´ æ—¶ï¼ŒRust å°†æ£€æŸ¥ä½ æŒ‡å®šçš„ç´¢å¼•æ˜¯å¦å°äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœç´¢å¼•å¤§äºæˆ–ç­‰äºæ•°ç»„é•¿åº¦ï¼ŒRust ä¼šå‡ºç° panicã€‚è¿™ç§æ£€æŸ¥åªèƒ½åœ¨è¿è¡Œæ—¶è¿›è¡Œ åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœæ•°ç»„å…ƒç´ æ˜¯éåŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚ï¼š 12let array = [String::from(&quot;rust is good!&quot;); 8];println!(&quot;&#123;:#?&#125;&quot;, array); æ­¤æ—¶ä½ ä¼šå¾—åˆ°ä¸€æ®µé”™è¯¯ï¼Œå› ä¸ºå¤æ‚ç±»å‹æ²¡æœ‰å®ç° Copy ç‰¹å¾ï¼Œæ‰€ä»¥åœ¨æ•°ç»„å…ƒç´ æ˜¯å¤æ‚ç±»å‹æ—¶ï¼Œæ­£ç¡®çš„å†™æ³•ï¼Œåº”è¯¥è°ƒç”¨ std::array::from_fn 12let array: [String; 8] = core::array::from_fn(|i| String::from(&quot;rust is good!&quot;));println!(&quot;&#123;:#?&#125;&quot;, array); æ•°ç»„åˆ‡ç‰‡åˆ‡ç‰‡å…è®¸ä½ å¼•ç”¨é›†åˆä¸­çš„éƒ¨åˆ†è¿ç»­ç‰‡æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªé›†åˆï¼Œå¯¹äºæ•°ç»„ä¹Ÿæ˜¯ï¼Œæ•°ç»„åˆ‡ç‰‡å…è®¸æˆ‘ä»¬å¼•ç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ† 123let a: [i32; 5] = [1, 2, 3, 4, 5];let slice: &amp;[i32] = &amp;a[1..3];assert_eq!(slice, &amp;[2, 3]); æµç¨‹æ§åˆ¶ä½¿ç”¨ if æ¥åšåˆ†æ”¯æ§åˆ¶if else è¡¨è¾¾å¼æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯ï¼š 12345if condition == true &#123; // A...&#125; else &#123; // B...&#125; if è¯­å¥å—æ˜¯è¡¨è¾¾å¼ ç”¨ if æ¥èµ‹å€¼æ—¶ï¼Œè¦ä¿è¯æ¯ä¸ªåˆ†æ”¯è¿”å›çš„ç±»å‹ä¸€æ · 12345678910fn main() &#123; let condition = true; let number = if condition &#123; 5 &#125; else &#123; 6 &#125;; println!(&quot;The value of number is: &#123;&#125;&quot;, number);&#125; ä½¿ç”¨ else if æ¥å¤„ç†å¤šé‡æ¡ä»¶12345678910111213fn main() &#123; let n = 6; if n % 4 == 0 &#123; println!(&quot;number is divisible by 4&quot;); &#125; else if n % 3 == 0 &#123; println!(&quot;number is divisible by 3&quot;); &#125; else if n % 2 == 0 &#123; println!(&quot;number is divisible by 2&quot;); &#125; else &#123; println!(&quot;number is not divisible by 4, 3, or 2&quot;); &#125;&#125; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ match ä¸“é—¨ç”¨ä»¥è§£å†³å¤šåˆ†æ”¯æ¨¡å¼åŒ¹é…çš„é—®é¢˜ å¾ªç¯æ§åˆ¶åœ¨ Rust è¯­è¨€ä¸­æœ‰ä¸‰ç§å¾ªç¯æ–¹å¼ï¼šforã€while å’Œ loop for å¾ªç¯12345fn main() &#123; for i in 1..=5 &#123; println!(&quot;&#123;&#125;&quot;, i); &#125;&#125; æ³¨æ„ï¼Œä½¿ç”¨ for æ—¶æˆ‘ä»¬å¾€å¾€ä½¿ç”¨é›†åˆçš„å¼•ç”¨å½¢å¼ï¼Œé™¤éä½ ä¸æƒ³åœ¨åé¢çš„ä»£ç ä¸­ç»§ç»­ä½¿ç”¨è¯¥é›†åˆã€‚å¯¹äºå®ç°äº† copy ç‰¹å¾çš„æ•°ç»„ï¼Œå¾ªç¯ä½“çš„æ‰€æœ‰æƒå¹¶ä¸ä¼šè½¬ç§» 123for item in &amp;container &#123; // ...&#125; å¦‚æœæƒ³åœ¨å¾ªç¯ä¸­ï¼Œä¿®æ”¹è¯¥å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ mut å…³é”®å­—ï¼š 123for item in &amp;mut collection &#123; // ...&#125; æ€»ç»“ï¼š ä½¿ç”¨æ–¹æ³• ç­‰ä»·ä½¿ç”¨æ–¹å¼ æ‰€æœ‰æƒ for item in collection for item in IntoIterator::into_iter(collection) è½¬ç§»æ‰€æœ‰æƒ for item in &amp;collection for item in collection.iter() ä¸å¯å˜å€Ÿç”¨ for item in &amp;mut collection for item in collection.iter_mut() å¯å˜å€Ÿç”¨ å¦‚æœæƒ³åœ¨å¾ªç¯ä¸­è·å–å…ƒç´ çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ iter()ï¼š 1234567fn main() &#123; let a = [4, 3, 2, 1]; // `.iter()` æ–¹æ³•æŠŠ `a` æ•°ç»„å˜æˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œenumerateç»™è¿­ä»£å™¨é…ç´¢å¼• for (i, v) in a.iter().enumerate() &#123; println!(&quot;ç¬¬&#123;&#125;ä¸ªå…ƒç´ æ˜¯&#123;&#125;&quot;, i + 1, v); &#125;&#125; ä»…ä»…å¾ªç¯å¤šæ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ _ 123for _ in 0..10 &#123; // ...&#125; åœ¨ Rust ä¸­ _ çš„å«ä¹‰æ˜¯å¿½ç•¥è¯¥å€¼æˆ–è€…ç±»å‹çš„æ„æ€ï¼Œå¦‚æœä¸ä½¿ç”¨ _ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šç»™ä½ ä¸€ä¸ªå˜é‡æœªä½¿ç”¨çš„è­¦å‘Š æ¥çœ‹ä¸‹é¢è¿™ä¸¤ç§å¾ªç¯çš„æ–¹å¼ï¼š 1234567891011// ç¬¬ä¸€ç§let collection = [1, 2, 3, 4, 5];for i in 0..collection.len() &#123; let item = collection[i]; // ...&#125;// ç¬¬äºŒç§for item in collection &#123;&#125; ç¬¬ä¸€ç§æ–¹å¼å› ä¸ºéœ€è¦æ•°ç»„é•¿åº¦ï¼Œæ‰€æœ‰å­˜åœ¨è¾¹ç•Œæ£€æŸ¥æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¸”è®¿é—®å¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œå¾ªç¯ä½“å‘ç”Ÿå˜åŒ–åˆ™ä¼šäº§ç”Ÿè„æ•°æ®ï¼Œè€Œç¬¬äºŒç§ä¸å­˜åœ¨è¿™äº›é—®é¢˜ã€‚ ç”±äº for å¾ªç¯æ— éœ€ä»»ä½•æ¡ä»¶é™åˆ¶ï¼Œä¹Ÿä¸éœ€è¦é€šè¿‡ç´¢å¼•æ¥è®¿é—®ï¼Œå› æ­¤æ˜¯æœ€å®‰å…¨ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ ä½¿ç”¨ continue å¯ä»¥è·³è¿‡å½“å‰å½“æ¬¡çš„å¾ªç¯ï¼Œå¼€å§‹ä¸‹æ¬¡çš„å¾ªç¯ï¼š ä½¿ç”¨ break å¯ä»¥ç›´æ¥è·³å‡ºå½“å‰æ•´ä¸ªå¾ªç¯ï¼š while å¾ªç¯12345678fn main() &#123; let mut n = 0; while n &lt;= 5 &#123; println!(&quot;&#123;&#125;!&quot;, n); n = n + 1; &#125; println!(&quot;æˆ‘å‡ºæ¥äº†ï¼&quot;);&#125; ä½¿ç”¨ wihle å¾ªç¯åŒæ ·èƒ½æ¨¡æ‹Ÿ for å¾ªç¯ï¼Œ ä½† for å¾ªç¯å¹¶ä¸ä¼šä½¿ç”¨ç´¢å¼•å»è®¿é—®æ•°ç»„ï¼Œå› æ­¤æ›´å®‰å…¨ä¹Ÿæ›´ç®€æ´ï¼ŒåŒæ—¶é¿å…è¿è¡Œæ—¶çš„è¾¹ç•Œæ£€æŸ¥ï¼Œæ€§èƒ½æ›´é«˜ã€‚ loop å¾ªç¯123456fn main() &#123; loop &#123; println!(&quot;again!&quot;); &#125;&#125;// æ­»å¾ªç¯... å½“ä½¿ç”¨ loop æ—¶ï¼Œå¿…ä¸å¯å°‘çš„ä¼™ä¼´æ˜¯ break å…³é”®å­—ï¼Œå®ƒèƒ½è®©å¾ªç¯åœ¨æ»¡è¶³æŸä¸ªæ¡ä»¶æ—¶è·³å‡ºï¼š æ¨¡å¼åŒ¹é…æ¨¡å¼åŒ¹é…ç»å¸¸å‡ºç°åœ¨å‡½æ•°å¼ç¼–ç¨‹é‡Œï¼Œç”¨äºä¸ºå¤æ‚çš„ç±»å‹ç³»ç»Ÿæä¾›ä¸€ä¸ªè½»æ¾çš„è§£æ„èƒ½åŠ›ã€‚ match å’Œ if letåœ¨ Rust ä¸­ï¼Œæ¨¡å¼åŒ¹é…æœ€å¸¸ç”¨çš„å°±æ˜¯ match å’Œ if let matchå…ˆæ¥çœ‹ä¸€ä¸ªå…³äº match çš„ç®€å•ä¾‹å­ï¼š 12345678910111213141516enum Direction &#123; East, West, North, South,&#125;fn main() &#123; let dire = Direction::South; match dire &#123; Direction::East =&gt; println!(&quot;East&quot;), Direction::North | Direction::South =&gt; &#123; println!(&quot;South or North&quot;); &#125;, _ =&gt; println!(&quot;West&quot;), &#125;;&#125; match çš„åŒ¹é…å¿…é¡»è¦ç©·ä¸¾å‡ºæ‰€æœ‰å¯èƒ½ï¼Œå› æ­¤è¿™é‡Œç”¨ _ æ¥ä»£è¡¨æœªåˆ—å‡ºçš„æ‰€æœ‰å¯èƒ½æ€§ match çš„æ¯ä¸€ä¸ªåˆ†æ”¯éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸”æ‰€æœ‰åˆ†æ”¯çš„è¡¨è¾¾å¼æœ€ç»ˆè¿”å›å€¼çš„ç±»å‹å¿…é¡»ç›¸åŒ X | Yï¼Œç±»ä¼¼é€»è¾‘è¿ç®—ç¬¦ æˆ–ï¼Œä»£è¡¨è¯¥åˆ†æ”¯å¯ä»¥åŒ¹é… X ä¹Ÿå¯ä»¥åŒ¹é… Yï¼Œåªè¦æ»¡è¶³ä¸€ä¸ªå³å¯ match çš„é€šç”¨å½¢å¼: 123456789match target &#123; æ¨¡å¼1 =&gt; è¡¨è¾¾å¼1, æ¨¡å¼2 =&gt; &#123; è¯­å¥1; è¯­å¥2; è¡¨è¾¾å¼2 &#125;, _ =&gt; è¡¨è¾¾å¼3&#125; match æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› æ­¤å¯ä»¥ç”¨å®ƒæ¥èµ‹å€¼ï¼š 12345678910111213enum IpAddr &#123; Ipv4, Ipv6&#125;fn main() &#123; let ip1 = IpAddr::Ipv6; let ip_str = match ip1 &#123; IpAddr::Ipv4 =&gt; &quot;127.0.0.1&quot;, _ =&gt; &quot;::1&quot;, &#125;; println!(&quot;&#123;&#125;&quot;, ip_str);&#125; æ¨¡å¼åŒ¹é…çš„å¦å¤–ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯ä»æ¨¡å¼ä¸­å–å‡ºç»‘å®šçš„å€¼ï¼Œä¾‹å¦‚ï¼šå–å‡ºQuarterç»‘å®šçš„å€¼UsState 12345678910111213141516171819202122232425#[derive(Debug)]enum UsState &#123; Alabama, Alaska, // --snip--&#125;enum Coin &#123; Penny, Nickel, Dime, Quarter(UsState), // 25ç¾åˆ†ç¡¬å¸&#125;fn value_in_cents(coin: Coin) -&gt; u8 &#123; match coin &#123; Coin::Penny =&gt; 1, Coin::Nickel =&gt; 5, Coin::Dime =&gt; 10, Coin::Quarter(state) =&gt; &#123; println!(&quot;State quarter from &#123;:?&#125;!&quot;, state); 25 &#125;, &#125;&#125; match çš„åŒ¹é…å¿…é¡»ç©·å°½æ‰€æœ‰æƒ…å†µï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå½“æˆ‘ä»¬ä¸æƒ³åœ¨åŒ¹é…æ—¶åˆ—å‡ºæ‰€æœ‰å€¼çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ Rust æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæ¨¡å¼ _ æ›¿ä»£ if let åŒ¹é…å¦‚æœåªæœ‰ä¸€ä¸ªæ¨¡å¼çš„å€¼éœ€è¦è¢«å¤„ç†ï¼Œå…¶å®ƒå€¼ç›´æ¥å¿½ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ if let çš„æ–¹å¼æ¥å®ç°ï¼š 123if let Some(3) = v &#123; println!(&quot;three&quot;);&#125; å½“ä½ åªè¦åŒ¹é…ä¸€ä¸ªæ¡ä»¶ï¼Œä¸”å¿½ç•¥å…¶ä»–æ¡ä»¶æ—¶å°±ç”¨ if let ï¼Œå¦åˆ™éƒ½ç”¨ match matches!å®Rust æ ‡å‡†åº“ä¸­æä¾›äº†ä¸€ä¸ªéå¸¸å®ç”¨çš„å®ï¼šmatches!ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªè¡¨è¾¾å¼è·Ÿæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œç„¶åè¿”å›åŒ¹é…çš„ç»“æœ 12345678enum MyEnum &#123; Foo, Bar&#125;fn main() &#123; let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];&#125; ä½¿ç”¨ matches! å®åŒ¹é… MyEnum::Foo 123v.iter().filter(|x| matches!(x, MyEnum::Foo));//åŒ¹é…xï¼Œæ˜¯å¦ä¸ºFooï¼Œmatchesè¿”å›trueæˆ–false//filterç­›é€‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ å¹¶è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ è§£æ„ OptionOption æšä¸¾ç”¨æ¥è§£å†³ Rust ä¸­å˜é‡æ˜¯å¦æœ‰å€¼çš„é—®é¢˜ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 1234enum Option&lt;T&gt; &#123; Some(T), None,&#125; ä¸€ä¸ªå˜é‡è¦ä¹ˆæœ‰å€¼ï¼šSome(T), è¦ä¹ˆä¸ºç©ºï¼šNone 123456789fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; &#123; match x &#123; None =&gt; None, Some(i) =&gt; Some(i + 1), &#125;&#125;let five = Some(5);let six = plus_one(five);let none = plus_one(None); æ¨¡å¼é€‚ç”¨åœºæ™¯ while let æ¡ä»¶å¾ªç¯ while let å…è®¸åªè¦æ¨¡å¼åŒ¹é…å°±ä¸€ç›´è¿›è¡Œ while å¾ªç¯ 123456789let mut stack = Vec::new();// å‘æ•°ç»„å°¾éƒ¨æ’å…¥å…ƒç´ stack.push(1);stack.push(2);stack.push(3);// stack.popä»æ•°ç»„å°¾éƒ¨å¼¹å‡ºå…ƒç´ while let Some(top) = stack.pop() &#123; println!(&quot;&#123;&#125;&quot;, top);&#125; for å¾ªç¯ 1234let v = vec![&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;];for (index, value) in v.iter().enumerate() &#123; println!(&quot;&#123;&#125; is at index &#123;&#125;&quot;, value, index);&#125; let è¯­å¥ æ˜¯çš„ï¼Œ è¯¥è¯­å¥æˆ‘ä»¬å·²ç»ç”¨äº†æ— æ•°æ¬¡äº†ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…ï¼š 1let PATTERN = EXPRESSION; å‡½æ•°å‚æ•° å‡½æ•°å‚æ•°ä¹Ÿæ˜¯æ¨¡å¼ï¼š 123fn foo(x: i32) &#123; // ä»£ç &#125; å…¨æ¨¡å¼åˆ—è¡¨ åŒ¹é…å­—é¢å€¼ 1234567let x = 1;match x &#123; 1 =&gt; println!(&quot;one&quot;), 2 =&gt; println!(&quot;two&quot;), 3 =&gt; println!(&quot;three&quot;), _ =&gt; println!(&quot;anything&quot;),&#125; åŒ¹é…å‘½åå˜é‡ åŒ¹é…å‘½åå˜é‡æ—¶ä¼šé‡åˆ°å˜é‡è¦†ç›–çš„é—®é¢˜ 12345678910fn main() &#123; let x = Some(5); let y = 10; match x &#123; Some(50) =&gt; println!(&quot;Got 50&quot;), Some(y) =&gt; println!(&quot;Matched, y = &#123;:?&#125;&quot;, y), // è¿™ä¸ªyæ˜¯æ–°çš„ç»‘å®šä¼šåŒ¹é…ä»»ä½•Someä¸­çš„å€¼ï¼Œåœ¨è¿™é‡Œæ˜¯ x ä¸­çš„å€¼ä¸º5 _ =&gt; println!(&quot;Default case, x = &#123;:?&#125;&quot;, x), &#125; println!(&quot;at the end: x = &#123;:?&#125;, y = &#123;:?&#125;&quot;, x, y);&#125; å•åˆ†æ”¯å¤šæ¨¡å¼ åœ¨ match è¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ | è¯­æ³•åŒ¹é…å¤šä¸ªæ¨¡å¼ï¼Œå®ƒä»£è¡¨ æˆ–çš„æ„æ€ é€šè¿‡åºåˆ— ..= åŒ¹é…å€¼çš„èŒƒå›´ ..= è¯­æ³•å…è®¸ä½ åŒ¹é…ä¸€ä¸ªé—­åŒºé—´åºåˆ—å†…çš„å€¼ 12345let x = 5;match x &#123; 1..=5 =&gt; println!(&quot;one through five&quot;), _ =&gt; println!(&quot;something else&quot;),&#125; è§£æ„å¹¶åˆ†è§£å€¼ ä½¿ç”¨æ¨¡å¼æ¥è§£æ„ç»“æ„ä½“ã€æšä¸¾ã€å…ƒç»„ã€æ•°ç»„å’Œå¼•ç”¨ 123456789101112// è§£æ„ç»“æ„ä½“struct Point &#123; x: i32, y: i32,&#125;fn main() &#123; let p = Point &#123; x: 0, y: 7 &#125;; let Point &#123; x: a, y: b &#125; = p; assert_eq!(0, a); assert_eq!(7, b);&#125; 12345678910111213141516// è§£æ„æšä¸¾enum Message &#123; Quit, Move &#123; x: i32, y: i32 &#125;, Write(String), ChangeColor(i32, i32, i32),&#125;fn main() &#123; let msg = Message::ChangeColor(0, 160, 255); match msg &#123; Message::Quit =&gt; &#123;println!(&quot;The Quit variant has no data to destructure.&quot;)&#125; Message::Move &#123; x, y &#125; =&gt; &#123;println!(&quot;Move in the x direction &#123;&#125; and in the y direction &#123;&#125;&quot;,x,y);&#125; Message::Write(text) =&gt; println!(&quot;Text message: &#123;&#125;&quot;, text), Message::ChangeColor(r, g, b) =&gt; &#123;println!(&quot;Change the color to red &#123;&#125;, green &#123;&#125;, and blue &#123;&#125;&quot;,r,g,b)&#125; &#125;&#125; 12345678910111213141516171819// è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾enum Color &#123; Rgb(i32, i32, i32), Hsv(i32, i32, i32),&#125;enum Message &#123; Quit, Move &#123; x: i32, y: i32 &#125;, Write(String), ChangeColor(Color),&#125;fn main() &#123; let msg = Message::ChangeColor(Color::Hsv(0, 160, 255)); match msg &#123; Message::ChangeColor(Color::Rgb(r, g, b)) =&gt; &#123;println!(&quot;Change the color to red &#123;&#125;, green &#123;&#125;, and blue &#123;&#125;&quot;,r,g,b)&#125; Message::ChangeColor(Color::Hsv(h, s, v)) =&gt; &#123;println!(&quot;Change the color to hue &#123;&#125;, saturation &#123;&#125;, and value &#123;&#125;&quot;,h,s,v)&#125; _ =&gt; () &#125;&#125; 123456// è§£æ„ç»“æ„ä½“å’Œå…ƒç»„struct Point &#123; x: i32, y: i32,&#125;let ((feet, inches), Point &#123;x, y&#125;) = ((3, 10), Point &#123; x: 3, y: -10 &#125;); 1234567891011121314151617// è§£æ„å®šé•¿æ•°ç»„let arr: [u16; 2] = [114, 514];let [x, y] = arr;assert_eq!(x, 114);assert_eq!(y, 514);// è§£æ„ä¸å®šé•¿æ•°ç»„let arr: &amp;[u16] = &amp;[114, 514];//arråˆ‡ç‰‡å¼•ç”¨æœ‰ä¸¤ä¸ªç±»å‹ä¸ºu16çš„æ•°ç»„if let [x, ..] = arr &#123;//xåŒ¹é…ä¸ºarrçš„ç¬¬ä¸€ä¸ªå…ƒç´  assert_eq!(x, &amp;114);&#125;if let &amp;[.., y] = arr &#123; assert_eq!(y, 514);&#125;let arr: &amp;[u16] = &amp;[];assert!(matches!(arr, [..]));assert!(!matches!(arr, [x, ..])); 123456789101112131415161718192021222324252627282930// ä½¿ç”¨ _ å¿½ç•¥æ•´ä¸ªå€¼fn foo(_: i32, y: i32) &#123; println!(&quot;This code only uses the y parameter: &#123;&#125;&quot;, y);&#125;fn main() &#123; foo(3, 4);&#125;// ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡fn main() &#123; let _x = 5; let y = 10;&#125;// ç”¨ .. å¿½ç•¥å‰©ä½™å€¼struct Point &#123; x: i32, y: i32, z: i32,&#125;let origin = Point &#123; x: 0, y: 0, z: 0 &#125;;match origin &#123; Point &#123; x, .. &#125; =&gt; println!(&quot;x is &#123;&#125;&quot;, x),&#125;// åŒ¹é…å®ˆå«æä¾›çš„é¢å¤–æ¡ä»¶let num = Some(4);match num &#123; Some(x) if x &lt; 5 =&gt; println!(&quot;less than five: &#123;&#125;&quot;, x), Some(x) =&gt; println!(&quot;&#123;&#125;&quot;, x), None =&gt; (),&#125; @ç»‘å®š @ï¼ˆè¯»ä½œ atï¼‰è¿ç®—ç¬¦å…è®¸ä¸ºä¸€ä¸ªå­—æ®µç»‘å®šå¦å¤–ä¸€ä¸ªå˜é‡ 123456789enum Message &#123; Hello &#123; id: i32 &#125;,&#125;let msg = Message::Hello &#123; id: 5 &#125;;match msg &#123; Message::Hello &#123; id: id_variable @ 3..=7 &#125; =&gt; &#123;println!(&quot;Found an id in range: &#123;&#125;&quot;, id_variable)&#125;,//æŠŠidçš„å€¼ç»‘å®šåˆ°id_variableä¸Š Message::Hello &#123; id: 10..=12 &#125; =&gt; &#123;println!(&quot;Found an id in another range&quot;)&#125;, Message::Hello &#123; id &#125; =&gt; &#123;println!(&quot;Found some other id: &#123;&#125;&quot;, id)&#125;,&#125; æ–¹æ³• MethodRust çš„æ–¹æ³•å¾€å¾€è·Ÿç»“æ„ä½“ã€æšä¸¾ã€ç‰¹å¾(Trait)ä¸€èµ·ä½¿ç”¨ å®šä¹‰æ–¹æ³•Rust ä½¿ç”¨ impl æ¥å®šä¹‰æ–¹æ³• 12345678910111213141516171819202122struct Circle &#123; x: f64, y: f64, radius: f64,&#125;impl Circle &#123; // newæ˜¯Circleçš„å…³è”å‡½æ•°ï¼Œå› ä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯selfï¼Œä¸”newå¹¶ä¸æ˜¯å…³é”®å­— // è¿™ç§æ–¹æ³•å¾€å¾€ç”¨äºåˆå§‹åŒ–å½“å‰ç»“æ„ä½“çš„å®ä¾‹ fn new(x: f64, y: f64, radius: f64) -&gt; Circle &#123; Circle &#123; x: x, y: y, radius: radius, &#125; &#125; // Circleçš„æ–¹æ³•ï¼Œ&amp;selfè¡¨ç¤ºå€Ÿç”¨å½“å‰çš„Circleç»“æ„ä½“ fn area(&amp;self) -&gt; f64 &#123; std::f64::consts::PI * (self.radius * self.radius) &#125;&#125; Rust çš„å¯¹è±¡å®šä¹‰å’Œæ–¹æ³•å®šä¹‰æ˜¯åˆ†ç¦»çš„ åœ¨ä¸€ä¸ª impl å—å†…ï¼ŒSelf æŒ‡ä»£è¢«å®ç°æ–¹æ³•çš„ç»“æ„ä½“ç±»å‹ï¼Œself æŒ‡ä»£æ­¤ç±»å‹çš„å®ä¾‹ã€‚ self ä¾ç„¶æœ‰æ‰€æœ‰æƒçš„æ¦‚å¿µï¼š self è¡¨ç¤º Rectangle çš„æ‰€æœ‰æƒè½¬ç§»åˆ°è¯¥æ–¹æ³•ä¸­ï¼Œè¿™ç§å½¢å¼ç”¨çš„è¾ƒå°‘ &amp;self è¡¨ç¤ºè¯¥æ–¹æ³•å¯¹ Rectangle çš„ä¸å¯å˜å€Ÿç”¨ &amp;mut self è¡¨ç¤ºå¯å˜å€Ÿç”¨ åœ¨ Rust ä¸­ï¼Œå…è®¸æ–¹æ³•åè·Ÿç»“æ„ä½“çš„å­—æ®µåç›¸åŒï¼š ä¸€èˆ¬æ¥è¯´ï¼Œæ–¹æ³•è·Ÿå­—æ®µåŒåï¼Œå¾€å¾€é€‚ç”¨äºå®ç° getter è®¿é—®å™¨ 123456789101112131415161718pub struct Rectangle &#123; width: u32, height: u32,&#125;impl Rectangle &#123; pub fn new(width: u32, height: u32) -&gt; Self &#123; Rectangle &#123; width, height &#125; &#125; pub fn width(&amp;self) -&gt; u32 &#123; return self.width; &#125;&#125;fn main() &#123; let rect1 = Rectangle::new(30, 50); println!(&quot;&#123;&#125;&quot;, rect1.width());&#125; å¸¦æœ‰å¤šä¸ªå‚æ•°çš„æ–¹æ³•æ–¹æ³•å’Œå‡½æ•°ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªå‚æ•° å…³è”å‡½æ•°å®šä¹‰åœ¨ impl ä¸­ä¸”æ²¡æœ‰ self çš„å‡½æ•°è¢«ç§°ä¹‹ä¸ºå…³è”å‡½æ•°ï¼š å› ä¸ºå®ƒæ²¡æœ‰ selfï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯æ–¹æ³•ï¼Œå®ƒåˆåœ¨ impl ä¸­ï¼Œä¸ç»“æ„ä½“ç´§å¯†å…³è”ï¼Œå› æ­¤ç§°ä¸ºå…³è”å‡½æ•° 12345impl Rectangle &#123; fn new(w: u32, h: u32) -&gt; Rectangle &#123; Rectangle &#123; width: w, height: h &#125; &#125;&#125; Rust ä¸­æœ‰ä¸€ä¸ªçº¦å®šä¿—æˆçš„è§„åˆ™ï¼Œä½¿ç”¨ new æ¥ä½œä¸ºæ„é€ å™¨çš„åç§°ï¼Œæ‰€ä»¥ new åœ¨ Rust ä¸­ä¸æ˜¯å…³é”®è¯ã€‚ æˆ‘ä»¬éœ€è¦ç”¨ :: æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒRectangle::new(3, 3)ï¼Œè¿™ä¸ªæ–¹æ³•ä½äºç»“æ„ä½“çš„å‘½åç©ºé—´ä¸­ï¼š:: è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´ å¤šä¸ª impl å®šä¹‰Rust å…è®¸æˆ‘ä»¬ä¸ºä¸€ä¸ªç»“æ„ä½“å®šä¹‰å¤šä¸ª impl å—ï¼Œç›®çš„æ˜¯æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œä»£ç ç»„ç»‡æ€§ï¼Œä¾‹å¦‚å½“æ–¹æ³•å¤šäº†åï¼Œå¯ä»¥æŠŠç›¸å…³çš„æ–¹æ³•ç»„ç»‡åœ¨åŒä¸€ä¸ª impl å—ä¸­ 123456impl Rectangle &#123; fn area(&amp;self) -&gt; u32 &#123;self.width * self.height&#125;&#125;impl Rectangle &#123; fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool &#123;self.width &gt; other.width &amp;&amp; self.height &gt; other.height&#125;&#125; ä¸ºæšä¸¾å®ç°æ–¹æ³•æšä¸¾ä¹Ÿå¯ä»¥å®ç°å…¶æ–¹å¼ï¼š 12345678910111213141516#![allow(unused)]enum Message &#123; Quit, Move &#123; x: i32, y: i32 &#125;, Write(String), ChangeColor(i32, i32, i32),&#125;impl Message &#123; fn call(&amp;self) &#123; // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“ &#125;&#125;fn main() &#123; let m = Message::Write(String::from(&quot;hello&quot;)); m.call();&#125; é™¤äº†ç»“æ„ä½“å’Œæšä¸¾ï¼Œæˆ‘ä»¬è¿˜èƒ½ä¸ºç‰¹å¾(trait)å®ç°æ–¹æ³• æ³›å‹å’Œç‰¹å¾æ³›å‹æ³›å‹è¯¦è§£12345678fn add&lt;T&gt;(a:T, b:T) -&gt; T &#123; a + b&#125;fn main() &#123; println!(&quot;add i8: &#123;&#125;&quot;, add(2i8, 3i8)); println!(&quot;add i32: &#123;&#125;&quot;, add(20, 30)); println!(&quot;add f64: &#123;&#125;&quot;, add(1.23, 1.23));&#125; ä¸Šé¢ä»£ç çš„ T å°±æ˜¯æ³›å‹å‚æ•°ï¼Œå®é™…ä¸Šåœ¨ Rust ä¸­ï¼Œæ³›å‹å‚æ•°çš„åç§°å‡ºäºæƒ¯ä¾‹ï¼Œæˆ‘ä»¬éƒ½ç”¨ T ( T æ˜¯ type çš„é¦–å­—æ¯)æ¥ä½œä¸ºé¦–é€‰ 1fn largest&lt;T&gt;(list: &amp;[T]) -&gt; T &#123;//å‚æ•° `list`ï¼Œå…¶ç±»å‹æ˜¯å…ƒç´ ä¸º `T` çš„æ•°ç»„åˆ‡ç‰‡ è°ƒç”¨çš„æ—¶å€™æ˜¾ç¤ºæŒ‡å®šç±»å‹ï¼šé¿å…æœ‰æ—¶å€™ç¼–è¯‘å™¨ä¸çŸ¥é“ç±»å‹ 1create_and_print::&lt;i64&gt;(); ç»“æ„ä½“ä¸­ä½¿ç”¨æ³›å‹ç»“æ„ä½“ä¸­çš„å­—æ®µç±»å‹ä¹Ÿå¯ä»¥ç”¨æ³›å‹æ¥å®šä¹‰ 12345678struct Point&lt;T&gt; &#123; x: T, y: T,&#125;fn main() &#123; let integer = Point &#123; x: 5, y: 10 &#125;; let float = Point &#123; x: 1.0, y: 4.0 &#125;;&#125; æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ³›å‹å‚æ•° 1234567struct Point&lt;T,U&gt; &#123; x: T, y: U,&#125;fn main() &#123; let p = Point&#123;x: 1, y :1.1&#125;;&#125; æšä¸¾ä¸­ä½¿ç”¨æ³›å‹å‰é¢è®²çš„ Option å°±æ˜¯ä¸€ä¸ªå¸¦æ³›å‹çš„æšä¸¾ 1234enum Option&lt;T&gt; &#123; Some(T), None,&#125; è¿˜æœ‰ä¸€ç§ä¸»è¦ç”¨äºå‡½æ•°è¿”å›å€¼çš„æšä¸¾ Result 1234enum Result&lt;T, E&gt; &#123; Ok(T), Err(E),&#125; æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹12345678910111213struct Point&lt;T&gt; &#123; x: T, y: T,&#125;impl&lt;T&gt; Point&lt;T&gt; &#123; fn x(&amp;self) -&gt; &amp;T &#123; &amp;self.x &#125;&#125;fn main() &#123; let p = Point &#123; x: 5, y: 10 &#125;; println!(&quot;p.x = &#123;&#125;&quot;, p.x());&#125; æˆ‘ä»¬è¿˜èƒ½åœ¨è¯¥ç»“æ„ä½“çš„æ–¹æ³•ä¸­å®šä¹‰é¢å¤–çš„æ³›å‹å‚æ•° 123456789101112131415161718struct Point&lt;T, U&gt; &#123; x: T, y: U,&#125;impl&lt;T, U&gt; Point&lt;T, U&gt; &#123; fn mixup&lt;V, W&gt;(self, other: Point&lt;V, W&gt;) -&gt; Point&lt;T, W&gt; &#123; Point &#123; x: self.x, y: other.y, &#125; &#125;&#125;fn main() &#123; let p1 = Point &#123; x: 5, y: 10.4 &#125;; let p2 = Point &#123; x: &quot;Hello&quot;, y: &#x27;c&#x27;&#125;; let p3 = p1.mixup(p2); println!(&quot;p3.x = &#123;&#125;, p3.y = &#123;&#125;&quot;, p3.x, p3.y);&#125; constæ³›å‹ä¹‹å‰è®²çš„æ³›å‹æ˜¯é’ˆå¯¹ç±»å‹çš„ï¼Œè€Œ const æ³›å‹ï¼Œæ˜¯é’ˆå¯¹å€¼çš„æ³›å‹ï¼Œæ­£å¥½å¯ä»¥ç”¨äºå¤„ç†æ•°ç»„é•¿åº¦çš„é—®é¢˜ 12345678910fn display_array&lt;T: std::fmt::Debug, const N: usize&gt;(arr: [T; N]) &#123; println!(&quot;&#123;:?&#125;&quot;, arr);&#125;fn main() &#123; let arr: [i32; 3] = [1, 2, 3]; display_array(arr); let arr: [i32; 2] = [1, 2]; display_array(arr);&#125; æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å‹ä¸º [T; N] çš„æ•°ç»„ï¼Œå…¶ä¸­ T æ˜¯ä¸€ä¸ªåŸºäºç±»å‹çš„æ³›å‹å‚æ•°ï¼ŒN è¿™ä¸ªæ³›å‹å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºå€¼çš„æ³›å‹å‚æ•°ï¼å› ä¸ºå®ƒç”¨æ¥æ›¿ä»£çš„æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚ N å°±æ˜¯ const æ³›å‹ï¼Œå®šä¹‰çš„è¯­æ³•æ˜¯ const N: usizeï¼Œè¡¨ç¤º const æ³›å‹ N ï¼Œå®ƒåŸºäºçš„å€¼ç±»å‹æ˜¯ usize æ³›å‹çš„æ€§èƒ½åœ¨ Rust ä¸­æ³›å‹æ˜¯é›¶æˆæœ¬çš„æŠ½è±¡ï¼Œè™½ç„¶æˆ‘ä»¬è·å¾—äº†é«˜æ€§èƒ½ï¼Œä½† Rust æ˜¯åœ¨ç¼–è¯‘æœŸä¸ºæ³›å‹å¯¹åº”çš„å¤šä¸ªç±»å‹ï¼Œç”Ÿæˆå„è‡ªçš„ä»£ç ï¼Œå› æ­¤æŸå¤±äº†ç¼–è¯‘é€Ÿåº¦å’Œå¢å¤§äº†æœ€ç»ˆç”Ÿæˆæ–‡ä»¶çš„å¤§å°ã€‚ Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ å•æ€åŒ–(monomorphization)æ¥ä¿è¯æ•ˆç‡ã€‚å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚ ç‰¹å¾ Traitå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œï¼ŒåŒ…å« openã€ writeã€ read å’Œ closeï¼Œå°±éœ€è¦æŠŠè¿™äº›è¡Œä¸ºæŠ½è±¡å‡ºæ¥ï¼Œè¿™å°±æ˜¯ Rust ä¸­çš„ ç‰¹å¾ traitï¼Œå®ƒç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ¥å£ interface 123fn add&lt;T: std::ops::Add&lt;Output = T&gt;&gt;(a:T, b:T) -&gt; T &#123; a + b&#125; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé€šè¿‡ std::ops::Add ç‰¹å¾æ¥é™åˆ¶ Tï¼Œåªæœ‰ T å®ç°äº† std::ops::Add æ‰èƒ½è¿›è¡Œåˆæ³•çš„åŠ æ³•æ“ä½œã€‚ ç‰¹å¾å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è¢«å…±äº«çš„è¡Œä¸ºï¼Œåªè¦å®ç°äº†ç‰¹å¾ï¼Œä½ å°±èƒ½ä½¿ç”¨è¯¥è¡Œä¸ºã€‚ å®šä¹‰ç‰¹å¾å¦‚æœä¸åŒçš„ç±»å‹å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹å¾ï¼Œç„¶åä¸ºè¿™äº›ç±»å‹å®ç°è¯¥ç‰¹å¾ã€‚å®šä¹‰ç‰¹å¾æ˜¯æŠŠä¸€äº›æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·ï¼Œç›®çš„æ˜¯å®šä¹‰ä¸€ä¸ªå®ç°æŸäº›ç›®æ ‡æ‰€å¿…éœ€çš„è¡Œä¸ºçš„é›†åˆã€‚ 123pub trait Summary &#123; fn summarize(&amp;self) -&gt; String;&#125; ä½¿ç”¨ trait å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªç‰¹å¾ï¼ŒSummary æ˜¯ç‰¹å¾åã€‚åœ¨å¤§æ‹¬å·ä¸­å®šä¹‰äº†è¯¥ç‰¹å¾çš„æ‰€æœ‰æ–¹æ³•ã€‚ç‰¹å¾åªå®šä¹‰æ–¹æ³•ç­¾åï¼Œè€Œä¸è¿›è¡Œå®ç° ä¸ºç±»å‹å®ç°ç‰¹å¾ä¸º Post å’Œ Weibo å®ç° Summary ç‰¹å¾ï¼š 12345678910111213141516171819202122pub trait Summary &#123; fn summarize(&amp;self) -&gt; String;&#125;pub struct Post &#123; pub title: String, // æ ‡é¢˜ pub author: String, // ä½œè€… pub content: String, // å†…å®¹&#125;impl Summary for Post &#123; fn summarize(&amp;self) -&gt; String &#123; format!(&quot;æ–‡ç« &#123;&#125;, ä½œè€…æ˜¯&#123;&#125;&quot;, self.title, self.author) &#125;&#125;pub struct Weibo &#123; pub username: String, pub content: String&#125;impl Summary for Weibo &#123; fn summarize(&amp;self) -&gt; String &#123; format!(&quot;&#123;&#125;å‘è¡¨äº†å¾®åš&#123;&#125;&quot;, self.username, self.content) &#125;&#125; å®ç°ç‰¹å¾çš„è¯­æ³•ä¸ä¸ºç»“æ„ä½“ã€æšä¸¾å®ç°æ–¹æ³•å¾ˆåƒï¼šimpl Summary for Postï¼Œè¯»ä½œâ€œä¸º Post ç±»å‹å®ç° Summary ç‰¹å¾â€ï¼Œç„¶ååœ¨ impl çš„èŠ±æ‹¬å·ä¸­å®ç°è¯¥ç‰¹å¾çš„å…·ä½“æ–¹æ³• ç‰¹å¾å®šä¹‰ä¸å®ç°çš„ä½ç½®(å­¤å„¿è§„åˆ™)å…³äºç‰¹å¾å®ç°ä¸å®šä¹‰çš„ä½ç½®ï¼Œæœ‰ä¸€æ¡éå¸¸é‡è¦çš„åŸåˆ™ï¼šå¦‚æœä½ æƒ³è¦ä¸ºç±»å‹ A å®ç°ç‰¹å¾ Tï¼Œé‚£ä¹ˆ A æˆ–è€… T è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸­å®šä¹‰çš„ï¼ é»˜è®¤å®ç°æˆ‘ä»¬å¯ä»¥åœ¨ç‰¹å¾ä¸­å®šä¹‰å…·æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼Œè¿™æ ·å…¶å®ƒç±»å‹æ— éœ€å†å®ç°è¯¥æ–¹æ³•ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€‰æ‹©é‡è½½è¯¥æ–¹æ³•ï¼š 12345678910111213pub trait Summary &#123; fn summarize(&amp;self) -&gt; String &#123; String::from(&quot;(Read more...)&quot;) &#125;&#125;/// Post ä½¿ç”¨äº†é»˜è®¤å®ç°impl Summary for Post &#123;&#125;/// Weibo é‡è½½äº†è¯¥æ–¹æ³•impl Summary for Weibo &#123; fn summarize(&amp;self) -&gt; String &#123; format!(&quot;&#123;&#125;å‘è¡¨äº†å¾®åš&#123;&#125;&quot;, self.username, self.content) &#125;&#125; ä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°123pub fn notify(item: &amp;impl Summary) &#123; println!(&quot;Breaking news! &#123;&#125;&quot;, item.summarize());&#125; ä¸Šé¢çš„å‡½æ•°å®šä¹‰ä¸­ï¼Œitem å°±æ˜¯å®ç°äº† Summary ç‰¹å¾å‚æ•° ç‰¹å¾çº¦æŸ(trait bound)impl Trait è¿™ç§è¯­æ³•å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼š 123pub fn notify&lt;T: Summary&gt;(item: &amp;T) &#123; println!(&quot;Breaking news! &#123;&#125;&quot;, item.summarize());&#125; T: Summary è¢«ç§°ä¸ºç‰¹å¾çº¦æŸï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦çº¦æŸå¤šä¸ªå‚æ•°éƒ½å¿…é¡»æ˜¯åŒä¸€ç±»å‹: 1pub fn notify&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;&#125; æ³›å‹ç±»å‹ T è¯´æ˜äº† item1 å’Œ item2 å¿…é¡»æ‹¥æœ‰åŒæ ·çš„ç±»å‹ï¼ŒåŒæ—¶ T: Summary è¯´æ˜äº† T å¿…é¡»å®ç° Summary ç‰¹å¾ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©å‚æ•°å®ç°å¤šç§çº¦æŸï¼Œå³å®ç°å¤šä¸ªä¸åŒçš„ç‰¹å¾ï¼š 1pub fn notify(item: &amp;(impl Summary + Display)) &#123;&#125; ä½¿ç”¨ç‰¹å¾çº¦æŸè¡¨ç¤ºä¸Šé¢çš„ä»£ç ï¼š 1pub fn notify&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125; å½“ç‰¹å¾çº¦æŸå˜å¾—å¾ˆå¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ where çº¦æŸï¼š 1234fn some_function&lt;T, U&gt;(t: &amp;T, u: &amp;U) -&gt; i32 where T: Display + Clone, U: Clone + Debug&#123;&#125; å‡½æ•°è¿”å›ä¸­çš„ impl Traitå¯ä»¥é€šè¿‡ impl Trait æ¥è¯´æ˜ä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªç±»å‹ï¼Œè¯¥ç±»å‹å®ç°äº†æŸä¸ªç‰¹å¾ï¼š 12345678fn returns_summarizable() -&gt; impl Summary &#123; Weibo &#123; username: String::from(&quot;sunface&quot;), content: String::from( &quot;m1 maxå¤ªå‰å®³äº†ï¼Œç”µè„‘å†ä¹Ÿä¸ä¼šå¡&quot;, ) &#125;&#125; é€šè¿‡ derive æ´¾ç”Ÿç‰¹å¾æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­å·²ç»å‡ºç°äº†å¤šæ¬¡å½¢å¦‚ #[derive(Debug)] çš„ä»£ç ï¼Œè¿™ç§æ˜¯ä¸€ç§ç‰¹å¾æ´¾ç”Ÿè¯­æ³•ï¼Œè¢« derive æ ‡è®°çš„å¯¹è±¡ä¼šè‡ªåŠ¨å®ç°å¯¹åº”çš„é»˜è®¤ç‰¹å¾ä»£ç ï¼Œç»§æ‰¿ç›¸åº”çš„åŠŸèƒ½ ç‰¹å¾å¯¹è±¡å…ˆçœ‹ä¸‹é¢çš„å®ç°ä»£ç ï¼š 123456789101112131415161718192021222324252627pub trait Draw &#123; fn draw(&amp;self);&#125;pub struct Button &#123; pub width: u32, pub height: u32, pub label: String,&#125;impl Draw for Button &#123; fn draw(&amp;self) &#123; // ç»˜åˆ¶æŒ‰é’®çš„ä»£ç  &#125;&#125;struct SelectBox &#123; width: u32, height: u32, options: Vec&lt;String&gt;,&#125;impl Draw for SelectBox &#123; fn draw(&amp;self) &#123; // ç»˜åˆ¶SelectBoxçš„ä»£ç  &#125;&#125;// è¿™é‡Œä½¿ç”¨åŠ¨æ€æ•°ç»„å­˜å‚¨è¿™äº›éœ€è¦ç»˜åˆ¶çš„ç»„ä»¶pub struct Screen &#123; pub components: Vec&lt;Box&lt;dyn Draw&gt;&gt;,&#125; ç‰¹å¾å¯¹è±¡æŒ‡å‘å®ç°äº† Draw ç‰¹å¾çš„ç±»å‹çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘äº† Button æˆ–è€… SelectBox çš„å®ä¾‹ï¼Œè¿™ç§æ˜ å°„å…³ç³»æ˜¯å­˜å‚¨åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ç‰¹å¾å¯¹è±¡æ‰¾åˆ°å…·ä½“è°ƒç”¨çš„ç±»å‹æ–¹æ³•ã€‚ å¯ä»¥é€šè¿‡ &amp; å¼•ç”¨æˆ–è€… Box&lt;T&gt; æ™ºèƒ½æŒ‡é’ˆçš„æ–¹å¼æ¥åˆ›å»ºç‰¹å¾å¯¹è±¡ã€‚ æ·±å…¥ç‰¹å¾å…³è”ç±»å‹å…³è”ç±»å‹æ˜¯åœ¨ç‰¹å¾ä¸­å…ˆå£°æ˜ä¸€ä¸ªå ä½çš„ç±»å‹ï¼Œç„¶åå…·ä½“å®ç°è¯¥ç‰¹è´¨æ—¶å†æ˜ç¡®è¿™äº›ç±»å‹ 1234567891011pub trait Iterator &#123; type Item; fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;&#125;// ä¸º Counter ç»“æ„ä½“å®ç° Iterator ç‰¹è´¨impl Iterator for Counter &#123; // æ˜ç¡®å…³è”ç±»å‹ Item ä¸º u32 type Item = u32; fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; &#123; &#125;&#125; Self ç”¨æ¥æŒ‡ä»£å½“å‰è°ƒç”¨è€…çš„å…·ä½“ç±»å‹ é»˜è®¤æ³›å‹ç±»å‹å‚æ•°å½“ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å…·ä½“ç±»å‹ 123456789101112131415161718// å®šä¹‰ä¸€ä¸ªå¸¦æœ‰é»˜è®¤ç±»å‹å‚æ•°çš„ traittrait Container&lt;T = i32&gt; &#123; fn contains(&amp;self, item: T) -&gt; bool;&#125;// ä¸º Vec&lt;T&gt; å®ç° Container traitimpl&lt;T&gt; Container&lt;T&gt; for Vec&lt;T&gt; &#123; fn contains(&amp;self, item: T) -&gt; bool where T: PartialEq, &#123; for element in self &#123; if *element == item &#123; return true; &#125; &#125; false &#125;&#125; å¦‚æœä¸åŒç‰¹å¾æ‹¥æœ‰åŒåçš„æ–¹æ³•ï¼Œç±»å‹ä¹Ÿæœ‰åŒåçš„æ–¹æ³•ï¼Œä¼˜å…ˆè°ƒç”¨ç±»å‹çš„æ–¹æ³•ï¼Œç”¨::æ˜¾ç¤ºè°ƒç”¨ç‰¹å¾çš„æ–¹æ³•ï¼Œæˆ–è€…ä½¿ç”¨å®Œå…¨é™å®šè¯­æ³•&lt;Dog as Animal&gt;:: ç‰¹å¾å¯¹è±¡ä¸­çš„ç‰¹å¾çº¦æŸtrait OutlinePrint: Display éœ€è¦å…ˆå®ç°Displayç‰¹å¾ é›†åˆç±»å‹åŠ¨æ€æ•°ç»„ VectoråŠ¨æ€æ•°ç»„ç±»å‹ç”¨ Vec&lt;T&gt; è¡¨ç¤º åˆ›å»ºåŠ¨æ€æ•°ç»„ Vec::new 1let v: Vec&lt;i32&gt; = Vec::new(); å¦‚æœé¢„å…ˆçŸ¥é“è¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå¯ä»¥ä½¿ç”¨ Vec::with_capacity(capacity) åˆ›å»ºåŠ¨æ€æ•°ç»„ï¼Œè¿™æ ·å¯ä»¥é¿å…å› ä¸ºæ’å…¥å¤§é‡æ–°æ•°æ®å¯¼è‡´é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œæ‹·è´ï¼Œæå‡æ€§èƒ½ vec![] æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å® vec! æ¥åˆ›å»ºæ•°ç»„ 1let v = vec![1, 2, 3]; æ­¤å¤„çš„ v ä¹Ÿæ— éœ€æ ‡æ³¨ç±»å‹ï¼Œç¼–è¯‘å™¨åªéœ€æ£€æŸ¥å®ƒå†…éƒ¨çš„å…ƒç´ å³å¯è‡ªåŠ¨æ¨å¯¼å‡º v çš„ç±»å‹æ˜¯ Vec&lt;i32&gt; æ›´æ–° Vectorå‘æ•°ç»„å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ push æ–¹æ³• 12let mut v = Vec::new();v.push(1); ä¸å…¶å®ƒç±»å‹ä¸€æ ·ï¼Œå¿…é¡»å°† v å£°æ˜ä¸º mut åï¼Œæ‰èƒ½è¿›è¡Œä¿®æ”¹ Vector ä¸å…¶å…ƒç´ å…±å­˜äº¡è·Ÿç»“æ„ä½“ä¸€æ ·ï¼ŒVector ç±»å‹åœ¨è¶…å‡ºä½œç”¨åŸŸèŒƒå›´åï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤,è¢«åˆ é™¤åï¼Œå®ƒå†…éƒ¨å­˜å‚¨çš„æ‰€æœ‰å†…å®¹ä¹Ÿä¼šéšä¹‹è¢«åˆ é™¤ 1234&#123; let v = vec![1, 2, 3]; // ...&#125; // &lt;- vè¶…å‡ºä½œç”¨åŸŸå¹¶åœ¨æ­¤å¤„è¢«åˆ é™¤ ä» Vector ä¸­è¯»å–å…ƒç´ è¯»å–æŒ‡å®šä½ç½®çš„å…ƒç´ æœ‰ä¸¤ç§æ–¹å¼å¯é€‰ï¼š é€šè¿‡ä¸‹æ ‡ç´¢å¼•è®¿é—®ã€‚ ä½¿ç”¨ get æ–¹æ³•ã€‚ 12345678let v = vec![1, 2, 3, 4, 5];let third: &amp;i32 = &amp;v[2];println!(&quot;ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ &#123;&#125;&quot;, third);match v.get(2) &#123; Some(third) =&gt; println!(&quot;ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ &#123;third&#125;&quot;), None =&gt; println!(&quot;å»ä½ çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œæ ¹æœ¬æ²¡æœ‰ï¼&quot;),&#125; v.get(2)è¿”å›çš„æ˜¯ Option&lt;&amp;T&gt;ï¼Œå› æ­¤è¿˜éœ€è¦é¢å¤–çš„ match æ¥åŒ¹é…è§£æ„å‡ºå…·ä½“çš„å€¼ã€‚ ä¸Šè¿°ä¸¤ç§è®¿é—®æ–¹å¼çš„åŒºåˆ«åœ¨äºï¼Œé€šè¿‡ .get è®¿é—®è¿”å› Option&lt;T&gt;ï¼Œå¦‚æœå‘ç”Ÿä¸‹æ ‡è¶Šç•Œï¼Œç´¢å¼•æ–¹å¼ä¼šæŠ¥é”™é€€å‡ºï¼Œè€Œ .get æ–¹å¼ä¼šè¾“å‡º Noneï¼Œæ¯”è¾ƒå®‰å…¨ã€‚æ‰€ä»¥ï¼Œå½“ä½ ç¡®è®¤ä¸‹æ ‡è®¿é—®ä¸ä¼šè¶Šç•Œæ—¶ï¼Œä½¿ç”¨ç´¢å¼•è®¿é—®ï¼Œåä¹‹åˆ™ä½¿ç”¨ .get æ–¹å¼ è¿­ä»£éå† Vector ä¸­çš„å…ƒç´ å¦‚æœæƒ³è¦ä¾æ¬¡è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£çš„æ–¹å¼å»éå†æ•°ç»„ï¼Œè¿™ç§æ–¹å¼æ¯”ç”¨ä¸‹æ ‡çš„æ–¹å¼å»éå†æ•°ç»„æ›´å®‰å…¨ä¹Ÿæ›´é«˜æ•ˆï¼ˆæ¯æ¬¡ä¸‹æ ‡è®¿é—®éƒ½ä¼šè§¦å‘æ•°ç»„è¾¹ç•Œæ£€æŸ¥ï¼‰ï¼š 1234let v = vec![1, 2, 3];for i in &amp;v &#123; println!(&quot;&#123;i&#125;&quot;);&#125; ä¹Ÿå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¿®æ”¹ Vector ä¸­çš„å…ƒç´ ï¼š 1234let mut v = vec![1, 2, 3];for i in &amp;mut v &#123; *i += 10&#125; KV å­˜å‚¨ HashMapHashMap ä¸­å­˜å‚¨çš„æ˜¯ä¸€ä¸€æ˜ å°„çš„ KV é”®å€¼å¯¹ï¼Œå¹¶æä¾›äº†å¹³å‡å¤æ‚åº¦ä¸º O(1) çš„æŸ¥è¯¢æ–¹æ³•ï¼Œå½“æˆ‘ä»¬å¸Œæœ›é€šè¿‡ä¸€ä¸ª Key å»æŸ¥è¯¢å€¼æ—¶ï¼Œè¯¥ç±»å‹éå¸¸æœ‰ç”¨ åˆ›å»º HashMapæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ new æ–¹æ³•æ¥åˆ›å»º HashMapï¼Œç„¶åé€šè¿‡ insert æ–¹æ³•æ’å…¥é”®å€¼å¯¹ã€‚ 12345use std::collections::HashMap;// åˆ›å»ºä¸€ä¸ªHashMapï¼Œç”¨äºå­˜å‚¨å®çŸ³ç§ç±»å’Œå¯¹åº”çš„æ•°é‡let mut my_gems = HashMap::new();// å°†å®çŸ³ç±»å‹å’Œå¯¹åº”çš„æ•°é‡å†™å…¥è¡¨ä¸­my_gems.insert(&quot;çº¢å®çŸ³&quot;, 1); å¦‚æœé¢„å…ˆçŸ¥é“è¦å­˜å‚¨çš„ KV å¯¹ä¸ªæ•°ï¼Œå¯ä»¥ä½¿ç”¨ HashMap::with_capacity(capacity) åˆ›å»ºæŒ‡å®šå¤§å°çš„ HashMapï¼Œé¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œæ‹·è´ï¼Œæå‡æ€§èƒ½ å¦‚æœæˆ‘ä»¬æƒ³å°†ä¸€ä¸ªåŠ¨æ€æ•°ç»„è½¬æ¢æˆ HashMapï¼Œå¯ä»¥å…ˆå°† Vec è½¬ä¸ºè¿­ä»£å™¨ï¼Œç„¶åé€šè¿‡ collect æ–¹æ³•ï¼Œå°†è¿­ä»£å™¨ä¸­çš„å…ƒç´ æ”¶é›†åè½¬æˆ HashMapã€‚ 12345678910fn main() &#123; use std::collections::HashMap; let teams_list = vec![ (&quot;ä¸­å›½é˜Ÿ&quot;.to_string(), 100), (&quot;ç¾å›½é˜Ÿ&quot;.to_string(), 10), (&quot;æ—¥æœ¬é˜Ÿ&quot;.to_string(), 50), ]; let teams_map: HashMap&lt;_,_&gt; = teams_list.into_iter().collect(); println!(&quot;&#123;:?&#125;&quot;,teams_map)&#125; æ‰€æœ‰æƒè½¬ç§»HashMap çš„æ‰€æœ‰æƒè§„åˆ™ä¸å…¶å®ƒ Rust ç±»å‹æ²¡æœ‰åŒºåˆ«ï¼š è‹¥ç±»å‹å®ç° Copy ç‰¹å¾ï¼Œè¯¥ç±»å‹ä¼šè¢«å¤åˆ¶è¿› HashMapï¼Œå› æ­¤æ— æ‰€è°“æ‰€æœ‰æƒ è‹¥æ²¡å®ç° Copy ç‰¹å¾ï¼Œæ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™ HashMap ä¸­ æŸ¥è¯¢ HashMapæˆ‘ä»¬é€šè¿‡ get æ–¹æ³•å¯ä»¥è·å–å…ƒç´ ï¼š 12345use std::collections::HashMap;let mut scores = HashMap::new();scores.insert(String::from(&quot;Blue&quot;), 10);let team_name = String::from(&quot;Blue&quot;);let score: Option&lt;&amp;i32&gt; = scores.get(&amp;team_name); get æ–¹æ³•è¿”å›ä¸€ä¸ª Option&lt;&amp;i32&gt; ç±»å‹ï¼šå½“æŸ¥è¯¢ä¸åˆ°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª Noneï¼ŒæŸ¥è¯¢åˆ°æ—¶è¿”å› Some(&amp;i32) &amp;i32 æ˜¯å¯¹ HashMap ä¸­å€¼çš„å€Ÿç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨å€Ÿç”¨ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§» å¦‚æœæƒ³ç›´æ¥è·å– score ä¸­çš„å€¼ï¼Œå¯ä»¥è¿™æ ·ï¼š 1let score: i32 = scores.get(&amp;team_name).copied().unwrap_or(0); æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ for å¾ªç¯éå† HashMap 12345678910use std::collections::HashMap;let mut scores = HashMap::new();scores.insert(String::from(&quot;Blue&quot;), 10);scores.insert(String::from(&quot;Yellow&quot;), 50);for (key, value) in &amp;scores &#123; println!(&quot;&#123;&#125;: &#123;&#125;&quot;, key, value);&#125; æ›´æ–° HashMap ä¸­çš„å€¼1234567891011121314151617181920212223fn main() &#123; use std::collections::HashMap; let mut scores = HashMap::new(); scores.insert(&quot;Blue&quot;, 10); // è¦†ç›–å·²æœ‰çš„å€¼ let old = scores.insert(&quot;Blue&quot;, 20); assert_eq!(old, Some(10)); // æŸ¥è¯¢æ–°æ’å…¥çš„å€¼ let new = scores.get(&quot;Blue&quot;); assert_eq!(new, Some(&amp;20)); // æŸ¥è¯¢Yellowå¯¹åº”çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ’å…¥æ–°å€¼ let v = scores.entry(&quot;Yellow&quot;).or_insert(5); assert_eq!(*v, 5); // ä¸å­˜åœ¨ï¼Œæ’å…¥5 // æŸ¥è¯¢Yellowå¯¹åº”çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ’å…¥æ–°å€¼ let v = scores.entry(&quot;Yellow&quot;).or_insert(50); assert_eq!(*v, 5); // å·²ç»å­˜åœ¨ï¼Œå› æ­¤50æ²¡æœ‰æ’å…¥&#125; ç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å¼•ç”¨çš„æœ‰æ•ˆä½œç”¨åŸŸã€‚åœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬æ— éœ€æ‰‹åŠ¨çš„å£°æ˜ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ¨å¯¼ æ‚¬å‚æŒ‡é’ˆå’Œç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦ä½œç”¨æ˜¯é¿å…æ‚¬å‚å¼•ç”¨ï¼Œå®ƒä¼šå¯¼è‡´ç¨‹åºå¼•ç”¨äº†æœ¬ä¸è¯¥å¼•ç”¨çš„æ•°æ®ï¼š 12345678&#123; let r; &#123; let x = 5; r = &amp;x; &#125; // æ­¤å¤„ x å·²è¢«é‡Šæ”¾ï¼Œå¯¼è‡´å¤–å±‚ä½œç”¨åŸŸè°ƒç”¨å¯èƒ½å¤±è´¥ println!(&quot;r: &#123;&#125;&quot;, r);&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œr å°±æ˜¯ä¸€ä¸ªæ‚¬å‚æŒ‡é’ˆï¼Œå®ƒå¼•ç”¨äº†æå‰è¢«é‡Šæ”¾çš„å˜é‡ x, r æ‹¥æœ‰æ›´å¤§çš„ä½œç”¨åŸŸï¼Œæˆ–è€…è¯´æ´»å¾—æ›´ä¹…ã€‚ å€Ÿç”¨æ£€æŸ¥ä¸ºäº†ä¿è¯æ‰€æœ‰æƒå’Œå€Ÿç”¨çš„æ­£ç¡®æ€§ï¼ŒRust ä½¿ç”¨äº†ä¸€ä¸ªå€Ÿç”¨æ£€æŸ¥å™¨(Borrow checker)ï¼Œæ¥æ£€æŸ¥æˆ‘ä»¬ç¨‹åºçš„å€Ÿç”¨æ­£ç¡®æ€§ï¼š 12345678910&#123; let r; // ---------+-- &#x27;a // | &#123; // | let x = 5; // -+-- &#x27;b | r = &amp;x; // | | &#125; // -+ | // | println!(&quot;r: &#123;&#125;&quot;, r); // |&#125; // ---------+ å‡½æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸåœ¨å­˜åœ¨å¤šä¸ªå¼•ç”¨æ—¶ï¼Œç¼–è¯‘å™¨æœ‰æ—¶ä¼šæ— æ³•è‡ªåŠ¨æ¨å¯¼ç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ—¶å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ ‡æ³¨ï¼Œé€šè¿‡ä¸ºå‚æ•°æ ‡æ³¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸæ¥å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œå€Ÿç”¨æ£€æŸ¥çš„åˆ†æã€‚ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•æ ‡è®°çš„ç”Ÿå‘½å‘¨æœŸåªæ˜¯ä¸ºäº†å–æ‚¦ç¼–è¯‘å™¨ï¼Œè®©ç¼–è¯‘å™¨ä¸è¦éš¾ä¸ºæˆ‘ä»¬ã€‚ ç”Ÿå‘½å‘¨æœŸçš„è¯­æ³•ä¹Ÿé¢‡ä¸ºä¸ä¼—ä¸åŒï¼Œä»¥ &#39; å¼€å¤´ï¼Œåç§°å¾€å¾€æ˜¯ä¸€ä¸ªå•ç‹¬çš„å°å†™å­—æ¯ï¼Œå¤§å¤šæ•°äººéƒ½ç”¨ &#39;a æ¥ä½œä¸ºç”Ÿå‘½å‘¨æœŸçš„åç§°ã€‚ å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å‚æ•°ï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸä¼šä½äºå¼•ç”¨ç¬¦å· &amp; ä¹‹åï¼Œå¹¶ç”¨ä¸€ä¸ªç©ºæ ¼æ¥å°†ç”Ÿå‘½å‘¨æœŸå’Œå¼•ç”¨å‚æ•°åˆ†éš”å¼€: 123&amp;i32 // ä¸€ä¸ªå¼•ç”¨&amp;&#x27;a i32 // å…·æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨&amp;&#x27;a mut i32 // å…·æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨ åœ¨å­˜åœ¨å¤šä¸ªå¼•ç”¨æ—¶ï¼Œç¼–è¯‘å™¨æœ‰æ—¶ä¼šæ— æ³•è‡ªåŠ¨æ¨å¯¼ç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ—¶å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ ‡æ³¨ï¼Œé€šè¿‡ä¸ºå‚æ•°æ ‡æ³¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸæ¥å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œå€Ÿç”¨æ£€æŸ¥çš„åˆ†æã€‚ 1234567fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str &#123; if x.len() &gt; y.len() &#123; x &#125; else &#123; y &#125;&#125; ç¨‹åºæŠ¥é”™ å½“å‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œè¿™ä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»è‡³å°‘å’Œå‡½æ•°çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œä»¥ç¡®ä¿åœ¨å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œè¿”å›çš„å¼•ç”¨ä»ç„¶æŒ‡å‘æœ‰æ•ˆçš„æ•°æ®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ä¸ºå‡½æ•°æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œæ˜ç¡®è¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç”Ÿå‘½å‘¨æœŸå’Œå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„å…³ç³»ã€‚ 1234567fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123; if x.len() &gt; y.len() &#123; x &#125; else &#123; y &#125;&#125; æ·»åŠ äº†ç”Ÿå‘½å‘¨æœŸå‚æ•° &#39;aã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°è¡¨ç¤º x å’Œ y çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”è¿”å›çš„å­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿä¸ &#39;a ç›¸åŒ ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸéœ€è¦æ³¨æ„ï¼šå’Œæ³›å‹ä¸€æ ·ï¼Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œéœ€è¦å…ˆå£°æ˜ &lt;&#39;a&gt; åœ¨é€šè¿‡å‡½æ•°ç­¾åæŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜ä¼ å…¥å¼•ç”¨æˆ–è€…è¿”å›å¼•ç”¨çš„çœŸå®ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å½“ä¸æ»¡è¶³æ­¤çº¦æŸæ¡ä»¶æ—¶ï¼Œå°±æ‹’ç»ç¼–è¯‘é€šè¿‡ã€‚æ˜¾å¼çš„ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨æ­£ç¡®çš„è®¤è¯†åˆ°å¤šä¸ªå¼•ç”¨ä¹‹é—´çš„å…³ç³»ï¼Œæœ€ç»ˆå¸®æˆ‘ä»¬æå‰è§„é¿å¯èƒ½å­˜åœ¨çš„ä»£ç é£é™©ã€‚ ç»“æ„ä½“ä¸­çš„ç”Ÿå‘½å‘¨æœŸåœ¨ä¹‹å‰çš„ç»“æ„ä½“ç« èŠ‚ä¸­ï¼Œæ²¡æœ‰å¼•ç”¨ç±»å‹ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨å¼•ç”¨ï¼šåªè¦ä¸ºç»“æ„ä½“ä¸­çš„æ¯ä¸€ä¸ªå¼•ç”¨æ ‡æ³¨ä¸Šç”Ÿå‘½å‘¨æœŸå³å¯ï¼š 1234567891011struct ImportantExcerpt&lt;&#x27;a&gt; &#123; part: &amp;&#x27;a str,&#125;fn main() &#123; let novel = String::from(&quot;Call me Ishmael. Some years ago...&quot;); let first_sentence = novel.split(&#x27;.&#x27;).next().expect(&quot;Could not find a &#x27;.&#x27;&quot;); let i = ImportantExcerpt &#123; part: first_sentence, &#125;;&#125; ImportantExcerpt ç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å­—æ®µ partï¼Œå› æ­¤éœ€è¦ä¸ºå®ƒæ ‡æ³¨ä¸Šç”Ÿå‘½å‘¨æœŸã€‚ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•è·Ÿæ³›å‹å‚æ•°è¯­æ³•å¾ˆåƒï¼Œéœ€è¦å¯¹ç”Ÿå‘½å‘¨æœŸå‚æ•°è¿›è¡Œå£°æ˜ &lt;&#39;a&gt;ã€‚è¯¥ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯´æ˜ï¼Œç»“æ„ä½“ ImportantExcerpt æ‰€å¼•ç”¨çš„å­—ç¬¦ä¸² str å¿…é¡»æ¯”è¯¥ç»“æ„ä½“æ´»å¾—æ›´ä¹…ã€‚ ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤1fn first_word(s: &amp;str) -&gt; &amp;str //ç¼–è¯‘é€šè¿‡ å®é™…ä¸Šï¼Œå¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå¼•ç”¨ç±»å‹éƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå°½ç®¡æ²¡æœ‰æ˜¾å¼çš„ä¸ºå…¶æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œç¼–è¯‘ä¾ç„¶å¯ä»¥é€šè¿‡ã€‚å…¶å®åŸå› ä¸å¤æ‚ï¼Œç¼–è¯‘å™¨ä¸ºäº†ç®€åŒ–ç”¨æˆ·çš„ä½¿ç”¨ï¼Œæ¶ˆé™¤äº†ç”Ÿå‘½å‘¨æœŸ æ¶ˆé™¤è§„åˆ™ï¼š æ¯ä¸€ä¸ªå¼•ç”¨å‚æ•°éƒ½ä¼šè·å¾—ç‹¬è‡ªçš„ç”Ÿå‘½å‘¨æœŸ è‹¥åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼ˆå‡½æ•°å‚æ•°ä¸­åªæœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼‰ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸ è‹¥å­˜åœ¨å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ &amp;self æˆ– &amp;mut selfï¼Œåˆ™ &amp;self çš„ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸ æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸä¸ºå…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»“æ„ä½“å®ç°æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„è¯­æ³•è·Ÿæ³›å‹å‚æ•°è¯­æ³•å¾ˆç›¸ä¼¼ï¼š 12345678struct ImportantExcerpt&lt;&#x27;a&gt; &#123; part: &amp;&#x27;a str,&#125;impl&lt;&#x27;a&gt; ImportantExcerpt&lt;&#x27;a&gt; &#123; fn level(&amp;self) -&gt; i32 &#123; 3 &#125;&#125; é™æ€ç”Ÿå‘½å‘¨æœŸåœ¨ Rust ä¸­æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£å°±æ˜¯ &#39;staticï¼Œæ‹¥æœ‰è¯¥ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨å¯ä»¥å’Œæ•´ä¸ªç¨‹åºæ´»å¾—ä¸€æ ·ä¹…ã€‚æ¯”å¦‚å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå®ƒæ˜¯è¢«ç¡¬ç¼–ç è¿› Rust çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å˜é‡å…¨éƒ¨å…·æœ‰ &#39;static çš„ç”Ÿå‘½å‘¨æœŸï¼š 1let s: &amp;&#x27;static str = &quot;æˆ‘æ²¡å•¥ä¼˜ç‚¹ï¼Œå°±æ˜¯æ´»å¾—ä¹…ï¼Œå˜¿å˜¿&quot;; è¿”å›å€¼å’Œé”™è¯¯å¤„ç†Rust ä¸­çš„é”™è¯¯ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š å¯æ¢å¤é”™è¯¯ï¼Œé€šå¸¸ç”¨äºä»ç³»ç»Ÿå…¨å±€è§’åº¦æ¥çœ‹å¯ä»¥æ¥å—çš„é”™è¯¯ï¼Œä¾‹å¦‚å¤„ç†ç”¨æˆ·çš„è®¿é—®ã€æ“ä½œç­‰é”™è¯¯ï¼Œè¿™äº›é”™è¯¯åªä¼šå½±å“æŸä¸ªç”¨æˆ·è‡ªèº«çš„æ“ä½œè¿›ç¨‹ï¼Œè€Œä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¨å±€ç¨³å®šæ€§äº§ç”Ÿå½±å“ ä¸å¯æ¢å¤é”™è¯¯ï¼Œåˆšå¥½ç›¸åï¼Œè¯¥é”™è¯¯é€šå¸¸æ˜¯å…¨å±€æ€§æˆ–è€…ç³»ç»Ÿæ€§çš„é”™è¯¯ï¼Œä¾‹å¦‚æ•°ç»„è¶Šç•Œè®¿é—®ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶å‘ç”Ÿäº†å½±å“å¯åŠ¨æµç¨‹çš„é”™è¯¯ç­‰ç­‰ï¼Œè¿™äº›é”™è¯¯çš„å½±å“å¾€å¾€å¯¹äºç³»ç»Ÿæ¥è¯´æ˜¯è‡´å‘½çš„ Rust æ²¡æœ‰å¼‚å¸¸ï¼Œä½†æ˜¯ Rust ä¹Ÿä¼šæŠŠé”™è¯¯åˆ†ä¸ºä¸¤ç±»ï¼šResult&lt;T, E&gt; ç”¨äºå¯æ¢å¤é”™è¯¯ï¼Œpanic! ç”¨äºä¸å¯æ¢å¤é”™è¯¯ã€‚ panic æ·±å…¥å‰–æå¯¹äºä¸¥é‡åˆ°å½±å“ç¨‹åºè¿è¡Œçš„é”™è¯¯ï¼Œè§¦å‘ panic æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹å¼ã€‚åœ¨ Rust ä¸­è§¦å‘ panic æœ‰ä¸¤ç§æ–¹å¼ï¼šè¢«åŠ¨è§¦å‘å’Œä¸»åŠ¨è°ƒç”¨ 12345fn main() &#123; let v = vec![1, 2, 3]; v[99];&#125; ä¸Šé¢çš„ä»£ç ä¸€çœ‹å°±çŸ¥é“ï¼šæ•°ç»„è®¿é—®è¶Šç•Œï¼Œåœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­æ— ä¸€ä¾‹å¤–ï¼Œéƒ½ä¼šæŠ¥å‡ºä¸¥é‡çš„å¼‚å¸¸ï¼Œç”šè‡³å¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒå…³é—­ã€‚ç±»ä¼¼çš„ panic è¿˜æœ‰å¾ˆå¤šï¼Œè€Œè¢«åŠ¨è§¦å‘çš„ panic æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸é‡åˆ°çš„ã€‚ å¦‚æœå¼€å‘è€…æƒ³è¦ä¸»åŠ¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼ŒRust ä¸ºæˆ‘ä»¬æä¾›äº† panic! å®ï¼Œå½“è°ƒç”¨æ‰§è¡Œè¯¥å®æ—¶ï¼Œç¨‹åºä¼šæ‰“å°å‡ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå±•å¼€æŠ¥é”™ç‚¹å¾€å‰çš„å‡½æ•°è°ƒç”¨å †æ ˆï¼Œæœ€åé€€å‡ºç¨‹åº 12345fn main() &#123; panic!(&quot;crash and burn&quot;);&#125;// thread &#x27;main&#x27; panicked at &#x27;crash and burn&#x27;, src/main.rs:2:5// note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace ä¸Šé¢è¾“å…¥çš„ç»“æœä¿¡æ¯åŒ…å«äº†ä¸¤æ¡é‡è¦ä¿¡æ¯ï¼š main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å´©æºƒäº†ï¼Œå‘ç”Ÿçš„ä»£ç ä½ç½®æ˜¯ src/main.rs ä¸­çš„ç¬¬ 2 è¡Œç¬¬ 5 ä¸ªå­—ç¬¦ï¼ˆå»é™¤è¯¥è¡Œå‰é¢çš„ç©ºå­—ç¬¦ï¼‰ åœ¨ä½¿ç”¨æ—¶åŠ ä¸Šä¸€ä¸ªç¯å¢ƒå˜é‡å¯ä»¥è·å–æ›´è¯¦ç»†çš„æ ˆå±•å¼€ä¿¡æ¯ï¼š Linux/macOS ç­‰ UNIX ç³»ç»Ÿï¼š RUST_BACKTRACE=1 cargo run Windows ç³»ç»Ÿï¼ˆPowerShellï¼‰ï¼š $env:RUST_BACKTRACE=1 ; cargo run backtrace æ ˆå±•å¼€å¯¹äºä¸Šé¢çš„æ•°ç»„è¶Šç•Œè®¿é—®çš„é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨æ ˆå±•å¼€ï¼Œå°†ä¼šå¾—åˆ°ä¸‹é¢çš„ä¿¡æ¯ï¼š 12345678910111213141516171819thread &#x27;main&#x27; panicked at &#x27;index out of bounds: the len is 3 but the index is 99&#x27;, src/main.rs:4:5stack backtrace: 0: rust_begin_unwind at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/std/src/panicking.rs:517:5 1: core::panicking::panic_fmt at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/panicking.rs:101:14 2: core::panicking::panic_bounds_check at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/panicking.rs:77:5 3: &lt;usize as core::slice::index::SliceIndex&lt;[T]&gt;&gt;::index at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/slice/index.rs:184:10 4: core::slice::index::&lt;impl core::ops::index::Index&lt;I&gt; for [T]&gt;::index at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/slice/index.rs:15:9 5: &lt;alloc::vec::Vec&lt;T,A&gt; as core::ops::index::Index&lt;I&gt;&gt;::index at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/alloc/src/vec/mod.rs:2465:9 6: world_hello::main at ./src/main.rs:4:5 7: core::ops::function::FnOnce::call_once at /rustc/59eed8a2aac0230a8b53e89d4e99d55912ba6b35/library/core/src/ops/function.rs:227:5note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace. ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€æ¬¡æ ˆå±•å¼€(ä¹Ÿç§°æ ˆå›æº¯)ï¼Œå®ƒåŒ…å«äº†å‡½æ•°è°ƒç”¨çš„é¡ºåºï¼Œå½“ç„¶æŒ‰ç…§é€†åºæ’åˆ—ï¼šæœ€è¿‘è°ƒç”¨çš„å‡½æ•°æ’åœ¨åˆ—è¡¨çš„æœ€ä¸Šæ–¹ panic æ—¶çš„ä¸¤ç§ç»ˆæ­¢æ–¹å¼å½“å‡ºç° panic! æ—¶ï¼Œç¨‹åºæä¾›äº†ä¸¤ç§æ–¹å¼æ¥å¤„ç†ç»ˆæ­¢æµç¨‹ï¼šæ ˆå±•å¼€å’Œç›´æ¥ç»ˆæ­¢ã€‚ å…¶ä¸­ï¼Œé»˜è®¤çš„æ–¹å¼å°±æ˜¯ æ ˆå±•å¼€ï¼Œè¿™æ„å‘³ç€ Rust ä¼šå›æº¯æ ˆä¸Šæ•°æ®å’Œå‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ä¹Ÿæ„å‘³ç€æ›´å¤šçš„å–„åå·¥ä½œï¼Œå¥½å¤„æ˜¯å¯ä»¥ç»™å‡ºå……åˆ†çš„æŠ¥é”™ä¿¡æ¯å’Œæ ˆè°ƒç”¨ä¿¡æ¯ï¼Œä¾¿äºäº‹åçš„é—®é¢˜å¤ç›˜ã€‚ç›´æ¥ç»ˆæ­¢ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸æ¸…ç†æ•°æ®å°±ç›´æ¥é€€å‡ºç¨‹åºï¼Œå–„åå·¥ä½œäº¤ä¸æ“ä½œç³»ç»Ÿæ¥è´Ÿè´£ å¯æ¢å¤çš„é”™è¯¯ Resultå½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥ panicï¼Œ è€Œæ˜¯éœ€è¦ä¸€ç§æ¯”è¾ƒæ¸©å’Œçš„å¤„ç†æ–¹å¼ï¼ŒResult&lt;T, E&gt; Result&lt;T, E&gt; æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 1234enum Result&lt;T, E&gt; &#123; Ok(T), Err(E),&#125; æ³›å‹å‚æ•° T ä»£è¡¨æˆåŠŸæ—¶å­˜å…¥çš„æ­£ç¡®å€¼çš„ç±»å‹ï¼Œå­˜æ”¾æ–¹å¼æ˜¯ Ok(T)ï¼ŒE ä»£è¡¨é”™è¯¯æ—¶å­˜å…¥çš„é”™è¯¯å€¼ï¼Œå­˜æ”¾æ–¹å¼æ˜¯ Err(E) 12345use std::fs::File;fn main() &#123; let f = File::open(&quot;hello.txt&quot;);&#125; ä¸Šé¢çš„ä»£ç ç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šå‘Šè¯‰ä½ ï¼Œè¿”å›å€¼ç±»å‹æ˜¯ï¼šstd::result::Result&lt;std::fs::File, std::io::Error&gt;, ä¹Ÿå°±æ˜¯ä¸€ä¸ª Result&lt;T, E&gt;, File::open è°ƒç”¨å¦‚æœæˆåŠŸåˆ™è¿”å›ä¸€ä¸ªå¯ä»¥è¿›è¡Œè¯»å†™çš„æ–‡ä»¶å¥æŸ„ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ª IO é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰è®¿é—®æ–‡ä»¶çš„æƒé™ç­‰ 123456789101112use std::fs::File;fn main() &#123; let f = File::open(&quot;hello.txt&quot;); let f = match f &#123; Ok(file) =&gt; file, Err(error) =&gt; &#123; panic!(&quot;Problem opening the file: &#123;:?&#125;&quot;, error) &#125;, &#125;;&#125; unwrap å’Œ expect ä¸¤ä¸ªæ–¹æ³•é’ˆå¯¹ Result&lt;T, E&gt;, å¦‚æœè¿”å›æˆåŠŸï¼Œå°±å°† Ok(T) ä¸­çš„å€¼å–å‡ºæ¥ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±ç›´æ¥ panic 12345use std::fs::File;fn main() &#123; let f = File::open(&quot;hello.txt&quot;).unwrap();&#125; expect è·Ÿ unwrap å¾ˆåƒï¼Œä¹Ÿæ˜¯é‡åˆ°é”™è¯¯ç›´æ¥ panic, ä½†æ˜¯ä¼šå¸¦ä¸Šè‡ªå®šä¹‰çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼Œç›¸å½“äºé‡è½½äº†é”™è¯¯æ‰“å°çš„å‡½æ•°ï¼š 12345use std::fs::File;fn main() &#123; let f = File::open(&quot;hello.txt&quot;).expect(&quot;Failed to open hello.txt&quot;);&#125; åŒ…å’Œæ¨¡å—è·Ÿå…¶å®ƒè¯­è¨€ä¸€æ ·ï¼ŒRust ä¹Ÿæä¾›äº†åŒ…å’Œæ¨¡å—ç”¨äºä»£ç çš„ç»„ç»‡ç®¡ç†ï¼š é¡¹ç›®(Packages)ï¼šä¸€ä¸ª Cargo æä¾›çš„ featureï¼Œå¯ä»¥ç”¨æ¥æ„å»ºã€æµ‹è¯•å’Œåˆ†äº«åŒ… åŒ…(Crate)ï¼šä¸€ä¸ªç”±å¤šä¸ªæ¨¡å—ç»„æˆçš„æ ‘å½¢ç»“æ„ï¼Œå¯ä»¥ä½œä¸ºä¸‰æ–¹åº“è¿›è¡Œåˆ†å‘ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œè¿è¡Œ æ¨¡å—(Module)ï¼šå¯ä»¥ä¸€ä¸ªæ–‡ä»¶å¤šä¸ªæ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—å¯ä»¥è¢«è®¤ä¸ºæ˜¯çœŸå®é¡¹ç›®ä¸­çš„ä»£ç ç»„ç»‡å•å…ƒ åŒ…å’Œ PackageRust ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„åŒ…ç®¡ç†å·¥å…·ï¼š é¡¹ç›®(Package)ï¼šå¯ä»¥ç”¨æ¥æ„å»ºã€æµ‹è¯•å’Œåˆ†äº«åŒ… å·¥ä½œç©ºé—´(WorkSpace)ï¼šå¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯ä»¥è¿›ä¸€æ­¥å°†å¤šä¸ªåŒ…è”åˆåœ¨ä¸€èµ·ï¼Œç»„ç»‡æˆå·¥ä½œç©ºé—´ åŒ…(Crate)ï¼šä¸€ä¸ªç”±å¤šä¸ªæ¨¡å—ç»„æˆçš„æ ‘å½¢ç»“æ„ï¼Œå¯ä»¥ä½œä¸ºä¸‰æ–¹åº“è¿›è¡Œåˆ†å‘ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œè¿è¡Œ æ¨¡å—(Module)ï¼šå¯ä»¥ä¸€ä¸ªæ–‡ä»¶å¤šä¸ªæ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—å¯ä»¥è¢«è®¤ä¸ºæ˜¯çœŸå®é¡¹ç›®ä¸­çš„ä»£ç ç»„ç»‡å•å…ƒ å®šä¹‰å¯¹äº Rust è€Œè¨€ï¼ŒåŒ…æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯ç¼–è¯‘å•å…ƒï¼Œå®ƒç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…ä¸€ä¸ªåº“ã€‚ä¾‹å¦‚æ ‡å‡†åº“ä¸­æ²¡æœ‰æä¾›ä½†æ˜¯åœ¨ä¸‰æ–¹åº“ä¸­æä¾›çš„ rand åŒ…ï¼Œå®ƒæä¾›äº†éšæœºæ•°ç”Ÿæˆçš„åŠŸèƒ½ã€‚ åŒä¸€ä¸ªåŒ…ä¸­ä¸èƒ½æœ‰åŒåçš„ç±»å‹ï¼Œä½†æ˜¯åœ¨ä¸åŒåŒ…ä¸­å°±å¯ä»¥ é¡¹ç›® Packageç”±äº Package å°±æ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œå› æ­¤å®ƒåŒ…å«æœ‰ç‹¬ç«‹çš„ Cargo.toml æ–‡ä»¶ï¼Œä»¥åŠå› ä¸ºåŠŸèƒ½æ€§è¢«ç»„ç»‡åœ¨ä¸€èµ·çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ã€‚ä¸€ä¸ª Package åªèƒ½åŒ…å«ä¸€ä¸ªåº“(library)ç±»å‹çš„åŒ…ï¼Œä½†æ˜¯å¯ä»¥åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç±»å‹çš„åŒ…ã€‚ æ¨¡å— Moduleä½¿ç”¨æ¨¡å—å¯ä»¥å°†åŒ…ä¸­çš„ä»£ç æŒ‰ç…§åŠŸèƒ½æ€§è¿›è¡Œé‡ç»„ï¼Œæœ€ç»ˆå®ç°æ›´å¥½çš„å¯è¯»æ€§åŠæ˜“ç”¨æ€§ã€‚ åˆ›å»ºåµŒå¥—æ¨¡å—ä½¿ç”¨ cargo new --lib restaurant åˆ›å»ºä¸€ä¸ªåº“ç±»å‹çš„ Package 123456789101112131415mod front_of_house &#123; mod hosting &#123; fn add_to_waitlist() &#123;&#125; fn seat_at_table() &#123;&#125; &#125; mod serving &#123; fn take_order() &#123;&#125; fn serve_order() &#123;&#125; fn take_payment() &#123;&#125; &#125;&#125; ä»¥ä¸Šçš„ä»£ç åˆ›å»ºäº†ä¸‰ä¸ªæ¨¡å—ï¼Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š ä½¿ç”¨ mod å…³é”®å­—æ¥åˆ›å»ºæ–°æ¨¡å—ï¼Œåé¢ç´§è·Ÿç€æ¨¡å—åç§° æ¨¡å—å¯ä»¥åµŒå¥— æ¨¡å—ä¸­å¯ä»¥å®šä¹‰å„ç§ Rust ç±»å‹ï¼Œä¾‹å¦‚å‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ã€ç‰¹å¾ç­‰ æ‰€æœ‰æ¨¡å—å‡å®šä¹‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ ç”¨è·¯å¾„å¼•ç”¨æ¨¡å—æƒ³è¦è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°±éœ€è¦çŸ¥é“å®ƒçš„è·¯å¾„ï¼Œåœ¨ Rust ä¸­ï¼Œè¿™ç§è·¯å¾„æœ‰ä¸¤ç§å½¢å¼ï¼š ç»å¯¹è·¯å¾„ï¼Œä» crate root å¼€å§‹ï¼Œè·¯å¾„åä»¥åŒ…åæˆ–è€… crate ä½œä¸ºå¼€å¤´ ç›¸å¯¹è·¯å¾„ï¼Œä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä»¥ selfï¼Œsuper æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦ä½œä¸ºå¼€å¤´ 12345678910111213mod front_of_house &#123; mod hosting &#123; fn add_to_waitlist() &#123;&#125; &#125;&#125;pub fn eat_at_restaurant() &#123; // ç»å¯¹è·¯å¾„ crate::front_of_house::hosting::add_to_waitlist(); // ç›¸å¯¹è·¯å¾„ front_of_house::hosting::add_to_waitlist();&#125; ä»£ç å¯è§æ€§æ¨¡å—ä¸ä»…ä»…å¯¹äºç»„ç»‡ä»£ç å¾ˆæœ‰ç”¨ï¼Œå®ƒè¿˜èƒ½å®šä¹‰ä»£ç çš„ç§æœ‰åŒ–è¾¹ç•Œï¼šåœ¨è¿™ä¸ªè¾¹ç•Œå†…ï¼Œä»€ä¹ˆå†…å®¹èƒ½è®©å¤–ç•Œçœ‹åˆ°ï¼Œä»€ä¹ˆå†…å®¹ä¸èƒ½ï¼Œéƒ½æœ‰å¾ˆæ˜ç¡®çš„å®šä¹‰ã€‚å› æ­¤ï¼Œå¦‚æœå¸Œæœ›è®©å‡½æ•°æˆ–è€…ç»“æ„ä½“ç­‰ç±»å‹å˜æˆç§æœ‰åŒ–çš„ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å—ã€‚ Rust å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯ç§æœ‰åŒ–çš„ï¼ŒåŒ…æ‹¬å‡½æ•°ã€æ–¹æ³•ã€ç»“æ„ä½“ã€æšä¸¾ã€å¸¸é‡ï¼Œæ˜¯çš„ï¼Œå°±è¿æ¨¡å—æœ¬èº«ä¹Ÿæ˜¯ç§æœ‰åŒ–çš„ã€‚çˆ¶æ¨¡å—å®Œå…¨æ— æ³•è®¿é—®å­æ¨¡å—ä¸­çš„ç§æœ‰é¡¹ï¼Œä½†æ˜¯å­æ¨¡å—å´å¯ä»¥è®¿é—®çˆ¶æ¨¡å—ã€çˆ¶çˆ¶..æ¨¡å—çš„ç§æœ‰é¡¹ã€‚ Rust æä¾›äº† pub å…³é”®å­—ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥æ§åˆ¶æ¨¡å—å’Œæ¨¡å—ä¸­æŒ‡å®šé¡¹çš„å¯è§æ€§ã€‚ 12345mod front_of_house &#123; pub mod hosting &#123; pub fn add_to_waitlist() &#123;&#125; &#125;&#125; ä½¿ç”¨ super å¼•ç”¨æ¨¡å—super ä»£è¡¨çš„æ˜¯çˆ¶æ¨¡å—ä¸ºå¼€å§‹çš„å¼•ç”¨æ–¹å¼ 1234567891011fn serve_order() &#123;&#125;// å¨æˆ¿æ¨¡å—mod back_of_house &#123; fn fix_incorrect_order() &#123; cook_order(); super::serve_order(); &#125; fn cook_order() &#123;&#125;&#125; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ super::serve_order è¯­æ³•ï¼Œè°ƒç”¨äº†çˆ¶æ¨¡å—(crate root)ä¸­çš„ serve_order å‡½æ•°ã€‚ ä½¿ç”¨ self å¼•ç”¨æ¨¡å—self å…¶å®å°±æ˜¯å¼•ç”¨è‡ªèº«æ¨¡å—ä¸­çš„é¡¹ï¼Œçœ‹ä¸Šå»æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Œä½†å´æœ‰å¤§ç”¨å¤„ã€‚ 123456789101112fn serve_order() &#123; self::back_of_house::cook_order()&#125;mod back_of_house &#123; fn fix_incorrect_order() &#123; cook_order(); crate::serve_order(); &#125; pub fn cook_order() &#123;&#125;&#125; ç»“æ„ä½“å’Œæšä¸¾çš„å¯è§æ€§ å°†ç»“æ„ä½“è®¾ç½®ä¸º pubï¼Œä½†å®ƒçš„æ‰€æœ‰å­—æ®µä¾ç„¶æ˜¯ç§æœ‰çš„ å°†æšä¸¾è®¾ç½®ä¸º pubï¼Œå®ƒçš„æ‰€æœ‰å­—æ®µä¹Ÿå°†å¯¹å¤–å¯è§ ä½¿ç”¨ use åŠå—é™å¯è§æ€§åœ¨ Rust ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ use å…³é”®å­—æŠŠè·¯å¾„æå‰å¼•å…¥åˆ°å½“å‰ä½œç”¨åŸŸä¸­ï¼Œéšåçš„è°ƒç”¨å°±å¯ä»¥çœç•¥è¯¥è·¯å¾„ï¼Œæå¤§åœ°ç®€åŒ–äº†ä»£ç  åŸºæœ¬å¼•å…¥æ–¹å¼åœ¨ Rust ä¸­ï¼Œå¼•å…¥æ¨¡å—ä¸­çš„é¡¹æœ‰ä¸¤ç§æ–¹å¼ï¼šç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ 1234567891011121314/// ç»å¯¹è·¯å¾„å¼•å…¥mod front_of_house &#123; pub mod hosting &#123; pub fn add_to_waitlist() &#123;&#125; &#125;&#125;use crate::front_of_house::hosting;pub fn eat_at_restaurant() &#123; hosting::add_to_waitlist(); hosting::add_to_waitlist(); hosting::add_to_waitlist();&#125; ä¸‹é¢çš„ä»£ç æˆ‘ä»¬ç›´æ¥å¼•ç”¨äº†å‡½æ•°æ¥ä½¿ç”¨ï¼š 12345678910111213mod front_of_house &#123; pub mod hosting &#123; pub fn add_to_waitlist() &#123;&#125; &#125;&#125;use front_of_house::hosting::add_to_waitlist;pub fn eat_at_restaurant() &#123; add_to_waitlist(); add_to_waitlist(); add_to_waitlist();&#125; æŸäº›æ—¶å€™ï¼Œå¼•å…¥æ¨¡å—ä¼šæ¯”ç›´æ¥å¼•å…¥å‡½æ•°æ›´å¥½ï¼š éœ€è¦å¼•å…¥åŒä¸€ä¸ªæ¨¡å—çš„å¤šä¸ªå‡½æ•° ä½œç”¨åŸŸä¸­å­˜åœ¨åŒåå‡½æ•° å¯¹äºåŒåå†²çªé—®é¢˜ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ as å…³é”®å­—æ¥è§£å†³ï¼Œå®ƒå¯ä»¥èµ‹äºˆå¼•å…¥é¡¹ä¸€ä¸ªå…¨æ–°çš„åç§°: 12345678910use std::fmt::Result;use std::io::Result as IoResult;fn function1() -&gt; Result &#123; // --snip--&#125;fn function2() -&gt; IoResult&lt;()&gt; &#123; // --snip--&#125; ä½¿ç”¨ {} ç®€åŒ–å¼•å…¥æ–¹å¼123456use std::collections::HashMap;use std::collections::BTreeMap;use std::collections::HashSet;use std::cmp::Ordering;use std::io; å¯¹äºä¸Šé¢çš„å¼•ç”¨ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ &#123;&#125; æ¥ä¸€èµ·å¼•å…¥è¿›æ¥ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ¥å¼•å…¥ï¼Œå¯ä»¥å‡å°‘å¤§é‡ use çš„ä½¿ç”¨ï¼š 12use std::collections::&#123;HashMap,BTreeMap,HashSet&#125;;use std::&#123;cmp::Ordering, io&#125;; ä½¿ç”¨ * å¼•å…¥æ¨¡å—ä¸‹çš„æ‰€æœ‰é¡¹å¯¹äºä¹‹å‰ä¸€è¡Œä¸€è¡Œå¼•å…¥ std::collections çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ 1use std::collections::*; æ³¨é‡Šå’Œæ–‡æ¡£æ³¨é‡Šçš„ç§ç±»åœ¨ Rust ä¸­ï¼Œæ³¨é‡Šåˆ†ä¸ºä¸‰ç±»ï¼š ä»£ç æ³¨é‡Šï¼Œç”¨äºè¯´æ˜æŸä¸€å—ä»£ç çš„åŠŸèƒ½ï¼Œè¯»è€…å¾€å¾€æ˜¯åŒä¸€ä¸ªé¡¹ç›®çš„åä½œå¼€å‘è€… æ–‡æ¡£æ³¨é‡Šï¼Œæ”¯æŒ Markdownï¼Œå¯¹é¡¹ç›®æè¿°ã€å…¬å…± API ç­‰ç”¨æˆ·å…³å¿ƒçš„åŠŸèƒ½è¿›è¡Œä»‹ç»ï¼ŒåŒæ—¶è¿˜èƒ½æä¾›ç¤ºä¾‹ä»£ç ï¼Œç›®æ ‡è¯»è€…å¾€å¾€æ˜¯æƒ³è¦äº†è§£ä½ é¡¹ç›®çš„äºº åŒ…å’Œæ¨¡å—æ³¨é‡Šï¼Œä¸¥æ ¼æ¥è¯´è¿™ä¹Ÿæ˜¯æ–‡æ¡£æ³¨é‡Šä¸­çš„ä¸€ç§ï¼Œå®ƒä¸»è¦ç”¨äºè¯´æ˜å½“å‰åŒ…å’Œæ¨¡å—çš„åŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿…é€Ÿäº†è§£ä¸€ä¸ªé¡¹ç›® ä»£ç æ³¨é‡Šä»£ç æ³¨é‡Šæ–¹å¼æœ‰ä¸¤ç§ï¼š è¡Œæ³¨é‡Š // 123456fn main() &#123; // æˆ‘æ˜¯Sun... // face let name = &quot;sunface&quot;; let age = 18; // ä»Šå¹´å¥½åƒæ˜¯18å²&#125; å—æ³¨é‡Š /* ..... */ 123456789101112fn main() &#123; /* æˆ‘ æ˜¯ S u n ... å“ï¼Œå¥½é•¿! */ let name = &quot;sunface&quot;; let age = &quot;???&quot;; // ä»Šå¹´å…¶å®ã€‚ã€‚ã€‚æŒºå¤§äº†&#125; æ–‡æ¡£æ³¨é‡Šå½“æŸ¥çœ‹ä¸€ä¸ª crates.io ä¸Šçš„åŒ…æ—¶ï¼Œå¾€å¾€éœ€è¦é€šè¿‡å®ƒæä¾›çš„æ–‡æ¡£æ¥æµè§ˆç›¸å…³çš„åŠŸèƒ½ç‰¹æ€§ã€ä½¿ç”¨æ–¹å¼ï¼Œè¿™ç§æ–‡æ¡£å°±æ˜¯é€šè¿‡æ–‡æ¡£æ³¨é‡Šå®ç°çš„ã€‚ Rust æä¾›äº† cargo doc çš„å‘½ä»¤ï¼Œå¯ä»¥ç”¨äºæŠŠè¿™äº›æ–‡æ¡£æ³¨é‡Šè½¬æ¢æˆ HTML ç½‘é¡µæ–‡ä»¶ï¼Œæœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·æµè§ˆï¼Œè¿™æ ·ç”¨æˆ·å°±çŸ¥é“è¿™ä¸ªåŒ…æ˜¯åšä»€ä¹ˆçš„ä»¥åŠè¯¥å¦‚ä½•ä½¿ç”¨ æ–‡æ¡£è¡Œæ³¨é‡Š /// 12345678910111213/// `add_one` å°†æŒ‡å®šå€¼åŠ 1////// # Examples////// ```/// let arg = 5;/// let answer = my_crate::add_one(arg);////// assert_eq!(6, answer);/// ```pub fn add_one(x: i32) -&gt; i32 &#123; x + 1&#125; ä»¥ä¸Šä»£ç æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š æ–‡æ¡£æ³¨é‡Šéœ€è¦ä½äº lib ç±»å‹çš„åŒ…ä¸­ï¼Œä¾‹å¦‚ src/lib.rs ä¸­ æ–‡æ¡£æ³¨é‡Šå¯ä»¥ä½¿ç”¨ markdown è¯­æ³•ï¼ä¾‹å¦‚ # Examples çš„æ ‡é¢˜ï¼Œä»¥åŠä»£ç å—é«˜äº® è¢«æ³¨é‡Šçš„å¯¹è±¡éœ€è¦ä½¿ç”¨ pub å¯¹å¤–å¯è§ï¼Œè®°ä½ï¼šæ–‡æ¡£æ³¨é‡Šæ˜¯ç»™ç”¨æˆ·çœ‹çš„ï¼Œå†…éƒ¨å®ç°ç»†èŠ‚ä¸åº”è¯¥è¢«æš´éœ²å‡ºå» æ–‡æ¡£å—æ³¨é‡Š /** ... */ ä¸ä»£ç æ³¨é‡Šä¸€æ ·ï¼Œæ–‡æ¡£ä¹Ÿæœ‰å—æ³¨é‡Šï¼Œå½“æ³¨é‡Šå†…å®¹å¤šæ—¶ï¼Œä½¿ç”¨å—æ³¨é‡Šå¯ä»¥å‡å°‘ /// çš„ä½¿ç”¨ï¼š 1234567891011/** `add_two` å°†æŒ‡å®šå€¼åŠ 2 let arg = 5; let answer = my_crate::add_two(arg); assert_eq!(7, answer);*/pub fn add_two(x: i32) -&gt; i32 &#123; x + 2&#125; æˆ‘ä»¬ä½¿ç”¨ cargo doc --open å‘½ä»¤ï¼Œå¯ä»¥åœ¨ç”Ÿæˆæ–‡æ¡£åï¼Œè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘é¡µ åœ¨æ–‡æ¡£æ³¨é‡Šä¸­å¯ä»¥ä½¿ç”¨ markdownï¼Œå…¶ä¸­åŒ…æ‹¬ # Examples æ ‡é¢˜ã€‚é™¤äº†è¿™ä¸ªæ ‡é¢˜ï¼Œè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­é…Œæƒ…ä½¿ç”¨ï¼š Panicsï¼šå‡½æ•°å¯èƒ½ä¼šå‡ºç°çš„å¼‚å¸¸çŠ¶å†µï¼Œè¿™æ ·è°ƒç”¨å‡½æ•°çš„äººå°±å¯ä»¥æå‰è§„é¿ Errorsï¼šæè¿°å¯èƒ½å‡ºç°çš„é”™è¯¯åŠä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´é”™è¯¯ï¼Œæœ‰åŠ©äºè°ƒç”¨è€…é’ˆå¯¹ä¸åŒçš„é”™è¯¯é‡‡å–ä¸åŒçš„å¤„ç†æ–¹å¼ Safetyï¼šå¦‚æœå‡½æ•°ä½¿ç”¨ unsafe ä»£ç ï¼Œé‚£ä¹ˆè°ƒç”¨è€…å°±éœ€è¦æ³¨æ„ä¸€äº›ä½¿ç”¨æ¡ä»¶ï¼Œä»¥ç¡®ä¿ unsafe ä»£ç å—çš„æ­£å¸¸å·¥ä½œ åŒ…å’Œæ¨¡å—çº§åˆ«çš„æ³¨é‡Šæˆ‘ä»¬å¯ä»¥ç»™åŒ…å’Œæ¨¡å—æ·»åŠ æ³¨é‡Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ³¨é‡Šè¦æ·»åŠ åˆ°åŒ…ã€æ¨¡å—çš„æœ€ä¸Šæ–¹ï¼ ä¸ä¹‹å‰çš„ä»»ä½•æ³¨é‡Šä¸€æ ·ï¼ŒåŒ…çº§åˆ«çš„æ³¨é‡Šä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼šè¡Œæ³¨é‡Š //! å’Œå—æ³¨é‡Š /*! ... */ã€‚ ç°åœ¨ï¼Œä¸ºæˆ‘ä»¬çš„åŒ…å¢åŠ æ³¨é‡Šï¼Œåœ¨ src/lib.rs åŒ…æ ¹çš„æœ€ä¸Šæ–¹ï¼Œæ·»åŠ ï¼š 1234/*! libåŒ…æ˜¯world_helloäºŒè¿›åˆ¶åŒ…çš„ä¾èµ–åŒ…ï¼Œ é‡Œé¢åŒ…å«äº†computeç­‰æœ‰ç”¨æ¨¡å— */pub mod compute; ç„¶åå†ä¸ºè¯¥åŒ…æ ¹çš„å­æ¨¡å— src/compute.rs æ·»åŠ æ³¨é‡Šï¼š 12345//! è®¡ç®—ä¸€äº›ä½ å£ç®—ç®—ä¸å‡ºæ¥çš„å¤æ‚ç®—æœ¯é¢˜/// `add_one`å°†æŒ‡å®šå€¼åŠ 1/// æ–‡æ¡£æµ‹è¯•(Doc Test)Rust å…è®¸æˆ‘ä»¬åœ¨æ–‡æ¡£æ³¨é‡Šä¸­å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ 12345678910111213/// `add_one` å°†æŒ‡å®šå€¼åŠ 1////// # Examples11////// ```/// let arg = 5;/// let answer = world_hello::compute::add_one(arg);////// assert_eq!(6, answer);/// ```pub fn add_one(x: i32) -&gt; i32 &#123; x + 1&#125; ä»¥ä¸Šçš„æ³¨é‡Šä¸ä»…ä»…æ˜¯æ–‡æ¡£ï¼Œè¿˜å¯ä»¥ä½œä¸ºå•å…ƒæµ‹è¯•çš„ç”¨ä¾‹è¿è¡Œï¼Œä½¿ç”¨ cargo test è¿è¡Œæµ‹è¯• æ–‡æ¡£æµ‹è¯•ä¸­çš„ç”¨ä¾‹è¿˜å¯ä»¥é€ æˆ panicï¼š 123456789101112131415/// # Panics////// The function panics if the second argument is zero.////// ```rust/// // panics on division by zero/// world_hello::compute::div(10, 0);/// ```pub fn div(a: i32, b: i32) -&gt; i32 &#123; if b == 0 &#123; panic!(&quot;Divide-by-zero error&quot;); &#125; a / b&#125; åœ¨æŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿ç•™æ–‡æ¡£æµ‹è¯•çš„åŠŸèƒ½ï¼Œä½†æ˜¯åˆè¦å°†æŸäº›æµ‹è¯•ç”¨ä¾‹çš„å†…å®¹ä»æ–‡æ¡£ä¸­éšè—èµ·æ¥ï¼š 123456789101112131415161718/// ```/// # // ä½¿ç”¨#å¼€å¤´çš„è¡Œä¼šåœ¨æ–‡æ¡£ä¸­è¢«éšè—èµ·æ¥ï¼Œä½†æ˜¯ä¾ç„¶ä¼šåœ¨æ–‡æ¡£æµ‹è¯•ä¸­è¿è¡Œ/// # fn try_main() -&gt; Result&lt;(), String&gt; &#123;/// let res = world_hello::compute::try_div(10, 0)?;/// # Ok(()) // returning from try_main/// # &#125;/// # fn main() &#123;/// # try_main().unwrap();/// #/// # &#125;/// ```pub fn try_div(a: i32, b: i32) -&gt; Result&lt;i32, String&gt; &#123; if b == 0 &#123; Err(String::from(&quot;Divide-by-zero&quot;)) &#125; else &#123; Ok(a / b) &#125;&#125; æ–‡æ¡£æ³¨é‡Šä¸­çš„ä»£ç è·³è½¬Rust åœ¨æ–‡æ¡£æ³¨é‡Šä¸­è¿˜æä¾›äº†ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯å¯ä»¥å®ç°å¯¹å¤–éƒ¨é¡¹çš„é“¾æ¥ï¼š è·³è½¬åˆ°æ ‡å‡†åº“ 1234/// `add_one` è¿”å›ä¸€ä¸ª[`Option`]ç±»å‹pub fn add_one(x: i32) -&gt; Option&lt;i32&gt; &#123; Some(x + 1)&#125; æ–‡æ¡£æœç´¢åˆ«åRust æ–‡æ¡£æ”¯æŒæœç´¢åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè‡ªå·±çš„ç±»å‹å®šä¹‰å‡ ä¸ªåˆ«åï¼Œä»¥å®ç°æ›´å¥½çš„æœç´¢å±•ç°ï¼Œå½“åˆ«åå‘½ä¸­æ—¶ï¼Œæœç´¢ç»“æœä¼šè¢«æ”¾åœ¨ç¬¬ä¸€ä½ï¼š 123456#[doc(alias = &quot;x&quot;)]#[doc(alias = &quot;big&quot;)]pub struct BigX;#[doc(alias(&quot;y&quot;, &quot;big&quot;))]pub struct BigY; åœ¨ Rust ä¸­ï¼Œæ³¨é‡Šåˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç±»å‹ï¼šä»£ç æ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Šã€åŒ…å’Œæ¨¡å—æ³¨é‡Šï¼Œæ¯ä¸ªæ³¨é‡Šç±»å‹éƒ½æ‹¥æœ‰ä¸¤ç§å½¢å¼ï¼šè¡Œæ³¨é‡Šå’Œå—æ³¨é‡Šï¼Œç†Ÿç»ƒæŒæ¡åŒ…æ¨¡å—å’Œæ³¨é‡Šçš„çŸ¥è¯†ï¼Œéå¸¸æœ‰åŠ©äºæˆ‘ä»¬åˆ›å»ºå·¥ç¨‹æ€§æ›´å¼ºçš„é¡¹ç›® æ ¼å¼åŒ–è¾“å‡ºæ ¼å¼åŒ–è¾“å‡ºï¼ŒRust æä¾› println! å®æ¥å—çš„æ˜¯å¯å˜å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œå®ƒè¡¨ç¤ºæœ€ç»ˆè¾“å‡ºå­—ç¬¦ä¸²çš„æ ¼å¼ï¼ŒåŒ…å«å…¶ä¸­å½¢å¦‚ &#123;&#125; çš„ç¬¦å·æ˜¯å ä½ç¬¦ï¼Œä¼šè¢« println! åé¢çš„å‚æ•°ä¾æ¬¡æ›¿æ¢ print!ï¼Œprintln!ï¼Œformatå®ƒä»¬æ˜¯ Rust ä¸­ç”¨æ¥æ ¼å¼åŒ–è¾“å‡ºçš„ä¸‰å¤§é‡‘åˆšï¼Œç”¨é€”å¦‚ä¸‹ï¼š print! å°†æ ¼å¼åŒ–æ–‡æœ¬è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸å¸¦æ¢è¡Œç¬¦ println! åŒä¸Šï¼Œä½†æ˜¯åœ¨è¡Œçš„æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦ format! å°†æ ¼å¼åŒ–æ–‡æœ¬è¾“å‡ºåˆ° String å­—ç¬¦ä¸² åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ println! åŠ format!ï¼Œå‰è€…å¸¸ç”¨æ¥è°ƒè¯•è¾“å‡ºï¼Œåè€…å¸¸ç”¨æ¥ç”Ÿæˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼š 1234567fn main() &#123; let s = &quot;hello&quot;; println!(&quot;&#123;&#125;, world&quot;, s); let s1 = format!(&quot;&#123;&#125;, world&quot;, s); print!(&quot;&#123;&#125;&quot;, s1); print!(&quot;&#123;&#125;\\n&quot;, &quot;!&quot;);&#125; é™¤äº†ä¸Šè¿°ä¸‰ç§è¾“å‡ºæ–¹å¼å¤–ï¼ŒRust è¿˜æä¾›äº† eprint!ï¼Œeprintln!ï¼Œå®ƒä»¬è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼š 1eprintln!(&quot;Error: Could not complete task&quot;) {} ä¸ {:?}åœ¨ Rust ä¸­ï¼Œ&#123;&#125; ä½œä¸ºæ ¼å¼åŒ–å ä½ç¬¦ï¼Œæˆ‘ä»¬æ— éœ€å†ä¸ºç‰¹å®šçš„ç±»å‹é€‰æ‹©ç‰¹å®šçš„å ä½ç¬¦ï¼Œç»Ÿä¸€ç”¨ &#123;&#125; æ¥æ›¿ä»£å³å¯ã€‚ ä¸ &#123;&#125; ç±»ä¼¼ï¼Œ&#123;:?&#125; ä¹Ÿæ˜¯å ä½ç¬¦ï¼š &#123;&#125; é€‚ç”¨äºå®ç°äº† std::fmt::Display ç‰¹å¾çš„ç±»å‹ï¼Œç”¨äºæ ¼å¼åŒ–æ–‡æœ¬ &#123;:?&#125; é€‚ç”¨äºå®ç°äº† std::fmt::Debug ç‰¹å¾çš„ç±»å‹ï¼Œç”¨äºè°ƒè¯•åœºæ™¯ 12345678910111213#[derive(Debug)]struct Person &#123; name: String, age: u8&#125;fn main() &#123; let i = 3.1415926; let s = String::from(&quot;hello&quot;); let v = vec![1, 2, 3]; let p = Person&#123;name: &quot;sunface&quot;.to_string(), age: 18&#125;; println!(&quot;&#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;&quot;, i, s, v, p);&#125; å¯¹äºæ•°å€¼ã€å­—ç¬¦ä¸²ã€æ•°ç»„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &#123;:?&#125; è¿›è¡Œè¾“å‡ºï¼Œä½†æ˜¯å¯¹äºç»“æ„ä½“ï¼Œéœ€è¦æ´¾ç”Ÿ Debug ç‰¹å¾åï¼Œæ‰èƒ½è¿›è¡Œè¾“å‡º &#123;:#?&#125; ä¸ &#123;:?&#125; å‡ ä¹ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒèƒ½æ›´ä¼˜ç¾åœ°è¾“å‡ºå†…å®¹ï¼š 1234567891011// &#123;:?&#125;[1, 2, 3], Person &#123; name: &quot;sunface&quot;, age: 18 &#125;// &#123;:#?&#125;[ 1, 2, 3,], Person &#123; name: &quot;sunface&quot;,&#125; å› æ­¤å¯¹äº Display ä¸æ”¯æŒçš„ç±»å‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ &#123;:#?&#125; è¿›è¡Œæ ¼å¼åŒ– ä½ç½®å‚æ•°é™¤äº†æŒ‰ç…§ä¾æ¬¡é¡ºåºä½¿ç”¨å€¼å»æ›¿æ¢å ä½ç¬¦ä¹‹å¤–ï¼Œè¿˜èƒ½è®©æŒ‡å®šä½ç½®çš„å‚æ•°å»æ›¿æ¢æŸä¸ªå ä½ç¬¦ 1234567fn main() &#123; println!(&quot;&#123;&#125;&#123;&#125;&quot;, 1, 2); // =&gt;&quot;12&quot; println!(&quot;&#123;1&#125;&#123;0&#125;&quot;, 1, 2); // =&gt;&quot;21&quot; // =&gt; Alice, this is Bob. Bob, this is Alice println!(&quot;&#123;0&#125;, this is &#123;1&#125;. &#123;1&#125;, this is &#123;0&#125;&quot;, &quot;Alice&quot;, &quot;Bob&quot;); println!(&quot;&#123;1&#125;&#123;&#125;&#123;0&#125;&#123;&#125;&quot;, 1, 2); // =&gt; 2112&#125; å…·åå‚æ•°é™¤äº†åƒä¸Šé¢é‚£æ ·æŒ‡å®šä½ç½®å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå‚æ•°æŒ‡å®šåç§°ï¼š 12345fn main() &#123; println!(&quot;&#123;argument&#125;&quot;, argument = &quot;test&quot;); // =&gt; &quot;test&quot; println!(&quot;&#123;name&#125; &#123;&#125;&quot;, 1, name = 2); // =&gt; &quot;2 1&quot; println!(&quot;&#123;a&#125; &#123;c&#125; &#123;b&#125;&quot;, a = &quot;a&quot;, b = &#x27;b&#x27;, c = 3); // =&gt; &quot;a 3 b&quot;&#125; æ ¼å¼åŒ–å‚æ•°æ ¼å¼åŒ–è¾“å‡ºï¼Œæ„å‘³ç€å¯¹è¾“å‡ºæ ¼å¼ä¼šæœ‰æ›´å¤šçš„è¦æ±‚ï¼Œä¾‹å¦‚åªè¾“å‡ºæµ®ç‚¹æ•°çš„å°æ•°ç‚¹åä¸¤ä½ï¼š 1234567fn main() &#123; let v = 3.1415926; // Display =&gt; 3.14 println!(&quot;&#123;:.2&#125;&quot;, v); // Debug =&gt; 3.14 println!(&quot;&#123;:.2?&#125;&quot;, v);&#125; å®½åº¦å®½åº¦ç”¨æ¥æŒ‡ç¤ºè¾“å‡ºç›®æ ‡çš„é•¿åº¦ï¼Œå¦‚æœé•¿åº¦ä¸å¤Ÿï¼Œåˆ™è¿›è¡Œå¡«å……å’Œå¯¹é½ï¼š å­—ç¬¦ä¸²å¡«å……ï¼Œå­—ç¬¦ä¸²æ ¼å¼åŒ–é»˜è®¤ä½¿ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……ï¼Œå¹¶ä¸”è¿›è¡Œå·¦å¯¹é½ã€‚ 12345678910111213141516fn main() &#123; //----------------------------------- // ä»¥ä¸‹å…¨éƒ¨è¾“å‡º &quot;Hello x !&quot; // ä¸º&quot;x&quot;åé¢å¡«å……ç©ºæ ¼ï¼Œè¡¥é½å®½åº¦5 println!(&quot;Hello &#123;:5&#125;!&quot;, &quot;x&quot;); // ä½¿ç”¨å‚æ•°5æ¥æŒ‡å®šå®½åº¦ println!(&quot;Hello &#123;:1$&#125;!&quot;, &quot;x&quot;, 5); // ä½¿ç”¨xä½œä¸ºå ä½ç¬¦è¾“å‡ºå†…å®¹ï¼ŒåŒæ—¶ä½¿ç”¨5ä½œä¸ºå®½åº¦ println!(&quot;Hello &#123;1:0$&#125;!&quot;, 5, &quot;x&quot;); // ä½¿ç”¨æœ‰åç§°çš„å‚æ•°ä½œä¸ºå®½åº¦ println!(&quot;Hello &#123;:width$&#125;!&quot;, &quot;x&quot;, width = 5); //----------------------------------- // ä½¿ç”¨å‚æ•°5ä¸ºå‚æ•°xæŒ‡å®šå®½åº¦ï¼ŒåŒæ—¶åœ¨ç»“å°¾è¾“å‡ºå‚æ•°5 =&gt; Hello x !5 println!(&quot;Hello &#123;:1$&#125;!&#123;&#125;&quot;, &quot;x&quot;, 5);&#125; æ•°å­—å¡«å……:ç¬¦å·å’Œ 0, æ•°å­—æ ¼å¼åŒ–é»˜è®¤ä¹Ÿæ˜¯ä½¿ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……ï¼Œä½†ä¸å­—ç¬¦ä¸²å·¦å¯¹é½ä¸åŒçš„æ˜¯ï¼Œæ•°å­—æ˜¯å³å¯¹é½ã€‚ 12345678910fn main() &#123; // å®½åº¦æ˜¯5 =&gt; Hello 5! println!(&quot;Hello &#123;:5&#125;!&quot;, 5); // æ˜¾å¼çš„è¾“å‡ºæ­£å· =&gt; Hello +5! println!(&quot;Hello &#123;:+&#125;!&quot;, 5); // å®½åº¦5ï¼Œä½¿ç”¨0è¿›è¡Œå¡«å…… =&gt; Hello 00005! println!(&quot;Hello &#123;:05&#125;!&quot;, 5); // è´Ÿå·ä¹Ÿè¦å ç”¨ä¸€ä½å®½åº¦ =&gt; Hello -0005! println!(&quot;Hello &#123;:05&#125;!&quot;, -5);&#125; å¯¹é½ 12345678910111213fn main() &#123; // ä»¥ä¸‹å…¨éƒ¨éƒ½ä¼šè¡¥é½5ä¸ªå­—ç¬¦çš„é•¿åº¦ // å·¦å¯¹é½ =&gt; Hello x ! println!(&quot;Hello &#123;:&lt;5&#125;!&quot;, &quot;x&quot;); // å³å¯¹é½ =&gt; Hello x! println!(&quot;Hello &#123;:&gt;5&#125;!&quot;, &quot;x&quot;); // å±…ä¸­å¯¹é½ =&gt; Hello x ! println!(&quot;Hello &#123;:^5&#125;!&quot;, &quot;x&quot;); // å¯¹é½å¹¶ä½¿ç”¨æŒ‡å®šç¬¦å·å¡«å…… =&gt; Hello x&amp;&amp;&amp;&amp;! // æŒ‡å®šç¬¦å·å¡«å……çš„å‰ææ¡ä»¶æ˜¯å¿…é¡»æœ‰å¯¹é½å­—ç¬¦ println!(&quot;Hello &#123;:&amp;&lt;5&#125;!&quot;, &quot;x&quot;);&#125; ç²¾åº¦, ç²¾åº¦å¯ä»¥ç”¨äºæ§åˆ¶æµ®ç‚¹æ•°çš„ç²¾åº¦æˆ–è€…å­—ç¬¦ä¸²çš„é•¿åº¦ 1234567891011121314151617fn main() &#123; let v = 3.1415926; // ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ =&gt; 3.14 println!(&quot;&#123;:.2&#125;&quot;, v); // å¸¦ç¬¦å·ä¿ç•™å°æ•°ç‚¹åä¸¤ä½ =&gt; +3.14 println!(&quot;&#123;:+.2&#125;&quot;, v); // ä¸å¸¦å°æ•° =&gt; 3 println!(&quot;&#123;:.0&#125;&quot;, v); // é€šè¿‡å‚æ•°æ¥è®¾å®šç²¾åº¦ =&gt; 3.1416ï¼Œç›¸å½“äº&#123;:.4&#125; println!(&quot;&#123;:.1$&#125;&quot;, v, 4); let s = &quot;hiæˆ‘æ˜¯Sunfaceå­™é£&quot;; // ä¿ç•™å­—ç¬¦ä¸²å‰ä¸‰ä¸ªå­—ç¬¦ =&gt; hiæˆ‘ println!(&quot;&#123;:.3&#125;&quot;, s); // &#123;:.*&#125;æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç²¾åº¦ï¼Œç¬¬äºŒä¸ªæ˜¯è¢«æ ¼å¼åŒ–çš„å€¼ =&gt; Hello abc! println!(&quot;Hello &#123;:.*&#125;!&quot;, 3, &quot;abcdefg&quot;);&#125; è¿›åˆ¶, å¯ä»¥ä½¿ç”¨ #å·æ¥æ§åˆ¶æ•°å­—çš„è¿›åˆ¶è¾“å‡ºï¼š #b, äºŒè¿›åˆ¶ #o, å…«è¿›åˆ¶ #x, å°å†™åå…­è¿›åˆ¶ #X, å¤§å†™åå…­è¿›åˆ¶ x, ä¸å¸¦å‰ç¼€çš„å°å†™åå…­è¿›åˆ¶ 123456789101112131415161718fn main() &#123; // äºŒè¿›åˆ¶ =&gt; 0b11011! println!(&quot;&#123;:#b&#125;!&quot;, 27); // å…«è¿›åˆ¶ =&gt; 0o33! println!(&quot;&#123;:#o&#125;!&quot;, 27); // åè¿›åˆ¶ =&gt; 27! println!(&quot;&#123;&#125;!&quot;, 27); // å°å†™åå…­è¿›åˆ¶ =&gt; 0x1b! println!(&quot;&#123;:#x&#125;!&quot;, 27); // å¤§å†™åå…­è¿›åˆ¶ =&gt; 0x1B! println!(&quot;&#123;:#X&#125;!&quot;, 27); // ä¸å¸¦å‰ç¼€çš„åå…­è¿›åˆ¶ =&gt; 1b! println!(&quot;&#123;:x&#125;!&quot;, 27); // ä½¿ç”¨0å¡«å……äºŒè¿›åˆ¶ï¼Œå®½åº¦ä¸º10 =&gt; 0b00011011! println!(&quot;&#123;:#010b&#125;!&quot;, 27);&#125; æŒ‡æ•° 1234fn main() &#123; println!(&quot;&#123;:2e&#125;&quot;, 1000000000); // =&gt; 1e9 println!(&quot;&#123;:2E&#125;&quot;, 1000000000); // =&gt; 1E9&#125; æŒ‡é’ˆåœ°å€ 12let v= vec![1, 2, 3];println!(&quot;&#123;:p&#125;&quot;, v.as_ptr()) // =&gt; 0x600002324050 è½¬ä¹‰, æœ‰æ—¶éœ€è¦è¾“å‡º &#123; å’Œ &#125;ï¼Œä½†è¿™ä¸¤ä¸ªå­—ç¬¦æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦è¿›è¡Œè½¬ä¹‰ï¼š 12345678910fn main() &#123; // &quot;&#123;&#123;&quot; è½¬ä¹‰ä¸º &#x27;&#123;&#x27; &quot;&#125;&#125;&quot; è½¬ä¹‰ä¸º &#x27;&#125;&#x27; &quot;\\&quot;&quot; è½¬ä¹‰ä¸º &#x27;&quot;&#x27; // =&gt; Hello &quot;&#123;World&#125;&quot; println!(&quot; Hello \\&quot;&#123;&#123;World&#125;&#125;\\&quot; &quot;); // ä¸‹é¢ä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºå ä½ç¬¦&#123;&#125;åªæœ‰ä¸€ä¸ªå³æ‹¬å·&#125;ï¼Œå·¦æ‹¬å·è¢«è½¬ä¹‰æˆå­—ç¬¦ä¸²çš„å†…å®¹ // println!(&quot; &#123;&#123; Hello &#125; &quot;); // ä¹Ÿä¸å¯ä½¿ç”¨ &#x27;\\&#x27; æ¥è½¬ä¹‰ &quot;&#123;&#125;&quot; // println!(&quot; \\&#123; Hello \\&#125; &quot;)&#125; åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶æ•è·ç¯å¢ƒä¸­çš„å€¼1234567fn get_person() -&gt; String &#123; String::from(&quot;sunface&quot;)&#125;fn main() &#123; let person = get_person(); println!(&quot;Hello, &#123;person&#125;!&quot;);&#125; å¯ä»¥å°†ç¯å¢ƒä¸­çš„å€¼ç”¨äºæ ¼å¼åŒ–å‚æ•°: 1234let (width, precision) = get_format();for (name, score) in get_scores() &#123; println!(&quot;&#123;name&#125;: &#123;score:width$.precision$&#125;&quot;);&#125; é«˜çº§è¿›é˜¶æ·±å…¥ç”Ÿå‘½å‘¨æœŸ1234567891011121314#[derive(Debug)]struct Foo;impl Foo &#123; fn mutate_and_share(&amp;mut self) -&gt; &amp;Self &#123; &amp;*self &#125; fn share(&amp;self) &#123;&#125;&#125;fn main() &#123; let mut foo = Foo; let loan = foo.mutate_and_share(); foo.share(); println!(&quot;&#123;:?&#125;&quot;, loan);&#125; å¯å˜å€Ÿç”¨ä»…åœ¨ mutate_and_share æ–¹æ³•å†…éƒ¨æœ‰æ•ˆï¼Œå‡ºäº†è¯¥æ–¹æ³•åï¼Œå°±åªæœ‰è¿”å›çš„ä¸å¯å˜å€Ÿç”¨ï¼Œç†è®ºä¸Šå¯å˜å€Ÿç”¨ä¸åº”è¯¥åœ¨mainèŒƒå›´å†… &amp;mut foo å’Œ loan çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œç”±äºç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤è§„åˆ™ç¬¬ä¸‰æ¡ï¼šå‚æ•°&amp;mut selfå’Œè¿”å›å€¼&amp;selfç”Ÿå‘½å‘¨æœŸç›¸åŒï¼Œæ‰€ä»¥è¿”å›å€¼çš„å‘¨æœŸåœ¨mianä¸­æœ‰æ•ˆï¼Œé‚£ä¹ˆå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿåœ¨mainä¸­æœ‰æ•ˆï¼Œå¯¼è‡´æ— æ³•å‡ºç°æ›´å¤šçš„å¯å˜ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯å‡½æ•°share()çš„å‚æ•° 123456789101112131415161718#![allow(unused)]fn main() &#123; use std::collections::HashMap; use std::hash::Hash; fn get_default&lt;&#x27;m, K, V&gt;(map: &amp;&#x27;m mut HashMap&lt;K, V&gt;, key: K) -&gt; &amp;&#x27;m mut V where K: Clone + Eq + Hash, V: Default, &#123; match map.get_mut(&amp;key) &#123; Some(value) =&gt; value, None =&gt; &#123; map.insert(key.clone(), V::default()); map.get_mut(&amp;key).unwrap() &#125; &#125; &#125;&#125; è¿™æ®µä»£ç ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„åŸå› æ˜¯ç¼–è¯‘å™¨æœªèƒ½ç²¾ç¡®åœ°åˆ¤æ–­å‡ºæŸä¸ªå¯å˜å€Ÿç”¨ä¸å†éœ€è¦ï¼Œåè€Œè°¨æ…çš„ç»™è¯¥å€Ÿç”¨å®‰æ’äº†ä¸€ä¸ªå¾ˆå¤§çš„ä½œç”¨åŸŸï¼Œç»“æœå¯¼è‡´åç»­çš„å€Ÿç”¨å¤±è´¥ã€‚åˆ†æä»£ç å¯çŸ¥åœ¨ match map.get_mut(&amp;key) æ–¹æ³•è°ƒç”¨å®Œæˆåï¼Œå¯¹ map çš„å¯å˜å€Ÿç”¨å°±å¯ä»¥ç»“æŸäº†ã€‚ä½†ä»æŠ¥é”™çœ‹æ¥ï¼Œç¼–è¯‘å™¨ä¸å¤ªèªæ˜ï¼Œå®ƒè®¤ä¸ºè¯¥å€Ÿç”¨ä¼šæŒç»­åˆ°æ•´ä¸ª match è¯­å¥å—çš„ç»“æŸ(ç¬¬ 16 è¡Œå¤„)ï¼Œè¿™ä¾¿é€ æˆäº†åç»­å€Ÿç”¨çš„å¤±è´¥ã€‚ ç”Ÿå‘½å‘¨æœŸçº¦æŸHRTB&#39;a:&#39;bï¼Œè¡¨ç¤º &#39;a è‡³å°‘è¦æ´»å¾—è·Ÿ &#39;b ä¸€æ ·ä¹… 1234struct DoubleRef&lt;&#x27;a,&#x27;b:&#x27;a, T&gt; &#123; r: &amp;&#x27;a T, s: &amp;&#x27;b T&#125; T: â€˜a è¡¨ç¤ºç±»å‹ T å¿…é¡»æ¯” &#39;a æ´»å¾—è¦ä¹…ï¼š 1234567struct Ref&lt;&#x27;a, T: &#x27;a&gt; &#123; r: &amp;&#x27;a T&#125;//å› æ­¤ r çš„ç”Ÿå‘½å‘¨æœŸ &#x27;a å¿…é¡»è¦æ¯” T çš„ç”Ÿå‘½å‘¨æœŸæ›´çŸ­ï¼Œè¢«å¼•ç”¨è€…çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»è¦æ¯”å¼•ç”¨é•¿ //ç­‰åŒäºstruct Ref&lt;&#x27;a, T&gt; &#123; r: &amp;&#x27;a T&#125; é—­åŒ…å‡½æ•°çš„æ¶ˆé™¤è§„åˆ™12fn fn_elision(x: &amp;i32) -&gt; &amp;i32 &#123; x &#125;let closure_slision = |x: &amp;i32| -&gt; &amp;i32 &#123; x &#125;; é—­åŒ…å’Œå‡½æ•°ä¸åŒï¼Œä¸é€‚ç”¨å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤ NLLå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä»å€Ÿç”¨å¤„å¼€å§‹ï¼Œä¸€ç›´æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹ã€‚å‡å°‘äº†å¾ˆå¤šå†²çª Reborrowå†å€Ÿç”¨123let r = &amp;mut p;// reborrow! æ­¤æ—¶å¯¹`r`çš„å†å€Ÿç”¨ä¸ä¼šå¯¼è‡´è·Ÿä¸Šé¢çš„å€Ÿç”¨å†²çªlet rr: &amp;Point = &amp;*r; ä½†æ˜¯ä¸èƒ½åœ¨rrçš„ç”Ÿå‘½å‘¨æœŸå†…å†ä½¿ç”¨åŸæ¥çš„å€Ÿç”¨ r &amp;â€™static å’Œ T: â€˜static&#39;static æ˜¯ç›¸å½“å¸¸è§çš„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²å­—é¢å€¼å°±å…·æœ‰ &#39;static ç”Ÿå‘½å‘¨æœŸï¼Œè¿˜æœ‰ç‰¹å¾å¯¹è±¡ã€‚ &amp;&#39;static ä¸€ä¸ªå¼•ç”¨å¿…é¡»è¦æ´»å¾—è·Ÿå‰©ä¸‹çš„ç¨‹åºä¸€æ ·ä¹…ï¼Œæ‰èƒ½è¢«æ ‡æ³¨ä¸º &amp;&#39;staticã€‚&amp;&#39;static ç”Ÿå‘½å‘¨æœŸé’ˆå¯¹çš„ä»…ä»…æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯æŒæœ‰è¯¥å¼•ç”¨çš„å˜é‡ï¼Œå¯¹äºå˜é‡æ¥è¯´ï¼Œè¿˜æ˜¯è¦éµå¾ªç›¸åº”çš„ä½œç”¨åŸŸè§„åˆ™ã€‚ 1234let string = &quot;Hello World!&quot;;//â€œHello Worldâ€ æ˜¯å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› æ­¤å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ `&#x27;static`//ä½†æŒæœ‰å®ƒçš„å˜é‡ `string` çš„ç”Ÿå‘½å‘¨æœŸå°±ä¸ä¸€æ ·äº†ï¼Œå®ƒå®Œå…¨å–å†³äºå˜é‡ä½œç”¨åŸŸ//è™½ç„¶å˜é‡è¢«é‡Šæ”¾ï¼Œæ— æ³•å†è¢«è®¿é—®ï¼Œä½†æ˜¯æ•°æ®ä¾ç„¶è¿˜ä¼šç»§ç»­å­˜æ´»ï¼Œå¯ä»¥é€šè¿‡è£¸æŒ‡é’ˆè®¿é—®åˆ°è¿™ä¸ªæ•°æ® T: &#39;static ä¸ &amp;&#39;static æœ‰ç›¸åŒçš„çº¦æŸï¼šTå¿…é¡»æ´»å¾—å’Œç¨‹åºä¸€æ ·ä¹…ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç”¨çš„&amp;Tï¼Œé‚£ä¹ˆä¸ä¼šå»æ£€æŸ¥T å‡½æ•°å¼ç¼–ç¨‹ï¼šé—­åŒ…å’Œè¿­ä»£å™¨é—­åŒ… Closureé—­åŒ…æ˜¯ä¸€ç§åŒ¿åå‡½æ•° 123let x = 1;let sum = |y| x + y;assert_eq!(3, sum(2)); ä¸Šé¢ä»£ç ä¸­çš„ sum å°±æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå®ƒæœ‰ä¸€ä¸ªå…¥å‚ yï¼ŒåŒæ—¶ï¼Œå®ƒæ•è·äº†ä½œç”¨åŸŸä¸­çš„ xï¼Œæœ€åè¿”å›ä¸¤è€…ç›¸åŠ çš„ç»“æœ 12345|param1, param2,...| &#123; è¯­å¥1; è¯­å¥2; è¿”å›è¡¨è¾¾å¼&#125; å¦‚æœåªæœ‰ä¸€ä¸ªè¿”å›è¡¨è¾¾å¼çš„è¯ï¼Œå®šä¹‰å¯ä»¥ç®€åŒ–ä¸ºï¼š 1|param1| è¿”å›è¡¨è¾¾å¼ Rust æ˜¯é™æ€è¯­è¨€ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ç¼–è¯‘å™¨éƒ½æ˜¯è‡ªåŠ¨æ¨å¯¼ç±»å‹ï¼Œè€Œæ— éœ€æ˜¾å¼çš„å£°æ˜ï¼Œè€Œå‡½æ•°åˆ™ä¸è¡Œï¼Œå¿…é¡»æ‰‹åŠ¨ä¸ºå‡½æ•°çš„æ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼æŒ‡å®šç±»å‹ã€‚ä¸å‡½æ•°ç›¸åï¼Œé—­åŒ…å¹¶ä¸ä¼šä½œä¸º API å¯¹å¤–æä¾›ï¼Œå› æ­¤å®ƒå¯ä»¥äº«å—ç¼–è¯‘å™¨çš„ç±»å‹æ¨å¯¼èƒ½åŠ›ï¼Œæ— éœ€æ ‡æ³¨å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚ ä¸ºäº†å¢åŠ ä»£ç å¯è¯»æ€§ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šæ˜¾å¼åœ°ç»™ç±»å‹è¿›è¡Œæ ‡æ³¨ï¼Œå‡ºäºåŒæ ·çš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥ç»™é—­åŒ…æ ‡æ³¨ç±»å‹ï¼š 123let sum = |x: i32, y: i32| -&gt; i32 &#123; x + y&#125; ç»“æ„ä½“ä¸­çš„é—­åŒ… å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾è®¡ä¸€ä¸ªç¼“å­˜ï¼Œç”¨ç»“æ„ä½“æ¥æ ‡è¯†ç¼“å­˜å¯¹è±¡ 12345678910struct Cacher&lt;T&gt;where T: Fn(u32) -&gt; u32,&#123; query: T, value: Option&lt;u32&gt;,&#125;//queryçš„ç±»å‹æ˜¯T//`query` æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œ`Fn(u32) -&gt; u32` æ˜¯ä¸€ä¸ªç‰¹å¾ï¼Œç”¨æ¥è¡¨ç¤º `T` æ˜¯ä¸€ä¸ªé—­åŒ…ç±»å‹//è¯¥é—­åŒ…æ‹¥æœ‰ä¸€ä¸ªu32ç±»å‹çš„å‚æ•°ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªu32ç±»å‹çš„å€¼ã€‚ æ¥ç€ï¼Œä¸ºç¼“å­˜å®ç°æ–¹æ³•ï¼š 1234567891011121314151617181920212223struct Cacher&lt;T&gt;impl&lt;T&gt; Cacher&lt;T&gt;where T: Fn(u32) -&gt; u32,&#123; fn new(query: T) -&gt; Cacher&lt;T&gt; &#123; Cacher &#123; query, value: None, &#125; &#125; // å…ˆæŸ¥è¯¢ç¼“å­˜å€¼ `self.value`ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ `query` åŠ è½½ fn value(&amp;mut self, arg: u32) -&gt; u32 &#123; match self.value &#123; Some(v) =&gt; v, None =&gt; &#123; let v = (self.query)(arg); self.value = Some(v); v &#125; &#125; &#125;&#125; ä¸‰ç§Fnç‰¹æ€§è¿­ä»£å™¨ Iteratorè¿­ä»£å™¨å…è®¸æˆ‘ä»¬è¿­ä»£ä¸€ä¸ªè¿ç»­çš„é›†åˆï¼Œä¾‹å¦‚æ•°ç»„ã€åŠ¨æ€æ•°ç»„ Vecã€HashMap ç­‰ è¿­ä»£å™¨ä¸ for å¾ªç¯å¾ˆç›¸ä¼¼ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºæ˜¯å¦é€šè¿‡ç´¢å¼•æ¥è®¿é—®é›†åˆ 1234let arr = [1, 2, 3];for v in arr &#123; println!(&quot;&#123;&#125;&quot;,v);&#125; Rust ä¸­æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå®ƒæŠŠ arr æ•°ç»„å½“æˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œç›´æ¥å»éå†å…¶ä¸­çš„å…ƒç´ ï¼Œä»å“ªé‡Œå¼€å§‹ï¼Œä»å“ªé‡Œç»“æŸï¼Œéƒ½æ— éœ€æ“å¿ƒã€‚å› æ­¤ä¸¥æ ¼æ¥è¯´ï¼ŒRust ä¸­çš„ for å¾ªç¯æ˜¯ç¼–è¯‘å™¨æä¾›çš„è¯­æ³•ç³–ï¼Œæœ€ç»ˆè¿˜æ˜¯å¯¹è¿­ä»£å™¨ä¸­çš„å…ƒç´ è¿›è¡Œéå†ã€‚ Rust ä¸­çš„æ•°ç»„å®ç°äº† IntoIterator ç‰¹å¾ï¼ŒRust é€šè¿‡ for è¯­æ³•ç³–ï¼Œè‡ªåŠ¨æŠŠå®ç°äº†è¯¥ç‰¹å¾çš„æ•°ç»„ç±»å‹è½¬æ¢ä¸ºè¿­ä»£å™¨ IntoIterator ç‰¹å¾æ‹¥æœ‰ä¸€ä¸ª into_iter æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥æ˜¾å¼çš„æŠŠæ•°ç»„è½¬æ¢æˆè¿­ä»£å™¨ï¼š 1234let arr = [1, 2, 3];for v in arr.into_iter() &#123; println!(&quot;&#123;&#125;&quot;, v);&#125; åœ¨ Rust ä¸­ï¼Œè¿­ä»£å™¨æ˜¯æƒ°æ€§çš„ï¼Œæ„å‘³ç€å¦‚æœä½ ä¸ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹ï¼š 1234567let v1 = vec![1, 2, 3];let v1_iter = v1.iter();for val in v1_iter &#123; println!(&quot;&#123;&#125;&quot;, val);&#125; è¿­ä»£å™¨å®ç°äº† Iterator ç‰¹å¾ï¼Œè¦å®ç°è¯¥ç‰¹å¾ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯å®ç°å…¶ä¸­çš„ next æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ§åˆ¶å¦‚ä½•ä»é›†åˆä¸­å–å€¼ï¼Œæœ€ç»ˆè¿”å›å€¼çš„ç±»å‹æ˜¯å…³è”ç±»å‹ Itemã€‚ 1234567pub trait Iterator &#123; type Item; fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;; // çœç•¥å…¶ä½™æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•&#125; for å¾ªç¯é€šè¿‡ä¸åœè°ƒç”¨è¿­ä»£å™¨ä¸Šçš„ next æ–¹æ³•ï¼Œæ¥è·å–è¿­ä»£å™¨ä¸­çš„å…ƒç´ ã€‚ 123456789fn main() &#123; let arr = [1, 2, 3]; let mut arr_iter = arr.into_iter(); assert_eq!(arr_iter.next(), Some(1)); assert_eq!(arr_iter.next(), Some(2)); assert_eq!(arr_iter.next(), Some(3)); assert_eq!(arr_iter.next(), None);&#125; å‰é¢æˆ‘ä»¬ä½¿ç”¨äº† into_iter çš„æ–¹å¼å°†æ•°ç»„è½¬åŒ–ä¸ºè¿­ä»£å™¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ iter å’Œ iter_mut into_iter ä¼šå¤ºèµ°æ‰€æœ‰æƒ iter æ˜¯å€Ÿç”¨ iter_mut æ˜¯å¯å˜å€Ÿç”¨ 12345678910111213141516171819202122232425262728fn main() &#123; let values = vec![1, 2, 3]; for v in values.into_iter() &#123; println!(&quot;&#123;&#125;&quot;, v) &#125; // ä¸‹é¢çš„ä»£ç å°†æŠ¥é”™ï¼Œå› ä¸º values çš„æ‰€æœ‰æƒåœ¨ä¸Šé¢ `for` å¾ªç¯ä¸­å·²ç»è¢«è½¬ç§»èµ° // println!(&quot;&#123;:?&#125;&quot;,values); let values = vec![1, 2, 3]; let _values_iter = values.iter(); // ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸º values_iter åªæ˜¯å€Ÿç”¨äº† values ä¸­çš„å…ƒç´  println!(&quot;&#123;:?&#125;&quot;, values); let mut values = vec![1, 2, 3]; // å¯¹ values ä¸­çš„å…ƒç´ è¿›è¡Œå¯å˜å€Ÿç”¨ let mut values_iter_mut = values.iter_mut(); // å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¿®æ”¹ä¸º0 if let Some(v) = values_iter_mut.next() &#123; *v = 0; &#125; // è¾“å‡º[0, 2, 3] println!(&quot;&#123;:?&#125;&quot;, values);&#125; Iterator å’Œ IntoIterator æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ Iterator å°±æ˜¯è¿­ä»£å™¨ç‰¹å¾ï¼Œåªæœ‰å®ç°äº†å®ƒæ‰èƒ½ç§°ä¸ºè¿­ä»£å™¨ï¼Œæ‰èƒ½è°ƒç”¨ nextã€‚è€Œ IntoIterator å¼ºè°ƒçš„æ˜¯æŸä¸€ä¸ªç±»å‹å¦‚æœå®ç°äº†è¯¥ç‰¹å¾ï¼Œå®ƒå¯ä»¥é€šè¿‡ into_iterï¼Œiter ç­‰æ–¹æ³•å˜æˆä¸€ä¸ªè¿­ä»£å™¨ã€‚ å¼‚æ­¥ç¼–ç¨‹ç–‘éš¾ç‚¹è‡ªåŠ¨åŒ–æµ‹è¯•Cargoä½¿ç”¨æŒ‡å—æ—¥å¿—ç›‘æ§æœ€ä½³å®è·µå®ç°é“¾è¡¨ç¼–è¯‘é”™è¯¯æ€§èƒ½ä¼˜åŒ–æ ‡å‡†åº“é™„å½•","categories":[{"name":"rust","slug":"rust","permalink":"http://example.com/categories/rust/"}],"tags":[]},{"title":"ruståŸºç¡€","slug":"source/Rust/RuståŸºç¡€å­¦ä¹ ","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2025/08/04/source/Rust/RuståŸºç¡€å­¦ä¹ /","permalink":"http://example.com/2025/08/04/source/Rust/Rust%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"ç¯å¢ƒä¸‹è½½rustuphttps://www.rust-lang.org/zh-CN/learn/get-started windowsç½‘å€ä¸­ä¸‹è½½ Linuxï¼š curl â€“proto â€˜&#x3D;httpsâ€™ â€“tlsv1.2 -sSf https://sh.rustup.rs | sh æ›´æ–°bashç¯å¢ƒå˜é‡ï¼šsource $HOME&#x2F;.cargo&#x2F;env æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ rustup show cargo â€“version cargoæ˜¯rustçš„åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼pythonçš„pip rustc â€“version ç¼–è¾‘å™¨ clion rustæ’ä»¶ï¼šhttps://plugins.jetbrains.com/plugin/8182--deprecated-rust vscode æ’ä»¶ï¼šrust-analyzer startmain.rs 123fn main() &#123; println!(&quot;Hello, world!&quot;);&#125; æ ¼å¼åŒ–è¾“å‡ºstd::fmtä¸­çš„å® format!ï¼šå°†æ ¼å¼åŒ–æ–‡æœ¬å†™åˆ°å­—ç¬¦ä¸²ã€‚print!ï¼šå°†æ–‡æœ¬è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆio::stdoutï¼‰ã€‚println!: ä¸ print! ç±»ä¼¼ï¼Œä½†è¾“å‡ºç»“æœè¿½åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚eprint!ï¼šä¸ print! ç±»ä¼¼ï¼Œä½†å°†æ–‡æœ¬è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ï¼ˆio::stderrï¼‰ã€‚eprintln!ï¼šä¸ eprint! ç±»ä¼¼ï¼Œä½†è¾“å‡ºç»“æœè¿½åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ formatprintln!(â€œ{} daysâ€, 31i64); &#x2F;&#x2F;{}ç›´æ¥æ›¿æ¢ä¸ºåé¢çš„å†…å®¹ï¼Œæ•´å‹æˆ–è€…â€â€å­—ç¬¦ä¸²ï¼Œ31é»˜è®¤i32ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸º31i64 println!(â€œ{0}, this is {1}. {1}, this is {0}â€, â€œAliceâ€, â€œBobâ€); &#x2F;&#x2F;ä½¿ç”¨{0}{1},æ›¿æ¢å¤šä¸ªå˜é‡ println!(â€œ{subject}â€,subject&#x3D;â€the lazy dogâ€); &#x2F;&#x2F;ä½¿ç”¨å‘½åå‚æ•°æ›¿æ¢ println!(â€œ{number:&gt;width$}â€, number&#x3D;1, width&#x3D;6); &#x2F;&#x2F;æŒ‡å®šå®½åº¦å¯¹é½ å·¦å¯¹é½ :&lt; ï¼Œå‰é¢åŠ 0ï¼š:&gt;0width$ {:.2} &#x2F;&#x2F;å°æ•° #[allow(dead_code)] &#x2F;&#x2F;å¿½ç•¥æ­»ä»£ç ç‰‡æ®µï¼šæœªä½¿ç”¨çš„ä»£ç æ®µstruct Structure(i32); &#123;&#125; å¯¹åº” fmt::Display traitï¼Œå®ƒå®šä¹‰äº†ç±»å‹çš„å¸¸è§„æ˜¾ç¤ºæ ¼å¼ã€‚ &#123;:?&#125; å¯¹åº” fmt::Debug traitï¼Œå®ƒå®šä¹‰äº†ç±»å‹çš„è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºæ ¼å¼ã€‚ &#123;:b&#125; å¯¹åº” fmt::Binary traitï¼Œå®ƒå®šä¹‰äº†ç±»å‹çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ ¼å¼ã€‚ è°ƒå¼debug1234struct UnPrintable(i32); //ä¸èƒ½ç›´æ¥ä½¿ç”¨`fmt::Display` æˆ– `fmt::Debug` æ¥è¿›è¡Œæ‰“å°#[derive(Debug)] struct DebugPrintable(i32);//`derive` å±æ€§ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€éœ€çš„å®ç°ï¼Œä½¿è¿™ä¸ª `struct` èƒ½ä½¿ç”¨ `fmt::Debug` æ‰“å° ç”¨{:?}æ‰“å°ä½¿ç”¨å’Œ{}ä¸€æ ·ï¼š{1:?} {0:?} {actor:?} ç¾åŒ–æ‰“å° {:#?} 12345678910111213141516#[derive(Debug)]struct Person&lt;&#x27;a&gt; &#123; name: &amp;&#x27;a str, age: u8&#125;fn main() &#123; let name = &quot;Peter&quot;; let age = 27; let peter = Person &#123; name, age &#125;; // ç¾åŒ–æ‰“å° println!(&quot;&#123;:#?&#125;&quot;, peter);&#125;//Person &#123;// name: &quot;Peter&quot;,// age: 27,//&#125; æ˜¾ç¤ºDisplaydisplayä¸åƒdebugå£°æ˜#[derive(Debug)]åå°±ä¼šè‡ªåŠ¨æä¾›å®ç°ï¼Œdisplayå¿…é¡»æ‰‹åŠ¨ä¸ºç±»å‹å®ç° fmt::Display traitï¼Œdisplayæ›´ç®€æ´ï¼Œå¯¼è‡´Vec æˆ–å…¶ä»–ä»»æ„æ³›å‹å®¹å™¨ç”¨ç”¨ fmt::Debug è€Œä¸ç”¨Displayï¼Œå› ä¸ºè¾“å‡ºæ ·å¼ä¸åŒ 123456789use std::fmt; //å¯¼å…¥æ¨¡å—ä½¿`fmt::Display` å¯ç”¨struct Structure(i32); impl fmt::Display for Structure &#123; //implï¼šä¸º Structure ç»“æ„ä½“å®ç° fmt::Display trait // è¿™ä¸ª trait è¦æ±‚ `fmt` ä½¿ç”¨ä¸ä¸‹é¢çš„å‡½æ•°å®Œå…¨ä¸€è‡´çš„å‡½æ•°ç­¾å fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result &#123; // ä»…å°† self çš„ç¬¬ä¸€ä¸ªå…ƒç´ å†™å…¥åˆ°ç»™å®šçš„è¾“å‡ºæµ `f`ã€‚è¿”å› `fmt:Result`ï¼Œæ­¤ç»“æœè¡¨æ˜æ“ä½œæˆåŠŸæˆ–å¤±è´¥ã€‚æ³¨æ„ `write!` çš„ç”¨æ³•å’Œ `println!` å¾ˆç›¸ä¼¼ã€‚ write!(f, &quot;&#123;&#125;&quot;, self.0) &#125;&#125; å¯¹æ¯”Displayå’Œdebug 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647use std::fmt; #[derive(Debug)] //Debugstruct MinMax(i64, i64);impl fmt::Display for MinMax &#123; //Display fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result &#123; write!(f, &quot;(&#123;&#125;, &#123;&#125;)&quot;, self.0, self.1) &#125;&#125;#[derive(Debug)]struct Point2D &#123; x: f64, y: f64,&#125;impl fmt::Binary for Point2D&#123; //Binary &#123;:b&#125; fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result &#123; let x_bits = self.x.to_bits(); //Binaryåªå¯¹æ•´å‹ï¼Œè½¬æ¢ä¸ºæ•´å‹ let y_bits = self.y.to_bits(); write!(f, &quot;&#123;:b&#125;&#123;:b&#125;&quot;, x_bits, y_bits) &#125;&#125;impl fmt::Display for Point2D &#123; fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result &#123; write!(f, &quot;x: &#123;&#125;, y: &#123;&#125;&quot;, self.x, self.y) &#125;&#125;fn main() &#123; let minmax = MinMax(0, 14); println!(&quot;Compare structures:&quot;); println!(&quot;Display: &#123;&#125;&quot;, minmax); println!(&quot;Debug: &#123;:?&#125;&quot;, minmax); let big_range = MinMax(-300, 300); let small_range = MinMax(-3, 3); println!(&quot;The big range is &#123;big&#125; and the small is &#123;small&#125;&quot;,small = small_range,big = big_range); let point = Point2D &#123; x: 3.3, y: 7.2 &#125;; println!(&quot;Compare points:&quot;); println!(&quot;Display: &#123;&#125;&quot;, point); println!(&quot;Debug: &#123;:?&#125;&quot;, point); println!(&quot;What does Point2D look like in binary: &#123;:b&#125;?&quot;, point);&#125; æµ‹è¯•å®ä¾‹Listwrite!é…åˆ?æ“ä½œç¬¦å®ç°å¤æ‚çš„æ‹¼æ¥ï¼Œå› ä¸ºä½¿ç”¨writeéƒ½ä¼šç”Ÿæˆä¸€ä¸ªResualtï¼Œè¿™é‡Œä½¿ç”¨?å°±å¦‚æœæˆåŠŸå°±ç»§ç»­ï¼Œæ˜¯è¢«åˆ™ä»fmtè¿”å›é”™è¯¯ï¼Œå‡å°‘äº†ifçš„åˆ¤æ–­ 1234567891011121314151617181920212223242526272829use std::fmt; // å¯¼å…¥ `fmt` æ¨¡å—ã€‚// å®šä¹‰ä¸€ä¸ªåŒ…å«å•ä¸ª `Vec` çš„ç»“æ„ä½“ `List`ã€‚struct List(Vec&lt;i32&gt;);impl fmt::Display for List &#123; fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result &#123; // ä½¿ç”¨å…ƒç»„çš„ä¸‹æ ‡è·å–å€¼ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª `vec` çš„å¼•ç”¨ã€‚ let vec = &amp;self.0; write!(f, &quot;[&quot;)?; // ä½¿ç”¨ `v` å¯¹ `vec` è¿›è¡Œè¿­ä»£ï¼Œå¹¶ç”¨ `count` è®°å½•è¿­ä»£æ¬¡æ•°ã€‚ for (count, v) in vec.iter().enumerate() &#123; // å¯¹æ¯ä¸ªå…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ é™¤å¤–ï¼‰åŠ ä¸Šé€—å·ã€‚ // ä½¿ç”¨ `?` æˆ– `try!` æ¥è¿”å›é”™è¯¯ã€‚ if count != 0 &#123; write!(f, &quot;, &quot;)?; &#125; write!(f, &quot;&#123;&#125;&quot;, v)?; &#125; // åŠ ä¸Šé…å¯¹ä¸­æ‹¬å·ï¼Œå¹¶è¿”å›ä¸€ä¸ª fmt::Result å€¼ã€‚ write!(f, &quot;]&quot;) &#125;&#125;fn main() &#123; let v = List(vec![1, 2, 3]); println!(&quot;&#123;&#125;&quot;, v);&#125; æ ¼å¼åŒ–123- `format!(&quot;&#123;&#125;&quot;, foo)` -&gt; `&quot;3735928559&quot;`- `format!(&quot;0x&#123;:X&#125;&quot;, foo)` -&gt; [`&quot;0xDEADBEEF&quot;`](https://en.wikipedia.org/wiki/Deadbeef#Magic_debug_values)- `format!(&quot;0o&#123;:o&#125;&quot;, foo)` -&gt; `&quot;0o33653337357&quot;` 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748use std::fmt::&#123;self, Formatter, Display&#125;;struct City &#123; name: &amp;&#x27;static str, // çº¬åº¦ lat: f32, // ç»åº¦ lon: f32,&#125;impl Display for City &#123; // `f` æ˜¯ä¸€ä¸ªç¼“å†²åŒºï¼ˆbufferï¼‰ï¼Œæ­¤æ–¹æ³•å¿…é¡»å°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²å†™å…¥å…¶ä¸­ fn fmt(&amp;self, f: &amp;mut Formatter) -&gt; fmt::Result &#123; let lat_c = if self.lat &gt;= 0.0 &#123; &#x27;N&#x27; &#125; else &#123; &#x27;S&#x27; &#125;; let lon_c = if self.lon &gt;= 0.0 &#123; &#x27;E&#x27; &#125; else &#123; &#x27;W&#x27; &#125;; // `write!` å’Œ `format!` ç±»ä¼¼ï¼Œä½†å®ƒä¼šå°†æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²å†™å…¥ // ä¸€ä¸ªç¼“å†²åŒºï¼ˆå³ç¬¬ä¸€ä¸ªå‚æ•°fï¼‰ä¸­ã€‚ write!(f, &quot;&#123;&#125;: &#123;:.3&#125;Â°&#123;&#125; &#123;:.3&#125;Â°&#123;&#125;&quot;, self.name, self.lat.abs(), lat_c, self.lon.abs(), lon_c) &#125;&#125;#[allow(dead_code)]#[derive(Debug)]struct Color &#123; red: u8, green: u8, blue: u8,&#125;fn main() &#123; for city in [ City &#123; name: &quot;Dublin&quot;, lat: 53.347778, lon: -6.259722 &#125;, City &#123; name: &quot;Oslo&quot;, lat: 59.95, lon: 10.75 &#125;, City &#123; name: &quot;Vancouver&quot;, lat: 49.25, lon: -123.1 &#125;, ].iter() &#123; println!(&quot;&#123;&#125;&quot;, *city); &#125; for color in [ Color &#123; red: 128, green: 255, blue: 90 &#125;, Color &#123; red: 0, green: 3, blue: 254 &#125;, Color &#123; red: 0, green: 0, blue: 0 &#125;, ].iter() &#123; println!(&quot;&#123;:?&#125;&quot;, *color); println!(&quot;Red: &#123;&#125;, Green: &#123;&#125;, Blue: &#123;&#125;&quot;, color.red, color.green, color.blue); &#125;&#125; åŸç”Ÿç±»å‹æ ‡é‡ç±»å‹æœ‰ç¬¦å·æ•´æ•°ï¼ši8 i16 i32 i64 i128 isize(æŒ‡é’ˆå®½åº¦)æ— ç¬¦å·æ•´æ•°ï¼šu8 u16 u32 u64 u128 usizeæµ®ç‚¹æ•°ï¼šf32 f64char: â€˜aâ€™ â€˜Î±â€™ â€˜âˆâ€™ éƒ½æ˜¯å››å­—èŠ‚boolï¼šture&#x2F;falseå•å…ƒç±»å‹ï¼š() å”¯ä¸€çš„å€¼å°±æ˜¯è¿™ä¸ªç©ºå…ƒç»„ å°½ç®¡å•å…ƒç±»å‹çš„å€¼æ˜¯ä¸ªå…ƒç»„ï¼Œå®ƒå´å¹¶ä¸è¢«è®¤ä¸ºæ˜¯å¤åˆç±»å‹ï¼Œå› ä¸ºå¹¶ä¸åŒ…å«å¤šä¸ªå€¼ã€‚ å¤åˆç±»å‹æ•°ç»„ï¼š[1,2,3]å…ƒç»„ï¼š(1ï¼Œtrue) æ•´å‹é»˜è®¤ä¸º i32 ç±»å‹ï¼Œæµ®ç‚¹å‹é»˜è®¤ä¸º f64ç±»å‹ã€‚æ ¹æ®ä¸Šä¸‹æ–‡ç¯å¢ƒè‡ªåŠ¨æ¨æ–­ï¼šæœªå£°æ˜ç±»å‹æ•´æ•°+i64ï¼Œè¯¥æ•´æ•°ä¼šè‡ªåŠ¨æ¨æ–­ä¸ºi64ï¼Œæ— æ³•æ¨æ–­æ—¶æŒ‰é»˜è®¤å€¼å¤„ç† 1234let logical: bool = true; //å¸¸è§„è¯´æ˜let an_integer = 5i32; //åç¼€è¯´æ˜let default_float = 3.0;//é»˜è®¤let mut mutable = 12;//å¯å˜å€¼ï¼Œä½†æ˜¯å˜é‡çš„ç±»å‹ä¸èƒ½æ”¹å˜ å­—é¢é‡å’Œè¿ç®—ç¬¦é€šè¿‡åŠ å‰ç¼€ 0xã€0oã€0bï¼Œæ•°å­—å¯ä»¥ç”¨åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è®°æ³•è¡¨ç¤ºã€‚å¯ä»¥åœ¨æ•°å€¼å­—é¢é‡ä¸­æ’å…¥ä¸‹åˆ’çº¿ï¼Œæ¯”å¦‚ï¼š1_000 ç­‰åŒäº 1000ï¼Œ0.000_001 ç­‰åŒäº 0.000001ã€‚ 1234567891011121314151617181920212223fn main() &#123; // æ•´æ•°ç›¸åŠ  println!(&quot;1 + 2 = &#123;&#125;&quot;, 1u32 + 2); // æ•´æ•°ç›¸å‡ println!(&quot;1 - 2 = &#123;&#125;&quot;, 1i32 - 2); // è¯•ä¸€è¯• ^ å°è¯•å°† `1i32` æ”¹ä¸º `1u32`ï¼Œä½“ä¼šä¸ºä»€ä¹ˆç±»å‹å£°æ˜è¿™ä¹ˆé‡è¦ // çŸ­è·¯æ±‚å€¼çš„å¸ƒå°”é€»è¾‘ println!(&quot;true AND false is &#123;&#125;&quot;, true &amp;&amp; false); println!(&quot;true OR false is &#123;&#125;&quot;, true || false); println!(&quot;NOT true is &#123;&#125;&quot;, !true); // ä½è¿ç®— println!(&quot;0011 AND 0101 is &#123;:04b&#125;&quot;, 0b0011u32 &amp; 0b0101); println!(&quot;0011 OR 0101 is &#123;:04b&#125;&quot;, 0b0011u32 | 0b0101); println!(&quot;0011 XOR 0101 is &#123;:04b&#125;&quot;, 0b0011u32 ^ 0b0101); println!(&quot;1 &lt;&lt; 5 is &#123;&#125;&quot;, 1u32 &lt;&lt; 5); println!(&quot;0x80 &gt;&gt; 2 is 0x&#123;:x&#125;&quot;, 0x80u32 &gt;&gt; 2); // ä½¿ç”¨ä¸‹åˆ’çº¿æ”¹å–„æ•°å­—çš„å¯è¯»æ€§ï¼ println!(&quot;One million is written as &#123;&#125;&quot;, 1_000_000u32);&#125; å…ƒç»„å…ƒç»„æ˜¯ä¸€ä¸ªå¯ä»¥åŒ…å«å„ç§ç±»å‹å€¼çš„ç»„åˆï¼Œå¯ä»¥æ‹¥æœ‰ä»»æ„ä¸ªå€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041fn reverse(pair: (i32, bool)) -&gt; (bool, i32) &#123; //å‚æ•°ï¼špairå…ƒç»„ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯å…ƒç»„ let (integer, boolean) = pair;//èµ‹å€¼ (boolean, integer)//è¿”å›å€¼&#125;#[derive(Debug)]struct Matrix(f32, f32, f32, f32);fn main() &#123; // åŒ…å«å„ç§ä¸åŒç±»å‹çš„å…ƒç»„ let long_tuple = (1u8, 2u16, 3u32, 4u64, -1i8, -2i16, -3i32, -4i64, 0.1f32, 0.2f64, &#x27;a&#x27;, true); // é€šè¿‡å…ƒç»„çš„ä¸‹æ ‡æ¥è®¿é—®å…·ä½“çš„å€¼ println!(&quot;long tuple first value: &#123;&#125;&quot;, long_tuple.0); // å…ƒç»„ä¹Ÿå¯ä»¥å……å½“å…ƒç»„çš„å…ƒç´  let tuple_of_tuples = ((1u8, 2u16, 2u32), (4u64, -1i8), -2i16); // å…ƒç»„å¯ä»¥æ‰“å° println!(&quot;tuple of tuples: &#123;:?&#125;&quot;, tuple_of_tuples);// ä½†å¾ˆé•¿çš„å…ƒç»„æ— æ³•æ‰“å° let pair = (1, true); println!(&quot;the reversed pair is &#123;:?&#125;&quot;, reverse(pair)); // åˆ›å»ºå•å…ƒç´ å…ƒç»„éœ€è¦ä¸€ä¸ªé¢å¤–çš„é€—å·ï¼Œè¿™æ˜¯ä¸ºäº†å’Œè¢«æ‹¬å·åŒ…å«çš„å­—é¢é‡ä½œåŒºåˆ†ã€‚ println!(&quot;one element tuple: &#123;:?&#125;&quot;, (5u32,)); println!(&quot;just an integer: &#123;:?&#125;&quot;, (5u32)); // å…ƒç»„å¯ä»¥è¢«è§£æ„ï¼ˆdeconstructï¼‰ï¼Œä»è€Œå°†å€¼ç»‘å®šç»™å˜é‡ let tuple = (1, &quot;hello&quot;, 4.5, true); let (a, b, c, d) = tuple; println!(&quot;&#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;&quot;, a, b, c, d); let matrix = Matrix(1.1, 1.2, 2.1, 2.2); println!(&quot;&#123;:?&#125;&quot;, matrix)//æ‰“å°ä¼šæ‰“å°å‡ºç»“æ„ä½“çš„åå­—&#125; æ•°ç»„å’Œåˆ‡ç‰‡æ•°ç»„ï¼š[T; length] ç±»å‹å’Œå¤§å°ï¼Œç›¸åŒç±»å‹ï¼Œè¿ç»­å­˜å‚¨åˆ‡ç‰‡ï¼šå’Œæ•°ç»„ç±»ä¼¼ï¼Œä½†æ˜¯å¤§å°åœ¨ç¼–è¯‘æ—¶ä¸ç¡®å®šï¼ŒåŒå­—å¯¹è±¡ï¼ŒæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ+åˆ‡ç‰‡é•¿åº¦ï¼Œå­—å¤§å°æ˜¯usizeï¼Œå¤„ç†å™¨æ¶æ„å†³å®š slice å¯ä»¥ç”¨æ¥å€Ÿç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚slice çš„ç±»å‹æ ‡è®°ä¸º &amp;[T]ã€‚ 1234567891011121314151617181920212223242526272829303132use std::mem;//è·å–å­—èŠ‚æ•°// æ­¤å‡½æ•°å€Ÿç”¨ä¸€ä¸ª slicefn analyze_slice(slice: &amp;[i32]) &#123; println!(&quot;first element of the slice: &#123;&#125;&quot;, slice[0]); println!(&quot;the slice has &#123;&#125; elements&quot;, slice.len());&#125;fn main() &#123; // å®šé•¿æ•°ç»„ï¼ˆç±»å‹æ ‡è®°æ˜¯å¤šä½™çš„ï¼‰ let xs: [i32; 5] = [1, 2, 3, 4, 5]; // æ‰€æœ‰å…ƒç´ å¯ä»¥åˆå§‹åŒ–æˆç›¸åŒçš„å€¼ let ys: [i32; 500] = [0; 500]; // ä¸‹æ ‡ä» 0 å¼€å§‹ println!(&quot;first element of the array: &#123;&#125;&quot;, xs[0]); // `len` è¿”å›æ•°ç»„çš„å¤§å° println!(&quot;array size: &#123;&#125;&quot;, xs.len()); // æ•°ç»„æ˜¯åœ¨æ ˆä¸­åˆ†é…çš„ println!(&quot;array occupies &#123;&#125; bytes&quot;, mem::size_of_val(&amp;xs)); // æ•°ç»„å¯ä»¥è‡ªåŠ¨è¢«å€Ÿç”¨æˆä¸º slice println!(&quot;borrow the whole array as a slice&quot;); analyze_slice(&amp;xs); // slice å¯ä»¥æŒ‡å‘æ•°ç»„çš„ä¸€éƒ¨åˆ† println!(&quot;borrow a section of the array as a slice&quot;); analyze_slice(&amp;ys[1 .. 4]); // è¶Šç•Œçš„ä¸‹æ ‡ä¼šå¼•å‘è‡´å‘½é”™è¯¯ï¼ˆpanicï¼‰ //println!(&quot;&#123;&#125;&quot;, xs[5]);&#125; å°†vsä¸­c++çš„ç¯å¢ƒæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.42.34433\\bin\\Hostx64\\x64 â€˜static ç”Ÿå‘½å‘¨æœŸ å­—ç¬¦ä¸²å­—é¢å€¼å°±å…·æœ‰ â€˜static ç”Ÿå‘½å‘¨æœŸå‡½æ•°å‚æ•°ç±»å‹ï¼š&amp;â€™static str ï¼Œä¼ å…¥å‚æ•°ç±»å‹&amp;str ç‰¹å¾å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ 1assert_eq!(a, b); åŸºæœ¬ç±»å‹å·²ç»å®ç°äº†Debug traitå’ŒDisplay traitæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨{:?} {}","categories":[{"name":"rust","slug":"rust","permalink":"http://example.com/categories/rust/"}],"tags":[]},{"title":"æ‚è¯´-é¥®é£Ÿ+è¿åŠ¨","slug":"source/æ‚è¯´/é¥®é£Ÿ+è¿åŠ¨","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/04/source/æ‚è¯´/é¥®é£Ÿ+è¿åŠ¨/","permalink":"http://example.com/2025/08/04/source/%E6%9D%82%E8%AF%B4/%E9%A5%AE%E9%A3%9F+%E8%BF%90%E5%8A%A8/","excerpt":"","text":"ä¸€ã€é¥®é£Ÿæ–¹æ¡ˆ (æ ¸å¿ƒï¼šå¢åŠ çƒ­é‡å’Œè›‹ç™½è´¨æ‘„å…¥) æ¯æ—¥æ€»çƒ­é‡éœ€æ±‚ä¼°ç®— (èµ·ç‚¹)ï¼š ä½ çš„åŸºç¡€ä»£è°¢ç‡(BMR)ä¼°ç®— â‰ˆ (10 * ä½“é‡kg) + (6.25 * èº«é«˜cm) - (5 * å¹´é¾„) + 5 &#x3D; (1060) + (6.25178) - (5*22) + 5 â‰ˆ 600 + 1112.5 - 110 + 5 â‰ˆ 1607.5 å¤§å¡ è€ƒè™‘æ—¥å¸¸æ´»åŠ¨ï¼ˆä¸Šç­æ—ï¼‰å’Œè¿åŠ¨ï¼ˆä¸­ç­‰å¼ºåº¦ï¼‰ï¼Œæ´»åŠ¨ç³»æ•°å–1.55-1.65 (ä¿å®ˆå–1.6)ã€‚ ç»´æŒçƒ­é‡ â‰ˆ 1607.5 * 1.6 â‰ˆ 2572 å¤§å¡ å¢è‚ŒæœŸç›®æ ‡çƒ­é‡ â‰ˆ ç»´æŒçƒ­é‡ + 300-500 å¤§å¡ â‰ˆ 2872 - 3072 å¤§å¡ å»ºè®®ç›®æ ‡ï¼šä» 2900-3000 å¤§å¡å¼€å§‹å°è¯•ã€‚ æ¯å‘¨ç›‘æµ‹ä½“é‡å˜åŒ–ï¼ˆæ—©ä¸Šç©ºè…¹ï¼‰ï¼Œç›®æ ‡æ¯å‘¨å¢é‡0.25-0.5kgã€‚å¦‚æœä½“é‡ä¸å¢æˆ–å¢å¾—å¤ªæ…¢ï¼ˆ&lt;0.2kg&#x2F;å‘¨ï¼‰ï¼Œå¢åŠ 200-300å¤§å¡ï¼›å¦‚æœå¢é‡è¿‡å¿«ï¼ˆ&gt;0.8kg&#x2F;å‘¨ï¼‰ä¸”æ„Ÿè§‰è„‚è‚ªå¢åŠ æ˜æ˜¾ï¼Œç•¥å¾®å‡å°‘100-200å¤§å¡ã€‚ å®é‡è¥å…»ç´ æ¯”ä¾‹ (å»ºè®®èŒƒå›´)ï¼š è›‹ç™½è´¨ï¼š 60kg * 1.8g&#x2F;kg â‰ˆ 108å…‹ (æœ€ä½ç›®æ ‡) - 132å…‹ (ç†æƒ³ç›®æ ‡)ã€‚å æ€»çƒ­é‡25-30%ã€‚ è¿™æ˜¯å¢è‚Œçš„å…³é”®ï¼ è„‚è‚ªï¼š å æ€»çƒ­é‡20-25% â‰ˆ 64-83å…‹ã€‚ ç¢³æ°´åŒ–åˆç‰©ï¼š å‰©ä½™çƒ­é‡ â‰ˆ 350-400å…‹ã€‚æä¾›è®­ç»ƒèƒ½é‡å’Œå¸®åŠ©æ¢å¤ã€‚ å…·ä½“é¤é£Ÿå®‰æ’ (æ ¹æ®ä½ çš„æ—¶é—´è°ƒæ•´)ï¼š æ—©é¤ (9:00å·¦å³)ï¼š å¿…é¡»åƒå¥½ï¼ å¼€å¯ä¸€å¤©ä»£è°¢ï¼Œè¡¥å……å¤œé—´æ¶ˆè€—ã€‚ ç›®æ ‡ï¼š çƒ­é‡600-700å¤§å¡ï¼Œè›‹ç™½è´¨30-40å…‹ã€‚ é€‰æ‹©ç»„åˆ (ç¤ºä¾‹)ï¼š ä¸»é£Ÿï¼šç‡•éº¦ç‰‡70g (å¹²é‡) + ç‰›å¥¶250ml &#x2F; å…¨éº¦é¢åŒ…3ç‰‡ è›‹ç™½è´¨ï¼šé¸¡è›‹3-4ä¸ª (å¯åŒ…å«è›‹é»„) &#x2F; å¸Œè…Šé…¸å¥¶150g è„‚è‚ª&#x2F;å…¶ä»–ï¼šåšæœä¸€å°æŠŠ (æ ¸æ¡ƒ&#x2F;æä»&#x2F;èŠ±ç”Ÿ 20g) &#x2F; ç‰›æ²¹æœåŠä¸ª &#x2F; èŠ±ç”Ÿé…±1-2å‹º (å¯é€‰)æ°´æœï¼šé¦™è•‰1æ ¹ &#x2F; è‹¹æœ1ä¸ª ä¾‹å­ï¼šç‡•éº¦70gç…®ç²¥+ç‰›å¥¶250ml+é¸¡è›‹3ä¸ª+èŠ±ç”Ÿé…±1å‹º+é¦™è•‰1æ ¹ â‰ˆ 650å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ35gï¼Œ ç¢³æ°´â‰ˆ80gï¼Œ è„‚è‚ªâ‰ˆ25g åˆé¤ (11:40å·¦å³)ï¼š æœ€é‡è¦çš„ä¸€é¤ï¼ æ‰¿ä¸Šå¯ä¸‹ï¼Œæä¾›ä¸‹åˆèƒ½é‡ã€‚ ç›®æ ‡ï¼š çƒ­é‡700-800å¤§å¡ï¼Œè›‹ç™½è´¨35-45å…‹ã€‚ é€‰æ‹©ç»„åˆ (ç¤ºä¾‹)ï¼š ä¸»é£Ÿï¼šç±³é¥­200g (ç†Ÿé‡) &#x2F; ç³™ç±³é¥­ &#x2F; é¦’å¤´2ä¸ª &#x2F; é¢æ¡ (é€‰ç²—ç²®é¢æ›´å¥½) è›‹ç™½è´¨ï¼šé¸¡èƒ¸è‚‰150-200g &#x2F; ç˜¦ç‰›è‚‰150g &#x2F; é±¼è‚‰150-200g &#x2F; è±†è…200g è”¬èœï¼šå¤§é‡ç»¿å¶è”¬èœ + å…¶ä»–è”¬èœ (è¥¿å…°èŠ±ã€èƒ¡èåœã€èŒè‡ç­‰) ä¸é™é‡ï¼Œå°‘æ²¹çƒ¹é¥ªã€‚ è„‚è‚ªï¼šçƒ¹é¥ªç”¨æ²¹ï¼ˆæ©„æ¦„æ²¹ã€èœç±½æ²¹ï¼‰10-15gã€‚ ä¾‹å­ï¼šç±³é¥­200g + é¸¡èƒ¸è‚‰ç‚’è¥¿å…°èŠ± (é¸¡èƒ¸è‚‰200g + è¥¿å…°èŠ±200g + æ²¹10g) + å‡‰æ‹Œè èœ â‰ˆ 750å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ55gï¼Œ ç¢³æ°´â‰ˆ100gï¼Œ è„‚è‚ªâ‰ˆ20g ä¸‹åˆåŠ é¤ (15:00-16:00)ï¼š å…³é”®è¡¥å……ï¼ é˜²æ­¢åˆé¤åˆ°æ™šé¤é—´éš”è¿‡é•¿å¯¼è‡´è‚Œè‚‰åˆ†è§£ã€‚ ç›®æ ‡ï¼š çƒ­é‡300-400å¤§å¡ï¼Œè›‹ç™½è´¨15-25å…‹ï¼Œæ–¹ä¾¿æºå¸¦ã€‚ é€‰æ‹©ç»„åˆ (ç¤ºä¾‹)ï¼š ä¸»é£Ÿï¼šå…¨éº¦é¢åŒ…2ç‰‡ &#x2F; çº¢è–¯&#x2F;ç´«è–¯150g è›‹ç™½è´¨ï¼šç‰›å¥¶250ml &#x2F; æ— ç³–é…¸å¥¶150g &#x2F; è›‹ç™½æ£’1æ ¹ (çœ‹æˆåˆ†ï¼Œé€‰é«˜è›‹ç™½ä½ç³–) &#x2F; ç…®é¸¡è›‹2ä¸ª å…¶ä»–ï¼šæ°´æœ (è‹¹æœ&#x2F;æ©™å­&#x2F;æ¢¨) 1ä¸ª &#x2F; åšæœä¸€å°æŠŠ (15g) ä¾‹å­ï¼šå…¨éº¦é¢åŒ…2ç‰‡ + èŠ±ç”Ÿé…±1å‹º + ç‰›å¥¶250ml + è‹¹æœ1ä¸ª â‰ˆ 450å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ20gï¼Œ ç¢³æ°´â‰ˆ60gï¼Œ è„‚è‚ªâ‰ˆ15g è®­ç»ƒå‰åŠ é¤ (è¿åŠ¨å‰1-1.5å°æ—¶ï¼Œçº¦17:00-17:30)ï¼š æä¾›è®­ç»ƒèƒ½é‡ï¼ ä»¥æ˜“æ¶ˆåŒ–ç¢³æ°´ä¸ºä¸»ï¼Œå°‘é‡è›‹ç™½è´¨ã€‚ ç›®æ ‡ï¼š çƒ­é‡200-300å¤§å¡ï¼Œè›‹ç™½è´¨10-15å…‹ã€‚ é€‰æ‹©ç»„åˆ (ç¤ºä¾‹)ï¼š é¦™è•‰1æ ¹ + æ— ç³–é…¸å¥¶100g &#x2F; ç‰›å¥¶100ml å…¨éº¦é¢åŒ…1ç‰‡ + å°‘é‡æœé…± + å°‘é‡åšæœ å³é£Ÿç‡•éº¦ç‰‡30g + ç‰›å¥¶&#x2F;æ°´ ä¾‹å­ï¼šé¦™è•‰1æ ¹ (å¤§) + æ— ç³–é…¸å¥¶100g â‰ˆ 250å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ8gï¼Œ ç¢³æ°´â‰ˆ50gï¼Œ è„‚è‚ªâ‰ˆ3g æ™šé¤ (è®­ç»ƒå30-60åˆ†é’Ÿå†…ï¼Œçº¦19:30-20:00)ï¼š é»„é‡‘æ¢å¤æœŸï¼ é‡ç‚¹è¡¥å……è›‹ç™½è´¨å’Œç¢³æ°´ï¼Œå¸®åŠ©è‚Œè‚‰ä¿®å¤å’Œç”Ÿé•¿ã€‚ ç›®æ ‡ï¼š çƒ­é‡600-700å¤§å¡ï¼Œè›‹ç™½è´¨35-45å…‹ã€‚ é€‰æ‹©ç»„åˆ (ç±»ä¼¼åˆé¤)ï¼š ä¸»é£Ÿï¼šç±³é¥­200g (ç†Ÿé‡) &#x2F; ç³™ç±³é¥­ &#x2F; åœŸè±†&#x2F;çº¢è–¯150g è›‹ç™½è´¨ï¼šé¸¡èƒ¸è‚‰150-200g &#x2F; ç˜¦ç‰›è‚‰150g &#x2F; é±¼è‚‰150-200g &#x2F; è™¾ä»150g &#x2F; é¸¡è›‹3ä¸ª è”¬èœï¼šå¤§é‡è”¬èœï¼Œå“ç§ä¸°å¯Œã€‚ è„‚è‚ªï¼šçƒ¹é¥ªç”¨æ²¹10-15gã€‚ ä¾‹å­ï¼šç±³é¥­200g + æ¸…è’¸é±¼200g + è’œè“‰ç‚’è èœ&#x2F;è¥¿è‘«èŠ¦ + æ²¹10g â‰ˆ 650å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ50gï¼Œ ç¢³æ°´â‰ˆ90gï¼Œ è„‚è‚ªâ‰ˆ20g æ™šä¸ŠåŠ é¤ (ç¡å‰1-1.5å°æ—¶ï¼Œçº¦21:30-22:00)ï¼š é˜²æ­¢å¤œé—´åˆ†è§£ï¼ŒæŒç»­ä¾›èƒ½ï¼ ä»¥ç¼“é‡Šè›‹ç™½è´¨ä¸ºä¸»ï¼Œå¯é€‰å°‘é‡æ…¢ç¢³å’Œå¥åº·è„‚è‚ªã€‚ ç›®æ ‡ï¼š çƒ­é‡300-400å¤§å¡ï¼Œè›‹ç™½è´¨20-30å…‹ã€‚ é€‰æ‹©ç»„åˆ (ç¤ºä¾‹)ï¼š æœ€ä½³é€‰æ‹©ï¼š é…ªè›‹ç™½ç²‰30g + ç‰›å¥¶250ml &#x2F; æ°´ (é…ªè›‹ç™½æ¶ˆåŒ–æ…¢ï¼Œå¤œé—´æŒç»­ä¾›æ°¨åŸºé…¸) æ›¿ä»£é€‰æ‹©ï¼š ä½è„‚&#x2F;è„±è„‚å¥¶é…ª (èŒ…å±‹èŠå£«) 150g + å°‘é‡åšæœ &#x2F; äºšéº»ç±½ç²‰ &#x2F; å¥‡äºšç±½ å¤©ç„¶é£Ÿç‰©é€‰æ‹©ï¼š å¸Œè…Šé…¸å¥¶150g + å°‘é‡æ°´æœ&#x2F;åšæœ é¿å…ï¼š é«˜ç³–ã€é«˜è„‚è‚ªã€éš¾æ¶ˆåŒ–çš„é£Ÿç‰© (æ²¹ç‚¸ã€å¤§é‡ç²—çº¤ç»´)ã€‚ ä¾‹å­ï¼šé…ªè›‹ç™½ç²‰30g + ç‰›å¥¶250ml â‰ˆ 300å¤§å¡ï¼Œ è›‹ç™½è´¨â‰ˆ40gï¼Œ ç¢³æ°´â‰ˆ15gï¼Œ è„‚è‚ªâ‰ˆ8g è®­ç»ƒæ–¹æ¡ˆ (æ¯å‘¨3-4æ¬¡ï¼Œæ¯æ¬¡60-75åˆ†é’Ÿ) æ—¶é—´ï¼š ä¸‹ç­å (18:30ä¹‹å)ï¼Œç¡®ä¿æ™šé¤åœ¨è®­ç»ƒååŠæ—¶è¡¥å……ã€‚ åœ°ç‚¹ï¼š å¥èº«æˆ¿ï¼ˆæœ€ä½³ï¼‰æˆ–åœ¨å®¶ï¼ˆéœ€å‡†å¤‡åŸºç¡€å™¨æ¢°å¦‚å“‘é“ƒã€å¼¹åŠ›å¸¦ã€å¼•ä½“å‘ä¸Šæ†ï¼‰ã€‚ åŸåˆ™ï¼š å¤åˆåŠ¨ä½œä¸ºä¸»ï¼š æ·±è¹²ã€ç¡¬æ‹‰ã€å§æ¨ã€æ¨ä¸¾ã€åˆ’èˆ¹ã€å¼•ä½“å‘ä¸Šç­‰ã€‚åŒæ—¶åˆºæ¿€å¤šä¸ªè‚Œç¾¤ï¼Œæ•ˆç‡æœ€é«˜ã€‚ æ¸è¿›è¶…è´Ÿè·ï¼š æ¯æ¬¡è®­ç»ƒéƒ½è¦å°è¯•æ¯”ä¸Šæ¬¡å¤šåšä¸€ç‚¹ï¼ˆå¢åŠ é‡é‡ã€å¢åŠ æ¬¡æ•°ã€å¢åŠ ç»„æ•°ã€ç¼©çŸ­ç»„é—´ä¼‘æ¯ã€æå‡åŠ¨ä½œè´¨é‡ï¼‰ã€‚è¿™æ˜¯æŒç»­å¢è‚Œçš„å…³é”®ï¼ æ§åˆ¶åŠ¨ä½œï¼š æ³¨é‡åŠ¨ä½œå½¢å¼ï¼Œæ„Ÿå—ç›®æ ‡è‚Œè‚‰å‘åŠ›ï¼Œé¿å…å€ŸåŠ›å’Œå—ä¼¤ã€‚å®è½»å‹¿å‡ï¼ å……åˆ†ä¼‘æ¯ï¼š ç»„é—´ä¼‘æ¯1.5-3åˆ†é’Ÿï¼ˆå¤§é‡é‡å¤åˆåŠ¨ä½œä¼‘æ¯é•¿äº›ï¼‰ã€‚ è®°å½•ï¼š è®°å½•æ¯æ¬¡è®­ç»ƒçš„åŠ¨ä½œã€é‡é‡ã€ç»„æ•°ã€æ¬¡æ•°ï¼Œæ–¹ä¾¿è¿½è¸ªè¿›æ­¥ã€‚ æ¨èè®¡åˆ’ (å¥èº«æˆ¿ - 3åˆ†åŒ–æ¨æ‹‰è…¿)ï¼š éå¸¸é€‚åˆæ–°æ‰‹åˆ°ä¸­çº§ï¼Œæ•ˆç‡é«˜ã€‚ Day 1: æ¨ (èƒ¸&#x2F;è‚©&#x2F;ä¸‰å¤´) æ é“ƒ&#x2F;å“‘é“ƒå§æ¨ï¼š 3ç»„ x 8-12æ¬¡ ä¸Šæ–œå“‘é“ƒ&#x2F;æ é“ƒå§æ¨ï¼š 3ç»„ x 8-12æ¬¡ æ é“ƒ&#x2F;å“‘é“ƒè‚©éƒ¨æ¨ä¸¾ï¼š 3ç»„ x 8-12æ¬¡ å“‘é“ƒä¾§å¹³ä¸¾ï¼š 3ç»„ x 12-15æ¬¡ ç»³ç´¢&#x2F;å“‘é“ƒè‡‚å±ˆä¼¸ (ä¸‰å¤´)ï¼š 3ç»„ x 10-15æ¬¡ Day 2: æ‹‰ (èƒŒ&#x2F;äºŒå¤´) å¼•ä½“å‘ä¸Š (æˆ–é«˜ä½ä¸‹æ‹‰)ï¼š 3ç»„ x åŠ›ç«­ (æˆ–8-12æ¬¡) æ é“ƒ&#x2F;å“‘é“ƒåˆ’èˆ¹ï¼š 3ç»„ x 8-12æ¬¡ åå§¿ç»³ç´¢åˆ’èˆ¹ï¼š 3ç»„ x 10-15æ¬¡ é¢æ‹‰ï¼š 3ç»„ x 15-20æ¬¡ (è‚©åæŸã€ä¸ŠèƒŒ) æ é“ƒ&#x2F;å“‘é“ƒå¼¯ä¸¾ (äºŒå¤´)ï¼š 3ç»„ x 8-12æ¬¡ Day 3: è…¿ (è‚¡å››&#x2F;è‚¡äºŒ&#x2F;è‡€) æ é“ƒæ·±è¹²ï¼š 3ç»„ x 6-10æ¬¡ (å®‰å…¨ç¬¬ä¸€ï¼) ç½—é©¬å°¼äºšç¡¬æ‹‰ï¼š 3ç»„ x 8-12æ¬¡ è…¿ä¸¾&#x2F;å“ˆå…‹æ·±è¹²ï¼š 3ç»„ x 10-15æ¬¡ è…¿å¼¯ä¸¾ï¼š 3ç»„ x 10-15æ¬¡ (å¯é€‰) å°è…¿æè¸µï¼š 3ç»„ x 15-20æ¬¡ å®‰æ’ï¼š æ¯å‘¨è®­ç»ƒ3æ¬¡ï¼š ä¾‹å¦‚ å‘¨ä¸€(æ¨)ã€å‘¨ä¸‰(æ‹‰)ã€å‘¨äº”(è…¿) æˆ– å‘¨äºŒã€å››ã€å…­ã€‚ æ¯å‘¨è®­ç»ƒ4æ¬¡ï¼š ä¾‹å¦‚ å‘¨ä¸€(æ¨)ã€å‘¨äºŒ(æ‹‰)ã€å‘¨å››(è…¿)ã€å‘¨å…­(æ¨) - å°†æ¨æ—¥æ‹†æˆèƒ¸+ä¸‰å¤´å’Œè‚©+ä¸‰å¤´ï¼Œæˆ–è€…å¢åŠ ä¸€ä¸ªå¼±é¡¹è®­ç»ƒæ—¥ã€‚ç¡®ä¿æœ‰è¶³å¤Ÿä¼‘æ¯æ—¥ã€‚ çƒ­èº« (æ¯æ¬¡è®­ç»ƒå‰ 5-10åˆ†é’Ÿ)ï¼š åŠ¨æ€æ‹‰ä¼¸ï¼š æ‰‹è‡‚ç”»åœˆã€è…¿éƒ¨æ‘†åŠ¨ã€èº¯å¹²æ‰­è½¬ã€å¼€åˆè·³ç­‰ã€‚ é’ˆå¯¹è®­ç»ƒè‚Œç¾¤çš„æ¿€æ´»ï¼š å°é‡é‡&#x2F;å¼¹åŠ›å¸¦åšå‡ ç»„ç›®æ ‡åŠ¨ä½œã€‚ æ”¾æ¾ (æ¯æ¬¡è®­ç»ƒå 5åˆ†é’Ÿ)ï¼š é™æ€æ‹‰ä¼¸ï¼š é’ˆå¯¹è®­ç»ƒçš„ä¸»è¦è‚Œç¾¤ï¼Œæ¯ä¸ªæ‹‰ä¼¸ä¿æŒ20-30ç§’ã€‚ æ³¡æ²«è½´æ”¾æ¾ï¼š ç¼“è§£è‚Œè‚‰ç´§å¼ ã€‚ ä¸‰ã€å…³é”®æ³¨æ„äº‹é¡¹ä¸å»ºè®® æ°´åˆ†ï¼š å…¨å¤©å¤§é‡é¥®æ°´ï¼ç›®æ ‡æ˜¯æ¯å¤©3-4å‡ã€‚è¿åŠ¨å‰ä¸­åéƒ½è¦è¡¥å……ã€‚è„±æ°´ä¸¥é‡å½±å“è¿åŠ¨è¡¨ç°å’Œæ¢å¤ã€‚ ç¡çœ ï¼š æå…¶é‡è¦ï¼ ä¿è¯æ¯æ™š7-9å°æ—¶é«˜è´¨é‡ç¡çœ ã€‚è‚Œè‚‰ä¸»è¦åœ¨ç¡çœ ä¸­ä¿®å¤ç”Ÿé•¿ã€‚ è€å¿ƒä¸åšæŒï¼š å¢è‚Œæ˜¯ä¸€ä¸ªç¼“æ…¢çš„è¿‡ç¨‹ï¼Œä¸è¦æœŸæœ›ç«‹ç«¿è§å½±ã€‚åšæŒæ‰§è¡Œè®¡åˆ’è‡³å°‘8-12å‘¨æ‰èƒ½çœ‹åˆ°æ˜æ˜¾å˜åŒ–ã€‚å…³æ³¨åŠ›é‡å’Œå›´åº¦çš„è¿›æ­¥ï¼Œè€Œéä»…ä»…ä½“é‡ã€‚ å€¾å¬èº«ä½“ï¼š æ„Ÿè§‰ç–²åŠ³ã€ç–¼ç—›å¼‚å¸¸æ—¶ï¼Œä¸è¦ç¡¬æ’‘ï¼Œé€‚å½“ä¼‘æ¯æˆ–é™ä½å¼ºåº¦ã€‚é¢„é˜²å—ä¼¤æ¯”ä»€ä¹ˆéƒ½é‡è¦ã€‚ åŠ¨ä½œå­¦ä¹ ï¼š å¦‚æœä½ æ˜¯å¥èº«æ–°æ‰‹ï¼Œå¼ºçƒˆå»ºè®®ï¼š è¯·ä¸€ä½åˆæ ¼çš„å¥èº«æ•™ç»ƒæŒ‡å¯¼ä½ å­¦ä¹ æ ‡å‡†åŠ¨ä½œã€‚ è§‚çœ‹é«˜è´¨é‡çš„æ•™å­¦è§†é¢‘ (Jeff Nippard, Jeremy Ethier, Athlean-Xç­‰)ã€‚ ä»å°é‡é‡å¼€å§‹ï¼Œä¸“æ³¨äºåŠ¨ä½œæ¨¡å¼ã€‚ é£Ÿç‰©é€‰æ‹©ï¼š ä¼˜å…ˆé€‰æ‹©å¤©ç„¶ã€æœªåŠ å·¥çš„é£Ÿç‰©ï¼ˆç˜¦è‚‰ã€é±¼ã€è›‹ã€å¥¶ã€è±†åˆ¶å“ã€å…¨è°·ç‰©ã€è–¯ç±»ã€è”¬èœã€æ°´æœã€åšæœç§å­ï¼‰ã€‚æ§åˆ¶æ·»åŠ ç³–å’Œè¿‡åº¦åŠ å·¥é£Ÿå“ã€‚ åŠ é¤çµæ´»æ€§ï¼š åŠ é¤å†…å®¹å¯ä»¥æ ¹æ®æ–¹ä¾¿ç¨‹åº¦å’Œå–œå¥½è°ƒæ•´ï¼Œä½†è¦ç¡®ä¿è›‹ç™½è´¨å’Œæ€»çƒ­é‡è¾¾æ ‡ã€‚ è›‹ç™½ç²‰ï¼š å¦‚æœé€šè¿‡é¥®é£Ÿå¾ˆéš¾åƒå¤Ÿè›‹ç™½è´¨ï¼Œè›‹ç™½ç²‰ï¼ˆä¹³æ¸…è›‹ç™½è®­ç»ƒåï¼Œé…ªè›‹ç™½ç¡å‰ï¼‰æ˜¯æ–¹ä¾¿æœ‰æ•ˆçš„è¡¥å……å‰‚ã€‚ä½†å®ƒä¸èƒ½æ›¿ä»£åŸºç¡€é¥®é£Ÿã€‚ ç›‘æ§ä¸è°ƒæ•´ï¼š æ¯å‘¨å›ºå®šæ—¶é—´ï¼ˆå¦‚å‘¨ä¸€æ—©ä¸Šç©ºè…¹ï¼‰ç§°ä½“é‡ã€‚ æ¯æœˆæµ‹é‡ä¸€æ¬¡èº«ä½“å›´åº¦ï¼ˆèƒ¸ã€è‡‚ã€è…°ã€è‡€ã€è…¿ï¼‰ã€‚ è®°å½•è®­ç»ƒé‡é‡å’Œæ¬¡æ•°ã€‚ æ ¹æ®ä½“é‡ã€å›´åº¦ã€åŠ›é‡å’Œä½“æ„Ÿï¼ˆç–²åŠ³ç¨‹åº¦ã€æ¢å¤æƒ…å†µï¼‰æ¥è°ƒæ•´çƒ­é‡æ‘„å…¥å’Œè®­ç»ƒè®¡åˆ’ã€‚ æ€»ç»“ï¼š åƒå¤Ÿï¼š æ¯å¤©2900-3000å¤§å¡èµ·ï¼Œé‡ç‚¹åƒè¶³è›‹ç™½è´¨ (108-132å…‹)ï¼Œå®‰æ’å¥½6é¤ã€‚ ç»ƒå¯¹ï¼š æ¯å‘¨3-4æ¬¡åŠ›é‡è®­ç»ƒï¼Œä»¥å¤åˆåŠ¨ä½œä¸ºä¸»ï¼Œè¿½æ±‚æ¸è¿›è¶…è´Ÿè·ï¼Œä¿è¯åŠ¨ä½œè´¨é‡ã€‚ ç¡å¥½ï¼š ä¿è¯7-9å°æ—¶ç¡çœ ã€‚ å–è¶³ï¼š æ¯å¤©3-4å‡æ°´ã€‚ åšæŒä¸è°ƒæ•´ï¼š è€å¿ƒæ‰§è¡Œï¼Œå®šæœŸç›‘æ§å¹¶æ ¹æ®åé¦ˆè°ƒæ•´è®¡åˆ’ã€‚","categories":[{"name":"æ‚è¯´","slug":"æ‚è¯´","permalink":"http://example.com/categories/%E6%9D%82%E8%AF%B4/"}],"tags":[]},{"title":"pythonå…¥é—¨","slug":"source/python/å…¥é—¨","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2025/08/04/source/python/å…¥é—¨/","permalink":"http://example.com/2025/08/04/source/python/%E5%85%A5%E9%97%A8/","excerpt":"","text":"ä¸‹è½½Poetryä¸‹è½½windows123456789# è®¾ç½®ä¸´æ—¶pipé•œåƒpip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -# è®¾ç½®ç¯å¢ƒå˜é‡win+R sysdm.cpl# ç”¨æˆ· pathC:\\Users\\tutu\\AppData\\Roaming\\Python\\Scripts 1234567891011121314poetry --versionpoetry new ai_novel# æ·»åŠ ä¾èµ–poetry add &lt;&gt;# åˆ é™¤ä¾èµ–poetry remove &lt;&gt;# å®‰è£…æ‰€æœ‰ä¾èµ–poetry install# è¿è¡Œpoetry run python src/&lt;&gt;/main.py# è¿›å…¥è™šæ‹Ÿç¯å¢ƒä¹‹åè¿è¡Œpoetry shell # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒpython src/&lt;&gt;/main.pyexit é•œåƒ 12poetry source showpoetry source add --default tsinghua https://pypi.tuna.tsinghua.edu.cn/simple","categories":[{"name":"python","slug":"python","permalink":"http://example.com/categories/python/"}],"tags":[]},{"title":"Podman","slug":"source/å·¥å…·-ç¯å¢ƒ/Podman","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/04/source/å·¥å…·-ç¯å¢ƒ/Podman/","permalink":"http://example.com/2025/08/04/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/Podman/","excerpt":"","text":"ä¸‹è½½mac12https://podman.io/ #ä¸‹è½½ desktop # Create a Podman machine 2æ ¸4G LInux-Centos123sudo dnf -y updatesudo dnf -y install podmansudo dnf install -y postgresql winhttps://blog.csdn.net/qq_43072399/article/details/134076856 å¯ç”¨wsl 123456789101112131415ctrl+r control# æ§åˆ¶é¢æ¿\\ç¨‹åº\\ç¨‹åºå’ŒåŠŸèƒ½ - å¯ç”¨æˆ–å…³é—­windwosåŠŸèƒ½# å¼€å¯é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»Ÿè™šæ‹Ÿæœºå¹³å°# é‡å¯# ç®¡ç†å‘˜æ¨¡å¼å¯ç”¨powershellwsl --set-default-version 2wsl --updatewsl --install# https://github.com/containers/podman/tree/main# æˆ‘ä¸‹è½½çš„æ˜¯podman-installer-windows-amd64.exe åŒå‡»å®‰è£…podman --version # podman version 5.5.2podman machine initpodman machine start é•œåƒ-æš‚æ—¶æ— ç”¨å¯ç”¨é•œåƒæ±‡æ€»ï¼šhttps://www.coderjia.cn/archives/dba3f94c-a021-468a-8ac6-e840f85867ea é•œåƒæºï¼šhttps://1ms.run/ Linux123456789# /etc/containers/registries.confunqualified-search-registries = [&quot;docker.io&quot;][[registry]]prefix = &quot;docker.io&quot;location = &quot;docker.1ms.run&quot;sudo systemctl restart podman 12345678910111213141516mkdir -p ~/.config/containerstouch ~/.config/containers/registries.conf# æˆ–è€…ï¼Œæˆ‘å½“æ—¶ä¸¤ä¸ªåœ°æ–¹éƒ½é…ç½®äº†ï¼Œåé¢æ‰çŸ¥é“è¦é‡å¯sudo mkdir -p /etc/containerssudo touch /etc/containers/registries.conf# éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸpodman info --format &#x27;&#123;&#123;json .Registries&#125;&#125;&#x27; | jq# è¿›å…¥Podman Machine (QEMU è™šæ‹Ÿæœº)å†…éƒ¨podman machine ssh# ä¿®æ”¹é…ç½®æ–‡ä»¶sudo vi /etc/containers/registries.confpodman machine stoppodman machine start machttps://juejin.cn/post/7530868895767920675 æ”¹é…ç½®æ–‡ä»¶ 1234567891011121314151617&#123; &quot;builder&quot;: &#123; &quot;gc&quot;: &#123; &quot;defaultKeepStorage&quot;: &quot;20GB&quot;, &quot;enabled&quot;: true &#125; &#125;, &quot;dns&quot;: [&quot;8.8.8.8&quot;, &quot;1.1.1.1&quot;], &quot;experimental&quot;: false, &quot;features&quot;: &#123; &quot;buildkit&quot;: true &#125;, &quot;registry-mirrors&quot;: [ &quot;https://dockerpull.com&quot;, &quot;https://docker.1ms.run&quot; ]&#125; æ·»åŠ ä»£ç† Docker Desktop â†’ Settings â†’ Resources â†’ Proxieså‹¾é€‰ Manual proxy configuration å¹¶å¡«å†™ ä½¿ç”¨PostgreSQL1234567891011121314151617181920212223242526272829303132333435363738394041424344# macos Podman Machine è¿›å…¥ä¹‹åæ‰èƒ½è®¿é—® ping docker.iopodman machine ssh# pullpodman pull docker.io/library/postgres:latest # æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°é•œåƒï¼Œç›´æ¥å…¨å±€ä»£ç†æ‹‰podman pull docker.1ms.run/postgres:latest# æŸ¥çœ‹ç‰ˆæœ¬ 17.5podman run --rm postgres:latest postgres -V# runmkdir -p ~/pgdatapodman run -d \\ --name postgres \\ -e POSTGRES_PASSWORD=mysecretpassword \\ -v ~/pgdata:/var/lib/postgresql/data:Z \\ -p 5432:5432 \\ postgres:latest# å†…éƒ¨ç™»å½•podman exec -it postgres psql -U postgres# å¯¼å‡ºsqlpodman exec -t postgres pg_dumpall -U postgres &gt; ~/all_databases.sql# å¯¼å…¥sqlpodman exec -i postgres psql -U postgres &lt; ~/all_databases.sql# macos è¿æ¥æµ‹è¯•brew install libpqbrew link --force libpqpsql -h localhost -p 5432 -U postgres# åˆ›å»ºè¿œç¨‹è¿æ¥è´¦æˆ·psql -U postgresCREATE ROLE spark_user WITH LOGIN PASSWORD &#x27;strong_password&#x27;;# åˆ›å»ºæ•°æ®åº“-æŒ‡å®šç”¨æˆ·æƒé™CREATE DATABASE spark OWNER spark_user;# ä¿®æ”¹é…ç½®æ–‡ä»¶å…è®¸è¿œç¨‹è®¿é—® postgresql.conf# /var/lib/postgresql/data/postgresql.conf# /etc/postgresql/&lt;version&gt;/main/postgresql.conflisten_addresses = &#x27;*&#x27;# pg_hba.confhost all spark_user 0.0.0.0/0 md5podman restart postgres# æµ‹è¯•æ–°ç”¨æˆ·ç™»å½•psql -h localhost -p 5432 -U spark_user -d spark 1234select current_user; --æŸ¥è¯¢å½“å‰è§’è‰²SELECT current_database(); --æŸ¥è¯¢å½“å‰æ•°æ®åº“\\conninfo --æ•°æ®åº“ ç”¨æˆ· ip port\\c ç›®æ ‡æ•°æ®åº“å -- åˆ‡æ¢æ•°æ®åº“ ankane&#x2F;pgvectorå¸¦æœ‰pgvectoræ‰©å±•çš„pg 123456789101112131415podman pull docker.io/ankane/pgvector:latestpodman pull docker.1ms.run/pgvector:latestpodman run -d \\ --name postgresvec \\ -e POSTGRES_PASSWORD=mysecretpassword \\ -v ~/pgdatavec:/var/lib/postgresql/data:Z \\ -p 5432:5432 \\ docker.io/ankane/pgvector podman machine sshpodman exec -i postgresvec psql -U postgres &lt; ~/all_databases.sql psql -h localhost -p 5432 -U postgres -d spark # mysecretpassword -dæŒ‡å®šå¯ç”¨æ‰©å±•çš„æ•°æ®åº“CREATE EXTENSION IF NOT EXISTS vector; Redis1234podman pull redispodman run -d --name redis -p 6379:6379 redis# windows å®‰è£… Redis CLIpodman exec -it redis redis-cli","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"Podman","slug":"Podman","permalink":"http://example.com/tags/Podman/"}]},{"title":"uni-app","slug":"source/å·¥å…·-ç¯å¢ƒ/uni-app","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/04/source/å·¥å…·-ç¯å¢ƒ/uni-app/","permalink":"http://example.com/2025/08/04/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/uni-app/","excerpt":"","text":"ä¸‹è½½https://www.dcloud.io/hbuilderx.html ä¸‹è½½æ’ä»¶scss&#x2F;sassç¼–è¯‘ï¼šhttps://ext.dcloud.net.cn/plugin?name=compile-node-sass åˆ‡æ¢å¿«æ·é”®æ–¹æ¡ˆï¼šå·¥å…·-é¢„è®¾å¿«æ·æ–¹æ¡ˆ å·¥å…·-è®¾ç½®-æ‰“å¼€Setting.jsoné…ç½®å­—ä½“ï¼Œå¤§å° å‚è€ƒæ–‡æ¡£ï¼šhttps://uniapp.dcloud.net.cn/ æ–°å»ºvue3é¡¹ç›® uni_app_base åˆ›å»ºä¸€ä¸ª uni-app åŸºç¡€é¡¹ç›®-vue3-å…¶ä»–åŠ¨ä¸ç”¨å‹¾é€‰ manifest ä¸­å¡«å†™ AppID å…¥å£ main.js ä¸‹è½½ http è¯·æ±‚åº“ pnpm add @escook&#x2F;request-miniprogram ä½¿ç”¨vuex çš„çŠ¶æ€ç®¡ç† pages.json ä¸­å†™ é¡µé¢è·¯ç”±å’ŒtabBar ä¸€é”®ç™»å½•ä¸ç”¨æˆ·çŠ¶æ€ç®¡ç†ç™»å½•ç›¸å…³æ¥å£å‰ç«¯ wx.login è·å–ä¸´æ—¶codeä½¿ç”¨ uni æä¾›çš„æ¥å£ 1234567891011121314151617try &#123; // è·å–å¾®ä¿¡ç™»å½•code const loginRes = await uni.login(&#123; provider: &#x27;weixin&#x27; &#125;) console.log(&#x27;å¾®ä¿¡ç™»å½•code:&#x27;, loginRes.code) // è°ƒç”¨ç™»å½•æ¥å£ ...&#125; catch (error) &#123; console.error(&#x27;ç™»å½•å¤±è´¥:&#x27;, error) uni.showToast(&#123; title: &#x27;ç™»å½•å¤±è´¥: &#x27; + error.message, icon: &#x27;none&#x27; &#125;)&#125; åç«¯ code2Sessionä¼ å…¥ï¼š å°ç¨‹åº appIdï¼Œ å°ç¨‹åº appSecretï¼Œ codeï¼Œ grant_typeè¿”å›ï¼š session_keyï¼Œunionid(åŒä¸ªå¾®ä¿¡è´¦å·åœ¨ä¸åŒå¹³å°çš„unionid éƒ½æ˜¯ç›¸åŒçš„)ï¼Œopenid 12ç¤ºä¾‹è¿”å›ï¼š&#123;\\&quot;session_key\\&quot;:\\&quot;7htQvdCCVR2eRgMFj/SneQ==\\&quot;,\\&quot;openid\\&quot;:\\&quot;o1Gqe6DPXUnYqa3MdNMyOlwFJ22w\\&quot;&#125;&quot;,&quot;level&quot;:&quot;info&quot;,&quot;span&quot;:&quot;f6af84092c254d93&quot;,&quot;trace&quot;:&quot;0f3cfd7df0efe9e7d88212c8779fc838&quot;&#125; https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-login/code2Session.html å‰ç«¯ wx.getUserProfile è·å–ç”¨æˆ·ä¿¡æ¯https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html ç›´æ¥è·å–ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ 12# res.userInfo&#123;&quot;nickName&quot;:&quot;å¾®ä¿¡ç”¨æˆ·&quot;,&quot;gender&quot;:0,&quot;language&quot;:&quot;&quot;,&quot;city&quot;:&quot;&quot;,&quot;province&quot;:&quot;&quot;,&quot;country&quot;:&quot;&quot;,&quot;avatarUrl&quot;:&quot;https://thirdwx.qlogo.cn/mmopen/vi_32/POgEwh4mIHO4nibH0KlMECNjjGxQUq24ZEaGT4poC6icRiccVGKSyXwibcPq4BWmiaIGuG1icwxaQX6grC9VemZoJ8rg/132&quot;,&quot;is_demote&quot;:true&#125; 123456789101112131415161718wx.getUserProfile(&#123; desc: &#x27;ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™&#x27;, // å£°æ˜è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯åçš„ç”¨é€” success: (res) =&gt; &#123; console.log(&#x27;ç”¨æˆ·ä¿¡æ¯:&#x27;, JSON.stringify(res.userInfo)) // æ˜¾ç¤ºæˆåŠŸæç¤º uni.showToast(&#123; title: &#x27;è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ&#x27;, icon: &#x27;success&#x27; &#125;) &#125;, fail: (err) =&gt; &#123; console.error(&#x27;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:&#x27;, err) uni.showToast(&#123; title: &#x27;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥&#x27;, icon: &#x27;none&#x27; &#125;) &#125;&#125;) ç‚¹å‡»è·å–ç”¨æˆ·å¤´åƒï¼Œç‚¹å‡»è·å–ç”¨æˆ·å123456789101112131415161718192021222324252627282930313233&lt;!-- å¤´åƒé€‰æ‹©æŒ‰é’® --&gt;&lt;button class=&quot;avatar-wrapper&quot; open-type=&quot;chooseAvatar&quot; @chooseavatar=&quot;onChooseAvatar&quot;&gt; &lt;image class=&quot;avatar&quot; :src=&quot;avatarUrl&quot;&gt;&lt;/image&gt;&lt;/button&gt;&lt;!-- å¤´åƒå¤„ç†æ–¹æ³• --&gt;onChooseAvatar(e) &#123; console.log(&quot;é€‰æ‹©å¤´åƒ:&quot;, e.detail.avatarUrl) this.avatarUrl = e.detail.avatarUrl&#125;&lt;!-- æ˜µç§°è¾“å…¥æ¡† --&gt;&lt;view class=&quot;row&quot;&gt; &lt;view class=&quot;text1&quot;&gt;æ˜µç§°ï¼š&lt;/view&gt; &lt;input type=&quot;nickname&quot; class=&quot;weui-input&quot; name=&quot;nickname&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot;/&gt;&lt;/view&gt;&lt;!-- æ˜µç§°å¤„ç†æ–¹æ³• --&gt;async formSubmit(e)&#123; console.log(&quot;nickname: &quot; + e.detail.value.nickname) // è·å–æ˜µç§° const nickname = e.detail.value.nickname if (!nickname) &#123; uni.showToast(&#123; title: &#x27;è¯·è¾“å…¥æ˜µç§°&#x27;, icon: &#x27;none&#x27; &#125;) return &#125; // åç»­ç™»å½•é€»è¾‘...&#125; è·å–æ‰‹æœºå·æ”¶è´¹åŠŸèƒ½ï¼Œæš‚ä¸è€ƒè™‘ ä¸€é”®ç™»å½• è°ƒç”¨wx.getUserProfile è·å–ç”¨æˆ·ä¿¡æ¯(æ˜µç§°ï¼Œå¤´åƒï¼Œæ€§åˆ«) wx.login è·å–ä¸´æ—¶code ä¼ å…¥åç«¯è‡ªå®šä¹‰æ¥å£è°ƒç”¨code2Session å®Œæˆç™»å½• åç«¯åˆ¤æ–­ç”¨æˆ·æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å­˜å‚¨ç”¨æˆ·æ•°æ® è¿”å› access_token å°ç¨‹åºè®°å½• access_token å°ç¨‹åºä¼ å…¥access_tokenï¼Œè°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ ç”¨æˆ·ä¿¡æ¯ç®¡ç†æ£€æŸ¥æ˜¯å¦ä¸ºç™»å½•çŠ¶æ€ access_token å­˜åœ¨å¹¶ä¸”æ²¡æœ‰è¿‡æœŸ èƒ½è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œå¹¶æ›´æ–°ç”¨æˆ·ä¿¡æ¯ ç™»å½•çŠ¶æ€æ¢å¤ æ£€æŸ¥ç™»å½•çŠ¶æ€ å¦‚æœæ£€æŸ¥ç»“æœä¸ºæœªç™»å½•è°ƒç”¨ä¸€é”®ç™»å½•çš„é€»è¾‘ é€€å‡ºç™»å½•æ¸…ç©ºä¿å­˜çš„ token å’Œç”¨æˆ·ä¿¡æ¯","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"uni-app","slug":"uni-app","permalink":"http://example.com/tags/uni-app/"}]},{"title":"å·¥å…·å¯¼èˆª","slug":"source/å·¥å…·-ç¯å¢ƒ/å·¥å…·","date":"2025-08-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/08/04/source/å·¥å…·-ç¯å¢ƒ/å·¥å…·/","permalink":"http://example.com/2025/08/04/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/%E5%B7%A5%E5%85%B7/","excerpt":"","text":"å›¾ç‰‡ç¼–è¾‘https://www.iloveimg.com/zh-cn å»é™¤èƒŒæ™¯https://www.iloveimg.com/zh-cn/remove-background åˆ¶ä½œç½‘ç«™logo ç­¾å å›¾ç‰‡æè‡´å‹ç¼© å¯å°†3mbå‹ç¼©è‡³å‡ ç™¾kb https://squoosh.app/ Resizeï¼šå®½åº¦æ”¹ä¸º 1920 æˆ– 2560 åƒç´  Formatï¼šWebP Qualityï¼š70~80% å·¦å³ æ°´å°å»é™¤https://www.arkthinker.com/zh/watermark-remover/ aiç”Ÿæˆå›¾ç‰‡vheer.com éœ€è¦ä»£ç† è±†åŒ… æ”¯ä»˜ijpay.dreamlu.net&#x2F;ijpay&#x2F;guide&#x2F;#å¼€æºæ¨è è¯­éŸ³æ–‡å­—è½¬è¯­éŸ³https://www.meixiaosan.com/tosound.html éŸ³ä¹ä¼´å¥åˆ†ç¦»12345678# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒpython3 -m venv spleeter-env# ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒsource spleeter-env/bin/activate# å®‰è£…pip install spleeter# ä½¿ç”¨spleeter separate -i your.mp3 -p spleeter:2stems -o output Command + Shift + . æ˜¾ç¤ºmacçš„éšè—æ–‡ä»¶å¤¹ brewä¸‹è½½ é•œåƒ","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[]},{"title":"äº§å“ç»ç†å…¥é—¨","slug":"source/PM/å…¥é—¨","date":"2025-08-02T16:00:00.000Z","updated":"2025-08-31T08:06:09.542Z","comments":true,"path":"2025/08/03/source/PM/å…¥é—¨/","permalink":"http://example.com/2025/08/03/source/PM/%E5%85%A5%E9%97%A8/","excerpt":"","text":"äº§å“ç»ç†åˆ†ç±»ï¼š C ç«¯ é¢å‘æ™®é€šç”¨æˆ· B ç«¯ é¢ç›¸ä¼ä¸šæˆ–å…¬å¸å†…éƒ¨ G ç«¯ é¢ç›¸æ”¿åºœéƒ¨é—¨ èŒè´£ï¼š äº§å“çš„å¼€å‘æµç¨‹ åˆ†æå®šä¹‰ é—®é¢˜å®šä¹‰ å¯è¡Œæ€§ç ”ç©¶ éœ€æ±‚åˆ†æ è½¯ä»¶è®¾è®¡ æ¦‚è¦è®¾è®¡ è¯¦ç»†è®¾è®¡ ç¼–ç æµ‹è¯• ç¨‹åºç¼–ç  é›†æˆæµ‹è¯• è¿è¡Œç»´æŠ¤ æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜åŠå…¶èŒè´£ äº§å“è®¾è®¡éƒ¨äº§å“ç»ç†ï¼Œå¹³é¢è®¾è®¡ï¼Œäº¤äº’è®¾è®¡ ç ”å‘éƒ¨å‰ç«¯ï¼Œåç«¯ï¼Œæµ‹è¯•ï¼Œè¿ç»´ é¡¹ç›®ç»„é¡¹ç›®ç»ç† äº§å“ç»ç†èŒè´£ï¼š è¯„ä¼°äº§å“æœºä¼šéœ€æ±‚æ”¶é›†(ç”¨æˆ·åé¦ˆï¼Œè¿è¥ç­‰)ï¼Œå¯è¡Œæ€§åˆ†æ(æŠ€æœ¯ï¼Œè´¨é‡ï¼Œæˆæœ¬ï¼Œæœºä¼š)äº§å‡ºï¼šMRD æ–‡æ¡£ï¼ˆå¸‚åœºéœ€æ±‚æ–‡æ¡£ï¼‰&#x2F;ç«‹é¡¹æŠ¥å‘Š å®šä¹‰è¦å¼€å‘çš„äº§å“éœ€æ±‚åˆ†æï¼ŒåŸå‹è®¾è®¡ï¼Œäº§å‡º PRD æ–‡æ¡£ é¢å¤–èŒè´£(æœ‰çš„å…¬å¸æ²¡æœ‰éœ€è¦ pm åš) ç»„ç»‡å¼€å‘&#x2F;é¡¹ç›®ç®¡ç†ï¼Œäº¤äº’è®¾è®¡&#x2F;ç”¨æˆ·ä½“éªŒ èƒ½åŠ›éœ€æ±‚ï¼š è°ƒç ”åˆ†æï¼šå•†ä¸šï¼Œè¡Œä¸šï¼Œå¸‚åœºï¼Œ ç”¨æˆ·ï¼Œç«å“ï¼Œéœ€æ±‚ å†³ç­–åˆ¤æ–­ï¼šå¯è¡Œæ€§ï¼Œä¼˜å…ˆçº§ï¼Œæˆæœ¬ï¼ŒæŠ€æœ¯ï¼Œé£é™© è§„åˆ’å®šä¹‰ï¼šä¸šåŠ¡ï¼Œæ¶æ„ï¼Œæµç¨‹ï¼Œç»“æ„ï¼ŒåŠŸèƒ½ï¼Œé€»è¾‘ ä½“éªŒè®¾è®¡ï¼šç”¨æˆ·ä½“éªŒï¼ŒåŸå‹è®¾è®¡ï¼Œäº§å“ä½“éªŒï¼Œäº¤äº’ä½“éªŒï¼Œäº§å“ä½“éªŒ æ–‡æ¡£å·¥å…·ï¼šBRDï¼ŒMRDï¼ŒPRDï¼Œç«‹é¡¹è¯´æ˜ä¹¦ï¼Œäº§å“è¯´æ˜ä¹¦ï¼Œåä½œå·¥å…·ï¼Œè®¾è®¡å·¥å…· å·¥å…·ï¼š åŸå‹å·¥å…·ï¼šAxure PR å¢¨åˆ€ è„‘å›¾å·¥å…·ï¼šXMind MindMaster æµç¨‹å›¾å·¥å…·ï¼šProcessOn ç»¼åˆç´ è´¨ï¼š æœ‰è´£ä»»å¿ƒï¼Œæ²Ÿé€šè¡¨è¾¾ï¼ŒåŒç†å¿ƒï¼Œç»ˆèº«å­¦ä¹ ï¼Œåˆ›æ–°ï¼Œæƒ…å•†ï¼Œåä½œç»„ç»‡ï¼Œé€»è¾‘æ€ç»´ é—®é¢˜æ€è€ƒç»´åº¦-ç”¨æˆ·ç”¨æˆ·ï¼š ç›®æ ‡ç”¨æˆ· ç§å­ç”¨æˆ· ï¼ˆå°é²œï¼‰ æ ¸å¿ƒç”¨æˆ·ï¼ˆå•†ä¸šä»·å€¼ï¼‰ æ½œåœ¨ç”¨æˆ· æŠ“ä½æ ¸å¿ƒç”¨æˆ·ï¼Œä¿æŒå¸‚åœºç«äº‰åŠ› å®šä¹‰æ ¸å¿ƒç”¨æˆ·ç¾¤ä½“ï¼š ä¾›éœ€å…³ç³»æœåŠ¡ç«¯æ¶ˆè´¹ç«¯ ç»Ÿè®¡å­¦å¹´é¾„ï¼Œæ€§åˆ«ï¼Œåœ°åŸŸï¼ŒèŒä¸šï¼Œæ¶ˆè´¹æ°´å¹³ ç†Ÿç»ƒç¨‹åº¦æ–°ç”¨æˆ·ï¼Œè€ç”¨æˆ·ï¼Œä¸“å®¶ç”¨æˆ· æŠ“ä½æ ¸å¿ƒç”¨æˆ·ï¼š æ†ç»‘å¼(ä¼šå‘˜åˆ¶ï¼Œé™æ—¶ä¼˜æƒ )ï¼Œè¯±å¯¼å¼(ä½ä»·)ï¼Œäº«å—å‹(æœåŠ¡)ï¼Œç½‘ç»œå‹(ç¤¾äº¤ï¼Œç½‘ç»œç¤¾ç¾¤)ï¼Œè‚¡ä¸œå‹(ç²‰ä¸) åœºæ™¯åŒ–åˆ†æ æ„ŸçŸ¥ç”¨æˆ·çš„çœŸå®ä½“éªŒæ„Ÿå— åœºæ™¯åŒ–åˆ†ææ–¹æ³•ï¼š åˆ—ä¸¾åœºæ™¯è¦ç´ ï¼Œæ„å»ºåœºæ™¯ç”»é¢ï¼Œé¢„åˆ¤å‘ç°éœ€æ±‚ åœºæ™¯äº”è¦ç´ ï¼š ç”¨æˆ·åˆ†æï¼šç±»å‹ï¼Œç‰¹å¾ï¼Œç†Ÿæ‚‰ç¨‹åº¦ åœ°ç‚¹ï¼šåœ°ç†ä½ç½®ï¼Œä½¿ç”¨åœºæ‰€ï¼Œè½¯ä»¶å¹³å°(macï¼Œphoneï¼Œå°ç¨‹åºç­‰) æ—¶é—´ï¼šå›ºå®šæ—¶é—´ï¼Œå‘¨æœŸæ€§æ—¶é—´(å·¥ä½œæ—¥) è¡Œä¸ºï¼šä½¿ç”¨æµç¨‹å’Œæ“ä½œè¡Œä¸º ç›®çš„ï¼Œç”¨æˆ·æƒ³è¦ä»€ä¹ˆ æ„å»ºç”»é¢ ä¸Šç­æ—åœ¨ä¸Šç­é€šå‹¤çš„åœ°é“ä¸Šï¼Œé€šè¿‡åˆ·è§†é¢‘æ¥è·å–æœ€æ–°çš„æ–°é—»èµ„è®¯ é¢„åˆ¤ç”¨æˆ·è¡Œä¸ºä¸ç›®æ ‡ï¼š ç»„æˆåŠ¨ä½œ(è¯„è®ºä¸å›å¤ï¼Œåˆ†æä¸è½¬å‘ï¼Œå¤åˆ¶ä¸ç²˜è´´ç­‰)å¸¸è¿›ç”¨æˆ·è¡Œä¸º(ä¸‹æ‹‰åˆ·æ–°ï¼Œå·¦æ»‘ä¸Šä¸€é¡µï¼ŒåŒå‡»ç‚¹èµ)äº§å“ä½¿ç”¨æµç¨‹(æœç´¢-ç­›é€‰-æŸ¥çœ‹è¯¦æƒ…) åœºæ™¯åŒ–åˆ†æçš„åº”ç”¨ï¼šæ´å¯Ÿé—®é¢˜ï¼Œç†è§£ç”¨æˆ·ï¼Œæé«˜é¢„æœŸ éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ ç”¨æˆ·é¢„æœŸå’Œç°çŠ¶æœ‰å·®å¼‚ éœ€æ±‚æ”¶é›†æ–¹æ³•ï¼š è§‚å¯Ÿç”¨æˆ·åé¦ˆé—®å·è°ƒæŸ¥ç”¨æˆ·è®¿è°ˆåˆ‡èº«æ„Ÿå—ï¼Œæˆ–åŠ å…¥ç¤¾ç¾¤ ä¸šåŠ¡åˆ†æï¼Œæ–‡çŒ®åˆ†æï¼Œå¤´è„‘é£æš´ç«å“åˆ†æï¼Œæ•°æ®åˆ†æ ä¸€æ‰‹éœ€æ±‚å’ŒäºŒæ‰‹éœ€æ±‚ ä¸€æ‰‹éœ€æ±‚ï¼Œæ›´å‡†ç¡®ï¼Œæ•ˆç‡ä½äºŒæ‰‹éœ€æ±‚ï¼Œæ•ˆç‡é«˜ï¼Œæ˜“æ›²è§£å…¨å‘˜æ”¶é›†ï¼Œç»Ÿä¸€å¤„ç† éœ€æ±‚è¾¨åˆ«ï¼šç»´åº¦ï¼šéœ€æ±‚çœŸå®ï¼Œéœ€æ±‚å¼ºçƒˆ(ä»·å€¼ï¼Œé£é™©ï¼Œè§„æ¨¡)ï¼Œéœ€æ±‚é«˜é¢‘ä¼˜å…ˆçº§ï¼šå¼ºçƒˆä¸”é«˜é¢‘ï¼Œå¼ºçƒˆä½é¢‘ï¼Œä¸å¼ºçƒˆé«˜é¢‘ ç”¨æˆ·æ•…äº‹ï¼šå°†å…¸å‹ç”¨æˆ·åœ¨åº”ç”¨åœºæ™¯ä¸‹å°†éœ€æ±‚è¿›è¡Œæè¿°çš„ä¸€ç§æ–¹å¼ æ¨¡æ¿ï¼šæ•…äº‹ä¸»é¢˜ï¼Œæ•…äº‹ idï¼Œåšæ²¡&lt;æŸè§’è‰²&gt;ï¼Œéœ€è¦å®ç°ä»€ä¹ˆç›®æ ‡ï¼ŒåŸå› ï¼ŒéªŒæ”¶æ ‡å‡†ï¼Œæ¡ä»¶ï¼Œè§¦å‘ç‚¹ï¼Œé¢„æœŸç»“æœ äº§å“è§£å†³æ–¹æ¡ˆéœ€æ±‚åˆ†æéœ€æ±‚åˆ†æçš„æ–¹æ³•ï¼šY æ¨¡å‹ å¦‚ä½•åŸºäºäººæ€§çš„åˆ†æå¾—å‡ºä¸ä¹‹åŒ¹é…çš„è§£å†³æ–¹æ¡ˆï¼Ÿ ä»¥äººæ€§ä¸ƒå®—ç½ªä¸¾ä¾‹ å‚²æ…¢ï¼šè¿½æ±‚ä¼˜è¶Šæ„Ÿï¼Œçˆ±æ…•è™šè£äº§å“ï¼šç‚«è€€ä¼˜è¶Šæ„Ÿï¼Œè£èª‰å±•ç¤ºï¼Œç²‰ä¸æ•°ï¼Œæˆå°±ï¼Œç‚¹èµæ•°å¦’å¿Œï¼šæ’è¡Œæ¦œï¼Œæ®µä½æ„¤æ€’ï¼šæ‹‰é»‘ï¼Œåˆ é™¤ï¼Œæ³¨é”€ï¼Œå……å€¼å…³é—­å¹¿å‘Šæ‡’æƒ°ï¼šä¾¿æ·å·¥å…·ï¼Œæ›´å°‘æ€è€ƒï¼Œæ›´å°‘å†³ç­–è´ªå©ªï¼šå…è´¹ä½“éªŒï¼Œæ–°äººç¦åˆ©ï¼Œç­¾åˆ°é¥•é¤®ï¼šç¾é£Ÿè‰²æ¬²ï¼š(åŒå¹´é¾„æˆ–åŒå¹´çº§çš„æ’å) å¦‚ä½•åŠæ—¶ç»™å‡ºæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿå¤šä½“éªŒï¼Œåˆ›æ–° åŠŸèƒ½ä¼˜å…ˆçº§åˆ’åˆ†KANO æ¨¡å‹ï¼Œå¯¹ç”¨æˆ·éœ€æ±‚åˆ†ç±»å¹¶æ’åºM çš„ä¼˜å…ˆçº§æœ€é«˜ å¦‚ä½•å¾—åˆ° KANO æ¨¡å‹ï¼Ÿ é—®å· (é—®é¢˜éœ€è¦æ­£åè®¾è®¡) åŠŸèƒ½å±æ€§è¯„å®š åŠŸèƒ½ä»·å€¼ è¯„ä¼°ä¸€ä¸ªåŠŸèƒ½çš„ä»·å€¼ï¼Œå¯ä»¥å…ˆè¯•ç‚¹ å®é™…ä»·å€¼åˆ¤æ–­ èŒƒå›´ä»·å€¼&#x3D;æ½œåœ¨ç”¨æˆ·æ•°*å•ç”¨æˆ·ä»·å€¼ é¢‘æ¬¡ä»·å€¼&#x3D;éœ€æ±‚é¢‘æ¬¡*å•æ¬¡ä»·å€¼ æ—¶é—´ä»·å€¼&#x3D;æŒç»­æ—¶é—´*å•ä½ä»·å€¼ æˆæœ¬è¯„ä¼°æˆæœ¬&#x3D;å®ç°æ—¶é—´(å¤©)*æ¯(å¤©)èŠ±å¤šå°‘ ç”¨æˆ·ä½“éªŒ ueå½±å“å› ç´ ï¼š ä½¿ç”¨è€…çš„çŠ¶æ€ï¼šç²¾ç¥çŠ¶æ€ï¼Œæ€§æ ¼ç‰¹å¾ï¼ˆåŠ¨æœºï¼Œæƒ…ç»ªï¼Œè®¤çŸ¥ï¼‰ç³»ç»Ÿæ€§èƒ½ç¯å¢ƒ(çŠ¶å†µ) demoï¼šä¸‹ç­åçš„åœ°é“ä¸Šè¯¢é—®å®¶äººæ™šé¥­åƒä»€ä¹ˆï¼Œç¯å¢ƒï¼šåœ°é“ï¼Œç³»ç»Ÿæ€§èƒ½ï¼šè¯­éŸ³ï¼Œæ–‡å­—ï¼Œç”µè¯ï¼Œè§†é¢‘ ç”¨æˆ·ä½“éªŒçš„ç±»åˆ«ï¼š æ„Ÿå®˜ï¼šè‰²å½©ï¼Œå£°éŸ³ï¼Œå¸ƒå±€ï¼Œuiäº¤äº’æƒ…æ„Ÿï¼šå¿ƒé‡Œè®¤åŒåº¦ ç”¨æˆ·ä½“éªŒçš„å±‚æ¬¡ï¼š ç”¨æˆ·ä½“éªŒçš„è®¾è®¡ç›®æ ‡ï¼š é¡¹ç›®ç«‹é¡¹æµç¨‹ï¼šé¡¹ç›®ç«‹é¡¹-å¼€å‘é˜¶æ®µ-æµ‹è¯•é˜¶æ®µä¸Šçº¿é˜¶æ®µ-è¿è¥é˜¶æ®µ-æ€»ç»“é˜¶æ®µ ç«‹é¡¹é˜¶æ®µï¼š ä»»åŠ¡æå‡º-åŸºæœ¬æ–¹æ¡ˆ ç°åœ¨çš„ä¸šåŠ¡æ˜¯ä»€ä¹ˆï¼Œè¦åšä»€ä¹ˆæ–°ä¸šåŠ¡ï¼Œæˆ–å“ªäº›æµç¨‹éœ€è¦ä¼˜åŒ–ï¼Œéœ€è¦åšå“ªäº›å¹³å°ï¼Œå¥½å¤„æœ‰å“ªé‡Œ éœ€æ±‚è®¨è®º-ä¼šè®®çºªè¦ å¯è¡Œæ€§åˆ†æ-MRDï¼Œå¯è¡Œæ€§æŠ¥å‘Š ç«‹é¡¹å¯åŠ¨-ç«‹é¡¹ç”³è¯·è¡¨ é¡¹ç›®æ–¹æ¡ˆç®€ä»‹ï¼šäº§å“åç§°ï¼Œå¸‚åœºèƒŒæ™¯ï¼Œæ ¸å¿ƒç”¨æˆ· å¯è¡Œæ€§åˆ†æå¸‚åœºéœ€æ±‚ï¼Œèµ„æºä¾›åº”ï¼ŒåŠŸèƒ½è§„æ¨¡ï¼Œå¼€å‘æŠ€æœ¯ï¼Œè®¾å¤‡ç±»å‹ï¼Œç¯å¢ƒå°è±¡ï¼Œèµ„é‡‘ï¼Œç›ˆåˆ©èƒ½åŠ› å¸‚åœºç¯å¢ƒå¯¹äº§å“è§„åˆ’çš„å½±å“ï¼š ç›®æ ‡å¸‚åœºç°çŠ¶ï¼Œè§„æ¨¡ï¼Œè¶‹åŠ¿ï¼Œå¸‚åœºæ ¼å±€ï¼Œç°åœ¨çš„é—®é¢˜ï¼Œå£å’ç›®æ ‡ç”¨æˆ·ç¾¤ä½“ï¼Œç”¨æˆ·ç‰¹å¾ï¼Œä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·éœ€æ±‚æ€»ç»“ç«å“ï¼Œç«å“çš„ç”¨æˆ·å®šä½ï¼Œç«å“çš„æ ¸å¿ƒä¸šåŠ¡ä¸ä¸»è¦åŠŸèƒ½ï¼Œä¼˜ç¼ºç‚¹ å¸‚åœºç¯å¢ƒåˆ†æï¼š å¸‚åœºè°ƒç ”ï¼šé€‰å–ç‰¹ç‚¹æ–¹å¼è°ƒç ”ï¼Œç¡®å®šæ•°æ®æ¥æºå¸‚åœºè°ƒç ”ï¼šæ ¹æ®è°ƒç ”ï¼Œç›´è§‚å‘ˆç°ç›®æ ‡å¸‚åœºç°çŠ¶ï¼Œè¶‹åŠ¿ï¼Œé—®é¢˜ï¼Œæœºä¼š ç”¨æˆ·åˆ†æï¼šç›®æ ‡ç”¨æˆ·ç¾¤ä½“(å¤§å­¦ç”Ÿ)ç”¨æˆ·ç”»åƒ ï¼ˆåŸºæœ¬ä¿¡æ¯ï¼Œç‰¹ç‚¹ï¼Œå–œå¥½ç­‰ï¼‰ç›®æ ‡åœºæ™¯(å…·ä½“åœºæ™¯) ç«å“åˆ†æï¼šç«å“çš„åŸºç¡€ä¿¡æ¯ï¼Œåç§°ï¼Œç±»å‹ï¼Œå®šä½ï¼Œæˆ˜ç•¥ï¼Œå‘å±•å†ç¨‹ï¼ŒèƒŒæ™¯ï¼Œç°çŠ¶ï¼Œç›ˆåˆ©æ¨¡å¼ï¼ŒæŠ€æœ¯ç”¨æˆ·å®šä½åŠŸèƒ½å¯¹æ¯”ä¼˜ç¼ºç‚¹ äº§å“è§„åˆ’ äº§å“å®šä½ï¼šç›®æ ‡å¸‚åœºç›®æ ‡å…¨ä½“ï¼Œæä¾›ä»€ä¹ˆæœåŠ¡ï¼Œæ»¡è¶³ä»€ä¹ˆéœ€æ±‚ ç›®æ ‡ç”¨æˆ·ï¼šç”¨æˆ·ç¾¤ä½“ç‰¹å¾ æ ¸å¿ƒä¸šåŠ¡ï¼šæ ¸å¿ƒä¸šåŠ¡ä¸ä¸»è¦æµç¨‹ ä¸»è¦åŠŸèƒ½ä¸ç‰¹è‰² äº§å“ç»“æ„ï¼Œä¸»è¦é¡µé¢ï¼ŒåŠŸèƒ½ï¼Œä¿¡æ¯ ç‰ˆæœ¬è§„åˆ’ ç«‹é¡¹è¯„å®¡ ç«‹é¡¹è¯´æ˜ä¹¦ç»“æ„ï¼š äº§å“æ¦‚è¿°ï¼šäº§å“å®šä½ï¼Œç›®æ ‡ç”¨æˆ·ï¼Œä¸»è¦åŠŸèƒ½ å¯è¡Œæ€§åˆ†æï¼šå¸‚åœºç¯å¢ƒåˆ†æï¼Œç”¨æˆ·åˆ†æï¼Œç«å“åˆ†æ äº§å“è§„åˆ’ï¼šäº§å“æ¶æ„å›¾ï¼Œä¸šåŠ¡æµç¨‹å›¾ï¼Œäº§å“ç»“æ„å›¾ï¼ŒåŠŸèƒ½æ¸…æ·¡ï¼Œè¿­ä»£è®¡åˆ’ è¯„å®¡ä¼šè®®æµç¨‹ï¼š é¢„çº¦ä¼šè®®(ç¡®è®¤å‚ä¼šäººä¸æ—¶é—´åœ°ç‚¹ï¼Œæå‰æ²Ÿé€šï¼Œå‘é€é‚®ä»¶ï¼Œä¼šè®®ææ–™)ä¼šå‰å‡†å¤‡(å‡†å¤‡ç ”ç©¶è®¾å¤‡ï¼Œåè°ƒä¼šè®®è®°å½•äººå‘˜ï¼Œå¼€ä¼šå‰å†æ¬¡é€šçŸ¥å¼€ä¼šæ—¶é—´ï¼Œç¡®è®¤æ ¸å¿ƒäººå‘˜æ˜¯å¦æ— æ³•å‚ä¼š)ä¼šè®®è¿‡ç¨‹(å¼ºè°ƒä¸»é¢˜ï¼Œç›®çš„ï¼Œä¼šè®®æ—¶é—´ï¼Œæ³¨æ„äº‹é¡¹ï¼ŒæŠŠæ¡è®¨è®ºæ—¶é—´ï¼Œè®°å½•å…³é”®éœ€æ±‚ï¼Œå¾…ç¡®è®¤éœ€æ±‚ç­‰)ä¼šåè·Ÿè¸ª(åŒæ­¥ä¼šè®®ç»“è®ºç»™ç›¸å…³äººå‘˜æˆ–é¢†å¯¼ï¼Œç¡®å®šå¾…ç¡®è®¤éœ€æ±‚çš„è·Ÿè¿›æ—¶é—´ï¼Œå¾…è®¨è®ºçš„ç»†èŠ‚) å¦‚æœé€šè¿‡ï¼Œéœ€è¦å‘èµ·ç«‹é¡¹ç”³è¯·è¡¨ åŸå‹çš„åˆ†ç±»ï¼š è‰å›¾ï¼Œæ‰‹ç»˜ï¼Œæ–¹ä¾¿ä¿®æ”¹ä½ä¿çœŸåŸå‹ï¼Œæ²¡æœ‰è®¾è®¡å›¾ï¼Œé»‘ç™½ï¼Œé€‰æ‹©å°ºå¯¸ï¼Œåˆ’åˆ†åŒºåŸŸï¼Œä½¿ç”¨åŸºç¡€ç»„ä»¶é«˜ä¿çœŸåŸå‹ å¢¨åˆ€ï¼šé¡µé¢çŠ¶æ€ï¼Œç‚¹å‡»åˆ‡æ¢çŠ¶æ€å³å¯ï¼Œå…¨å±€äº‹ä»¶ åŠ¨æ€ç»„ä»¶ï¼šå³é”®ç‚¹å‡»ç»„ä»¶ï¼Œè½¬åŒ–ä¸ºåŠ¨æ€ç»„ä»¶ï¼Œè®¾ç½®ç»„ä»¶çŠ¶æ€ï¼Œæ·»åŠ äº¤äº’äº‹ä»¶ äº”å¼ å›¾æ ¸å¿ƒä½“éªŒå›¾eg:ç”µå•†æ‰¾-äº†è§£-ä¸‹å•-æ”¶é¦–é¡µ % è¯¦æƒ… % è´­ç‰©è½¦&#x2F;ç›´æ¥è´­ä¹° % é€€è´§ äº§å“æ¨¡å—å›¾å¯¼è´­ï¼šhome-search-detailäº¤æ˜“ï¼špay-å”®åè¥é”€ï¼šä¼˜æƒ åˆ¸-ç§¯åˆ†-æ‹¼å›¢ åŠŸèƒ½æ ‘egï¼šæœç´¢åŠŸèƒ½ é¡µé¢å…³ç³»å›¾ äº¤äº’å›¾mockupå°±æ˜¯ä¸€ä¸ªå¤§è‡´çš„åŸå‹ï¼Œç„¶åè§£é‡Šå…¶ä¸­çš„ä¸€äº›äº¤äº’é€»è¾‘ï¼Œç°åœ¨å¯èƒ½ä¸ä¼šè¦æ±‚ç”» RPDæ–‡æ¡£ ç‰ˆæœ¬è¯´æ˜ï¼šè®°å½•æ¯æ¬¡ review (ç‰ˆæœ¬è¿­ä»£ä¸­)çš„æ”¹åŠ¨ èƒŒæ™¯ä¸ç›®æ ‡èƒŒæ™¯ï¼šäº§å“èƒŒæ™¯(å¯ä»¥é“¾æ¥åˆ°äº§å“çš„å®è§‚è®¾è®¡æ–‡æ¡£)+å½“å‰æ•…äº‹çš„èƒŒæ™¯ä»‹ç»ç›®æ ‡ï¼šä¸Šçº¿ä»€ä¹ˆåŠŸèƒ½ï¼Œä»€ä¹ˆä¸ºæŒ‡æ ‡ æ•…äº‹ä»‹ç» ç”¨æˆ·åœºæ™¯ï¼Œä¸€ä¸ªåœºæ™¯ä¸€è¡Œï¼Œè¯»å®Œå¤§æ¦‚çŸ¥é“éœ€æ±‚æœ‰å“ªäº› ä»·å€¼åˆ†æï¼Œåˆ†ææ–°çš„éœ€æ±‚å¸¦æ¥çš„ä»·å€¼ æ ¸å¿ƒä½“éªŒè·¯å¾„ï¼Œåˆ†æç”¨æˆ·ä½¿ç”¨åŠŸèƒ½çš„æ­¥éª¤(å¤§è‡´åˆ†ä¸º 5 æ­¥) äº§å“æŒ‡æ ‡é¢„æµ‹ è·¯å¾„è§„åˆ’ï¼Œå½“å‰ç‰ˆæœ¬ï¼Œæœªæ¥å¯èƒ½åšçš„å‡çº§ æ¦‚è¦è®¾è®¡(æ¨¡å—å›¾ï¼ŒåŠŸèƒ½æ¸…å•å›¾ï¼Œé¡µé¢ç»“æ„å›¾) æ¨¡å—è®¾è®¡ åŠŸèƒ½æ¸…å• é¡µé¢ç»“æ„ è¯¦ç»†è®¾è®¡ äº¤ä»˜è®¾è®¡ æ•°æ®åˆ†æè®¾è®¡æŒ‡æ˜å½“å‰ç‰ˆæœ¬éœ€è¦æ–°å¢ï¼Œæ›´æ–°çš„æ•°æ®åŸ‹ç‚¹å†…å®¹ï¼Œä»¥åŠæœªæ¥å¯èƒ½éœ€è¦çš„åˆ†ææŠ¥è¡¨åŸ‹ç‚¹è®¾è®¡æŠ¥è¡¨è®¾è®¡ â€‹ ä¹Ÿå°±æ˜¯è¯´æ ¹æ®ç°æœ‰çš„æŠ¥è¡¨ï¼Œæ˜¯å¦éœ€è¦æ–°å¢æˆ–è€…ä¿®æ”¹ï¼Œæ–¹ä¾¿åˆ†æç”¨æˆ·æ´»åŠ¨è¿½è¸ªäº§å“æ•ˆæœç­‰ ä¸Šçº¿ç­¹å¤‡ è€ƒè™‘ä¸Šçº¿æ–°åŠŸèƒ½çš„å½±å“ï¼Œæ˜¯å¦ä¼šå½±å“ç°æœ‰åŠŸèƒ½ï¼Œæˆ–è€…å½±å“æ•°æ®åº“ï¼ŒæŒ‡æ˜å†²çªå’Œè§£å†³åŠæ³•ï¼Œè¿˜è¦è€ƒè™‘æ˜¯å¦æœåŠ¡å™¨èµ„æºä¼šå‘é€å˜åŒ–ç­‰ï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦æ›´æ¢æœåŠ¡å™¨ç­‰ æ¥è‡ªäº§å“ä¸Šçº¿åçš„æ›´æ–° ä¸Šçº¿åå¯¹åŠŸèƒ½è¿›è¡Œå¤ç›˜","categories":[{"name":"PM","slug":"PM","permalink":"http://example.com/categories/PM/"}],"tags":[]},{"title":"é¢å‘å¯¹è±¡","slug":"source/C++/C++ é¢å‘å¯¹è±¡","date":"2025-03-10T16:00:00.000Z","updated":"2025-03-11T14:51:50.472Z","comments":true,"path":"2025/03/11/source/C++/C++ é¢å‘å¯¹è±¡/","permalink":"http://example.com/2025/03/11/source/C++/C++%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/","excerpt":"","text":"ç±»å±€éƒ¨ç±»ï¼šå‡½æ•°å†…éƒ¨å®šä¹‰ç±» è®¿é—®æ§åˆ¶public ä»»æ„éƒ½å¯è®¿é—® private è¢«ç±»çš„æˆå‘˜å‡½æ•°è®¿é—® ï¼ˆåªèƒ½è‡ªå·±ï¼‰ protected å½“å‰ç±»æˆ–è€…å­ç±» (è¡€è„‰è¿æ¥ï¼Œè‡ªå·±å’Œå­å­™) å‹å…ƒ&#x3D;&#x3D;friend&#x3D;&#x3D; å¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰æˆå‘˜ friend void getName(A&amp; a); å‹å…ƒç±»friend void B::getName(A&amp; a); å‹å…ƒç±»å‡½æ•°friend class B; å‹å…ƒç±» &#x2F;&#x2F;å¿…é¡»åœ¨æ­¤ä¹‹å‰å£°æ˜class B; ###structä¸classçš„åŒºåˆ« é»˜è®¤çš„è®¿é—®æƒé™structçš„æˆå‘˜é»˜è®¤ä¸ºpublicï¼Œclassçš„æˆå‘˜é»˜è®¤ä¸ºprivate ç»§æ‰¿æ—¶çš„é»˜è®¤è®¿é—®æƒé™ structçš„ç»§æ‰¿é»˜è®¤æ˜¯publicç»§æ‰¿ï¼Œè€Œclassçš„ç»§æ‰¿é»˜è®¤æ˜¯privateç»§æ‰¿ã€‚ è¯­ä¹‰ä¸Šçš„åŒºåˆ«structï¼šå…³æ³¨æ•°æ®é›†åˆè€Œä¸æ˜¯è¡Œä¸ºã€‚classï¼šOOP é™æ€æˆå‘˜staticé™æ€å‡½æ•°è°éƒ½å¯ä»¥è°ƒç”¨ï¼Œé™æ€æˆå‘˜å˜é‡è°éƒ½å¯ä»¥ä¿®æ”¹ é™æ€æˆå‘˜å˜é‡ ç±»é‡Œå£°æ˜ï¼Œç±»å¤–åˆå§‹åŒ– static int count; int A::count&#x3D; 0; ç±»å†…åˆå§‹åŒ– static constexpræˆ–const int constVar &#x3D; 42; ç”Ÿå‘½å‘¨æœŸå…¨å±€ ç±»çš„é™æ€æˆå‘˜çš„ç±»å‹å¯ä»¥æ˜¯è¿™ä¸ªç±»ï¼Œè€Œéé™æ€æˆå‘˜åªèƒ½æ˜¯è¯¥ç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œå› ä¸ºåˆ†é…å†…å­˜çš„æ—¶å€™ä¼šå¯¼è‡´æ— é™åµŒå¥— é™æ€æˆå‘˜å‡½æ•° åªèƒ½è®¿é—®é™æ€æ•°æ®æˆå‘˜å’Œå…¶ä»–é™æ€æˆå‘˜å‡½æ•° æ²¡æœ‰thisæŒ‡é’ˆï¼Œåªèƒ½æ˜¾å¼ä¼ å…¥å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ‰èƒ½è®¿é—®æˆå‘˜å˜é‡ã€‚ ç±»å†…å£°æ˜å’Œå®šä¹‰ æˆ–è€…ç±»å¤–ä¸åŠ staticå®šä¹‰ const structå’Œclasså‰+const ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ²¡æœ‰æ„ä¹‰ å¸¸é‡å¯¹è±¡ 123456class base&#123;&#125;const base a;base const a;//å¸¸é‡ç±»å¯¹è±¡ï¼Œåªèƒ½è°ƒç”¨constå‡½æ•°ï¼Œåªèƒ½ä¿®æ”¹mutableå£°æ˜çš„å˜é‡const int b;int const b; mutableå£°æ˜çš„å˜é‡ï¼Œè¡¨ç¤ºå¯ä»¥è¢«constæˆå‘˜å¯¹è±¡æˆ–å‡½æ•°ä¿®æ”¹ã€‚ constç±»æˆå‘˜å‡½æ•°void getname() const {}åªèƒ½è°ƒç”¨constå‡½æ•°ï¼Œåªèƒ½ä¿®æ”¹mutableæˆå‘˜å˜é‡å¯ä»¥consté‡è½½ï¼Œç»™ä¸åŒçš„å¯¹è±¡è°ƒç”¨thisæŒ‡é’ˆé»˜è®¤ä¸º(const Base*)thisï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼ä¸ºthisï¼Œè¿”å›ç±»å‹å¿…é¡»æ˜¯const Base*ï¼Œå¦‚æœè¿”å›å€¼ä¸º*thisï¼Œè¿”å›å€¼ç±»å‹å¯ä»¥ä¸ºBaseï¼Œå› ä¸ºè¿”å›çš„æ˜¯å‰¯æœ¬ä¸å½±å“ã€‚ æœ‰ä¸€ç§æƒ…å†µå¯ä»¥é€šè¿‡constå‡½æ•°ä¿®æ”¹æˆå‘˜å˜é‡çš„å€¼ï¼šé‚£å°±æ˜¯constå‡½æ•°å†…éƒ¨è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ï¼Œç„¶åé™æ€æˆå‘˜å‡½æ•°çš„å‚æ•°æ˜¯éæŒ‡å‘constæˆå‘˜çš„æŒ‡é’ˆæˆ–è€…éconstå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°ä¿®æ”¹ã€‚å‚æ•°æ˜¯ç±»å¯¹è±¡ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºä¿®æ”¹çš„æ˜¯å‰¯æœ¬ã€‚ constæˆå‘˜å˜é‡ï¼Œå¿…é¡»æä¾›æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ constæŒ‡é’ˆæŒ‡å‘cosntå¯¹è±¡çš„æŒ‡é’ˆï¼šconst Base* ptr &#x3D; &obj1; ä¸èƒ½é€šè¿‡è¯¥æŒ‡é’ˆä¿®æ”¹å¯¹è±¡çš„å€¼ï¼ŒæŒ‡é’ˆå¯ä»¥æŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚constæŒ‡é’ˆï¼šBase* const ptr &#x3D; &obj; æŒ‡é’ˆä¸èƒ½æŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚æŒ‡å‘constå¯¹è±¡çš„constæŒ‡é’ˆï¼šconst Base* const ptr &#x3D; &obj;æ—¢ä¸èƒ½é€šè¿‡è¯¥æŒ‡é’ˆä¿®æ”¹å¯¹è±¡çš„å€¼ï¼ŒæŒ‡é’ˆä¹Ÿä¸èƒ½å†æŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚ constå¼•ç”¨const Base&amp; y&#x3D;a; ä¸èƒ½ä¿®æ”¹açš„å†…å®¹ã€‚Base&amp; const y&#x3D;a; âŒæ²¡æœ‰è¿™ç§è¡¨è¾¾ thisæŒ‡é’ˆthisæŒ‡é’ˆæŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡a.com(b); aéšå¼ç»‘å®šåˆ°thisä¸Š*thisï¼Œç›¸å½“äºthisæŒ‡é’ˆçš„è§£å¼•ç”¨ä»£è¡¨è¿™ä¸ªå¯¹è±¡ 1234MyClass&amp; operator=(const MyClass&amp; other) &#123; // èµ‹å€¼æ“ä½œ... return *this; // è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨ &#125; ç±»çš„ä½œç”¨åŸŸç±»å…è®¸åŒ…å«æŒ‡å‘è‡ªèº«çš„å¼•ç”¨å’ŒæŒ‡é’ˆ å£°æ˜ä¸­çš„åå­—ï¼Œå‚æ•°åå­—ï¼Œè¿”å›ç±»å‹éƒ½å¿…é¡»åœ¨ä½¿ç”¨å‰å£°æ˜ å‡½æ•°ä½“ä¼šåœ¨æ•´ä¸ªç±»å…¨éƒ¨å¯è§åå†å¤„ç†ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°åç»­publicä¸­çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥åšå‡½æ•°ä½“çš„è¿”å›å€¼ã€‚ ç±»å¤–å·²ç»å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡åä¸ºnameï¼Œåˆ™ç±»é‡Œä¸èƒ½å†å®šä¹‰ä¸€ä¸ªåŒåçš„æˆå‘˜name ###èšåˆç±» æ‰€æœ‰æˆå‘˜éƒ½æ˜¯public æ²¡æœ‰privateï¼Œprotected æ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•° æ²¡æœ‰åŸºç±» ä¸ä»å…¶ä»–åœ°æ–¹ç»§æ‰¿è€Œæ¥ æ²¡æœ‰è™šå‡½æ•° ä¸æ”¯æŒå¤šæ€ 123456struct Point &#123; int x; int y; &#125;; // èšåˆç±»åˆå§‹åŒ– ï¼Œä½¿ç”¨èŠ±æ‹¬å·åˆå§‹åŒ–åˆ—è¡¨Point p = &#123;1, 2&#125;; å­—é¢å€¼å¸¸é‡ç±»åœ¨ç¼–è¯‘æ—¶åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”å…¶å¯¹è±¡èƒ½ç”¨äºå¸¸é‡è¡¨è¾¾å¼çš„ç±» æ•°æ®æˆå‘˜éƒ½æ˜¯å­—é¢å€¼ç±»å‹ å­—é¢å€¼ç±»å‹ï¼šæ•´å½¢ï¼Œæµ®ç‚¹å‹ï¼Œæšä¸¾ç±»å‹ï¼ŒæŒ‡é’ˆ(æŒ‡å‘å­—é¢å€¼ç±»å‹æˆ–ç©ºæŒ‡é’ˆ)ï¼Œå¼•ç”¨ç±»å‹ï¼Œå­—é¢å€¼å¸¸é‡ç±» æœ‰ä¸€ä¸ªconstexpræ„é€ å‡½æ•° constexprå‡½æ•°çš„å‚æ•°å€¼å’Œè¿”å›å€¼å¿…é¡»æ˜¯å­—é¢å€¼ç±»å‹ï¼Œä¸”ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œç”¨noexcept å¦‚æœå®šä¹‰äº†ææ„å‡½æ•°ï¼Œå¿…é¡»æ˜¯constexprçš„ constexpræ„é€ å‡½æ•°å¯ä»¥å£°æ˜æˆ&#x3D;defaultçš„å½¢å¼ã€æˆ–è€…åˆ é™¤å‡½æ•°çš„å½¢å¼ã€‚å¦åˆ™ï¼Œconstexpræ„é€ å‡½æ•°å¿…é¡»ç¬¦åˆæ„é€ å‡½æ•°çš„è¦æ±‚åˆç¬¦åˆconstexprå‡½æ•°çš„è¦æ±‚ï¼ˆæ‹¥æœ‰çš„å”¯ä¸€å¯æ‰§è¡Œè¯­å¥å°±æ˜¯è¿”å›è¯­å¥ï¼‰constexpræ„é€ å‡½æ•°å¿…é¡»åˆå§‹åŒ–æ‰€æœ‰çš„æ•°æ®æˆå‘˜ 123456789101112131415161718192021222324class Debug &#123;private: bool hw; bool io; bool other;public: constexpr Debug(bool b = true) :hw(b), io(b), other(b) &#123;&#125; constexpr Debug(bool h, bool i, bool o) : hw(h), io(i), other(o) &#123;&#125; constexpr bool any() &#123; return hw || io || other; &#125; void set_io(bool b) &#123; io = b; &#125; void set_hw(bool b) &#123; hw = b; &#125; void set_other(bool b) &#123; other = b; &#125;&#125;; int main()&#123; constexpr Debug io_sub(false, true, false); //è°ƒè¯•IO constexpr Debug prod(false); //æ— è°ƒè¯• if (io_sub.any()) //ç­‰ä»·äºif(true) cerr &lt;&lt; &quot;print appropriate error messages;&quot; &lt;&lt; endl; if(prod.any()) //ç­‰ä»·äºif(false) cerr &lt;&lt; &quot;print an error message;&quot; &lt;&lt; endl; return 0;&#125; ç±»å‡½æ•°è‡ªç”±å‡½æ•°ä¸å±äºä»»ä½•ç»“æ„ä½“å’Œç±»ï¼Œåœ¨å…¨å±€ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è°ƒç”¨ ä¸æ¥å—thisæŒ‡é’ˆstd::ostream&amp; print(std::ostream&amp; os, const sals&amp; item) 123456789101112131415161718192021222324252627282930313233343536#include &lt;iostream&gt;#include &lt;fstream&gt;#include &lt;string&gt;// å®šä¹‰ sals ç±»class sals &#123;private: std::string bookNumber;public: // æ„é€ å‡½æ•° sals(const std::string&amp; number) : bookNumber(number) &#123;&#125; // è¿”å›ä¹¦ç±ç¼–å· std::string isbn() const &#123; return bookNumber; &#125;&#125;;// è¾“å‡º sals å¯¹è±¡çš„å†…å®¹åˆ°ä»»ä½•è¾“å‡ºæµstd::ostream&amp; print(std::ostream&amp; os, const sals&amp; item) &#123; os &lt;&lt; &quot;Book Number: &quot; &lt;&lt; item.isbn(); return os;&#125;int main() &#123; // åˆ›å»ºä¸€ä¸ª sals å¯¹è±¡ sals myBook(&quot;1234567890&quot;); // è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµ print(std::cout, myBook) &lt;&lt; std::endl; // è¾“å‡ºåˆ°æ–‡ä»¶æµ std::ofstream outFile(&quot;book_info.txt&quot;); if (outFile.is_open()) &#123; print(outFile, myBook) &lt;&lt; std::endl; outFile.close(); std::cout &lt;&lt; &quot;Data written to file successfully.&quot; &lt;&lt; std::endl; &#125; else &#123; std::cerr &lt;&lt; &quot;Unable to open file.&quot; &lt;&lt; std::endl; &#125; return 0;&#125; æ„é€ å‡½æ•°åªè¦å®šä¹‰äº†æ„é€ å‡½æ•°å°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœéœ€è¦åº”è¯¥æ˜¾ç¤ºå®šä¹‰æˆå‘˜æ˜¯constæˆ–è€…å¼•ç”¨ï¼ŒæŸç§æœªæä¾›é»˜è®¤æ„é€ å‡½æ•°çš„ç±»ç±»å‹ï¼Œå¿…é¡»é€šè¿‡æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨æä¾›åˆå§‹å€¼ï¼Œè€Œä¸æ˜¯åœ¨å‡½æ•°ä½“å†…èµ‹å€¼ é»˜è®¤æ„é€ å‡½æ•° æ²¡æœ‰å‚æ•° å¦‚æœç±»ä¸­æ²¡æœ‰æ˜¾å¼å®šä¹‰ä»»ä½•æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼ˆä»…å½“ç±»ä¸­æœ‰éœ€è¦åˆå§‹åŒ–çš„æˆå‘˜æ—¶ï¼‰ã€‚ æ˜¾ç¤ºå®šä¹‰æ„é€ å‡½æ•° MyClass() &#x3D; default; MyClass(){}; ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†ç”Ÿæˆå…¶ä»–éšå¼çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼ˆå¦‚æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ç­‰ï¼‰ï¼Œé™¤éä½ æ˜¾å¼åœ°å®šä¹‰å®ƒä»¬ã€‚ æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡int c;æ— è®ºå¦‚ä½•ä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸º0(å†…ç½®å‚æ•°ç±»å‹),ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ™cä¼šåˆå§‹åŒ–ä¸ºä¸€ä¸ªç±»ä¼¼32691çš„å€¼ æ‹·è´æ„é€ å‡½æ•°ä½¿ç”¨åŸæœ‰å¯¹è±¡çš„å€¼åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è‡ªèº«å¼•ç”¨ç±»å‹(æ¨èä¸ºconst const MyClass&amp; other)ï¼Œä»»ä½•é¢å¤–å‚æ•°éƒ½æœ‰é»˜è®¤å€¼å¦‚æœä¸ä¸ºconstè‡ªèº«å¼•ç”¨ç±»å‹ï¼š ä¸èƒ½æ¥å—constå’Œvolatile ä¸èƒ½ä½¿ç”¨ MyClass obj2 &#x3D; MyClass (obj1);å› ä¸ºobj1æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œä¸´æ—¶å˜é‡æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä¸èƒ½è¢«ä¿®æ”¹ å¯ä»¥å­˜åœ¨å¤šä¸ªæ‹·è´æ„é€ å‡½æ•° ä¸€èˆ¬éšå¼ä½¿ç”¨ MyClass B&#x3D;A; æ˜¾å¼ä½¿ç”¨ï¼šMyClass B &#x3D; MyClass(A); ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Ÿ å¯¹è±¡ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œä»¥å€¼ä¼ é€’çš„æ–¹å¼ä¼ å…¥å‡½æ•°ä½“ï¼Œä¼šä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°ç”Ÿæˆå‰¯æœ¬ã€‚(å»ºè®®ä¼ æŒ‡é’ˆæˆ–è€…å¼•ç”¨)å¯¹è±¡ä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œä»¥å€¼ä¼ é€’çš„æ–¹å¼ä»å‡½æ•°è¿”å›ä½¿ç”¨åŸæœ‰å¯¹è±¡çš„å€¼åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ &#x3D;&#x3D;æµ…æ‹·è´&#x3D;&#x3D;é»˜è®¤æ‹·è´æ„é€ å‡½æ•° ClassName(const ClassName&amp; other);å®šä¹‰äº†æ‹·è´æ„é€ å‡½æ•°å°±ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤çš„ä¸èƒ½å¤„ç†éœ€è¦åŠ¨æ€åˆ†é…å†…å­˜çš„çš„æƒ…å†µ(å«æŒ‡é’ˆç­‰)ï¼Œä½¿å¤šä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªå†…å­˜é™æ€æˆå‘˜å˜é‡countç”¨äºè®¡æ•°ï¼Œè®¡æ•°åœ¨æ„é€ å‡½æ•°ä¸­å®ç°ï¼Œè°ƒç”¨é»˜è®¤æ‹·è´ä¸ä¼šå®ç°è®¡æ•° &#x3D;&#x3D;æ·±æ‹·è´&#x3D;&#x3D; 123MyClass(const MyClass&amp; other) &#123; data = new int(*(other.data));&#125; è‡ªå®šä¹‰å®ç°ï¼Œè§£å†³åŠ¨æ€åˆ†é…é—®é¢˜ã€‚ ç§»åŠ¨æ„é€ å‡½æ•°é«˜æ•ˆè½¬ç§»èµ„æºï¼Œé¿å…ä¸å¿…è¦çš„æ·±æ‹·è´ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ å‡½æ•°è¿”å›ä¸´æ—¶å¯¹è±¡ï¼šå°†ä¸´æ—¶å¯¹è±¡çš„èµ„æºè½¬ç§»åˆ°æ¥æ”¶è¿”å›å€¼çš„å¯¹è±¡ä¸­ã€‚å®¹å™¨æ’å…¥ä¸´æ—¶å¯¹è±¡ï¼šåœ¨å‘å®¹å™¨ï¼ˆå¦‚ std::vectorï¼‰ä¸­æ’å…¥ä¸´æ—¶å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°æ¥é¿å…ä¸å¿…è¦çš„æ‹·è´ã€‚MyClass obj2(std::move(obj1));MyClass obj &#x3D; MyClass(5); &#x2F;&#x2F;åŒºåˆ«MyClass obj &#x3D; MyClass(obj1); MyClass(5)æ˜¯ä¸€ä¸ªå³å€¼ å‚æ•°æ˜¯è¯¥ç±»å¯¹è±¡çš„ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼ˆT&amp;&amp;ï¼‰ï¼Œç”¨äºé€šè¿‡ç§»åŠ¨ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ä¸´æ—¶å¯¹è±¡ï¼‰æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ å®šä¹‰ClassName(ClassName&amp;&amp; other); è½¬ç§»ä¹‹åéœ€è¦ç½®ç©ºåŸèµ„æºï¼Œé˜²æ­¢åŸå¯¹è±¡è¢«ææ„æ—¶é‡Šæ”¾äº†è½¬ç§»çš„èµ„æº MyClass(MyClass&amp;&amp;) &#x3D; delete; 123456MyClass(MyClass&amp;&amp; other) noexcept : data(other.data), size(other.size) &#123; other.data = nullptr; //åŸå¯¹è±¡èµ„æºç½®ç©º other.size = 0; std::cout &lt;&lt; &quot;Move constructor called&quot; &lt;&lt; std::endl;&#125;//noexcept ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ è½¬æ¢æ„é€ å‡½æ•° è½¬æ¢æ„é€ å‡½æ•°å…è®¸å°†ä¸€ä¸ªå…¶ä»–ç±»å‹çš„æ•°æ®è½¬æ¢æˆä¸€ä¸ªä¸´æ—¶ç±»å¯¹è±¡ã€‚ åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”è¯¥å‚æ•°ä¸æ˜¯æœ¬ç±»çš„constå¼•ç”¨æ—¶ï¼Œè¯¥æ„é€ å‡½æ•°è¢«è§†ä¸ºè½¬æ¢æ„é€ å‡½æ•°ã€‚ è½¬æ¢æ„é€ å‡½æ•°å¯ä»¥éšå¼åœ°è½¬æ¢å…¶ä»–ç±»å‹çš„å¯¹è±¡åˆ°æœ¬ç±»çš„å¯¹è±¡ï¼Œä½¿ç”¨explicitå…³é”®å­—å¯ä»¥ç¦ç”¨è¿™ç§éšå¼è½¬æ¢ã€‚ å¯ä»¥ç”¨ç±»å¯¹è±¡ç›´æ¥ä¸intç›¸åŠ  ä½¿ç”¨ï¼šComplex c2 &#x3D; 12ï¼›éšå¼ï¼ŒéexplictComplex c2 &#x3D; Complex(12); æ˜¾å¼c1 &#x3D; Complex(9); è½¬æ¢æ„é€ å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶ç±»å¯¹è±¡c1 + 1; éšå¼ï¼Œéexplicté…åˆ+è¿ç®—ç¬¦é‡è½½ 12345678910111213class Complex&#123;public: double real , imag; explicit Complex(int i)&#123; std::cout &lt;&lt; &quot;IntConstructor called&quot; &lt;&lt; std::endl; real = i; imag = 0; &#125;&#125;;void operator+(const Complex&amp; a) &#123; this-&gt;real += a.real; this-&gt;imag += a.imag;&#125; explicitä½¿ç”¨explicitå…³é”®å­—å¯ä»¥é˜²æ­¢æ„é€ å‡½æ•°è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚ä¸€ä¸ªç±»çš„å¯¹è±¡ä¸å¦ä¸€ä¸ªç±»å‹çš„å€¼è¿›è¡Œèµ‹å€¼æˆ–æ¯”è¾ƒæ—¶ï¼Œå¦‚æœç±»çš„æ„é€ å‡½æ•°å¯ä»¥æ¥å—è¯¥ç±»å‹çš„å‚æ•°ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°è¯•ä½¿ç”¨æ„é€ å‡½æ•°æ¥éšå¼åœ°å°†ä¸€ä¸ªç±»å‹çš„å€¼è½¬æ¢ä¸ºç±»çš„å¯¹è±¡ã€‚ ç”¨äºè½¬æ¢æ„é€ å‡½æ•°æˆ–è€…å•å‚æ•°æ¨¡æ¿æ„é€ å‡½æ•° ï¼Œexplicit TemplateClass(T value) : data(value) å§”æ‰˜æ„é€ å‡½æ•° å§”æ‰˜æ„é€ å‡½æ•°å…è®¸ä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°æ¥æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚ å§”æ‰˜æ„é€ å‡½æ•°é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„â€™ç±»ååè·Ÿå‚æ•°åˆ—è¡¨â€™æ¥è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ 123 Person(const std::string&amp; name, int age) : name(name), age(age) &#123;&#125;//å§”æ‰˜æ„é€ å‡½æ•° Person(const std::string&amp; name) : Person(name, 0) &#123;&#125; æ€»ç»“123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;iostream&gt;#include &lt;string&gt;class MyClass &#123;private: int value; std::string name;public: // é»˜è®¤æ„é€ å‡½æ•° MyClass() : value(0), name(&quot;default&quot;) &#123; std::cout &lt;&lt; &quot;Default constructor called&quot; &lt;&lt; std::endl; &#125; // æ‹·è´æ„é€ å‡½æ•° MyClass(const MyClass&amp; other) : value(other.value), name(other.name) &#123; std::cout &lt;&lt; &quot;Copy constructor called&quot; &lt;&lt; std::endl; &#125; // ç§»åŠ¨æ„é€ å‡½æ•° MyClass(MyClass&amp;&amp; other) noexcept : value(other.value), name(std::move(other.name)) &#123;//æ›´é«˜æ•ˆ other.value = 0; std::cout &lt;&lt; &quot;Move constructor called&quot; &lt;&lt; std::endl; &#125; // è½¬æ¢æ„é€ å‡½æ•° MyClass(int val) : value(val), name(&quot;converted&quot;) &#123; std::cout &lt;&lt; &quot;Conversion constructor called&quot; &lt;&lt; std::endl; &#125; // å§”æ‰˜æ„é€ å‡½æ•° MyClass(int val, const std::string&amp; str) : MyClass(val) &#123;//å§”æ‰˜è½¬æ¢æ„é€ å‡½æ•° name = str; std::cout &lt;&lt; &quot;Delegating constructor called&quot; &lt;&lt; std::endl; &#125; // æ‰“å°å¯¹è±¡ä¿¡æ¯çš„æˆå‘˜å‡½æ•° void printInfo() const &#123; std::cout &lt;&lt; &quot;Value: &quot; &lt;&lt; value &lt;&lt; &quot;, Name: &quot; &lt;&lt; name &lt;&lt; std::endl; &#125;&#125;;int main() &#123; // ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;Using default constructor:&quot; &lt;&lt; std::endl; MyClass obj1; obj1.printInfo(); // ä½¿ç”¨è½¬æ¢æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;\\nUsing conversion constructor:&quot; &lt;&lt; std::endl; MyClass obj2(42); obj2.printInfo(); // ä½¿ç”¨å§”æ‰˜æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;\\nUsing delegating constructor:&quot; &lt;&lt; std::endl; MyClass obj3(100, &quot;custom&quot;); obj3.printInfo(); // ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;\\nUsing copy constructor:&quot; &lt;&lt; std::endl; MyClass obj4(obj3); obj4.printInfo(); // ä½¿ç”¨ç§»åŠ¨æ„é€ å‡½æ•° std::cout &lt;&lt; &quot;\\nUsing move constructor:&quot; &lt;&lt; std::endl; MyClass obj5(std::move(obj2)); obj5.printInfo(); return 0;&#125; ##å†…è”å‡½æ•° æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°†å‡½æ•°åµŒåˆ°è°ƒç”¨äº†å®ƒçš„åœ°æ–¹éšå¼å†…è”ï¼šç±»å£°æ˜å’Œå®šä¹‰æ”¾åœ¨ä¸€èµ·ï¼Œåªæ˜¯å»ºè®®ç¼–è¯‘å™¨å†…è”æ˜¾ç¤ºå†…è”ï¼šä½¿ç”¨inline ææ„å‡½æ•°~MyClass() {} éšå¼è°ƒç”¨ï¼šå½“ç¦»å¼€å½“å‰ä½œç”¨åŸŸä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œå¦‚æœæœ‰åŠ¨æ€å†…å­˜åˆ†é…çš„æˆå‘˜åœ¨å‡½æ•°å®ç°ä¸­æ·»åŠ é‡Šæ”¾æ˜¾ç¤ºè°ƒç”¨ï¼šå½“ç”¨newç®¡ç†å¯¹è±¡æ—¶ 1234char* buffer = new char[sizeof(MyClass)];MyClass* obj = new (buffer) MyClass();obj-&gt;~MyClass();delete[] buffer; ä¸å¯é‡è½½ æ²¡æœ‰å‚æ•°å’Œè¿”å›å€¼ privateå¤šç”¨äºè®¾è®¡æ¨¡å¼ä¸­ï¼Œå•ä¾‹ç­‰ ä¸€ä¸ªç±»æœ‰è™šå‡½æ•°æˆ–ä½œä¸ºåŸºç±»ï¼Œææ„å‡½æ•°åº”è¯¥å£°æ˜ä¸ºè™šå‡½æ•° virtual ~Base() {â€¦} é¦–å…ˆè°ƒç”¨è¯¥ç±»çš„ææ„å‡½æ•°ï¼Œç„¶åæŒ‰ç»§æ‰¿å±‚æ¬¡ä¾æ¬¡å‘ä¸Šè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ã€‚ çº¯è™šææ„å‡½æ•°**æŠ½è±¡ç±»ï¼š**å¦‚æœä¸€ä¸ªç±»çš„ææ„å‡½æ•°è¢«å£°æ˜ä¸ºçº¯è™šå‡½æ•°ï¼Œè¯¥ç±»æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½å®ä¾‹åŒ–ã€‚çº¯è™šææ„å‡½æ•°ä»ç„¶éœ€è¦å®šä¹‰ï¼Œå› ä¸ºå¯¹è±¡é”€æ¯æ—¶å¿…é¡»è°ƒç”¨ææ„å‡½æ•°ã€‚ 1234567class AbstractBase &#123;public: virtual ~AbstractBase() = 0; // çº¯è™šææ„å‡½æ•°&#125;;AbstractBase::~AbstractBase() &#123; // çº¯è™šææ„å‡½æ•°çš„å®šä¹‰&#125; ç¦æ­¢ææ„ ä»¥ç¦æ­¢å¯¹è±¡è¢«é”€æ¯ã€‚è¿™åœ¨æŸäº›è®¾è®¡æ¨¡å¼ä¸­å¯èƒ½ä¼šç”¨åˆ°ã€‚~NonDestructible() &#x3D; delete; æ‹·è´èµ‹å€¼è¿ç®—ç¬¦å·²å­˜åœ¨çš„å¯¹è±¡ç»™ä¸€å·²å­˜åœ¨çš„å¯¹è±¡èµ‹å€¼ClassName&amp; operator&#x3D;(const ClassName&amp; other);ClassName a;ClassName b; b&#x3D;a; é»˜è®¤æ‹·è´èµ‹å€¼è¿ç®—ç¬¦-å‚è€ƒæµ…æ‹·è´ æ·±æ‹·è´éœ€è¦è‡ªå·±å®šä¹‰ ç¦æ­¢å¯¹è±¡è¢«æ‹·è´ åˆ é™¤æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ MyClass&amp; operator&#x3D;(const MyClass&amp;) &#x3D; delete; æ£€æŸ¥è‡ªèµ‹å€¼-é¿å…èµ„æºæ„å¤–é‡Šæ”¾ é‡Šæ”¾å·²æœ‰èµ„æº é‡Šæ”¾å½“å‰å¯¹è±¡å·²ç»æŒæœ‰çš„èµ„æºï¼ˆä¾‹å¦‚å†…å­˜ï¼‰ æ·±æ‹·è´æ–°èµ„æº è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨ 123456MyClass&amp; operator=(const MyClass&amp; other) &#123; if (this == &amp;other) return *this; // é˜²æ­¢è‡ªæˆ‘èµ‹å€¼ delete data; // é‡Šæ”¾åŸæ¥çš„å†…å­˜ data = new int(*(other.data)); // æ·±æ‹·è´ return *this; &#125; ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å®ç°æ­¥éª¤ æ£€æŸ¥è‡ªèµ‹å€¼ é‡Šæ”¾å½“å‰èµ„æº è½¬ç§»èµ„æº è¿”å› *this 123456789MyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123; if (this != &amp;other) &#123; // æ£€æŸ¥è‡ªèµ‹å€¼ delete[] data; // é‡Šæ”¾å½“å‰èµ„æº data = other.data; // è½¬ç§»èµ„æº other.data = nullptr; // é˜²æ­¢èµ„æºé‡Šæ”¾ &#125; return *this; &#125;obj5 = std::move(obj2); ä¸‰äº”æ³•åˆ™å®šä¹‰å…¶ä¸­ä¸€ä¸ªéœ€è¦å®šä¹‰å…¶ä»–çš„ ä¸‰æ³•åˆ™ ææ„å‡½æ•° æ‹·è´æ„é€ å‡½æ•° æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æ¯”å¦‚ï¼šå½“æˆå‘˜ä¸­æœ‰åŠ¨æ€åˆ†é…çš„æ•°ç»„æ—¶ï¼Œéœ€è¦æ˜¾ç¤ºå®šä¹‰ææ„å‡½æ•°æ¥é‡Šæ”¾å†…å­˜ã€‚åŒæ—¶é¿å…æµ…æ‹·è´çš„é—®é¢˜(å¤šä¸ªå¯¹è±¡å…±äº«ä¸€å—å†…å­˜ï¼Œå¯¼è‡´å¤šæ¬¡é‡Šæ”¾)ï¼Œæ‰€ä»¥éœ€è¦å®ç°æ·±æ‹·è´ã€‚ äº”æ³•åˆ™ ç§»åŠ¨æ„é€ å‡½æ•° ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦é€šè¿‡å°†ä¸´æ—¶å¯¹è±¡çš„èµ„æºæ‰€æœ‰æƒè½¬ç§»åˆ°æ–°å¯¹è±¡ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œæé«˜äº†æ€§èƒ½ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768#include &lt;iostream&gt;class MyClass &#123;private: int* data;public: // é»˜è®¤æ„é€ å‡½æ•° MyClass(int value) : data(new int(value)) &#123; std::cout &lt;&lt; &quot;é»˜è®¤æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; &#125; // æ‹·è´æ„é€ å‡½æ•° MyClass(const MyClass&amp; other) : data(new int(*(other.data))) &#123; std::cout &lt;&lt; &quot;æ‹·è´æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; &#125; // æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ MyClass&amp; operator=(const MyClass&amp; other) &#123; if (this == &amp;other) return *this; // é˜²æ­¢è‡ªæˆ‘èµ‹å€¼ *data = *(other.data); // æ‹·è´æ•°æ® std::cout &lt;&lt; &quot;æ‹·è´èµ‹å€¼è¿ç®—ç¬¦è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; return *this; &#125; // ç§»åŠ¨æ„é€ å‡½æ•° MyClass(MyClass&amp;&amp; other) noexcept : data(other.data) &#123; other.data = nullptr; // å°†æºå¯¹è±¡çš„æ•°æ®æŒ‡é’ˆè®¾ä¸ºnullptr std::cout &lt;&lt; &quot;ç§»åŠ¨æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; &#125; // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ MyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123; if (this == &amp;other) return *this; // é˜²æ­¢è‡ªæˆ‘èµ‹å€¼ delete data; // é‡Šæ”¾å½“å‰å¯¹è±¡çš„èµ„æº data = other.data; // æ¥ç®¡æºå¯¹è±¡çš„æ•°æ®æŒ‡é’ˆ other.data = nullptr; // å°†æºå¯¹è±¡çš„æ•°æ®æŒ‡é’ˆè®¾ä¸ºnullptr std::cout &lt;&lt; &quot;ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; return *this; &#125; // ææ„å‡½æ•° ~MyClass() &#123; delete data; // é‡Šæ”¾èµ„æº std::cout &lt;&lt; &quot;ææ„å‡½æ•°è¢«è°ƒç”¨&quot; &lt;&lt; std::endl; &#125; // è·å–å€¼ int getValue() const &#123; return *data; &#125;&#125;;int main() &#123; MyClass obj1(42); // é»˜è®¤æ„é€ å‡½æ•° MyClass obj2 = obj1; // æ‹·è´æ„é€ å‡½æ•° MyClass obj3(0); // é»˜è®¤æ„é€ å‡½æ•° obj3 = obj1; // æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ MyClass obj4 = std::move(obj1); // ç§»åŠ¨æ„é€ å‡½æ•° MyClass obj5(0); // é»˜è®¤æ„é€ å‡½æ•° obj5 = std::move(obj2); // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ std::cout &lt;&lt; &quot;obj1çš„å€¼: &quot; &lt;&lt; (obj1.getValue() ? std::to_string(obj1.getValue()) : &quot;nullptr&quot;) &lt;&lt; std::endl; std::cout &lt;&lt; &quot;obj2çš„å€¼: &quot; &lt;&lt; (obj2.getValue() ? std::to_string(obj2.getValue()) : &quot;nullptr&quot;) &lt;&lt; std::endl; std::cout &lt;&lt; &quot;obj3çš„å€¼: &quot; &lt;&lt; obj3.getValue() &lt;&lt; std::endl; std::cout &lt;&lt; &quot;obj4çš„å€¼: &quot; &lt;&lt; obj4.getValue() &lt;&lt; std::endl; std::cout &lt;&lt; &quot;obj5çš„å€¼: &quot; &lt;&lt; obj5.getValue() &lt;&lt; std::endl; return 0;&#125; æ“ä½œé‡è½½ de1+de2 æˆ– operator+(de1+de2) de1+&#x3D;de2 æˆ– de1.operator+&#x3D;(de2) thisç»‘å®šåˆ°de1 de2ä½œä¸ºå®å‚ #é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ OOPï¼š å°è£… ç»§æ‰¿ å¤šæ€ ç»§æ‰¿class Dog : public Animalç»§æ‰¿ä¼šç»§æ‰¿ç§æœ‰æˆå‘˜ï¼Œå ç”¨å†…å­˜ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—® &#x3D;&#x3D;ç»§æ‰¿ç±»å‹&#x3D;&#x3D; é»˜è®¤ä¸ºprivate å…¬æœ‰ç»§æ‰¿ï¼ˆpublicï¼‰ï¼šä¸èƒ½è®¿é—®åŸºç±»çš„privateï¼Œå…¶ä»–ç±»å‹ä¸å˜ ä¿æŠ¤ç»§æ‰¿ï¼ˆprotectedï¼‰ï¼špublicï¼Œprotected -&gt; protected ç§æœ‰ç»§æ‰¿ï¼ˆprivateï¼‰ï¼špublicï¼Œprotected -&gt; private ç»§æ‰¿æ¥çš„æˆå‘˜å˜é‡ å¯ä»¥ä½¿ç”¨usingæ”¹å˜å¯è®¿é—®æ€§ public: using A::num; ä¸€ä¸ªæ´¾ç”Ÿç±»ç»§æ‰¿äº†æ‰€æœ‰çš„åŸºç±»æ–¹æ³•ï¼Œä½†ä¸‹åˆ—æƒ…å†µé™¤å¤–ï¼š åŸºç±»çš„æ„é€ å‡½æ•°ã€‚c++ 11ä¸­ä½¿ç”¨using Base::Base;å¯ä»¥ç»§æ‰¿æ„é€ å‡½æ•° ææ„å‡½æ•°ã€‚ èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•° å‹å…ƒå…³ç³»ã€‚ å¤šç»§æ‰¿ä¸€ä¸ªå­ç±»æœ‰å¤šä¸ªçˆ¶ç±» class C: public A, public B &#x3D;&#x3D;è±å½¢ç»§æ‰¿&#x3D;&#x3D;A Bæœ‰ä¸€ä¸ªå…±åŒçš„ç¥–å®—Oï¼Œè¿™æ—¶A Béƒ½æœ‰Oçš„å…ƒç´ ï¼ŒCä¸çŸ¥é“ç»§æ‰¿Aå’ŒBå“ªä¸€ä¸ªçš„å…ƒç´  1234567891011121314class Base &#123;public:int data;&#125;;// ä¸­é—´åŸºç±» Aclass DerivedA : public Base &#123;&#125;;// ä¸­é—´åŸºç±» Bclass DerivedB : public Base &#123;&#125;;// æœ€ç»ˆæ´¾ç”Ÿç±»class FinalDerived : public DerivedA, public DerivedB &#123;&#125;;// obj.data = 10; äºŒä¹‰æ€§æŠ¥é”™obj.DerivedA::data = 10; //éœ€è¦æŒ‡å®šè·¯å¾„//è™šç»§æ‰¿è§£å†³class A : virtual public Base &#123;&#125;;class B : virtual public Base &#123;&#125;;obj.data = 10; èµ‹å€¼å­ç±»çš„æ„é€ å‡½æ•°ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„æ–¹å¼æ—¶ä¸èƒ½ç›´æ¥ç»™ç»§æ‰¿æ¥çš„å˜é‡èµ‹å€¼ï¼Œå¿…é¡»è¦åœ¨åˆ—è¡¨ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™å°±åœ¨å‡½æ•°ä½“å†…èµ‹å€¼ã€‚ 1234Fu(int value) : baseValue(value) &#123;&#125;Zi() : Fu(2), derivedValue(2) &#123;&#125;//æˆ–è€…Zi() : derivedValue(2) &#123;baseValue=2;&#125; å­ç±»å¯¹è±¡ç»™çˆ¶ç±»å¯¹è±¡èµ‹å€¼ 1234Zi a;Fu b;b=a; //ä¼šå°†ç»§æ‰¿æ¥çš„å˜é‡çš„å€¼èµ‹å€¼ç»™çˆ¶ç±»å¯¹è±¡//a=b;ä¸å¯ä»¥ çˆ¶ç±»å¼•ç”¨å­ç±»å¯¹è±¡æˆ–è€…çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ï¼Œåªèƒ½è®¿é—®å­ç±»èƒ½è®¿é—®çš„çˆ¶ç±»å¯¹è±¡ 123Zi a;Fu&amp; b = a;Fu* p = &amp;a; &#x3D;&#x3D;åŒå&#x3D;&#x3D; å¦‚æœå­ç±»æœ‰ä¸€ä¸ªå’Œçˆ¶ç±»åŒåçš„æˆå‘˜ï¼Œå­ç±»å¯¹è±¡é»˜è®¤è®¿é—®å­ç±»æˆå‘˜ï¼Œè®¿é—®çˆ¶ç±»æˆå‘˜è¦åŠ fu:: å¦‚æœå­ç±»æœ‰ä¸€ä¸ªå’Œçˆ¶ç±»åŒåçš„å‡½æ•°ï¼Œè®¿é—®ä¹Ÿæ˜¯å…ˆè®¿é—®å­ç±»çš„å‡½æ•°ï¼Œå¦‚æœå­ç±»çš„å‡½æ•°å‚æ•°ä¸çˆ¶ç±»ä¸ä¸€æ ·ï¼Œè°ƒç”¨å‡½æ•°ä¹Ÿä¸ä¼šè‡ªåŠ¨å»åŒ¹é…å‚æ•° &#x3D;&#x3D;æ„é€ å‡½æ•°&#x3D;&#x3D; ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨å­ç±»çš„æ„é€ å‡½æ•°å­ç±»éšå¼è°ƒç”¨çˆ¶ç±»çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œæˆ–æ˜¾ç¤ºè°ƒç”¨æ„é€ å‡½æ•° 1234567891011121314151617class human &#123;protected: std::string _name;public: human(std::string name = &quot;å°æ˜&quot;) : _name(name) &#123;std::cout &lt;&lt; &quot;è°ƒç”¨ human æ„é€ å‡½æ•°ï¼Œå§“å: &quot; &lt;&lt; _name &lt;&lt; std::endl;&#125;&#125;;class student : public human &#123;private: int _age;public: student(std::string name, int age) : _age(age)&#123;std::cout &lt;&lt; &quot;è°ƒç”¨ student æ„é€ å‡½æ•°ï¼Œå§“å: &quot; &lt;&lt; _name &lt;&lt; &quot;, å¹´é¾„: &quot; &lt;&lt; _age &lt;&lt; std::endl;&#125;&#125;;int main() &#123; student st(&quot;å°çº¢&quot;, 18); return 0;&#125;//humançš„æ„é€ å‡½æ•°å¸¦æœ‰é»˜è®¤å‚æ•°ï¼Œå®ƒå¯ä»¥å½“ä½œé»˜è®¤æ„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œéšå¼è°ƒç”¨ å°æ˜ 18 è¿™æ—¶å¦‚æœè¿˜æœ‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°human()&#123;_name=&quot;å°é»„&quot;;&#125;ï¼Œé‚£ä¹ˆç¼–è¯‘ä¼šæœ‰æ­§ä¹‰ï¼Œå› ä¸ºä¸çŸ¥é“éšå¼è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°student(std::string name, int age) : _age(age),human(name)//æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° å°çº¢ 18 &#x3D;&#x3D;ææ„å‡½æ•°&#x3D;&#x3D; å…ˆè°ƒç”¨å­ç±»çš„ææ„å†çˆ¶ç±»çš„ææ„ï¼Œç¦æ­¢å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„ææ„-é€ æˆç©ºé—´é‡Šæ”¾ä¸¤æ¬¡ã€‚ å­ç±»æ‹·è´æ„é€ å‡½æ•°è°ƒç”¨çˆ¶ç±»çš„æ‹·è´æ„é€ å‡½æ•°æ—¶ï¼Œç›´æ¥ä¼ å…¥å­ç±»çš„å¯¹è±¡ï¼Œçˆ¶å¯¹è±¡ä¼šæ‹¿åˆ°ä»–æœ‰çš„å“ªéƒ¨åˆ†ï¼Œå‰©ä¸‹çš„åœ¨å­ç±»æ‹·è´æ„é€ å‡½æ•°ä¸­å®Œæˆ 123456student(student&amp; s) :human(s)//ç›´æ¥å°†å­ç±»ä¼ è¿‡æ¥é€šè¿‡åˆ‡ç‰‡æ‹¿åˆ°çˆ¶ç±»ä¸­çš„å€¼ ,_age(s._age)//æ‹¿é™¤äº†çˆ¶ç±»ä¹‹å¤–çš„å€¼ &#123; cout &lt;&lt; s._age &lt;&lt; endl&lt;&lt;s._name&lt;&lt;endl; &#125; æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»çš„æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ 123456789student&amp; operator=(const student&amp; s)&#123; if (this != &amp;s)&#123; cout &lt;&lt; &quot;è°ƒç”¨äº†å­ç±»&quot; &lt;&lt; endl; human::operator=(s);//å¿…é¡»è°ƒç”¨çˆ¶ç±»è¿ç®—ç¬¦ _age = s._age; _name = s._name; &#125; return *this; &#125; å¤šæ€ç¼–è¯‘æ—¶å¤šæ€ï¼šé™æ€ç»‘å®šï¼Œç¼–è¯‘æ—¶å°±ç¡®å®šäº†è¦è°ƒç”¨çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œæ¯”å¦‚é‡è½½(å‡½æ•°é‡è½½ï¼Œè¿ç®—ç¬¦é‡è½½)ï¼Œæ¨¡æ¿ã€‚è¿è¡Œæ—¶å¤šæ€ï¼šåŠ¨æ€ç»‘å®šï¼Œåœ¨è¿è¡Œæ—¶ç¡®å®šè°ƒç”¨å“ªä¸ªå‡½æ•° ï¼Œå®ç°ï¼šé€šè¿‡å¯¹è±¡çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆæ‰¾åˆ°å¹¶è°ƒç”¨æ­£ç¡®çš„å‡½æ•° è™šå‡½æ•°ï¼šåœ¨åŸºç±»ä¸­ä½¿ç”¨å…³é”®å­—virtualå£°æ˜çš„å‡½æ•°ã€‚è™šå‡½æ•°è¡¨ï¼šæ¯ä¸ªæœ‰è™šå‡½æ•°çš„ç±»éƒ½æœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ã€‚è™šå‡½æ•°è¡¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ç±»çš„è™šå‡½æ•°ã€‚å­˜æ”¾åœ¨å…¨å±€æ•°æ®ç©ºé—´ã€‚å°±ç®—æ˜¯ç»§æ‰¿çˆ¶ç±»çš„è™šå‡½æ•°ä¹Ÿæœ‰è‡ªå·±çš„è™šå‡½æ•°è¡¨ï¼Œå¦‚æœæ²¡æœ‰é‡å†™ï¼Œé‚£ä¹ˆè™šå‡½æ•°è¡¨ä¸­çš„æŒ‡é’ˆè¿˜æ˜¯æŒ‡å‘çˆ¶ç±»çš„è™šå‡½æ•°ã€‚è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼šæŒ‡å‘è™šå‡½æ•°è¡¨(å¼€å¤´ä½ç½®)ã€‚å¤§å°ï¼š32ä½ç³»ç»Ÿ(4å­—èŠ‚)ï¼Œ64ä½ç³»ç»Ÿ(8å­—èŠ‚)è°ƒç”¨é¡ºåºï¼šåˆ¤æ–­å‡½æ•°æ˜¯å¦ä¸ºè™šå‡½æ•°ï¼Œå¦‚æœæ˜¯åˆ™é€šè¿‡è™šå‡½æ•°è¡¨æŒ‡é’ˆæ‰¾åˆ°è™šå‡½æ•°è¡¨ï¼Œå†åœ¨è™šå‡½æ•°è¡¨ä¸­æ‰¾åˆ°è¯¥è™šå‡½æ•°è°ƒç”¨ã€‚ å¦‚æœæ´¾ç”Ÿç±»è¿˜æœ‰ä¸€ä¸ªintç±»å‹çš„å˜é‡ï¼Œ64ä½ç³»ç»Ÿä¸­ï¼Œè™šå‡½æ•°è¡¨æŒ‡é’ˆä¸º8 èŠ‚ï¼Œintä¸º4å­—èŠ‚ï¼Œè€ƒè™‘å†…å­˜å¯¹é½åï¼Œå¯¹è±¡å¤§å°é€šå¸¸ä¸º16å­—èŠ‚ï¼ˆæŒ‰8å­—èŠ‚å¯¹é½ï¼‰ï¼Œ32ä½ç³»ç»Ÿä¸­ä¸º8å­—èŠ‚(å››å­—èŠ‚å¯¹é½)ã€‚ å¤šç»§æ‰¿ï¼šå¦‚æœä¸€ä¸ªæ´¾ç”Ÿç±»ç»§æ‰¿äº†ä¸¤ä¸ªç±»ï¼Œä¸¤ä¸ªç±»éƒ½æœ‰è™šå‡½æ•°ï¼Œè¿™ä¸ªæ´¾ç”Ÿç±»å°±æœ‰ä¸¤ä¸ªè™šå‡½æ•°è¡¨æŒ‡é’ˆï¼Œå¦‚æœè¿™ä¸ªæ´¾ç”Ÿç±»å†æ¬¡å£°æ˜è‡ªå·±æ–°çš„è™šå‡½æ•°ï¼Œé‚£ä¹ˆä¼šæ”¾åˆ°ç¬¬ä¸€ä¸ªè™šå‡½æ•°è¡¨çš„æœ«å°¾ã€‚ vitual overridevitual å£°æ˜è™šå‡½æ•°ï¼Œå½“åŸºç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨æŒ‡å‘æ´¾ç”Ÿç±»ï¼Œè°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œå­ç±»å¦‚æœå¯¹è™šå‡½æ•°é‡å†™ï¼Œè°ƒç”¨çš„æ˜¯å­ç±»é‡å†™çš„è™šå‡½æ•°ï¼Œæ²¡æœ‰é‡å†™è°ƒç”¨çš„å°±æ˜¯çˆ¶ç±»çš„è™šå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™è°ƒç”¨çš„éƒ½æ˜¯çˆ¶ç±»çš„å‡½æ•°ã€‚override æ˜¾ç¤ºå£°æ˜é‡å†™äº†è™šå‡½æ•°ï¼Œvoid reload() override{}; æœ‰overrideçš„å‡½æ•°ç¼–è¯‘æ—¶ä¼šæ£€æŸ¥é‡å†™æ˜¯å¦æ­£ç¡®ã€‚ é‡å†™è™šå‡½æ•°ä¼ å…¥å‚æ•°å’Œè¿”å›ç±»å‹ä¸èƒ½æ”¹å˜-å¦‚æœç±»å‹ä¸åŒä¼šé€ æˆé‡å®šä¹‰ä¾‹å¤–ï¼š åå˜ ï¼Œçˆ¶ç±»çš„è™šå‡½æ•°è¿”å›ç±»å‹æ˜¯è‡ªèº«çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œå­ç±»çš„è™šå‡½æ•°è¿”å›ç±»å‹å¯ä»¥æ”¹ä¸ºå­ç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ é‡å†™ææ„å‡½æ•° 123Base* ptr = new Derived();delete ptr;//å¦‚æœBaseçš„ææ„å‡½æ•°æ²¡æœ‰å£°æ˜ä¸ºè™šå‡½æ•°å°†ä¸ä¼šè°ƒç”¨Derivedçš„ææ„å‡½æ•°ï¼Œé€ æˆæ— æ³•é‡Šæ”¾çš„å†…å­˜æ³„éœ²ã€‚å¦‚æœå£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™å…ˆè°ƒç”¨å­ç±»çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±»çš„è™šæ„å‡½æ•°ã€‚ æ³¨æ„åŒºåˆ«é‡è½½ï¼Œé‡è½½æ˜¯åŒä¸€ä¸ªä½œç”¨åŸŸå†…å‡½æ•°åç›¸åŒï¼Œæ‰€ä»¥å­ç±»ä¸­å¯ä»¥æœ‰ä¸ç»§æ‰¿çš„è™šå‡½æ•°ç›¸åŒå‡½æ•°åçš„å‡½æ•°ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯é‡å†™ï¼Œä¸€ä¸ªé‡è½½ï¼Œå½“æ²¡æœ‰é‡å†™è™šå‡½æ•°æ—¶ï¼Œå­ç±»å¯¹è±¡è°ƒç”¨è¯¥å‡½æ•°åå‡½æ•°ä¸ä¼šåšåŠ¨æ€åŒ¹é…ï¼Œå¦‚æœè¦ä½¿ç”¨çˆ¶ç±»çš„åŒåå‡½æ•°éœ€è¦åŠ ä½œç”¨åŸŸ:: å»ºè®®ææ„å‡½æ•°éƒ½å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œé¿å…å†…å­˜æ³„æ¼æ„é€ å‡½æ•°ä¸èƒ½å£°æ˜ä¸ºè™šå‡½æ•° finalc++11ï¼Œç”¨äºç±»ååæˆ–è€…è™šå‡½æ•°åé˜²æ­¢è¢«ç»§æ‰¿ã€‚class student final{};virtual void abc() override final{}; ä¸€èˆ¬æ˜¯æŸä¸ªå­ç±»å¯¹ç»§æ‰¿çš„è™šå‡½æ•°è¿›è¡Œé‡å†™ä¹‹åï¼Œå®ƒçš„å­ç±»ä¸ä¼šç”¨åˆ°è¿™ä¸ªè™šå‡½æ•°äº†å°±,å­ç±»ä¹Ÿä¸èƒ½å‡ºç°å’Œè¿™ä¸ªè™šå‡½æ•°ç›¸åŒåå­—ï¼Œå‚æ•°ï¼Œè¿”å›å€¼çš„å‡½æ•°ã€‚ æŠ½è±¡åŸºç±»å«çº¯è™šå‡½æ•° virtual void draw()&#x3D; 0; å­ç±»å¿…é¡»æä¾›å®ç°ä¸èƒ½åˆ›å»ºæŠ½è±¡åŸºç±»å¯¹è±¡ 1234567891011// è¿™é‡Œå¸¸è€ƒä¸€é“ç¬”è¯•é¢˜ï¼šsizeof(Base)æ˜¯å¤šå°‘ï¼Ÿclass Base&#123;public: virtual void Func1()&#123; cout &lt;&lt; &quot;Func1()&quot; &lt;&lt; endl; &#125;private: int _b = 1;&#125;;//è™šå‡½æ•°è¡¨æŒ‡é’ˆ(32ä½ç³»ç»Ÿ4å­—èŠ‚ï¼Œ64ä½ç³»ç»Ÿ8å­—èŠ‚)+intæˆå‘˜4å­—èŠ‚,è€ƒè™‘å†…å­˜å¯¹é½ï¼Œ8/32//ç±»çš„æˆå‘˜å‡½æ•°ä¸å ç©ºé—´ï¼Œå­˜æ”¾åœ¨ç¨‹åºçš„ä»£ç æ®µ unionè”åˆunionæˆå‘˜å…±äº«ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œç»™å…¶ä¸­ä¸€ä¸ªæˆå‘˜èµ‹å€¼ï¼Œå¦ä¸€ä¸ªå·²ç»èµ‹å€¼çš„æˆå‘˜å°±æ²¡æœ‰å€¼äº†ã€‚åªç»™uninoåˆ†é…æœ€å¤§çš„æˆå‘˜æ‰€éœ€çš„ç©ºé—´ 123456789101112131415161718192021222324252627282930union MyUnion &#123; int i; float f; char str[20]; &#125;;MyUnion u;u.i=10;//åŒ¿åè”åˆunion &#123; int intValue; char charValue;&#125;;// ç›´æ¥è®¿é—®æˆå‘˜intValue = 10;//æ„é€ ä¸ææ„union MyUnion &#123; int intValue; std::string stringValue; // æ‰‹åŠ¨å®šä¹‰æ„é€ å‡½æ•° MyUnion() &#123; new (&amp;intValue) int(0); &#125; // æ‰‹åŠ¨å®šä¹‰ææ„å‡½æ•° ~MyUnion() &#123; // ç”±äº string æœ‰éå¹³å‡¡ææ„å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ stringValue.~basic_string(); &#125;&#125;; æ ‡å‡†åº“ä¸­çš„ std::variantï¼šC++17 å¼•å…¥äº† std::variantï¼Œå®ƒæä¾›äº†ä¸€ç§ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ˜¯å‡ ç§ç±»å‹ä¸­çš„ä»»ä½•ä¸€ç§ã€‚std::variant æ˜¯ union çš„ä¸€ä¸ªæ›´ç°ä»£ã€æ›´å®‰å…¨çš„æ›¿ä»£å“ã€‚ variantc++ 17ä¸­å¯¹unionæ›´ç°ä»£ï¼Œå®‰å…¨çš„æ›¿ä»£å“ 123456789#include &lt;variant&gt;// å®šä¹‰ä¸€ä¸ª variant ç±»å‹ï¼Œå®ƒå¯ä»¥å­˜å‚¨ intã€double æˆ– std::string ç±»å‹çš„å€¼std::variant&lt;int, double, std::string&gt; myVariant;// å­˜å‚¨ä¸€ä¸ª int å€¼myVariant = 42;// ä½¿ç”¨ std::get_if æ£€æŸ¥å½“å‰å­˜å‚¨çš„æ˜¯å¦ä¸º int ç±»å‹, æ˜¯åˆ™è¿”å›å…¶å€¼çš„æŒ‡é’ˆif (const int* intPtr = std::get_if&lt;int&gt;(&amp;myVariant)) &#123; td::cout &lt;&lt; &quot;The stored value is an int: &quot; &lt;&lt; *intPtr &lt;&lt; std::endl;&#125; ç±»å‹åŒ¹é… 123456789101112131415161718192021222324#include &lt;iostream&gt;#include &lt;variant&gt;#include &lt;string&gt;#include &lt;vector&gt;// å®šä¹‰ä¸€ä¸ªè®¿é—®å™¨ç»“æ„ä½“ï¼Œä½¿ç”¨é‡è½½çš„ () è¿ç®—ç¬¦å¤„ç†ä¸åŒç±»å‹struct VariantVisitor &#123; void operator()(int value) const &#123; std::cout &lt;&lt; &quot;Received an int: &quot; &lt;&lt; value &lt;&lt; std::endl; &#125; void operator()(double value) const &#123; std::cout &lt;&lt; &quot;Received a double: &quot; &lt;&lt; value &lt;&lt; std::endl; &#125; void operator()(const std::string&amp; value) const &#123; std::cout &lt;&lt; &quot;Received a string: &quot; &lt;&lt; value &lt;&lt; std::endl; &#125;&#125;;int main() &#123; std::vector&lt;std::variant&lt;int, double, std::string&gt;&gt; variants = &#123;42, 3.14, &quot;Hello&quot;&#125;; for (const auto&amp; var : variants) &#123; // ä½¿ç”¨ std::visit è°ƒç”¨è®¿é—®å™¨æ¥å¤„ç† variant ä¸­çš„å€¼ std::visit(VariantVisitor&#123;&#125;, var); &#125; return 0;&#125; å¼‚å¸¸å¤„ç† 1234567std::variant&lt;int, std::string&gt; myVariant = 42;try &#123; // å°è¯•è·å–ä¸€ä¸ª std::string ç±»å‹çš„å€¼ï¼Œç”±äºå½“å‰å­˜å‚¨çš„æ˜¯ intï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ std::string str = std::get&lt;std::string&gt;(myVariant);&#125; catch (const std::bad_variant_access&amp; e) &#123; std::cout &lt;&lt; &quot;Exception caught: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;&#125;","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]},{"title":"c++ STL","slug":"source/C++/STL","date":"2025-03-10T16:00:00.000Z","updated":"2025-03-11T14:51:50.472Z","comments":true,"path":"2025/03/11/source/C++/STL/","permalink":"http://example.com/2025/03/11/source/C++/STL/","excerpt":"","text":"C++æ ‡å‡†åº“ &#x2F; STL æ ‡å‡†æ¨¡æ¿åº“ å®¹å™¨#include ##é¡ºåºå®¹å™¨ å®¹å™¨ç±»å‹ æè¿° è®¿é—®æ”¯æŒ å¢åˆ  vectorå‘é‡ åŠ¨æ€æ‰©å®¹çš„æ•°ç»„ è¿ç»­å­˜å‚¨-éšæœºè®¿é—® å°¾éƒ¨å¿« dequeåŒç«¯é˜Ÿåˆ— æŒ‡é’ˆæ•°ç»„-æ¯ä¸ªå…ƒç´ æŒ‡å‘ä¸€å—è¿ç»­æ•°ç»„ éšæœº ä¸¤ç«¯å¿« liståŒå‘é“¾è¡¨ åŒå‘é¡ºåº any ä¸å¸¸ç”¨ï¼š forward_list å•å‘é“¾è¡¨ arrayå°±æ˜¯æ™®é€šæ•°ç»„ string ä¸vectorç›¸ä¼¼ å­˜å­—ç¬¦ä¸² ä½¿ç”¨ åˆå§‹åŒ– 12345678910111213//é»˜è®¤æ„é€ vector&lt;int&gt; vec; //ç©ºvector&lt;int&gt; vec(10); //10ä¸ªå€¼ä¸º0çš„int é»˜è®¤æ„é€ vector&lt;int&gt; vec(10, 42); //10ä¸ªå€¼ä¸º42çš„int 42ä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°//èŒƒå›´åˆå§‹åŒ–vector&lt;int&gt; vec(arr.begin(), arr.end()); // ä½¿ç”¨arrçš„èŒƒå›´åˆå§‹åŒ–vec //æ‹·è´åˆå§‹åŒ–-å®¹å™¨ç±»å‹å’Œå…ƒç´ ç±»å‹ä¸€è‡´vector&lt;int&gt; copy(original);vector&lt;int&gt; copy2 = original;//ç§»åŠ¨æ„é€ vector&lt;int&gt; moved(move(original)); //originalçš„èµ„æºäº¤ç»™moved c++11 originalä¸ºç©ºä¸”æœªå®šä¹‰çŠ¶æ€//åˆ—è¡¨åˆå§‹åŒ– c++11vector&lt;int&gt; vec = &#123;1, 2, 3, 4, 5&#125;; 123array&lt;int,5&gt; ia; èµ‹éšæœºæ•°?array&lt;int,5&gt; ia&#123;1,2,3,41,1&#125;; &#123;0&#125; å…¨ä¸º0 &#123;2&#125;ç¬¬ä¸€ä¸ªæ˜¯2å…¶ä½™ä¸º0int ia(5); ä¸èƒ½æ‹·è´æˆ–èµ‹å€¼ å®¹å™¨æ“ä½œ size empty max_size å¯åŒ…å«çš„æœ€å¤§å¤§å° reserve vectorå’Œstring è¯·æ±‚å®¹å™¨ä¿ç•™è¶³å¤Ÿçš„ç©ºé—´æ¥å­˜å‚¨æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œä½†ä¸æ”¹å˜å®¹å™¨çš„å¤§å° shrink_to_fit c++11 vectorå’Œstring å°è¯•å‡å°‘å®¹å™¨çš„å®¹é‡ä»¥åŒ¹é…å…¶å¤§å° å…ƒç´ è®¿é—® [] ä¸‹æ ‡ é™¤äº†list at() è¿”å›æŒ‡å®šä½ç½®çš„å…ƒç´ å¼•ç”¨ front ç¬¬ä¸€ä¸ªå…ƒç´  back æœ€åä¸€ä¸ª data ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ é™¤äº†list ä¿®æ”¹å™¨ push_back() &#x2F; emplace_back()ï¼šåœ¨å®¹å™¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ &#x2F;æ„é€ ä¸€ä¸ªå…ƒç´ ã€‚ pop_back()ï¼šç§»é™¤å®¹å™¨æœ«å°¾çš„å…ƒç´ ã€‚ insert(itrator,value) &#x2F; emplace()ï¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ &#x2F;æ„é€ ä¸€ä¸ªå…ƒç´ ã€‚ æŒ‡å®šä½ç½®ç”¨è¿­ä»£å™¨å®ç° erase()ï¼šç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ æˆ–å…ƒç´ èŒƒå›´ã€‚ clear resize()ï¼šæ”¹å˜å®¹å™¨çš„å¤§å°ï¼Œå¦‚æœæ–°å¤§å°å¤§äºå½“å‰å¤§å°ï¼Œåˆ™æ·»åŠ é»˜è®¤æ„é€ çš„å…ƒç´ ï¼›å¦‚æœå°äºå½“å‰å¤§å°ï¼Œåˆ™åˆ é™¤å¤šä½™çš„å…ƒç´ ã€‚ vector12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;// æ’å…¥å…ƒç´ åˆ° vectorvoid insertElements(std::vector&lt;int&gt;&amp; vec, const std::initializer_list&lt;int&gt;&amp; elements) &#123; for (int element : elements) &#123; vec.push_back(element); &#125;&#125;// éå† vectorvoid traverseVector(const std::vector&lt;int&gt;&amp; vec) &#123; for (int element : vec) &#123; std::cout &lt;&lt; element &lt;&lt; &quot; &quot;; &#125; std::cout &lt;&lt; std::endl;&#125;int main() &#123; std::vector&lt;int&gt; myVector; // æ’å…¥å…ƒç´  insertElements(myVector, &#123;5, 2, 8, 1, 9&#125;); std::cout &lt;&lt; &quot;æ’å…¥å…ƒç´ åçš„ vector: &quot;; traverseVector(myVector); // æ’åº std::sort(myVector.begin(), myVector.end()); //åå‘æ’åº std::sort(myVector.begin(), myVector.end(), std::greater&lt;int&gt;()); std::cout &lt;&lt; &quot;æ’åºåçš„ vector: &quot;; traverseVector(myVector); // æŸ¥æ‰¾å…ƒç´  int target = 8; if (std::find(myVector.begin(), myVector.end(), target) != myVector.end()) &#123; std::cout &lt;&lt; target &lt;&lt; &quot; å­˜åœ¨äº vector ä¸­ã€‚&quot; &lt;&lt; std::endl; &#125; else &#123; std::cout &lt;&lt; target &lt;&lt; &quot; ä¸å­˜åœ¨äº vector ä¸­ã€‚&quot; &lt;&lt; std::endl; &#125; // åˆ é™¤å…ƒç´  auto newEnd = std::remove(myVector.begin(), myVector.end(), target); myVector.erase(newEnd, myVector.end()); std::cout &lt;&lt; &quot;åˆ é™¤ &quot; &lt;&lt; target &lt;&lt; &quot; åçš„ vector: &quot;; traverseVector(myVector); return 0;&#125; ###string string::size_typeç±»å‹ sizeå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œèƒ½å­˜ä»»ä½•stringçš„å¤§å°ï¼Œæ— ç¬¦å· æ¯”è¾ƒï¼š â€œhelloâ€&lt;â€hello worldâ€ â€œhiâ€&gt;â€heâ€ içš„ascllç åœ¨åé¢ string+å­—ç¬¦å­—é¢å€¼+å­—ç¬¦ä¸²å­—é¢å€¼(ä¸æ˜¯string) å¿…é¡»ä¿è¯+ä¸¤ä¾§çš„å¯¹è±¡è‡³å°‘ä¸€ä¸ªæ˜¯string string s2&#x3D;s1+â€,â€+â€worldâ€; æ­£ç¡® s1æ”¾æœ€åä¸å¯¹ ##å…³è”å®¹å™¨ æŒ‰å…³é”®å­—æœ‰åº map(é”®å€¼å¯¹) set multimap multiset multi-å¯é‡å¤å‡ºç°é”® çº¢é»‘æ ‘ï¼Œå…ƒç´ æŒ‰é”®è‡ªåŠ¨æ’åº æ— åº unordered_map unordered_set unordered_multimap unordered_multiset å“ˆå¸Œè¡¨ éƒ½æ˜¯åŒå‘è¿­ä»£å™¨(å¯ä»¥å‘å‰æˆ–å‘åéå†) ä¸æ”¯æŒéšæœºè®¿é—®(ä¸èƒ½ä½¿ç”¨ä¸‹æ ‡)é™¤äº†map ä½¿ç”¨1234567891011121314//é»˜è®¤åˆå§‹åŒ–map&lt;int, string&gt; myMap;set&lt;int&gt; mySet;//æ‹·è´åˆå§‹åŒ–map&lt;int, string&gt; myMap2(myMap1); set&lt;int&gt; mySet2(mySet1);//è¿­ä»£å™¨èŒƒå›´åˆå§‹åŒ–set&lt;int&gt; mySet(myVector.begin(), myVector.end()); // å¯¹äºmapï¼Œéœ€è¦ç¡®ä¿èŒƒå›´ä¸­çš„å…ƒç´ æ˜¯pairæˆ–å¯ä»¥éšå¼è½¬æ¢ä¸ºpairçš„ç±»å‹ vector&lt;pair&lt;int, string&gt;&gt; myVectorPairs = &#123; &#123;1, &quot;One&quot;&#125;, &#123;2, &quot;Two&quot;&#125; &#125;; map&lt;int, string&gt; myMap(myVectorPairs.begin(), myVectorPairs.end());//åˆ—è¡¨åˆå§‹åŒ– c++11map&lt;int, string&gt; myMap = &#123; &#123;1, &quot;One&quot;&#125;, &#123;2, &quot;Two&quot;&#125; &#125;;set&lt;int&gt; mySet = &#123;1, 2, 3, 4, 5&#125;; æ’å…¥ insert emplace åº•å±‚æ’å…¥ mapå¯ä»¥ç”¨ä¸‹æ ‡ map[â€œ123â€] æ²¡æœ‰â€123â€ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª mapæ’å…¥æ—¶ .int( make_pair(â€œ123â€, 1) ) æˆ–pair åˆ é™¤ erase æ ¹æ®è¿­ä»£å™¨(å•ä¸ªæˆ–èŒƒå›´)æˆ–è€…å…³é”®å­— clear åˆ é™¤æ‰€æœ‰ æŸ¥æ‰¾ find è¿”å›è¿­ä»£å™¨æŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—åŒ¹é… å¦åˆ™è¿”å›å°¾åè¿­ä»£å™¨ count è¿”å›ä¸å…³é”®å­—åŒ¹é…çš„ä¸ªæ•° lower_boundå’Œupper_bound ï¼ˆä»…é€‚ç”¨äºæœ‰åºå…³è”å®¹å™¨ï¼‰ è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—ä¸å°äºå’Œå¤§äºç»™å®šå…³é”®å­—çš„å…ƒç´ çš„è¿­ä»£å™¨ equal_range ï¼ˆä»…é€‚ç”¨äºæœ‰åºå…³è”å®¹å™¨ï¼‰ è¿”å›ä¸€ä¸ªpairï¼ŒåŒ…å«ä¸¤ä¸ªè¿­ä»£å™¨ï¼Œåˆ†åˆ«è¡¨ç¤ºå…³é”®å­—ç­‰äºç»™å®šå…³é”®å­—çš„å…ƒç´ èŒƒå›´çš„å¼€å§‹å’Œç»“æŸã€‚ å¤§å° size empty æœ‰åºå…³è”å®¹å™¨ï¼ˆå¦‚setå’Œmapï¼‰å…è®¸é€šè¿‡ä¼ é€’è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°æˆ–å‡½æ•°å¯¹è±¡æ¥å®šä¹‰å…ƒç´ ä¹‹é—´çš„æ¯”è¾ƒæ–¹å¼ã€‚ 1234567891011121314151617181920#include &lt;iostream&gt; #include &lt;map&gt; #include &lt;string&gt; // è‡ªå®šä¹‰æ¯”è¾ƒå™¨ç±» struct CompareLength &#123; bool operator()(const std::string&amp; a, const std::string&amp; b) const &#123; return a.length() &lt; b.length(); // æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦è¿›è¡Œæ¯”è¾ƒ &#125; &#125;; int main() &#123; // ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨ç±» std::map&lt;std::string, int, CompareLength&gt; myMap; myMap[&quot;apple&quot;] = 1; myMap[&quot;banana&quot;] = 2; myMap[&quot;cherry&quot;] = 3; for (const auto&amp; pair : myMap) &#123; std::cout &lt;&lt; pair.first &lt;&lt; &quot;: &quot; &lt;&lt; pair.second &lt;&lt; std::endl; &#125; return 0; &#125; æ— åºå…³è”å®¹å™¨ï¼ˆå¦‚unordered_setå’Œunordered_mapï¼‰å…è®¸é€šè¿‡ä¼ é€’è‡ªå®šä¹‰çš„å“ˆå¸Œå‡½æ•°å’Œæ¯”è¾ƒå‡½æ•°æ¥å®šä¹‰å…ƒç´ çš„å­˜å‚¨å’Œæ¯”è¾ƒæ–¹å¼ã€‚ unordered_map12345678910111213141516171819202122232425262728293031323334353637#include &lt;iostream&gt;#include &lt;unordered_map&gt;#include &lt;string&gt;int main() &#123; // åˆ›å»ºä¸€ä¸ªæ— åºæ˜ å°„ï¼Œé”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼æ˜¯æ•´æ•° std::unordered_map&lt;std::string, int&gt; myMap; // æ’å…¥å…ƒç´  myMap[&quot;apple&quot;] = 5; myMap[&quot;banana&quot;] = 2; myMap[&quot;orange&quot;] = 8; // è®¿é—®å…ƒç´  std::cout &lt;&lt; &quot;apple: &quot; &lt;&lt; myMap[&quot;apple&quot;] &lt;&lt; std::endl; // ä¿®æ”¹å…ƒç´  myMap[&quot;apple&quot;] = 10; // éå†å…ƒç´  for (const auto&amp; pair : myMap) &#123; std::cout &lt;&lt; pair.first &lt;&lt; &quot;: &quot; &lt;&lt; pair.second &lt;&lt; std::endl; &#125; // æŸ¥æ‰¾å…ƒç´  if (myMap.find(&quot;banana&quot;) != myMap.end()) &#123; std::cout &lt;&lt; &quot;Found banana&quot; &lt;&lt; std::endl; &#125; // åˆ é™¤å…ƒç´  myMap.erase(&quot;orange&quot;); // è·å–å…ƒç´ æ•°é‡ std::cout &lt;&lt; &quot;Size: &quot; &lt;&lt; myMap.size() &lt;&lt; std::endl; return 0;&#125; å®¹å™¨é€‚é…å™¨stack åè¿›å…ˆå‡º queue å…ˆè¿›å…ˆå‡º priority_queue ä¼˜å…ˆé˜Ÿåˆ— ###stack stack a åˆå§‹åŒ– push() æ·»åŠ å…ƒç´  pop() ç§»é™¤å…ƒç´ ï¼Œä¸è¿”å›å€¼ top() è¿”å›é¡¶éƒ¨å…ƒç´ å¼•ç”¨ï¼Œä¸ç§»é™¤ empty() æ˜¯å¦ä¸ºç©º size() å…ƒç´ ä¸ªæ•°-æ€§èƒ½è¾ƒä½ swap(stack&amp; other) äº¤æ¢ä¸¤ä¸ªstackçš„å…ƒç´  queue æ²¡æœ‰top front() è¿”å›æœ€å…ˆè¿›å…¥çš„å…ƒç´ å¼•ç”¨ back() æœ€åè¿›å…¥çš„ priority_queue æ„é€  å¸¦æ¯”è¾ƒå‡½æ•° é»˜è®¤ä¸ºless åˆ›å»ºä¸€ä¸ªæœ€å¤§å †-å…ƒç´ å¤§çš„ä¼˜å…ˆçº§é«˜ :greater&gt;æœ€å°å † æœ€å°å † å¿…é¡»æ˜¾ç¤ºæŒ‡å‡ºåº•å±‚ç±»å‹ä¸ºvector priority_queue&lt;int, vector,greater&gt; ll; emplace() åº•å±‚å®¹å™¨ä¸Šåˆ›å»ºæ–°å…ƒç´ ï¼Œé¿å…é¢å¤–å¤åˆ¶å’Œç§»åŠ¨ è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;iostream&gt; #include &lt;queue&gt; #include &lt;vector&gt; #include &lt;functional&gt; // å¯¹äº std::less å’Œ std::greaterï¼Œè™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å°†è‡ªå®šä¹‰æ¯”è¾ƒ class MyClass &#123; public: int a; MyClass(int val) : a(val) &#123;&#125; &#125;; // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°å¯¹è±¡ï¼Œç”¨äºæ¯”è¾ƒ MyClass å¯¹è±¡çš„ a æˆå‘˜ struct CompareMyClass &#123; bool operator()(const MyClass&amp; lhs, const MyClass&amp; rhs) const &#123; // å¦‚æœä½ æƒ³è¦æœ€å°å †ï¼Œå°±è¿”å› lhs.a &gt; rhs.a return lhs.a &gt; rhs.a; &#125; &#125;; int main() &#123; std::priority_queue&lt;MyClass, std::vector&lt;MyClass&gt;, CompareMyClass&gt; minHeap; // æ·»åŠ å…ƒç´  minHeap.push(MyClass(3)); minHeap.push(MyClass(1)); minHeap.push(MyClass(4)); minHeap.push(MyClass(1)); minHeap.push(MyClass(5)); // è®¿é—®å¹¶ç§»é™¤ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼ˆåœ¨æœ€å°å †ä¸­æ˜¯åŸºäº a æˆå‘˜çš„æœ€å°å€¼ï¼‰ while (!minHeap.empty()) &#123; MyClass topElement = minHeap.top(); std::cout &lt;&lt; &quot;Top element (min a): &quot; &lt;&lt; topElement.a &lt;&lt; std::endl; minHeap.pop(); &#125; return 0; &#125;//æ¯”è¾ƒå­—ç¬¦ä¸²priority_queue&lt;string, vector&lt;string&gt;, CompareStr&gt; pq;struct CompareStr &#123; bool operator()(const string&amp; lhs, const string&amp; rhs) const &#123; return lhs &gt; rhs; //å°çš„ä¼˜å…ˆ &#125; &#125;; #è¿­ä»£å™¨ ç±»å‹ï¼š::const_iterator &#x2F;&#x2F;ä»…éœ€è¦è¯»::iterator &#x2F;&#x2F;ä¿®æ”¹å­˜å‚¨åœ¨å®¹å™¨ä¸­çš„å€¼ä½¿ç”¨å®¹å™¨ç±»å‹ä¸ºconståˆ™è¿”å›::const_iteratorï¼Œconst vecotr ä½¿ç”¨ï¼š (*iter).nameã€‚ .ä¼˜å…ˆçº§æ¯”*é«˜iter-&gt;nameauto b&#x3D;v.begin(),e&#x3D;v.end(); &#x2F;&#x2F;å¦‚æœå®¹å™¨ä¸ºç©ºï¼Œbï¼Œeè¿”å›åŒä¸€ä¸ªè¿­ä»£å™¨-å°¾åè¿­ä»£å™¨â€å°¾å…ƒç´ çš„ä¸‹ä¸€ä½â€ åŸºæœ¬æ“ä½œ *iter è§£å¼•ç”¨ è®¿é—®å½“å‰æŒ‡å‘çš„å€¼ ++ â€“ç§»åŠ¨ åŒå‘å’Œéšæœºå¯ä»¥ä½¿ç”¨â€“ &#x3D;&#x3D; !&#x3D; &gt;&#x3D; &lt;&#x3D; &lt; &gt; æ¯”è¾ƒè¿­ä»£å™¨çš„ä½ç½® æ³¨æ„ é¿å…è¿­ä»£å™¨å¤±æ•ˆ åœ¨å¯¹å®¹å™¨è¿›è¡Œä¿®æ”¹æ“ä½œ(åˆ é™¤å…ƒç´ ä¹‹åçš„ï¼Œæ’å…¥æ‰©å®¹ç­‰)ï¼Œå¯¼è‡´å…ƒç´ ä½ç½®æ”¹å˜çš„ï¼ŒæŒ‡å‘è¿™äº›å…ƒç´ çš„è¿­ä»£å™¨ä¼šå¤±æ•ˆï¼Œéœ€è¦é‡æ–°è·å–è¿­ä»£å™¨ è§£å¼•ç”¨ä¹‹å‰ç¡®ä¿ä¸æ˜¯ç©ºè¿­ä»£å™¨ ä¸åŒçš„å®¹å™¨ç±»å‹æœ‰ä¸åŒçš„è¿­ä»£å™¨ç±»å‹ ç±»å‹ vector deque string éšæœºè®¿é—®è¿­ä»£å™¨ list åŒå‘ foward_liståŒå‘ è¾“å…¥&#x2F;è¾“å‡ºè¿­ä»£å™¨é€šå¸¸ä¸ç‰¹å®šçš„ç®—æ³•æˆ–é€‚é…å™¨ä¸€èµ·ä½¿ç”¨ cbegin cend æ–¹ä¾¿ä¸æ˜¯å¸¸é‡çš„å®¹å™¨ä¹Ÿèƒ½è¿”å›constè¿­ä»£å™¨c.rbegin() c.rend() åå‘è¿­ä»£å™¨ï¼Œrbeginæ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ï¼Œrendæ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰çš„è¿­ä»£å™¨c.crbegin() c.crend() conståå‘è¿­ä»£å™¨ 123for(auto it=v.cbegin();it!=v.cend() &amp;&amp; !it-&gt;empty();++it) cout&lt;&lt;*it&lt;&lt;endl; ç®—æ³•ç®—æ³• éå† æœ€å€¼ æ’åº æŸ¥æ‰¾ åè½¬ ï¼ˆæ²¡æœ‰ï¼šç¨³å®šå©šå§» æ ‘é“¾éƒ¨åˆ† åç¼€è‡ªåŠ¨æœº è·³èˆé“¾ æ¨¡æ‹Ÿé€€ç« éšæœºç®—æ³•ï¼‰ æ’åº sort æŸ¥æ‰¾ find éå† traversal #ä»¿å‡½æ•° 123456789101112131415161718192021222324252627#include &lt;iostream&gt; #include &lt;algorithm&gt; // std::sort #include &lt;vector&gt; // å®šä¹‰ä»¿å‡½æ•° class CompareInt &#123; public: // é‡è½½operator()ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ•´æ•° bool operator()(int a, int b) const &#123; return a &lt; b; &#125; &#125;; int main() &#123; std::vector&lt;int&gt; vec = &#123;5, 3, 8, 4, 2&#125;; // ä½¿ç”¨ä»¿å‡½æ•°ä½œä¸ºstd::sortçš„ç¬¬ä¸‰ä¸ªå‚æ•° std::sort(vec.begin(), vec.end(), CompareInt()); // è¾“å‡ºæ’åºåçš„ç»“æœ for(int num : vec) &#123; std::cout &lt;&lt; num &lt;&lt; &quot; &quot;; &#125; std::cout &lt;&lt; std::endl; return 0; &#125; #åŠ¨æ€å†…å­˜ åˆ†é…å™¨ å†…å­˜æ³„æ¼ï¼šå¿˜è®°é‡Šæ”¾ å¼•ç”¨éæ³•æŒ‡é’ˆï¼šæŒ‡é’ˆæ­£åœ¨å¼•ç”¨å†…å­˜çš„æ—¶å€™è¢«é‡Šæ”¾ new deletenew åˆ†é…å†…å­˜å¹¶è¿”å›æŒ‡é’ˆ int *pi&#x3D;new int; æœªå®šä¹‰å€¼int *pi&#x3D;new int(24); åˆå§‹åŒ–ä¸º24string *pi&#x3D;new string(10,â€™9â€™);int* arrPtr &#x3D; new int[5];int *p&#x3D;new int[5]{0,1,2,3,4};const int *p&#x3D;new const int; delete p;p&#x3D;nullptr; é˜²æ­¢é‡Šæ”¾ä¹‹åä¾ç„¶æŒ‡å‘æ— æ•ˆåœ°å€delete []arrPtr allocator#include STLå®¹å™¨é»˜è®¤ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ 12345678910111213141516171819202122232425#include &lt;iostream&gt;#include &lt;memory&gt;int main() &#123; // 1. åˆ›å»ºåˆ†é…å™¨å¯¹è±¡ï¼ŒæŒ‡å®šåˆ†é…çš„å¯¹è±¡ç±»å‹ä¸º int std::allocator&lt;int&gt; alloc; // 2. åˆ†é…å†…å­˜ï¼Œè¿™é‡Œåˆ†é… 5 ä¸ª int ç±»å‹çš„å†…å­˜ç©ºé—´ int* ptr = alloc.allocate(5); // 3. æ„é€ å¯¹è±¡ï¼Œä½¿ç”¨ std::construct åœ¨åˆ†é…çš„å†…å­˜ä¸Šæ„é€ å¯¹è±¡ for (int i = 0; i &lt; 5; ++i) &#123; std::construct_at(ptr + i, i * 2); &#125; // è¾“å‡ºåˆ†é…å†…å­˜ä¸Šæ„é€ çš„å¯¹è±¡çš„å€¼ for (int i = 0; i &lt; 5; ++i) &#123; std::cout &lt;&lt; ptr[i] &lt;&lt; &quot; &quot;; &#125; std::cout &lt;&lt; std::endl; // 4. ææ„å¯¹è±¡ï¼Œä½¿ç”¨ std::destroy ææ„å¯¹è±¡ for (int i = 0; i &lt; 5; ++i) &#123; std::destroy_at(ptr + i); &#125; // 5. é‡Šæ”¾å†…å­˜ alloc.deallocate(ptr, 5); return 0;&#125; åµŒå…¥å¼webåç«¯-åŸºäºlinuxç³»ç»Ÿçš„éå®¢æˆ·ç«¯çš„å„ç§åº”ç”¨ å¦‚è‡ªåŠ¨é©¾é©¶åç«¯ æ‰‹å†™å¸¸ç”¨è®¾è®¡æ¨¡å¼ linuxç³»ç»Ÿç¼–ç¨‹ è¿›é˜¶ å‹åŠ›æµ‹è¯•10ä¸‡+ é«˜æ€§èƒ½æ•°æ®å¤„ç† é‡‘èé‡åŒ– æ¸¸æˆæœåŠ¡å™¨ è‡ªåŠ¨é©¾é©¶ é«˜æ€§èƒ½ä¸­é—´ä»¶å¼€å‘-ç½‘è·¯æ¨¡å— linuxåç«¯-é“¶è¡Œä¸šåŠ¡ æœç´¢ * c++ c++ åç«¯ c++ linux","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]},{"title":"c++çŸ¥è¯†ç‚¹","slug":"source/C++/çŸ¥è¯†ç‚¹æ€»ç»“","date":"2025-03-10T16:00:00.000Z","updated":"2025-03-11T14:51:50.710Z","comments":true,"path":"2025/03/11/source/C++/çŸ¥è¯†ç‚¹æ€»ç»“/","permalink":"http://example.com/2025/03/11/source/C++/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/","excerpt":"","text":"å»ºè®®çœ‹ä¸€ä¸‹æºç ï¼šå‰ç¼€æ•ˆç‡æ›´é«˜ â€“i,åç¼€å…ˆå¤åˆ¶ä¸€ä¸ªå‰¯æœ¬å°½é‡ä»¥const enum inlineæ›¿æ¢#defineå°½å¯èƒ½ä½¿ç”¨const æ‰‹å†Œï¼šæ¯”å¦‚æ‰¾getå‡½æ•°åœ¨çº¿æ‰‹å†Œç½‘å€https://zh.cppreference.com/ æ ‡å‡†åº“(æ ‡å¤´)-ctrl+fæœç´¢istream-basic_istream-æ‰¾åˆ°getå‡½æ•°å°±å¯ä»¥äº†https://cplusplus.com/reference è‹±æ–‡ç‰ˆè§£é‡Š-è¿™ä¸ªç½‘ç«™å¯ä»¥ç›´æ¥æœç”¨æ³•cin.getå°±ä¼šå‡ºæ¥ æ•°æ®-å­˜å‚¨æ•°æ®ç±»å‹1234567891011//unsignedbool bo;//1 byteshort sh; //è‡³å°‘16ä½ 2 byte -32768åˆ°32767ï¼ˆæœ‰ç¬¦å·ï¼‰æˆ–ä»0åˆ°65535ï¼ˆæ— ç¬¦å·ï¼‰ã€‚int in; //4 bytelong lo;//8 bytelong long lolo=2; //16bytechar ch;//1 byte ascllfloat fl;// 4/7double do;//8/17 long double lodo;//19//å¤´â½‚ä»¶climitså®šä¹‰äº†ç¬¦å·å¸¸é‡ï¼šä¾‹å¦‚ï¼šINT_MAX è¡¨ç¤º int çš„æœ€â¼¤å€¼ï¼ŒINT_MIN è¡¨ç¤º int çš„æœ€â¼©å€¼ char [-128,127]unsigned char [0,255]char a&#x3D;34;ä½¿ç”¨çš„æ˜¯ascllç¼–ç ï¼Œè€Œchar a &#x3D; â€˜1â€™å­˜å‚¨çš„æ˜¯å­—ç¬¦ charå­—ç¬¦å‡½æ•° isspace(c) åˆ¤ç©ºï¼Œæ˜¯è¿”å›true isalpha(c) åˆ¤å­—æ¯ isdigit(c) æ•°å­— isalnum(c) å­—æ¯æˆ–æ•°å­— ispunct(c) æ ‡ç‚¹ isupper(c) å¤§å†™å­—æ¯ islower(c) å°å†™å­—æ¯ toupper(c) äº§ç”Ÿ=cçš„å¤§å†™å­—ç¬¦ tolower(c) å°å†™ è¡¥ç è¡¥ç :æ­£æ•°çš„è¡¥ç æ˜¯æœ¬èº«,è´Ÿæ•°æ˜¯å…¶äºŒè¿›åˆ¶å–å+1 å­—èŠ‚:æœ€å°å­˜å‚¨å•å…ƒ(8æ¯”ç‰¹)ã€‚ä¸€ä¸ªå­—èŠ‚èŒƒå›´[-128,127] ã€‚ 11111111 -1 11111110 è¡¨ç¤º-2 10000001 è¡¨ç¤º-127 10000000 -128 00000000 0 00000001 1 01111111 127 -1 + -2 11111101 &#x3D; -3 æ‰€ä»¥éšå¼è½¬åŒ–å°±æ˜¯éè´Ÿæ•°å‰é¢+0ï¼Œè´Ÿæ•°å‰é¢+1,å¼ºåˆ¶è½¬æ¢å°±æ˜¯æŠŠå‰é¢å¤šä½™çš„å­—èŠ‚ç›´æ¥åˆ‡æ‰,æå¤§å¯èƒ½å¯¼è‡´æ•°æ®æ”¹å˜ä½è¿ç®—ï¼š&lt;&lt; å‘å·¦ç§»åŠ¨ä½ä½è¡¥0 å·¦ç§»ä¸€æ¬¡*2&gt;&gt; å³ç§»,é«˜ä½è¡¥0&#x2F;1 é™¤2&gt;&gt;&gt; æ— ç¬¦å·å³ç§»,é«˜ä½è¡¥1æ•´å½¢éƒ½å¯ä»¥ä½¿ç”¨ä½è¿ç®— æ¯”å¦‚charï¼Œä½†æ˜¯è¦æ ¹æ®æ•°æ®çœ‹æ˜¯å¦ä¼šä¸¢å‡ºæ•°æ®ï¼Œä¸€èˆ¬ä½æ•°é«˜çš„æ— ç¬¦å·æ•´å‹ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œæ¯”å¦‚uint64_t(unsigned long-linux 64ä½) æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ— ç¬¦å·æ•°å’Œæœ‰ç¬¦å·æ•°è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œæœ‰ç¬¦å·æ•°ä¼šè¢«éšå¼è½¬æ¢ä¸ºæ— ç¬¦å·æ•° 1234567int change(unsigned num)&#123;return num;&#125;;int main() &#123; unsigned b = -3; std::cout &lt;&lt; b &lt;&lt; std::endl; std::cout &lt;&lt; change(b) &lt;&lt; std::endl; return 0;&#125; unsigned b &#x3D; -3; çœç•¥äº†intï¼Œæœ¬æ¥æ˜¯unsigned int b &#x3D; -3;unsigned p&#x3D;&b; æŒ‡é’ˆç±»å‹æ˜¯unsigned intchangeå‡½æ•°åšäº†éšå¼è½¬æ¢ï¼Œè½¬æ¢ä¸ºäº†intå˜é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ˜¾ç¤ºè½¬æ¢ 32ä½å’Œ64ä½è®¡ç®—æœº32ä½åªæœ‰4GBå†…å­˜(2^32) ä¸€æ¬¡åªèƒ½å¤„ç†å››ä¸ªå­—èŠ‚çš„æ•°æ®64ä½ ä¸€æ¬¡èƒ½å¤„ç†8ä¸ªå­—èŠ‚æ•°æ®C:\\Program Files\\ æ˜¯ 64 ä½è½¯ä»¶çš„é»˜è®¤å®‰è£…ç›®å½•C:\\Program Files(x86)\\ æ˜¯ 32 ä½è½¯ä»¶çš„é»˜è®¤å®‰è£…ç›®å½• å¯¹äºæ•°æ®æ–¹é¢ åªæœ‰long 64æ˜¯8å­—èŠ‚ 32æ˜¯4å­—èŠ‚ winä¸‹longæ˜¯4å­—èŠ‚ long long8å­—èŠ‚ 32ä½æŒ‡é’ˆå¤§å°ä¸º4byteï¼Œè€Œ64ä½çš„æŒ‡é’ˆå¤§å°ä¸º8byte sizeof() stringçš„å¤§å°ï¼Œ64å’Œ32ï¼Œå’ŒæŒ‡é’ˆå¤§å°ç›¸åŒï¼Œå› ä¸ºstringä¸ä¿å­˜å­—ç¬¦ä¸²æœ¬èº«åªå­˜äº†å¼€å¤´çš„æŒ‡é’ˆ long long* a&#x3D;&amp;num sizeof(long long*)æ˜¯8 è€Œsizeof(a)ä¹Ÿæ˜¯8ï¼Œéƒ½æ˜¯æŒ‡é’ˆå¤§å° å¤§ç«¯åºå’Œå°ç«¯åºä¸€ä¸ª32ä½çš„æ•´æ•°0x12345678åœ¨å¤§ç«¯åºå†…å­˜ä¸­çš„è¡¨ç¤ºå°±æ˜¯12 34 56 78 åœ¨å°ç«¯åºå†…å­˜ä¸­çš„è¡¨ç¤ºå°±æ˜¯78 56 34 12ã€‚å¤§ç«¯åºï¼šç½‘ç»œå­—èŠ‚åºï¼Œäººç±»é˜…è¯»ä¹ æƒ¯åºåˆ—ã€‚é«˜å­—èŠ‚å­˜åœ¨ä½åœ°å€ã€‚å°ç«¯åºï¼šæœºå™¨å­˜å‚¨åºã€‚é«˜å­—èŠ‚é«˜åœ°å€ã€‚ winä¸‹vsæµ‹è¯•æ˜¯å°ç«¯åº æ‰“å°å‡ºæ•°æ®çš„äºŒè¿›åˆ¶æ•° 123456789101112131415161718192021222324252627#include &lt;iostream&gt; #include &lt;string&gt; #include &lt;bitset&gt; // C++11åŠä»¥åç‰ˆæœ¬å¯ç”¨ // ä½¿ç”¨bitsetï¼ˆC++11åŠä»¥åï¼‰ void printBinaryUsingBitset(int num) &#123; std::bitset&lt;32&gt; binary(num); // å‡è®¾intæ˜¯32ä½çš„ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ std::cout &lt;&lt; binary &lt;&lt; std::endl;&#125;// æ‰‹åŠ¨å®ç° void printBinaryManually(int num) &#123; std::string binaryStr = &quot;&quot;; for (int i = 31; i &gt;= 0; --i) &#123; // å‡è®¾intæ˜¯32ä½çš„ å¾€å³ç§»31ä¸ªå°±æ˜¯å·¦è¾¹æ•°ç¬¬ä¸€ä¸ªbitçš„å€¼ binaryStr += (num &gt;&gt; i) &amp; 1 ? &#x27;1&#x27; : &#x27;0&#x27;; &#125; std::cout &lt;&lt; binaryStr &lt;&lt; std::endl;&#125;int main() &#123; int num = -2; // ç¤ºä¾‹æ•°å­— // ä½¿ç”¨bitset std::cout &lt;&lt; &quot;Using bitset: &quot;; printBinaryUsingBitset(num); // æ‰‹åŠ¨å®ç° std::cout &lt;&lt; &quot;Manually: &quot;; printBinaryManually(num); return 0;&#125; vsæ‰“æ–­ç‚¹-è°ƒè¯•-çª—å£-å†…å­˜-å†…å­˜1 å°†æŒ‡é’ˆçš„åœ°å€å€¼å¤åˆ¶åˆ°çª—å£å›è½¦æŸ¥æ‰¾ï¼Œé»˜è®¤æ˜¯ä»¥16è¿›åˆ¶å­˜å‚¨-16è¿›åˆ¶è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚å°±æ˜¯ä¸¤ä½æ•° è¿™é‡Œè¡¨ç¤ºçš„æ˜¯-2 å‰é¢å››ä¸ªfe ff ff ffå°±æ˜¯å…¶å†…å­˜è¡¨ç¤ºfe ff ff ffç”±äºå°ç«¯åº 0xfffffffeçš„æœ€ä½æœ‰æ•ˆå­—èŠ‚feæ”¾åˆ°å†…å­˜çš„åœ°ä½12345678çš„16è¿›åˆ¶æ˜¯0x00bc614eä½†æ˜¯ç”±äºå°ç«¯åºæ‰€ä»¥å†…å­˜æ˜¯ 4e 61 bc 00å£°æ˜æˆlong longåˆ™æ˜¯8å­—èŠ‚ 4e 61 bc 00 00 00 00 00 char b[5] &#x3D; {â€˜aâ€™,â€™bâ€™,â€™\\0â€™}; char* a &#x3D; b; charæ¯ä¸ªå ä¸€ä¸ªå­—èŠ‚é€šè¿‡açœ‹bçš„åœ°å€61 62 00 00 0061 62 æ˜¯16è¿›åˆ¶å¯¹åº”çš„ascllç¼–ç  ç¼–ç char a[] &#x3D; u8â€ä½ â€; ä½¿ç”¨utf-8åˆ™å†…å­˜ e4 bd a0 00 coutè¾“å‡ºä¹±ç char a[] &#x3D; â€œä½ â€; c4 e3 00 coutè¾“å‡ºæ­£å¸¸çœ‹çœ‹VSçš„ç¼–ç è®¾ç½®-å¯ä»¥ç›´æ¥æœé«˜çº§ä¿å­˜é€‰é¡¹æˆ–è€…çœ‹æ”»ç•¥https://blog.csdn.net/qq_41868108/article/details/105750175æˆ‘ç°åœ¨çš„ç¼–ç æ˜¯ ç®€ä½“ä¸­æ–‡(GB2312)-ä»£ç é¡µ936æ”¹æˆUnicode(UTF-8 å¸¦ç­¾å)-ä»£ç é¡µ 65001 ä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æˆ‘æ”¹å®Œæ²¡æœ‰åŒºåˆ« è¾“å‡ºascll-charcout&lt;&lt;int(â€˜aâ€™); cout&lt;&lt;int(â€˜4â€™); è¾“å‡ºascllç  charè½¬åŒ–ä¸ºintæ˜¯è½¬åŒ–ä¸ºascll è¾“å‡ºchar(â€˜3â€™)ä¼šè¾“å‡º3æœ¬èº« å¦‚ä½•é¿å…è½¬åŒ–ä¸ºascllï¼šint(â€˜3â€™-â€˜0â€™) int-&gt;char 65-&gt;A æœ‰æ•ˆä½12double num = 3.1415926; std::cout &lt;&lt; std::setprecision(4) &lt;&lt; num &lt;&lt; std::endl; // è®¾ç½®è¾“å‡ºçš„æœ‰æ•ˆæ•°å­—ä½æ•°ä¸º 4 æŒ‡é’ˆ &amp; * constint a;int* n&#x3D;&a; &amp;å–åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆ næ˜¯açš„åœ°å€ *n(è§£å¼•ç”¨)å°±æ˜¯a*n&#x3D;c; æ”¹å˜açš„å€¼n&#x3D;&amp;c æ”¹å˜æŒ‡å‘çš„åœ°å€int&amp; ref &#x3D; x; &amp;å¼•ç”¨ ä¸¤è€…åœ°å€ç›¸åŒï¼Œåªæ˜¯æœ‰ä¸ªä»£å· å·¦å€¼ æœ‰æŒä¹…çŠ¶æ€ï¼Œå¯ä»¥è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å·¦å€¼å¯ä»¥è¢«èµ‹å€¼æˆ–å–åœ°å€å³å€¼ ä¸´æ—¶çš„ã€éæŒä¹…çš„å€¼ï¼Œä¾‹å¦‚ä¸´æ—¶å¯¹è±¡ã€å‡½æ•°è¿”å›çš„å€¼ï¼ˆé™¤éæ˜ç¡®æŒ‡å®šä¸ºè¿”å›å¼•ç”¨ï¼‰ã€å­—é¢é‡ç­‰ã€‚å³å€¼ä¸èƒ½ä½œä¸ºéå¸¸é‡å¼•ç”¨çš„ç›®æ ‡ã€‚int&amp; r &#x3D; 5; &#x2F;&#x2F; é”™è¯¯ï¼Œ5 æ˜¯å³å€¼ æˆ–è€…å‡½æ•°è¿”å›æ˜¯int&amp; ä¸èƒ½ç›´æ¥è¿”å›ä¸€ä¸ªéå¼•ç”¨çš„intç±»å‹const int&amp; r &#x3D; 5; &#x2F;&#x2F; æ­£ç¡®ï¼Œä½¿ç”¨ const å¼•ç”¨å¯ä»¥æ¥å—å³å€¼ æŒ‡é’ˆå‡½æ•°-å‡½æ•°æŒ‡é’ˆæŒ‡é’ˆå‡½æ•°-æ˜¯å‡½æ•°-è¿”å›å€¼æ˜¯æŒ‡é’ˆç±»å‹ï¼ˆåœ°å€ï¼‰å‡½æ•°æŒ‡é’ˆ-æ˜¯æŒ‡é’ˆ-æŒ‡å‘å‡½æ•°æ‰€åœ¨åœ°å€çš„é¦–åœ°å€-å¯ä»¥ç”¨æ¥è°ƒç”¨å‡½æ•° å‡½æ•°æŒ‡é’ˆå£°æ˜æ–¹å¼ï¼š æ¯”å¦‚æœ‰ä¸€ä¸ªå‡½æ•°int max(int a, int b) int(*f)(int, int); f&#x3D;max æˆ–è€… f&#x3D;&amp;max int(*f)(int, int)&#x3D;max; æˆ–è€… &#x3D;&amp;max ä½¿ç”¨æ–¹å¼ï¼š (*f)(1, 2) f(1, 2) ä½œä¸ºå‚æ•°å€¼ 123int calculate(int (*operation)(int, int), int a, int b) &#123; return operation(a, b);&#125; switch123456789switch(è¡¨è¾¾å¼) &#123; case å¸¸é‡è¡¨è¾¾å¼1:è¯­å¥1; case å¸¸é‡è¡¨è¾¾å¼2:è¯­å¥2; case å¸¸é‡è¡¨è¾¾å¼3:è¯­å¥3; // â€¦ â€¦ case å¸¸é‡è¡¨è¾¾å¼n:è¯­å¥n; default:è¯­å¥n+1ï¼› &#125; å¾ªç¯è¾“å…¥get cin getlineè¯»å–æ•°æ®åªè¯»èƒ½è¯»çš„å¤šä½™çš„ä¼šç»§ç»­å­˜åœ¨ç¼“å†²åŒº operator&gt;&gt; æœ‰æ ¼å¼è¾“å…¥-é‡åˆ°ç©ºç™½ç¬¦æˆªè‡³(è·³è¿‡ç©ºç™½ç¬¦)-ä¼šæ»ç•™æ¢è¡Œç¬¦\\nï¼Œå¯ä»¥ä½¿ç”¨getè¯»å–è¿™ä¸ªæ»ç•™çš„æ¢è¡Œç¬¦ get æ— æ ¼å¼è¾“å…¥-ä¸ä¼šè·³è¿‡ç©ºç™½å­—ç¬¦(ç©ºç™½ï¼Œå›è½¦ç­‰)ï¼Œè¯»å–ä¸€ä¸ªå­—ç¬¦ä¹‹åï¼Œä¿ç•™æ¢è¡Œç¬¦åœ¨è¾“å…¥é˜Ÿåˆ—&#x3D;cin.get() è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œè¿”å›intç±»å‹çš„ascllç å€¼ï¼Œå¦‚æœç”¨charæ¥æ”¶ä¼šéšå¼è½¬æ¢ä¸ºå¯¹åº”å­—ç¬¦cin.get(a) å°†è¯»å–çš„å­—ç¬¦ç›´æ¥å­˜å‚¨åˆ°char a æ‰€ä»¥intç±»å‹åªèƒ½ä½¿ç”¨&#x3D;cin.get()å­˜ascllç¼–ç ï¼Œè€Œcharç±»å‹éƒ½å¯ä»¥ä½¿ç”¨è¯»å–å¤±è´¥è®¾ç½®failbit(è¾“å…¥å‡ºé”™)å’Œeofbit(åˆ°è¾¾æœ«å°¾)ï¼Œcin.fail() cin.eof() ä¸ºçœŸ getline è¯»å…¥ä¸€è¡Œæ•°æ®ï¼Œä¼šä¸¢å¼ƒæ¢è¡Œç¬¦std::getline(std::cin, line); &#x2F;&#x2F;std::cinå¯ä»¥æ›¿æ¢ä¸ºæ–‡ä»¶æµstd::getline(std::cin, line, â€˜,â€™); &#x2F;&#x2F; ä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦è¯»å–int name[20]; cin.getline(name,20); &#x2F;&#x2F;è¯»å–ä¸€è¡Œåˆ°æ•°ç»„æŒ‡é’ˆï¼Œé‡åˆ°æ¢è¡Œç¬¦æˆ–è€…è¯»å…¥19ä¸ªå­—ç¬¦ååœæ­¢ï¼Œæœ€åä¸€ä¸ªä¸º\\0 operator&lt;&lt; æœ‰æ ¼å¼ put cout.put(ch); è¾“å‡ºå­—ç¬¦(å¦‚æœæ˜¯ascllç¼–ç ä¼šè½¬åŒ–ä¸ºå­—ç¬¦) æ— æ ¼å¼ ç»ˆæ­¢ !cin.fail() !cin.eof() ch!&#x3D;EOF éƒ½å¯ä»¥ ctrl+zç»ˆæ­¢ å¤±æ•ˆä½ getè¯»å–åˆ°ç©ºè¡Œ&#x2F;getlineé‡åˆ°è¾“å…¥å­—ç¬¦æ¯”åˆ†é…ç©ºé—´é•¿ä¼šè®¾ç½®å¤±æ•ˆä½ï¼Œæ¥ä¸‹æ¥çš„è¾“å…¥å°†ä¼šé˜»æ–­ï¼Œå¯ä»¥ç”¨cin.clear();æ¢å¤å¤±æ•ˆä½ å¾ªç¯è¯»å…¥å­—ç¬¦å»ºè®®ä½¿ç”¨ 123456789101112131415//èƒ½è¯»å–ç©ºç™½å­—ç¬¦ç‰ˆæœ¬int ch;//æˆ–chch=cin.get(); //ä¸ç”¨cin cinåªèƒ½è¯»æ•´æ•°ï¼Œå¹¶ä¸”ç”¨geté¿å…ä¸€æ¬¡è¯»å–å¤šä¸ªwhile(!cin.fail())&#123; cout.put(ch);//æ¢æˆcout è¾“å‡ºascllç  ch=cin.get();&#125;//ä¸è¯»å–ç©ºç™½å­—ç¬¦ç‰ˆæœ¬char ch;cin&gt;&gt;ch;while(!cin.eof())&#123; cout&lt;&lt;ch;//æˆ–cin.put(ch); cin&gt;&gt;ch;&#125;//ç»ˆæ­¢æ¡ä»¶å¯ä»¥å†™æˆch!=EOF ç”¨intå› ä¸ºintèƒ½æ­£ç¡®å¤„ç†EOFâ€˜-1â€™ å¾ªç¯è¯»å…¥å­—ç¬¦ä¸² isspace(ch) æ£€æŸ¥è¾“å…¥çš„å­—ç¬¦æ˜¯å¦ä½ç©º input.empty() æ£€æŸ¥stringæ˜¯å¦ä¸ºç©º input.clear(); æ¸…é™¤è¾“å…¥æµçš„é”™è¯¯æ ‡å¿— 1234567891011#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;int main() &#123; string s; cout &lt;&lt; &quot;è¯·è¾“å…¥å­—ç¬¦ä¸²ï¼ˆé‡åˆ°ç©ºç™½å­—ç¬¦æ—¶ä¼šå¾ªç¯ä¸€æ¬¡è¯»å…¥ï¼‰ï¼š\\n&quot;; while (cin &gt;&gt; s) &#123; // ä½¿ç”¨æµæ“ä½œç¬¦è‡ªåŠ¨å¤„ç†ç©ºç™½å­—ç¬¦ cout &lt;&lt; &quot;ä½ è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯: &quot; &lt;&lt; s &lt;&lt; std::endl; &#125; return 0;&#125; æšä¸¾enumå®šä¹‰ä¸€ç»„å‘½åçš„æ•´æ•°å¸¸é‡ï¼Œç”¨æšä¸¾ç±»å‹æ¥å£°æ˜å’Œä½¿ç”¨ã€‚å¤§å°é»˜è®¤ä¸º0 1 2æ‰‹åŠ¨èµ‹å€¼åä¸‹ä¸€ä½æ¯”å‰ä¸€ä½å¤§1 1234567891011121314151617181920enum Color &#123; RED = 10, GREEN, // æœªæŒ‡å®šå€¼ï¼Œé»˜è®¤æ¯”å‰ä¸€ä¸ªå¤§ 1ï¼Œå³ 11 BLUE = 20&#125;;int main()&#123; Color myColor=GREEN;&#125;//C++11å¼•å…¥äº†å¼ºç±»å‹æšä¸¾ï¼ˆenum classï¼‰ï¼Œå®ƒæä¾›äº†æ›´å¼ºçš„ç±»å‹å®‰å…¨å’Œä½œç”¨åŸŸç®¡ç†enum class Color&#123; RED, //0 GREEN, //1 BLUE //2&#125;;int main()&#123; Color myColor = Color::GREEN;&#125;//å¼ºç±»å‹æšä¸¾ä¸ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ•´æ•°// ä½¿ç”¨å¼ºç±»å‹æšä¸¾æ—¶ï¼Œéœ€è¦æ˜¾ç¤ºè½¬æ¢ä¸ºæ•´æ•°cout &lt;&lt; &quot;Green value: &quot; &lt;&lt; static_cast&lt;int&gt;(Color::GREEN); å®åœ¨ç¼–è¯‘å‰è¿›è¡Œä»£ç æ›¿æ¢æˆ–ç”Ÿæˆ å¯ä»¥ç”¨äºå®šä¹‰å¸¸é‡ã€å‡½æ•°æ ·å¼çš„ä»£ç ç‰‡æ®µï¼Œæˆ–è¿›è¡Œæ¡ä»¶ç¼–è¯‘ å®šä¹‰å¸¸é‡å€¼ #define PI 3.14159 åƒä½¿ç”¨å˜é‡ä¸€æ ·ä½¿ç”¨PI å®å‡½æ•° #define SQUARE(x) ((x) * (x)) cout&lt;&lt;â€5çš„å¹³æ–¹æ˜¯ï¼šâ€&lt;&lt;SQUARE(5)&lt;&lt;endl; åº”ç”¨ï¼š 12345678910111213141516171819202122232425262728#include &lt;iostream&gt;#define CC_SYNTHESIZE(varType, varName, funName)\\protected: varType varName;\\public: varType get##funName() const &#123; return varName; &#125;\\public: void set##funName(varType var)&#123; varName = var; &#125;#define CC_SUM(var1, var2) \\std::cout &lt;&lt; &quot;The sum of &quot; &lt;&lt; #var1 &lt;&lt; &quot; and &quot; &lt;&lt; #var2 &lt;&lt; &quot; is: &quot; &lt;&lt; var1 + var2 &lt;&lt; std::endl;#define PI 3.14159 //å®šä¹‰å¸¸é‡å€¼class MyClass &#123; CC_SYNTHESIZE(int, num1, Num1) CC_SYNTHESIZE(int, num2, Num2)public: MyClass(int n1, int n2) &#123; setNum1(n1); setNum2(n2); &#125; void printSumAndMax() &#123; CC_SUM(getNum1(), getNum2()); &#125;&#125;;int main() &#123; MyClass obj(10, 20); obj.printSumAndMax(); return 0;&#125; ## ç”¨äºè¿æ¥# ç”¨äºå°†å‚æ•°è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å¸¸é‡ï¼Œè¿™é‡Œè¢«æ›¿æ¢æˆgetNum1() æ¡ä»¶ç¼–è¯‘ #ifdef, #ifndef, #if, #elif, #else å’Œ #endif 123456789#include &lt;iostream&gt;#define DEBUGint main() &#123;#ifdef DEBUG std::cout &lt;&lt; &quot;Debug æ¨¡å¼å¼€å¯&quot; &lt;&lt; std::endl;#endif std::cout &lt;&lt; &quot;ç¨‹åºè¿è¡Œä¸­...&quot; &lt;&lt; std::endl; return 0;&#125; å®å±•å¼€ä¸å‚æ•° #define DOUBLE(x) x + x DOUBLE(1 + 2) å®é™…å±•å¼€ä¸º1 + 2 + 1 + 2 ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåº”è¯¥ç”¨æ‹¬å·åŒ…å›´å®å‚æ•°å’Œç»“æœï¼š #define DOUBLE(x) ((x) + (x)) å®ä¿æŠ¤ ç¡®ä¿å¤´æ–‡ä»¶å†…å®¹åªä¼šè¢«åŒ…å«ä¸€æ¬¡ 1234#ifndef MY_HEADER_H#define MY_HEADER_H// å¤´æ–‡ä»¶å†…å®¹#endif // MY_HEADER_H å†…è”å‡½æ•°ä¸å® ç”±äºå®æ²¡æœ‰ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œé€šå¸¸åœ¨ç°ä»£C++ä¸­ä½¿ç”¨ inlineå‡½æ•°ä»£æ›¿å®å‡½æ•° inline int square(int x) {return x * x;} ä¿®é¥°ç¬¦ç±»å‹åˆ«åtypedef usingç±»å‹åˆ«å å®šä¹‰ç±»å‹åˆ«åtypedef float fl; using dou &#x3D; double;typedef double wages,*n; wages&#x3D;double n&#x3D;double* NULL nullptrnullptrç±»å‹å®‰å…¨ ç±»å‹æ˜¯std::nullptr_t ä»£è¡¨ç©ºæŒ‡é’ˆNULL å®å®šä¹‰ é€šå¸¸å®šä¹‰ä¸º0ï¼Œä¸å…·å¤‡å®‰å…¨æ€§ï¼Œè¢«è§£é‡Šæˆæ•´æ•°æˆ–ç©ºæŒ‡é’ˆ ##volatile ä¿®é¥°å˜é‡ é˜»æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆæ¯”å¦‚è®¿é—®ä¼˜åŒ–çš„æ—¶å€™ï¼Œå°†å˜é‡çš„å€¼ç¼“å­˜åˆ°å¯„å­˜å™¨ï¼Œä½¿ç”¨ä¹‹åä¼šæ¯æ¬¡éƒ½ä»å†…å­˜ä¸­è¯»å–å€¼ï¼‰ å‘ŠçŸ¥ç¼–è¯‘å™¨å˜é‡å€¼å¯èƒ½æ„å¤–æ”¹å˜ ç”¨é€”ï¼šåœ¨ä¸€äº›å€¼éšæ—¶éƒ½å¯èƒ½ä¼šè¢«ä¿®æ”¹çš„ç¯å¢ƒï¼Œç¡®ä¿æ¯æ¬¡éƒ½è¯»å–æœ€æ–°çš„å€¼ è®¿é—®ç¡¬ä»¶å¯„å­˜å™¨ å¤šçº¿ç¨‹æˆ–ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ ä¿¡å·å¤„ç†ï¼Œä¸constä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿ç¨‹åºä¸ä¿®æ”¹ï¼Œä½†æ˜¯ç¨‹åºå¤–éƒ¨å¯ä»¥æ”¹å˜ æ•°ç»„ä¸€ç»´æ•°ç»„ int abc[3]&#x3D;{1,2,3}; åˆå§‹åŒ–å…ƒç´ å°‘äºæ€»ä¸ªæ•°æ—¶ï¼Œå…¶ä»–åˆå§‹åŒ–ä¸º0åˆå§‹åŒ–å…ƒç´ å°‘äºæ€»ä¸ªæ•°æ—¶ï¼Œå…¶ä»–åˆå§‹åŒ–ä¸º0 long total[100]&#x3D;{0}; å…¨éƒ¨å…ƒç´ ä¸º0int dfg[3];int g[]&#x3D;{2,3}; ä¼šè‡ªåŠ¨è®¡ç®—ä¸ªæ•°ï¼Œä½¿g[2] äºŒç»´æ•°ç»„ int b[2][3]{1,2,3}; &#x3D;&#x3D;c++11&#x3D;&#x3D; å¯çœç•¥ç­‰å·å¤§æ‹¬å·å†…ä¸å¸¦ä¸œè¥¿ æ‰€æœ‰å…ƒç´ ä¸º0 int a[4]{};åˆå§‹åŒ–ç¦æ­¢ç¼©çª„è½¬æ¢ int a[]{23,2.0} æµ®ç‚¹è½¬åŒ–ä¸ºæ•´å‹æ˜¯ç¼©çª„æ“ä½œæ–°å¢vector 123456789std::vector&lt;std::array&lt;int, 3&gt;&gt; vec;// åˆå§‹åŒ–æ–¹å¼ä¸€ï¼šé€ä¸ªæ·»åŠ å…ƒç´ std::array&lt;int, 3&gt; arr1 = &#123;1, 2, 3&#125;;vec.push_back(arr1);// åˆå§‹åŒ–æ–¹å¼äºŒï¼šä½¿ç”¨èŠ±æ‹¬å·ç›´æ¥æ·»åŠ vec.push_back(&#123;4, 5, 6&#125;);//è®¿é—®ï¼švec[0][1]: //for(auto i : vec) æ•°ç»„å…ƒç´ ä¸ªæ•°sizeof(nums) &#x2F; sizeof(int) &#x2F;&#x2F;sizeofè¿”å›çš„æ˜¯å­—èŠ‚æ•°std::size(nums) &#x2F;&#x2F;è¿”å›è¡Œæ•°ï¼Ÿ æ•°ç»„èµ‹å€¼æ•°ç»„åä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œæ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œä¸æ˜¯ä¸€ä¸ªå¯ä»¥èµ‹å€¼çš„å·¦å€¼ã€‚arrayå¯ä»¥ç”¨&#x3D; vector&lt;vector&gt;åˆå§‹åŒ–äºŒç»´æ•°ç»„ 1234567vector&lt;vector&lt;int&gt;&gt; fac(n, vector&lt;int&gt;(m, 0));vector&lt;vector&lt;int&gt;&gt; triangle(n, vector&lt;int&gt;());for (int i = 0; i &lt; triangle.size(); i++) &#123; triangle[i].resize(i + 1); //resizeæ”¹å˜å®¹å™¨å¤§å°ï¼Œæ¯è¡Œå¤§å°åŠ 1&#125; éå†äºŒç»´æ•°ç»„ 1234567for (int i = 0; i &lt; fac.size(); i++) for (int j = 0; j &lt; fac[i].size(); j++) cin &gt;&gt; fac[i][j];for(auto nums:fac)&#123; for(auto i:nums)&#123;&#125; &#125; å­—ç¬¦ä¸²åˆå§‹åŒ–cé£æ ¼ char dog[3]&#x3D;{â€˜aâ€™,â€™bâ€™,â€™\\0â€™}; â€˜\\0â€™ç¼–ç ä¸º0 char a[6]&#x3D;â€bullâ€; å­—ç¬¦ä¸²å¸¸é‡&#x2F;å­—ç¬¦ä¸²å­—é¢å€¼ éšå¼åŒ…å«ç©ºå­—ç¬¦ï¼Œè‡ªåŠ¨æ·»åŠ \\0 string #include è‡ªåŠ¨å¤„ç†å¤§å°std::string name {â€œtutuâ€};std::string name &#x3D; â€œtutuâ€;std::string name &#x3D; {â€œtutuâ€}; åŒºåˆ«å­—ç¬¦å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡â€˜Sâ€™åœ¨ASCLLä¸­åªæ˜¯83çš„å¦ä¸€ç§å†™æ³•ï¼Œchar a &#x3D; â€˜sâ€™; â€œSâ€è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦Så’Œ\\0ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå®é™…è¡¨ç¤ºçš„æ˜¯å­—ç¬¦ä¸²æ‰€åœ¨çš„åœ°å€ï¼Œchar a&#x3D;â€Sâ€; âŒ èµ‹å€¼ æ‹¼æ¥stringå¯ç›´æ¥ä½¿ç”¨+ &#x3D; å¯ä»¥ä½¿ç”¨strcpy(char*2,char*1) strcat 1æ¥åˆ°2å æ³¨æ„2é•¿åº¦è¦å¤Ÿå¤§ï¼Œstrncpy strncatç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å‡ºèƒ½æ¥å—çš„æœ€å¤§é•¿åº¦ è·å–é•¿åº¦**char ***strlen(a) åˆ°ç¬¬ä¸€ä¸ª\\n string.size() .length() åŸå§‹å­—ç¬¦ä¸²cout &lt;&lt; Râ€(acs\\n)â€&lt;&lt;â€™\\nâ€™&lt;&lt;â€azx\\nâ€; ç”¨Râ€( )â€ ç­‰æ•ˆ å‰é¢åŠ cout&lt;&lt;Râ€+*(â€œ(who)â€,she)+*â€œ; Râ€+*( )+*â€œ å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡çš„åŸºæœ¬å­—ç¬¦ strcmp strcmpint strcmp(const char *str1, const char *str2);æŒ‰ç…§ascllç é¡ºåºï¼ŒæŒ¨ä¸ªæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦ï¼Œç›´è‡³ç¬¬ä¸€ä¸ªä¸åŒçš„æˆ–åˆ°æœ«å°¾è¿”å›å€¼ï¼šå°äº0ï¼šä¸¤ä¸ªå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªä¸åŒçš„å­—ç¬¦çš„ascllç str1å°äºstr2ï¼Œæˆ–è€…å‰è€…æ˜¯åè€…çš„å­ä¸²ç­‰äº0ï¼šä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŒå¤§äº0 stringå¯ä»¥ç›´æ¥ä½¿ç”¨ç¬¦å·è¿›è¡Œæ¯”è¾ƒ å­—ç¬¦ä¸²æ’åºsorté»˜è®¤æ˜¯å‡åºæ’åºï¼Œå¦‚æœè¦é™åºæ’åºéœ€è¦æä¾›è‡ªå®šä¹‰å‡½æ•° 123456789101112131415161718192021222324252627//vetctor&lt;string&gt;ç±»å‹æ’åº//å‡åºstd::sort(words.begin(), words.end());//é™åºbool caseSensitiveCompare(const std::string&amp; a, const std::string&amp; b) &#123; return a &lt; b;&#125;std::sort(words.begin(), words.end()ï¼ŒcaseSensitiveCompare);//å¿½ç•¥å¤§å°å†™bool caseInsensitiveCompare(const std::string&amp; a, const std::string&amp; b) &#123; std::string lowerA = a, lowerB = b; std::transform(lowerA.begin(), lowerA.end(), lowerA.begin(), ::tolower); std::transform(lowerB.begin(), lowerB.end(), lowerB.begin(), ::tolower); return lowerA &lt; lowerB;&#125;//stringç±»å‹æ’åº//å‡åºstd::sort(str.begin(), str.end());//é™åºbool compareChars(const char&amp; a, const char&amp; b) &#123; return a &lt; b;&#125;std::sort(str.begin(), str.end(),compareChars);//æˆ–è€…ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°std::greater&lt;char&gt;()std::sort(str.begin(), str.end(), std::greater&lt;char&gt;()); æ¨¡æ¿ä¸å†…è”å‡½æ•°12345678910111213141516//æ¨¡æ¿ç±» åç»­åœ¨ç±»ä¸­ç”¨Tä»£æ›¿è¦ä½¿ç”¨çš„ç±»å‹template &lt;typename T&gt; //ä½¿ç”¨ï¼šStack&lt;int&gt; intStack;template &lt;class T&gt;;template &lt;typename T, int Size&gt; //ä½¿ç”¨ï¼šStack&lt;int,5&gt; intStack;class Stack &#123;&#125;//æ¨¡æ¿ç±»çš„ç‰¹åŒ–template &lt;typename T&gt;class MyClass &#123;&#125; template &lt;&gt; //MyClass&lt;int&gt;æ—¶ç‰¹æ®Šä½¿ç”¨class MyClass&lt;int&gt; &#123;&#125;//æ¨¡æ¿ç±»çš„å®šä¹‰å’Œå®ç°é»˜è®¤åœ¨åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆï¼Œè€Œä¸æ˜¯åŠ¨æ€ç»‘å®šçš„//æ¨¡æ¿ç±»çš„å‡½æ•°å®šä¹‰é»˜è®¤åœ¨å‡½æ•°å£°æ˜æ—¶å®ç°-å†…è”ï¼Œå¦‚æœåœ¨ç±»å¤–éƒ¨å®ç°éœ€è¦å¸¦ä¸Šæ¨¡æ¿å‚æ•°åˆ—è¡¨template &lt;typename T&gt;void MyTemplateClass&lt;T&gt;::func() &#123;&#125; å‡½æ•°æ¨¡æ¿ï¼š 12345678910template &lt;typename T&gt;void swapValues(T&amp; a, T&amp; b) &#123; T temp = a; a = b; b = temp;&#125;int num1 = 10, num2 = 20;swapValues(num1, num2); //å¯ä»¥æ ¹æ®numçš„ç±»å‹è‡ªåŠ¨åŒ¹é…swapValues&lt;int&gt;(num1, num2);//æˆ–è€…ä½¿ç”¨&lt;&gt; ä½¿ç”¨.hppæ–‡ä»¶ï¼ˆå£°æ˜å’Œå®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼‰ å¦‚ï¼šå†…è”å‡½æ•°ï¼Œæ¨¡æ¿ç±»æ¨¡æ¿å‡½æ•°ï¼Œå°å‹åº“ å†…è”å‡½æ•°åœ¨å‡½æ•°å£°æ˜å‰é¢åŠ inline åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼ŒæŠŠå‡½æ•°ä»£ç æ’å…¥åˆ°å‡½æ•°è°ƒç”¨å¤„-ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ‰€ä»¥å£°æ˜å’Œå®ç°è¦åœ¨ä¸€ä¸ªæ–‡ä»¶ å†…è”å‡½æ•°ä¸registerå˜é‡ç±»ä¼¼ï¼Œä»…ä»…æ˜¯æˆ‘ä»¬æç»™ç¼–è¯‘å™¨çš„ä¸€ä¸ªè¯·æ±‚ï¼Œæœ€ç»ˆæ˜¯å¦çœŸæ­£ä¼šå®ç°å†…è”ï¼Œç”±ç¼–è¯‘å™¨æ ¹æ®æƒ…å†µè‡ªè¡Œé€‰æ‹©ã€‚&#x2F;&#x2F;registerå£°æ˜å˜é‡ä¹‹å‰ï¼Œå»ºè®®ç¼–è¯‘å™¨å°†å˜é‡æ”¾å…¥å¯„å­˜å™¨ å†…å­˜allocaç”¨äºåœ¨æ ˆä¸Šç”³è¯·ç©ºé—´ï¼Œç¦»å¼€ä½œç”¨åŸŸä¼šè‡ªåŠ¨é‡Šæ”¾ 12void *alloca(size_t size);int *arr = (int *)alloca(n * sizeof(int)); é“¾æ¥ é™æ€é“¾æ¥ï¼šåœ¨ç¼–è¯‘æœŸå°†åº“æ–‡ä»¶çš„æ‰€æœ‰ä»£ç åµŒå…¥åˆ°æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä½“ç§¯å¤§ï¼Œå¿« ï¼ˆ.a .libï¼‰ åŠ¨æ€é“¾æ¥ï¼šåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å†é“¾æ¥ï¼ˆ.so .dllï¼‰ï¼Œä½“ç§¯å°ï¼Œæ…¢ I&#x2F;Oç±»(å¾…çœ‹)æœ‰ä¸‰ä¸ªå…³äºI&#x2F;Oç±»çš„å¤´æ–‡ä»¶ IOå¯¹è±¡ä¸èƒ½æ‹·è´èµ‹å€¼,ä¸èƒ½æ˜¯const,è¯»å†™ä¼šæ”¹å˜çŠ¶æ€ C++ Effectiveç±»å‹ constexpr int p &#x3D; 1; å¸¸é‡è¡¨è¾¾å¼è¿›è¡Œåˆå§‹åŒ– constexpr int *p&#x3D;nullptr; constexprä¿®é¥°é¡¶å±‚ constä¿®é¥°åº•å±‚ constexpr const *p&#x3D;&i; constexpr:ä¸€ç›´æŒ‡å‘iï¼Œconstï¼šæŒ‡å‘çš„å€¼ä¸è¢«ä¿®æ”¹ ç¼–è¯‘æ—¶æœŸå°±éœ€è¦èƒ½å¤Ÿç¡®å®šå…¶å€¼ constexprç”¨äºä¿®é¥°å‡½æ•°æ—¶,ä¸€èˆ¬åªæœ‰ä¸€æ¡returnè¯­å¥,ç”¨äºæ„é€ å‡½æ•°ä¸­ä»€ä¹ˆéƒ½ä¸ç”¨æœ‰ #å¼‚å¸¸å¤„ç† åŸºç¡€ 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;iostream&gt;using namespace std;// è‡ªå®šä¹‰å¼‚å¸¸ç±»class MyException : public exception &#123;public: const char* what() const throw () &#123; return &quot;è‡ªå®šä¹‰å¼‚å¸¸å‘ç”Ÿ&quot;; &#125;&#125;;// æŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°double division(int a, int b) &#123; if (b == 0) &#123; throw &quot;é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;; // æŠ›å‡ºå­—ç¬¦ä¸²ç±»å‹çš„å¼‚å¸¸ &#125; return (a / b);&#125;int main() &#123; int x = 50; int y = 1; double z = 0; try &#123; z = division(x, y); cout &lt;&lt; z &lt;&lt; endl; &#125; catch (const char* msg) &#123; cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; msg &lt;&lt; endl; &#125; catch (MyException&amp; e) &#123; // æ•è·è‡ªå®šä¹‰å¼‚å¸¸ cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; endl; &#125; return 0;&#125; åµŒå¥—å¼‚å¸¸ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;iostream&gt;#include &lt;stdexcept&gt;#include &lt;exception&gt;// è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œç»§æ‰¿è‡ªstd::exceptionclass MyException : public std::exception &#123;public: const char* what() const noexcept override &#123; return &quot;MyExceptionå‘ç”Ÿ&quot;; &#125;&#125;;// å¦ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œç”¨äºåµŒå¥—å¼‚å¸¸class MyNestedException : public std::exception &#123;private: std::nested_exception nested;public: MyNestedException() : nested() &#123;&#125; void rethrow_nested() const &#123; if (nested) nested.rethrow_nested(); &#125; const char* what() const noexcept override &#123; return &quot;MyNestedExceptionå‘ç”Ÿï¼ŒåŒ…å«åµŒå¥—å¼‚å¸¸&quot;; &#125;&#125;;// æŠ›å‡ºåµŒå¥—å¼‚å¸¸çš„å‡½æ•°void throwNestedException() &#123; try &#123; throw MyException(); &#125; catch (...) &#123; std::throw_with_nested(MyNestedException()); &#125;&#125;int main() &#123; try &#123; throwNestedException(); &#125; catch (const MyNestedException&amp; e) &#123; std::cout &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; std::endl; try &#123; e.rethrow_nested(); &#125; catch (const MyException&amp; e) &#123; std::cout &lt;&lt; &quot;æ•è·åˆ°åµŒå¥—å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; std::endl; &#125; catch (...) &#123; std::cout &lt;&lt; &quot;æœªçŸ¥å¼‚å¸¸&quot; &lt;&lt; std::endl; &#125; &#125; catch (...) &#123; std::cout &lt;&lt; &quot;æœªçŸ¥å¼‚å¸¸&quot; &lt;&lt; std::endl; &#125; return 0;&#125; ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†èµ„æº RAII 123456789101112131415161718192021222324252627282930#include &lt;iostream&gt;#include &lt;memory&gt;class Resource &#123;public: Resource() &#123; std::cout &lt;&lt; &quot;èµ„æºè¢«åˆ›å»º\\n&quot;; &#125; ~Resource() &#123; std::cout &lt;&lt; &quot;èµ„æºè¢«é”€æ¯\\n&quot;; &#125;&#125;;void processResource() &#123; // ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†èµ„æº std::unique_ptr&lt;Resource&gt; ptr(new Resource()); // è¿™é‡Œæ‰§è¡Œä¸€äº›æ“ä½œ... throw std::runtime_error(&quot;åœ¨å¤„ç†èµ„æºæ—¶å‘ç”Ÿå¼‚å¸¸&quot;); // æ™ºèƒ½æŒ‡é’ˆä¼šåœ¨å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æº&#125;int main() &#123; try &#123; processResource(); &#125; catch (const std::exception&amp; e) &#123; std::cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; // å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œèµ„æºä¹Ÿä¼šè¢«æ­£ç¡®é‡Šæ”¾ return 0;&#125; noexcept 1234567891011121314151617181920212223242526272829303132333435#include &lt;iostream&gt;#include &lt;vector&gt;// noexceptå…³é”®å­—æŒ‡å®šå‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸void noThrowFunction() noexcept &#123; std::cout &lt;&lt; &quot;è¿™ä¸ªå‡½æ•°ä¿è¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚\\n&quot;;&#125;// è¿™ä¸ªå‡½æ•°å¯èƒ½æŠ›å‡ºå¼‚å¸¸void mayThrowFunction() &#123; throw std::runtime_error(&quot;å‘ç”Ÿäº†ä¸€ä¸ªå¼‚å¸¸ï¼&quot;);&#125;// noexcept(false)æŒ‡å®šå‡½æ•°å¯èƒ½æŠ›å‡ºå¼‚å¸¸void mayThrowFunctionWithNoexcept(false) noexcept(false) &#123; throw std::runtime_error(&quot;è¿™ä¸ªå‡½æ•°å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼&quot;);&#125;int main() &#123; try &#123; noThrowFunction(); mayThrowFunction(); // è¿™é‡Œä¼šæŠ›å‡ºå¼‚å¸¸ &#125; catch (const std::exception&amp; e) &#123; std::cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; try &#123; mayThrowFunctionWithNoexcept(); &#125; catch (const std::exception&amp; e) &#123; std::cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; return 0;&#125; å¼‚å¸¸çš„ä¼ æ’­å’Œå †æ ˆå±•å¼€ 123456789101112131415161718192021222324252627282930313233343536#include &lt;iostream&gt;#include &lt;stdexcept&gt;// åŸºç¡€èµ„æºç±»class Resource &#123;public: Resource() &#123; std::cout &lt;&lt; &quot;èµ„æºè¢«åˆ›å»º\\n&quot;; &#125; ~Resource() &#123; std::cout &lt;&lt; &quot;èµ„æºè¢«é”€æ¯\\n&quot;; &#125;&#125;;// ä½¿ç”¨èµ„æºçš„å‡½æ•°void useResource() &#123; Resource res; // å±€éƒ¨èµ„æº std::cout &lt;&lt; &quot;ä½¿ç”¨èµ„æº\\n&quot;; throw std::runtime_error(&quot;å‘ç”Ÿå¼‚å¸¸ï¼Œèµ„æºå°†è¢«æ¸…ç†&quot;);&#125;// è°ƒç”¨ä½¿ç”¨èµ„æºçš„å‡½æ•°void callUseResource() &#123; try &#123; useResource(); &#125; catch (const std::exception&amp; e) &#123; std::cerr &lt;&lt; &quot;å¼‚å¸¸è¢«æ•è·: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; throw; // é‡æ–°æŠ›å‡ºå¼‚å¸¸ &#125;&#125;int main() &#123; try &#123; callUseResource(); &#125; catch (const std::exception&amp; e) &#123; std::cerr &lt;&lt; &quot;å¼‚å¸¸åœ¨mainä¸­è¢«æ•è·: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; return 0;&#125; å¼‚å¸¸é“¾å’Œå¼‚å¸¸ä¼ æ’­ 12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt;#include &lt;stdexcept&gt;// è‡ªå®šä¹‰å¼‚å¸¸ç±»class CustomException : public std::runtime_error &#123;public: CustomException(const std::string&amp; msg) : std::runtime_error(msg) &#123;&#125;&#125;;// ç¬¬ä¸€å±‚å‡½æ•°ï¼Œå¯èƒ½æŠ›å‡ºå¼‚å¸¸void functionLevel1() &#123; throw CustomException(&quot;ä»functionLevel1æŠ›å‡ºçš„å¼‚å¸¸&quot;);&#125;// ç¬¬äºŒå±‚å‡½æ•°ï¼Œè°ƒç”¨ç¬¬ä¸€å±‚å‡½æ•°void functionLevel2() &#123; try &#123; functionLevel1(); &#125; catch(const CustomException&amp; e) &#123; std::cerr &lt;&lt; &quot;åœ¨functionLevel2æ•è·å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; throw; // é‡æ–°æŠ›å‡ºå¼‚å¸¸ &#125;&#125;// ä¸»å‡½æ•°int main() &#123; try &#123; functionLevel2(); &#125; catch(const CustomException&amp; e) &#123; std::cerr &lt;&lt; &quot;åœ¨mainæ•è·å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; return 0;&#125; è‡ªå®šä¹‰å¼‚å¸¸ç±» 12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt;#include &lt;exception&gt;// è‡ªå®šä¹‰å¼‚å¸¸ç±»class MyException : public std::exception &#123;private: std::string message;public: MyException(const std::string&amp; msg) : message(msg) &#123;&#125; const char* what() const noexcept override &#123; return message.c_str(); &#125;&#125;;// å¯èƒ½æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸çš„å‡½æ•°void riskyFunction(int value) &#123; if (value &lt; 0) &#123; throw MyException(&quot;è´Ÿå€¼é”™è¯¯ï¼šå‡½æ•°åªæ¥å—éè´Ÿæ•´æ•°&quot;); &#125; // æ­£å¸¸å¤„ç†æµç¨‹ std::cout &lt;&lt; &quot;è¾“å…¥å€¼ä¸º: &quot; &lt;&lt; value &lt;&lt; std::endl;&#125;int main() &#123; try &#123; riskyFunction(-1); // è¿™å°†æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ &#125; catch (const MyException&amp; e) &#123; std::cerr &lt;&lt; &quot;æ•è·åˆ°å¼‚å¸¸: &quot; &lt;&lt; e.what() &lt;&lt; &#x27;\\n&#x27;; &#125; catch (...) &#123; std::cerr &lt;&lt; &quot;æ•è·åˆ°æœªçŸ¥å¼‚å¸¸\\n&quot;; &#125; return 0;&#125; RTTI ç±»å‹ä¿¡æ¯è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ã€‚å®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶ç¡®å®šå¯¹è±¡çš„ç±»å‹ã€‚RTTI ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ï¼štypeid è¿ç®—ç¬¦å’Œ dynamic_cast è¿ç®—ç¬¦ã€‚ typeid è·å–è¡¨è¾¾å¼çš„ç±»å‹ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ª const std::type_info&amp; å¼•ç”¨å¿…é¡»æœ‰è™šå‡½æ•°ï¼Œæ‰èƒ½æ”¯æŒè¿è¡Œæ—¶ç±»å‹è¯†åˆ« 123Base* basePtr = new Derived();const std::type_info&amp; typeInfo = typeid(*basePtr); std::cout &lt;&lt; &quot;Type name: &quot; &lt;&lt; typeInfo.name() &lt;&lt; std::endl; dynamic_cast ç”¨äºåœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­è¿›è¡Œå®‰å…¨çš„å‘ä¸‹è½¬å‹ï¼ˆå°†åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨è½¬æ¢ä¸ºæ´¾ç”Ÿç±»æŒ‡é’ˆæˆ–å¼•ç”¨ï¼‰ã€‚å¦‚æœè½¬æ¢æˆåŠŸï¼Œè¿”å›ç›®æ ‡ç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼›å¦‚æœè½¬æ¢å¤±è´¥ï¼Œå¯¹äºæŒ‡é’ˆç±»å‹è¿”å› nullptrï¼Œå¯¹äºå¼•ç”¨ç±»å‹æŠ›å‡º std::bad_cast å¼‚å¸¸ã€‚ 123Base* basePtr = new Derived();Derived* derivedPtr = dynamic_cast&lt;Derived*&gt;(basePtr);if (derivedPtr) å››å¤§ç±»å‹çš„è½¬æ¢static_cast ä¸»è¦ç”¨äºç¼–è¯‘æ—¶çš„ç±»å‹è½¬æ¢ï¼Œå³åœ¨ç¼–è¯‘æ—¶ç¡®å®šè½¬æ¢çš„ç±»å‹ã€‚ å¯ä»¥ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œä»¥åŠéå¤šæ€ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚ è¿˜å¯ä»¥ç”¨äºå‘ä¸Šè½¬æ¢å’Œå‘ä¸‹è½¬æ¢ï¼Œä½†ä¸è¿›è¡Œè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼Œå› æ­¤å‘ä¸‹è½¬æ¢æ—¶éœ€è¦æ³¨æ„å®‰å…¨æ€§ã€‚ 12int i = 10;double d = static_cast&lt;double&gt;(i); // å°†æ•´æ•°è½¬æ¢ä¸ºæµ®ç‚¹æ•° const_cast ä¸»è¦ç”¨äºå»é™¤å¸¸é‡æ€§ï¼ˆconstï¼‰æˆ–å¢åŠ å¸¸é‡æ€§ï¼ˆconstï¼‰ã€‚ ç”¨äºä¿®æ”¹å¯¹è±¡çš„å¸¸é‡å±æ€§ï¼Œä½†éœ€è¦è°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚ 123const int i = 10;int* ptr = const_cast&lt;int*&gt;(&amp;i); // å»é™¤å¸¸é‡æ€§*ptr = 20; // æ­¤æ—¶å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º dynamic_cast reinterpret_cast ä¸»è¦ç”¨äºä½çº§ç±»å‹è½¬æ¢ï¼Œå°†ä¸€ä¸ªæŒ‡é’ˆè½¬æ¢ä¸ºå¦ä¸€ç§æŒ‡é’ˆç±»å‹ï¼Œæˆ–å°†æŒ‡é’ˆè½¬æ¢ä¸ºæ•´æ•°ç±»å‹ï¼Œåä¹‹äº¦ç„¶ã€‚ ä¸è¿›è¡Œä»»ä½•ç±»å‹æ£€æŸ¥æˆ–è°ƒç”¨æ„é€ å‡½æ•°&#x2F;ææ„å‡½æ•°ï¼Œå› æ­¤é£é™©è¾ƒé«˜ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚ 1int* p = reinterpret_cast&lt;int*&gt;(0x12345678); // å°†åœ°å€è½¬æ¢ä¸ºæŒ‡é’ˆ è‡ªåŠ¨æ¨å¯¼ç±»å‹autoautoä¼šå¿½ç•¥å¼•ç”¨å±æ€§ï¼Œéœ€è¦æ‰‹åŠ¨ä½¿ç”¨auto&amp; 123456const int c=8;auto a=c; //aè¢«æ¨åˆ°ä¸ºintï¼Œé¡¶å±‚constä¼šè¢«å¿½ç•¥(å˜é‡æœ¬èº«æ˜¯å¸¸é‡)auto b=&amp;c; //bè¢«æ¨åˆ°ä¸ºconst int*ï¼Œåº•å±‚çš„constä¸ä¼šè¢«å¿½ç•¥(æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æ˜¯å¸¸é‡)auto &amp;c=a; //auto &amp;æ—¶ï¼Œé¡¶å±‚constä¸ä¼šè¢«å¿½ç•¥ï¼Œè¿™é‡Œaæ˜¯intï¼Œcæ˜¯int &amp;auto &amp;d = 42; //é”™è¯¯ï¼Œä¸èƒ½ç»‘å®šåˆ°æ™®é€šå¼•ç”¨ï¼Œæ™®é€šå¼•ç”¨å¿…é¡»ç»‘å®šåˆ°ä¸€ä¸ªå·¦å€¼const auto &amp;d = 42; //ä½¿ç”¨constå¼•ç”¨æ—¶ä¼šä¸´æ—¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡ç»‘å®šç»™d decltypeç±»å‹è¯´æ˜ç¬¦1234567891011121314//æ¨å¯¼å˜é‡ç±»å‹const int x = 10;decltype(x) y = 20; //æ¨å¯¼å‡½æ•°è¿”å›å€¼ç±»å‹int func() &#123; return 42;&#125;decltype(func()) result;//æ¨å¯¼å·¦å€¼è¡¨è¾¾å¼ä¸ºå¼•ç”¨ç±»å‹int arr[5] = &#123;1, 2, 3, 4, 5&#125;;decltype(arr[0]) ref = arr[0]; // ref çš„ç±»å‹æ˜¯ int&amp;ï¼Œå› ä¸º arr[0] æ˜¯å·¦å€¼//æ¨å¯¼å³å€¼ä¸ºæ™®é€šç±»å‹int a = 5, b = 3;decltype(a + b) sum;//a+bæ˜¯å³å€¼ ç©ºé—´ä¸å †æ ˆå†…å­˜å¯¹é½ä¸€ä¸ª4å­—èŠ‚(32ä½)ç³»ç»Ÿä¸­éƒ½æŒ‰4å­—èŠ‚è¾¹ç•Œå¯¹é½ï¼Œåœ°å€æ˜¯4çš„å€æ•° åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œalignas(16) è¡¨ç¤º MyData ç»“æ„ä½“çš„å¯¹é½æ–¹å¼ä¸º 16 å­—èŠ‚ã€‚ä½¿ç”¨ alignof(MyData) å¯ä»¥è·å– MyData ç»“æ„ä½“çš„å¯¹é½è¦æ±‚ 123456789101112#include &lt;iostream&gt;struct alignas(16) MyData &#123; int x; double y;&#125;;int main() &#123; std::cout &lt;&lt; &quot;Alignment of MyData: &quot; &lt;&lt; alignof(MyData) &lt;&lt; std::endl; return 0;&#125; newå’ŒdeleteåŸç†new å’Œ delete æ˜¯ C++ ä¸­ç”¨äºåŠ¨æ€å†…å­˜ç®¡ç†çš„å…³é”®å­—ï¼Œå®ƒä»¬ç”¨äºåœ¨å †ï¼ˆheapï¼‰ä¸Šåˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„å·¥ä½œåŸç†ï¼š new æ“ä½œç¬¦ï¼š å½“ç¨‹åºæ‰§è¡Œ new æ“ä½œç¬¦æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨ä¸€ä¸ªç”¨äºåˆ†é…å†…å­˜çš„å‡½æ•°ï¼ˆä¾‹å¦‚ operator newï¼‰ï¼Œè¯¥å‡½æ•°è´Ÿè´£ä»å †ä¸­åˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨å¯¹è±¡ã€‚ new æ“ä½œç¬¦æ¥æ”¶ç±»å‹çš„å¤§å°ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ†é…è¶³å¤Ÿçš„å†…å­˜ä»¥å­˜å‚¨è¯¥ç±»å‹çš„å¯¹è±¡ã€‚å¦‚æœå†…å­˜åˆ†é…å¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡º std::bad_alloc å¼‚å¸¸ã€‚ åˆ†é…çš„å†…å­˜è¶³å¤Ÿå®¹çº³å¯¹è±¡åï¼Œæ„é€ å‡½æ•°è¢«è°ƒç”¨ä»¥åˆå§‹åŒ–å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æœ‰æ„é€ å‡½æ•°ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒæ¥å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ã€‚ new æ“ä½œç¬¦è¿”å›æŒ‡å‘æ–°åˆ†é…å†…å­˜çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆçš„ç±»å‹ä¸æ‰€åˆ†é…å¯¹è±¡çš„ç±»å‹ç›¸åŒ¹é…ã€‚ 1int* p = new int; // åˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨ä¸€ä¸ª int å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ int ç±»çš„æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ– delete æ“ä½œç¬¦ï¼š å½“ç¨‹åºæ‰§è¡Œ delete æ“ä½œç¬¦æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨ä¸€ä¸ªç”¨äºé‡Šæ”¾å†…å­˜çš„å‡½æ•°ï¼ˆä¾‹å¦‚ operator deleteï¼‰ï¼Œè¯¥å‡½æ•°è´Ÿè´£é‡Šæ”¾ä¹‹å‰åˆ†é…çš„å†…å­˜ã€‚ delete æ“ä½œç¬¦æ¥æ”¶æŒ‡å‘åŠ¨æ€åˆ†é…å†…å­˜çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œç„¶åé‡Šæ”¾è¯¥æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜ã€‚è¿™æ„å‘³ç€å®ƒä¼šé”€æ¯å¯¹è±¡ï¼Œå¹¶é‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚ åœ¨é”€æ¯å¯¹è±¡ä¹‹å‰ï¼Œææ„å‡½æ•°è¢«è°ƒç”¨ä»¥æ¸…ç†å¯¹è±¡çš„èµ„æºã€‚å¦‚æœå¯¹è±¡æœ‰ææ„å‡½æ•°ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒæ¥å®Œæˆå¯¹è±¡çš„æ¸…ç†å·¥ä½œã€‚ ä½¿ç”¨ delete æ“ä½œç¬¦é‡Šæ”¾çš„å†…å­˜å°†ä¼šè¿”å›ç»™å †ï¼Œä»¥ä¾¿ä¾›åç»­çš„å†…å­˜åˆ†é…ä½¿ç”¨ã€‚ 12int* p = new int; // åˆ†é…å†…å­˜delete p; // é‡Šæ”¾å†…å­˜ æ€»çš„æ¥è¯´ï¼Œnew å’Œ delete å…³é”®å­—æä¾›äº† C++ ä¸­åŠ¨æ€å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„æœºåˆ¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨å †ä¸Šåˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼Œä½†éœ€è¦æ³¨æ„é¿å…å†…å­˜æ³„æ¼å’Œæ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ã€‚åœ¨ç°ä»£ C++ ä¸­ï¼Œæ¨èä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚ std::unique_ptrã€std::shared_ptrï¼‰æ¥ç®¡ç†åŠ¨æ€å†…å­˜ï¼Œä»¥å‡å°‘æ‰‹åŠ¨å†…å­˜ç®¡ç†å¸¦æ¥çš„é£é™©ã€‚ ##delete[] delete[] ä¸ delete çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œdelete ç”¨äºé‡Šæ”¾å•ä¸ªå¯¹è±¡åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œè€Œ delete[] ç”¨äºé‡Šæ”¾åŠ¨æ€æ•°ç»„åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚ æ‰¾åˆ°æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼šåœ¨ C++ ä¸­ï¼Œnew[] ä¼šåœ¨åˆ†é…å†…å­˜æ—¶å­˜å‚¨æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚å› æ­¤ï¼Œdelete[] é¦–å…ˆéœ€è¦æ‰¾åˆ°æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼Œä»¥ä¾¿æ­£ç¡®åœ°é‡Šæ”¾æ¯ä¸ªå…ƒç´ æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ é‡Šæ”¾æ•°ç»„å…ƒç´ çš„å†…å­˜ç©ºé—´ï¼šdelete[] å°†éå†æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è°ƒç”¨å…¶ææ„å‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åé‡Šæ”¾æ¯ä¸ªå…ƒç´ æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚è¿™ç¡®ä¿äº†åŠ¨æ€æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¾—åˆ°äº†æ­£ç¡®çš„æ¸…ç†å’Œé‡Šæ”¾ã€‚ é‡Šæ”¾æ•°ç»„çš„å†…å­˜ç©ºé—´ï¼šæœ€åï¼Œdelete[] ä¼šé‡Šæ”¾æ•´ä¸ªåŠ¨æ€æ•°ç»„æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå³é‡Šæ”¾æ•°ç»„çš„èµ·å§‹åœ°å€ã€‚ 12345678910111213141516#include &lt;iostream&gt;int main() &#123; // ä½¿ç”¨ new[] åˆ†é…ä¸€ä¸ªåŒ…å« 5 ä¸ªæ•´æ•°çš„åŠ¨æ€æ•°ç»„ int* array = new int[5]; // å¯¹æ•°ç»„è¿›è¡Œèµ‹å€¼ for (int i = 0; i &lt; 5; ++i) &#123; array[i] = i; &#125; // ä½¿ç”¨ delete[] é‡Šæ”¾åŠ¨æ€æ•°ç»„çš„å†…å­˜ delete[] array; return 0;&#125; å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹è¿›ç¨‹é—´é€šä¿¡IPCç®¡é“pipeï¼ŒåŠåŒå·¥(å•æ–¹å‘)ï¼Œåªèƒ½ç”¨äºçˆ¶å­ç­‰å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ æ¶ˆæ¯é˜Ÿåˆ—ï¼šå…¨åŒå·¥ï¼Œåœ¨ä¸åŒç¨‹åºçš„è¿›ç¨‹é—´éƒ½å¯ä»¥ä½¿ç”¨ å…±äº«å†…å­˜ï¼š åŒä¸Š å¥—æ¥å­— çº¿ç¨‹é€šä¿¡å…±äº«å˜é‡ï¼šå…¨å±€å˜é‡æˆ–ç±»çš„æˆå‘˜å˜é‡ï¼Œç»“åˆé”æˆ–ä¿¡å·é‡ æ¶ˆæ¯é˜Ÿåˆ— å¤šè¿›ç¨‹fork()ï¼Œåˆ›å»ºæ–°çº¿ç¨‹ï¼Œè¿”å›ä¸¤æ¬¡ï¼Œçˆ¶è¿›ç¨‹ä¸­è¿”å›å­è¿›ç¨‹IDï¼Œå­è¿›ç¨‹ä¸­è¿”å›0ï¼Œå¤±è´¥è¿”å›-1execlp(pname,argvsâ€¦,nullptr),å­è¿›ç¨‹ä¸­æ‰§è¡Œæ–°ç¨‹åºï¼Œç¨‹åºåï¼Œå‚æ•°waitpid(pid, &amp;status, 0) æˆ– wait(nullptr)ï¼Œç­‰å¾…å­è¿›ç¨‹ç»“æŸgetpid() è¿”å›PID å­è¿›ç¨‹ä¸åŸæ¥çš„è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒã€‚å­è¿›ç¨‹å°†å¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€ç¯å¢ƒå˜é‡ç­‰èµ„æºã€‚å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ä»£ç æ®µï¼Œä½†åœ¨è¿›ç¨‹ç©ºé—´ä¸­æœ‰è‡ªå·±çš„æ•°æ®æ®µå’Œå †æ ˆæ®µã€‚ ç¤ºä¾‹ï¼šå­è¿›ç¨‹ä½¿ç”¨ls -l 123456789101112131415161718192021222324252627282930#include &lt;iostream&gt;#include &lt;unistd.h&gt;#include &lt;sys/wait.h&gt;int main() &#123; pid_t pid = fork(); if (pid &lt; 0) &#123; // é”™è¯¯å¤„ç†ï¼šforkå¤±è´¥ std::cerr &lt;&lt; &quot;Fork failed!&quot; &lt;&lt; std::endl; return 1; &#125; else if (pid == 0) &#123; // å­è¿›ç¨‹ std::cout &lt;&lt; &quot;This is the child process. PID: &quot; &lt;&lt; getpid() &lt;&lt; std::endl; // æ‰§è¡Œä¸€ä¸ªæ–°ç¨‹åºï¼Œè¿™é‡Œä»¥lså‘½ä»¤ä¸ºä¾‹ execlp(&quot;ls&quot;, &quot;ls&quot;, &quot;-l&quot;, nullptr); // å¦‚æœexeclpæ‰§è¡Œå¤±è´¥ï¼Œä¼šæ‰§è¡Œåˆ°è¿™é‡Œ std::cerr &lt;&lt; &quot;Exec failed!&quot; &lt;&lt; std::endl; return 1; &#125; else &#123; // çˆ¶è¿›ç¨‹ std::cout &lt;&lt; &quot;This is the parent process. PID: &quot; &lt;&lt; getpid() &lt;&lt; &quot;, Child PID: &quot; &lt;&lt; pid &lt;&lt; std::endl; // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ int status; waitpid(pid, &amp;status, 0); std::cout &lt;&lt; &quot;Child process has finished.&quot; &lt;&lt; std::endl; &#125; return 0;&#125; ç®¡é“int pipefd[2]; pipefd[0]è¯»ç«¯ï¼Œpipefd[1]å†™ç«¯pipe(pipefd) åˆ›å»ºç®¡é“ï¼Œå¤±è´¥è¿”å›-1 123456789//ä¸€ä¸ªè¿›ç¨‹-è¯»çº¿ç¨‹close(pipefd[1]);//å…³é—­å†™ç«¯ssize_t n = read(pipefd[0], buffer, BUFFER_SIZE); //é˜»å¡è¯»å–æ•°æ®ï¼Œå¤±è´¥è¿”å›-1ï¼Œå†™ç«¯å…³é—­è¿”å›0close(pipefd[0]);//è¯»å–å®Œæ¯•ï¼Œå…³é—­è¯»ç«¯//å¦ä¸€ä¸ªçº¿ç¨‹-å†™çº¿ç¨‹close(pipefd[0]); // å…³é—­è¯»ç«¯const char* message = &quot;Hello, child process!&quot;;ssize_t n = write(pipefd[1], message, strlen(message));close(pipefd[1]); æ¶ˆæ¯é˜Ÿåˆ—int msgget(key_t key, int msgflg); keyï¼šæ¶ˆæ¯é˜Ÿåˆ—è¡¨ç¤ºï¼Œä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ ‡è¯†ç›¸åŒï¼Œmsgflgï¼šåˆ›å»ºæ ‡å¿—å’Œæƒé™ï¼ŒIPC_CREAT | 0666è¡¨ç¤ºå¦‚æœæŒ‡å®škeyçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™è¿”å›æ¶ˆæ¯æ ‡è¯†ç¬¦ï¼Œ0666ä»£è¡¨æœ‰è¯»å†™æƒé™æ²¡æœ‰æ‰§è¡Œæƒé™msgsndï¼Œå‘é€æ¶ˆæ¯msgrcv æ¥æ”¶æ¶ˆæ¯msgctl åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— demo å‘é€ç«¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;iostream&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;sys/msg.h&gt;#include &lt;cstring&gt;#define MSG_KEY 1234#define MAX_MSG_SIZE 1024// æ¶ˆæ¯ç»“æ„ä½“struct msgbuf &#123; long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[MAX_MSG_SIZE]; // æ¶ˆæ¯å†…å®¹&#125;;int main() &#123; // åˆ›å»ºæˆ–è·å–æ¶ˆæ¯é˜Ÿåˆ— int msgid = msgget(MSG_KEY, IPC_CREAT | 0666); if (msgid == -1) &#123; std::cerr &lt;&lt; &quot;msgget failed&quot; &lt;&lt; std::endl; return 1; &#125; // å‡†å¤‡æ¶ˆæ¯ msgbuf message; message.mtype = 1; std::strcpy(message.mtext, &quot;Hello from sender!&quot;); // å‘é€æ¶ˆæ¯ if (msgsnd(msgid, &amp;message, strlen(message.mtext) + 1, 0) == -1) &#123; std::cerr &lt;&lt; &quot;msgsnd failed&quot; &lt;&lt; std::endl; return 1; &#125; std::cout &lt;&lt; &quot;Message sent successfully.&quot; &lt;&lt; std::endl; return 0;&#125; æ¥æ”¶ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;iostream&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;sys/msg.h&gt;#include &lt;cstring&gt;#define MSG_KEY 1234#define MAX_MSG_SIZE 1024// æ¶ˆæ¯ç»“æ„ä½“struct msgbuf &#123; long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[MAX_MSG_SIZE]; // æ¶ˆæ¯å†…å®¹&#125;;int main() &#123; // åˆ›å»ºæˆ–è·å–æ¶ˆæ¯é˜Ÿåˆ— int msgid = msgget(MSG_KEY, IPC_CREAT | 0666); if (msgid == -1) &#123; std::cerr &lt;&lt; &quot;msgget failed&quot; &lt;&lt; std::endl; return 1; &#125; // å‡†å¤‡æ¥æ”¶æ¶ˆæ¯çš„ç¼“å†²åŒº msgbuf message; // æ¥æ”¶æ¶ˆæ¯ if (msgrcv(msgid, &amp;message, MAX_MSG_SIZE, 1, 0) == -1) &#123; std::cerr &lt;&lt; &quot;msgrcv failed&quot; &lt;&lt; std::endl; return 1; &#125; std::cout &lt;&lt; &quot;Received message: &quot; &lt;&lt; message.mtext &lt;&lt; std::endl; // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— if (msgctl(msgid, IPC_RMID, nullptr) == -1) &#123; std::cerr &lt;&lt; &quot;msgctl failed&quot; &lt;&lt; std::endl; return 1; &#125; return 0;&#125; å…±äº«å†…å­˜int shmid &#x3D; shmget(SHM_KEY, SHM_SIZE, IPC_CREAT | 0666); åˆ›å»ºå…±äº«å†…å­˜å°†å…±äº«å†…å­˜æ®µé™„åŠ åˆ°å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ä»å…±äº«å†…å­˜è¯»æ•°æ®æˆ–å†™æ•°æ®åˆ é™¤å…±äº«å†…å­˜æ®µ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include &lt;iostream&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;sys/shm.h&gt;#include &lt;cstring&gt;#define SHM_KEY 1234#define SHM_SIZE 1024int main() &#123; // åˆ›å»ºå…±äº«å†…å­˜æ®µ int shmid = shmget(SHM_KEY, SHM_SIZE, IPC_CREAT | 0666); if (shmid == -1) &#123; std::cerr &lt;&lt; &quot;shmget failed&quot; &lt;&lt; std::endl; return 1; &#125; // å°†å…±äº«å†…å­˜æ®µé™„åŠ åˆ°å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ char* shmaddr = static_cast&lt;char*&gt;(shmat(shmid, nullptr, 0)); if (shmaddr == reinterpret_cast&lt;char*&gt;(-1)) &#123; std::cerr &lt;&lt; &quot;shmat failed&quot; &lt;&lt; std::endl; return 1; &#125; // å‘å…±äº«å†…å­˜å†™å…¥æ•°æ® const char* message = &quot;Hello, shared memory!&quot;; std::strcpy(shmaddr, message); // å°†å…±äº«å†…å­˜æ®µä»å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†ç¦» if (shmdt(shmaddr) == -1) &#123; std::cerr &lt;&lt; &quot;shmdt failed&quot; &lt;&lt; std::endl; return 1; &#125; std::cout &lt;&lt; &quot;Data written to shared memory.&quot; &lt;&lt; std::endl; return 0;&#125;#include &lt;iostream&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;sys/shm.h&gt;#include &lt;cstring&gt;#define SHM_KEY 1234#define SHM_SIZE 1024int main() &#123; // è·å–å…±äº«å†…å­˜æ®µ int shmid = shmget(SHM_KEY, SHM_SIZE, 0666); if (shmid == -1) &#123; std::cerr &lt;&lt; &quot;shmget failed&quot; &lt;&lt; std::endl; return 1; &#125; // å°†å…±äº«å†…å­˜æ®µé™„åŠ åˆ°å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ char* shmaddr = static_cast&lt;char*&gt;(shmat(shmid, nullptr, 0)); if (shmaddr == reinterpret_cast&lt;char*&gt;(-1)) &#123; std::cerr &lt;&lt; &quot;shmat failed&quot; &lt;&lt; std::endl; return 1; &#125; // ä»å…±äº«å†…å­˜è¯»å–æ•°æ® std::cout &lt;&lt; &quot;Data read from shared memory: &quot; &lt;&lt; shmaddr &lt;&lt; std::endl; // å°†å…±äº«å†…å­˜æ®µä»å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†ç¦» if (shmdt(shmaddr) == -1) &#123; std::cerr &lt;&lt; &quot;shmdt failed&quot; &lt;&lt; std::endl; return 1; &#125; // åˆ é™¤å…±äº«å†…å­˜æ®µ if (shmctl(shmid, IPC_RMID, nullptr) == -1) &#123; std::cerr &lt;&lt; &quot;shmctl failed&quot; &lt;&lt; std::endl; return 1; &#125; return 0;&#125; ##è¿›ç¨‹åŒæ­¥ ä¿¡å·é‡(ä¸»è¦)POSIX ä¿¡å·é‡åˆ†ä¸ºæœ‰åä¿¡å·é‡å’Œæ— åä¿¡å·é‡ï¼Œæœ‰åä¿¡å·é‡å¯ä»¥ç”¨äºä¸ç›¸å…³çš„è¿›ç¨‹é—´åŒæ­¥ï¼Œæ— åä¿¡å·é‡é€šå¸¸ç”¨äºçº¿ç¨‹é—´æˆ–æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´åŒæ­¥ 1234567sem_t* sem = sem_open(SEM_NAME, O_CREAT, 0666, 1); //SEM_NAMEä¿¡å·é‡åå­—ï¼ŒO_CREATè¡¨ç¤ºå¦‚æœä¿¡å·é‡ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒï¼Œä¿¡å·é‡åˆå§‹å€¼ä¸º1sem_wait(sem) == -1) &#123; //ç­‰å¾…è¯·æ±‚ä¿¡å·é‡//è¿›è¡Œèµ„æºæ“ä½œï¼Œå®Œæˆä¹‹åé‡Šæ”¾sem_post(sem) == -1 //é‡Šæ”¾ä¿¡å·é‡sem_close(sem) == -1//å…³é—­ä¿¡å·é‡sem_unlink(SEM_NAME); //åˆ é™¤ä¿¡å·é‡ äº’æ–¥é”pthread_mutex_t mutex;pthread_mutex_lock(&amp;mutex); &#x2F;&#x2F; åŠ é”pthread_mutex_unlock(&amp;mutex); &#x2F;&#x2F; è§£é” æ¡ä»¶å˜é‡pthread_mutex_init(&amp;mutex, nullptr);pthread_cond_init(&amp;cond, nullptr); 123456789101112131415161718pthread_mutex_t mutex;pthread_cond_t cond;bool condition_met = false;//ä¸€ä¸ªè¿›ç¨‹pthread_mutex_lock(&amp;mutex);condition_met = true; //æ¡ä»¶pthread_cond_signal(&amp;cond); // å‘é€ä¿¡å·pthread_mutex_unlock(&amp;mutex);//å¦ä¸€ä¸ªè¿›ç¨‹pthread_mutex_lock(&amp;mutex);while (!condition_met) &#123; pthread_cond_wait(&amp;cond, &amp;mutex); // ç­‰å¾…æ¡ä»¶æˆç«‹ //do something&#125;pthread_mutex_unlock(&amp;mutex);//æ¸…ç†èµ„æºpthread_mutex_destroy(&amp;mutex);pthread_cond_destroy(&amp;cond); å¤šçº¿ç¨‹thread-c++11#include std::thread t(threadFunction); &#x2F;&#x2F;åˆ›å»ºçº¿ç¨‹æ‰§è¡Œå‡½æ•°std::thread t(threadFunction, x, y); &#x2F;&#x2F;æ‰§è¡Œå‡½æ•°å¹¶ä¼ é€’å‚æ•°t.join(); &#x2F;&#x2F;ç­‰å¾…çº¿ç¨‹ç»“æŸ lambdaè¡¨è¾¾å¼åˆ›å»ºçº¿ç¨‹ 12345int a = 2, b = 4;std::thread t([a, b]() &#123; std::cout &lt;&lt; &quot;The product of &quot; &lt;&lt; a &lt;&lt; &quot; and &quot; &lt;&lt; b &lt;&lt; &quot; is &quot; &lt;&lt; a * b &lt;&lt; std::endl;&#125;);t.join(); ä½¿ç”¨æˆå‘˜å‡½æ•°åˆ›å»ºçº¿ç¨‹std::thread t(&amp;MyClass::memberFunction, &amp;obj); éœ€è¦ä¼ å…¥å‡½æ•°åœ°å€å’Œå¯¹è±¡æŒ‡é’ˆ pthread-POSIX#include &lt;pthread.h&gt; pthread_t thread;int result &#x3D; pthread_create(&amp;thread, nullptr, threadFunction, nullptr); æˆåŠŸè¿”å›0ï¼Œçº¿ç¨‹æ‰§è¡Œå‡½æ•°threadFunctionï¼Œæœ€åä¸€ä¸ªæ˜¯å‡½æ•°å‚æ•°result &#x3D; pthread_join(thread, nullptr); ç­‰å¾…ç»“æŸ std::asyncä¸ä¸€å®šä¼šä½¿ç”¨å¤šçº¿ç¨‹ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºstd::launch::asyncåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ std::launch::deferredä¼šå»¶è¿Ÿåˆ°ä½¿ç”¨result.get()çš„çº¿ç¨‹ä¸­æ‰§è¡Œ 12std::future&lt;int&gt; result = std::async(std::launch::async, asyncFunction); //å¯ä»¥ä¼ å‚ï¼Œå¼‚æ­¥æ‰§è¡ŒasyncFunctionå‡½æ•°int value = result.get(); //è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ çº¿ç¨‹åŒæ­¥äº’æ–¥é”ã€é€’å½’äº’æ–¥é”ï¼Œè¯»å†™é”ï¼Œæ¡ä»¶å˜é‡ã€ä¿¡å·é‡ã€ç­‰ åŸå­æ“ä½œatomicï¼Œçº¿ç¨‹å±€éƒ¨å­˜å‚¨thread_local åŸå­æ“ä½œå¸¸ç”¨äºå®ç°é”ã€ä¿¡å·é‡ã€è®¡æ•°å™¨ç­‰çº¿ç¨‹åŒæ­¥æœºåˆ¶ åœ¨C++ä¸­ï¼Œæ ‡å‡†åº“æä¾›äº†&lt;atomic&gt;å¤´æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—åŸå­æ“ä½œç±»å‹å’Œå‡½æ•°ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡ŒåŸå­æ“ä½œã€‚å¸¸è§çš„åŸå­æ“ä½œç±»å‹åŒ…æ‹¬std::atomicã€std::atomic_flagç­‰ã€‚ 1234567891011121314151617181920212223#include &lt;iostream&gt;#include &lt;atomic&gt;#include &lt;thread&gt;std::atomic&lt;int&gt; atomicCounter(0);void incrementCounter() &#123; for (int i = 0; i &lt; 10000; ++i) &#123; atomicCounter++; // åŸå­è‡ªå¢æ“ä½œ &#125;&#125;int main() &#123; std::thread t1(incrementCounter); std::thread t2(incrementCounter); t1.join(); t2.join(); std::cout &lt;&lt; &quot;Final value of counter: &quot; &lt;&lt; atomicCounter &lt;&lt; std::endl; return 0;&#125; std::atomic&lt;int&gt;ç±»å‹çš„atomicCounterè¢«ç”¨ä½œä¸€ä¸ªè®¡æ•°å™¨ï¼Œå®ƒå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è€Œä¸ä¼šäº§ç”Ÿæ•°æ®ç«äº‰é—®é¢˜ã€‚ std::atomicæä¾›äº†åŸå­æ“ä½œçš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¯¹å…±äº«å˜é‡çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œå³ä¸ä¼šè¢«ä¸­æ–­æˆ–äº¤é”™ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¯¹å…±äº«å˜é‡è¿›è¡ŒåŸå­æ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…è¿™ä¸ªæ“ä½œå®Œæˆï¼Œä¸èƒ½æ’å…¥è‡ªå·±çš„æ“ä½œï¼Œä»è€Œä¿è¯äº†å…±äº«å˜é‡çš„ä¸€è‡´æ€§ã€‚ æ— é”ç¼–ç¨‹é€šè¿‡ä½¿ç”¨åŸå­æ“ä½œå’Œå…¶ä»–å¹¶å‘ç¼–ç¨‹æŠ€æœ¯æ¥é¿å…ä½¿ç”¨ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼Œä»è€Œé™ä½äº†çº¿ç¨‹é—´çš„ç«äº‰å’ŒåŒæ­¥å¼€é”€ï¼Œæé«˜äº†ç¨‹åºçš„å¹¶å‘æ€§èƒ½ åŸå­æ“ä½œï¼š ä½¿ç”¨åŸå­æ“ä½œï¼Œå¦‚std::atomicï¼Œå¯ä»¥åœ¨ä¸éœ€è¦é”çš„æƒ…å†µä¸‹å¯¹å…±äº«å˜é‡è¿›è¡ŒåŸå­æ€§æ“ä½œï¼Œä»è€Œé¿å…äº†é”å¸¦æ¥çš„ç«äº‰å’Œå¼€é”€ã€‚ åŸå­æ“ä½œé€šå¸¸åŒ…æ‹¬è‡ªå¢ã€è‡ªå‡ã€æ¯”è¾ƒäº¤æ¢ç­‰æ“ä½œï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°å¯¹å…±äº«å˜é‡è¿›è¡Œä¿®æ”¹ã€‚ æ— é”æ•°æ®ç»“æ„ï¼š è®¾è®¡æ— é”æ•°æ®ç»“æ„ï¼Œå¦‚æ— é”é˜Ÿåˆ—ã€æ— é”æ ˆã€æ— é”å“ˆå¸Œè¡¨ç­‰ï¼Œå¯ä»¥é¿å…ä½¿ç”¨é”è¿›è¡Œå¹¶å‘è®¿é—®æ§åˆ¶ã€‚ æ— é”æ•°æ®ç»“æ„é€šå¸¸åŸºäºåŸå­æ“ä½œå’Œä¸€äº›ç‰¹æ®Šçš„ç®—æ³•å®ç°ï¼Œç¡®ä¿å¹¶å‘è®¿é—®æ—¶çš„æ•°æ®ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚ æ— é”ç®—æ³•ï¼š è®¾è®¡æ— é”ç®—æ³•ï¼Œå¦‚æ— é”æ’åºã€æ— é”å¹¶è¡Œæœç´¢ç­‰ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦äº’æ–¥é”çš„æƒ…å†µä¸‹å®ç°é«˜æ•ˆçš„å¹¶å‘ç®—æ³•ã€‚ æ— é”ç®—æ³•é€šå¸¸åŸºäºåŸå­æ“ä½œå’Œä¸€äº›å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œå¦‚åˆ†æ²»ã€åˆ†å¸ƒå¼è®¡ç®—ç­‰ï¼Œä»¥æé«˜ç¨‹åºçš„å¹¶å‘æ€§èƒ½ã€‚ æ— é”ç¼–ç¨‹æ¨¡å¼ï¼š ä½¿ç”¨æ— é”ç¼–ç¨‹æ¨¡å¼ï¼Œå¦‚æ¶ˆæ¯ä¼ é€’ã€äº‹ä»¶é©±åŠ¨ç­‰ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦æ˜¾å¼é”çš„æƒ…å†µä¸‹å®ç°çº¿ç¨‹é—´çš„åŒæ­¥å’Œé€šä¿¡ã€‚ æ— é”ç¼–ç¨‹æ¨¡å¼é€šå¸¸åŸºäºå¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä»¥æé«˜ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œå“åº”æ€§ã€‚ éœ€è¦æ³¨æ„é¿å…ä¸€äº›å¸¸è§çš„é™·é˜±å’Œé”™è¯¯ï¼Œå¦‚ABAé—®é¢˜ã€å†…å­˜é‡æ’ç­‰ã€‚ ABAé—®é¢˜å…·ä½“æ¥è¯´ï¼ŒABAé—®é¢˜çš„å‘ç”Ÿå¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š åˆå§‹æ—¶åˆ»ï¼Œå…±äº«å˜é‡çš„å€¼ä¸ºAã€‚ çº¿ç¨‹T1è¯»å–å…±äº«å˜é‡çš„å€¼Aï¼Œå¹¶è¿›è¡Œä¸€äº›æ“ä½œã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹T2å°†å…±äº«å˜é‡çš„å€¼ä»Aä¿®æ”¹ä¸ºBï¼Œç„¶ååˆå°†å…¶ä¿®æ”¹å›Aï¼Œæ­¤æ—¶å…±äº«å˜é‡çš„å€¼åˆå˜æˆäº†Aã€‚ çº¿ç¨‹T1ç»§ç»­æ‰§è¡Œï¼Œæ ¹æ®å…±äº«å˜é‡å€¼æ˜¯å¦ä¸ºAåšå‡ºåˆ¤æ–­ï¼Œè®¤ä¸ºå…±äº«å˜é‡çš„å€¼æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œç»§ç»­æ‰§è¡Œæ“ä½œã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å…±äº«å˜é‡çš„å€¼åœ¨T1æ‰§è¡ŒæœŸé—´è¢«ä¿®æ”¹äº†ï¼Œä½†T1å¹¶æ²¡æœ‰å¯Ÿè§‰åˆ°è¿™ä¸€å˜åŒ–ï¼Œå› ä¸ºå®ƒåªå…³å¿ƒå…±äº«å˜é‡çš„å½“å‰å€¼æ˜¯å¦ä¸ºAã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒT1å¯èƒ½ä¼šåŸºäºé”™è¯¯çš„å‡è®¾ç»§ç»­æ‰§è¡Œï¼Œå¯¼è‡´ç¨‹åºå‡ºç°é€»è¾‘é”™è¯¯æˆ–å®‰å…¨é—®é¢˜ã€‚ ä¸ºäº†è§£å†³ABAé—®é¢˜ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œå¦‚ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ç­‰ï¼Œæ¥è¾…åŠ©åˆ¤æ–­å…±äº«å˜é‡çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦å¤–ï¼Œä¸€äº›æ•°æ®ç»“æ„ï¼Œå¦‚æ— é”é˜Ÿåˆ—ã€æ— é”æ ˆç­‰ï¼Œä¹Ÿä¼šä½¿ç”¨ç±»ä¼¼çš„æŠ€æœ¯æ¥é¿å…ABAé—®é¢˜çš„å‘ç”Ÿã€‚ å†…å­˜é‡æ’å†…å­˜é‡æ’åŒ…æ‹¬ä¸¤ç§ç±»å‹çš„é‡æ’ï¼š ç¼–è¯‘å™¨é‡æ’ï¼šç¼–è¯‘å™¨å¯èƒ½ä¼šå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ”¹å˜æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†ä¸ä¼šæ”¹å˜ä»£ç çš„è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°†ä¸€äº›ç‹¬ç«‹çš„æŒ‡ä»¤é‡æ’ä»¥æé«˜å±€éƒ¨æ€§æˆ–å‡å°‘åˆ†æ”¯é¢„æµ‹å¤±è´¥çš„å¯èƒ½æ€§ã€‚ å¤„ç†å™¨é‡æ’ï¼šå¤„ç†å™¨åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œä¹±åºæ‰§è¡Œæˆ–è€…å»¶è¿Ÿæ‰§è¡Œã€‚å¤„ç†å™¨ä¼šæ ¹æ®æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–å…³ç³»å’Œç›¸å…³æ€§è¿›è¡Œé‡æ’ï¼Œä»¥å°½å¯èƒ½åœ°åˆ©ç”¨å¤„ç†å™¨çš„å„ç§åŠŸèƒ½å•å…ƒï¼Œæé«˜æŒ‡ä»¤æ‰§è¡Œæ•ˆç‡ã€‚ å†…å­˜é‡æ’çš„å­˜åœ¨ä½¿å¾—åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¸ºäº†é¿å…å†…å­˜é‡æ’å¯¼è‡´çš„é—®é¢˜ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆå¦‚äº’æ–¥é”ã€åŸå­æ“ä½œã€å†…å­˜æ …æ ç­‰ï¼‰æ¥ä¿è¯æŒ‡ä»¤çš„é¡ºåºä¸€è‡´æ€§ï¼Œä»¥åŠä½¿ç”¨volatileå…³é”®å­—æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ã€‚ ###mutexäº’æ–¥é” ç”¨äºä¿æŠ¤ä¸´ç•ŒåŒº ç¡®ä¿åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚äº’æ–¥é”æä¾›äº†ä¸¤ç§åŸºæœ¬æ“ä½œï¼šé”å®šï¼ˆlockï¼‰å’Œè§£é”ï¼ˆunlockï¼‰ï¼Œçº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆå°è¯•è·å–é”ï¼Œå¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹è¢«é˜»å¡ç›´åˆ°é”å¯ç”¨ã€‚ åœ¨C++ä¸­ï¼Œäº’æ–¥é”é€šå¸¸ä½¿ç”¨std::mutexç±»æ¥å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;std::mutex mtx; // å®šä¹‰äº’æ–¥é”å¯¹è±¡void incrementCounter(int&amp; counter) &#123; for (int i = 0; i &lt; 10000; ++i) &#123; // åœ¨è®¿é—®ä¸´ç•ŒåŒºä¹‹å‰å…ˆé”å®šäº’æ–¥é” mtx.lock(); counter++; // è®¿é—®å®Œæˆåè§£é”äº’æ–¥é” mtx.unlock(); &#125;&#125;int main() &#123; int counter = 0; // åˆ›å»ºå¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œè‡ªå¢æ“ä½œ std::thread t1(incrementCounter, std::ref(counter)); std::thread t2(incrementCounter, std::ref(counter)); // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ t1.join(); t2.join(); std::cout &lt;&lt; &quot;Final value of counter: &quot; &lt;&lt; counter &lt;&lt; std::endl; return 0;&#125; æ¡ä»¶å˜é‡æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰æ˜¯ä¸€ç§çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œç”¨äºåœ¨çº¿ç¨‹é—´è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ã€‚å®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ»¡è¶³æ¡ä»¶æ—¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚æ¡ä»¶å˜é‡é€šå¸¸ä¸äº’æ–¥é”ï¼ˆMutexï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„å®‰å…¨è®¿é—®å…±äº«èµ„æºã€‚ ä¸‹é¢æ˜¯æ¡ä»¶å˜é‡çš„ä¸€èˆ¬ç”¨æ³•ï¼š åˆ›å»ºæ¡ä»¶å˜é‡å’Œäº’æ–¥é”ï¼š 12std::condition_variable condVar; // æ¡ä»¶å˜é‡std::mutex mtx; // äº’æ–¥é” ç­‰å¾…æ¡ä»¶ï¼š ç­‰å¾…çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆé”å®šäº’æ–¥é”ï¼Œç„¶åè°ƒç”¨waitæ–¹æ³•ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³ï¼š 12std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é”condVar.wait(lock, []()&#123; return condition; &#125;); // ç­‰å¾…æ¡ä»¶æ»¡è¶³ å”¤é†’ç­‰å¾…çº¿ç¨‹ï¼š å”¤é†’çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆé”å®šäº’æ–¥é”ï¼Œç„¶åè°ƒç”¨notify_oneæˆ–notify_allæ–¹æ³•é€šçŸ¥ç­‰å¾…çº¿ç¨‹ï¼š 123std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é”condition = true; // ä¿®æ”¹æ¡ä»¶condVar.notify_one(); // å”¤é†’ç­‰å¾…çº¿ç¨‹ æ¡ä»¶å˜é‡çš„ä½¿ç”¨å¯ä»¥å¸®åŠ©çº¿ç¨‹ä¹‹é—´è¿›è¡Œé«˜æ•ˆçš„åŒæ­¥å’Œé€šä¿¡ï¼Œé¿å…äº†è½®è¯¢ç­‰ä½æ•ˆçš„ç­‰å¾…æ–¹å¼ã€‚å®ƒå¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€è¯»è€…-å†™è€…æ¨¡å‹ç­‰å¤šçº¿ç¨‹ç¼–ç¨‹åœºæ™¯ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;std::queue&lt;int&gt; dataQueue; // å…±äº«æ•°æ®é˜Ÿåˆ—std::mutex mtx; // äº’æ–¥é”std::condition_variable condVar; // æ¡ä»¶å˜é‡void producer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; &#123; std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é” // ç”Ÿäº§æ•°æ®å¹¶æ”¾å…¥é˜Ÿåˆ— dataQueue.push(i); std::cout &lt;&lt; &quot;Produced data: &quot; &lt;&lt; i &lt;&lt; std::endl; &#125; // åœ¨è§£é”å‰é‡Šæ”¾äº’æ–¥é” // å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹ condVar.notify_one(); // æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„é—´éš” std::this_thread::sleep_for(std::chrono::milliseconds(100)); &#125;&#125;void consumer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é” // ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³ condVar.wait(lock, []()&#123; return !dataQueue.empty(); &#125;); // ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶æ¶ˆè´¹ int data = dataQueue.front(); dataQueue.pop(); std::cout &lt;&lt; &quot;Consumed data: &quot; &lt;&lt; data &lt;&lt; std::endl; // æ¨¡æ‹Ÿæ¶ˆè´¹æ•°æ®çš„å¤„ç†æ—¶é—´ std::this_thread::sleep_for(std::chrono::milliseconds(250)); &#125;&#125;int main() &#123; // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ std::thread producerThread(producer); std::thread consumerThread(consumer); // ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ç»“æŸ producerThread.join(); consumerThread.join(); return 0;&#125; ä¿¡å·é‡åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† Semaphore ç±»æ¥å®ç°ä¿¡å·é‡çš„åŠŸèƒ½ã€‚Semaphore ç±»åŒ…å«äº† notify() å’Œ wait() æ–¹æ³•ï¼Œç”¨äºé€šçŸ¥å’Œç­‰å¾…ä¿¡å·é‡ã€‚ ç”Ÿäº§è€…çº¿ç¨‹åœ¨æ¯æ¬¡ç”Ÿäº§æ•°æ®åï¼Œè°ƒç”¨ semProducer.wait() ç­‰å¾…ç”Ÿäº§è€…ä¿¡å·é‡ï¼Œç„¶åå°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—å¹¶é€šçŸ¥æ¶ˆè´¹è€…ä¿¡å·é‡ã€‚æ¶ˆè´¹è€…çº¿ç¨‹åœ¨æ¯æ¬¡æ¶ˆè´¹æ•°æ®å‰ï¼Œè°ƒç”¨ semConsumer.wait() ç­‰å¾…æ¶ˆè´¹è€…ä¿¡å·é‡ï¼Œç„¶åä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®å¹¶é€šçŸ¥ç”Ÿäº§è€…ä¿¡å·é‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;chrono&gt;class Semaphore &#123;public: Semaphore(int count = 0) : count_(count) &#123;&#125; void notify() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); ++count_; condition_.notify_one(); &#125; void wait() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); while (count_ == 0) &#123; condition_.wait(lock); &#125; --count_; &#125;private: std::mutex mutex_; std::condition_variable condition_; int count_;&#125;;std::queue&lt;int&gt; dataQueue; // å…±äº«æ•°æ®é˜Ÿåˆ—Semaphore semProducer(1), semConsumer(0); // ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¿¡å·é‡void producer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; semProducer.wait(); // ç­‰å¾…ç”Ÿäº§è€…ä¿¡å·é‡ dataQueue.push(i); // ç”Ÿäº§æ•°æ® std::cout &lt;&lt; &quot;Produced data: &quot; &lt;&lt; i &lt;&lt; std::endl; semConsumer.notify(); // é€šçŸ¥æ¶ˆè´¹è€…ä¿¡å·é‡ std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„é—´éš” &#125;&#125;void consumer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; semConsumer.wait(); // ç­‰å¾…æ¶ˆè´¹è€…ä¿¡å·é‡ int data = dataQueue.front(); // æ¶ˆè´¹æ•°æ® dataQueue.pop(); std::cout &lt;&lt; &quot;Consumed data: &quot; &lt;&lt; data &lt;&lt; std::endl; semProducer.notify(); // é€šçŸ¥ç”Ÿäº§è€…ä¿¡å·é‡ std::this_thread::sleep_for(std::chrono::milliseconds(250)); // æ¨¡æ‹Ÿæ¶ˆè´¹æ•°æ®çš„å¤„ç†æ—¶é—´ &#125;&#125;int main() &#123; // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ std::thread producerThread(producer); std::thread consumerThread(consumer); // ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ç»“æŸ producerThread.join(); consumerThread.join(); return 0;&#125; è¯»å†™é”123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;chrono&gt;#include &lt;vector&gt;class RWLock &#123;public: RWLock() : readerCount(0), writerCount(0) &#123;&#125; void lockRead() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); while (writerCount &gt; 0) &#123; condition_.wait(lock); &#125; ++readerCount; &#125; void unlockRead() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); --readerCount; if (readerCount == 0) &#123; condition_.notify_one(); &#125; &#125; void lockWrite() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); ++writerCount; while (readerCount &gt; 0 || writerCount &gt; 1) &#123; condition_.wait(lock); &#125; &#125; void unlockWrite() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); --writerCount; condition_.notify_all(); &#125;private: std::mutex mutex_; std::condition_variable condition_; int readerCount; int writerCount;&#125;;int data = 0; // å…±äº«æ•°æ®RWLock rwLock; // è¯»å†™é”void reader() &#123; for (int i = 0; i &lt; 10; ++i) &#123; rwLock.lockRead(); // åŠ è¯»é” std::cout &lt;&lt; &quot;Reader &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; reads data: &quot; &lt;&lt; data &lt;&lt; std::endl; rwLock.unlockRead(); // è§£è¯»é” std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿè¯»æ“ä½œçš„é—´éš” &#125;&#125;void writer() &#123; for (int i = 0; i &lt; 5; ++i) &#123; rwLock.lockWrite(); // åŠ å†™é” data++; // ä¿®æ”¹æ•°æ® std::cout &lt;&lt; &quot;Writer &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; writes data: &quot; &lt;&lt; data &lt;&lt; std::endl; rwLock.unlockWrite(); // è§£å†™é” std::this_thread::sleep_for(std::chrono::milliseconds(250)); // æ¨¡æ‹Ÿå†™æ“ä½œçš„é—´éš” &#125;&#125;int main() &#123; // åˆ›å»ºå¤šä¸ªè¯»è€…çº¿ç¨‹å’Œå†™è€…çº¿ç¨‹ std::vector&lt;std::thread&gt; readers, writers; for (int i = 0; i &lt; 3; ++i) &#123; readers.emplace_back(reader); &#125; for (int i = 0; i &lt; 2; ++i) &#123; writers.emplace_back(writer); &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ for (auto&amp; readerThread : readers) &#123; readerThread.join(); &#125; for (auto&amp; writerThread : writers) &#123; writerThread.join(); &#125; return 0;&#125; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† RWLock ç±»æ¥å®ç°è¯»å†™é”çš„åŠŸèƒ½ã€‚RWLock ç±»åŒ…å«äº† lockRead()ã€unlockRead()ã€lockWrite() å’Œ unlockWrite() æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºè¯»é”çš„åŠ é”ã€è¯»é”çš„è§£é”ã€å†™é”çš„åŠ é”å’Œå†™é”çš„è§£é”ã€‚ è¯»è€…çº¿ç¨‹åœ¨æ¯æ¬¡è¯»å–æ•°æ®å‰ï¼Œè°ƒç”¨ rwLock.lockRead() åŠ è¯»é”ï¼Œè¯»å–æ•°æ®åè°ƒç”¨ rwLock.unlockRead() è§£è¯»é”ã€‚å†™è€…çº¿ç¨‹åœ¨æ¯æ¬¡ä¿®æ”¹æ•°æ®å‰ï¼Œè°ƒç”¨ rwLock.lockWrite() åŠ å†™é”ï¼Œä¿®æ”¹æ•°æ®åè°ƒç”¨ rwLock.unlockWrite() è§£å†™é”ã€‚ é€šè¿‡ä½¿ç”¨è¯»å†™é”ï¼Œå®ç°äº†è¯»è€…-å†™è€…æ¨¡å‹ä¸­çš„çº¿ç¨‹åŒæ­¥å’Œå¹¶å‘æ§åˆ¶ï¼Œæé«˜äº†è¯»æ“ä½œçš„å¹¶å‘æ€§èƒ½ã€‚ çº¿ç¨‹å±€éƒ¨å­˜å‚¨TLSçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread-Local Storageï¼ŒTLSï¼‰æ˜¯ä¸€ç§çº¿ç¨‹ç‰¹å®šæ•°æ®ï¼ˆThread-Specific Dataï¼ŒTSDï¼‰çš„å­˜å‚¨æœºåˆ¶ å…è®¸æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ã€‚è¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°è®¿é—®å’Œä¿®æ”¹è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ•°æ®ã€‚ ä½†æ˜¯è‡ªC++11èµ·ï¼Œæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªåä¸ºstd::thread_localçš„å…³é”®å­—ï¼Œå¯ä»¥è½»æ¾å®ç°çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€‚ 123456789101112131415161718192021#include &lt;iostream&gt;#include &lt;thread&gt;// å®šä¹‰çº¿ç¨‹å±€éƒ¨å˜é‡thread_local int tls_variable = 0;void threadFunction() &#123; // æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„tls_variableå‰¯æœ¬ tls_variable++; std::cout &lt;&lt; &quot;Thread ID: &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;, TLS variable: &quot; &lt;&lt; tls_variable &lt;&lt; std::endl;&#125;int main() &#123; std::thread t1(threadFunction); std::thread t2(threadFunction); t1.join(); t2.join(); return 0;&#125; tls_variableæ˜¯ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬ã€‚åœ¨threadFunction()å‡½æ•°ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šé€’å¢è‡ªå·±çš„tls_variableå‰¯æœ¬ï¼Œå¹¶æ‰“å°å‡ºå½“å‰çº¿ç¨‹çš„IDå’ŒTLSå˜é‡çš„å€¼ã€‚å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œæ‰€ä»¥è¾“å‡ºçš„ç»“æœä¼šæ˜¾ç¤ºä¸åŒçš„çº¿ç¨‹IDå’Œä¸åŒçš„TLSå˜é‡å€¼ã€‚ RPCä¸åºåˆ—åŒ–æŠ€æœ¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼ŒRPCï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„é€šä¿¡æœºåˆ¶ï¼Œå®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆé€šå¸¸åœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šï¼‰çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ã€‚ åºåˆ—åŒ–æŠ€æœ¯æ˜¯RPCçš„é‡è¦ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå®ƒè´Ÿè´£å°†æ•°æ®ä»å†…å­˜ä¸­çš„å¯¹è±¡è½¬æ¢ä¸ºå¯ä»¥åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„å­—èŠ‚æµï¼ˆé€šå¸¸æ˜¯äºŒè¿›åˆ¶æˆ–æ–‡æœ¬æ ¼å¼ï¼‰ï¼Œä»¥åŠå°†æ¥æ”¶åˆ°çš„å­—èŠ‚æµè½¬æ¢å›åŸå§‹å¯¹è±¡ã€‚ å¸¸è§çš„åºåˆ—åŒ–æŠ€æœ¯åŒ…æ‹¬ï¼š JSONï¼ˆJavaScript Object Notationï¼‰ï¼š ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œæ˜“äºäººé˜…è¯»å’Œç¼–å†™ï¼Œé€šå¸¸ç”¨äºWebåº”ç”¨ä¸­çš„æ•°æ®äº¤æ¢ã€‚ XMLï¼ˆeXtensible Markup Languageï¼‰ï¼š ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œç”¨äºæè¿°æ•°æ®ç»“æ„å’Œä¼ è¾“æ•°æ®ï¼Œæ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„å’Œå…ƒæ•°æ®ã€‚ Protocol Buffersï¼ˆProtoBufï¼‰ï¼š ç”±Googleå¼€å‘çš„äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼ï¼Œå…·æœ‰é«˜æ•ˆçš„ç¼–è§£ç æ€§èƒ½å’Œè¾ƒå°çš„æ•°æ®ä½“ç§¯ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ MessagePackï¼š ä¸€ç§é«˜æ•ˆçš„äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼ï¼Œæ¯”JSONå’ŒXMLæ›´è½»é‡çº§ï¼Œé€‚ç”¨äºç½‘ç»œä¼ è¾“å’Œæ•°æ®å­˜å‚¨ã€‚ Thriftï¼š ç”±Facebookå¼€å‘çš„è·¨è¯­è¨€çš„RPCæ¡†æ¶ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¤šç§åºåˆ—åŒ–æ ¼å¼ã€‚ gRRCä¸ProtobufgRPCæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€è·¨è¯­è¨€çš„RPCæ¡†æ¶ï¼Œç”±Googleå¼€å‘å¹¶å¼€æºã€‚å®ƒåŸºäºHTTP&#x2F;2åè®®ï¼Œä½¿ç”¨Protocol Buffersä½œä¸ºé»˜è®¤çš„åºåˆ—åŒ–æŠ€æœ¯ï¼Œæ—¨åœ¨ç®€åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡å’ŒæœåŠ¡è°ƒç”¨ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»gRPCå’ŒProtocol Buffersï¼š gRPCï¼š ç‰¹ç‚¹ï¼š é«˜æ€§èƒ½ï¼šåŸºäºHTTP&#x2F;2çš„å¤šè·¯å¤ç”¨ã€äºŒè¿›åˆ¶ä¼ è¾“å’Œå¸§å‹ç¼©ç­‰ç‰¹æ€§ï¼Œæä¾›äº†æ›´é«˜æ•ˆçš„ç½‘ç»œé€šä¿¡ã€‚ è·¨è¯­è¨€æ”¯æŒï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚C++ã€Javaã€Goã€Pythonç­‰ï¼Œå¯ä»¥è®©ä¸åŒè¯­è¨€ç¼–å†™çš„æœåŠ¡ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ è‡ªåŠ¨ä»£ç ç”Ÿæˆï¼šé€šè¿‡Protocol Bufferså®šä¹‰æœåŠ¡å’Œæ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œç®€åŒ–äº†å¼€å‘å·¥ä½œã€‚ æ”¯æŒå¤šç§è°ƒç”¨ç±»å‹ï¼šæ”¯æŒå•å‘è°ƒç”¨ã€æœåŠ¡å™¨æµã€å®¢æˆ·ç«¯æµå’ŒåŒå‘æµç­‰å››ç§è°ƒç”¨ç±»å‹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚ ä½¿ç”¨åœºæ™¯ï¼š gRPCé€‚ç”¨äºæ„å»ºé«˜æ€§èƒ½ã€è·¨è¯­è¨€çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç‰¹åˆ«é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„å’Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡é€šä¿¡ã€‚ Protocol Buffersï¼ˆProtoBufï¼‰ï¼š ç‰¹ç‚¹ï¼š ç®€æ´é«˜æ•ˆï¼šé‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œåºåˆ—åŒ–ï¼Œæ•°æ®ä½“ç§¯å°ã€ä¼ è¾“é€Ÿåº¦å¿«ï¼Œé€‚åˆåœ¨ç½‘ç»œä¼ è¾“å’Œå­˜å‚¨ä¸­ä½¿ç”¨ã€‚ è·¨è¯­è¨€æ”¯æŒï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥ç”Ÿæˆä¸åŒè¯­è¨€çš„æ•°æ®ç»“æ„å’Œåºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ä»£ç ã€‚ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šæ”¯æŒå‘åå’Œå‘å‰å…¼å®¹ï¼Œå¯ä»¥åœ¨ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ è‡ªæè¿°æ€§ï¼šä½¿ç”¨.protoæ–‡ä»¶å®šä¹‰æ•°æ®ç»“æ„å’ŒæœåŠ¡æ¥å£ï¼Œå…·æœ‰è‡ªæè¿°æ€§ï¼Œæ˜“äºç»´æŠ¤å’Œä¿®æ”¹ã€‚ ä½¿ç”¨åœºæ™¯ï¼š Protocol Buffersé€‚ç”¨äºéœ€è¦é«˜æ•ˆåºåˆ—åŒ–å’Œè·¨è¯­è¨€é€šä¿¡çš„åœºæ™¯ï¼Œå¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡é€šä¿¡ã€æ•°æ®å­˜å‚¨å’Œæ•°æ®äº¤æ¢ç­‰ã€‚ åœ¨gRPCä¸­ï¼Œé»˜è®¤ä½¿ç”¨Protocol Buffersä½œä¸ºåºåˆ—åŒ–æŠ€æœ¯ï¼Œå¯ä»¥é€šè¿‡.protoæ–‡ä»¶å®šä¹‰æœåŠ¡æ¥å£å’Œæ¶ˆæ¯ç±»å‹ï¼Œç„¶åä½¿ç”¨gRPCå·¥å…·è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚è¿™æ ·å¯ä»¥ç®€åŒ–å¼€å‘å·¥ä½œï¼Œå¹¶æä¾›é«˜æ€§èƒ½å’Œè·¨è¯­è¨€çš„RPCé€šä¿¡èƒ½åŠ›ã€‚ ThriftThrift æ˜¯ä¸€ç§è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¡†æ¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§åºåˆ—åŒ–æŠ€æœ¯ã€‚å®ƒæœ€åˆç”± Facebook å¼€å‘ï¼Œç”¨äºè§£å†³å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é€šä¿¡å’Œæ•°æ®äº¤æ¢é—®é¢˜ã€‚Thrift æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ C++ï¼Œä½¿å¾—ä¸åŒè¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºå¯ä»¥è¿›è¡Œè·¨è¯­è¨€é€šä¿¡ã€‚ Thrift æä¾›äº†ä¸€ä¸ªæ¥å£å®šä¹‰è¯­è¨€ï¼ˆIDLï¼‰ï¼Œç”¨äºå®šä¹‰æ•°æ®ç±»å‹å’ŒæœåŠ¡æ¥å£ã€‚é€šè¿‡å®šä¹‰IDLï¼Œå¯ä»¥ç”Ÿæˆå¯¹åº”è¯­è¨€çš„ä»£ç ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„çš„åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ä»£ç å’Œè¿œç¨‹æœåŠ¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä»£ç ã€‚ åœ¨ Thrift ä¸­ï¼Œæ•°æ®åœ¨ä¼ è¾“ä¹‹å‰ä¼šè¢«åºåˆ—åŒ–æˆå­—èŠ‚æµï¼Œåœ¨æ¥æ”¶ç«¯å†è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥è·¨ä¸åŒè¯­è¨€å’Œå¹³å°ä¼ è¾“æ•°æ®ï¼ŒåŒæ—¶èŠ‚çœå¸¦å®½å’Œç½‘ç»œå¼€é”€ã€‚Thrift æ”¯æŒå¤šç§åºåˆ—åŒ–åè®®ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶åè®®ã€å‹ç¼©åè®®å’Œå¯è¯»æ–‡æœ¬åè®®ç­‰ã€‚ åœ¨ C++ ä¸­ä½¿ç”¨ Thriftï¼Œä½ éœ€è¦å®šä¹‰ä½ çš„æ•°æ®ç»“æ„å’ŒæœåŠ¡æ¥å£ï¼Œå¹¶ä½¿ç”¨ Thrift ç¼–è¯‘å™¨ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚ç„¶åä½ å¯ä»¥åœ¨ä½ çš„ C++ ä»£ç ä¸­ä½¿ç”¨ç”Ÿæˆçš„ä»£ç æ¥è¿›è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–å’Œè¿œç¨‹è°ƒç”¨ã€‚Thrift æä¾›äº† C++ åº“æ¥æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œä½¿å¾—åœ¨ C++ ä¸­ä½¿ç”¨ Thrift å˜å¾—ç›¸å¯¹ç®€å• ##RapidJSON RapidJSON æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ C++ JSON è§£æå™¨&#x2F;ç”Ÿæˆå™¨ï¼Œæä¾›äº†ç®€å•æ˜“ç”¨çš„ APIï¼Œèƒ½å¤Ÿåœ¨é«˜æ•ˆåœ°å¤„ç† JSON æ•°æ®ã€‚ éœ€è¦å®‰è£…åº“ yum install rapidjson 123456789101112131415161718192021222324252627282930313233343536373839404142#include &quot;rapidjson/document.h&quot;#include &quot;rapidjson/writer.h&quot;#include &quot;rapidjson/stringbuffer.h&quot;#include &lt;iostream&gt;using namespace rapidjson;int main() &#123; // JSON å­—ç¬¦ä¸² const char* json = &quot;&#123;\\&quot;name\\&quot;:\\&quot;John\\&quot;,\\&quot;age\\&quot;:30,\\&quot;city\\&quot;:\\&quot;New York\\&quot;&#125;&quot;; // è§£æ JSON å­—ç¬¦ä¸² Document doc; doc.Parse(json); // æ£€æŸ¥è§£ææ˜¯å¦æˆåŠŸ if (!doc.IsObject()) &#123; std::cerr &lt;&lt; &quot;Invalid JSON format!&quot; &lt;&lt; std::endl; return 1; &#125; // è·å–å­—æ®µå€¼ if (doc.HasMember(&quot;name&quot;) &amp;&amp; doc[&quot;name&quot;].IsString()) &#123; std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; doc[&quot;name&quot;].GetString() &lt;&lt; std::endl; &#125; if (doc.HasMember(&quot;age&quot;) &amp;&amp; doc[&quot;age&quot;].IsInt()) &#123; std::cout &lt;&lt; &quot;Age: &quot; &lt;&lt; doc[&quot;age&quot;].GetInt() &lt;&lt; std::endl; &#125; if (doc.HasMember(&quot;city&quot;) &amp;&amp; doc[&quot;city&quot;].IsString()) &#123; std::cout &lt;&lt; &quot;City: &quot; &lt;&lt; doc[&quot;city&quot;].GetString() &lt;&lt; std::endl; &#125; // ç”Ÿæˆ JSON å­—ç¬¦ä¸² StringBuffer buffer; Writer&lt;StringBuffer&gt; writer(buffer); doc.Accept(writer); // è¾“å‡ºç”Ÿæˆçš„ JSON å­—ç¬¦ä¸² std::cout &lt;&lt; &quot;Generated JSON: &quot; &lt;&lt; buffer.GetString() &lt;&lt; std::endl; return 0;&#125; AVROApache Avro æ˜¯ä¸€ä¸ªæ•°æ®åºåˆ—åŒ–ç³»ç»Ÿï¼Œå®ƒæä¾›äº†ä¸€ç§è·¨è¯­è¨€çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ä¸ RapidJSON ä¸åŒï¼ŒAvro æ—¨åœ¨æä¾›æ›´å¤šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ”¯æŒæ•°æ®æ¶æ„ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰å’Œæ•°æ®å­˜å‚¨ç­‰ã€‚ éœ€è¦å»å®˜æ–¹ä¸‹è½½åº“ C++ ä¸­ä½¿ç”¨ Avro è¿›è¡Œæ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#include &lt;iostream&gt;#include &lt;avro/Encoder.hh&gt;#include &lt;avro/Decoder.hh&gt;#include &lt;avro/Compiler.hh&gt;#include &lt;avro/Generic.hh&gt;using namespace avro;struct Person &#123; std::string name; int age; Person() &#123;&#125; Person(const std::string&amp; name, int age) : name(name), age(age) &#123;&#125; // åºåˆ—åŒ–å‡½æ•° template&lt;typename Encoder&gt; void encode(Encoder&amp; encoder) const &#123; encoder.encode(name); encoder.encode(age); &#125; // ååºåˆ—åŒ–å‡½æ•° template&lt;typename Decoder&gt; void decode(Decoder&amp; decoder) &#123; decoder.decode(name); decoder.decode(age); &#125;&#125;;int main() &#123; // åˆ›å»º Person å¯¹è±¡ Person person(&quot;John&quot;, 30); // å°† Person å¯¹è±¡åºåˆ—åŒ–ä¸º Avro æ ¼å¼ std::vector&lt;uint8_t&gt; buffer; avro::OutputStreamPtr out = avro::memoryOutputStream(); avro::EncoderPtr encoder = avro::binaryEncoder(); encoder-&gt;init(*out); avro::encode(*encoder, person); // ä» Avro æ ¼å¼ååºåˆ—åŒ–ä¸º Person å¯¹è±¡ avro::InputStreamPtr in = avro::memoryInputStream(*out); avro::DecoderPtr decoder = avro::binaryDecoder(); decoder-&gt;init(*in); Person deserializedPerson; avro::decode(*decoder, deserializedPerson); // è¾“å‡ºååºåˆ—åŒ–åçš„ Person å¯¹è±¡ std::cout &lt;&lt; &quot;Deserialized Person: Name=&quot; &lt;&lt; deserializedPerson.name &lt;&lt; &quot;, Age=&quot; &lt;&lt; deserializedPerson.age &lt;&lt; std::endl; return 0;&#125; å»¶æ—¶å¾ªç¯æ—©æœŸ è®¡æ•°ç­‰å¾… while(wait&lt;10000) wait++; ä¸­å®šä¹‰äº†ä¸€ä¸ªç¬¦å·å¸¸é‡ _CLOCKS_PER_SEC è¯¥å¸¸é‡ç­‰äºæ¯ç§’é’ŸåŒ…å«çš„ç³»ç»Ÿæ—¶é—´å•ä½æ•° å°†ç³»ç»Ÿæ—¶é—´é™¤ä»¥è¿™ä¸ªå€¼ï¼Œå¯ä»¥å¾—åˆ°ç§’æ•° ç§’æ•°ä¹˜ä»¥CLOCK_PER_SECï¼Œå¯ä»¥å¾—åˆ°ä»¥ç³»ç»Ÿæ—¶é—´å•ä½ä¸ºå•ä½çš„æ—¶é—´ ctimeå°†clock_tä½œä¸ºclock( )è¿”å›ç±»å‹çš„åˆ«åï¼Œè¿™æ„å‘³ç€å¯ä»¥å°†å˜é‡å£°æ˜ä¸ºclock_tç±»å‹ï¼Œç¼–è¯‘å™¨å°†æŠŠå®ƒè½¬æ¢ä¸ºlongã€unsigned intæˆ–é€‚åˆç³»ç»Ÿçš„å…¶ä»–ç±»å‹ã€‚ 1234float se;clock_t delay = se*CLOCKS_PER_SEC;clock_t start = clock();while (clock()-start&lt;delay); bitset#include ç”¨äºé«˜æ•ˆå­˜å‚¨å’Œè®¿é—®å¸ƒå°”å€¼-æƒé™æ§åˆ¶ï¼ŒçŠ¶æ€æ ‡è®°ç­‰ æ„é€  bitset b Nä½å…¨0 bitset b(value) å­˜valueçš„äºŒè¿›åˆ¶ä½æ•°å°‘äºNè¡¥0ï¼Œå¤§äºåªå–ä½ä½Nä½ bitset b(str) å­—ç¬¦ä¸²åªåŒ…å«01 æ–¹æ³• size ä½æ•° count 1çš„ä½æ•° any åªå°‘æœ‰ä¸€ä¸ª1è¿”å›true none å…¨0è¿”å›true set å…¨ç½®ä¸º1 reset è®¾0 set(pos) æŒ‡å®šä½è®¾1 reset set(posï¼Œval) æŒ‡å®šä½è®¾ä¸ºval(0,1) flip ç¿»è½¬æ‰€æœ‰ä½ 0å˜1 1å˜0 (pos) ç¿»è½¬æŒ‡å®šä½ test(pos)ï¼šæµ‹è¯•æŒ‡å®šä½ç½®çš„ä½æ˜¯å¦ä¸º1ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›true to_ulong()ï¼šå°†bitsetçš„å†…å®¹è½¬æ¢ä¸ºunsigned longç±»å‹çš„å€¼ï¼ˆå¦‚æœbitsetçš„å¤§å°è¶…è¿‡äº†unsigned longçš„ä½æ•°ï¼Œåˆ™ä¼šå‘ç”Ÿæº¢å‡ºï¼‰ã€‚ to_ullong()ï¼šå°†bitsetçš„å†…å®¹è½¬æ¢ä¸ºunsigned long longç±»å‹çš„å€¼ï¼ˆå¦‚æœbitsetçš„å¤§å°è¶…è¿‡äº†unsigned long lonçš„ä½æ•°ï¼Œåˆ™ä¼šå‘ç”Ÿæº¢å‡ºï¼‰ã€‚ to_string()ï¼šå°†bitsetçš„å†…å®¹è½¬æ¢ä¸ºåŒ…å«â€™0â€™å’Œâ€™1â€™çš„å­—ç¬¦ä¸²ã€‚","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]},{"title":"è®¾è®¡æ¨¡å¼","slug":"source/C++/è®¾è®¡æ¨¡å¼","date":"2025-03-10T16:00:00.000Z","updated":"2025-03-11T14:51:50.711Z","comments":true,"path":"2025/03/11/source/C++/è®¾è®¡æ¨¡å¼/","permalink":"http://example.com/2025/03/11/source/C++/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"å•ä¾‹æ¨¡å¼å®ƒç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚ æ‡’æ±‰æ¨¡å¼ï¼š&#x3D;&#x3D;ç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–&#x3D;&#x3D;ï¼Œåœ¨C++11åï¼Œä¸éœ€è¦åŠ é”ï¼Œç›´æ¥ä½¿ç”¨å‡½æ•°å†…å±€éƒ¨é™æ€å¯¹è±¡å³å¯ã€‚ 1234567891011121314151617181920212223#include &lt;iostream&gt;class Singleton &#123;private: // æ„é€ å‡½æ•°ç§æœ‰åŒ–ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ– Singleton() &#123;&#125; // æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ç§æœ‰åŒ–ï¼Œé˜²æ­¢æ‹·è´å’Œèµ‹å€¼ Singleton(const Singleton&amp;) = delete; Singleton&amp; operator=(const Singleton&amp;) = delete;public: static Singleton&amp; getInstance() &#123; static Singleton instance; //c++11 return instance; &#125;&#125;;int main() &#123; Singleton&amp; s1 = Singleton::getInstance(); Singleton&amp; s2 = Singleton::getInstance(); std::cout &lt;&lt; (&amp;s1 == &amp;s2) &lt;&lt; std::endl; // è¾“å‡º 1ï¼Œè¡¨ç¤ºä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ return 0;&#125; é¥¿æ±‰æ¨¡å¼ï¼š&#x3D;&#x3D;ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–&#x3D;&#x3D;ï¼Œä¸éœ€è¦åŠ é” 123456789101112131415161718192021222324#include &lt;iostream&gt;class Singleton &#123;private: Singleton() &#123;&#125; Singleton(const Singleton&amp;) = delete; Singleton&amp; operator=(const Singleton&amp;) = delete; static Singleton instance; //åŒºåˆ«1public: static Singleton&amp; getInstance() &#123; return instance; &#125;&#125;;// é™æ€æˆå‘˜å˜é‡çš„åˆå§‹åŒ–Singleton Singleton::instance; //åŒºåˆ«2int main() &#123; Singleton&amp; s1 = Singleton::getInstance(); Singleton&amp; s2 = Singleton::getInstance(); std::cout &lt;&lt; (&amp;s1 == &amp;s2) &lt;&lt; std::endl; // è¾“å‡º 1ï¼Œè¡¨ç¤ºä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ return 0;&#125; å·¥å‚æ¨¡å¼æä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†å…è®¸å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥å‚æ¨¡å¼å°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚åœ¨C++ä¸­ï¼Œå·¥å‚æ¨¡å¼é€šå¸¸åˆ†ä¸ºç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰ äº§å“ç±»+å·¥å‚ç±»ï¼Œå·¥å‚ç±»æ ¹æ®äº§å“ç‰¹æ€§è¿”å›å„è‡ªç±»å¯¹è±¡æŒ‡é’ˆ 1234567891011121314151617181920212223242526272829303132#include &lt;iostream&gt;// æŠ½è±¡äº§å“ç±»class Product &#123;public: virtual void operation() = 0; //çº¯è™šå‡½æ•° æŠ½è±¡åŸºç±»&#125;;//äº§å“ç±»ConcreteProductAå’ŒConcreteProductBç»§æ‰¿Productå¹¶é‡å†™operationå‡½æ•°// ç®€å•å·¥å‚ç±»class SimpleFactory &#123;public: static Product* createProduct(char type) &#123; if (type == &#x27;A&#x27;) &#123; return new ConcreteProductA(); &#125; else if (type == &#x27;B&#x27;) &#123; return new ConcreteProductB(); &#125; else &#123; return nullptr; // æˆ–è€…æŠ›å‡ºå¼‚å¸¸ &#125; &#125;&#125;;int main() &#123; // ä½¿ç”¨ç®€å•å·¥å‚åˆ›å»ºäº§å“ Product* productA = SimpleFactory::createProduct(&#x27;A&#x27;); Product* productB = SimpleFactory::createProduct(&#x27;B&#x27;); // ä½¿ç”¨äº§å“ if (productA) productA-&gt;operation(); if (productB) productB-&gt;operation(); // é‡Šæ”¾å†…å­˜ delete productA; delete productB; return 0;&#125; å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Method Patternï¼‰ æ¯ä¸ªäº§å“æœ‰è‡ªå·±çš„å·¥å‚ 1234567891011121314151617181920212223242526// æŠ½è±¡å·¥å‚ç±»class Factory &#123;public: virtual Product* createProduct() = 0;&#125;;// å…·ä½“å·¥å‚ç±»Aclass ConcreteFactoryA : public Factory &#123;public: Product* createProduct() override &#123; return new ConcreteProductA(); &#125;&#125;;// å…·ä½“å·¥å‚ç±»Bclass ConcreteFactoryB : public Factory &#123;public: Product* createProduct() override &#123; return new ConcreteProductB(); &#125;&#125;; Factory* factoryA = new ConcreteFactoryA(); Product* productA = factoryA-&gt;createProduct(); productA-&gt;operation(); delete productA; delete factoryA; æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰ å·¥å‚æ–¹æ³•æ¨¡å¼çš„å‡çº§ï¼Œä¸€ä¸ªå·¥å‚ç®¡ç†ä¸€ç±»äº§å“ 123456789101112131415161718192021222324252627// æŠ½è±¡å·¥å‚ç±»class AbstractFactory &#123;public: virtual AbstractProductA* createProductA() = 0; virtual AbstractProductB* createProductB() = 0;&#125;;// å…·ä½“å·¥å‚ç±»1class ConcreteFactory1 : public AbstractFactory &#123;public: AbstractProductA* createProductA() override &#123; return new ConcreteProductA1(); &#125; AbstractProductB* createProductB() override &#123; return new ConcreteProductB1(); &#125;&#125;;int main() &#123; // ä½¿ç”¨å…·ä½“å·¥å‚1åˆ›å»ºäº§å“ AbstractFactory* factory1 = new ConcreteFactory1(); AbstractProductA* productA1 = factory1-&gt;createProductA(); AbstractProductB* productB1 = factory1-&gt;createProductB(); productA1-&gt;operationA(); productB1-&gt;operationB(); delete productA1; delete productB1; delete factory1; ä»£ç†æ¨¡å¼ä»£ç†ç±»å°è£…ä¸»é¢˜ç±»æŒ‡é’ˆä½œä¸ºæˆå‘˜ï¼Œç„¶åä»£ç†ç±»æä¾›æ–¹æ³•ï¼Œä½¿ç”¨ä»£ç†ç±»çš„æ–¹æ³•å®é™…å»è°ƒç”¨ä¸»é¢˜ç±»çš„æ–¹æ³• åº”ç”¨ï¼šè®°å½•æ—¥å¿—ã€æƒé™æ§åˆ¶ã€å»¶è¿ŸåŠ è½½ç­‰ã€‚ åœ¨C++ä¸­ï¼Œä»£ç†æ¨¡å¼é€šå¸¸åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤ç§å®ç°æ–¹å¼ã€‚ é™æ€ä»£ç†ï¼š é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡çš„å…³ç³»ï¼Œå¹¶åœ¨ä»£ç ä¸­æ˜¾å¼å®šä¹‰ä»£ç†ç±»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é™æ€ä»£ç†ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;iostream&gt;// æŠ½è±¡ä¸»é¢˜æ¥å£class Subject &#123;public: virtual void request() = 0;&#125;;// å…·ä½“ä¸»é¢˜ç±»class RealSubject : public Subject &#123;public: void request() override &#123; std::cout &lt;&lt; &quot;RealSubject handles the request.&quot; &lt;&lt; std::endl; &#125;&#125;;// ä»£ç†ç±»class Proxy : public Subject &#123;private: RealSubject* realSubject;public: Proxy() : realSubject(new RealSubject()) &#123;&#125; void request() override &#123; // åœ¨è°ƒç”¨å®é™…ä¸»é¢˜å¯¹è±¡å‰åå¯ä»¥æ‰§è¡Œé¢å¤–çš„æ“ä½œ std::cout &lt;&lt; &quot;Proxy handles the request.&quot; &lt;&lt; std::endl; realSubject-&gt;request(); &#125; ~Proxy() &#123; delete realSubject; &#125;&#125;;int main() &#123; Proxy proxy; proxy.request(); return 0;&#125; åŠ¨æ€ä»£ç†ï¼š åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œæ— éœ€æ˜¾å¼åœ°ç¼–å†™ä»£ç†ç±»ã€‚C++ä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚Boostã€C++æ ‡å‡†åº“æä¾›çš„std::functionå’Œstd::bindï¼‰æˆ–æ‰‹åŠ¨å®ç°åŠ¨æ€ä»£ç†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨std::functionå’Œstd::bindæ‰‹åŠ¨å®ç°çš„åŠ¨æ€ä»£ç†ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;iostream&gt;#include &lt;functional&gt;// æŠ½è±¡ä¸»é¢˜æ¥å£class Subject &#123;public: virtual void request() = 0;&#125;;// å…·ä½“ä¸»é¢˜ç±»class RealSubject : public Subject &#123;public: void request() override &#123; std::cout &lt;&lt; &quot;RealSubject handles the request.&quot; &lt;&lt; std::endl; &#125;&#125;;// åŠ¨æ€ä»£ç†ç±»class DynamicProxy : public Subject &#123;private: std::function&lt;void()&gt; before; std::function&lt;void()&gt; after; RealSubject* realSubject;public: DynamicProxy(RealSubject* realSubject, std::function&lt;void()&gt; before, std::function&lt;void()&gt; after) : realSubject(realSubject), before(before), after(after) &#123;&#125; void request() override &#123; before(); // åœ¨è°ƒç”¨å®é™…ä¸»é¢˜å¯¹è±¡å‰æ‰§è¡Œé¢å¤–çš„æ“ä½œ realSubject-&gt;request(); after(); // åœ¨è°ƒç”¨å®é™…ä¸»é¢˜å¯¹è±¡åæ‰§è¡Œé¢å¤–çš„æ“ä½œ &#125; ~DynamicProxy() &#123; delete realSubject; &#125;&#125;;int main() &#123; RealSubject* realSubject = new RealSubject(); // å®šä¹‰å‰ç½®å’Œåç½®æ“ä½œ auto before = []() &#123; std::cout &lt;&lt; &quot;DynamicProxy handles the request before RealSubject.&quot; &lt;&lt; std::endl; &#125;; auto after = []() &#123; std::cout &lt;&lt; &quot;DynamicProxy handles the request after RealSubject.&quot; &lt;&lt; std::endl; &#125;; // åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³• DynamicProxy dynamicProxy(realSubject, before, after); dynamicProxy.request(); return 0;&#125; è§‚å¯Ÿè€…æ¨¡å¼ä¸»é¢˜ç±»å«æœ‰å¤šä¸ªè§‚å¯Ÿè€…ç±»å¯¹è±¡ï¼Œé€šè¿‡ä¸»é¢˜ç±»ç»´æŠ¤è§‚å¯Ÿè€…ç±»çš„æ•°æ®ç»“æ„ï¼Œä¸»é¢˜ç±»è¿˜æœ‰ä¸€ä¸ªå˜é‡è®°å½•å½“å‰çŠ¶æ€ï¼Œå½“å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨è§‚å¯Ÿè€…ç±»çš„updateï¼Œå‘Šè¯‰è§‚å¯Ÿè€…ç±»çŠ¶æ€æ”¹å˜äº†ï¼Œå¹¶ä¸”è§‚å¯Ÿè€…ç±»å¯ä»¥è°ƒç”¨ä¸»é¢˜ç±»çš„æ¥å£æŸ¥çœ‹çŠ¶æ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#include &lt;iostream&gt;#include &lt;vector&gt;// è§‚å¯Ÿè€…æ¥å£class Observer &#123; public: virtual void update() = 0; //çº¯è™šå‡½æ•° æŠ½è±¡åŸºç±» &#125;;// ä¸»é¢˜æ¥å£class Subject &#123;protected: std::vector&lt;Observer*&gt; observers;public: void attach(Observer* observer) &#123; observers.push_back(observer); &#125; void detach(Observer* observer) &#123; observers.erase(std::remove(observers.begin(), observers.end(), observer), observers.end()); &#125; void notify() &#123; for (Observer* observer : observers) &#123; observer-&gt;update(); &#125; &#125;&#125;;// å…·ä½“ä¸»é¢˜ç±»class ConcreteSubject : public Subject &#123;private: int state;public: void setState(int newState) &#123; state = newState; notify(); // çŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥è§‚å¯Ÿè€… &#125; int getState() const &#123; return state; &#125;&#125;;// å…·ä½“è§‚å¯Ÿè€…ç±»class ConcreteObserver : public Observer &#123;private: ConcreteSubject* subject;public: ConcreteObserver(ConcreteSubject* subject) : subject(subject) &#123;&#125; void update() override &#123; std::cout &lt;&lt; &quot;Observer received state update: &quot; &lt;&lt; subject-&gt;getState() &lt;&lt; std::endl; &#125;&#125;;int main() &#123; // åˆ›å»ºå…·ä½“ä¸»é¢˜å¯¹è±¡å’Œå…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ ConcreteSubject subject; ConcreteObserver observer1(&amp;subject); ConcreteObserver observer2(&amp;subject); // å°†è§‚å¯Ÿè€…å¯¹è±¡æ·»åŠ åˆ°ä¸»é¢˜å¯¹è±¡çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ subject.attach(&amp;observer1); subject.attach(&amp;observer2); // æ”¹å˜ä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€ï¼Œè§‚å¯Ÿè€…å¯¹è±¡å°†æ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–° subject.setState(10); // å°†è§‚å¯Ÿè€…å¯¹è±¡ä»ä¸»é¢˜å¯¹è±¡çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤ subject.detach(&amp;observer2); // å†æ¬¡æ”¹å˜ä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€ï¼Œåªæœ‰å‰©ä½™çš„è§‚å¯Ÿè€…å¯¹è±¡å°†æ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–° subject.setState(20); return 0;&#125; ç­–ç•¥æ¨¡å¼ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ç«¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;iostream&gt;#include &lt;string&gt;// å®šä¹‰æ”¯ä»˜ç­–ç•¥çš„æŠ½è±¡åŸºç±»class PaymentStrategy &#123;public: virtual void pay(double amount) const = 0; virtual ~PaymentStrategy() &#123;&#125;&#125;;// å…·ä½“çš„æ”¯ä»˜ç­–ç•¥ï¼šä¿¡ç”¨å¡æ”¯ä»˜class CreditCardPayment : public PaymentStrategy &#123;public: void pay(double amount) const override &#123; std::cout &lt;&lt; &quot;Paid $&quot; &lt;&lt; amount &lt;&lt; &quot; using Credit Card.&quot; &lt;&lt; std::endl; &#125;&#125;;// å…·ä½“çš„æ”¯ä»˜ç­–ç•¥ï¼šæ”¯ä»˜å®æ”¯ä»˜class AlipayPayment : public PaymentStrategy &#123;public: void pay(double amount) const override &#123; std::cout &lt;&lt; &quot;Paid $&quot; &lt;&lt; amount &lt;&lt; &quot; using Alipay.&quot; &lt;&lt; std::endl; &#125;&#125;;// ä¸Šä¸‹æ–‡ç±»ï¼Œä½¿ç”¨æ”¯ä»˜ç­–ç•¥class ShoppingCart &#123;private: PaymentStrategy* paymentStrategy;public: ShoppingCart(PaymentStrategy* strategy) : paymentStrategy(strategy) &#123;&#125; // è®¾ç½®æ”¯ä»˜ç­–ç•¥ void setPaymentStrategy(PaymentStrategy* strategy) &#123; paymentStrategy = strategy; &#125; // ç»“è´¦æ–¹æ³•ï¼Œä½¿ç”¨å½“å‰çš„æ”¯ä»˜ç­–ç•¥è¿›è¡Œæ”¯ä»˜ void checkout(double amount) &#123; paymentStrategy-&gt;pay(amount); &#125;&#125;;int main() &#123; // åˆ›å»ºå…·ä½“çš„æ”¯ä»˜ç­–ç•¥å¯¹è±¡ CreditCardPayment creditCardPayment; AlipayPayment alipayPayment; // åˆ›å»ºè´­ç‰©è½¦å¹¶ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ç­–ç•¥ ShoppingCart cart(&amp;creditCardPayment); cart.checkout(100.0); // åˆ‡æ¢åˆ°æ”¯ä»˜å®æ”¯ä»˜ç­–ç•¥ cart.setPaymentStrategy(&amp;alipayPayment); cart.checkout(200.0); return 0;&#125; è£…é¥°å™¨æ¨¡å¼åœºæ™¯ï¼šå¥¶èŒ¶åº— ç»„ä»¶ç±»ï¼ˆå­ç±»ï¼šå’–å•¡ï¼‰ï¼Œè£…é¥°å™¨ç±»ï¼ˆå­ç±»ï¼šç‰›å¥¶ï¼Œç³–ï¼‰ï¼Œè£…é¥°å™¨ç±»å«ç»„ä»¶ç±»ç‰›å¥¶æŒ‡é’ˆï¼Œé€šè¿‡è£…é¥°å™¨ç±»å¯ä»¥å°†ç‰›å¥¶æˆ–ç³–çš„ä¿¡æ¯ä¸å’–å•¡ç»“åˆï¼Œæ‰“å°å‡ºæ–°çš„ä»·æ ¼ç­‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#include &lt;iostream&gt;#include &lt;string&gt;// æŠ½è±¡ç»„ä»¶ç±»ï¼šé¥®å“class Beverage &#123;public: virtual std::string getDescription() const = 0; virtual double cost() const = 0; virtual ~Beverage() &#123;&#125;&#125;;// å…·ä½“ç»„ä»¶ç±»ï¼šå’–å•¡class Coffee : public Beverage &#123;public: std::string getDescription() const override &#123; return &quot;Coffee&quot;; &#125; double cost() const override &#123; return 2.0; &#125;&#125;;// æŠ½è±¡è£…é¥°å™¨ç±»class CondimentDecorator : public Beverage &#123;protected: Beverage* beverage;public: CondimentDecorator(Beverage* bev) : beverage(bev) &#123;&#125; std::string getDescription() const override = 0; double cost() const override = 0;&#125;;// å…·ä½“è£…é¥°å™¨ç±»ï¼šç‰›å¥¶class Milk : public CondimentDecorator &#123;public: Milk(Beverage* bev) : CondimentDecorator(bev) &#123;&#125; std::string getDescription() const override &#123; return beverage-&gt;getDescription() + &quot;, Milk&quot;; &#125; double cost() const override &#123; return beverage-&gt;cost() + 0.5; &#125;&#125;;// å…·ä½“è£…é¥°å™¨ç±»ï¼šç³–class Sugar : public CondimentDecorator &#123;public: Sugar(Beverage* bev) : CondimentDecorator(bev) &#123;&#125; std::string getDescription() const override &#123; return beverage-&gt;getDescription() + &quot;, Sugar&quot;; &#125; double cost() const override &#123; return beverage-&gt;cost() + 0.3; &#125;&#125;;int main() &#123; // åˆ›å»ºä¸€æ¯çº¯å’–å•¡ Beverage* coffee = new Coffee(); std::cout &lt;&lt; coffee-&gt;getDescription() &lt;&lt; &quot; costs $&quot; &lt;&lt; coffee-&gt;cost() &lt;&lt; std::endl; // ä¸ºå’–å•¡æ·»åŠ ç‰›å¥¶ Beverage* coffeeWithMilk = new Milk(coffee); std::cout &lt;&lt; coffeeWithMilk-&gt;getDescription() &lt;&lt; &quot; costs $&quot; &lt;&lt; coffeeWithMilk-&gt;cost() &lt;&lt; std::endl; // ä¸ºåŠ äº†ç‰›å¥¶çš„å’–å•¡å†æ·»åŠ ç³– Beverage* coffeeWithMilkAndSugar = new Sugar(coffeeWithMilk); std::cout &lt;&lt; coffeeWithMilkAndSugar-&gt;getDescription() &lt;&lt; &quot; costs $&quot; &lt;&lt; coffeeWithMilkAndSugar-&gt;cost() &lt;&lt; std::endl; // é‡Šæ”¾å†…å­˜ delete coffeeWithMilkAndSugar; delete coffeeWithMilk; delete coffee; return 0;&#125; é€‚é…å™¨æ¨¡å¼æ¡¥æ¥æ¨¡å¼è´£ä»»é“¾æ¨¡å¼","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]},{"title":"c++æ–°ç‰¹æ€§","slug":"source/C++/C++ æ–°ç‰¹æ€§","date":"2025-03-10T16:00:00.000Z","updated":"2025-03-11T14:51:50.471Z","comments":true,"path":"2025/03/11/source/C++/C++ æ–°ç‰¹æ€§/","permalink":"http://example.com/2025/03/11/source/C++/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/","excerpt":"","text":"c++11c++11ä¸­æœ‰ç‰¹åˆ«çš„ç»å¸¸ä½¿ç”¨çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¯´æœ€å°‘éƒ½å¾—ä½¿ç”¨c++11 auto unordered_map thread c++æ­£åˆ™è¡¨è¾¾å¼åº“(RE) ##move std::moveæ˜¯c++11ä¸­æä¾›çš„ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œå°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œå¯ä»¥è°ƒç”¨å¯¹è±¡çš„ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼Œé¿å…ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œé…åˆå³å€¼å¼•ç”¨å£°æ˜ç¬¦ &amp;&amp; ä½¿ç”¨ å³å€¼å¼•ç”¨å®ƒä¸º C++ ä¸­çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘æä¾›äº†åŸºç¡€ã€‚å³å€¼å¼•ç”¨å¯ä»¥ç»‘å®šåˆ°ä¸´æ—¶å¯¹è±¡ï¼ˆå³å€¼ï¼‰ï¼Œå¹¶å…è®¸å¯¹å…¶è¿›è¡Œä¿®æ”¹æˆ–ç§»åŠ¨ int&amp;&amp; rvalueRef &#x3D; 5; &#x2F;&#x2F; å³å€¼å¼•ç”¨ç»‘å®šåˆ°ä¸´æ—¶å¯¹è±¡ 5 å³å€¼å¼•ç”¨å£°æ˜ç¬¦ &amp;&amp; ç§»åŠ¨è¯­ä¹‰ï¼šç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦é…åˆstd::moveä½¿ç”¨ MyString(MyString&amp;&amp; other) noexcept : data(other.data), length(other.length) MyString&amp; operator&#x3D;(MyString&amp;&amp; other) noexcept å®Œç¾è½¬å‘ï¼šstd::forward()ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ä¿æŒå‚æ•°çš„ç±»å‹å’Œå€¼ç±»åˆ«ï¼ˆå·¦å€¼æˆ–å³å€¼ï¼‰ä¸å˜ 12345678910#include &lt;iostream&gt;#include &lt;utility&gt;void print(int&amp; x) &#123;std::cout &lt;&lt; &quot;Lvalue: &quot; &lt;&lt; x &lt;&lt; std::endl;&#125;void print(int&amp;&amp; x) &#123;std::cout &lt;&lt; &quot;Rvalue: &quot; &lt;&lt; x &lt;&lt; std::endl;&#125;template&lt;typename T&gt; void forwardPrint(T&amp;&amp; arg) &#123;print(std::forward&lt;T&gt;(arg));&#125;//forwardç”¨åœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œä¿æŒå‚æ•°ç±»å‹ä¸€è‡´int main() &#123; int a = 10; forwardPrint(a); // è½¬å‘å·¦å€¼ forwardPrint(20); // è½¬å‘å³å€¼ return 0;&#125; å¼•ç”¨æŠ˜å è§„åˆ™ï¼šå‚æ•°ä¸ºå·¦å€¼&#x2F;å·¦å€¼å¼•ç”¨ï¼ŒT&amp;&amp;å°†è½¬åŒ–ä¸ºint&amp;ï¼›å‚æ•°ä¸ºå³å€¼&#x2F;å³å€¼å¼•ç”¨ï¼ŒT&amp;&amp;å°†è½¬åŒ–ä¸ºint&amp;&amp; å£°æ˜å‡ºæ¥çš„å·¦å€¼å¼•ç”¨ã€å³å€¼å¼•ç”¨éƒ½æ˜¯å·¦å€¼ tuple#include åˆ›å»º 12auto t1 = make_tuple(1, 3.14, &#x27;a&#x27;); // ä½¿ç”¨ make_tuple tuple&lt;int, double, char&gt; t2(1, 3.14, &#x27;a&#x27;); // ç›´æ¥åˆå§‹åŒ– è®¿é—® 123456// ä½¿ç”¨ std::get int first = get&lt;0&gt;(t1); double second = sget&lt;1&gt;(t1); char third = get&lt;2&gt;(t1); // C++17 ç»“æ„åŒ–ç»‘å®š auto [i, d, c] = t1; å¤§å°å’Œç±»å‹ 12static_assert(tuple_size&lt;decltype(t1)&gt;::value == 3, &quot;Tuple size is 3&quot;); static_assert(is_same&lt;tuple_element&lt;1, decltype(t1)&gt;::type, double&gt;::value, &quot;Second element is double&quot;); ä¿®æ”¹å€¼ 12tuple&lt;int, double, char&gt; mutableTuple(1, 3.14, &#x27;a&#x27;); get&lt;0&gt;(mutableTuple) = 2; // ä¿®æ”¹ç¬¬ä¸€ä¸ªå…ƒç´  æ¯”è¾ƒ 1234auto t3 = make_tuple(1, 2.0, &#x27;b&#x27;); if (t1 &lt; t3) &#123; // t1 åœ¨å­—å…¸åºä¸Šå°äº t3 &#125; ç»“æ„ä¸åˆå¹¶ c++17 12auto [a, b, c] = t1; // è§£æ„ auto combined = tuple_cat(t1, make_tuple(42)); // åˆå¹¶ ä½¿ç”¨åœºæ™¯ éœ€è¦ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼æ—¶ éœ€è¦å­˜å‚¨æˆ–ä¼ é€’ä¸€ç»„å¼‚è´¨ï¼ˆä¸åŒç±»å‹ï¼‰çš„æ•°æ®æ—¶ æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­ï¼Œç”¨äºç±»å‹åˆ—è¡¨æˆ–å€¼åˆ—è¡¨ lambdaå®ƒæ˜¯ä¸€ç§åŒ¿åå‡½æ•°çš„å£°æ˜æ–¹å¼ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶å†…è”å®šä¹‰å‡½æ•°ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“è¯» [capture list] (parameter list) -&gt; return type &#123; function body &#125; capture listï¼šæ•è·åˆ—è¡¨ï¼Œç”¨äºæŒ‡å®š lambda è¡¨è¾¾å¼è®¿é—®çš„å¤–éƒ¨å˜é‡çš„æ–¹å¼ã€‚ å€¼æ•è·[var]ã€å¼•ç”¨æ•è·[&amp;var] [&#x3D;],æ•è·æ‰€åœ¨ä½œç”¨åŸŸæ‰€æœ‰å˜é‡çš„å€¼ [&amp;]ï¼Œæ•è·ä½œç”¨åŸŸå†…æ‰€æœ‰å‚æ•°çš„å¼•ç”¨ [&#x3D;, &amp;var] varä»¥å¼•ç”¨æ–¹å¼æ•è·å…¶ä»–ä»¥å€¼çš„æ–¹å¼ [&amp;, var] parameter listï¼šå‚æ•°åˆ—è¡¨ï¼ŒæŒ‡å®š lambda å‡½æ•°çš„å‚æ•°ã€‚ä¸æ™®é€šå‡½æ•°å‚æ•°ç±»ä¼¼ï¼Œå¯ä»¥ä¸ºç©ºæˆ–åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ return typeï¼šè¿”å›ç±»å‹ï¼ŒæŒ‡å®š lambda å‡½æ•°çš„è¿”å›ç±»å‹ã€‚å¯ä»¥çœç•¥ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨å¯¼è¿”å›ç±»å‹ã€‚ function bodyï¼šå‡½æ•°ä½“ï¼ŒæŒ‡å®š lambda å‡½æ•°çš„å…·ä½“å®ç° å¯å˜lambdaï¼šä¸€èˆ¬æ•è·çš„å˜é‡ä¸èƒ½ä¿®æ”¹è¦ä¿®æ”¹éœ€è¦ä½¿ç”¨mutable auto lambda &#x3D; [num]() mutable { 123456789101112#include &lt;iostream&gt;int main() &#123; // å®šä¹‰ä¸€ä¸ª lambda è¡¨è¾¾å¼ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œ auto sum = [](int a, int b) -&gt; int &#123; return a + b; &#125;; // ä½¿ç”¨ lambda è¡¨è¾¾å¼è®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„å’Œ int result = sum(3, 4); std::cout &lt;&lt; &quot;Sum: &quot; &lt;&lt; result &lt;&lt; std::endl; return 0;&#125; 12345678910111213#include &lt;iostream&gt;int main() &#123; int x = 3; int y = 4; // æ•è· x å’Œ y çš„å€¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬çš„å’Œ auto sum = [x, y]() &#123; return x + y; &#125;; // ä½¿ç”¨ lambda è¡¨è¾¾å¼è®¡ç®— x å’Œ y çš„å’Œ int result = sum(); std::cout &lt;&lt; &quot;Sum: &quot; &lt;&lt; result &lt;&lt; std::endl; return 0;&#125; for eachå¯¹å®¹å™¨ä¸­çš„å…ƒç´ æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œ,æ¥å—ä¸€ä¸ªèŒƒå›´ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå®¹å™¨çš„è¿­ä»£å™¨å¯¹ï¼‰å’Œä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼ˆå‡½æ•°æŒ‡é’ˆã€å‡½æ•°æˆ–è€… Lambda è¡¨è¾¾å¼ï¼‰ï¼Œå¹¶å°†è¯¥å‡½æ•°å¯¹è±¡åº”ç”¨äºèŒƒå›´å†…çš„æ¯ä¸ªå…ƒç´  1234567891011121314151617181920212223#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;// ç¤ºä¾‹å‡½æ•°å¯¹è±¡struct Print &#123; void operator()(int x) const &#123; std::cout &lt;&lt; x &lt;&lt; &quot; &quot;; &#125;&#125;;int main() &#123; std::vector&lt;int&gt; vec = &#123;1, 2, 3, 4, 5&#125;; // ä½¿ç”¨å‡½æ•°å¯¹è±¡ Print è¾“å‡ºæ¯ä¸ªå…ƒç´  std::for_each(vec.begin(), vec.end(), Print()); // ä½¿ç”¨ Lambda è¡¨è¾¾å¼è¾“å‡ºæ¯ä¸ªå…ƒç´ çš„å¹³æ–¹ std::cout &lt;&lt; std::endl; std::for_each(vec.begin(), vec.end(), [](int x) &#123; std::cout &lt;&lt; x * x &lt;&lt; &quot; &quot;; &#125;); return 0;&#125; æ™ºèƒ½æŒ‡é’ˆ-RALLæœºåˆ¶è‡ªåŠ¨å†…å­˜ç®¡ç†ã€è‡ªåŠ¨é‡Šæ”¾ã€é˜²æ­¢å†…å­˜æ³„æ¼ç­‰ã€‚ C++11 æä¾›äº†ä¸‰ç§ä¸»è¦çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼š std::unique_ptrï¼š std::unique_ptr ç‹¬å æ‹¥æœ‰æƒ å½“ std::unique_ptr è¢«é”€æ¯æ—¶ï¼Œå®ƒæ‰€ç®¡ç†çš„èµ„æºä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ ä¸èƒ½è¿›è¡Œæ‹·è´æ„é€ å’Œæ‹·è´èµ‹å€¼ï¼Œä½†å¯ä»¥è¿›è¡Œç§»åŠ¨æ„é€ (åˆå§‹åŒ–çš„æ—¶å€™move)å’Œç§»åŠ¨èµ‹å€¼(åˆå§‹åŒ–ä¹‹åä½¿ç”¨)-ä½¿ç”¨std::move()ç§»äº¤æ§åˆ¶æƒã€‚ std::shared_ptrï¼š å¤šä¸ª std::shared_pt&#96; å¯ä»¥åŒæ—¶æŒ‡å‘åŒä¸€å—å†…å­˜,å…±äº«æ‹¥æœ‰æƒã€‚ å¼•ç”¨è®¡æ•° ç®¡ç†èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“æœ€åä¸€ä¸ª std::shared_ptrè¢«é”€æ¯æ—¶ï¼Œå®ƒæ‰€ç®¡ç†çš„èµ„æºä¼šè¢«é‡Šæ”¾ã€‚ å¯ä»¥ä½¿ç”¨æ‹·è´ï¼Œå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ std::weak_ptrï¼š std::weak_ptr æ˜¯ std::shared_ptrçš„å¼±å¼•ç”¨ï¼Œä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ ä¸å½±å“èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œåªæ˜¯æä¾›äº†å¯¹èµ„æºçš„è§‚å¯Ÿã€‚ ä¸»è¦ç”¨äºè§£å†³ std::shared_ptr å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚(ä¸¤ä¸ªå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªshared_ptræŒ‡å‘å¯¹æ–¹å¯¼è‡´è®¡æ•°è‡³å°‘ä¸º1ï¼Œæ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾) è§‚å¯Ÿè€…æ¨¡å¼ï¼šé€šè¿‡-&gt;lock() æ–¹æ³•æ¥è·å–ä¸€ä¸ªshared_ptrï¼Œå¦‚æœæ‰€å¼•ç”¨çš„å¯¹è±¡è¿˜å­˜åœ¨ï¼ˆå³å¼•ç”¨è®¡æ•°å¤§äº 0ï¼‰ï¼Œä¼šè¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„shared_ptrï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªç©ºçš„ã€‚è¿™æ ·å°±å¯ä»¥å®‰å…¨åœ°è®¿é—®å¯èƒ½å·²ç»è¢«é”€æ¯çš„å¯¹è±¡ï¼ŒåŒæ—¶é¿å…äº†ä¸åˆç†åœ°å»¶é•¿å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ ç¼“å­˜ç³»ç»Ÿï¼šå¦‚æœå­˜åœ¨åˆ™è¿”å›èµ„æºï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°çš„ ä½¿ç”¨1234//ç›´æ¥ä½¿ç”¨new éœ€è¦æ˜¾å¼é‡Šæ”¾std::unique_ptr&lt;int&gt; ptr(new int(42));//ä½¿ç”¨make_uniqueauto ptr = std::make_unique&lt;int&gt;(42); 1234567unique_ptr / shared_ptrauto ptr1 = std::make_unique&lt;Resource&gt;(&quot;Resource1&quot;);std::unique_ptr&lt;Resource&gt; ptr2(new Resource(&quot;Resource2&quot;));weak_ptrstd::weak_ptr&lt;Resource&gt; ptr5 = ptr3; //*ä»shared_ptråˆ›å»ºweak_ptr* if (auto shared_ptr = ptr5.lock()) &#123;&#125; //é€šè¿‡lockä½¿ç”¨ çº¿ç¨‹å®‰å…¨äº’æ–¥é”mutex åŸå­æ“ä½œatomic è¯»å†™é” shared_mutex æ¡ä»¶å˜é‡condition_variable çº¿ç¨‹å±€éƒ¨å­˜å‚¨ æ— é”æ•°æ®ç»“æ„ å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨å®ç° mutex#include å®šä¹‰ï¼šstd::mutex mtx; ä½¿ç”¨ï¼š lock&#x2F;unlock ä½¿ç”¨ mtx.lock(); mtx.unlock(); lock_guardï¼ˆRAIIæ–¹å¼ï¼‰ std::lock_guard&lt;std::mutex&gt; lock(mtx); unique_lockï¼ˆæ›´çµæ´»çš„RAIIæ–¹å¼ï¼‰ å¯ä»¥é‡æ–°è§£é”ä¸Šé”ï¼Œå¯ä»¥é…åˆæ¡ä»¶å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨moveè½¬è®©æ‰€æœ‰æƒ å»¶è¿Ÿé”å®šdefer_lock std::unique_lock &lt;std::mutex&gt; lock1(mtx, std::defer_lock); std::unique_lock &lt;std::mutex&gt; lock2(to.mtx, std::defer_lock); &#x2F;&#x2F;å¦ä¸€ä¸ªå¯¹è±¡toä½œä¸ºå‚æ•°ï¼Œ &#x2F;&#x2F; é¿å…æ­»é”çš„åŒæ—¶åŠ é” std::lock(lock1, lock2); try_lock çš„ä½¿ç”¨ éé˜»å¡æ²¡æœ‰è·å–é”ç«‹å³è¿”å› if (mtx.try_lock()) {â€¦} â€‹ mtx.unlock(); } æ¡ä»¶å˜é‡condition_variable#include ç›¸å¯¹äºmutexï¼Œä½¿çº¿ç¨‹èƒ½æŒ‰é¡ºåºæ‰§è¡Œ mesaè¯­ä¹‰ï¼šwhile (!condition) &#123;wait(cv);&#125; é˜²æ­¢è™šå‡å”¤é†’ï¼Œå³ä½¿è¢«è™šå‡å”¤é†’ä¹Ÿä¼šæ£€æŸ¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œç¡®ä¿å®‰å…¨ï¼Œè€Œä¸æ˜¯ç”¨if c++11çš„waitå¸¦è°“è¯(è¿”å›boolçš„åˆ¤æ–­æ¡ä»¶)ç‰ˆæœ¬cv.wait(lock, [this]&#123; return condition; &#125;); 1234567891011121314mutable std::mutex mtx; std::condition_variable cv;//ä¸€ä¸ªçº¿ç¨‹std::unique_lock&lt;std::mutex&gt; lock(mtx);...cv.notify_one(); //é€šçŸ¥ä¸€ä¸ªæ­£åœ¨waitçš„çº¿ç¨‹//å¦ä¸€ä¸ªçº¿ç¨‹std::unique_lock&lt;std::mutex&gt; lock(mtx);while (!condition) &#123; cv.wait(lock);&#125;... notify_one notify_all wait wait_for ç­‰å¾…ä¸€æ®µæ—¶é—´ wait_until ç­‰å¾…åˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ 1234567891011while (queue.empty()) &#123; not_empty.wait(lock);&#125;bool success = not_empty.wait_for(lock, timeout, [this]() &#123; return !queue.empty(); &#125;);bool success = not_empty.wait_until(lock, deadline, [this]() &#123; return !queue.empty();&#125;); é˜²æ­¢è¢«ç»§æ‰¿ final c++14æ¨¡æ¿å‡½æ•°make_unique æ³›å‹lambdaè¡¨è¾¾å¼ï¼šå…è®¸ä½¿ç”¨autoç±»å‹ä½œä¸ºå‚æ•° è®¸å‡½æ•°åœ¨ä¸ä½¿ç”¨ decltype çš„æƒ…å†µä¸‹è¿›è¡Œè¿”å›ç±»å‹æ¨å¯¼ã€‚ å˜é‡æ¨¡æ¿ 123456789#include &lt;iostream&gt;template &lt;typename T&gt;constexpr T pi = T(3.1415926535897932385);int main() &#123; std::cout &lt;&lt; pi&lt;double&gt; &lt;&lt; std::endl; return 0;&#125; äºŒè¿›åˆ¶å­—é¢é‡å’Œå•å¼•å·ä½œæ•°å­—åˆ†éš”ç¬¦ ä½¿ç”¨ 0bæˆ– 0B å‰ç¼€è¡¨ç¤ºäºŒè¿›åˆ¶æ•° 12int binary = 0b1010; long long largeNumber = 1&#x27;000&#x27;000&#x27;000; c++17 if constexpræ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶æ¡ä»¶è¯­å¥ï¼Œåœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œæ¡ä»¶é€‰æ‹©ä¸åŒè·¯å¾„ è·¨å¹³å°æ–‡ä»¶ç³»ç»Ÿæ“ä½œåº“ std::filesystem variant unionè”åˆçš„ç°ä»£æ›´å®‰å…¨æ›¿ä»£ ç»“æ„åŒ–ç»‘å®š123456789101112#include &lt;iostream&gt;#include &lt;tuple&gt;std::tuple&lt;int, double&gt; getValues() &#123; return std::make_tuple(1, 2.5);&#125;int main() &#123; auto [a, b] = getValues(); std::cout &lt;&lt; a &lt;&lt; &quot; &quot; &lt;&lt; b &lt;&lt; std::endl; return 0;&#125; std::optionalstd::optional è¡¨ç¤ºä¸€ä¸ªå¯èƒ½å­˜åœ¨çš„å€¼ï¼Œå®ƒå¯ä»¥åŒ…å«ä¸€ä¸ªå€¼æˆ–è€…ä¸ºç©ºï¼Œé¿å…äº†ä½¿ç”¨æŒ‡é’ˆå’Œç©ºæŒ‡é’ˆæ£€æŸ¥ 1234567891011121314151617#include &lt;iostream&gt;#include &lt;optional&gt;std::optional&lt;int&gt; getValue(bool condition) &#123; if (condition) &#123; return 42; &#125; return std::nullopt;&#125;int main() &#123; auto result = getValue(true); if (result) &#123; std::cout &lt;&lt; *result &lt;&lt; std::endl; &#125; return 0;&#125;","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]},{"title":"ä½¿ç”¨hexoæ„å»ºåšå®¢ç½‘ç«™","slug":"source/å·¥å…·-ç¯å¢ƒ/hexo","date":"2025-03-03T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/03/04/source/å·¥å…·-ç¯å¢ƒ/hexo/","permalink":"http://example.com/2025/03/04/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/hexo/","excerpt":"","text":"å‰ç½®å‡†å¤‡ä¸‹è½½Node.jsä½¿ç”¨nvmå®‰è£…Node.js 1234curl -o- https://gitee.com/mirrors/nvm/raw/v0.39.3/install.sh | bash #ä½¿ç”¨é•œåƒæºå®‰è£…nvmsource ~/.bashrcnvm --versionnvm install --lts #å®‰è£…Node ä¸‹è½½hexo12345678npm install hexo-cli -ghexo init blog #ç”¨hexoæ­å»ºä¸€ä¸ªæ–‡ä»¶å¤¹cd blog #ä¸‹è½½æ’ä»¶npm i hexo-theme-volantis --save #ä¸‹è½½ä¸»é¢˜volantisnpm i hexo-generator-json-content --save #æœç´¢åŠŸèƒ½npm i giscus --save #ä¸‹è½½è¯„è®ºç³»ç»Ÿnpm install hexo-deployer-git --save #gitæ¨é€ ç›®å½•ç»“æ„å’Œä½¿ç”¨è¯´æ˜&#x2F;public å­˜æ”¾ç”Ÿæˆåçš„é™æ€ç½‘é¡µèµ„æº&#x2F;source å­˜æ”¾æ„å»ºç½‘ç«™æ‰€éœ€è¦çš„æºæ–‡ä»¶ hexo g ç”Ÿæˆé™æ€ç½‘ç«™hexo s å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œè®¿é—®4000å·ç«¯å£å°±å¯ä»¥çœ‹åˆ°æ„å»ºçš„ç½‘é¡µhexo d éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨hexo clean &amp;&amp; hexo g -d å‰é¢ä¸‰ä¸ªå‘½ä»¤çš„é›†åˆ ä½¿ç”¨nginxä»£ç†ç½‘é¡µæŠŠpublicç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°nginxçš„htmlç›®å½•ä¸‹cd publiccp -rf * &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlå¯åŠ¨nginxæœåŠ¡è®¿é—®80ç«¯å£æŸ¥çœ‹ ä½¿ç”¨githubäº‘ä»£ç†ç½‘é¡µ æ–°å»ºä»“åº“ æ–°å»ºä»“åº“-ä»“åº“åå­—ï¼šç”¨æˆ·å.github.ioä»“åº“çš„mainåˆ†æ”¯ç”¨æ¥å­˜æºç¬”è®°æ–‡ä»¶ masteråˆ†æ”¯ç”¨æ¥å­˜å‰ç«¯æ–‡ä»¶ ç¼–è¾‘_config.yml 1234deploy: type: git repo: git@github.com:ä½ çš„ç”¨æˆ·å/ä½ çš„ç”¨æˆ·å.github.io.git branch: master è¿™é‡Œå¯ä»¥ä½¿ç”¨sshä¹Ÿå¯ä»¥ä½¿ç”¨http ä½¿ç”¨sshè¦å…ˆé…ç½®å¯†é’¥æˆ‘çš„sshåœ°å€ï¼šgit@github.com:tutuLP&#x2F;tutuLP.github.io.git é…ç½®gitç”¨æˆ·ä¿¡æ¯ git config â€“global user.email tutu2061867903@gmail.comgit config â€“global user.name tutuLP å¯èƒ½éœ€è¦æ‰“å¼€ç«¯å£22 9418 ä¿®æ”¹ä»“åº“é…ç½® è¿›å…¥GitHubä»“åº“çš„è®¾ç½®é¡µé¢-Pages-GitHub Pagesé€‰é¡¹ å°†æºè®¾ç½®ä¸ºmasteråˆ†æ”¯è¿™æ—¶å¾—åˆ°ç½‘å€ https://tutulp.github.io/ hexo d éƒ¨ç½²åˆ°githubæœåŠ¡å™¨å¹³å° ç›´æ¥åœ¨&#x2F;source&#x2F;_postsæ–‡ä»¶å¤¹ä¸‹å…‹éš†ä»“åº“è¿›è¡Œå¿«é€ŸåŒæ­¥ åç»­æ›´æ–°åšå®¢ æäº¤å¹¶pushåˆ°github cd &#x2F;root&#x2F;nginx&#x2F;blog&#x2F;source&#x2F;_posts&#x2F; git pull hexo generate hexo deploy è‡ªå®šä¹‰åŸŸåhttps://tutulp.github.io/ æ˜¯çš„ï¼Œä½ å¯ä»¥é€šè¿‡å°†è‡ªå®šä¹‰åŸŸåï¼ˆä¾‹å¦‚ä½ æ‹¥æœ‰çš„åŸŸåï¼‰æ˜ å°„åˆ°ä½ çš„GitHub Pagesç½‘ç«™æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ­¥éª¤ï¼š è´­ä¹°åŸŸåï¼šé¦–å…ˆï¼Œä½ éœ€è¦è´­ä¹°ä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚yourdomain.comã€‚ä½ å¯ä»¥é€šè¿‡æ³¨å†Œå•†ï¼ˆä¾‹å¦‚GoDaddyã€Namecheapç­‰ï¼‰è´­ä¹°åŸŸåã€‚ é…ç½®DNSè®°å½•ï¼šç™»å½•åˆ°ä½ çš„åŸŸåæ³¨å†Œå•†çš„æ§åˆ¶é¢æ¿ï¼Œå¹¶é…ç½®DNSè®°å½•ï¼Œå°†ä½ çš„åŸŸåæŒ‡å‘GitHub Pagesã€‚é€šå¸¸ï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ªCNAMEè®°å½•ï¼Œå°†åŸŸåæŒ‡å‘ä½ çš„GitHub Pagesç”¨æˆ·åï¼Œä¾‹å¦‚yourusername.github.ioã€‚å…·ä½“çš„æ­¥éª¤å¯èƒ½ä¼šå› æ³¨å†Œå•†è€Œå¼‚ï¼Œä½ å¯ä»¥å‚è€ƒGitHub Pagesæä¾›çš„æ–‡æ¡£æˆ–å‘æ³¨å†Œå•†å¯»æ±‚å¸®åŠ©ã€‚ åœ¨GitHubè®¾ç½®ä¸­é…ç½®è‡ªå®šä¹‰åŸŸåï¼šç™»å½•åˆ°GitHubï¼Œè¿›å…¥ä½ çš„ä»“åº“è®¾ç½®é¡µé¢ï¼Œå°†ä½ çš„è‡ªå®šä¹‰åŸŸåæ·»åŠ åˆ°â€Custom domainâ€å­—æ®µä¸­ã€‚ ç­‰å¾…DNSç”Ÿæ•ˆï¼šä¸€æ—¦ä½ é…ç½®äº†DNSè®°å½•å¹¶ä¿å­˜äº†æ›´æ”¹ï¼Œä½ éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆé€šå¸¸å‡ å°æ—¶è‡³48å°æ—¶ï¼‰ï¼Œç›´åˆ°DNSè®°å½•ç”Ÿæ•ˆã€‚ä¸€æ—¦ç”Ÿæ•ˆï¼Œä½ çš„åŸŸåå°±ä¼šæŒ‡å‘ä½ çš„GitHub Pagesç½‘ç«™ã€‚ HTTPSæ”¯æŒï¼šGitHub Pagesæ”¯æŒHTTPSï¼Œä½†ä½ éœ€è¦ç¡®ä¿ä½ çš„åŸŸåæœ‰æœ‰æ•ˆçš„SSLè¯ä¹¦ã€‚ä½ å¯ä»¥ä½¿ç”¨GitHubæä¾›çš„è‡ªåŠ¨ç”Ÿæˆçš„SSLè¯ä¹¦ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–è¯ä¹¦é¢å‘æœºæ„æä¾›çš„è¯ä¹¦ã€‚ ##shellè„šæœ¬è‡ªåŠ¨åŒ– &#x2F;rootä¸‹æ–°å»ºblog.sh 12345678#!/bin/bash cd /root/hexo/blog_new/source/_posts/tutuLP.github.io || exit git pull cd .. cd .. hexo generate hexo deploy echo &quot;åšå®¢éƒ¨ç½²å®Œæˆï¼&quot; bash blog.sh ä¸»é¢˜ç¾åŒ–æ ¹ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°_config.ymlçš„é…ç½®æ–‡ä»¶ï¼Œæ–°å»º_config.volantis.yml ä¿®æ”¹é…ç½®æ–‡ä»¶_config.yml 123456789title: tutulp&#x27;s blogdescription: &#x27;tutulpçš„åšå®¢ç½‘ç«™&#x27;author: tutulplanguage: zh-CNtheme: volantisdeploy: type: git repo: git@github.com:tutuLP/tutuLP.github.io.git branch: master _config.volantis.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135# å¹³æ»‘æ»šåŠ¨æ•ˆæœscroll_smooth: true#ä½œè€…article: body: meta_library: author: avatar: name: tutulp#æœç´¢search: enable: true service: hexo#æš—é»‘æ¨¡å¼plugins: darkmode: enable: true#è¯„è®º å‚è€ƒhttps://giscus.app/zh-CNcomments: title: &lt;i class=&#x27;fas fa-comments&#x27;&gt;&lt;/i&gt; è¯„è®º service: giscus giscus: repo: &quot;tutuLP/tutuLP.github.io&quot; repo-id: &quot;R_kgDOLk_elA&quot; category: &quot;Announcements&quot; category-id: &quot;DIC_kwDOLk_elM4Cnh_D&quot; mapping: &quot;pathname&quot; reactions-enabled: &quot;1&quot; emit-metadata: &quot;0&quot; lang: &quot;zh-CN&quot;#é¦–é¡µcover: height_scheme: full # full, half layout_scheme: search display: home: true archive: true others: true # can be written in front-matter &#x27;cover: true&#x27; categorie: true tag: true background: https://s3.bmp.ovh/imgs/2025/03/03/64c32e0ed0f747a9.jpg title: &#x27;Leland Titus&#x27; subtitle: &#x27;é£æ²‰äº‘ä¸‡é‡Œ&#x27; search: Recover lost knowledge # search bar placeholder features: - name: åšå®¢ icon: # img: volantis-static/media/twemoji/assets/svg/1f4f0.svg # https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg url: / - name: åˆ†ç±» icon: # img: volantis-static/media/twemoji/assets/svg/1f4f0.svg # https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg url: /categories/ - name: æ ‡ç­¾ icon: # img: volantis-static/media/twemoji/assets/svg/1f4f0.svg # https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg url: /tags/ - name: å½’æ¡£ url: /archives/ - name: ä½œè€… icon: # img: volantis-static/media/twemoji/assets/svg/1f9ec.svg # https://cdn.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg url: /about/#å¯¼èˆªæ navbar: visiable: auto # always, auto logo: # choose [img] or [icon + title] img: volantis-static/media/org.volantis/blog/Logo-NavBar@3x.png # https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png icon: title: menu: - name: åšå®¢ icon: fa-solid fa-rss url: / - name: åˆ†ç±» icon: fa-solid fa-folder-open url: categories/ - name: æ ‡ç­¾ icon: fa-solid fa-tags url: tags/ - name: å½’æ¡£ icon: fa-solid fa-archive url: /archives/ - name: ä½œè€… icon: fa-solid fa-info-circle url: about/ - name: æš—é»‘æ¨¡å¼ icon: fas fa-moon toggle: darkmode search: Search...#é¡µå°¾site_footer: # layout of footer: [aplayer, social, license, analytics, info(æœ¬ç«™ä¸»é¢˜), copyright] layout: [license2, info, copyright] source: https://github.com/volantis-x/volantis-docs/ # analytics using leancloud analytics: &gt; &lt;span id=&quot;lc-sv&quot;&gt;æœ¬ç«™æ€»è®¿é—®é‡ä¸º &lt;span id=&#x27;number&#x27;&gt;&lt;i class=&quot;fa-solid fa-loader fa-spin fa-fw&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;/span&gt; æ¬¡&lt;/span&gt; &lt;span id=&quot;lc-uv&quot;&gt;è®¿å®¢æ•°ä¸º &lt;span id=&#x27;number&#x27;&gt;&lt;i class=&quot;fa-solid fa-loader fa-spin fa-fw&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;/span&gt; äºº&lt;/span&gt; # site copyright license2: &gt; &lt;span id=&quot;lc-sv&quot;&gt;åšå®¢å†…å®¹éµå¾ª tutulp-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0) åè®®&lt;/span&gt; copyright: &#x27;[Copyright Â© since 2025 tutulp](/)&#x27;#ä¾§è¾¹éƒ¨ä»¶sidebar: widget_library: blogger: avatar: https://s3.bmp.ovh/imgs/2025/03/03/30639e1f0584064f.jpg shape: circle#æ ·å¼custom_css:#æŠ—é”¯é½¿ font_smoothing: true # font-smoothing for webkit#å¯¼èˆªæ  navbar: height: 64px width: auto # auto, max effect: [shadow, floatable, blur] # [shadow, floatable, blur]#æ»šåŠ¨æ¡ scrollbar: size: 10px border: 2px color: &#x27;#2196f3&#x27; hover: &#x27;#ff5722&#x27;#å­—ä½“ fontfamily: bodyfont: fontfamily: &#x27;OPPO-Sans&#x27; name: &#x27;OPPO-Sans&#x27; url: /fonts/OPPO-Sans.ttf codefont: fontfamily: &#x27;JetBrainsMono-Bold&#x27; name: &#x27;JetBrainsMono-Bold&#x27; url: /fonts/JetBrainsMono-Bold.ttf sourceéœ€è¦çš„æ–‡ä»¶123456789101112â”œâ”€â”€ aboutâ”‚ â””â”€â”€ index.mdâ”œâ”€â”€ categoriesâ”‚ â””â”€â”€ index.mdâ”œâ”€â”€ fontsâ”‚ â”œâ”€â”€ JetBrainsMono-Bold.ttfâ”‚ â”œâ”€â”€ OPPO-Sans.ttfâ”‚ â””â”€â”€ WenQuanYiZenHei.ttfâ”œâ”€â”€ _postsâ”‚ â””â”€â”€ sourceâ””â”€â”€ tags â””â”€â”€ index.md æ–°å»ºä¸Šè¿°ç›®å½•ç»“æ„ about&#x2F;index.md 123456789101112131415161718192021---layout: docsseo_title: å…³äºbottom_meta: falsesidebar: []twikoo: placeholder: æœ‰ä»€ä¹ˆæƒ³å¯¹æˆ‘è¯´çš„å‘¢ï¼Ÿ---&#123;% btns circle center grid5 %&#125;&lt;a&gt;&lt;img src=&#x27;https://s3.bmp.ovh/imgs/2025/03/03/30639e1f0584064f.jpg&#x27;&gt;&lt;b&gt;tutulp&lt;/b&gt;&lt;/a&gt;&#123;% endbtns %&#125;ä»æ­¤å¤©è¾¹å°½æ²‰äº‘ï¼Œ é£å·æ®‹é˜³æ²¡æ—§ç—•é‚®ç®±ï¼šn199m992@163.comQQï¼š2061867903githubï¼šhttps://github.com/tutuLPgiteeï¼šhttps://gitee.com/tutuLP categories&#x2F;index.md 12345---layout: categoryindex: truetitle: æ‰€æœ‰åˆ†ç±»--- tags&#x2F;index.md 12345---layout: tagindex: truetitle: æ‰€æœ‰æ ‡ç­¾--- fontså­˜æ”¾å­—ä½“æ–‡ä»¶ï¼Œåœ¨ymlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨egï¼š&#x2F;fonts&#x2F;JetBrainsMono-Bold.ttféœ€è¦ä½¿ç”¨å›¾ç‰‡çš„æ—¶å€™ä¹Ÿå¯ä»¥è¿™æ ·æ”¾å’Œå¼•ç”¨ æ­£ç¡®æ˜¾ç¤ºmdä¸­çš„å›¾ç‰‡typoraä¸­é‡‡å–å›¾ç‰‡å¤åˆ¶è§„åˆ™ä¸ºï¼š.&#x2F;images&#x2F;${filename}.assets_config.ymlä¸­è®¾å€¼post_asset_folder: truesourceæ–‡ä»¶å¤¹æ–°å»ºimagesæ–‡ä»¶å¤¹ï¼Œç„¶åå°†æ‰€æœ‰èµ„æºç›®å½•ä¸‹çš„.assetsæ–‡ä»¶å¤¹éƒ½å¤åˆ¶åˆ°å…¶ä¸­ï¼Œè¿™é‡Œé‡‡ç”¨è„šæœ¬å¤åˆ¶ 123456789101112131415161718192021#!/bin/bash# å®šä¹‰æºç›®å½•ï¼Œè¿™é‡Œå‡è®¾å½“å‰ç›®å½•ä¸ºæœç´¢èµ·å§‹ç‚¹source_dir=&quot;.&quot;# å®šä¹‰ç›®æ ‡ç›®å½•target_dir=&quot;/root/blog/blog/source/images/&quot;# æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºif [ ! -d &quot;$target_dir&quot; ]; then mkdir -p &quot;$target_dir&quot;fi# ä½¿ç”¨ find å‘½ä»¤æŸ¥æ‰¾æ‰€æœ‰ .assets åç¼€çš„æ–‡ä»¶å¤¹find &quot;$source_dir&quot; -type d -name &quot;*.assets&quot; | while read -r asset_folder; do # è·å– .assets æ–‡ä»¶å¤¹çš„åç§° folder_name=$(basename &quot;$asset_folder&quot;) # å¤åˆ¶ .assets æ–‡ä»¶å¤¹åˆ°ç›®æ ‡ç›®å½• cp -r &quot;$asset_folder&quot; &quot;$target_dir/$folder_name&quot; # è¾“å‡ºå¤åˆ¶ä¿¡æ¯ echo &quot;Copied $asset_folder to $target_dir/$folder_name&quot;done å‚è€ƒé“¾æ¥ä¸»é¢˜volantisï¼šhttps://volantis.js.org/v6/getting-started/ ImgURLå…è´¹å›¾åºŠï¼šhttps://www.imgurl.org/vip/manage è¯„è®ºç³»ç»Ÿï¼šhttps://artalk.js.org/ ç®€å†åšå®¢ï¼šhttps://resume.js.org/zh-cn/ å‚è€ƒç¾åŒ–æ•™ç¨‹ï¼šhttps://busyogg.github.io/article/38effc2a84e9/ ä¼˜ç§€åšå®¢ï¼šhttps://inkss.cn/ npmå›¾åºŠï¼šhttps://xingpingcn.top/npm%E5%9B%BE%E5%BA%8A%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%EF%BC%89.html","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://example.com/tags/hexo/"}]},{"title":"LeetCodeç®—æ³•æ€»ç»“","slug":"source/åˆ·é¢˜/LeetCodeä¸“é¢˜","date":"2025-03-01T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2025/03/02/source/åˆ·é¢˜/LeetCodeä¸“é¢˜/","permalink":"http://example.com/2025/03/02/source/%E5%88%B7%E9%A2%98/LeetCode%E4%B8%93%E9%A2%98/","excerpt":"","text":"é“¾è¡¨æ€»ç»“é€’å½’ é“¾è¡¨æ–¹å‘è½¬æ¢+nullpträ¸æ–­å‘å‰+å°¾èŠ‚ç‚¹æˆä¸ºå¤´èŠ‚ç‚¹ 123456789101112class Solution &#123; public: ListNode* reverseList(ListNode* head) &#123; if (head == nullptr || head-&gt;next == nullptr) &#123; return head; &#125; ListNode* newHead = reverseList(head-&gt;next); head-&gt;next-&gt;next = head; head-&gt;next = nullptr; return newHead; &#125;&#125;; æ ˆ(vector+rbegin+rend æˆ– stack) å…¶ä¸­å˜å¼é¢˜ç©¿æ’åŒæŒ‡é’ˆ åè½¬é“¾è¡¨###206 åè½¬é“¾è¡¨ ç¬¬ä¸€éè‡ªè§£ è€—æ—¶0ms 123456789101112131415161718192021class Solution &#123; public: ListNode* reverseList(ListNode* head) &#123; //éå†ä¸¤éï¼Œç¬¬ä¸€éä¾æ¬¡å–å‡ºèŠ‚ç‚¹çš„å€¼ç„¶åæ”¾å…¥æ ˆä¸­ï¼Œç¬¬äºŒéä»æ ˆä¸­æ‹¿å‡ºå…ƒç´ æ„å»ºé“¾è¡¨ int i=0; vector&lt;int&gt; tempList; ListNode * tempHead=head; while(tempHead!= nullptr)&#123;//æ³¨æ„è¿™é‡Œä¸æ˜¯tempHead-&gt;next tempList.push_back(tempHead-&gt;val); tempHead=tempHead-&gt;next; i++; &#125; tempHead=head;//è¿™é‡ŒçŠ¯é”™äº†ï¼Œç”¨tempHeadæ¥ç§»åŠ¨ï¼Œä¸è¦ç”¨head for (auto it = tempList.rbegin(); it != tempList.rend(); ++it) &#123; tempHead-&gt;val=(*it); tempHead=tempHead-&gt;next; &#125; return head; &#125;&#125;; è¿™é‡Œä½¿ç”¨satckæ˜¯ä¸€æ ·çš„æ•ˆæœ stack st; st.push(); while (!st.empty()) st.top(); st.pop(); ####é€’å½’å®ç° é€’å½’æ€è·¯ é€’å½’åˆ°æœ€æ·±å¤„å†ä¾æ¬¡è¿”å›ï¼Œé€’å½’åˆ°æœ«å°¾ç„¶åæŒ‡é’ˆæŒ‡å‘çš„é¡ºåºè°ƒè½¬ ç»ˆæ­¢æ¡ä»¶ï¼šé€’å½’åˆ°é“¾è¡¨çš„æœ«å°¾ é€’å½’åˆ°æœ€æ·±å¤„è¿”å›çš„head(é“¾è¡¨çš„å°¾èŠ‚ç‚¹)å°±æ˜¯åè½¬å®Œçš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œä½œä¸ºnewheadè¿”å›ï¼Œé€’å½’å›æ¥çš„æ—¶å€™ï¼ŒæŒ‡é’ˆæ–¹å‘ä¸æ–­åè½¬ï¼Œnullptrè¢«ä¸æ–­å¾€å‰ç§»åŠ¨ï¼Œæœ€ç»ˆç§»åŠ¨åˆ°åè½¬å‰çš„å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä½ 12345678910111213class Solution &#123; public: ListNode* reverseList(ListNode* head) &#123; if (head == nullptr || head-&gt;next == nullptr) &#123; //ç»ˆæ­¢æ¡ä»¶ æœ€åä¸€ä¸ªèŠ‚ç‚¹æœ€å…ˆæ»¡è¶³ç»ˆæ­¢æ¡ä»¶head-&gt;next == nullptrï¼Œè¿”å›æœ€åä¸€ä¸ªèŠ‚ç‚¹ return head; &#125; // é€’å½’åè½¬å­é“¾ ListNode* newHead = reverseList(head-&gt;next); // head-&gt;next-&gt;next = head; //æ‰§è¡Œé€»è¾‘ æœ€åä¸€ä¸ªèŠ‚ç‚¹è§¦å‘return head;æ‰€ä»¥æ­¤æ—¶headæ˜¯å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹ head-&gt;next = nullptr; return newHead; &#125;&#125;; ç»ˆæ­¢æ¡ä»¶åªçœ‹ä¸€æ¬¡ï¼Œè¿”å›å€¼è¿”å›åå°±ä¸ä¼šå˜ä¸€ç›´ä¼ é€’åˆ°æœ€å ä½œä¸ºæœ€ç»ˆçš„è¿”å› æ‰§è¡Œé€»è¾‘ æœ€åä¸€ä¸ªèŠ‚ç‚¹è§¦å‘ç»ˆæ­¢æ¡ä»¶è¿”å›ï¼Œæ‰§è¡Œé€»è¾‘åˆ™ä»ç¬¬å››ä¸ªèŠ‚ç‚¹å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ ####ä¸€ä¸ªå¾ªç¯ ä¹Ÿå°±æ˜¯å£°æ˜ä¸‰ä¸ªå˜é‡ï¼Œå½“å‰éå†çš„èŠ‚ç‚¹ï¼Œä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹? 123456789101112131415161718class Solution &#123; public: ListNode* reverseList(ListNode* head) &#123; if(!head || !head-&gt;next) return head; ListNode* pre = nullptr; auto cur = head; auto next = head-&gt;next; while(next) &#123; cur-&gt;next = pre; pre = cur; cur = next; next = next-&gt;next; &#125; cur-&gt;next = pre; return cur; &#125;&#125;; ###92 åè½¬é“¾è¡¨ ç»™å‡ºå¤´æŒ‡é’ˆå’Œä¸¤ä¸ªä½ç½®ï¼Œå°†ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„èŠ‚ç‚¹åè½¬ ç¬¬ä¸€éè‡ªè§£ 0ms æˆ‘çš„æ€è·¯ï¼šæ‰¾åˆ°åŒºé—´èµ·ç‚¹è®°å½•æŒ‡é’ˆåˆ°ç»ˆç‚¹ä¾æ¬¡å‹æ ˆç„¶åå†æ‹¿å‡ºæ¥ 123456789101112131415161718192021222324252627282930313233class Solution &#123; public: ListNode* reverseBetween(ListNode* head, int left, int right) &#123; if(head==nullptr)&#123; return head; &#125; stack&lt;int&gt; st; ListNode * tempHead = head; ListNode * leftNode; int index=1; int temp=0; while(tempHead!=nullptr)&#123; if(index==left)&#123; leftNode=tempHead; temp=1; &#125; if(temp==1)&#123; st.push(tempHead-&gt;val); &#125; if(index==right)&#123; break; &#125; tempHead=tempHead-&gt;next; index++; &#125; while(!st.empty())&#123; leftNode-&gt;val=st.top(); st.pop(); leftNode=leftNode-&gt;next; &#125; return head; &#125;&#125;; ####é€’å½’å®ç° åŒé€’å½’ æ€è·¯ï¼šä¸ºäº†ç®€åŒ–é€’å½’æ“ä½œï¼Œåè½¬aï¼Œbä¹‹é—´çš„èŠ‚ç‚¹ä¿®æ”¹ä¸ºåè½¬1åˆ°b-a+1ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œå¯¹åº”é€’å½’èµ·ç‚¹åç§»å¤šå°‘ä½ 12345678910111213141516171819202122class Solution &#123; public: ListNode* reverseBetween(ListNode* head, int left, int right) &#123; // åŸºæœ¬æƒ…å†µ if (left == 1) &#123; return reverseN(head, right); &#125; // å‰è¿›åˆ°åè½¬èµ·ç‚¹ head-&gt;next = reverseBetween(head-&gt;next, left - 1, right - 1); return head; &#125; private: ListNode* successor = nullptr;//ç”¨äºè®°å½•rightçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ListNode* reverseN(ListNode* head, int n) &#123; if (n == 1) &#123; successor = head-&gt;next; return head; &#125; ListNode* newHead = reverseN(head-&gt;next, n - 1); head-&gt;next-&gt;next = head; &#125;&#125;; ###25 kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨ è‡ªè§£ 0ms è®¾ç½®ä¸€ä¸ªå¾ªç¯ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯åˆ°è¾¾æœ«å°¾ï¼Œæ¯æ¬¡æŒ‡é’ˆå¾€åç§»åŠ¨ï¼Œå¯¹kå–æ¨¡ï¼Œä¸º0åˆ™ä¼ å…¥å½“å‰æŒ‡é’ˆå’Œkè¿›è¡Œåè½¬(å‹æ ˆ)ï¼Œåè½¬æ—¶åªå¯¹èŠ‚ç‚¹çš„å€¼è¿›è¡Œæ“ä½œæŒ‡é’ˆç»“æ„æ²¡æœ‰ç ´å 1234567891011121314151617181920212223242526272829303132333435363738394041424344class Solution &#123; public: ListNode* reverseKGroup(ListNode* head, int k) &#123; //åˆ¤ç©º if(head==nullptr)&#123; return head; &#125; //ç§»åŠ¨ï¼Œæ ¹æ®æ¡ä»¶è°ƒç”¨å‡½æ•° auto temp = head; int count = 0; while(temp-&gt;next!=nullptr)&#123; //å–ä½™ è°ƒç”¨å‡½æ•°-ä»£è¡¨éå†äº†kä¸ªèŠ‚ç‚¹ if(count%k==0)&#123; //è°ƒç”¨å‡½æ•° reserve(temp,k); &#125; temp=temp-&gt;next; count++; &#125; return head; &#125; private: void reserve(ListNode* head,int k)&#123; auto temp = head; stack&lt;int&gt; st; int sum = k; while(sum)&#123; sum--; if(temp==nullptr)&#123; //å½“é“¾è¡¨å‰©ä½™ä¸è¶³kä¸ªç›´æ¥è¿”ï¿½? return; &#125; st.push(temp-&gt;val); temp=temp-&gt;next; &#125; temp = head; sum = k; while(sum)&#123; sum--; temp-&gt;val=(st.top()); st.pop(); temp=temp-&gt;next; &#125; &#125;&#125;; ä¸€å¼€å§‹æˆ‘ç”¨å‹æ ˆçš„æ–¹å¼åªæ˜¯æ”¹å˜äº†å€¼ï¼Œä½†æ˜¯å®šçœ¼ä¸€çœ‹é¢˜ç›®è¦æ±‚æ˜¯æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ï¼Œé‚£å°±è¦ä¿®æ”¹ä¸€ä¸‹äº† çœŸæ­£åè½¬ï¿½? 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556class Solution &#123;public: ListNode* reverseKGroup(ListNode* head, int k) &#123; if (!head || k == 1) return head; // åˆ›å»ºè™šæ‹Ÿå¤´èŠ‚ï¿½? ListNode* dummy = new ListNode(0); dummy-&gt;next = head; ListNode* pre = dummy; while (head) &#123; // æ£€æŸ¥å‰©ä½™èŠ‚ç‚¹æ˜¯å¦è¶³å¤Ÿkï¿½? ListNode* tail = pre; for (int i = 0; i &lt; k; i++) &#123; tail = tail-&gt;next; if (!tail) &#123; return dummy-&gt;next; &#125; &#125; // ä¿å­˜ä¸‹ä¸€ç»„çš„èµ·å§‹ä½ç½® ListNode* next = tail-&gt;next; // åè½¬kä¸ªèŠ‚ï¿½? pair&lt;ListNode*, ListNode*&gt; result = reverseList(head, tail); head = result.first; tail = result.second; // è¿æ¥åè½¬åçš„å­é“¾ï¿½? pre-&gt;next = head; tail-&gt;next = next; // ç§»åŠ¨åˆ°ä¸‹ä¸€ï¿½? pre = tail; head = next; &#125; ListNode* ret = dummy-&gt;next; delete dummy; return ret; &#125;private: // åè½¬é“¾è¡¨ï¼Œè¿”å›æ–°çš„å¤´å’Œå°¾ pair&lt;ListNode*, ListNode*&gt; reverseList(ListNode* head, ListNode* tail) &#123; ListNode* prev = tail-&gt;next; ListNode* curr = head; while (prev != tail) &#123; ListNode* next = curr-&gt;next; curr-&gt;next = prev; prev = curr; curr = next; &#125; return &#123;tail, head&#125;; &#125;&#125;; ####é€’å½’ åè½¬çš„é€’å½’æ€è·¯ reverseä¼ å…¥ 1-&gt;2-&gt;3-&gt;null åè½¬å null&lt;-1&lt;-2&lt;-3 newheadç§»åŠ¨åˆ°æœ€å nullæ”¹ä¸ºtail reverseä¼ å…¥ 1(head)-&gt;2-&gt;3(cur)-&gt;tail tail&lt;-1(head)&lt;-2&lt;-3(cur) 3-&gt;2-&gt;1-&gt;tail 123456789101112131415161718192021222324252627282930class Solution &#123;public: ListNode* reverseKGroup(ListNode* head, int k) &#123; //åˆ¤ç©º if(!head) return head; //curæ˜¯åŒºé—´çš„æœ€åä¸€ä¸ªèŠ‚ï¿½? auto cur = head; for(int i = 0; i &lt; k-1; i++) &#123;//ç§»åŠ¨curå¹¶åˆ¤æ–­å‰©ä½™èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³kä¸ª if(!cur || !cur-&gt;next) return head; cur = cur-&gt;next; &#125; //nextæ˜¯åŒºé—´æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ auto next = cur-&gt;next; reverse(head, next); //(headï¼Œnull) head-&gt;next = reverseKGroup(next, k);//headèŠ‚ç‚¹ç»è¿‡åè½¬å·²ç»å˜æˆæœ€åä¸€ä¸ªèŠ‚ç‚¹ return cur;//è¿”å›çš„curæ˜¯ç¬¬ä¸€ä¸ªåè½¬åçš„å¤´æˆ–è€…æ²¡æœ‰ç»è¿‡åè½¬çš„head &#125; ListNode* reverse(ListNode* head, ListNode* tail) &#123; if(head == tail || head-&gt;next == tail) return head; auto newHead = reverse(head-&gt;next, tail); head-&gt;next-&gt;next = head; head-&gt;next = tail; return newHead; &#125;&#125;; ###24 ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ &#x2F;&#x2F;è¿™é“é¢˜ä¸å°±æ˜¯kä¸ªä¸€ç»„æŠŠkæ¢æˆäº†2å— ç¬¬ä¸€éè‡ªè§£ 0ms é€’å½’ å…¶å®ä¹Ÿå¯ä»¥ä¸ç”¨swapå‡½æ•°ï¼Œæˆ‘åªæ˜¯ä¸ºäº†ä¸kä¸ªä¸€ç»„ä¿æŒä¸€è‡´ è¿”å›çš„æ˜¯å½“å‰åŒºåŸŸçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå°±æ˜¯åè½¬ä¹‹åçš„å¤´èŠ‚ç‚¹ï¼Œåè½¬ä¹‹åheadå˜æˆäº†æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥head-&gt;next&#x3D;é€’å½’å‡½æ•°çš„è¿”å›å€¼,ä¸æ»¡è¶³æ¡ä»¶çš„éƒ½ä¼šåœ¨åè½¬ä¹‹å‰è¿”å›head 1234567891011121314151617181920212223class Solution &#123;public: ListNode* swapPairs(ListNode* head) &#123; //åˆ¤ç©º if(!head || !head-&gt;next) return head; //å¯»æ‰¾å½“å‰åŒºåŸŸçš„æœ€åä¸€ä¸ªèŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ auto end=head-&gt;next; auto tail=end-&gt;next; swap(head,tail); head-&gt;next=swapPairs(tail); return end; &#125; ListNode* swap(ListNode*head,ListNode*tail)&#123; if(head==tail||head-&gt;next==tail)&#123; return head; &#125; auto temphead=swap(head-&gt;next,tail); head-&gt;next-&gt;next=head; head-&gt;next=tail; return temphead; &#125;&#125;; åˆ é™¤é“¾è¡¨å…ƒç´ ###83 åˆ é™¤é“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  å¸¸è§„éå†æ€è·¯ 12345678910111213141516171819202122class Solution &#123;public: ListNode* deleteDuplicates(ListNode* head) &#123; if(!head) return head; auto tempHead=head; int temp; while(tempHead-&gt;next)&#123; temp=tempHead-&gt;val; if(tempHead-&gt;next-&gt;val==temp)&#123; if(tempHead-&gt;next-&gt;next)&#123; tempHead-&gt;next=tempHead-&gt;next-&gt;next; //tempHead=tempHead-&gt;next; å¦‚æœä¸‹ä¸€ä¸ªå€¼ä¸å½“å‰ç›¸åŒåˆ™è¿˜æ˜¯åœ¨å½“å‰èŠ‚ç‚¹ï¼Œé¿å…è¿ç»­ç›¸åŒ &#125;else&#123; tempHead-&gt;next=nullptr; &#125; &#125;else&#123; tempHead=tempHead-&gt;next; &#125; &#125; return head; &#125;&#125;; å¯ä»¥ç”¨ä¸¤ä¸ªèŠ‚ç‚¹éå†ä¸ç”¨è¾…åŠ©å˜é‡æ¥å‡å°‘ä»£ç é‡ 82 åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  IIç¬¬ä¸€éè‡ªè§£ 0ms è¿™é‡Œç”¨çš„INT_MAXæ¥é¿å…ä¸èŠ‚ç‚¹ä¸­çš„å€¼é‡å¤ï¼Œä¹Ÿå¯ä»¥æ¢æˆå¾ªç¯ä¸­çš„ä¸´æ—¶å˜é‡ï¼Œåœ¨åˆ¤æ–­æœ‰é‡å¤ä¹‹åç”¨ä¸€ä¸ªwhileå¤„ç†å®Œæ‰€æœ‰é‡å¤ æ³¨æ„è™šæ‹Ÿçš„èŠ‚ç‚¹ç”¨new 12345678910111213141516171819202122232425262728class Solution &#123;public: ListNode* deleteDuplicates(ListNode* head) &#123; ListNode* virtual_head = new ListNode(0); virtual_head-&gt;next=head; int tempnum=INT_MAX;//è®°å½•è¿™ä¸ªé‡å¤å€¼ auto temphead=virtual_head;//ç”¨äºéå† while(temphead-&gt;next!=nullptr)&#123; if(temphead-&gt;next-&gt;next!=nullptr)&#123; if(temphead-&gt;next-&gt;val==temphead-&gt;next-&gt;next-&gt;val)&#123;//å¤„ç†è¿ç»­ä¸¤ä¸ªç›¸åŒ tempnum=temphead-&gt;next-&gt;val; temphead-&gt;next=temphead-&gt;next-&gt;next-&gt;next; continue; &#125; &#125; if(temphead-&gt;next-&gt;val==tempnum)&#123;//å¤„ç†è¿ç»­ä¸‰ä¸ªç›¸åŒ temphead-&gt;next=temphead-&gt;next-&gt;next; continue; &#125; temphead=temphead-&gt;next; &#125; return virtual_head-&gt;next; &#125;&#125;; 19 åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹éå†ä¸¤éï¼Œç¬¬ä¸€éæ‰¾å‡ºä¸ªæ•°ï¼Œç¬¬äºŒä¾¿åˆ é™¤å…¨éƒ¨å‹æ ˆï¼Œç„¶åå–å‡ºn+1ä¸ªæ‰§è¡ŒåŒæŒ‡é’ˆ(åªç”¨éå†ä¸€é)ï¼šä¸¤ä¸ªé—´éš”ä¸ºnï¼Œå½“å‰é¢çš„åˆ°å¤´åˆ é™¤ç¬¬ä¸€ä¸ªæŒ‡é’ˆçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829class Solution &#123;public: ListNode* removeNthFromEnd(ListNode* head, int n) &#123; // åˆ›å»ºè™šæ‹Ÿå¤´èŠ‚ç‚¹ ListNode* dummy = new ListNode(0); dummy-&gt;next = head; // å®šä¹‰å¿«æ…¢æŒ‡é’ˆï¼Œéƒ½ä»è™šæ‹Ÿå¤´èŠ‚ç‚¹å¼€å§‹ ListNode* fast = dummy; ListNode* slow = dummy; // å¿«æŒ‡é’ˆå…ˆç§»åŠ¨n+1æ­¥ for(int i = 0; i &lt;= n; i++) &#123; if(fast == nullptr) return head; fast = fast-&gt;next; &#125; // åŒæ—¶ç§»åŠ¨å¿«æ…¢æŒ‡é’ˆï¼Œç›´åˆ°å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾ while(fast != nullptr) &#123; fast = fast-&gt;next; slow = slow-&gt;next; &#125; // åˆ é™¤ç›®æ ‡èŠ‚ç‚¹ slow-&gt;next = slow-&gt;next-&gt;next; // è·å–æ–°çš„å¤´èŠ‚ç‚¹ ListNode* result = dummy-&gt;next; // é‡Šæ”¾è™šæ‹ŸèŠ‚ç‚¹å†…å­˜ delete dummy; return result; &#125;&#125;; åˆå¹¶é“¾è¡¨23 åˆå¹¶kä¸ªå‡åºé“¾è¡¨è‡ªè§£6ms ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œæœ€å°å€¼ä¼˜å…ˆï¼Œè¿™é‡Œæ˜¯å­˜å‚¨çš„èŠ‚ç‚¹å€¼ï¼Œå¯ä»¥ç›´æ¥æ”¹ä¸ºå­˜å‚¨èŠ‚ç‚¹ 12345678910111213141516171819202122class Solution &#123;public: ListNode* mergeKLists(vector&lt;ListNode*&gt;&amp; lists) &#123; auto tempHead=new ListNode(0); if(lists.empty()) return tempHead-&gt;next; //ä½¿ç”¨priority_queueçš„æœ€å°å †å­˜å‚¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ priority_queue&lt;int, vector&lt;int&gt;,greater&lt;int&gt;&gt; proque; for(auto tempNode : lists)&#123; while(tempNode)&#123; proque.push(tempNode-&gt;val); tempNode=tempNode-&gt;next; &#125; &#125; auto temp=tempHead; while(!proque.empty())&#123; temp-&gt;next = new ListNode(proque.top()); proque.pop(); temp=temp-&gt;next; &#125; return tempHead-&gt;next; &#125;&#125;; æ”¹ä¸ºå­˜å‚¨èŠ‚ç‚¹ 3ms 12345678910111213141516171819202122232425262728293031323334class Solution &#123;public: struct CompareMyClass &#123; bool operator()(ListNode* lhs, ListNode* rhs) const &#123; return lhs-&gt;val &gt; rhs-&gt;val; &#125; &#125;; ListNode* mergeKLists(vector&lt;ListNode*&gt;&amp; lists) &#123; auto tempHead = new ListNode(0); if (lists.empty()) return tempHead-&gt;next; priority_queue&lt;ListNode*, vector&lt;ListNode*&gt;, CompareMyClass&gt; proque; // å°†æ‰€æœ‰é“¾è¡¨çš„å¤´èŠ‚ç‚¹å…¥é˜Ÿ for (auto tempNode : lists) &#123; if (tempNode) proque.push(tempNode); &#125; auto temp = tempHead; while (!proque.empty()) &#123; auto current = proque.top(); proque.pop(); temp-&gt;next = current; // æ‹¼æ¥é“¾è¡¨ temp = temp-&gt;next; if (current-&gt;next) &#123; proque.push(current-&gt;next); // å¦‚æœæœ‰åç»­èŠ‚ç‚¹ï¼Œç»§ç»­å…¥é˜Ÿ &#125; &#125; return tempHead-&gt;next; &#125;&#125;; æ ‘##å‰åºéå† 144 äºŒå‰æ ‘çš„å‰åºéå†çœ‹äº†æ€è·¯åè‡ªè§£ å…³é”®æ˜¯numsè¦å£°æ˜åœ¨å¤–é¢ 123456789101112class Solution &#123;private: vector&lt;int&gt; nums;public: vector&lt;int&gt; preorderTraversal(TreeNode* root) &#123; if(!root) return nums; nums.push_back(root-&gt;val); preorderTraversal(root-&gt;left); preorderTraversal(root-&gt;right); return nums; &#125;&#125;; éé€’å½’å®ç°æ ¹èŠ‚ç‚¹å…¥æ ˆ-å¾ªç¯éå†æ ˆ-æ ˆéç©ºï¼Œå–å‡ºèŠ‚ç‚¹-å–å‡ºèŠ‚ç‚¹å€¼-å‹å…¥å³èŠ‚ç‚¹-å‹å…¥å·¦èŠ‚ç‚¹ 1234567891011121314151617181920class Solution &#123;public: vector&lt;int&gt; preorderTraversal(TreeNode* root) &#123; if(!root) return &#123;&#125;; stack&lt;TreeNode*&gt; q; // æ ˆ vector&lt;int&gt; ans; q.push(root); while(!q.empty()) &#123; auto front = q.top(); q.pop(); ans.push_back(front-&gt;val); if(front-&gt;right) q.push(front-&gt;right); if(front-&gt;left) q.push(front-&gt;left); &#125; return ans; &#125;&#125;; 112 è·¯å¾„æ€»å’Œéš¾ç‚¹ï¼šéå†çš„åŸºç¡€ä¸Šå›é€€çš„æ—¶å€™è¦æ’¤é”€ç´¯åŠ å€¼ ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªæ ˆå‹å…¥èŠ‚ç‚¹ å¦ä¸€ä¸ªæ ˆå‹å…¥èŠ‚ç‚¹å’Œ æ¯”å¦‚1 2 3 èŠ‚ç‚¹å‹å…¥1 å–å‡º1 å‹å…¥3ï¼Œ2 å€¼å‹å…¥1 å–å‡º1 å‹å…¥1+3ï¼Œ1+2 12345678910111213141516171819202122232425262728class Solution &#123;public: bool hasPathSum(TreeNode* root, int targetSum) &#123; //sumçš„å€¼æ»¡è¶³ä¸”æ²¡æœ‰å·¦å³å­©å­åˆ™è¿”å›true stack&lt;TreeNode*&gt; st; stack&lt;int&gt; sum; if(root)&#123; st.push(root); sum.push(root-&gt;val); &#125; while(!st.empty())&#123; auto tempNode=st.top(); st.pop(); int temp=sum.top(); sum.pop(); if(temp==targetSum &amp;&amp; !tempNode-&gt;left &amp;&amp; !tempNode-&gt;right) return true; if(tempNode-&gt;right)&#123; st.push(tempNode-&gt;right); sum.push(temp+tempNode-&gt;right-&gt;val); &#125; if(tempNode-&gt;left)&#123; st.push(tempNode-&gt;left); sum.push(temp+tempNode-&gt;left-&gt;val); &#125; &#125; return false; &#125;&#125;; 113 è·¯å¾„æ€»å’Œâ…¡åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šå†åŠ ä¸€ä¸ªstack&lt;vector&gt; ä¸å­˜å‚¨è·¯å¾„å’Œçš„stack stnum;æ€è·¯ä¸€è‡´å³å¯ 17ms 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152class Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; pathSum(TreeNode* root, int targetSum) &#123; vector&lt;vector&lt;int&gt;&gt; vv; if (!root) return vv; stack&lt;vector&lt;int&gt;&gt; v; v.push(vector&lt;int&gt;&#123;root-&gt;val&#125;); stack&lt;TreeNode*&gt; stnode; stnode.push(root); stack&lt;int&gt; stnum; stnum.push(root-&gt;val); while(!stnode.empty())&#123; auto tempNode=stnode.top(); stnode.pop(); int tempnum=stnum.top(); stnum.pop(); vector&lt;int&gt; currentPath = v.top(); v.pop(); if(!tempNode-&gt;left&amp;&amp;!tempNode-&gt;right)&#123; if(tempnum==targetSum) vv.push_back(currentPath); &#125; if(tempNode-&gt;right)&#123; stnode.push(tempNode-&gt;right); stnum.push(tempnum+tempNode-&gt;right-&gt;val); vector&lt;int&gt; rightPath = currentPath; rightPath.push_back(tempNode-&gt;right-&gt;val); v.push(rightPath); &#125; if(tempNode-&gt;left)&#123; stnode.push(tempNode-&gt;left); stnum.push(tempnum+tempNode-&gt;left-&gt;val); vector&lt;int&gt; leftPath = currentPath; leftPath.push_back(tempNode-&gt;left-&gt;val); v.push(leftPath); &#125; &#125; return vv; &#125;&#125;; æ²¡æœ‰é€’å½’çš„æ•ˆç‡é«˜ï¼Œä¼˜åŒ–ï¼šä½¿ç”¨ä¸€ä¸ªæ ˆï¼Œå‡å°‘èµ‹å€¼æ“ä½œç­‰ ä¼˜åŒ–åçš„ç‰ˆæœ¬ï¼Œä»ç„¶ä¸æ˜¯0msï¼Œå¯è§æ‰‹åŠ¨å»ºæ ˆæ•ˆç‡ä¸å¦‚é€’å½’æ ˆçš„æ•ˆç‡ 1234567891011121314151617181920212223242526272829303132333435class Solution &#123;public: vector&lt;int&gt; tempPath; vector&lt;vector&lt;int&gt;&gt; pathSum(TreeNode* root, int targetSum) &#123; vector&lt;vector&lt;int&gt;&gt; result; if (!root) return result; stack&lt;tuple&lt;TreeNode*, vector&lt;int&gt;, int&gt;&gt; stk; stk.push(&#123;root, &#123;root-&gt;val&#125;, root-&gt;val&#125;); while (!stk.empty()) &#123; auto [node, path, pathSum] = stk.top(); stk.pop(); if (!node-&gt;left &amp;&amp; !node-&gt;right &amp;&amp; pathSum == targetSum) &#123; result.push_back(path); &#125; if (node-&gt;right) &#123; tempPath = path; tempPath.push_back(node-&gt;right-&gt;val); stk.push(&#123;node-&gt;right, tempPath, pathSum + node-&gt;right-&gt;val&#125;); &#125; if (node-&gt;left) &#123; tempPath = path; tempPath.push_back(node-&gt;left-&gt;val); stk.push(&#123;node-&gt;left, tempPath, pathSum + node-&gt;left-&gt;val&#125;); &#125; &#125; return result; &#125;&#125;; é€’å½’123456789101112131415161718192021222324252627282930class Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; res; vector&lt;int&gt; tmp; vector&lt;vector&lt;int&gt;&gt; pathSum(TreeNode* root, int targetSum) &#123; if(!root) return res; tmp.push_back(root-&gt;val); backtrack(root, targetSum-root-&gt;val); return res; &#125; void backtrack(TreeNode* root, int sum) &#123; if(sum == 0 &amp;&amp; !root-&gt;left &amp;&amp; !root-&gt;right) &#123; res.push_back(tmp); return; &#125; if(root-&gt;left) &#123; tmp.push_back(root-&gt;left-&gt;val); backtrack(root-&gt;left, sum-root-&gt;left-&gt;val); tmp.pop_back(); &#125; if(root-&gt;right) &#123; tmp.push_back(root-&gt;right-&gt;val); backtrack(root-&gt;right, sum-root-&gt;right-&gt;val); tmp.pop_back(); &#125; &#125;&#125;; æ›´å¥½ç†è§£çš„é€’å½’ï¼š accumulateå‡½æ•°è®¡ç®—vectorçš„å’Œ 1234567891011121314151617181920212223242526272829class Solution &#123;public: void dfs(TreeNode* root, int targetSum, vector&lt;int&gt;&amp; currentPath, vector&lt;vector&lt;int&gt;&gt;&amp; result) &#123; if (!root) return; currentPath.push_back(root-&gt;val); // åŠ å…¥å½“å‰èŠ‚ç‚¹åˆ°è·¯å¾„ // å¦‚æœåˆ°è¾¾å¶èŠ‚ç‚¹å¹¶ä¸”è·¯å¾„å’Œç­‰äºç›®æ ‡å€¼ if (!root-&gt;left &amp;&amp; !root-&gt;right &amp;&amp; accumulate(currentPath.begin(), currentPath.end(), 0) == targetSum) &#123; result.push_back(currentPath); &#125; // é€’å½’è®¿é—®å·¦å­æ ‘å’Œå³å­æ ‘ dfs(root-&gt;left, targetSum, currentPath, result); dfs(root-&gt;right, targetSum, currentPath, result); // å›æº¯ï¼Œç§»é™¤å½“å‰èŠ‚ç‚¹ currentPath.pop_back(); &#125; vector&lt;vector&lt;int&gt;&gt; pathSum(TreeNode* root, int targetSum) &#123; vector&lt;vector&lt;int&gt;&gt; result; vector&lt;int&gt; currentPath; dfs(root, targetSum, currentPath, result); return result; &#125;&#125;; ###437 è·¯å¾„æ€»å’Œ III é€’å½’çš„æ—¶å€™ä½¿ç”¨å‡æ³•å¯ä»¥å‡å°‘ä¸€ä¸ªå˜é‡çš„ä½¿ç”¨ å¼€å§‹çš„æ—¶å€™åˆ¤ç©ºï¼Œåˆ™é€’å½’å·¦å³å­æ ‘çš„æ—¶å€™æ— éœ€åˆ¤ç©º æ³¨æ„ä½¿ç”¨long longé¿å…æº¢å‡º ä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹åˆ†åˆ«éå† 12345678910111213141516class Solution &#123;public: int pathSum(TreeNode* root, int targetSum) &#123; if (!root) return 0; return dfs(root, (long long)targetSum) + pathSum(root-&gt;left, targetSum) + pathSum(root-&gt;right, targetSum); &#125; int dfs(TreeNode* root, long long targetSum) &#123; if (!root) return 0; int res = 0; if (root-&gt;val == targetSum) res++; res += dfs(root-&gt;left, targetSum - root-&gt;val); res += dfs(root-&gt;right, targetSum - root-&gt;val); return res; &#125;&#125;; è¿™æ ·è¾¾ä¸åˆ°0msï¼Œå› ä¸ºæœ‰å¾ˆå¤šé‡å¤çš„éå†ã€‚æ‰€ä»¥ä½¿ç”¨å‰ç¼€å’Œ åˆ©ç”¨å“ˆå¸Œè¡¨è®°å½•è·¯å¾„å’Œçš„å‡ºç°æ¬¡æ•°æ¥é¿å…é‡å¤è®¡ç®— å‰ç¼€å’Œæ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œã€‚ç”¨å“ˆå¸Œè¡¨è®°å½•å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ï¼Œå½“å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œå‡å»targetSumçš„ç»“æœåœ¨å“ˆå¸Œè¡¨ä¸­å­˜åœ¨è¿™ä¸ªé”®åˆ™ç»“æœåŠ ä¸Šå…¶å¯¹åº”çš„å€¼ 123456789101112131415161718192021class Solution &#123;public: unordered_map&lt;long long, int&gt; umap = &#123;&#123;0,1&#125;&#125;; //å‰ç¼€å’Œ å‡ºç°çš„æ¬¡æ•° int res = 0; void pathS(TreeNode* root, long long pre, int targetSum) &#123;//preè®°å½•å½“å‰è·¯å¾„å’Œ if (!root) return; pre += root-&gt;val; if (umap.count(pre-targetSum)) res += umap[pre-targetSum];//å¦‚æœå­˜åœ¨pre-targetSum=å‰ç¼€å’Œ umap[pre] ++; pathS(root-&gt;left, pre, targetSum); pathS(root-&gt;right, pre, targetSum); umap[pre] --;//ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½éå†å®Œä¹‹ååˆ™åœ¨hashmapä¸­ç§»é™¤è¿™ä¸ªå‰ç¼€å’Œ &#125; int pathSum(TreeNode* root, int targetSum) &#123; long long pre = 0; pathS(root, pre, targetSum); return res; &#125;&#125;; ###226 ç¿»è½¬äºŒå‰æ ‘ 12345678910111213class Solution &#123;public: TreeNode* invertTree(TreeNode* root) &#123; //ä»åº•å¾€ä¸Šäº¤æ¢å…ˆäº¤æ¢1 3 6 9 å†äº¤æ¢2 7 //æ‰€ä»¥ä½¿ç”¨é€’å½’ä»æ·±å¤„äº¤æ¢ if(!root) return root; if(!root-&gt;left&amp;&amp;!root-&gt;right) return root; invertTree(root-&gt;left); invertTree(root-&gt;right); swap(root-&gt;left,root-&gt;right); return root; &#125;&#125;; 257 äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„(å°±çœ‹è¿™ä¸ª)####é€’å½’ç‰ˆæœ¬ 0ms 1234567891011121314151617181920212223242526272829303132333435class Solution &#123;public: vector&lt;string&gt; result; string currentPath; void dfs(TreeNode* root, string&amp; currentPath, vector&lt;string&gt;&amp; result) &#123; if (!root) return; // ä¿å­˜å½“å‰è·¯å¾„é•¿åº¦ï¼Œç”¨äºå›æº¯ int len = currentPath.length(); // å¦‚æœä¸æ˜¯ç©ºè·¯å¾„ï¼Œéœ€è¦æ·»åŠ ç®­å¤´ if (len &gt; 0) &#123; currentPath += &quot;-&gt;&quot;; &#125; currentPath += to_string(root-&gt;val); // å¦‚æœåˆ°è¾¾å¶èŠ‚ç‚¹ï¼Œå°†å½“å‰è·¯å¾„åŠ å…¥ç»“æœ if (!root-&gt;left &amp;&amp; !root-&gt;right) &#123; result.push_back(currentPath); &#125; // é€’å½’è®¿é—®å·¦å­æ ‘å’Œå³å­æ ‘ dfs(root-&gt;left, currentPath, result); dfs(root-&gt;right, currentPath, result); // å›æº¯ï¼Œå°†è·¯å¾„æ¢å¤åˆ°è¿›å…¥å½“å‰èŠ‚ç‚¹ä¹‹å‰çš„çŠ¶æ€ currentPath.resize(len); &#125; vector&lt;string&gt; binaryTreePaths(TreeNode* root) &#123; dfs(root, currentPath, result); return result; &#125;&#125;; ä½¿ç”¨å…¨å±€çš„å˜é‡ï¼Œå‡å°‘é€’å½’æ—¶æ¯æ¬¡åˆ›å»ºå‰¯æœ¬ ä»3msä¼˜åŒ–åˆ°0ms éé€’å½’ç‰ˆæœ¬0ms 1234567891011121314151617181920212223242526272829303132class Solution &#123;public: vector&lt;string&gt; result; vector&lt;string&gt; binaryTreePaths(TreeNode* root) &#123; if(!root) return result; stack&lt;pair&lt;TreeNode*, string &gt;&gt;stk; //å­˜å‚¨èŠ‚ç‚¹(éå†) è·¯çº¿ stk.push(&#123;root, &quot;&quot;&#125;); while (!stk.empty()) &#123; auto [node, path] = stk.top(); stk.pop(); if (!path.empty()) &#123; path += &quot;-&gt;&quot;; &#125; path += to_string(node-&gt;val); if (!node-&gt;left &amp;&amp; !node-&gt;right) &#123; result.push_back(path); &#125; if (node-&gt;right) &#123; stk.push(&#123;node-&gt;right, path&#125;); &#125; if (node-&gt;left) &#123; stk.push(&#123;node-&gt;left, path&#125;); &#125; &#125; return result; &#125;&#125;; åŠ¨æ€è§„åˆ’123456789101112131415# è‡ªé¡¶å‘ä¸‹é€’å½’çš„åŠ¨æ€è§„åˆ’def dp(çŠ¶æ€1, çŠ¶æ€2, ...): for é€‰æ‹© in æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©: # æ­¤æ—¶çš„çŠ¶æ€å·²ç»å› ä¸ºåšäº†é€‰æ‹©è€Œæ”¹å˜ result = æ±‚æœ€å€¼(result, dp(çŠ¶æ€1, çŠ¶æ€2, ...)) return result# è‡ªåº•å‘ä¸Šè¿­ä»£çš„åŠ¨æ€è§„åˆ’# åˆå§‹åŒ– base casedp[0][0][...] = base case# è¿›è¡ŒçŠ¶æ€è½¬ç§»for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š for ... dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ±‚æœ€å€¼(é€‰æ‹©1ï¼Œé€‰æ‹©2...) 64æœ€å°è·¯å¾„å’ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ dp[i][j] &#x3D; min(dp[i - 1][j], dp[i][j - 1]) + grid[i][j] å½“å‰æœ€å°è·¯å¾„ä¸º&#x3D;ä»¥ä¸‹ä¸¤è€…çš„æœ€å°è€…ï¼šå·¦è¾¹çš„æœ€å°è·¯å¾„åŠ ä¸Šå½“å‰å€¼ï¼Œä¸Šè¾¹çš„æœ€å°è·¯å¾„åŠ ä¸Šå½“å‰å€¼ åˆ›å»ºäºŒç»´å‘é‡-&gt;åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå…ƒç´ -&gt;åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—-&gt;å…¬å¼æ¨å¯¼ 123456789101112131415161718192021222324class Solution &#123;public: int minPathSum(vector&lt;vector&lt;int&gt;&gt;&amp; grid) &#123; int m = grid.size();//mè¡Œ int n = grid[0].size();//nåˆ— vector&lt;vector&lt;int&gt;&gt; dp(m, vector&lt;int&gt;(n, 0)); dp[0][0] = grid[0][0]; // åˆå§‹åŒ–ç¬¬ä¸€è¡Œ for (int j = 1; j &lt; n; ++j) &#123; dp[0][j] = dp[0][j - 1] + grid[0][j]; &#125; // åˆå§‹åŒ–ç¬¬ä¸€åˆ— for (int i = 1; i &lt; m; ++i) &#123; dp[i][0] = dp[i - 1][0] + grid[i][0]; &#125; // å¡«å…… dp æ•°ç»„ for (int i = 1; i &lt; m; ++i) &#123; for (int j = 1; j &lt; n; ++j) &#123; dp[i][j] = min(dp[i - 1][j], dp[i][j - 1]) + grid[i][j]; &#125; &#125; return dp[m - 1][n - 1]; &#125;&#125;; ##647å›æ–‡å­ä¸² ä¸­å¿ƒæ‰©å±•æ³• éå†æ¯ä¸ªå¯èƒ½ä¸ºä¸­å¿ƒçš„ä½ç½®ï¼Œä¸€ä¸ªä¸ºä¸­å¿ƒ+ä¸¤ä¸ªä¸ºä¸­å¿ƒ 1234567891011121314151617181920212223242526272829class Solution &#123;public: int countSubstrings(std::string s) &#123; int n = s.length(); int count = 0; // éå†æ¯ä¸ªå¯èƒ½çš„ä¸­å¿ƒä½ç½® for (int i = 0; i &lt; n; ++i) &#123; // ä»¥å•ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒæ‰©å±• int left = i, right = i; while (left &gt;= 0 &amp;&amp; right &lt; n &amp;&amp; s[left] == s[right]) &#123; ++count; --left; ++right; &#125; // ä»¥ä¸¤ä¸ªç›¸é‚»å­—ç¬¦ä¸ºä¸­å¿ƒæ‰©å±• left = i; right = i + 1; while (left &gt;= 0 &amp;&amp; right &lt; n &amp;&amp; s[left] == s[right]) &#123; ++count; --left; ++right; &#125; &#125; return count; &#125;&#125;; åŠ¨æ€è§„åˆ’ dp[i][j] è¡¨ç¤ºå­—ç¬¦ä¸²ä»ç´¢å¼• i åˆ°ç´¢å¼• j çš„å­ä¸²æ˜¯å¦ä¸ºå›æ–‡ä¸² åˆ†ç±»è®¨è®ºï¼š i&#x3D;&#x3D;j æ˜¯ j-1&#x3D;i å¦‚æœs[i]&#x3D;&#x3D;s[j] j-1&gt;i s[i]&#x3D;=s[j] ä¸” dp[i+1][j-1]&#x3D;&#x3D;true 12345678910111213141516171819202122232425262728class Solution &#123;public: int countSubstrings(std::string s) &#123; int n = s.length(); std::vector&lt;std::vector&lt;bool&gt;&gt; dp(n, std::vector&lt;bool&gt;(n, false)); int count = 0; // æšä¸¾å­ä¸²çš„é•¿åº¦ for (int len = 0; len &lt; n; ++len) &#123; for (int i = 0; i &lt; n - len; ++i) &#123; int j = i + len; if (len == 0) &#123; dp[i][j] = true; &#125; else if (len == 1) &#123; dp[i][j] = (s[i] == s[j]); &#125; else &#123; dp[i][j] = (s[i] == s[j]) &amp;&amp; dp[i + 1][j - 1]; &#125; if (dp[i][j]) &#123; ++count; &#125; &#125; &#125; return count; &#125;&#125;; ##518 é›¶é’±å…‘æ¢â…¡ valid[i]è¡¨ç¤ºæ˜¯å¦å¯ä»¥ä½¿ç”¨ç»™å®šçš„ç¡¬å¸é¢é¢ç»„åˆå‡ºé‡‘é¢ dp[i]è¡¨ç¤ºå‡‘é½içš„ç»„åˆæ•° åˆå§‹åŒ–éƒ½ä¸º1 å…ˆæ£€æŸ¥æ˜¯å¦èƒ½å‡‘å‡ºç›®æ ‡é‡‘é¢ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼švalid[i] |&#x3D; valid[i - coin]; è®¡ç®—ç»„åˆæ•°ï¼šdp[i] +&#x3D; dp[i - coin]; 123456789101112131415161718192021class Solution &#123;public: int change(int amount, vector&lt;int&gt;&amp; coins) &#123; vector&lt;int&gt; dp(amount + 1), valid(amount + 1); dp[0] = 1; valid[0] = 1; for (int&amp; coin : coins) &#123; for (int i = coin; i &lt;= amount; i++) &#123; valid[i] |= valid[i - coin]; &#125; &#125; if (!valid[amount]) return 0; for (int&amp; coin : coins) &#123; for (int i = coin; i &lt;= amount; i++) &#123; dp[i] += dp[i - coin]; &#125; &#125; return dp[amount]; &#125;&#125;; 12345678910111213class Solution &#123;public: int change(int amount, vector&lt;int&gt;&amp; coins) &#123; vector&lt;uint64_t&gt; dp(amount+1,0); dp[0]=1; for(int i=0;i&lt;coins.size();i++)&#123; for(int j=coins[i];j&lt;=amount;j++)&#123; dp[j]=dp[j]+dp[j-coins[i]]; &#125; &#125; return dp[amount]; &#125;&#125;; #äºŒåˆ†æŸ¥æ‰¾ å…³é”®ï¼š int left &#x3D; 0, right &#x3D; nums.size() - 1; while(left &lt;&#x3D; right) mid &#x3D; left + (right - left) &#x2F; 2; left &#x3D; mid + 1; right &#x3D; mid - 1; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455int binary_search(vector&lt;int&gt;&amp; nums, int target) &#123; int left = 0, right = nums.size() - 1; while(left &lt;= right) &#123; int mid = left + (right - left) / 2; if (nums[mid] &lt; target) &#123; left = mid + 1; &#125; else if (nums[mid] &gt; target) &#123; right = mid - 1; &#125; else if(nums[mid] == target) &#123; // ç›´æ¥è¿”å› return mid; &#125; &#125; // ç›´æ¥è¿”å› return -1;&#125;//æ‰¾åˆ° target çš„æœ€å·¦ä¾§ç´¢å¼•int left_bound(vector&lt;int&gt;&amp; nums, int target) &#123; int left = 0, right = nums.size() - 1; while (left &lt;= right) &#123; int mid = left + (right - left) / 2; if (nums[mid] &lt; target) &#123; left = mid + 1; &#125; else if (nums[mid] &gt; target) &#123; right = mid - 1; &#125; else if (nums[mid] == target) &#123; // åˆ«è¿”å›ï¼Œé”å®šå·¦ä¾§è¾¹ç•Œ right = mid - 1; &#125; &#125; // åˆ¤æ–­ target æ˜¯å¦å­˜åœ¨äº nums ä¸­ // æ­¤æ—¶ target æ¯”æ‰€æœ‰æ•°éƒ½å¤§ï¼Œè¿”å› -1 if (left == nums.size()) return -1; // åˆ¤æ–­ä¸€ä¸‹ nums[left] æ˜¯ä¸æ˜¯ target return nums[left] == target ? left : -1;&#125;////æ‰¾åˆ° target çš„æœ€å³ä¾§ä¾§ç´¢å¼•int right_bound(vector&lt;int&gt;&amp; nums, int target) &#123; int left = 0, right = nums.size() - 1; while (left &lt;= right) &#123; int mid = left + (right - left) / 2; if (nums[mid] &lt; target) &#123; left = mid + 1; &#125; else if (nums[mid] &gt; target) &#123; right = mid - 1; &#125; else if (nums[mid] == target) &#123; // åˆ«è¿”å›ï¼Œé”å®šå³ä¾§è¾¹ç•Œ left = mid + 1; &#125; &#125; // æ­¤æ—¶ left - 1 ç´¢å¼•è¶Šç•Œ if (left - 1 &lt; 0) return -1; // åˆ¤æ–­ä¸€ä¸‹ nums[left] æ˜¯ä¸æ˜¯ target return nums[left - 1] == target ? (left - 1) : -1;&#125; æ’é™¤ä¸åœ¨åŒºé—´ 1234567891011121314class Solution &#123;public: int searchInsert(vector&lt;int&gt;&amp; nums, target) &#123; int n = nums.size(); int l = 0, r = n - 1; while(l &lt; r) &#123; // æ³¨æ„æ­¤æ—¶ä¸èƒ½æœ‰ç­‰äºäº†ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯æ’é™¤ä¸å¯èƒ½åŒºé—´ int mid = (l+r)/2; if(nums[mid] &lt; target) // è¿™é‡Œä¸èƒ½åˆ¤æ–­ç­‰äºçš„æƒ…å†µï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ’é™¤æ€ç»´ï¼Œåªéœ€è¦æ’é™¤ç›®æ ‡ä¸€å®šä¸åœ¨çš„å…ƒç´ åŒºé—´ l = mid + 1; else r = mid; // è¿™æ˜¯nums[mid] &gt;= targetçš„æƒ…å†µï¼Œè¯´æ˜ç›®æ ‡åœ¨midåŠå·¦è¾¹, å¾€å·¦ç¼©å° &#125; return nums[l] == target ? nums[l] : -1; // é€€å‡ºå¾ªç¯ï¼Œè¦ä¹ˆæ‰¾åˆ°ï¼Œè¦ä¹ˆæ²¡æ‰¾åˆ°ï¼Œå¦‚æœæ‰¾åˆ°çš„è¯ï¼Œleftå’Œrightéƒ½æŒ‡å‘å®ƒäº† &#125;&#125;; å›æº¯ DFS BFS695 å²›å±¿çš„æœ€å¤§é¢ç§¯1234567891011121314151617181920212223242526class Solution &#123;public: int ans, cur; vector&lt;vector&lt;int&gt;&gt; dirs = &#123;&#123;1,0&#125;,&#123;-1,0&#125;,&#123;0,1&#125;,&#123;0,-1&#125;&#125;;//å››ä¸ªæ–¹å‘ int maxAreaOfIsland(vector&lt;vector&lt;int&gt;&gt;&amp; grid) &#123; int m = grid.size(), n = grid[0].size(); for(int i = 0; i &lt; m; i++) &#123; for(int j = 0; j &lt; n; j++) &#123; if(!grid[i][j]) continue; cur = 1; dfs(grid, i, j, m, n); ans = max(cur, ans); &#125; &#125; return ans; &#125; void dfs(vector&lt;vector&lt;int&gt;&gt;&amp; grid, int x, int y, int m, int n) &#123; grid[x][y] = 0;//éå†è¿‡çš„è®¾ä¸º0 for(auto&amp; dir : dirs) &#123; int nx = dir[0]+x, ny = dir[1]+y;//å‘¨å›´å››ä¸ªæ–¹å‘åæ ‡ if(nx &lt; 0 || ny &lt; 0 || nx &gt;= m || ny &gt;= n || !grid[nx][ny]) continue;//æ»¡è¶³ä»»æ„æƒ…å†µä¼šè·³è¿‡è¿™ä¸ªå¾ªç¯ cur++; dfs(grid, nx, ny, m, n); &#125; &#125;&#125;;","categories":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/categories/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"QT","slug":"source/å‰ç«¯/Qt","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.388Z","comments":true,"path":"2025/03/02/source/å‰ç«¯/Qt/","permalink":"http://example.com/2025/03/02/source/%E5%89%8D%E7%AB%AF/Qt/","excerpt":"","text":"è½¯ä»¶å®‰è£… ä¸‹è½½å®‰è£…åŒ… https://download.qt.io/official_releases/online_installers/ windowsç‰ˆ æ¢æºå®‰è£… å®‰è£…åŒ…æ‹–è¿›å»-åé¢åŠ https://mirrors.tuna.tsinghua.edu.cn/qt/ D:\\ä¸‹è½½\\qt-unified-windows-x64-4.8.1-online.exe â€“mirror https://mirrors.tuna.tsinghua.edu.cn/qt/ â€“mirror https://mirror.nju.edu.cn/qt ä¸Šé¢é‚£ä¸ªæºç”¨ä¸äº†äº†ï¼Œæˆ‘æ¢äº†ä¸€ä¸ª å®‰è£…æŒ‡å¼• è´¦å·æ³¨å†Œéœ€è¦åœ¨é‚®ç®±ä¸­ç‚¹å‡»é“¾æ¥å¡«å†™ä¿¡æ¯è¿›è¡ŒéªŒè¯ ä¸å‘é€ä½¿ç”¨ä¿¡æ¯ æŒ‰éœ€é€‰æ‹©æ’ä»¶ é€‰æ‹©æœ€åä¸€ä¸ªåè®® åé¢éœ€è¦å®‰è£…æ’ä»¶æ—¶ï¼šæ ¹ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªç»´æŠ¤ç¨‹åºï¼Œæ‰“å¼€è¿›è¡Œå®‰è£…-åŒæ ·éœ€è¦æ¢æº æ–°å»ºé¡¹ç›® Qt Widgets Application é¡¹ç›®åè¯ ä½ç½® æ„å»ºç³»ç»Ÿ-qmake Base class: QWidget è¯­è¨€-æ—  å‡å°‘è­¦å‘Š help - about plugins(å…³äºæ’ä»¶) - c++ - å–æ¶ˆå‹¾é€‰clangcodemodel è¿è¡Œé¡¹ç›®(å¿½ç•¥) .proæ–‡ä»¶æ˜¯å·¥ç¨‹æ–‡ä»¶ï¼Œqmakeè‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºç”Ÿäº§makefileçš„é…ç½®æ–‡ä»¶ Qtçš„ç¼–è¯‘ä¸èƒ½ä½¿ç”¨æ™®é€šçš„makeï¼Œå…ˆqmakeé¢„ç¼–è¯‘ å·¥ç¨‹ç›®å½•ä¸‹qmake -projectåˆ›å»º.proæ–‡ä»¶(æ¯”å¦‚hello.pro) .proæ–‡ä»¶ç›®å½•ä¸‹ä½¿ç”¨qmake hello.pro (make)æˆ–qmake -tp vc hello.pro (nmake)ç”Ÿæˆmakefile ç„¶åè°ƒç”¨makeæˆ–nmakeè¿›è¡Œç¼–è¯‘ æˆ‘ä»¬ä½¿ç”¨çš„IDEæ‰€ä»¥ä¸ç”¨æ‰‹åŠ¨æ“ä½œäº† ä½¿ç”¨æŠ€å·§HTMLè§£æQLabel *label = new QLabel(&quot;&lt;h2&gt;&lt;font color=&#39;red&#39;&gt;Hello&lt;/font&gt;, world!&lt;h2&gt;&quot;); GUIç¨‹åºè®¾è®¡åŸºç¡€ï¼ˆæš‚æ—¶æ²¡æ•´ç†ï¼‰.proæ–‡ä»¶æ˜¯å·¥ç¨‹æ–‡ä»¶ï¼Œqmakeè‡ªåŠ¨ç”Ÿæˆçš„ç”¨äºç”Ÿäº§makefileçš„é…ç½®æ–‡ä»¶ 12345678910#include &lt;QApplication&gt; #include &lt;QLabel&gt; //å¤´æ–‡ä»¶åä¹Ÿæ˜¯ç±»åint main(int argc, char *argv[]) &#123; QApplication app(argc, argv); //åˆ›å»ºä¸€ä¸ªQApplicationå¯¹è±¡-ç®¡ç†åº”ç”¨ç¨‹åºçº§åˆ«çš„èµ„æº QLabel *label = new QLabel(&quot;Hello, world!&quot;); //åˆ›å»ºä¸€ä¸ªQLabelå¯¹è±¡ label-&gt;show(); //ä½¿è¿™ä¸ªlabelå¯è§ï¼Œå¯ä»¥åˆ¶å®šé¿å…é—ªçƒ return app.exec(); //å°†åº”ç”¨ç¨‹åºçš„æ§åˆ¶æƒç§»äº¤ç»™Qt&#125; Qtçš„ç¼–è¯‘ä¸èƒ½ä½¿ç”¨æ™®é€šçš„makeï¼Œå…ˆqmakeé¢„ç¼–è¯‘ å·¥ç¨‹ç›®å½•ä¸‹qmake -project åˆ›å»º.proæ–‡ä»¶(æ¯”å¦‚hello.pro) .proæ–‡ä»¶ç›®å½•ä¸‹ä½¿ç”¨qmake hello.pro (make)æˆ–qmake -tp vc hello.pro (nmake) ç”Ÿæˆmakefile,ç„¶åè°ƒç”¨makeæˆ–nmakeè¿›è¡Œç¼–è¯‘ æˆ‘ä»¬ä½¿ç”¨çš„IDEæ‰€ä»¥ä¸ç”¨æ‰‹åŠ¨æ“ä½œäº† ä¿®æ”¹ä¸€ä¸‹ QLabel *label = new QLabel(&quot;&lt;h2&gt;&lt;font color=&#39;red&#39;&gt;Hello&lt;/font&gt;, world!&lt;h2&gt;&quot;); Qtä¹Ÿæ˜¯æ”¯æŒHTMLè§£æçš„ ä¿¡å·æ§½12345678910#include &lt;QtGui/QApplication&gt; #include &lt;QtGui/QPushButton&gt; int main(int argc, char *argv[]) &#123; QApplication a(argc, argv); QPushButton *button = new QPushButton(&quot;Quit&quot;); QObject::connect(button, SIGNAL(clicked()), &amp;a, SLOT(quit())); button-&gt;show(); return a.exec(); &#125; #include &lt;QtWidgets&#x2F;QApplication&gt;#include &lt;QtWidgets&#x2F;QPushButton&gt; æ›¿æ¢å¼€å¤´çš„å¤´æ–‡ä»¶æ‰èƒ½ç”¨ QObject æ˜¯æ‰€æœ‰ç±»çš„æ ¹ã€‚Qt ä½¿ç”¨è¿™ä¸ª QObject å®ç°äº†ä¸€ä¸ªå•æ ¹ç»§æ‰¿çš„ C++ã€‚å®ƒé‡Œé¢æœ‰ä¸€ä¸ª connecté™æ€å‡½æ•°ï¼Œç”¨äºè¿æ¥ä¿¡å·æ§½ã€‚å½“ä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ª clicked ä¿¡å·-&gt;æ‰§è¡Œå®ä¾‹açš„quitå‡½æ•° clicked()å°±æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œè€Œ quit()å°±æ˜¯æ§½ ç»„ä»¶å¸ƒå±€è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªæ–°çš„ç»„ä»¶ï¼šQSpinBox å’Œ QSlider,ä»¥åŠä¸€ä¸ªæ–°çš„é¡¶çº§çª—å£ QWidget QSpinBox æ˜¯ä¸€ä¸ªæœ‰ä¸Šä¸‹ç®­å¤´çš„å¾®è°ƒå™¨ï¼ŒQSlider æ˜¯ä¸€ä¸ªæ»‘åŠ¨æ† 123456789101112131415161718192021222324252627282930#include &lt;QtWidgets/QApplication&gt;#include &lt;QtWidgets/QWidget&gt;#include &lt;QtWidgets/QSpinBox&gt;#include &lt;QtWidgets/QSlider&gt;#include &lt;QtWidgets/QHBoxLayout&gt;int main(int argc, char *argv[])&#123; QApplication app(argc, argv); QWidget *window = new QWidget; window-&gt;setWindowTitle(&quot;Enter your age&quot;);//è®¾ç½®çª—å£æ ‡é¢˜ QSpinBox *spinBox = new QSpinBox; QSlider *slider = new QSlider(Qt::Horizontal); spinBox-&gt;setRange(0, 130); //setRangeå‡½æ•°è®¾ç½®å€¼çš„èŒƒå›´ slider-&gt;setRange(0, 130); //ä¿¡å·æ§½é“¾æ¥ QObject::connect(slider, SIGNAL(valueChanged(int)), spinBox, SLOT(setValue(int))); QObject::connect(spinBox, SIGNAL(valueChanged(int)), slider, SLOT(setValue(int))); spinBox-&gt;setValue(35); QHBoxLayout *layout = new QHBoxLayout; //æ°´å¹³å¸ƒå±€ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œæ·»åŠ ? layout-&gt;addWidget(spinBox); //æ·»åŠ ç»„ä»¶,é“¾æ¥çš„ä¿¡å·æ§½? layout-&gt;addWidget(slider); window-&gt;setLayout(layout);//è®¾ç½®layoutæˆæˆ‘ä»¬å®šä¹‰çš„é‚£æ · window-&gt;show(); return app.exec();&#125; Qt ä¸€å…±æœ‰ä¸‰ç§ä¸»è¦çš„ layoutï¼Œåˆ†åˆ«æ˜¯ï¼š QHBoxLayout- æŒ‰ç…§æ°´å¹³æ–¹å‘ä»å·¦åˆ°å³å¸ƒå±€ï¼› QVBoxLayout- æŒ‰ç…§ç«–ç›´æ–¹å‘ä»ä¸Šåˆ°ä¸‹å¸ƒå±€ï¼› QGridLayout- åœ¨ä¸€ä¸ªç½‘æ ¼ä¸­è¿›è¡Œå¸ƒå±€ï¼Œç±»ä¼¼äº HTML çš„ tableã€‚ APIæ–‡æ¡£çš„ä½¿ç”¨å·¦ä¾§é—®å¥½helpé‡Œé¢å°±å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ ç¬¬ä¸€ä¸ªæ˜¯å¸®åŠ©çš„å¸®åŠ©ï¼›ç¬¬äºŒä¸ªæ˜¯ Qt Designer çš„å¸®åŠ©ï¼›ç¬¬ä¸‰ä¸ªæ˜¯ Qt Linguist çš„å¸®åŠ©ï¼›ç¬¬å››ä¸ªæ˜¯ QMake çš„å¸®åŠ©;æœ€åä¸€ä¸ªæ˜¯ Qt çš„ API æ–‡æ¡£ï¼Œåœ¨ QtCreator ä¸­é»˜è®¤æ‰“å¼€çš„å°±æ˜¯è¿™éƒ¨åˆ†ã€‚ åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†å¤´æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233#ifndef FINDDIALOG_H #define FINDDIALOG_H #include &lt;QtWidGets/QDialog&gt; //å£°æ˜ç±»ä»¥å…c++æ‰¾ä¸åˆ°class QCheckBox; class QLabel; class QLineEdit; class QPushButton; //FindDialogï¼Œç»§æ‰¿è‡ª QDialog?class FindDialog : public QDialog &#123; Q_OBJECT //è¿™æ˜¯ä¸€ä¸ªå®,å‡¡æ˜¯å®šä¹‰ä¿¡å·æ§½çš„ç±»éƒ½å¿…é¡»å£°æ˜è¿™ä¸ªå®public: //å£°æ˜æ„é€ å’Œææ„å‡½æ•° FindDialog(QWidget *parent = 0); ~FindDialog(); signals: //å…³é”®å­—,å®šä¹‰ä¿¡å·,ä¸¤ä¸ªä¿¡å· void findNext(const QString &amp;str, Qt::CaseSensitivity cs); void findPrevious(const QString &amp;str, Qt::CaseSensitivity cs); private slots: //ç§æœ‰çš„ä¸¤ä¸ªæ§½,å¯ä»¥æ¥æ”¶ä¿¡å· void findClicked();//ä¸ºäº†slotsçš„å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦è®¿é—®FindDialogçš„ç»„ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æŠŠå…¶ä¸­çš„ç»„ä»¶å®šä¹‰ä¸ºæˆå‘˜å˜é‡ä»¥ä¾¿è®¿é—® void enableFindButton(const QString &amp;text); private: QLabel *label; QLineEdit *lineEdit; QCheckBox *caseCheckBox; QCheckBox *backwardCheckBox; QPushButton *findButton; QPushButton *closeButton; &#125;; #endif // FINDDIALOG_H æºä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#include &lt;QtWidGets&gt; #include &quot;finddialog.h&quot; FindDialog::FindDialog(QWidget *parent) //æ„é€ å‡½æ•°æœ‰å‚æ•°åˆå§‹åŒ–åˆ—è¡¨ï¼Œç”¨æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°? : QDialog(parent) //æ‰€æœ‰ä½¿ç”¨äº†Q_OBJECTå®çš„ç±»éƒ½è‡ªåŠ¨å…·æœ‰tr()å‡½æ•°&#123; label = new QLabel(tr(&quot;Find &amp;what:&quot;)); //tr()å…¨ç§°QObject::tr(),è¢«å®ƒå¤„ç†çš„å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨å·¥å…·æå–å‡ºæ¥ç¿»è¯‘æˆå…¶ä»–è¯­è¨€ lineEdit = new QLineEdit; //å­—ç¬¦ä¸²ä¸­çš„&amp;ä»£è¡¨å¿«æ·é”®,ä¼šç”ŸæˆFindå­—ç¬¦ä¸²,å½“ä½ æŒ‰ä¸‹Alt+Wçš„æ—¶å€™ï¼Œè¿™ä¸ªæŒ‰é’®å°±ç›¸å½“äºè¢«ç‚¹å‡» label-&gt;setBuddy(lineEdit); //å½“labelè·å¾—ç„¦ç‚¹æ—¶,å®ƒçš„ç„¦ç‚¹ä¼šè‡ªåŠ¨ä¼ ç»™å®ƒçš„buddy(ä¼™ä¼´):lineEdit caseCheckBox = new QCheckBox(tr(&quot;Match &amp;case&quot;)); backwardCheckBox = new QCheckBox(tr(&quot;Search &amp;backford&quot;)); findButton = new QPushButton(tr(&quot;&amp;Find&quot;)); // alt+f findButton-&gt;setDefault(true); findButton-&gt;setEnabled(false); //æŠŠé»˜è®¤çš„æŒ‰é’®è®¾ä¸ºfindButton,æŠŠfindButtonè®¾ä¸ºä¸å¯ç”¨ closeButton = new QPushButton(tr(&quot;Close&quot;)); //è¿æ¥ä¿¡å·æ§½ connect()å‡½æ•°ä¹Ÿæ˜¯QObjectçš„ connect(lineEdit, SIGNAL(textChanged(const QString&amp;)), this, SLOT(enableFindButton(const QString&amp;))); connect(findButton, SIGNAL(clicked()), this, SLOT(findClicked())); connect(closeButton, SIGNAL(clicked()), this, SLOT(close())); QHBoxLayout *topLeftLayout = new QHBoxLayout; topLeftLayout-&gt;addWidget(label); topLeftLayout-&gt;addWidget(lineEdit); QVBoxLayout *leftLayout = new QVBoxLayout; leftLayout-&gt;addLayout(topLeftLayout); leftLayout-&gt;addWidget(caseCheckBox); leftLayout-&gt;addWidget(backwardCheckBox); QVBoxLayout *rightLayout = new QVBoxLayout; rightLayout-&gt;addWidget(findButton); rightLayout-&gt;addWidget(closeButton); rightLayout-&gt;addStretch(); QHBoxLayout *mainLayout = new QHBoxLayout; mainLayout-&gt;addLayout(leftLayout); mainLayout-&gt;addLayout(rightLayout); setLayout(mainLayout); setWindowTitle(tr(&quot;Find&quot;)); //æ ‡é¢˜ setFixedHeight(sizeHint().height()); //å›ºå®šé«˜åº¦ sizeHint()è¿”å›â€œæœ€ç†æƒ³â€çš„å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ height()å‡½æ•°å»åˆ°â€œæœ€ç†æƒ³â€çš„é«˜åº¦ã€‚&#125; FindDialog::~FindDialog() &#123; &#125; //æ§½void FindDialog::findClicked() &#123; QString text = lineEdit-&gt;text(); //å–å‡ºè¾“å…¥å€¼ Qt::CaseSensitivity cs = caseCheckBox-&gt;isChecked() ? Qt::CaseInsensitive : Qt::CaseSensitive;//åˆ¤æ–­caseCheckBoxæ˜¯å¦é€‰ä¸­,é€‰ä¸­åˆ™è¿”å›Qt::CaseInsensitiveï¼Œå¦åˆ™è¿”å› Qt::CaseSensitive if(backwardCheckBox-&gt;isChecked()) &#123; //å¦‚æœ backwardCheckBoxè¢«é€‰ä¸­ï¼Œå°± emit(å‘å‡º)ä¿¡å· findPrevious()ï¼Œå¦åˆ™ emitä¿¡å· findNext emit findPrevious(text, cs); &#125; else &#123; emit findNext(text, cs); &#125; &#125; //enableFindButton()åˆ™æ ¹æ® lineEdit çš„å†…å®¹æ˜¯ä¸æ˜¯å˜åŒ–â€”â€”è¿™æ˜¯æˆ‘ä»¬çš„ connect è¿æ¥çš„â€”â€”æ¥è®¾ç½®findButton æ˜¯ä¸æ˜¯å¯ä»¥ä½¿ç”¨void FindDialog::enableFindButton(const QString &amp;text) &#123; findButton-&gt;setEnabled(!text.isEmpty()); &#125; main.cpp 1234567891011#include &lt;QApplication&gt;#include &quot;widget.h&quot;int main(int argc, char *argv[])&#123; QApplication app(argc, argv); FindDialog *dialog = new FindDialog; dialog-&gt;show(); return app.exec();&#125; å¼€å§‹ï¼ˆæ²¡æ•´ç†ï¼‰widget.cpp:çª—å£å±æ€§,æ·»åŠ æ§ä»¶å†™åœ¨è¿™ä¸ªæ–‡ä»¶çš„æ„é€ å‡½æ•°ä¸­ ä¿®æ”¹çª—å£æ ‡é¢˜: ä¹±ç :å·¥å…·-é€‰é¡¹-æ–‡æœ¬ç¼–è¾‘å™¨-è¡Œä¸º-é»˜è®¤ç¼–ç -UTF-8 è®¾ç½®çª—å£å¤§å°:å¯ä»¥æ‹‰ä¼¸&#x2F;ä¸å¯æ‹‰ä¼¸ this-&gt;setWindowTitle(&quot;OpenChatRoom&quot;); this-&gt;resize(800,600); this-&gt;setFixedSize(500,500); æŒ‰é’® #include 1234567891011QPushButton *button=new QPushButton;//button-&gt;show(); ä¼šåœ¨å¤–é¢,æ²¡æœ‰åµŒè¿›å»//è®¾ç½®æŒ‰é’®çš„çˆ¶å¯¹è±¡ä¸ºçª—å£button-&gt;setParent(this);//åˆåœ¨ä¸€èµ·QPushButton *button2=new QPushButton(&quot;Log In&quot;,this);//è®¾ç½®å±æ€§button-&gt;setText(&quot;Log In&quot;);button-&gt;move(400,500);//ä½ç½®button-&gt;setFixedSize(100,50);//å¤§å° ä¿¡å·ä¸æ§½ 12345678910111213141516171819202122232425262728293031323334353637383940//ä¿¡å·å‘å‡ºè€…ï¼Œä¿¡å·ï¼Œä¿¡å·æ¥æ”¶è€…ï¼Œæ¥æ”¶ä¿¡å·åæ‰§è¡Œçš„ä»»åŠ¡ï¼ˆæ§½å‡½æ•°ï¼‰connect(button,&amp;QPushButton::clicked,this,&amp;Widget::close);//ç‚¹å‡»å…³é—­ï¼Œè‡ªå¸¦çš„å…³é—­å’Œç‚¹å‡»å‡½æ•°signals://ä¿¡å·ï¼Œè¿”å›å€¼voidï¼Œå¯ä»¥æœ‰å‚æ•°ï¼Œå¯ä»¥é‡è½½ void hungery();public slotsï¼š//æ§½å‡½æ•°ï¼Œè¿”å›å€¼voidï¼Œå¯ä»¥å†™åˆ°å…¶ä»–åœ°æ–¹ï¼Œå¯ä»¥æœ‰å‚æ•°ï¼Œéœ€è¦å£°æ˜å¹¶å®ç°ï¼Œå¯ä»¥é‡è½½ void treat(); void Student::treat()&#123; qDebug()&lt;&lt;&quot;è¯·åƒé¥­&quot;; &#125;//æ‰“å°#inlcude&lt;QDebug&gt; qDebug()&lt;&lt;&quot; &quot;; //å®ç° //widget.h Teacher *tea; Student *stu; void ClassOver(); //widget.cpp this-&gt;tea=new Teacher(this);//æŒ‡å®šçˆ¶å¯¹è±¡,å›æ”¶æ—¶è‡ªåŠ¨é‡Šæ”¾ this-&gt;stu=new Student(this); connect(tea,&amp;Teacher::hungry,stu,&amp;student::treat); ClaseOver();//è§¦å‘ä¿¡å·void Widget::ClassOver()&#123; emit teacher-&gt;hungry(); //å‘å‡ºä¿¡å·&#125;//ç‚¹å‡»æŒ‰é’®è§¦å‘ä¿¡å·connect(button,&amp;QPushButton::clicked,this,&amp;Widget::ClassOver);//æˆ–è€…connect(button,&amp;QPushButton::clicked,tea,&amp;Widget::hungury);//é‡è½½ï¼Œéœ€è¦å‡½æ•°æŒ‡é’ˆæŒ‡å‘å‡½æ•°åœ°å€void hungery(QString food);//treatä¹Ÿæœ‰å‚æ•°void Widget::ClassOver()&#123; emit teacher-&gt;hungry(&quot;abc&quot;); //å‘å‡ºä¿¡å·&#125;void(Teacher::*a)(QString)=&amp;Teacher::hungury;void(Student::*b)(QString)=&amp;Student::treat;connect(tea,a,stu,b);ClassOver();//Qstringè¾“å‡ºå¸¦æœ‰&quot;&quot;è½¬åŒ–ä¸ºä¸å¸¦ &lt;&lt;str.toUtf8().data();æœ‰ç©ºæ ¼,qDebug().nospace()&lt;&lt; æ²¡æœ‰ è‡ªå®šä¹‰ä¿¡å·ä¸æ§½ æ–°å»ºç±»ç»§æ‰¿äºQObejct(æ§½å‡½æ•°å…¨å±€,lambdaé™¤å¤–) æ§½å‡½æ•°å¯ä»¥æ¯”ä¿¡å·å°‘,ä¸ä¿¡å·å‚æ•°é¡ºåºä¹Ÿéœ€è¦ä¸€è‡´ ä¸€ä¸ªä¿¡å·å¯¹åº”ä¸¤ä¸ªæ§½-&gt;ç™»å½•-æˆåŠŸ-å¤±è´¥ lambdaè¡¨è¾¾å¼ ()é‡Œé¢å¯ä»¥å†™å‚æ•°,çœå»å†™å‡½æ•°çš„éƒ¨åˆ†,èŠ‚çœæ—¶é—´ 12345QPushButton * b1=new QPushButton (&quot;ç‚¹å‡»&quot;,this); connect(b1,&amp;QPushButton::clicked,this,[=]()&#123; qDebug()&lt;&lt;&quot;æŒ‰é’®è¢«æŒ‰ä¸‹&quot;; &#125; ); è®°äº‹æœ¬éƒ¨ä»¶ ##èµ„æºæ–‡ä»¶ ctrl+n Qt-Qt source file-å‰ç¼€&#x2F;-æ·»åŠ å›¾ç‰‡ å¯ä»¥èµ·åˆ«å 12345QPixmap pix=QPixmap(&quot;:/image/d2.png&quot;).scaled(this-&gt;size());//è®¾ç½®å¤§å° //pix.load(&quot;:/image/d2.png&quot;);//æ²¡æœ‰è®¾ç½®å¤§å° QPalette palette; palette.setBrush(QPalette::Window,QBrush(pix));//QPalette::Background this-&gt;setPalette(palette); ç»™èœå•é¡¹å¢åŠ å›¾ç‰‡ å¢åŠ èƒŒæ™¯å›¾ç‰‡ QMainWindow .ui ui çŠ¶æ€æ æ˜¾ç¤ºå‘é€æˆåŠŸ å¯¹è¯æ¡† 123456789 QDialog dialog; dialog.setWindowTitle(tr(&quot;Hello&quot;)); dialog.exec();//æ¨¡æ€å¯¹è¯æ¡†ï¼ˆåªèƒ½æ“ä½œå¯¹è¯æ¡†ï¼‰ dialog.show();//éæ¨¡æ€å¯¹è¯æ¡†ï¼ˆä¸ä¼šé˜»å¡ï¼‰ ä¸€é—ªè€Œè¿‡ï¼Œè¿™æ˜¯åœ¨æ ˆä¸Šåˆ›å»ºçš„//åœ¨å †ä¸Šåˆ›å»º QDialog *dialog=new QDialog; dialog-&gt;setAttribute(Qt::WA_DeleteOnClose);//è‡ªåŠ¨é”€æ¯ï¼Œä¸å ç”¨å†…å­˜ dialog-&gt;setWindowTitle(tr(&quot;Hello&quot;)); dialog-&gt;show(); æ ‡å‡†å¯¹è¯æ¡†ï¼ˆå†…ç½®ï¼‰ 12345QColorDialog é€‰æ‹©é¢œè‰²QFileDialog é€‰æ‹©æ–‡ä»¶/ç›®å½•QFontDialog é€‰æ‹©å­—ä½“QInputDialog å…è®¸ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è¿”å›QMessageBox æ¨¡æ€å¯¹è¯æ¡†ï¼Œç”¨äºæ˜¾ç¤ºä¿¡æ¯ï¼Œè¯¢é—®é—®é¢˜ç­‰ æŒ‰é’®pushbutton plain text edit æ–‡æœ¬ç¼–è¾‘å™¨ 12345678//é€‰æ‹©æ–‡ä»¶ï¼Œå¹¶ä¸”è¾“å‡ºæ–‡ä»¶åœ°å€void MainWindow::on_pushButton_clicked()&#123; QString fileName=QFileDialog::getOpenFileName(this,tr(&quot;æ‰“å¼€æ–‡ä»¶&quot;),&quot;./&quot;,tr(&quot;Images(*.png *.xpm *.jpg);;Text(*.txt)&quot;)); if(!fileName.isEmpty())&#123; ui-&gt;plainTextEdit-&gt;appendPlainText(fileName); &#125;&#125; é€‰æ‹©å¤šä¸ªæ–‡ä»¶p43 é¢œè‰²å¯¹è¯æ¡† 12345678910void MainWindow::on_pushButton_2_clicked()&#123; QPalette pal=ui-&gt;plainTextEdit-&gt;palette();//è·å–ç°æœ‰palette QColor iniColor = pal.color(QPalette::Text);//ç°æœ‰æ–‡å­—é¢œè‰² QColor color= QColorDialog::getColor(iniColor,this,&quot;é€‰æ‹©é¢œè‰²&quot;); if(color.isValid())&#123; pal.setColor(QPalette::Text,color); ui-&gt;plainTextEdit-&gt;setPalette(pal);//è®¾ç½®ç¼–è¾‘å™¨æ–‡å­—é¢œè‰² &#125;&#125; é€‰æ‹©å­—ä½“å¯¹è¯æ¡† æ¶ˆæ¯å¯¹è¯æ¡† è¾“å…¥å¯¹è¯æ¡† å¸ƒå±€ç®¡ç†å™¨ç»å¯¹å®šä½ï¼šéœ€è¦æä¾›ç»„ä»¶é•¿é«˜ï¼Œåæ ‡ å¦‚æœæ”¹å˜çª—å£å¤§å°ï¼Œå…¶ä½ç½®å¤§å°ä¸å˜-éœ€è¦è®¾ç½®å›ºå®šå¤§å° å¸ƒå±€å®šä½ï¼šéœ€è¦æŒ‡å®šä½¿ç”¨å“ªç§å¸ƒå±€ ä½¿ç”¨ä¸Šæ–¹widgetçš„å¸ƒå±€ æ ‡ç­¾Label Line Edit å¢åŠ å¼¹ç°§ï¼Œå¹¶ä¸”æ°´å¹³å¸ƒå±€ è§£é™¤å¸ƒå±€åå¯ä»¥è¿›è¡Œè°ƒæ•´ ##åˆ‡æ¢ä¸»ç•Œé¢ æ·»åŠ -Qt-Qt è®¾è®¡å¸ˆç±»-çˆ¶ç±»é€‰æ‹©widgetï¼Œå°±å¢åŠ äº†ä¸€ä¸ªui #include â€œlogin.hâ€ LogIn l;l.show(); ä¸€ä¸‹å­å±•ç¤ºä¸¤ä¸ªé¡µé¢ wiget.hä¸­åŒ…å«æ–°ç•Œé¢çš„å¤´æ–‡ä»¶ privateä¸­æ–°å»º LogIn *new_window; 12345this-&gt;new_window=new LogIn(); connect(ui-&gt;pushButton,&amp;QPushButton::clicked,this,[=]()&#123; this-&gt;hide(); this-&gt;new_window-&gt;show();//æƒ³è¦ç™»å½•åé‡Šæ”¾ä¹‹å‰çš„ç•Œé¢ï¼Ÿ &#125;); æ–°ç•Œé¢è¿”å›ä¸»ç•Œé¢ 12345678910//LogIn.hsignals: void back(void);//LogIn.cppconnect(ui-&gt;pushButton,SIGNAL(clicked(bool)),this,SIGNAL(back()));//wiget.cppconnect(this-&gt;new_window,&amp;LogIn::back,this,[=]()&#123; this-&gt;new_window-&gt;hide(); this-&gt;show(); &#125;); ##æ ‡ç­¾ #include 12QLabel *l=new QLabel(this);l-&gt;setText(&quot;è¿™æ˜¯OpenChatroom&quot;); 123456789101112131415#include &lt;QLineEdit&gt; QLineEdit *e=new QLineEdit(this); e-&gt;setText(&quot;è¯·è¾“å…¥6ä½æ•°å­—&quot;); //è·å–uiç¼–è¾‘æ¡†å†…çš„å†…å®¹ QString str=ui-&gt;lineEdit-&gt;text; qDebug()&lt;&lt;str; //è·å–ä»£ç åˆ›å»ºæ¡†å†…çš„å†…å®¹ QString str=e-&gt;text(); qDebug()&lt;&lt;str;//è®¾ç½®è¾“å‡ºæ¨¡å¼ e-&gt;setEchoMode(QLineEdit::Password);//æ˜¾ç¤ºåœ†ç‚¹ NoEcho//ä¸æ˜¾ç¤º PasswordEchoEdit//æ­£åœ¨è¾“å…¥æ—¶æ˜¾ç¤ºï¼Œè¾“å®Œä¸æ˜¾ç¤º//è®¾ç½®è¾“å‡ºå·¦ï¼Œä¸Šï¼Œå³ï¼Œä¸‹çš„è·ç¦» e-&gt;setTextMargins(0,0,0,0); è‡ªå®šä¹‰æ§ä»¶-ç»å¸¸ç”¨åˆ°çš„é¡µé¢è¿›è¡Œå±•ç¤º æ ˆå®¹å™¨ï¼šç‚¹å‡»ä¸€ä¸ªèœå•æ˜¾ç¤ºä¸€ä¸ªç•Œé¢ äº‹ä»¶é¼ æ ‡æŒ‰ä¸‹ï¼Œé‡Šæ”¾ï¼Œç§»åŠ¨ ç‚¹å‡»æ ‡ç­¾ï¼Œåšå‡ºåŠ¨ä½œdeng æ‰“åŒ…é¡¹ç›®å¼€å‘ä¸­ç”¨debugï¼Œä½†æ˜¯å‘å¸ƒæ—¶ç”¨releaseï¼Œä¼šå¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ– å‰æï¼šé…ç½®qtç¯å¢ƒå˜é‡D:\\App\\Qt\\6.2.4\\mingw_64\\bin ç¼–è¯‘releaseç‰ˆæœ¬ï¼Œç”ŸæˆåŒ…-åç¼€ä¸ºRelease æ‰“å¼€Releaseæ–‡ä»¶-release-å¤åˆ¶.exeæ–‡ä»¶åˆ°æ¡Œé¢ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹é‡Œé¢ åˆ©ç”¨qt binæ–‡ä»¶å¤¹ä¸‹çš„å·¥å…·â€D:\\App\\Qt\\6.2.4\\mingw_64\\bin\\windeployqt.exeâ€æ¥æ‰¾å‡ºç¨‹åºéœ€è¦çš„æ‰€æœ‰åŠ¨æ€åº“ åœ¨æ–°æ–‡ä»¶å¤¹é‡Œé¢æ‰“å¼€ç»ˆç«¯ D:\\App\\Qt\\6.2.4\\mingw_64\\bin\\windeployqt.exe .\\OpenChatRoom.exe å¾—åˆ°ç»¿è‰²ç‰ˆ ä¸‹è½½æ‰“åŒ…å·¥å…·Inno Setuphttp://www.jrsoftware.org/isdl.php#stable ok next-å®‰è£…ç›®å½• æ‰“åŒ…ç¨‹åºçš„æ–‡ä»¶-next-next-next-next å®‰è£…åŒ…æ‰€åœ¨ç›®å½• å®‰è£…åŒ…åç§° å›¾æ ‡ä½ç½®(å®‰è£…åŒ…çš„å›¾æ ‡) ä¸è¦é…ç½®qtçš„ç¯å¢ƒå˜é‡,é…ç½®äº†åœ¨è‡ªå·±æœºå™¨ä¸Šé¢å¯è¿è¡Œ,åˆ«çš„æœºå™¨ä¸èƒ½è¿è¡Œ,æ‰¾ä¸åˆ°åŠ¨æ€åº“ï¼šçœ‹ç¼ºå“ªäº›,å»qtæ–‡ä»¶å¤¹é‡Œé¢å»æœç´¢,æŠŠç¼ºå°‘çš„æ‰‹åŠ¨å¤åˆ¶åˆ°éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶å¤¹é‡Œé¢ ä¸é…ç½®ç¯å¢ƒ-&gt;æ¡Œé¢æ–‡ä»¶å¤¹æ‰¾å…¨åŠ¨æ€åº“-&gt;å†æ‰“åŒ…å®‰è£…åŒ… å¦‚æœæ²¡æœ‰æ‰¾å…¨å°±æ‰“åŒ…,å¯æ‰¾å…¨åç›´æ¥æ‰“å¼€ä¿ç•™çš„.issæ–‡ä»¶è¿è¡Œä¸€éå³å¯","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"QT","slug":"QT","permalink":"http://example.com/tags/QT/"}]},{"title":"TinyWebServer","slug":"source/åç«¯/TinyWebServer","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2025/03/02/source/åç«¯/TinyWebServer/","permalink":"http://example.com/2025/03/02/source/%E5%90%8E%E7%AB%AF/TinyWebServer/","excerpt":"","text":"git clone https://github.com/qinguoyi/TinyWebServer.git å‡†å¤‡mysqlæ•°æ®åº“ ç›®å‰æ˜¯åœ¨docker å®¹å™¨mysql8 root 123456 1234567create database tynywebserver;USE tynywebserver;CREATE TABLE user( username char(50) NULL, passwd char(50) NULL)ENGINE=InnoDB;INSERT INTO user(username, passwd) VALUES(&#x27;name&#x27;, &#x27;passwd&#x27;); sudo yum install mysql-devel sh build.sh è¿™é‡Œæˆ‘è¿ä¸ä¸Šæ•°æ®åº“å› ä¸ºå®ƒæ²¡æœ‰æä¾›ä¿®æ”¹æ•°æ®åº“ç«¯å£çš„åœ°æ–¹ -lmysqlclient","categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"}],"tags":[]},{"title":"Linuxå‘½ä»¤","slug":"source/Linux/Linux","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.386Z","comments":true,"path":"2025/03/02/source/Linux/Linux/","permalink":"http://example.com/2025/03/02/source/Linux/Linux/","excerpt":"","text":"å‘½ä»¤ é˜²ç«å¢™ æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ firewall-cmd â€“state å…³é—­é˜²ç«å¢™ systemctl stop firewalld æŸ¥çœ‹ç«¯å£ä¿¡æ¯ ss -tuln æŸ¥çœ‹æ‰€æœ‰ç«¯å£ -t è¡¨ç¤ºTCPç«¯å£ -u è¡¨ç¤ºUDPç«¯å£ -l è¡¨ç¤ºä»…æ˜¾ç¤ºç›‘å¬çŠ¶æ€çš„ç«¯å£ -n è¡¨ç¤ºä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å·ï¼Œä¸å°è¯•è§£æåŸŸåã€æœåŠ¡åç­‰ æŸ¥çœ‹å…·ä½“æŸä¸ªç«¯å£çŠ¶æ€ ss -tuln | grep :80 æ˜¾ç¤ºå½“å‰ç›®å½•123456ls -a æŸ¥çœ‹åŒ…æ‹¬éšè—æ–‡ä»¶mkdir æ–°å»ºæ–‡ä»¶å¤¹ touch æ–°å»ºæ–‡ä»¶rm åˆ é™¤ rm -rf åˆ é™¤æ–‡ä»¶å¤¹ -rhistory æŸ¥çœ‹å†å²å‘½ä»¤ mv a b aé‡å‘½åä¸ºbæˆ–ç§»åŠ¨reboot é‡å¯ ç³»ç»Ÿç¼–ç¨‹shellç¼–ç¨‹ä½¿ç”¨#include çš„system()å‡½æ•° è°ƒç”¨æˆåŠŸè¿”å›0 123456789101112#include &lt;cstdlib&gt; #include &lt;iostream&gt; using namespace std;int main() &#123; int result = system(&quot;ls -l&quot;); if (result == -1) &#123; cerr &lt;&lt; &quot;Failed to execute command\\n&quot;; &#125;else&#123; cout&lt;&lt;result&lt;&lt;endl; &#125; return 0; &#125; #include cçš„ç”¨æ³•FILEç»“æ„ä½“ç±»å‹ 123456789101112131415#include &lt;cstdio&gt; #include &lt;iostream&gt; int main() &#123; FILE *fp = popen(&quot;ls -l&quot;, &quot;r&quot;); if (fp == NULL) &#123; std::cerr &lt;&lt; &quot;Failed to run command\\n&quot;; return 1; &#125; char buffer[128]; while (fgets(buffer, 128, fp) != NULL) &#123; std::cout &lt;&lt; buffer; &#125; pclose(fp); return 0; &#125; æ–‡ä»¶ç¼–ç¨‹æ–‡ä»¶æ¨¡å¼ åŒæ—¶è¯»å†™æ¨¡å¼æ—¶ å…ˆè¯»åå†™ï¼Œå†™ä¼šå¤±è´¥ ä¸çŸ¥é“åŸå› ï¼Ÿï¼Ÿï¼Ÿ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;iostream&gt; #include &lt;fstream&gt; #include &lt;string&gt; //å†™æ–‡ä»¶int main() &#123; std::ofstream outFile(&quot;example.txt&quot;); // åˆ›å»ºå¹¶æ‰“å¼€æ–‡ä»¶ç”¨äºå†™å…¥ if (!outFile) &#123; std::cerr &lt;&lt; &quot;Unable to open file for writing\\n&quot;; return 1; &#125; outFile &lt;&lt; &quot;Hello, fstream!\\n&quot;; // å†™å…¥å­—ç¬¦ä¸²åˆ°æ–‡ä»¶ outFile.close(); // å…³é—­æ–‡ä»¶ï¼ˆè™½ç„¶å½“ofstreamå¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè‡ªåŠ¨å…³é—­ï¼Œä½†æ˜¾å¼å…³é—­æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼‰ return 0; &#125;//è¯»æ–‡ä»¶int main() &#123; std::ifstream inFile(&quot;example.txt&quot;); // æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å– if (!inFile) &#123; std::cerr &lt;&lt; &quot;Unable to open file for reading\\n&quot;; return 1; &#125; std::string line; while (getline(inFile, line)) &#123; // é€è¡Œè¯»å–æ–‡ä»¶ std::cout &lt;&lt; line &lt;&lt; &#x27;\\n&#x27;; &#125; inFile.close(); // å…³é—­æ–‡ä»¶ return 0; &#125;//åŒæ—¶è¯»å†™int main() &#123; std::fstream file(&quot;example.txt&quot;, std::ios::in | std::ios::out | std::ios::app); // æ‰“å¼€æ–‡ä»¶ï¼Œç”¨äºè¯»å†™ï¼Œå¹¶è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ if (!file) &#123; std::cerr &lt;&lt; &quot;Unable to open file\\n&quot;; return 1; &#125; // è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆæ³¨æ„ï¼šå¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€ä½³åšæ³•ï¼‰ std::string line; while (getline(file, line)) &#123; std::cout &lt;&lt; line &lt;&lt; &#x27;\\n&#x27;; &#125; // å›åˆ°æ–‡ä»¶æœ«å°¾ä»¥è¿½åŠ å†…å®¹ file.seekp(0, std::ios::end); file &lt;&lt; &quot;This is appended text.\\n&quot;; file.close(); // å…³é—­æ–‡ä»¶ return 0; &#125; è¿›ç¨‹ç¼–ç¨‹ åˆ›å»º fork()å‡½æ•°æ¥åˆ›å»ºæ–°è¿›ç¨‹ Unix&#x2F;Linuxç³»ç»Ÿä¸­ç”¨äºåˆ›å»ºè¿›ç¨‹çš„å”¯ä¸€æ–¹æ³• POSIXæ ‡å‡†çš„ä¸€éƒ¨åˆ† åŸå‹ pid_t fork(void); çˆ¶è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹çš„PID å­è¿›ç¨‹å¾—åˆ°0 å¤±è´¥å¾—åˆ°ä¸€ä¸ªè´Ÿå€¼ æ–°è¿›ç¨‹æ˜¯åŸè¿›ç¨‹çš„å‰¯æœ¬ å­è¿›ç¨‹å°†å¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´(åŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †å’Œæ ˆç­‰)ã€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€ç¯å¢ƒå˜é‡ç­‰èµ„æºã€‚ éœ€è¦å°å¿ƒå¤„ç†èµ„æºé‡Šæ”¾ã€æ–‡ä»¶æè¿°ç¬¦ç­‰é—®é¢˜ï¼Œä»¥é¿å…èµ„æºæ³„éœ²å’Œç«æ€æ¡ä»¶ã€‚ å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ä»£ç æ®µï¼Œä½†åœ¨è¿›ç¨‹ç©ºé—´ä¸­æœ‰è‡ªå·±çš„æ•°æ®æ®µå’Œå †æ ˆæ®µã€‚ &#x3D;&#x3D;pid_t pid &#x3D; fork();&#x3D;&#x3D; çˆ¶å­è¿›ç¨‹éƒ½æœ‰pidè¿™ä¸ªå˜é‡ï¼Œåªæ˜¯ä»–ä»¬çš„å€¼ä¸ä¸€æ · æ ¹æ®è¿™ä¸ªå€¼æ§åˆ¶ä»–ä»¬çš„æ“ä½œ çˆ¶å­è¿›ç¨‹å…³ç³»ï¼š å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ï¼Œä½†åœ¨å¾ˆå¤šæ–¹é¢åˆæ˜¯ç‹¬ç«‹çš„ã€‚çˆ¶å­è¿›ç¨‹ä¹‹é—´é€šå¸¸æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºä¸ç¡®å®šã€‚ çˆ¶å­è¿›ç¨‹ä¼šåŒæ—¶æ‰§è¡Œä¸‹å»ï¼Œä½†æ“ä½œç³»ç»Ÿä¼šä¿è¯çˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹ç»“æŸï¼Œä»¥é¿å…åƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿã€‚ å…¸å‹åº”ç”¨åœºæ™¯ï¼š æœåŠ¡å™¨ç¼–ç¨‹ï¼šå¸¸ç”¨äºåˆ›å»ºå­è¿›ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œçˆ¶è¿›ç¨‹ç›‘å¬æ–°çš„è¿æ¥ã€‚ å¹¶è¡Œç¼–ç¨‹ï¼šé€šè¿‡fork()å¯ä»¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå®ç°å¹¶è¡Œè®¡ç®—ã€‚ 123456789101112131415161718#include &lt;unistd.h&gt; #include &lt;sys/types.h&gt; #include &lt;iostream&gt; int main() &#123; pid_t pid = fork(); if (pid == -1) &#123; // é”™è¯¯å¤„ç† std::cerr &lt;&lt; &quot;Fork failed&quot; &lt;&lt; std::endl; return 1; &#125; else if (pid == 0) &#123; // å­è¿›ç¨‹ä»£ç  std::cout &lt;&lt; &quot;I am the child process, PID: &quot; &lt;&lt; getpid() &lt;&lt; std::endl; &#125; else &#123; // çˆ¶è¿›ç¨‹ä»£ç  std::cout &lt;&lt; &quot;I am the parent process, PID: &quot; &lt;&lt; getpid() &lt;&lt; &quot; Child PID: &quot; &lt;&lt; pid &lt;&lt; std::endl; &#125; return 0; &#125; è¿›ç¨‹é—´é€šä¿¡IPCè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ç®¡é“ï¼ˆpipeï¼‰ã€å‘½åç®¡é“ï¼ˆFIFOï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å†…å­˜ä»¥åŠå¥—æ¥å­—ï¼ˆsocketsï¼‰ç­‰ã€‚ ####ç®¡é“ çˆ¶è¿›ç¨‹é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå¹¶é€šè¿‡fork()åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ã€‚ç„¶åï¼Œçˆ¶è¿›ç¨‹å…³é—­äº†ç®¡é“çš„è¯»ç«¯ï¼ˆfd[0]ï¼‰ï¼Œè€Œå­è¿›ç¨‹å…³é—­äº†ç®¡é“çš„å†™ç«¯ï¼ˆfd[1]ï¼‰ã€‚çˆ¶è¿›ç¨‹é€šè¿‡ç®¡é“çš„å†™ç«¯å‘å­è¿›ç¨‹å‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œå­è¿›ç¨‹é€šè¿‡ç®¡é“çš„è¯»ç«¯æ¥æ”¶è¿™æ¡æ¶ˆæ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;unistd.h&gt; #include &lt;sys/wait.h&gt; #include &lt;iostream&gt; #include &lt;cstring&gt; // ç”¨äºmemset int main() &#123; int fd[2]; if (pipe(fd) == -1) &#123; std::cerr &lt;&lt; &quot;Pipe failed&quot; &lt;&lt; std::endl; return 1; &#125; pid_t pid = fork(); if (pid == -1) &#123; // forkå¤±è´¥ std::cerr &lt;&lt; &quot;Fork failed&quot; &lt;&lt; std::endl; close(fd[0]); close(fd[1]); return 1; &#125; else if (pid == 0) &#123; // å­è¿›ç¨‹ close(fd[1]); // å…³é—­å†™ç«¯ char buf[100]; ssize_t num_read = read(fd[0], buf, sizeof(buf) - 1); if (num_read &gt; 0) &#123; buf[num_read] = &#x27;\\0&#x27;; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥nullç»ˆæ­¢ std::cout &lt;&lt; &quot;Child received: &quot; &lt;&lt; buf &lt;&lt; std::endl; &#125; close(fd[0]); &#125; else &#123; // çˆ¶è¿›ç¨‹ close(fd[0]); // å…³é—­è¯»ç«¯ const char *message = &quot;Hello from parent!&quot;; write(fd[1], message, strlen(message) + 1); // å‘é€æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ç»“å°¾çš„nullå­—ç¬¦ close(fd[1]); wait(NULL); // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ &#125; return 0; &#125; è¿›ç¨‹åŒæ­¥è¿›ç¨‹åŒæ­¥é€šå¸¸ç”¨äºæ§åˆ¶å¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„æ‰§è¡Œé¡ºåºï¼Œä»¥é¿å…ç«äº‰æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´ã€‚å¯ä»¥ä½¿ç”¨ä¿¡å·é‡ï¼ˆsemaphoresï¼‰ã€äº’æ–¥é”ï¼ˆmutexesï¼‰ã€æ¡ä»¶å˜é‡ï¼ˆcondition variablesï¼‰ç­‰æœºåˆ¶æ¥å®ç°åŒæ­¥ã€‚ è¿›ç¨‹çš„ç»ˆæ­¢è¿›ç¨‹çš„ç»ˆæ­¢å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬æ­£å¸¸é€€å‡ºï¼ˆé€šè¿‡returnæˆ–exit()ï¼‰ã€å¼‚å¸¸é€€å‡ºï¼ˆå¦‚æ¥æ”¶åˆ°ä¿¡å·ï¼‰ã€çˆ¶è¿›ç¨‹è¯·æ±‚ç»ˆæ­¢ï¼ˆå¦‚kill()å‡½æ•°ï¼‰ç­‰ã€‚ kill(pid, SIGKILL); æ”¾åœ¨ä¸Šè¿°çˆ¶è¿›ç¨‹ä¸­å¯ä»¥æ€æ­»å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°±æ”¶ä¸åˆ°æ¶ˆæ¯äº† è¿›ç¨‹ç­‰å¾…çˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡wait()æˆ–waitpid()å‡½æ•°ç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚è¿™æœ‰åŠ©äºçˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹çš„èµ„æºå’ŒçŠ¶æ€ä¿¡æ¯ã€‚ å¤šçº¿ç¨‹ç¼–ç¨‹ä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ çº¿ç¨‹é€‚åˆé«˜å¹¶å‘å’Œå…±äº«èµ„æºå¦‚ æ•°æ®åº“æ“ä½œï¼ŒwebæœåŠ¡ è¿›ç¨‹ ç‹¬ç«‹ å¥å£® ###c++ 11 thread pthreadå¬è¯´å¾ˆéš¾ç”¨ï¼Œæˆ‘å°±ä¸ç®¡äº† g++ test.cpp -lpthread åœ¨ä½¿ç”¨std::threadæ—¶ï¼Œç¼–è¯‘å™¨éœ€è¦å°†pthreadåº“é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚ ####æ„é€ å‡½æ•° é»˜è®¤æ„é€ å‡½æ•° thread() noexcept; åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ åˆå§‹åŒ–æ„é€ å‡½æ•° template &lt;class Fn, classâ€¦ Args&gt;explicit thread(Fn&amp;&amp; fn, Args&amp;&amp;â€¦ args); class Fnï¼šè¿™æ˜¯å‡½æ•°çš„ç±»å‹å‚æ•°ï¼Œå¯ä»¥æ˜¯å‡½æ•°æŒ‡é’ˆã€æˆå‘˜å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ï¼ˆå¦‚std::functionã€lambdaè¡¨è¾¾å¼ã€æˆ–ä»»ä½•é‡è½½äº†operator()çš„å¯¹è±¡ï¼‰ç­‰ã€‚ classâ€¦ Argsï¼šè¿™æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°æ¨¡æ¿ï¼Œè¡¨ç¤ºFnå‡½æ•°æ‰€éœ€çš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚â€¦æ˜¯C++11ä¸­å¼•å…¥çš„å‚æ•°åŒ…æ‰©å±•è¯­æ³•ï¼Œå…è®¸å‡½æ•°æ¨¡æ¿æ¥å—ä»»æ„æ•°é‡å’Œç±»å‹çš„å‚æ•°ã€‚ threadçº¿ç¨‹ä¼šè°ƒç”¨fnå‡½æ•°å¹¶å°†å‚æ•°ä¼ é€’ç»™è¿™ä¸ªå‡½æ•° ç§»åŠ¨æ„é€ å‡½æ•° thread(thread&amp;&amp; x) noexcept; ç§»åŠ¨åxä¸ä»£è¡¨ä»»ä½•æ‰§è¡Œå¯¹è±¡ std::thread t4(std::move(t3)); thread t([]() &#123; cout &lt;&lt; &quot;Hello from lambda thread!&quot; &lt;&lt; endl; &#125;); t.join(); 123456789101112131415161718192021222324252627282930313233343536*æ³¨æ„ï¼šå¯è¢«joinableçš„std::threadå¯¹è±¡å¿…é¡»åœ¨ä»–ä»¬é”€æ¯ä¹‹å‰è¢«ä¸»çº¿ç¨‹joinæˆ–è€…å°†å…¶è®¾ç½®ä¸ºdetached ç©ºå¯¹è±¡å’Œè¢«ç§»åŠ¨çš„å¯¹è±¡ä¸ç”¨*~~~c++#include &lt;iostream&gt;#include &lt;utility&gt;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;functional&gt;#include &lt;atomic&gt;void f1(int n)&#123; for (int i = 0; i &lt; 5; ++i) &#123; std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; n &lt;&lt; &quot; executing\\n&quot;; std::this_thread::sleep_for(std::chrono::milliseconds(10)); &#125;&#125;void f2(int&amp; n)&#123; for (int i = 0; i &lt; 5; ++i) &#123; std::cout &lt;&lt; &quot;Thread 2 executing\\n&quot;; ++n; std::this_thread::sleep_for(std::chrono::milliseconds(10)); &#125;&#125;int main()&#123; int n = 0; std::thread t1; // t1 is not a thread std::thread t2(f1, n + 1); // pass by value std::thread t3(f2, std::ref(n)); // pass by reference std::thread t4(std::move(t3)); // t4 is now running f2(). t3 is no longer a thread t2.join(); t4.join(); std::cout &lt;&lt; &quot;Final value of n is &quot; &lt;&lt; n &lt;&lt; &#x27;\\n&#x27;;&#125; threadæ‰§è¡Œå¸¦æœ‰å¼•ç”¨å‚æ•°çš„å‡½æ•° threadä¼ é€’å‚æ•°ä»¥å³å€¼ä¼ é€’ å¦‚ä½•ä¼ é€’å·¦å€¼ï¼Ÿ std::ref å¯ä»¥åŒ…è£…æŒ‰å¼•ç”¨ä¼ é€’çš„å€¼ã€‚std::cref å¯ä»¥åŒ…è£…æŒ‰constå¼•ç”¨ä¼ é€’çš„å€¼ã€‚ èµ‹å€¼thread&amp; operator&#x3D;(thread&amp;&amp; rhs) noexcept; å½“å‰å¯¹è±¡ä¸å¯ joinableï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå³å€¼å¼•ç”¨(rhs)ç»™ move èµ‹å€¼æ“ä½œï¼›å¦‚æœå½“å‰å¯¹è±¡å¯è¢« joinableï¼Œåˆ™ä¼šè°ƒç”¨ terminate() æŠ¥é”™ã€‚ 12345678910111213141516171819202122232425#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;chrono&gt; // std::chrono::seconds#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread, std::this_thread::sleep_forvoid thread_task(int n) &#123; std::this_thread::sleep_for(std::chrono::seconds(n)); std::cout &lt;&lt; &quot;hello thread &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; paused &quot; &lt;&lt; n &lt;&lt; &quot; seconds&quot; &lt;&lt; std::endl;&#125;int main(int argc, const char *argv[])&#123; std::thread threads[5]; std::cout &lt;&lt; &quot;Spawning 5 threads...\\n&quot;; for (int i = 0; i &lt; 5; i++) &#123; threads[i] = std::thread(thread_task, i + 1); &#125; std::cout &lt;&lt; &quot;Done spawning threads! Now wait for them to join\\n&quot;; for (auto&amp; t: threads) &#123; t.join(); &#125; std::cout &lt;&lt; &quot;All threads joined.\\n&quot;; return EXIT_SUCCESS;&#125; å…¶ä»–æˆå‘˜å‡½æ•° join é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ç”± *this æ‰€æ ‡ç¤ºçš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯• join æ‰è¿”å› get_id çº¿ç¨‹ID 12std::thread t1(foo);std::thread::id t1_id = t1.get_id(); joinable æ£€æŸ¥æ˜¯å¦èƒ½è¢«join t.joinable() èƒ½è¿”å›1 ä¸èƒ½è¿”å›0 é»˜è®¤æ„é€ çš„çº¿ç¨‹ä¸èƒ½è¢«join æŸä¸ªçº¿ç¨‹ å·²ç»æ‰§è¡Œå®Œä»»åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰è¢« join çš„è¯ï¼Œè¯¥çº¿ç¨‹ä¾ç„¶ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ´»åŠ¨çš„æ‰§è¡Œçº¿ç¨‹ï¼Œå› æ­¤ä¹Ÿæ˜¯å¯ä»¥è¢« join çš„ï¼Ÿï¼Ÿï¼Ÿ detach å°†å½“å‰çº¿ç¨‹å¯¹è±¡æ‰€ä»£è¡¨çš„æ‰§è¡Œå®ä¾‹ä¸è¯¥çº¿ç¨‹å¯¹è±¡åˆ†ç¦»ï¼Œä½¿å¾—çº¿ç¨‹çš„æ‰§è¡Œå¯ä»¥å•ç‹¬è¿›è¡Œã€‚ä¸€æ—¦çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒæ‰€åˆ†é…çš„èµ„æºå°†ä¼šè¢«é‡Šæ”¾ å¤±å»å¯¹è¿™ä¸ªçº¿ç¨‹çš„ä»å’Œæ§åˆ¶æƒï¼Œä¹Ÿæ— æ³•è®¿é—®åˆ° 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;chrono&gt;#include &lt;thread&gt;void independentThread() &#123; std::cout &lt;&lt; &quot;Starting concurrent thread.\\n&quot;; std::this_thread::sleep_for(std::chrono::seconds(2)); std::cout &lt;&lt; &quot;Exiting concurrent thread.\\n&quot;;&#125;void threadCaller() &#123; std::cout &lt;&lt; &quot;Starting thread caller.\\n&quot;; std::thread t(independentThread); t.detach(); std::this_thread::sleep_for(std::chrono::seconds(1)); std::cout &lt;&lt; &quot;Exiting thread caller.\\n&quot;;&#125;int main() &#123; threadCaller(); std::this_thread::sleep_for(std::chrono::seconds(5));&#125; ä¸Šé¢è¿™æ®µå‡½æ•°å¦‚æœæ²¡æœ‰t.detach(); å½“threadCallerå‡½æ•°ç»“æŸä¹‹åä¼šé”€æ¯tï¼Œä½†æ˜¯è¿™ä¸ªçº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œæ‰€ä»¥è¦ç­‰å¾…è¿è¡Œå®Œæˆä½¿ç”¨t.join() swap äº¤æ¢ä¸¤ä¸ªçº¿ç¨‹çš„åº•å±‚å¥æŸ„ std::swap(t1, t2);t1.swap(t2); native_handle è¿”å› native handle çº¿ç¨‹å¥æŸ„ï¼Œè¿™ä¸ªå¥æŸ„å…è®¸ç›´æ¥è®¿é—®å’Œæ“ä½œ æ“ä½œç³»ç»Ÿåº•å±‚çš„çº¿ç¨‹å¯¹è±¡ threadæ˜¯åŒ…è£…è¿‡çš„ï¼Œè¿™é‡Œè¿”å›åå¯ä»¥ä½¿ç”¨æ€•pthreadåº“ä¸­çš„å‡½æ•°ï¼Œå¦‚æ”¹å˜çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œè®¾ç½®çº¿ç¨‹å±æ€§ç­‰ 12345678910111213141516171819202122232425262728#include &lt;thread&gt;#include &lt;iostream&gt;#include &lt;chrono&gt;#include &lt;cstring&gt;#include &lt;pthread.h&gt;std::mutex iomutex;void f(int num)&#123; std::this_thread::sleep_for(std::chrono::seconds(1)); sched_param sch; int policy; pthread_getschedparam(pthread_self(), &amp;policy, &amp;sch); std::lock_guard&lt;std::mutex&gt; lk(iomutex); std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; num &lt;&lt; &quot; is executing at priority &quot; &lt;&lt; sch.sched_priority &lt;&lt; &#x27;\\n&#x27;;&#125;int main()&#123; std::thread t1(f, 1), t2(f, 2); sched_param sch; int policy; pthread_getschedparam(t1.native_handle(), &amp;policy, &amp;sch); sch.sched_priority = 20; if(pthread_setschedparam(t1.native_handle(), SCHED_FIFO, &amp;sch)) &#123; std::cout &lt;&lt; &quot;Failed to setschedparam: &quot; &lt;&lt; std::strerror(errno) &lt;&lt; &#x27;\\n&#x27;; &#125; t1.join(); t2.join();&#125; std::this_thread å‘½åç©ºé—´ä¸­ç›¸å…³è¾…åŠ©å‡½æ•° get_id: è·å–çº¿ç¨‹ IDã€‚ 123456789101112131415161718#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;mutex&gt;std::mutex g_display_mutex;void foo()&#123; std::thread::id this_id = std::this_thread::get_id(); g_display_mutex.lock(); std::cout &lt;&lt; &quot;thread &quot; &lt;&lt; this_id &lt;&lt; &quot; sleeping...\\n&quot;; g_display_mutex.unlock(); std::this_thread::sleep_for(std::chrono::seconds(1));&#125;int main()&#123; std::thread t1(foo); std::thread t2(foo); t1.join(); t2.join();&#125; yield: å½“å‰çº¿ç¨‹æ”¾å¼ƒæ‰§è¡Œï¼Œæ“ä½œç³»ç»Ÿè°ƒåº¦å¦ä¸€çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚ 1234567891011121314151617181920#include &lt;iostream&gt;#include &lt;chrono&gt;#include &lt;thread&gt;// &quot;busy sleep&quot; while suggesting that other threads run // for a small amount of timevoid little_sleep(std::chrono::microseconds us)&#123; auto start = std::chrono::high_resolution_clock::now(); auto end = start + us; do &#123; std::this_thread::yield(); &#125; while (std::chrono::high_resolution_clock::now() &lt; end);&#125;int main()&#123; auto start = std::chrono::high_resolution_clock::now(); little_sleep(std::chrono::microseconds(100)); auto elapsed = std::chrono::high_resolution_clock::now() - start; std::cout &lt;&lt; &quot;waited for &quot; &lt;&lt; std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(elapsed).count() &lt;&lt; &quot; microseconds\\n&quot;;&#125; sleep_until: çº¿ç¨‹ä¼‘çœ è‡³æŸä¸ªæŒ‡å®šçš„æ—¶åˆ»(time point)ï¼Œè¯¥çº¿ç¨‹æ‰è¢«é‡æ–°å”¤é†’ã€‚ template&lt; class Clock, class Duration &gt;void sleep_until( const std::chrono::time_point&lt;Clock,Duration&gt;&amp; sleep_time ); sleep_for: çº¿ç¨‹ä¼‘çœ æŸä¸ªæŒ‡å®šçš„æ—¶é—´ç‰‡(time span)ï¼Œè¯¥çº¿ç¨‹æ‰è¢«é‡æ–°å”¤é†’ï¼Œä¸è¿‡ç”±äºçº¿ç¨‹è°ƒåº¦ç­‰åŸå› ï¼Œå®é™…ä¼‘çœ æ—¶é—´å¯èƒ½æ¯” sleep_duration æ‰€è¡¨ç¤ºçš„æ—¶é—´ç‰‡æ›´é•¿ã€‚ 123456789#include &lt;iostream&gt;#include &lt;chrono&gt;#include &lt;thread&gt;int main()&#123; std::cout &lt;&lt; &quot;Hello waiter&quot; &lt;&lt; std::endl; std::chrono::milliseconds dura( 2000 ); std::this_thread::sleep_for( dura ); std::cout &lt;&lt; &quot;Waited 2000 ms\\n&quot;;&#125; ####å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€å˜é‡ std::atomicå’Œstd::mutex 123456789101112131415161718#include &lt;iostream&gt;#include &lt;thread&gt;using namespace std;int n = 0;void count10000() &#123; for (int i = 1; i &lt;= 10000; i++) n++;&#125;int main() &#123; thread th[100]; // è¿™é‡Œå·äº†ä¸€ä¸‹æ‡’ï¼Œç”¨äº†c++11çš„foreachç»“æ„ for (thread &amp;x : th) x = thread(count10000); for (thread &amp;x : th) x.join(); cout &lt;&lt; n &lt;&lt; endl; return 0;&#125; è¿™é‡Œæˆ‘è¾“å‡º989816ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯1000000ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®n ä¸€ä¸ªçº¿ç¨‹å°†mutexé”ä½æ—¶ï¼Œå…¶å®ƒçš„çº¿ç¨‹å°±ä¸èƒ½æ“ä½œmutexï¼Œç›´åˆ°è¿™ä¸ªçº¿ç¨‹å°†mutexè§£é” 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;using namespace std;int n = 0;mutex mtx;void count10000() &#123; for (int i = 1; i &lt;= 10000; i++) &#123; mtx.lock(); n++; mtx.unlock(); &#125;&#125;int main() &#123; thread th[100]; for (thread &amp;x : th) x = thread(count10000); for (thread &amp;x : th) x.join(); cout &lt;&lt; n &lt;&lt; endl; return 0;&#125; mutexè¿˜æœ‰ä¸€ä¸ªå‡½æ•°bool try_lock() å°è¯•ä¸Šé”ï¼Œæ²¡æœ‰è¢«é”åˆ™é”è¿”å›trueï¼Œå¦åˆ™false mutexå›ºç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ std::atomic åªéœ€è¦æŠŠint n&#x3D;0æ”¹ä¸ºatomic_int n &#x3D; 0;æˆ–atomic n &#x3D; 0; åŸå­æ“ä½œæ˜¯æœ€å°çš„ä¸”ä¸å¯å¹¶è¡ŒåŒ–çš„æ“ä½œã€‚ ###std::async threadå¯ä»¥å¿«é€Ÿã€æ–¹ä¾¿åœ°åˆ›å»ºçº¿ç¨‹ï¼Œä½†åœ¨asyncé¢å‰ï¼Œå°±æ˜¯å°å·«è§å¤§å·«äº†ã€‚asyncå¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©åŒæ­¥æ‰§è¡Œæˆ–åˆ›å»ºæ–°çº¿ç¨‹æ¥å¼‚æ­¥æ‰§è¡Œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ã€‚å¯¹äºasyncçš„è¿”å›å€¼æ“ä½œä¹Ÿæ¯”threadæ›´åŠ æ–¹ä¾¿ã€‚ asyncæ˜¯ä¸€ä¸ªå‡½æ•° 1234567891011#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;future&gt;using namespace std;int main() &#123; async(launch::async, [](const char *message)&#123; cout &lt;&lt; message &lt;&lt; flush; &#125;, &quot;Hello, &quot;); cout &lt;&lt; &quot;World!&quot; &lt;&lt; endl; return 0;&#125; template &lt;class Fn, classâ€¦ Args&gt;future&lt;typename result_of&lt;Fn(Argsâ€¦)&gt;::type&gt;async (Fn&amp;&amp; fn, Args&amp;&amp;â€¦ args) æˆ– async (launch policy, Fn&amp;&amp; fn, Args&amp;&amp;â€¦ args); åŒæ ·åœ°ï¼Œä¼ é€’å¼•ç”¨å‚æ•°éœ€è¦std::refæˆ–std::cref std::launchæœ‰2ä¸ªæšä¸¾å€¼å’Œ1ä¸ªç‰¹æ®Šå€¼ æšä¸¾å€¼ï¼šlaunch::async 0x1ï¼ˆ1ï¼‰ å¼‚æ­¥å¯åŠ¨æšä¸¾å€¼ï¼šlaunch::deferred 0x2ï¼ˆ2ï¼‰ åœ¨è°ƒç”¨future::getã€future::waitæ—¶åŒæ­¥å¯åŠ¨ï¼ˆstd::futureè§åæ–‡ï¼‰ç‰¹æ®Šå€¼ï¼šlaunch::async | launch::defereed 0x3ï¼ˆ3ï¼‰ åŒæ­¥æˆ–å¼‚æ­¥ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿè€Œå®š ####ä½¿ç”¨std::futureè·å–çº¿ç¨‹çš„è¿”å›å€¼ 123456789101112131415#include &lt;iostream&gt;#include &lt;future&gt; // std::async std::futureusing namespace std;template&lt;class ... Args&gt; decltype(auto) sum(Args&amp;&amp;... args) &#123; // C++17æŠ˜å è¡¨è¾¾å¼ // &quot;0 +&quot;é¿å…ç©ºå‚æ•°åŒ…é”™è¯¯ return (0 + ... + args);&#125;int main() &#123; // æ³¨ï¼šè¿™é‡Œä¸èƒ½åªå†™å‡½æ•°åsumï¼Œå¿…é¡»å¸¦æ¨¡æ¿å‚æ•° future&lt;int&gt; val = async(launch::async, sum&lt;int, int, int&gt;, 1, 10, 100); // future::get() é˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å¾—è¿”å›å€¼ cout &lt;&lt; val.get() &lt;&lt; endl; return 0;&#125; linuxä¸‹æŠ¥é”™ï¼Œwinä¸‹å¯ä»¥è¿è¡Œ æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°sumï¼Œå®ƒå¯ä»¥è®¡ç®—å¤šä¸ªæ•°å­—çš„å’Œï¼Œä¹‹åæˆ‘ä»¬åˆå®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡valï¼Œå®ƒçš„ç±»å‹æ˜¯std::futureï¼Œè¿™é‡Œçš„intä»£è¡¨è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯intç±»å‹ã€‚åœ¨åˆ›å»ºçº¿ç¨‹åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†future::get()æ¥é˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å–å…¶è¿”å›å€¼ã€‚è‡³äºsumå‡½æ•°ä¸­çš„æŠ˜å è¡¨è¾¾å¼ï¼ˆfold expressionï¼‰ï¼Œä¸æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ã€‚ æˆå‘˜å‡½æ•° ä¸€èˆ¬ï¼šT get() é˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å–è¿”å›å€¼å½“ç±»å‹ä¸ºå¼•ç”¨ï¼šR&amp; future&lt;R&amp;&gt;::get()å½“ç±»å‹ä¸ºvoidï¼švoid future::get() è‹¥ç±»å‹ä¸ºvoidï¼Œåˆ™ä¸future::wait()ç›¸åŒã€‚åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚ void wait() const é˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸ template &lt;class Rep, class Period&gt; future_status wait_for(const chrono::duration&lt;Rep,Period&gt;&amp; rel_time) const; ç­‰å¾…rel_time è‹¥åœ¨è¿™æ®µæ—¶é—´å†…çº¿ç¨‹ç»“æŸåˆ™è¿”å›future_status::readyè‹¥æ²¡ç»“æŸåˆ™è¿”å›future_status::timeoutè‹¥asyncæ˜¯ä»¥launch::deferredå¯åŠ¨çš„ï¼Œåˆ™ä¸ä¼šé˜»å¡å¹¶ç«‹å³è¿”å›future_status::deferred 12345678910111213141516#include &lt;iostream&gt;#include &lt;future&gt;using namespace std;void count_big_number() &#123; // C++14æ ‡å‡†ä¸­ï¼Œå¯ä»¥åœ¨æ•°å­—ä¸­é—´åŠ ä¸Šå•å¼•å· &#x27; æ¥åˆ†éš”æ•°å­—ï¼Œä½¿å…¶å¯è¯»æ€§æ›´å¼º for (int i = 0; i &lt;= 10&#x27;0000&#x27;0000; i++);&#125;int main() &#123; future&lt;void&gt; fut = async(launch::async, count_big_number); cout &lt;&lt; &quot;Please wait&quot; &lt;&lt; flush; // æ¯æ¬¡ç­‰å¾…1ç§’ while (fut.wait_for(chrono::seconds(1)) != future_status::ready) cout &lt;&lt; &#x27;.&#x27; &lt;&lt; flush; cout &lt;&lt; endl &lt;&lt; &quot;Finished!&quot; &lt;&lt; endl; return 0;&#125; ææ‡‚è¿™ä¸ªå°±çŸ¥é“è½¯ä»¶çš„åŠ è½½ç”»é¢æ€ä¹ˆå®ç°çš„äº† std::promisec++ 11 è·å¾—threadçš„è¿”å›å€¼ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­é€šè¿‡promiseè·å–å¦ä¸€ä¸ªçº¿ç¨‹çš„å€¼ å¼•ç”¨ä¼ é€’è¿”å›å€¼ promiseå®é™…ä¸Šæ˜¯std::futureçš„ä¸€ä¸ªåŒ…è£…ï¼Œåœ¨è®²è§£futureæ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç‰µæ‰¯åˆ°æ”¹å˜futureå€¼çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨threadä»¥å¼•ç”¨ä¼ é€’è¿”å›å€¼çš„è¯ï¼Œå°±å¿…é¡»è¦æ”¹å˜futureçš„å€¼ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå®é™…ä¸Šï¼Œfutureçš„å€¼ä¸èƒ½è¢«æ”¹å˜ï¼Œä½†ä½ å¯ä»¥é€šè¿‡promiseæ¥åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ç‰¹å®šå€¼çš„futureã€‚ futureçš„å€¼ä¸èƒ½æ”¹å˜ï¼Œpromiseçš„å€¼å¯ä»¥æ”¹å˜ã€‚ 123456789101112131415161718#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;future&gt; // std::promise std::futureusing namespace std;template&lt;class ... Args&gt; decltype(auto) sum(Args&amp;&amp;... args) &#123; return (0 + ... + args);&#125;template&lt;class ... Args&gt; void sum_thread(promise&lt;long long&gt; &amp;val, Args&amp;&amp;... args) &#123; val.set_value(sum(args...));//é€šè¿‡è°ƒç”¨promiseå¯¹è±¡çš„set_value()æˆ–set_exception()æ–¹æ³•æ¥è®¾ç½®å€¼æˆ–å¼‚å¸¸&#125;int main() &#123; promise&lt;long long&gt; sum_value; thread get_sum(sum_thread&lt;int, int, int&gt;, ref(sum_value), 1, 10, 100); cout &lt;&lt; sum_value.get_future().get() &lt;&lt; endl;//é€šè¿‡è°ƒç”¨promiseå¯¹è±¡çš„get_future()æ–¹æ³•æ¥è·å–ä¸€ä¸ªfuture å¯¹è±¡ get_sum.join(); //è°ƒç”¨futureå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å–è®¾ç½®çš„å€¼ã€‚å¦‚æœpromiseè®¾ç½®äº†å¼‚å¸¸ï¼Œget()æ–¹æ³•å°†é‡æ–°æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ return 0;&#125;//111 ä½¿ç”¨ std::promise å’Œ std::future æ—¶ï¼Œåº”ç¡®ä¿åœ¨è°ƒç”¨ get() æ–¹æ³•ä¹‹å‰ï¼Œset_value() æˆ– set_exception() å·²ç»è¢«è°ƒç”¨ï¼Œå¦åˆ™ get() æ–¹æ³•å°†é˜»å¡ç­‰å¾…å€¼çš„åˆ°æ¥ã€‚ ###std::this_thread c++11 çš„ä¸€ä¸ªå‘½åç©ºé—´ å®ç°çº¿ç¨‹å¯¹è‡ªå·±çš„æ§åˆ¶ å‡½æ•° std::thread::id get_id() noexcept è·å–å½“å‰çº¿ç¨‹id template&lt;class Rep, class Period&gt;void sleep_for( const std::chrono::duration&lt;Rep, Period&gt;&amp; sleep_duration ) ç­‰å¾…sleep_duration ä¸€æ®µæ—¶é—´ void yield() noexcept æš‚æ—¶æ”¾å¼ƒçº¿ç¨‹çš„æ‰§è¡Œï¼Œå°†ä¸»åŠ¨æƒäº¤ç»™å…¶ä»–çº¿ç¨‹ 1234567891011121314151617181920212223242526#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;atomic&gt;using namespace std;atomic_bool ready = 0;// uintmax_t ==&gt; unsigned long longvoid sleep(uintmax_t ms) &#123; this_thread::sleep_for(chrono::milliseconds(ms));&#125;void count() &#123; while (!ready) this_thread::yield(); for (int i = 0; i &lt;= 20&#x27;0000&#x27;0000; i++); cout &lt;&lt; &quot;Thread &quot; &lt;&lt; this_thread::get_id() &lt;&lt; &quot; finished!&quot; &lt;&lt; endl; return;&#125;int main() &#123; thread th[10]; for (int i = 0; i &lt; 10; i++) th[i] = thread(::count); sleep(5000); ready = true; cout &lt;&lt; &quot;Start!&quot; &lt;&lt; endl; for (int i = 0; i &lt; 10; i++) th[i].join(); return 0;&#125; c++20 std::jthread ###çº¿ç¨‹åŒæ­¥ é¿å…ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰å’Œæ•°æ®è®¿é—®å†²çªç­‰é—®é¢˜ã€‚å¸¸è§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…æ‹¬äº’æ–¥é”ï¼ˆMutexï¼‰ã€æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰ã€ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ã€è¯»å†™é”ï¼ˆRead-Write Lockï¼‰ç­‰ ####åŸå­ å¸¸ç”¨äºå®ç°é”ã€ä¿¡å·é‡ã€è®¡æ•°å™¨ç­‰çº¿ç¨‹åŒæ­¥æœºåˆ¶ std::atomicã€std::atomic_flagç­‰ã€‚ std::atomic atomicCounter(0); æ— é”ç¼–ç¨‹ éœ€è¦æ³¨æ„é¿å…ä¸€äº›å¸¸è§çš„é™·é˜±å’Œé”™è¯¯ï¼Œå¦‚ABAé—®é¢˜ã€å†…å­˜é‡æ’ç­‰ã€‚ #####ABAé—®é¢˜ å…·ä½“æ¥è¯´ï¼ŒABAé—®é¢˜çš„å‘ç”Ÿå¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š åˆå§‹æ—¶åˆ»ï¼Œå…±äº«å˜é‡çš„å€¼ä¸ºAã€‚ çº¿ç¨‹T1è¯»å–å…±äº«å˜é‡çš„å€¼Aï¼Œå¹¶è¿›è¡Œä¸€äº›æ“ä½œã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹T2å°†å…±äº«å˜é‡çš„å€¼ä»Aä¿®æ”¹ä¸ºBï¼Œç„¶ååˆå°†å…¶ä¿®æ”¹å›Aï¼Œæ­¤æ—¶å…±äº«å˜é‡çš„å€¼åˆå˜æˆäº†Aã€‚ çº¿ç¨‹T1ç»§ç»­æ‰§è¡Œï¼Œæ ¹æ®å…±äº«å˜é‡å€¼æ˜¯å¦ä¸ºAåšå‡ºåˆ¤æ–­ï¼Œè®¤ä¸ºå…±äº«å˜é‡çš„å€¼æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œç»§ç»­æ‰§è¡Œæ“ä½œã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å…±äº«å˜é‡çš„å€¼åœ¨T1æ‰§è¡ŒæœŸé—´è¢«ä¿®æ”¹äº†ï¼Œä½†T1å¹¶æ²¡æœ‰å¯Ÿè§‰åˆ°è¿™ä¸€å˜åŒ–ï¼Œå› ä¸ºå®ƒåªå…³å¿ƒå…±äº«å˜é‡çš„å½“å‰å€¼æ˜¯å¦ä¸ºAã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒT1å¯èƒ½ä¼šåŸºäºé”™è¯¯çš„å‡è®¾ç»§ç»­æ‰§è¡Œï¼Œå¯¼è‡´ç¨‹åºå‡ºç°é€»è¾‘é”™è¯¯æˆ–å®‰å…¨é—®é¢˜ã€‚ ä¸ºäº†è§£å†³ABAé—®é¢˜ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œå¦‚ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ç­‰ï¼Œæ¥è¾…åŠ©åˆ¤æ–­å…±äº«å˜é‡çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦å¤–ï¼Œä¸€äº›æ•°æ®ç»“æ„ï¼Œå¦‚æ— é”é˜Ÿåˆ—ã€æ— é”æ ˆç­‰ï¼Œä¹Ÿä¼šä½¿ç”¨ç±»ä¼¼çš„æŠ€æœ¯æ¥é¿å…ABAé—®é¢˜çš„å‘ç”Ÿã€‚ #####å†…å­˜é‡æ’ å†…å­˜é‡æ’åŒ…æ‹¬ä¸¤ç§ç±»å‹çš„é‡æ’ï¼š ç¼–è¯‘å™¨é‡æ’ï¼šç¼–è¯‘å™¨å¯èƒ½ä¼šå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ”¹å˜æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†ä¸ä¼šæ”¹å˜ä»£ç çš„è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå°†ä¸€äº›ç‹¬ç«‹çš„æŒ‡ä»¤é‡æ’ä»¥æé«˜å±€éƒ¨æ€§æˆ–å‡å°‘åˆ†æ”¯é¢„æµ‹å¤±è´¥çš„å¯èƒ½æ€§ã€‚ å¤„ç†å™¨é‡æ’ï¼šå¤„ç†å™¨åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œä¹±åºæ‰§è¡Œæˆ–è€…å»¶è¿Ÿæ‰§è¡Œã€‚å¤„ç†å™¨ä¼šæ ¹æ®æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–å…³ç³»å’Œç›¸å…³æ€§è¿›è¡Œé‡æ’ï¼Œä»¥å°½å¯èƒ½åœ°åˆ©ç”¨å¤„ç†å™¨çš„å„ç§åŠŸèƒ½å•å…ƒï¼Œæé«˜æŒ‡ä»¤æ‰§è¡Œæ•ˆç‡ã€‚ å†…å­˜é‡æ’çš„å­˜åœ¨ä½¿å¾—åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¸ºäº†é¿å…å†…å­˜é‡æ’å¯¼è‡´çš„é—®é¢˜ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨åŒæ­¥åŸè¯­ï¼ˆå¦‚äº’æ–¥é”ã€åŸå­æ“ä½œã€å†…å­˜æ …æ ç­‰ï¼‰æ¥ä¿è¯æŒ‡ä»¤çš„é¡ºåºä¸€è‡´æ€§ï¼Œä»¥åŠä½¿ç”¨volatileå…³é”®å­—æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ã€‚ ####æ¡ä»¶å˜é‡ æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰æ˜¯ä¸€ç§çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œç”¨äºåœ¨çº¿ç¨‹é—´è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ã€‚å®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ»¡è¶³æ¡ä»¶æ—¶é€šçŸ¥ç­‰å¾…çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚æ¡ä»¶å˜é‡é€šå¸¸ä¸äº’æ–¥é”ï¼ˆMutexï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„å®‰å…¨è®¿é—®å…±äº«èµ„æºã€‚ ä¸‹é¢æ˜¯æ¡ä»¶å˜é‡çš„ä¸€èˆ¬ç”¨æ³•ï¼š åˆ›å»ºæ¡ä»¶å˜é‡å’Œäº’æ–¥é”ï¼š 12std::condition_variable condVar; // æ¡ä»¶å˜é‡std::mutex mtx; // äº’æ–¥é” ç­‰å¾…æ¡ä»¶ï¼š ç­‰å¾…çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆé”å®šäº’æ–¥é”ï¼Œç„¶åè°ƒç”¨waitæ–¹æ³•ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³ï¼š 12std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é”condVar.wait(lock, []()&#123; return condition; &#125;); // ç­‰å¾…æ¡ä»¶æ»¡è¶³ å”¤é†’ç­‰å¾…çº¿ç¨‹ï¼š å”¤é†’çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆé”å®šäº’æ–¥é”ï¼Œç„¶åè°ƒç”¨notify_oneæˆ–notify_allæ–¹æ³•é€šçŸ¥ç­‰å¾…çº¿ç¨‹ï¼š 123std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é”condition = true; // ä¿®æ”¹æ¡ä»¶condVar.notify_one(); // å”¤é†’ç­‰å¾…çº¿ç¨‹ æ¡ä»¶å˜é‡çš„ä½¿ç”¨å¯ä»¥å¸®åŠ©çº¿ç¨‹ä¹‹é—´è¿›è¡Œé«˜æ•ˆçš„åŒæ­¥å’Œé€šä¿¡ï¼Œé¿å…äº†è½®è¯¢ç­‰ä½æ•ˆçš„ç­‰å¾…æ–¹å¼ã€‚å®ƒå¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€è¯»è€…-å†™è€…æ¨¡å‹ç­‰å¤šçº¿ç¨‹ç¼–ç¨‹åœºæ™¯ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;std::queue&lt;int&gt; dataQueue; // å…±äº«æ•°æ®é˜Ÿåˆ—std::mutex mtx; // äº’æ–¥é”std::condition_variable condVar; // æ¡ä»¶å˜é‡void producer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; &#123; std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é” // ç”Ÿäº§æ•°æ®å¹¶æ”¾å…¥é˜Ÿåˆ— dataQueue.push(i); std::cout &lt;&lt; &quot;Produced data: &quot; &lt;&lt; i &lt;&lt; std::endl; &#125; // åœ¨è§£é”å‰é‡Šæ”¾äº’æ–¥é” // å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹ condVar.notify_one(); // æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„é—´éš” std::this_thread::sleep_for(std::chrono::milliseconds(100)); &#125;&#125;void consumer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; std::unique_lock&lt;std::mutex&gt; lock(mtx); // é”å®šäº’æ–¥é” // ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³ condVar.wait(lock, []()&#123; return !dataQueue.empty(); &#125;); // ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶æ¶ˆè´¹ int data = dataQueue.front(); dataQueue.pop(); std::cout &lt;&lt; &quot;Consumed data: &quot; &lt;&lt; data &lt;&lt; std::endl; // æ¨¡æ‹Ÿæ¶ˆè´¹æ•°æ®çš„å¤„ç†æ—¶é—´ std::this_thread::sleep_for(std::chrono::milliseconds(250)); &#125;&#125;int main() &#123; // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ std::thread producerThread(producer); std::thread consumerThread(consumer); // ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ç»“æŸ producerThread.join(); consumerThread.join(); return 0;&#125; ####ä¿¡å·é‡ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† Semaphore ç±»æ¥å®ç°ä¿¡å·é‡çš„åŠŸèƒ½ã€‚Semaphore ç±»åŒ…å«äº† notify() å’Œ wait() æ–¹æ³•ï¼Œç”¨äºé€šçŸ¥å’Œç­‰å¾…ä¿¡å·é‡ã€‚ ç”Ÿäº§è€…çº¿ç¨‹åœ¨æ¯æ¬¡ç”Ÿäº§æ•°æ®åï¼Œè°ƒç”¨ semProducer.wait() ç­‰å¾…ç”Ÿäº§è€…ä¿¡å·é‡ï¼Œç„¶åå°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—å¹¶é€šçŸ¥æ¶ˆè´¹è€…ä¿¡å·é‡ã€‚æ¶ˆè´¹è€…çº¿ç¨‹åœ¨æ¯æ¬¡æ¶ˆè´¹æ•°æ®å‰ï¼Œè°ƒç”¨ semConsumer.wait() ç­‰å¾…æ¶ˆè´¹è€…ä¿¡å·é‡ï¼Œç„¶åä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®å¹¶é€šçŸ¥ç”Ÿäº§è€…ä¿¡å·é‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;chrono&gt;class Semaphore &#123;public: Semaphore(int count = 0) : count_(count) &#123;&#125; void notify() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); ++count_; condition_.notify_one(); &#125; void wait() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); while (count_ == 0) &#123; condition_.wait(lock); &#125; --count_; &#125;private: std::mutex mutex_; std::condition_variable condition_; int count_;&#125;;std::queue&lt;int&gt; dataQueue; // å…±äº«æ•°æ®é˜Ÿåˆ—Semaphore semProducer(1), semConsumer(0); // ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¿¡å·é‡void producer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; semProducer.wait(); // ç­‰å¾…ç”Ÿäº§è€…ä¿¡å·é‡ dataQueue.push(i); // ç”Ÿäº§æ•°æ® std::cout &lt;&lt; &quot;Produced data: &quot; &lt;&lt; i &lt;&lt; std::endl; semConsumer.notify(); // é€šçŸ¥æ¶ˆè´¹è€…ä¿¡å·é‡ std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„é—´éš” &#125;&#125;void consumer() &#123; for (int i = 0; i &lt; 10; ++i) &#123; semConsumer.wait(); // ç­‰å¾…æ¶ˆè´¹è€…ä¿¡å·é‡ int data = dataQueue.front(); // æ¶ˆè´¹æ•°æ® dataQueue.pop(); std::cout &lt;&lt; &quot;Consumed data: &quot; &lt;&lt; data &lt;&lt; std::endl; semProducer.notify(); // é€šçŸ¥ç”Ÿäº§è€…ä¿¡å·é‡ std::this_thread::sleep_for(std::chrono::milliseconds(250)); // æ¨¡æ‹Ÿæ¶ˆè´¹æ•°æ®çš„å¤„ç†æ—¶é—´ &#125;&#125;int main() &#123; // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ std::thread producerThread(producer); std::thread consumerThread(consumer); // ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ç»“æŸ producerThread.join(); consumerThread.join(); return 0;&#125; ####è¯»å†™é” 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;chrono&gt;#include &lt;vector&gt;class RWLock &#123;public: RWLock() : readerCount(0), writerCount(0) &#123;&#125; void lockRead() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); while (writerCount &gt; 0) &#123; condition_.wait(lock); &#125; ++readerCount; &#125; void unlockRead() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); --readerCount; if (readerCount == 0) &#123; condition_.notify_one(); &#125; &#125; void lockWrite() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); ++writerCount; while (readerCount &gt; 0 || writerCount &gt; 1) &#123; condition_.wait(lock); &#125; &#125; void unlockWrite() &#123; std::unique_lock&lt;std::mutex&gt; lock(mutex_); --writerCount; condition_.notify_all(); &#125;private: std::mutex mutex_; std::condition_variable condition_; int readerCount; int writerCount;&#125;;int data = 0; // å…±äº«æ•°æ®RWLock rwLock; // è¯»å†™é”void reader() &#123; for (int i = 0; i &lt; 10; ++i) &#123; rwLock.lockRead(); // åŠ è¯»é” std::cout &lt;&lt; &quot;Reader &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; reads data: &quot; &lt;&lt; data &lt;&lt; std::endl; rwLock.unlockRead(); // è§£è¯»é” std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿè¯»æ“ä½œçš„é—´éš” &#125;&#125;void writer() &#123; for (int i = 0; i &lt; 5; ++i) &#123; rwLock.lockWrite(); // åŠ å†™é” data++; // ä¿®æ”¹æ•°æ® std::cout &lt;&lt; &quot;Writer &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; writes data: &quot; &lt;&lt; data &lt;&lt; std::endl; rwLock.unlockWrite(); // è§£å†™é” std::this_thread::sleep_for(std::chrono::milliseconds(250)); // æ¨¡æ‹Ÿå†™æ“ä½œçš„é—´éš” &#125;&#125;int main() &#123; // åˆ›å»ºå¤šä¸ªè¯»è€…çº¿ç¨‹å’Œå†™è€…çº¿ç¨‹ std::vector&lt;std::thread&gt; readers, writers; for (int i = 0; i &lt; 3; ++i) &#123; readers.emplace_back(reader); &#125; for (int i = 0; i &lt; 2; ++i) &#123; writers.emplace_back(writer); &#125; // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ for (auto&amp; readerThread : readers) &#123; readerThread.join(); &#125; for (auto&amp; writerThread : writers) &#123; writerThread.join(); &#125; return 0;&#125; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† RWLock ç±»æ¥å®ç°è¯»å†™é”çš„åŠŸèƒ½ã€‚RWLock ç±»åŒ…å«äº† lockRead()ã€unlockRead()ã€lockWrite() å’Œ unlockWrite() æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºè¯»é”çš„åŠ é”ã€è¯»é”çš„è§£é”ã€å†™é”çš„åŠ é”å’Œå†™é”çš„è§£é”ã€‚ è¯»è€…çº¿ç¨‹åœ¨æ¯æ¬¡è¯»å–æ•°æ®å‰ï¼Œè°ƒç”¨ rwLock.lockRead() åŠ è¯»é”ï¼Œè¯»å–æ•°æ®åè°ƒç”¨ rwLock.unlockRead() è§£è¯»é”ã€‚å†™è€…çº¿ç¨‹åœ¨æ¯æ¬¡ä¿®æ”¹æ•°æ®å‰ï¼Œè°ƒç”¨ rwLock.lockWrite() åŠ å†™é”ï¼Œä¿®æ”¹æ•°æ®åè°ƒç”¨ rwLock.unlockWrite() è§£å†™é”ã€‚ é€šè¿‡ä½¿ç”¨è¯»å†™é”ï¼Œå®ç°äº†è¯»è€…-å†™è€…æ¨¡å‹ä¸­çš„çº¿ç¨‹åŒæ­¥å’Œå¹¶å‘æ§åˆ¶ï¼Œæé«˜äº†è¯»æ“ä½œçš„å¹¶å‘æ€§èƒ½ã€‚ ####çº¿ç¨‹å±€éƒ¨å­˜å‚¨TLS çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread-Local Storageï¼ŒTLSï¼‰æ˜¯ä¸€ç§çº¿ç¨‹ç‰¹å®šæ•°æ®ï¼ˆThread-Specific Dataï¼ŒTSDï¼‰çš„å­˜å‚¨æœºåˆ¶ å…è®¸æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ã€‚è¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°è®¿é—®å’Œä¿®æ”¹è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ•°æ®ã€‚ ä½†æ˜¯è‡ªC++11èµ·ï¼Œæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªåä¸ºstd::thread_localçš„å…³é”®å­—ï¼Œå¯ä»¥è½»æ¾å®ç°çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€‚ 123456789101112131415161718192021#include &lt;iostream&gt;#include &lt;thread&gt;// å®šä¹‰çº¿ç¨‹å±€éƒ¨å˜é‡thread_local int tls_variable = 0;void threadFunction() &#123; // æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„tls_variableå‰¯æœ¬ tls_variable++; std::cout &lt;&lt; &quot;Thread ID: &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;, TLS variable: &quot; &lt;&lt; tls_variable &lt;&lt; std::endl;&#125;int main() &#123; std::thread t1(threadFunction); std::thread t2(threadFunction); t1.join(); t2.join(); return 0;&#125; tls_variableæ˜¯ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬ã€‚åœ¨threadFunction()å‡½æ•°ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šé€’å¢è‡ªå·±çš„tls_variableå‰¯æœ¬ï¼Œå¹¶æ‰“å°å‡ºå½“å‰çº¿ç¨‹çš„IDå’ŒTLSå˜é‡çš„å€¼ã€‚å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œæ‰€ä»¥è¾“å‡ºçš„ç»“æœä¼šæ˜¾ç¤ºä¸åŒçš„çº¿ç¨‹IDå’Œä¸åŒçš„TLSå˜é‡å€¼ã€‚ ç½‘ç»œIO&lt;å†…å­˜åˆ†ä¸ºå†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒº&gt; ç”¨æˆ·ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ç¼“å­˜åŒº è€Œ IO æ“ä½œã€ç½‘ç»œè¯·æ±‚åŠ è½½åˆ°å†…å­˜çš„æ•°æ®ä¸€å¼€å§‹æ˜¯æ”¾åœ¨å†…æ ¸ç¼“å†²åŒºçš„ äº”ç§ç½‘ç»œIOæ¨¡å‹ BIO-é˜»å¡æ¨¡å¼I&#x2F;O ç”¨æˆ·å‘èµ·è¯·æ±‚(ç³»ç»Ÿè°ƒç”¨)ï¼Œå¦‚æœæœ‰(å†…æ ¸ç¼“å­˜åŒº),ä»å†…æ ¸ç¼“å­˜åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å­˜åŒº,å¦‚æœæ²¡æœ‰ç”¨æˆ·è¿›è¡Œé˜»å¡ç­‰å¾… è¿›è¡ŒIOæ“ä½œå°†æ•°æ®æ‹¿åˆ°å†…æ ¸ç¼“å­˜åŒº NIO-éé˜»å¡æ¨¡å¼ ç”¨æˆ·è¿›ç¨‹å‘èµ·è¯·æ±‚ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼›å¯ä»¥é€‰æ‹©è½®è¯¢è®¿é—®æˆ–è€…åšç‚¹å…¶ä»–äº‹å†æ¥è®¿é—®,ç›´åˆ°è¢«å‘ŠçŸ¥æ•°æ®å‡†å¤‡å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹æ¥æ”¶ä¸ºæ­¢ï¼› æ•°æ®ä¼šç”±ç”¨æˆ·è¿›ç¨‹å®Œæˆæ‹·è´ æ•´ä¸ªè¿‡ç¨‹ è½®è¯¢(è½®è¯¢æ¶ˆè€—èµ„æº,å½±å“æ€§èƒ½)+ç­‰å¾…(å†…æ ¸ç¼“å†²åŒºåˆ°ç”¨æˆ·ç¼“å­˜åŒº) åŒä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½ç›‘å¬ä¸€ä¸ªsocketï¼Œé€ æˆæµªè´¹ï¼Œå¼•å…¥ioå¤šè·¯å¤ç”¨ï¼ŒåŒæ—¶ç›‘å¬è¯»ä¸ªsocket IOå¤šè·¯å¤ç”¨ ä½¿ç”¨selectã€pollæˆ–epollç­‰ç³»ç»Ÿè°ƒç”¨ç›‘å¬å¤šä¸ªIOäº‹ä»¶ã€‚è¿™äº›ç³»ç»Ÿè°ƒç”¨å¯ä»¥è®©åº”ç”¨ç¨‹åºåŒæ—¶ç›‘è§†å¤šä¸ªIOæ“ä½œï¼Œå¹¶åœ¨æŸä¸ªIOæ“ä½œå°±ç»ªæ—¶é€šçŸ¥åº”ç”¨ç¨‹åº æ•°æ®ä¼šç”±ç”¨æˆ·è¿›ç¨‹å®Œæˆæ‹·è´ é€‚ç”¨åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥å¦‚ç½‘ç»œæœåŠ¡å™¨ å•ä¸ªè¿æ¥æ•ˆç‡ä½ ä¿¡å·é©±åŠ¨IOæ¨¡å‹ åº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¯·æ±‚ç³»ç»Ÿåœ¨IOå®Œæˆæ—¶å‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ã€‚å½“IOæ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ï¼Œåº”ç”¨ç¨‹åºåœ¨&#x3D;&#x3D;ä¿¡å·å¤„ç†å‡½æ•°&#x3D;&#x3D;ä¸­å¤„ç†IOå®Œæˆäº‹ä»¶ã€‚ é€‚ç”¨äºå¤šä¸ªIOäº‹ä»¶ è®¾è®¡å¤æ‚,è¿‡å¤šè¿æ¥å¯¼è‡´æ¶ˆè€—å¤§ AIO å¼‚æ­¥I&#x2F;Oæ¨¡å‹ åº”ç”¨ç¨‹åºå‘èµ·IOæ“ä½œåï¼Œå¯ä»¥ç«‹å³è¿”å›å¹¶ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œã€‚å½“IOæ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨&#x3D;&#x3D;å›è°ƒå‡½æ•°ä¸­&#x3D;&#x3D;å¤„ç†IOå®Œæˆäº‹ä»¶ã€‚ å‘èµ·è¯·æ±‚ç«‹åˆ»å¾—åˆ°å›å¤ï¼Œä¸ç”¨æŒ‚èµ·ç­‰å¾…ï¼› æ•°æ®ä¼šç”±å†…æ ¸è¿›ç¨‹ä¸»åŠ¨å®Œæˆæ‹·è´ é«˜å¹¶å‘é«˜æ€§èƒ½,å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—å’Œç½‘ç»œæœåŠ¡ C&#x2F;C++ Linux æœåŠ¡å™¨å¼€å‘é«˜çº§æ¶æ„å­¦ä¹ è§†é¢‘ç‚¹å‡»https://ke.qq.com/course/417774?flowToken=1013189 é€‰æ‹©å“ªä¸ªæ¡†æ¶å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®èƒŒæ™¯ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªè·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆï¼ŒBoost.Asioå¯èƒ½æ˜¯æœ€ä½³é€‰æ‹©ï¼›å¦‚æœä½ éœ€è¦ä¸€ä¸ªåŠŸèƒ½é½å…¨ä¸”æ˜“äºä½¿ç”¨çš„åº“ï¼ŒPocoæ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ï¼›è€Œå¦‚æœä½ æ­£åœ¨æ„å»ºé«˜æ€§èƒ½çš„LinuxæœåŠ¡å™¨åº”ç”¨ï¼ŒMUDuoåˆ™éå¸¸åˆé€‚ã€‚ ã€Šunixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ ã€Šunixç½‘ç»œç¼–ç¨‹ã€‹ å¦‚æœä½ è¦å†™ä¸€ä¸ªWebServerï¼Œå…¥é—¨çš„ä¹¦ç±å½“ç„¶æœ€å¥½æ˜¯æ¸¸åŒçš„ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹(è¯»ä¹¦ç¬”è®°:https://github.com/HiganFish/Notes-HighPerformanceLinuxServerProgramming)äº†ï¼Œå½“è¿™æœ¬å†…å®¹åŸºæœ¬éƒ½æŒæ¡åï¼Œå¦‚æœæœ‰èƒ½åŠ›è¿˜å¯ä»¥å†å»çœ‹ä¸€ä¸‹é™ˆç¡•å¤§ä½¬çš„ã€ŠLinuxå¤šçº¿ç¨‹æœåŠ¡å™¨ç¼–ç¨‹ã€‹ä½¿ç”¨muduo C++ç½‘ç»œåº“ï¼Œå»é˜…è¯»æºç ï¼Œè‡ªåˆ¶ä¸€ä¸ªå±äºè‡ªå·±çš„ç½‘ç»œåº“ï¼Œç›¸ä¿¡å¯¹ä½ çš„codingèƒ½åŠ›æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æå‡ã€‚ ç¥–å¸ˆçˆ·GitHub - qinguoyi&#x2F;TinyWebServer: :fire: Linuxä¸‹C++è½»é‡çº§WebServeræœåŠ¡å™¨ å¸ˆå”GitHub - markparticle&#x2F;WebServer: C++ Linux WebServeræœåŠ¡å™¨ å¸ˆå“¥https://love6.blog.csdn.net/article/details/123754194 æºç https://github.com/Cooi-Boi/High-Performance-WebServer å¸ˆå¼Ÿhttps://blog.csdn.net/weixin_51322383/article/details/130464403 æºç https://github.com/JehanRio/TinyWebServer?tab=readme-ov-file c++ç½‘ç»œç¼–ç¨‹ä¸‰å¤§æ¡†æ¶å¯¹æ¯”https://zhuanlan.zhihu.com/p/714229209","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[]},{"title":"Linuxç³»ç»Ÿå®‰è£…","slug":"source/Linux/Linuxç³»ç»Ÿå®‰è£…","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-11T14:51:50.711Z","comments":true,"path":"2025/03/02/source/Linux/Linuxç³»ç»Ÿå®‰è£…/","permalink":"http://example.com/2025/03/02/source/Linux/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/","excerpt":"","text":"å®‰è£…è™šæ‹Ÿæœºå‰ç½®å‡†å¤‡ biosé‡Œä¿®æ”¹è®¾ç½®ï¼šå¼€å¯è™šæ‹ŸåŒ–è®¾å¤‡æ”¯æŒ ã€ä¸Šç½‘æœç´¢ï¼ˆç³»ç»Ÿé»˜è®¤å¼€å¯ï¼‰ã€‘ ç®¡ç†å‘˜è¿è¡ŒVMwareå®‰è£…åŒ… å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªcpu-16æ ¸ï¼Œæˆ‘ä»¬åˆ†é…ä¸¤ä¸ªcpu-æ¯ä¸ª4æ ¸ AnolisAnolis8.6 GA ä¸‹è½½åœ°å€ï¼šhttps://mirrors.openanolis.cn/anolis/8.6/isos/GA/x86_64/ ä¸‹è½½minimal.iso è™šæ‹Ÿæœºé€‰æ‹©centos 8 64ä½ CentOS7ä¸‹è½½åœ°å€ï¼šhttps://mirrors.aliyun.com/centos/7/isos/x86_64/ CentOS-7-x86_64-Minimal-2009.iso Ubuntuå®‰è£…g++sudo apt update sudo apt install build-essential gdb åŒæ—¶å®‰è£…gcc g++ gdp apt install net-tools å®‰è£…arpç­‰ç½‘ç»œå·¥å…· ##Anoliså®‰è£…g++ yum update yum install gcc yum install gcc-c++ libstdc++-devel yum install gdb ç¼–è¯‘å™¨ yum install cmake yum install tree ä¸€èˆ¬è·³è½¬åˆ°è¦æŸ¥çœ‹çš„ç›®å½•ä¸‹tree . æ‰‹åŠ¨å¦‚ä½•å®‰è£…ï¼Ÿï¼Ÿ?é…ç½®ç¯å¢ƒ&#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; ä½¿ç”¨gccç¼–è¯‘cè¯­è¨€æ–‡ä»¶ g++ç¼–è¯‘c++ vscodeä¹Ÿæ˜¯ä½¿ç”¨gcc ##ç¼–è¯‘è¿‡ç¨‹ é¢„å¤„ç† g++ -E test.cpp -o test.i -E å¤´æ–‡ä»¶ï¼Œå®ç­‰å¤„ç† ç¼–è¯‘ g++ -S test.i -o test.s -S ç”Ÿæˆæ±‡ç¼–æ–‡ä»¶ æ±‡ç¼– g++ -C test.s -o test.o -C ä»…æŠŠæºä»£ç ç¼–è¯‘ä¸ºæœºå™¨è¯­è¨€ï¼ˆäºŒè¿›åˆ¶ï¼‰çš„ç›®æ ‡ä»£ç  é“¾æ¥ g++ test.o -o test -oæŒ‡å®šäº§ç”Ÿçš„æ–‡ä»¶å ç”Ÿæˆbinæ–‡ä»¶ ä½¿ç”¨è¿™ä¸€æ­¥ä¼šè‡ªåŠ¨å®Œæˆå‰é¢ä¸‰æ­¥ é“¾æ¥æ˜¯å°†ç¼–è¯‘åç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä»¥åŠç¨‹åºä¸­å¯èƒ½éœ€è¦çš„åº“æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚åœ¨é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨ï¼ˆLinkerï¼‰ä¼šå¤„ç†ç›®æ ‡æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶è§£å†³ä»»ä½•ç¬¦å·å¼•ç”¨ï¼ˆæ¯”å¦‚å‡½æ•°æˆ–å˜é‡çš„è°ƒç”¨ï¼‰ã€‚ .&#x2F;test è¿è¡Œå½“å‰è·¯å¾„ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶test ###g++ç¼–è¯‘å‚æ•° -g äº§ç”Ÿå¸¦å¯è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶ -O[n] ä¼˜åŒ–ä»£ç  -O&#x3D;-O1 -O0ä¸åšä¼˜åŒ– ä¸€èˆ¬åˆ°-O2å°±å¯ä»¥äº† æœ€å¤š-O3 time .&#x2F; test å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ—¶é—´ -l usr&#x2F;local&#x2F;lib usr&#x2F;lib lib è¿™ä¸‰ä¸ªç›®å½•ä¸‹çš„åº“è¿™æ ·ä½¿ç”¨ g++ -lglog test.cpp é“¾æ¥glogåº“ -L å…¶ä»–ç›®å½• g++ -L&#x2F;home&#x2F;tutu -lmytest test.cpp é“¾æ¥myteståº“ -I å¤´æ–‡ä»¶ä¸åœ¨&#x2F;usr&#x2F;include g++ -I&#x2F;myincldue test.cpp -Wall æ‰“å°è­¦å‘Šä¿¡æ¯ -wå…³é—­è­¦å‘Šä¿¡æ¯ -std&#x3D;c++11 ä½¿ç”¨c++11æ ‡å‡† -oæŒ‡å®šè¾“å‡ºåå­— æ²¡æœ‰ä¼šç”Ÿæˆa.out -Dä½¿ç”¨å® å‘½ä»¤è¡Œç¼–è¯‘ å¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªç›®å½•ç»“æ„ ç›´æ¥ç¼–è¯‘ g++ main.cpp src&#x2F;swap.cpp -Iinclude å¦‚æœhead.hå’Œhead.cppåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸‹åˆ™ä¸éœ€è¦-Iinclude .&#x2F;a.out æ‰§è¡Œ å¢åŠ ç¼–è¯‘å‚æ•° g++ main.cpp src&#x2F;swap.cpp -Iinclude -Wall -std&#x3D;c++11 -o b.out ç”Ÿæˆåº“æ–‡ä»¶å¹¶ç¼–è¯‘ é“¾æ¥é™æ€åº“ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ cd src g++ swap.cpp -c -I..&#x2F;include ç”Ÿæˆswap.o ar rs libswap.a swap.o æŠŠswap.oå½’æ¡£ä¸ºlibswap.açš„é™æ€åº“æ–‡ä»¶ cd .. g++ main.cpp -lswap -Lsrc -Iinclude -o static_main .&#x2F;static_main é“¾æ¥åŠ¨æ€åº“ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ cd src g++ swap.cpp -I..&#x2F;inlcude -fpic -shared -o libswap.so -fpicäºè·¯å¾„æ— å…³ -sharedç”ŸæˆåŠ¨æ€åº“ .soåŠ¨æ€åº“åç¼€ cd .. g++ main.cpp -Iinclude -lswap -Lsrc -o dyna_main .&#x2F;dyna_main è¿è¡Œä¸äº† åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨srcé‡Œé¢ é™æ€åœ¨å¤–é¢ï¼ˆåµŒåˆ°main.cppä¸­ï¼‰ åŒºåˆ«&#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; LD_LIBRARY_PATH&#x3D;src .&#x2F;dyna_main åœ¨æŒ‡å®šæ–‡ä»¶ä¸­æœç´¢ ###GDBè°ƒè¯•å™¨ 1234567891011121314151617181920212223242526## ä»¥ä¸‹å‘½ä»¤åæ‹¬å·å†…ä¸ºå‘½ä»¤çš„ç®€åŒ–ä½¿ç”¨ï¼Œæ¯”å¦‚runï¼ˆrï¼‰ï¼Œç›´æ¥è¾“å…¥å‘½ä»¤ r å°±ä»£è¡¨å‘½ä»¤run$(gdb)help(h) # æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼Œå…·ä½“å‘½ä»¤æŸ¥è¯¢åœ¨gdbä¸­è¾“å…¥help + å‘½ä»¤ $(gdb)run(r) # é‡æ–°å¼€å§‹è¿è¡Œæ–‡ä»¶ï¼ˆrun-textï¼šåŠ è½½æ–‡æœ¬æ–‡ä»¶ï¼Œrun-binï¼šåŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰$(gdb)start # å•æ­¥æ‰§è¡Œï¼Œè¿è¡Œç¨‹åºï¼Œåœåœ¨ç¬¬ä¸€è¡Œæ‰§è¡Œè¯­å¥$(gdb)list(l) # æŸ¥çœ‹åŸä»£ç ï¼ˆlist-n,ä»ç¬¬nè¡Œå¼€å§‹æŸ¥çœ‹ä»£ç ã€‚list+ å‡½æ•°åï¼šæŸ¥çœ‹å…·ä½“å‡½æ•°ï¼‰$(gdb)set # è®¾ç½®å˜é‡çš„å€¼$(gdb)next(n) # å•æ­¥è°ƒè¯•ï¼ˆé€è¿‡ç¨‹ï¼Œå‡½æ•°ç›´æ¥æ‰§è¡Œï¼‰$(gdb)step(s) # å•æ­¥è°ƒè¯•ï¼ˆé€è¯­å¥ï¼šè·³å…¥è‡ªå®šä¹‰å‡½æ•°å†…éƒ¨æ‰§è¡Œï¼‰$(gdb)backtrace(bt) # æŸ¥çœ‹å‡½æ•°çš„è°ƒç”¨çš„æ ˆå¸§å’Œå±‚çº§å…³ç³»$(gdb)frame(f) # åˆ‡æ¢å‡½æ•°çš„æ ˆå¸§$(gdb)info(i) # æŸ¥çœ‹å‡½æ•°å†…éƒ¨å±€éƒ¨å˜é‡çš„æ•°å€¼$(gdb)finish # ç»“æŸå½“å‰å‡½æ•°ï¼Œè¿”å›åˆ°å‡½æ•°è°ƒç”¨ç‚¹$(gdb)continue(c) # ç»§ç»­è¿è¡Œ$(gdb)print(p) # æ‰“å°å€¼åŠåœ°å€$(gdb)quit(q) # é€€å‡ºgdb$(gdb)break+num(b) # åœ¨ç¬¬numè¡Œè®¾ç½®æ–­ç‚¹$(gdb)info breakpoints # æŸ¥çœ‹å½“å‰è®¾ç½®çš„æ‰€æœ‰æ–­ç‚¹$(gdb)delete breakpoints num(d) # åˆ é™¤ç¬¬numä¸ªæ–­ç‚¹$(gdb)display # è¿½è¸ªæŸ¥çœ‹å…·ä½“å˜é‡å€¼$(gdb)undisplay # å–æ¶ˆè¿½è¸ªè§‚å¯Ÿå˜é‡$(gdb)watch # è¢«è®¾ç½®è§‚å¯Ÿç‚¹çš„å˜é‡å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œæ‰“å°æ˜¾ç¤º$(gdb)i watch # æ˜¾ç¤ºè§‚å¯Ÿç‚¹$(gdb)enable breakpoints # å¯ç”¨æ–­ç‚¹$(gdb)disable breakpoints # ç¦ç”¨æ–­ç‚¹$(gdb)x # æŸ¥çœ‹å†…å­˜x/20xw æ˜¾ç¤º20ä¸ªå•å…ƒï¼Œ16è¿›åˆ¶ï¼Œ4å­—èŠ‚æ¯å•å…ƒ$(gdb)run argv[1] argv[2] # è°ƒè¯•æ—¶å‘½ä»¤è¡Œä¼ å‚$(gdb)set follow-fork-mode child # Makefileé¡¹ç›®ç®¡ç†ï¼šé€‰æ‹©è·Ÿè¸ªçˆ¶å­è¿›ç¨‹ï¼ˆfork()ï¼‰ ç¼–è¯‘ç¨‹åºæ—¶éœ€è¦åŠ ä¸Š-gï¼Œä¹‹åæ‰èƒ½ç”¨gdbè¿›è¡Œè°ƒè¯•ï¼šgcc -g main.c -o main å›è½¦é”®ï¼šé‡å¤ä¸Šä¸€å‘½ä»¤ gdb main cmakecmake windows(ä¸ç”¨çœ‹)è½¯ä»¶æ„å»º(build)ï¼šcmake å…¨è‡ªåŠ¨å®Œæˆä»£ç ç¼–è¯‘ï¼Œé“¾æ¥ï¼Œæ‰“åŒ… è·¨å¹³å° vs:MSbuild ä¸åŒç¼–è¯‘å™¨ä½¿ç”¨çš„å·¥å…·ä¸åŒ cmakeå¯ä»¥æ”¯é…æ‰€æœ‰ cmakeï¼šä¸ç”¨æ‰‹åŠ¨é…ç½®makefile é¦–å…ˆvscodeå®‰è£…æ’ä»¶cmake cmaketools ç¼–è¯‘è¿è¡Œå•ä¸ªæ–‡ä»¶ 123cmake_minimum_required(VERSION 3.10) //è¦æ±‚cmakeçš„æœ€ä½ç‰ˆæœ¬project(Example) //æŒ‡å®šå·¥ç¨‹åå­—ï¼Œä¹Ÿæ˜¯ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—add_executable(Example test.cpp) //è¡¨ç¤ºæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç”±test.cppç¼–è¯‘è€Œæˆ #####é…ç½®(configure) æ ¹æ®è¿™ä¸ªcmakelistsæ–‡ä»¶ç”Ÿæˆç›®æ ‡å¹³å°çš„åŸç”Ÿå·¥ç¨‹â€“é…ç½®(configure) å‘½ä»¤é¢æ¿ctrl+shift+p è¾“å…¥&gt;cmake configure é€‰æ‹© å‘½ä»¤è¡ŒæŒ‡ä»¤ cmake -S . -B build ä¹‹åä¿å­˜ä¼šè‡ªåŠ¨é…ç½® #####æ„å»º(build) F7æˆ–è€…&gt;cmake build å‘½ä»¤è¡ŒæŒ‡ä»¤ cmake â€“build build è¿è¡Œå¤åˆ¶ç²˜è´´æ„å»ºåæœ€åä¸€è¡Œçš„è·¯å¾„ C:\\Users\\Tutu\\Desktop\\cmake\\build\\Debug\\Example.exe BV1rR4y1E7n9 å…¥é—¨-ä»£ç è§£é‡Š https://subingwen.cn/cmake/CMake-primer/ è¯¦ç»†æ–‡æ¡£ BV14s4y1g7Zj è§†é¢‘è§£æ 1234567891011121314151617181920212223cmake_minimum_required(VERSION 3.10) project(Example)#find_package(easyx REQUIRED) file(GLOB &quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.h&quot; &quot;$&#123;PROJECT_SOURCE_DIR&#125;/src/*.cpp&quot;)add_executable($&#123;CMAKE_PROJECT_NAME&#125; $&#123;SRC_FLIES&#125;)#target_link_libraries($&#123;CMAKE_PROJECT_NAME&#125; PRIVATE easyx)target_compile_features($&#123;CMAKE_PROJECT_NAME&#125; PRIVATE cxx_std_17)add_custom_command( target $&#123;CMAKE_PROJECT_NAME&#125; POST_BUILD COMMAND $&#123;CMAKE_PROJECT_NAME&#125; -E copy_directoy &quot;$&#123;PROJECT_SOURCE_DIR&#125;/assets&quot; &quot;$&lt;PROJECT_FILE_DIR:$&#123;CMAKE_PROJECT_NAME&#125;&gt;/assets&quot;) è¿è¡Œå¤šæ–‡ä»¶ 12345678cmake_minimum_required(VERSION 3.10) project(CALC)set(CMAKE_CXX_STANDARD 11) #ä½¿ç”¨c++ 11set(HOME /home/robin/Linux/calc)set(EXECUTABLE_OUTPUT_PATH $&#123;HOME&#125;/bin/)include_directories($&#123;PROJECT_SOURCE_DIR&#125;) #åŒ…å«å¤´æ–‡ä»¶ ä¸è¦ä¹Ÿå¯ä»¥ï¼ˆæœ‰æ—¶å‡ºé”™ï¼Ÿï¼‰file(GLOB SRC_LIST $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.cpp) #æ–‡ä»¶ä¸‹çš„æºæ–‡ä»¶/str/*.cppadd_executable(app $&#123;SRC_LIST&#125;) cmake linuxcrlf \\r\\n lf \\n &#x3D;&#x3D;???&#x3D;&#x3D; éœ€è¦æ’ä»¶ï¼šc&#x2F;c++ cmake cmaketools åœ¨anolisä¸­å®‰è£…vscode å¯ä»¥è€ƒè™‘ï¼Œä½†æ˜¯æ²¡å¿…è¦ å®‰è£…æ’ä»¶ ç‚¹è¿™ä¸ªæ²¡ç”¨ https://marketplace.visualstudio.com/vscodeä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶-linuxå¹³å° è·³è½¬åˆ°å¯¹åº”ç›®å½•ï¼Œä¼šæç¤ºå®‰è£…æˆåŠŸé‡å¯vscode ä¼šæç¤ºå·²ç»å®‰å¥½çš„æ’ä»¶ ###cmakeè¯­æ³• æ ¼å¼ æŒ‡ä»¤(å‚æ•°1 å‚æ•°2) å‚æ•°é—´ç”¨åˆ†å·æˆ–ç©ºæ ¼ æŒ‡ä»¤å’Œå¤§å°å†™æ— å…³ å‚æ•°å’Œå˜é‡æœ‰å…³ å˜é‡ä½¿ç”¨${} IFæ§åˆ¶è¯­å¥ä¸­ç›´æ¥ä½¿ç”¨ é‡è¦æŒ‡ä»¤å’Œå¸¸ç”¨å˜é‡ ä¸­æ‹¬å·ä¸ºå¯é€‰é¡¹ï¼Œå¯æ—  æŒ‡å®šCMakeçš„æœ€å°ç‰ˆæœ¬è¦æ±‚ 12CMakeæœ€å°ç‰ˆæœ¬è¦æ±‚ä¸º2.8.3cmake_minimum_required(VERSION 2.8.3) è¯­æ³•ï¼šcmake_minimum_required(VERSION versionNumber [FATAL_ERROR]) project - å®šä¹‰å·¥ç¨‹åç§°ï¼Œå¹¶å¯æŒ‡å®šå·¥ç¨‹æ”¯æŒçš„è¯­è¨€ 12æŒ‡å®šå·¥ç¨‹åä¸ºHELLOWORLDproject(HELLOWORLD) è¯­æ³•ï¼šproject(projectname [CXX] [C] [Java]) set - æ˜¾å¼çš„å®šä¹‰å˜é‡ 12å®šä¹‰SRCå˜é‡ï¼Œå…¶å€¼ä¸ºmain.cpp hello.cppset(SRC sayhello.cpp hello.cpp) è¯­æ³•ï¼šset(VAR [VALUE] [CACHE TYPE DOCSTRING [FORCE]]) include_directories - å‘å·¥ç¨‹æ·»åŠ å¤šä¸ªç‰¹å®šçš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„ â€”&gt;ç›¸å½“äºæŒ‡å®šg++ç¼–è¯‘å™¨çš„-Iå‚æ•° 12å°†/usr/include/myincludefolder å’Œ ./include æ·»åŠ åˆ°å¤´æ–‡ä»¶æœç´¢è·¯å¾„include_directories(/usr/include/myincludefolder ./include) è¯­æ³•ï¼šinclude_directories([AFTER|BEFORE] [SYSTEM] dir1 dir2 â€¦) link_directories - å‘å·¥ç¨‹æ·»åŠ å¤šä¸ªç‰¹å®šçš„åº“æ–‡ä»¶æœç´¢è·¯å¾„ â€”&gt;ç›¸å½“äºæŒ‡å®šg++ç¼–è¯‘å™¨çš„-Lå‚æ•° 12å°†/usr/lib/mylibfolder å’Œ ./lib æ·»åŠ åˆ°åº“æ–‡ä»¶æœç´¢è·¯å¾„link_directories(/usr/lib/mylibfolder ./lib) è¯­æ³•ï¼šlink_directories(dir1 dir2 â€¦) add_library - ç”Ÿæˆåº“æ–‡ä»¶ 12é€šè¿‡å˜é‡ SRC ç”Ÿæˆ libhello.so å…±äº«åº“add_library(hello SHARED $&#123;SRC&#125;) è¯­æ³•ï¼šadd_library(libname [SHARED|STATIC|MODULE] [EXCLUDE_FROM_ALL] source1 source2 â€¦ sourceN) SHAREDåŠ¨æ€åº“ STATICé™æ€åº“ add_compile_options - æ·»åŠ ç¼–è¯‘å‚æ•° 12æ·»åŠ ç¼–è¯‘å‚æ•° -Wall -std=c++11add_compile_options(-Wall -std=c++11 -O2) è¯­æ³•ï¼šadd_compile_options( add_executable - ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ 12ç¼–è¯‘main.cppç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶mainadd_executable(main main.cpp) è¯­æ³•ï¼šadd_executable(exename source1 source2 â€¦ sourceN) target_link_libraries - ä¸º target æ·»åŠ éœ€è¦é“¾æ¥çš„å…±äº«åº“ â€”&gt;ç›¸åŒäºæŒ‡å®šg++ç¼–è¯‘å™¨-lå‚æ•° 12å°†helloåŠ¨æ€åº“æ–‡ä»¶é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶maintarget_link_libraries(main hello) è¯­æ³•ï¼štarget_link_libraries(target library1library2â€¦) add_subdirectory - å‘å½“å‰å·¥ç¨‹æ·»åŠ å­˜æ”¾æºæ–‡ä»¶çš„å­ç›®å½•ï¼Œå¹¶å¯ä»¥æŒ‡å®šä¸­é—´äºŒè¿›åˆ¶å’Œç›®æ ‡äºŒè¿›åˆ¶å­˜æ”¾çš„ä½ç½® 12æ·»åŠ srcå­ç›®å½•ï¼Œsrcä¸­éœ€æœ‰ä¸€ä¸ªCMakeLists.txtadd_subdirectory(src) è¯­æ³•ï¼šadd_subdirectory(source_dir [binary_dir] [EXCLUDE_FROM_ALL]) aux_source_directory - å‘ç°ä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æºä»£ç æ–‡ä»¶å¹¶å°†åˆ—è¡¨å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸´æ—¶è¢«ç”¨æ¥è‡ªåŠ¨æ„å»ºæºæ–‡ä»¶åˆ—è¡¨ 1234å®šä¹‰SRCå˜é‡ï¼Œå…¶å€¼ä¸ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æºä»£ç æ–‡ä»¶aux_source_directory(. SRC)ç¼–è¯‘SRCå˜é‡æ‰€ä»£è¡¨çš„æºä»£ç æ–‡ä»¶ï¼Œç”Ÿæˆmainå¯æ‰§è¡Œæ–‡ä»¶add_executable(main $&#123;SRC&#125;) è¯­æ³•ï¼šaux_source_directory(dir VARIABLE) CMakeå¸¸ç”¨å˜é‡ CMAKE_C_FLAGS gccç¼–è¯‘é€‰é¡¹ CMAKE_CXX_FLAGS g++ç¼–è¯‘é€‰é¡¹ 12åœ¨CMAKE_CXX_FLAGSç¼–è¯‘é€‰é¡¹åè¿½åŠ -std=c++11set( CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;) CMAKE_BUILD_TYPE ç¼–è¯‘ç±»å‹(Debug, Release) 1234è®¾å®šç¼–è¯‘ç±»å‹ä¸ºdebugï¼Œè°ƒè¯•æ—¶éœ€è¦é€‰æ‹©debugset(CMAKE_BUILD_TYPE Debug) è®¾å®šç¼–è¯‘ç±»å‹ä¸ºreleaseï¼Œå‘å¸ƒæ—¶éœ€è¦é€‰æ‹©releaseset(CMAKE_BUILD_TYPE Release) CMAKE_BINARY_DIR PROJECT_BINARY_DIR __BINARY_DIR è¿™ä¸‰ä¸ªå˜é‡æŒ‡ä»£çš„å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚ å¦‚æœæ˜¯ in source buildï¼ŒæŒ‡çš„å°±æ˜¯å·¥ç¨‹é¡¶å±‚ç›®å½•ã€‚ å¦‚æœæ˜¯ out-of-source ç¼–è¯‘,æŒ‡çš„æ˜¯å·¥ç¨‹ç¼–è¯‘å‘ç”Ÿçš„ç›®å½•ã€‚ PROJECT_BINARY_DIR è·Ÿå…¶ä»–æŒ‡ä»¤ç¨æœ‰åŒºåˆ«ï¼Œä¸è¿‡ç°åœ¨ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä»–ä»¬æ˜¯ä¸€è‡´çš„ã€‚ CMAKE_SOURCE_DIR PROJECT_SOURCE_DIR__SOURCE_DIR è¿™ä¸‰ä¸ªå˜é‡æŒ‡ä»£çš„å†…å®¹æ˜¯ä¸€è‡´çš„,ä¸è®ºé‡‡ç”¨ä½•ç§ç¼–è¯‘æ–¹å¼,éƒ½æ˜¯å·¥ç¨‹é¡¶å±‚ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯åœ¨ in source buildæ—¶,ä»–è·Ÿ CMAKE_BINARY_DIR ç­‰å˜é‡ä¸€è‡´ã€‚ PROJECT_SOURCE_DIR è·Ÿå…¶ä»–æŒ‡ä»¤ç¨æœ‰åŒºåˆ«,ç°åœ¨,ä½ å¯ä»¥ç†è§£ä¸ºä»–ä»¬æ˜¯ä¸€è‡´çš„ã€‚ CMAKE_C_COMPILERï¼šæŒ‡å®šCç¼–è¯‘å™¨ CMAKE_CXX_COMPILERï¼šæŒ‡å®šC++ç¼–è¯‘å™¨ EXECUTABLE_OUTPUT_PATHï¼šå¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºçš„å­˜æ”¾è·¯å¾„ LIBRARY_OUTPUT_PATHï¼šåº“æ–‡ä»¶è¾“å‡ºçš„å­˜æ”¾è·¯å¾„ CMakeç¼–è¯‘å·¥ç¨‹CMakeç›®å½•ç»“æ„ï¼šé¡¹ç›®ä¸»ç›®å½•å­˜åœ¨ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶ ç¼–è¯‘æµç¨‹ æ‰‹åŠ¨ç¼–å†™ CmakeLists.txtã€‚ æ‰§è¡Œå‘½ä»¤ cmake PATHç”Ÿæˆ Makefile ( PATH æ˜¯é¡¶å±‚CMakeLists.txt æ‰€åœ¨çš„è·¯å¾„ )ã€‚ æ‰§è¡Œå‘½ä»¤make è¿›è¡Œç¼–è¯‘ã€‚ important tips . # è¡¨ç¤ºå½“å‰ç›®å½• ./ # è¡¨ç¤ºå½“å‰ç›®å½• .. # è¡¨ç¤ºä¸Šçº§ç›®å½• ../ # è¡¨ç¤ºä¸Šçº§ç›®å½• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#### ä¸¤ç§æ„å»ºæ–¹å¼CMakeListåœ¨å¤–é¢ å¤–éƒ¨æ„å»ºåªæ˜¯è¿›å…¥buildæ–‡ä»¶å¤¹æ‰§è¡Œcmakeä½¿ç”Ÿæˆçš„æ–‡ä»¶æ”¾åˆ°buildæ–‡ä»¶å¤¹ä¸­- **å†…éƒ¨æ„å»º(in-source build)**ï¼šä¸æ¨èä½¿ç”¨ å†…éƒ¨æ„å»ºä¼šåœ¨åŒçº§ç›®å½•ä¸‹äº§ç”Ÿä¸€å¤§å †ä¸­é—´æ–‡ä»¶ï¼Œè¿™äº›ä¸­é—´æ–‡ä»¶å¹¶ä¸æ˜¯æˆ‘ä»¬æœ€ç»ˆæ‰€éœ€è¦çš„ï¼Œå’Œå·¥ç¨‹æºæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ä¼šæ˜¾å¾—æ‚ä¹±æ— ç« ã€‚ ``` å†…éƒ¨æ„å»º åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œç¼–è¯‘æœ¬ç›®å½•çš„CMakeLists.txtï¼Œç”ŸæˆMakefileå’Œå…¶ä»–æ–‡ä»¶ cmake . æ‰§è¡Œmakeå‘½ä»¤ï¼Œç”Ÿæˆtarget make ``` - **å¤–éƒ¨æ„å»º(out-of-source build)**ï¼š==æ¨èä½¿ç”¨== å°†ç¼–è¯‘è¾“å‡ºæ–‡ä»¶å­˜æ”¾åˆ°å•ç‹¬çš„buildæ–‡ä»¶å¤¹ä¸­ ``` # å¤–éƒ¨æ„å»º 1. åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œåˆ›å»ºbuildæ–‡ä»¶å¤¹ mkdir build 2. è¿›å…¥åˆ°buildæ–‡ä»¶å¤¹ cd build 3. ç¼–è¯‘ä¸Šçº§ç›®å½•çš„CMakeLists.txtï¼Œç”ŸæˆMakefileå’Œå…¶ä»–æ–‡ä»¶ cmake .. 4. æ‰§è¡Œmakeå‘½ä»¤ï¼Œç”Ÿæˆtarget make ```####å•æ–‡ä»¶ç›´æ¥ä½¿ç”¨g++æŒ‡ä»¤æ›´æ–¹ä¾¿\\#include&lt;include/head.h&gt; cmakeå¯ä¸åŠ includeå®ä¾‹&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230913214219685-1740971902830-272.png&quot; alt=&quot;image-20230913214219685&quot; style=&quot;zoom: 33%;&quot; /&gt;&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230913214324629-1740971902830-274.png&quot; alt=&quot;image-20230913214324629&quot; style=&quot;zoom:33%;&quot; /&gt;ç›®å½•ç»“æ„&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230914093743079-1740971902830-276.png&quot; alt=&quot;image-20230914093743079&quot; style=&quot;zoom:50%;&quot; /&gt;g++ main.cpp scr/Gun.cpp scr/Solier.cpp -Iinclude [-o main] -wall -g -O2å¦‚æœå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶æ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹åˆ™ä¸éœ€è¦-Iinclude~~~cmakecmake_minimum_required(VERSION 3.0)project(Solidefire)set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -g -O2 -Wall&quot;) //è®¾ç½®g++ç¼–è¯‘é€‰é¡¹include_directories(include)add_executable(main_cmake main.cpp src/Gun.cpp src/Soldier.cpp) include_directories(include) å¯ä»¥å†™æˆ include_directories($&#123;CMAKE_SOURCE_DIR&#125;/include) å˜é‡CMAKE_SOURCE_DIRæ˜¯cmakelistsæ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ ä¿®æ”¹æºä»£ç ä¹‹ååªéœ€è¦makeä¸éœ€è¦cmake .. cmakeåªé’ˆå¯¹cmakelistsæ–‡ä»¶ **æ‰€æœ‰æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªç›®å½•é‡Œé¢** ![image-20230914091740384](./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230914091740384.png) aux_source_directory($&#123;PROJECT_SOURCE_DIR&#125; SRC) #PROJECT_SOURCE_DIR cmake .. æ‰§è¡Œcmakeåé¢è·Ÿéšçš„è·¯å¾„ æˆ–è€…file(GLOB SRC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.cpp) å† add_executable(main_cmake $&#123;SRC&#125;) **æ”¾åˆ°ä¸åŒç›®å½•é‡Œé¢** ç›®å½•ç»“æ„ &lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230914093743079-1740971902830-276.png&quot; alt=&quot;image-20230914093743079&quot; style=&quot;zoom:50%;&quot; /&gt; ä¸€æ ·æ˜¯è¿›å…¥buildæ–‡ä»¶å¤¹ cmake .. make ./mian_cmake 1234567891011121314151617cmake_minimum_required(VERSION 3.0)project(Solidefire)set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -g -O2 -Wall&quot;)include_directories(include)set(SRC main_cmake main.cpp src/Gun.cpp src/Soldier.cpp)#aux_source_directory($&#123;PROJECT_SOURCE_DIR&#125; SRC) #PROJECT_SOURCE_DIR cmake .. æ‰§è¡Œcmakeåé¢è·Ÿéšçš„è·¯å¾„file(GLOB SRC $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/src/*.cpp) #CMAKE_CURRENT_SOURCE_DIRå¯¹åº”makelistsæ‰€åœ¨è·¯å¾„include_directories(%&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include)#set(EXECUTABLE_OUTPUT_PATH /opt/demo/build) #æŒ‡å®šè¾“å‡ºè·¯å¾„set(CMAKE_CXX_STANDARD 11) #ä½¿ç”¨c++11æ ‡å‡† æˆ–cmake .. -DCMAKE_CXX_STANDARD=11add_executable(main_cmake $&#123;SRC&#125;) åç»­é“¾æ¥åº“ç­‰çœ‹BV14s4y1g7Zj?p è°ƒè¯•çœ‹BV1fy4y1b7TC?p é…ç½®jsonç­‰ è°ƒè¯• é€‰æ‹©creat a launch.json fileå†é€‰æ‹©c++(GDB) å¦‚æœæ²¡ç”¨åœ¨å³ä¸‹è§’é€‰æ‹©ç¬¬ä¸€ä¸ª .jsonæ–‡ä»¶å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536&#123; // Use IntelliSense to learn about possible attributes. // Hover to view descriptions of existing attributes. // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387 &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; &quot;name&quot;: &quot;(gdb) å¯åŠ¨&quot;, &quot;type&quot;: &quot;cppdbg&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/demo/build/main_cmake&quot;, //è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ &quot;args&quot;: [], &quot;stopAtEntry&quot;: false, &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;&quot;,//workspaceFolderé¡¶å±‚ç›®å½•ï¼Œjsonæ–‡ä»¶æ‰€åœ¨ &quot;environment&quot;: [], &quot;externalConsole&quot;: false, &quot;MIMode&quot;: &quot;gdb&quot;, &quot;setupCommands&quot;: [ &#123; &quot;description&quot;: &quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°&quot;, &quot;text&quot;: &quot;-enable-pretty-printing&quot;, &quot;ignoreFailures&quot;: true &#125;, // &#123; // &quot;description&quot;: &quot;å°†åæ±‡ç¼–é£æ ¼è®¾ç½®ä¸º Intel&quot;, // &quot;text&quot;: &quot;-gdb-set disassembly-flavor intel&quot;, // &quot;ignoreFailures&quot;: true // &#125; ], //&quot;preLaunchTask&quot;: &quot;build&quot;, //è°ƒè¯•ä¹‹å‰åšä¸€ä¸ªtaskå¼•å·æ˜¯åå­— &quot;miDebuggerPath&quot;: &quot;/usr/bin/gdb&quot; &#125; ]&#125; cmakelistä¸­åŠ set(CMAKE_BUILD_TYPE Debug) #ç”Ÿæˆå¯è°ƒè¯•æ–‡ä»¶ï¼Œé¿å…å†²çª f5è¿›å…¥è°ƒè¯• f10å•æ­¥ f11è¿›å…¥ f5ç»“æŸ æ‰“å¼€ &#x2F;&#x2F;â€œpreLaunchTaskâ€: â€œC&#x2F;C++:g++ build active fileâ€, &#x2F;&#x2F;è°ƒè¯•ä¹‹å‰åšä¸€ä¸ªtaskå¼•å·æ˜¯åå­— é…ç½®tasks.jsonæ–‡ä»¶ éšä¾¿ç‚¹å‡»ä¸€ä¸ª 123456789101112131415161718192021222324252627282930313233&#123; &quot;version&quot;: &quot;2.0.0&quot;, &quot;options&quot;: &#123; &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;/build&quot; //è¿›å…¥buildæ–‡ä»¶å¤¹ &#125;, &quot;tasks&quot;: [ //åŒ…å«äº†ä¸‰ä¸ªtask &#123; &quot;type&quot;: &quot;shell&quot;, &quot;label&quot;: &quot;cmake&quot;, //taskåå­— &quot;command&quot;: &quot;cmake&quot;, //å‘½ä»¤ &quot;args&quot;: [ //å‚æ•° &quot;..&quot; ] &#125;, &#123; &quot;label&quot;: &quot;make&quot;, &quot;group&quot;: &#123; &quot;kind&quot;: &quot;build&quot;, &quot;isDefault&quot;: true &#125;, &quot;command&quot;: &quot;make&quot;, //æ‰§è¡Œmakeï¼Œæ²¡ç”¨å‚æ•° &quot;args&quot;: [] &#125;, &#123; &quot;label&quot;: &quot;build&quot;, &quot;dependsOrder&quot;: &quot;sequence&quot;, &quot;dependsOn&quot;: [ //ä¾èµ–äºä¸Šé¢ä¸¤ä¸ªï¼Œåšcmake .. make ä¸¤ä»¶äº‹ &quot;cmake&quot;, &quot;make&quot; ] &#125; ],&#125; è¿™æ ·ç›´æ¥f5å°±å¯ä»¥è°ƒè¯•äº†è¿è¡Œäº†ï¼Œä¸ç”¨å†cmakeå’Œmakeäº† é‡åˆ°é—®é¢˜yum install æ—¶é‡åˆ°é—®é¢˜ ###failed to set locale defaulting to C.UTF-8 æˆ‘æ˜¯ç½‘ç»œé—®é¢˜ï¼Œä¸‹é¢éƒ½æ²¡ç”¨çš„æ„æ€ å…ˆping www.baidu.com çœ‹èƒ½ä¸èƒ½é€š ä¸èƒ½ä¸€èˆ¬æ˜¯ç½‘ç»œé—®é¢˜ï¼ˆæˆ‘æ˜¯æ²¡æœ‰è®¾ç½®dnsï¼‰ locale -aæŸ¥çœ‹å·²ç»å®‰è£…çš„è¯­è¨€åŒ… é•œåƒç½‘ç«™ä¸‹è½½rpmåŒ… æŒ‡ä»¤å®‰è£… sudo yum install epel-release sudo yum install langpacks-en æ— æ³•ä½¿ç”¨æŒ‡ä»¤é•œåƒç½‘ç«™ é•œåƒç½‘ç«™ï¼šWelcome to the RPM repository on fr2.rpmfind.net æœç´¢epel-release langpacks-enæ‰¾å¯¹åº”ç‰ˆæœ¬è¿›è¡Œå®‰è£…rpmåŒ… rpm -i example.rpm -iè¡¨ç¤ºå®‰è£…ï¼Œexample.rpmæ˜¯è¦å®‰è£…çš„RPMåŒ…çš„åç§°ã€‚ å¯è§†åŒ–æ˜¾ç¤ºä½¿ç”¨-v ä½¿ç”¨-hé€‰é¡¹æ¥æ˜¾ç¤ºå®‰è£…è¿›åº¦ã€‚ rpm -ivh example.rpm é•œåƒç½‘ç«™ï¼šWelcome to the RPM repository on fr2.rpmfind.net æœç´¢åå­—å®‰è£…rpmåŒ… é‡å‘½ååä½¿ç”¨xftpä¼ è¾“åˆ°&#x2F;home&#x2F;tutu è¿›å…¥ç›®å½• åˆ†åˆ«rpm -ivh epel-release.rpm ç„¶å ç”Ÿæˆè¯­è¨€ç¯å¢ƒ å…ˆinstallå†sudo localedef -v -c -i en_US -f UTF-8 en_US.UTF-8 sudo nano &#x2F;etc&#x2F;default&#x2F;locale LANG&#x3D;en_US.UTF-8 LC_ALL&#x3D;en_US.UTF-8 sudo yum install langpacks-en sudo localedef -v -c -i en_US -f UTF-8 en_US.UTF-8 ç”Ÿæˆè¯­è¨€ç¯å¢ƒ å®‰è£…åº“æ–‡ä»¶##å®‰è£…pthreadåº“ yum install -y glibc-devel rpm -q glibc-devel æ£€æŸ¥ ç¼–è¯‘ g++ communicationV2.0.cpp -lpthread å®‰è£…Ubuntuå®˜ç½‘ https://cn.ubuntu.com/desktop æˆ‘ä¸‹è½½çš„æ˜¯ubuntu-24.04-desktop-amd64.iso å®Œæˆ ç¼–è¾‘è™šæ‹Ÿæœºè®¾ç½® è¿™é‡Œé€‰æ‹©è¿™ä¸ªä¼šä½¿ç”¨ä¹‹å‰é…ç½®çš„ç½‘ç»œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªipï¼Œåé¢ä¸ç”¨é…ç½®äº† ç¡®å®š-å¼€å¯è™šæ‹Ÿæœº ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘å›¾å½¢åŒ–ç•Œé¢è¿›å»åœ¨å®‰è£…çš„ä½ç½®ä¸€ç›´å¡ä½ åé¢ç›´æ¥å®‰è£…éå›¾å½¢åŒ–çš„ å‰é¢æ­¥éª¤ä¸€æ ·ï¼Œåé¢å®‰å¥½ä¹‹åè¦é‡æ–°å¯åŠ¨ä¸€æ¬¡ï¼Œå¯åŠ¨çš„æ—¶å€™æŠŠé•œåƒæ–‡ä»¶æ”¹ä¸ºè‡ªåŠ¨æ£€æµ‹ï¼Œæˆ‘æ”¹äº†ä»¥åä¸çŸ¥é“æ˜¯æˆ‘å¡è¿˜æ˜¯ç­‰çš„æ—¶é—´ä¸å¤Ÿï¼Œåé¢æˆ‘åˆæŠŠé•œåƒå®‰ä¸Šä¹‹åæˆ–è€…å–æ¶ˆé‡å¤å¼€äº†å¥½å‡ æ¬¡ï¼Œå»åƒä¸ªé¥­å›æ¥å°±è¿›å…¥å‘½åç•Œé¢äº†ï¼Œæ„å¤–ä¹‹å–œ é•œåƒæ–‡ä»¶ä¸‹è½½åœ°å€ï¼šhttps://mirrors.aliyun.com/ubuntu-releases/ è¿›å…¥ä¹‹ååªæœ‰ä¸€ä¸ªè‡ªå·±å»ºçš„ç”¨æˆ·ï¼Œæ²¡æœ‰rootç”¨æˆ· å¯¼è‡´è¾“å…¥å‘½ä»¤å¾ˆå¤šéƒ½è¦ +sudo sudo passwd root è®¾ç½®rootå¯†ç  su - root åˆ‡æ¢åˆ°root #é…ç½®é™æ€å±€åŸŸç½‘ è™šæ‹Ÿæœºé»˜è®¤æ˜¯NATæ¨¡å¼ æ¯ä¸ªè™šæ‹Ÿæœºä¸€ä¸ªDHCPéƒ½æ˜¯10.0.2.2 ä¸»æœº10.0.2.15 æ¯ä¸ªè™šæ‹Ÿæœºéƒ½ä¸€æ · æ‰€ä»¥è™šæ‹Ÿæœºä¸èƒ½äº’é€š è™šæ‹Ÿæœºå¯ä»¥pingä¸»æœºNATçš„ç§æœ‰åœ°å€ï¼Œä¸»æœºä¸èƒ½è®¿é—®è™šæ‹Ÿæœº åªå‡ºä¸è¿› NATç½‘ç»œ æ•™ç¨‹ï¼šhttps://cnxiaobai.com/articles/2021/04/21/1619011285612.html ä¸€å¼€å§‹ip aæŸ¥çœ‹ä¸åˆ°ipåœ°å€ï¼Œéœ€è¦ç¼–è¾‘ç½‘å¡ä¿¡æ¯ é¦–å…ˆè¿›å…¥rootè´¦æˆ· æ™®é€šè´¦æˆ·å°è¯•è¿‡ä¸è¡Œ cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F; ls æ˜¾ç¤ºç½‘å¡åç§° ifcfg-ens160 vi ifcfg-ens160 è¿›å…¥ç¼–è¾‘æ¨¡å¼&#x2F;vi æŒ‰ i è¿›å…¥ç¼–è¾‘ TYPE=Ethernet #ç½‘ç»œç±»å‹:Ethernetä»¥å¤ªç½‘ PROXY_METHOD=none #ä»£ç†æ–¹å¼ï¼šå…³é—­çŠ¶æ€ BROWSER_ONLY=no # åªæ˜¯æµè§ˆå™¨ï¼šå¦ BOOTPROTO=static #å¼•å¯¼åè®®ï¼šstaticé™æ€ã€dhcpåŠ¨æ€è·å–ã€noneä¸æŒ‡å®š æ”¹ DEFROUTE=yes #å¯åŠ¨é»˜è®¤è·¯ç”± IPV4_FAILURE_FATAL=no #ä¸å¯ç”¨IPV4é”™è¯¯æ£€æµ‹åŠŸèƒ½ IPV6INIT=yes #å¯ç”¨IPV6åè®® IPV6_AUTOCONF=yes #è‡ªåŠ¨é…ç½®IPV6åœ°å€ IPV6_DEFROUTE=yes #å¯ç”¨IPV6é»˜è®¤è·¯ç”± IPV6_FAILURE_FATAL=no #ä¸å¯ç”¨IPV6é”™è¯¯æ£€æµ‹åŠŸèƒ½ NAME=ens160 # ç½‘å¡è®¾å¤‡çš„åˆ«å UUID=985f89ca-ada3-4dfd-9dd2-c97f680a8ed1 #ç½‘å¡è®¾å¤‡çš„UUID,é€šç”¨å”¯ä¸€è¯†åˆ«ç  DEVICE=ens160 # ç½‘å¡çš„è®¾å¤‡åç§° ONBOOT=yes #å¼€æœºè‡ªåŠ¨å¯åŠ¨ç½‘å¡ æ”¹ //åŠ  IPADDR=192.168.6.208 248.3 NETMASK=255.255.255.0 GATEWAY=192.168.6.2 248.2 PREFIX=24 DNS1=114.114.114.114 DNS2=8.8.8.8 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657586. ç¼–å†™å®ŒæˆåæŒ‰escè¿›å…¥é€‰æ‹©æ¨¡å¼7. : è¿›å…¥åº•çº¿æ¨¡å¼ è¾“å…¥==wä¿å­˜ qé€€å‡º== ååŠ ï¼å¼ºåˆ¶æ‰§è¡Œ8. nmcli c reload # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ nmcli c up ens160 # é‡å¯ens33ç½‘å¡ service NetworkManager restart é‡ç½®ç½‘å¡ï¼Ÿï¼Ÿ9. é‡æ–°å¯åŠ¨å®¢æˆ·æœºsudo nmtui è¿›å…¥ç½‘ç»œè®¾ç½®&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20240831165217770-1740971902830-313.png&quot; alt=&quot;image-20240831165217770&quot; style=&quot;zoom:50%;&quot; /&gt;ä¸ºå•¥ç½‘å…³è®¾ç½®æˆ.2å‘¢### è™šæ‹Ÿæœºç½‘ç»œè®¾ç½®ç¼–è¾‘-è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨-æ›´æ”¹è®¾ç½®-VMnet8&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230829172834973-1740971902830-315.png&quot; alt=&quot;image-20230829172834973&quot; style=&quot;zoom: 67%;&quot; /&gt;NATè®¾ç½®&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230829172924050-1740971902830-317.png&quot; alt=&quot;image-20230829172924050&quot; style=&quot;zoom:50%;&quot; /&gt;è§„åˆ™192.168ä¸å˜ 6éšä¾¿ï¼ˆ224ä»¥ä¸‹ï¼‰ DHCPè®¾ç½®&lt;img src=&quot;./images/Linuxç³»ç»Ÿå®‰è£….assets/image-20230829173012318-1740971902830-319.png&quot; alt=&quot;image-20230829173012318&quot; style=&quot;zoom:50%;&quot; /&gt;ipè¦åœ¨è¿™ä¸ªèŒƒå›´é‡Œé¢ping www.baidu.com pingä¸é€šä»£è¡¨æœ‰é—®é¢˜ ctrl+cç»“æŸping#SSH###windowsssh tutu@192.168.6.208linuxï¼šsystemctl status sshd æŸ¥çœ‹æ˜¯å¦å¯åŠ¨sshsystemctl start sshd å¯ç”¨###vscodeé…ç½®configæ–‡ä»¶ Host 192.168.6.208 //ä¸»æœºip HostName 192.168.6.208 User tutu 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162ssh tutu@192.168.6.208 tutussh root@192.168.6.208 123é¿å…æ¯æ¬¡è¿æ¥éœ€è¦è¾“å…¥å¯†ç cmd:ssh-keygen -t rsa -b 4096 å››ä¸ªå›è½¦ç”Ÿæˆå¯†é’¥ ==ï¼Ÿï¼Ÿï¼Ÿ==##å…å¯†ç™»å½•* code /etc/ssh/sshd_config æ—¥å¿—ï¼šcode /var/log/secure* sudo systemctl restart sshd* windowsä¸Šè¿è¡Œssh-keygen ä¸‰ä¸ªå›è½¦çœ‹åˆ°ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥çš„ä½ç½®C:\\Users\\Tutu\\.ssh\\id_rsa* ä¿®æ”¹configé…ç½®æ–‡ä»¶Host 192.168.6.208 HostName 192.168.6.208 User root IdentityFile C:\\Users\\Tutu\\.ssh\\id_rsa* å°†id_rsa.pubå¤åˆ¶åˆ°æœåŠ¡å™¨çš„~/.sshæ–‡ä»¶å¤¹ä¸­* ä¿®æ”¹æ–‡ä»¶/etc/ssh/ssh_configPasswordAuthentication noPubkeyAuthentication yessystemctl restart sshd* å¯èƒ½éœ€è¦æƒé™chmod 700 ~/.sshchmod 600 ~/.ssh/authorized_keys## sshæ…¢ä¿®æ”¹/etc/ssh/sshd_configæ–‡ä»¶UseDNS noGSSAPIAuthentication noåˆ›å»ºå®ä¾‹å¹¶åˆå§‹åŒ– Open StartAccept åˆ›å»ºTcpClientPtr HandleAccept StartRead407 è¡Œ pClient-&gt;GetBuffer(0); max,0 HandleRead RecvData GetMessage TcpClientPtræ„é€  m_maxBufSize &#x3D; 8 * 1024 * 1024; m_offset &#x3D; 0;&#x2F;&#x2F;æ€»æ¶ˆæ¯é•¿åº¦ m_parseOffset &#x3D; 0;&#x2F;&#x2F;ä¸Šä¸€æ¡æ¶ˆæ¯çš„æœ«å°¾ m_pBuf &#x3D; NULL;&#x2F;&#x2F;å †ä¸Šåˆ†é…8MBå†…å­˜ï¼Œm_pBufæŒ‡å‘ç¬¬ä¸€ä¸ªå­—èŠ‚ m_state &#x3D; 1; m_bReadClose &#x3D; false; m_nSendHeartBeatCount &#x3D; 10; m_nRecvHeartBeatCount &#x3D; 0; Init(m_maxBufSize); m_prp2dbspcPkt.pktLen &#x3D; sizeof(PRP_DBSPC_RULE_PKT); m_prp2dbspcPkt.flag &#x3D; DBAGENT_FLAG; m_prp2dbspcPkt.pktType &#x3D; EU_AGENT_PKT_TYPE_RULE; m_pBuf &#x3D; new uint8_t[m_maxBufSize];&#x2F;&#x2F;maxGetBuffer(0)&#x2F;&#x2F;è·å¾—ç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªåœ°å€ uint8_t* pBuf &#x3D; m_pBuf + m_offset;&#x2F;&#x2F;+0 bufSize &#x3D; m_maxBufSize - m_offset;&#x2F;&#x2F;-0 if max&lt;&#x3D;0 return null return pbuf è¿”å›åœ°å€RecvData(readSize) m_offset+&#x3D;readSizeHaveMessage msgLen&#x3D;*m_pBuf&#x2F;&#x2F; if(m_offset &lt; msgLen) return fasle m_parseOffset&#x3D;0GetMessageï¼ˆ0ï¼‰ pBuf&#x3D; msgSize æ•°æ®éƒ¨åˆ†é•¿åº¦ç»è¿‡å‡å»å¤´éƒ¨æ•°æ®4 123# é…ç½®é™æ€ç½‘ç»œ cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;vi ifcfg-ens33 (æ›¿æ¢æˆå¯¹åº”ç½‘å¡åç§°) 1 TYPE&#x3D;EthernetPROXY_METHOD&#x3D;noneBROWSER_ONLY&#x3D;noBOOTPROTO&#x3D;static &#x2F;&#x2F;æ”¹DEFROUTE&#x3D;yesIPV4_FAILURE_FATAL&#x3D;noIPV6INIT&#x3D;yesIPV6_AUTOCONF&#x3D;yesIPV6_DEFROUTE&#x3D;yesIPV6_FAILURE_FATAL&#x3D;noIPV6_ADDR_GEN_MODE&#x3D;stable-privacyNAME&#x3D;ens33UUID&#x3D;1647aabe-3d39-4811-b698-b958ac9169f4DEVICE&#x3D;ens33ONBOOT&#x3D;yes &#x2F;&#x2F;ä»è¿™å¾€ä¸‹ï¼Œæ”¹ï¼Œipæ ¹æ®è‡ªå·±é…ç½®çš„VMnet8æ›´æ”¹IPADDR&#x3D;192.168.248.3NETMASK&#x3D;255.255.255.0GATEWAY&#x3D;192.168.248.2PREFIX&#x3D;24DNS1&#x3D;114.114.114.114DNS2&#x3D;8.8.8.8 1 nmcli c reloadnmcli c up ens160 1233. é…ç½®yumæº å¤‡ä»½cp &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo.backupvi &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo 1 CentOS-Base.repoThe mirror system uses the connecting IP address of the client and theupdate status of each mirror to pick mirrors that are updated to andgeographically close to the client. You should use this for CentOS updatesunless you are manually picking other mirrors.If the mirrorlist&#x3D; does not work for you, as a fall back you can try theremarked out baseurl&#x3D; line instead.[os]name&#x3D;Qcloud centos os - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/os/$basearch/enabled&#x3D;1gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 [updates]name&#x3D;Qcloud centos updates - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/updates/$basearch/enabled&#x3D;1gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 [centosplus]name&#x3D;Qcloud centosplus - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/centosplus/$basearch/enabled&#x3D;0gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 [cr]name&#x3D;Qcloud centos cr - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/cr/$basearch/enabled&#x3D;0gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 [extras]name&#x3D;Qcloud centos extras - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/extras/$basearch/enabled&#x3D;1gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 [fasttrack]name&#x3D;Qcloud centos fasttrack - $basearchbaseurl&#x3D;http://mirrors.cloud.tencent.com/centos/$releasever/fasttrack/$basearch/enabled&#x3D;0gpgcheck&#x3D;1gpgkey&#x3D;http://mirrors.cloud.tencent.com/centos/RPM-GPG-KEY-CentOS-7 1 yum clean allyum makecache","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[]},{"title":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"source/Linux/Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.386Z","comments":true,"path":"2025/03/02/source/Linux/Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/","permalink":"http://example.com/2025/03/02/source/Linux/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/","excerpt":"","text":"æ·±å…¥è§£æé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹Linuxç½‘ç»œç¼–ç¨‹åŸºç¡€API socketåœ°å€APIã€‚socketæœ€å¼€å§‹çš„å«ä¹‰æ˜¯ä¸€ä¸ªIPåœ°å€å’Œç«¯å£å¯¹ï¼ˆipï¼Œportï¼‰ã€‚å®ƒå”¯ä¸€åœ°è¡¨ç¤ºäº†ä½¿ç”¨TCPé€šä¿¡çš„ä¸€ç«¯ã€‚æœ¬ä¹¦ç§°å…¶ä¸ºsocketåœ°å€ã€‚ socketåŸºç¡€APIã€‚socketçš„ä¸»è¦APIéƒ½å®šä¹‰åœ¨sys&#x2F;socket.hå¤´æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬åˆ›å»ºsocketã€å‘½åsocketã€ç›‘å¬socketã€æ¥å—è¿æ¥ã€å‘èµ·è¿æ¥ã€è¯»å†™æ•°æ®ã€è·å–åœ°å€ä¿¡æ¯ã€æ£€æµ‹å¸¦å¤–æ ‡è®°ï¼Œä»¥åŠè¯»å–å’Œè®¾ç½®socketé€‰é¡¹ã€‚ ç½‘ç»œä¿¡æ¯APIã€‚Linuxæä¾›äº†ä¸€å¥—ç½‘ç»œä¿¡æ¯APIï¼Œä»¥å®ç°ä¸»æœºåå’ŒIPåœ°å€ä¹‹é—´çš„è½¬æ¢ï¼Œä»¥åŠæœåŠ¡åç§°å’Œç«¯å£å·ä¹‹é—´çš„è½¬æ¢ã€‚è¿™äº›APIéƒ½å®šä¹‰åœ¨netdb.hå¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå…¶ä¸­å‡ ä¸ªä¸»è¦çš„å‡½æ•°ã€‚ ###socketåœ°å€API å…ˆè¦ç†è§£ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºç°ä»£CPUçš„ç´¯åŠ å™¨ä¸€æ¬¡éƒ½èƒ½è£…è½½ï¼ˆè‡³å°‘ï¼‰4å­—èŠ‚ï¼ˆè¿™é‡Œè€ƒè™‘32ä½æœºï¼‰ï¼Œå³ä¸€ä¸ªæ•´æ•°ã€‚é‚£ä¹ˆè¿™4å­—èŠ‚åœ¨å†…å­˜ä¸­æ’åˆ—çš„é¡ºåºå°†å½±å“å®ƒè¢«ç´¯åŠ å™¨è£…è½½æˆçš„æ•´æ•°çš„å€¼ã€‚è¿™å°±æ˜¯å­—èŠ‚åºé—®é¢˜ã€‚å­—èŠ‚åºåˆ†ä¸ºå¤§ç«¯å­—èŠ‚åºï¼ˆbig endianï¼‰å’Œå°ç«¯å­—èŠ‚åºï¼ˆlittle endianï¼‰ã€‚ å¤§ç«¯å­—èŠ‚åºæ˜¯æŒ‡ä¸€ä¸ªæ•´æ•°çš„é«˜ä½å­—èŠ‚ï¼ˆ23ï½31 bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ï¼Œä½ä½å­—èŠ‚ï¼ˆ0ï½7 bitï¼‰å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ã€‚å°ç«¯å­—èŠ‚åºåˆ™æ˜¯æŒ‡æ•´æ•°çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼Œè€Œä½ä½å­—èŠ‚åˆ™å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ã€‚ åˆ¤æ–­æœºå™¨å­—èŠ‚åº 1234567891011121314151617181920212223#include&lt;stdio.h&gt;void byteorder()&#123; union&#123; short value; //shortå ä¸¤å­—èŠ‚ char union_bytes[sizeof(short)]; &#125;test; test.value=0x0102; //01ä¸€ä¸ªå­—èŠ‚ 02ä¸€ä¸ªå­—èŠ‚ //unionçš„æˆå‘˜å…±äº«ä¸€ä¸ªå†…å­˜ï¼Œè™½ç„¶æ˜¯ç»™short valueèµ‹å€¼çš„ï¼Œä¸¤ä¸ªæˆå‘˜çš„å†…å­˜éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç”¨shortç±»å‹è§£é‡Šæ˜¯åå…­è¿›åˆ¶çš„0102ï¼Œç”¨charæ•°ç»„è§£é‡Šæ—¶ï¼Œæ°å¥½æ˜¯ä¸¤ä¸ªæˆå‘˜ï¼Œæ¯ä¸ª1å­—èŠ‚ï¼Œéƒ½æ˜¯åè¿›åˆ¶çš„ç¬¬ä¸€ä¸ªæ˜¯01ç¬¬äºŒä¸ªæ˜¯02 if((test.union_bytes[0]==1)&amp;&amp;(test.union_bytes[1]==2))&#123; printf(&quot;big endian\\n&quot;); &#125; else if((test.union_bytes[0]==2)&amp;&amp;(test.union_bytes[1]==1)) &#123; printf(&quot;little endian\\n&quot;); &#125; else&#123; printf(&quot;unknown...\\n&quot;); &#125;&#125;int main()&#123; byteorder(); return 0;&#125; æˆ‘åœ¨linuxä¸Šè¿è¡Œæ˜¯little endian æˆ‘ä»¬å¯ä»¥è°ƒè¯•æŸ¥çœ‹å†…å­˜çš„è¡¨ç¤ºï¼Œä¹Ÿæ˜¯ç¬¦åˆé€»è¾‘çš„ &#x3D;&#x3D;å°ç«¯å­—èŠ‚åºåˆè¢«ç§°ä¸ºä¸»æœºå­—èŠ‚åº&#x3D;&#x3D; ç°ä»£PCå¤§å¤šé‡‡ç”¨å°ç«¯å­—èŠ‚åº &#x3D;&#x3D;å¤§ç«¯å­—èŠ‚åºä¹Ÿç§°ä¸ºç½‘ç»œå­—èŠ‚åº&#x3D;&#x3D; å‘é€ç«¯æ€»æ˜¯æŠŠè¦å‘é€çš„æ•°æ®è½¬åŒ–æˆå¤§ç«¯å­—èŠ‚åºæ•°æ®åå†å‘é€ï¼Œè€Œæ¥æ”¶ç«¯çŸ¥é“å¯¹æ–¹ä¼ é€è¿‡æ¥çš„æ•°æ®æ€»æ˜¯é‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥æ¥æ”¶ç«¯å¯ä»¥æ ¹æ®è‡ªèº«é‡‡ç”¨çš„å­—èŠ‚åºå†³å®šæ˜¯å¦å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆå°ç«¯æœºè½¬æ¢ï¼Œå¤§ç«¯æœºä¸è½¬æ¢ï¼‰ å³ä½¿æ˜¯åŒä¸€å°æœºå™¨ä¸Šçš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”±Cè¯­è¨€ç¼–å†™ï¼Œå¦ä¸€ä¸ªç”±JAVAç¼–å†™ï¼‰é€šä¿¡ï¼Œä¹Ÿè¦è€ƒè™‘å­—èŠ‚åºçš„é—®é¢˜ï¼ˆJAVAè™šæ‹Ÿæœºé‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼‰ã€‚ Linuxæä¾›äº†å¦‚ä¸‹4ä¸ªå‡½æ•°æ¥å®Œæˆä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢ 12345#includeï¼œnetinet/in.hï¼unsigned long int htonl(unsigned long int hostlong); //æ— ç¬¦å·é•¿æ•´å‹ ä¸»æœº-&gt;ç½‘ç»œunsigned short int htons(unsigned short int hostshort);//æ— ç¬¦å·çŸ­æ•´å‹unsigned long int ntohl(unsigned long int netlong); //ç½‘ç»œ-&gt;ä¸»æœºunsigned short int ntohs(unsigned short int netshort); é•¿æ•´å‹ï¼ˆ32 bitï¼‰å¸¸ç”¨æ¥è½¬æ¢IPåœ°å€ï¼ŒçŸ­æ•´å‹(16ä½)ç”¨æ¥è½¬æ¢ç«¯å£å· è¿™é‡Œçš„ç±»å‹éƒ½æ˜¯å¯ä»¥æ¢çš„ï¼Œæ¯”å¦‚æˆ‘è½¬æ¢ä¸€ä¸ªshortç±»å‹ä¸ºå¤§ç«¯åº 1234567891011#include&lt;netinet/in.h&gt;#include &lt;stdio.h&gt; #include &lt;iostream&gt;using namespace std;int main() &#123; unsigned short int host_short = 0x1234; unsigned short int net_short = htons(host_short); printf(&quot;Network byte order short: 0x%X\\n&quot;, net_short); //3412 cout &lt;&lt; net_short &lt;&lt; endl; //13330çš„åå…­è¿›åˆ¶3421 return 0;&#125; é€šç”¨socketåœ°å€socketç½‘ç»œç¼–ç¨‹æ¥å£ä¸­è¡¨ç¤ºsocketåœ°å€çš„æ˜¯ç»“æ„ä½“sockaddrï¼Œå…¶å®šä¹‰å¦‚ä¸‹ 12345#includeï¼œbits/socket.hï¼struct sockaddr&#123; sa_family_t sa_family; //åœ°å€æ—ç±»å‹ char sa_data[14];&#125; åœ°å€æ—ç±»å‹é€šå¸¸ä¸åè®®æ—ç±»å‹å¯¹åº” å¸¸è§çš„åè®®æ—ï¼ˆprotocol familyï¼Œä¹Ÿç§°domain) å®PF_*å’ŒAF_*éƒ½å®šä¹‰åœ¨bits&#x2F;socket.hå¤´æ–‡ä»¶ä¸­ï¼Œä¸”åè€…ä¸å‰è€…æœ‰å®Œå…¨ç›¸åŒçš„å€¼ï¼Œæ‰€ä»¥äºŒè€…é€šå¸¸æ··ç”¨ã€‚ sa_dataæˆå‘˜ç”¨äºå­˜æ”¾socketåœ°å€å€¼ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„åè®®æ—çš„åœ°å€å€¼å…·æœ‰ä¸åŒçš„å«ä¹‰å’Œé•¿åº¦ å¯è§14çš„å¤§å°å®Œå…¨ä¸å¤Ÿï¼Œlinuxå®šä¹‰äº†æ–°çš„ç»“æ„ 123456#includeï¼œbits/socket.hï¼struct sockaddr_storage&#123; sa_family_t sa_family; unsigned long int__ss_align; char__ss_padding[128-sizeof(__ss_align)];&#125; __ss_alignæˆå‘˜ä½¿å†…å­˜å¯¹é½ ä¸“ç”¨socketåœ°å€ä¸Šé¢è¿™ä¸¤ä¸ªé€šç”¨socketåœ°å€ç»“æ„ä½“æ˜¾ç„¶å¾ˆä¸å¥½ç”¨ï¼Œæ¯”å¦‚è®¾ç½®ä¸è·å–IPåœ°å€å’Œç«¯å£å·å°±éœ€è¦æ‰§è¡Œçƒ¦ççš„ä½æ“ä½œã€‚æ‰€ä»¥Linuxä¸ºå„ä¸ªåè®®æ—æä¾›äº†ä¸“é—¨çš„socketåœ°å€ç»“æ„ä½“ UNIXæœ¬åœ°åŸŸåè®®æ— 12345#includeï¼œsys/un.hï¼struct sockaddr_un&#123; sa_family_t sin_family;/*åœ°å€æ—ï¼šAF_UNIX*/ char sun_path[108];/*æ–‡ä»¶è·¯å¾„å*/&#125;; TCP&#x2F;IPåè®®æ—æœ‰sockaddr_inå’Œsockaddr_in6ä¸¤ä¸ªä¸“ç”¨socketåœ°å€ç»“æ„ä½“ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºIPv4å’ŒIPv6ï¼š 12345678910111213141516171819struct sockaddr_in&#123; sa_family_t sin_family;/*åœ°å€æ—ï¼šAF_INET*/ u_int16_t sin_port;/*ç«¯å£å·ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/ struct in_addr sin_addr;/*IPv4åœ°å€ç»“æ„ä½“ï¼Œè§ä¸‹é¢*/&#125;;struct in_addr&#123; u_int32_t s_addr;/*IPv4åœ°å€ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/&#125;;struct sockaddr_in6&#123; sa_family_t sin6_family;/*åœ°å€æ—ï¼šAF_INET6*/ u_int16_t sin6_port;/*ç«¯å£å·ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/ u_int32_t sin6_flowinfo;/*æµä¿¡æ¯ï¼Œåº”è®¾ç½®ä¸º0*/ struct in6_addr sin6_addr;/*IPv6åœ°å€ç»“æ„ä½“ï¼Œè§ä¸‹é¢*/ u_int32_t sin6_scope_id;/*scope IDï¼Œå°šå¤„äºå®éªŒé˜¶æ®µ*/&#125;;struct in6_addr&#123; unsigned char sa_addr[16];/*IPv6åœ°å€ï¼Œè¦ç”¨ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º*/&#125;; æ‰€æœ‰ä¸“ç”¨socketåœ°å€ï¼ˆä»¥åŠsockaddr_storageï¼‰ç±»å‹çš„å˜é‡åœ¨å®é™…ä½¿ç”¨æ—¶éƒ½éœ€è¦è½¬åŒ–ä¸ºé€šç”¨socketåœ°å€ç±»å‹sockaddrï¼ˆå¼ºåˆ¶è½¬æ¢å³å¯ï¼‰ï¼Œå› ä¸ºæ‰€æœ‰socketç¼–ç¨‹æ¥å£ä½¿ç”¨çš„åœ°å€å‚æ•°çš„ç±»å‹éƒ½æ˜¯sockaddrã€‚ IPåœ°å€è½¬æ¢å‡½æ•°é€šå¸¸ï¼Œäººä»¬ä¹ æƒ¯ç”¨å¯è¯»æ€§å¥½çš„å­—ç¬¦ä¸²æ¥è¡¨ç¤ºIPåœ°å€ï¼Œæ¯”å¦‚ç”¨ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºIPv4åœ°å€ï¼Œä»¥åŠç”¨åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºIPv6åœ°å€ã€‚ ç¼–ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å…ˆæŠŠå®ƒä»¬è½¬åŒ–ä¸ºæ•´æ•°ï¼ˆäºŒè¿›åˆ¶æ•°ï¼‰æ–¹èƒ½ä½¿ç”¨ã€‚ è®°å½•æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬è¦æŠŠæ•´æ•°è¡¨ç¤ºçš„IPåœ°å€è½¬åŒ–ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²ã€‚ ä¸‹é¢3ä¸ªå‡½æ•°å¯ç”¨äºç”¨ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„IPv4åœ°å€å’Œç”¨ç½‘ç»œå­—èŠ‚åºæ•´æ•°è¡¨ç¤ºçš„IPv4åœ°å€ä¹‹é—´çš„è½¬æ¢ï¼š 1234#includeï¼œarpa/inet.hï¼in_addr_t inet_addr(const char*strptr);int inet_aton(const char*cp,struct in_addr*inp);char*inet_ntoa(struct in_addr in); inet_addr IPv4åœ°å€è½¬åŒ–ä¸ºç”¨ç½‘ç»œå­—èŠ‚åºå®ƒ å¤±è´¥æ—¶è¿”å›INADDR_NONEã€‚ inet_aton IPv4åœ°å€è½¬åŒ–ä¸ºç”¨ç½‘ç»œå­—èŠ‚åºï¼Œä½†æ˜¯å°†è½¬åŒ–ç»“æœå­˜å‚¨äºå‚æ•°inpæŒ‡å‘çš„åœ°å€ç»“æ„ä¸­ã€‚å®ƒæˆåŠŸæ—¶è¿”å›1ï¼Œå¤±è´¥åˆ™è¿”å›0ã€‚ inet_ntoa ç½‘ç»œå­—èŠ‚åºè½¬åŒ–ä¸ºç”¨ç‚¹åˆ†åè¿›åˆ¶ ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å‡½æ•°å†…éƒ¨ç”¨ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨è½¬åŒ–ç»“æœï¼Œå‡½æ•°çš„è¿”å›å€¼æŒ‡å‘è¯¥é™æ€å†…å­˜ï¼Œå› æ­¤inet_ntoaæ˜¯ä¸å¯é‡å…¥çš„ã€‚(æ„æ€æ˜¯è¿ç»­è°ƒç”¨ä¸¤ä¸ªè¿™ä¸ªå‡½æ•° åä¸€ä¸ªçš„ç»“æœä¼šæŠŠå‰ä¸€ä¸ªè¦†ç›–) 123#includeï¼œarpa/inet.hï¼int inet_pton(int af,const char*src,void*dst);const char*inet_ntop(int af,const void*src,char*dst,socklen_tcnt); é€‚ç”¨äºipv4å’Œipv6 inet_pton IPåœ°å€srcè½¬æ¢æˆç”¨ç½‘ç»œå­—èŠ‚åº å¹¶æŠŠè½¬æ¢ç»“æœå­˜å‚¨äºdstæŒ‡å‘çš„å†…å­˜ä¸­ã€‚å…¶ä¸­ï¼Œafå‚æ•°æŒ‡å®šåœ°å€æ—ï¼Œå¯ä»¥æ˜¯AF_INETæˆ–è€…AF_INET6ã€‚inet_ptonæˆåŠŸæ—¶è¿”å›1ï¼Œå¤±è´¥åˆ™è¿”å›0å¹¶è®¾ç½®errno[1]ã€‚ inet_ntopå‡½æ•°è¿›è¡Œç›¸åçš„è½¬æ¢ï¼Œå‰ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ä¸inet_ptonçš„å‚æ•°ç›¸åŒï¼Œæœ€åä¸€ä¸ªå‚æ•°cntæŒ‡å®šç›®æ ‡å­˜å‚¨å•å…ƒçš„å¤§å°ã€‚ä¸‹é¢çš„ä¸¤ä¸ªå®èƒ½å¸®åŠ©æˆ‘ä»¬æŒ‡å®šè¿™ä¸ªå¤§å°ï¼ˆåˆ†åˆ«ç”¨äºIPv4å’ŒIPv6ï¼‰ï¼š inet_ntopæˆåŠŸæ—¶è¿”å›ç›®æ ‡å­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œå¤±è´¥åˆ™è¿”å›NULLå¹¶è®¾ç½®errnoã€‚ #includeï¼œnetinet&#x2F;in.hï¼ #define INET_ADDRSTRLEN 16 #define INET6_ADDRSTRLEN 46 ä½¿ç”¨ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt; #include &lt;iostream&gt;#include &lt;arpa/inet.h&gt;//ipåœ°å€è½¬æ¢using namespace std;int main() &#123; //å‡½æ•°1 const char* ip=&quot;192.168.6.208&quot;; in_addr_t ipAddr = inet_addr(ip); cout&lt;&lt;ipAddr&lt;&lt;endl; cout&lt;&lt;inet_addr(&quot;192.168.6.208&quot;)&lt;&lt;endl; //3490097344 è¿”å›in_addr_t(unsigned long) //å‡½æ•°2 //ä½¿ç”¨æœ€å¤š //è·å–ç«¯å£å·çš„ç½‘ç»œå­—èŠ‚ unsigned short int port=5005; unsigned short int new_port=htons(port); //å»ºç«‹ipv4ä¸“ç”¨socketåœ°å€ struct sockaddr_in ip_addr;//ä¸“ç”¨socketç»“æ„ä½“ ip_addr.sin_family=AF_INET;//æŒ‡å®šåœ°å€æ—ipv4 ip_addr.sin_port=new_port;//æŒ‡å®šç½‘ç»œç«¯å£å· if(inet_aton(ip,&amp;ip_addr.sin_addr)==1)&#123; //ipè½¬åŒ–ä¸ºç½‘ç»œåœ°å€ cout&lt;&lt;ip_addr.sin_addr.s_addr&lt;&lt;endl; &#125; cout&lt;&lt;ip_addr.sin_port&lt;&lt;endl;//ç½‘ç»œç«¯å£36115 //ä¸“ç”¨åœ°å€å¼ºåˆ¶è½¬åŒ–ä¸ºé€šç”¨åœ°å€ const struct sockaddr*addr=(sockaddr*)&amp;ip_addr; //å‡½æ•°3 char* ip2=inet_ntoa(ip_addr.sin_addr); cout&lt;&lt;ip2&lt;&lt;endl;&#125; åˆ›å»ºsocketUNIX&#x2F;Linuxçš„ä¸€ä¸ªå“²å­¦æ˜¯ï¼šæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯æ–‡ä»¶ã€‚socketä¹Ÿä¸ä¾‹å¤–ï¼Œå®ƒå°±æ˜¯å¯è¯»ã€å¯å†™ã€å¯æ§åˆ¶ã€å¯å…³é—­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¸‹é¢çš„socketç³»ç»Ÿè°ƒç”¨å¯åˆ›å»ºä¸€ä¸ªsocketï¼š 123#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼int socket(int domain,int type,int protocol); domainå‚æ•°å‘Šè¯‰ç³»ç»Ÿä½¿ç”¨å“ªä¸ªåº•å±‚åè®®æ—ã€‚PF_INETï¼ˆProtocol Family of Internetï¼Œç”¨äºIPv4ï¼‰æˆ–PF_INET6ï¼ˆç”¨äºIPv6ï¼‰ï¼›å¯¹äºUNIXæœ¬åœ°åŸŸåè®®æ—è€Œè¨€ï¼Œè¯¥å‚æ•°åº”è¯¥è®¾ç½®ä¸ºPF_UNIXã€‚ typeå‚æ•°æŒ‡å®šæœåŠ¡ç±»å‹ã€‚æœåŠ¡ç±»å‹ä¸»è¦æœ‰SOCK_STREAMæœåŠ¡ï¼ˆæµæœåŠ¡ï¼‰å’ŒSOCK_UGRAMï¼ˆæ•°æ®æŠ¥ï¼‰æœåŠ¡ã€‚å¯¹TCP&#x2F;IPåè®®æ—è€Œè¨€ï¼Œå…¶å€¼å–SOCK_STREAMè¡¨ç¤ºä¼ è¾“å±‚ä½¿ç”¨TCPåè®®ï¼Œå–SOCK_DGRAMè¡¨ç¤ºä¼ è¾“å±‚ä½¿ç”¨UDPåè®®ã€‚ å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œè‡ªLinuxå†…æ ¸ç‰ˆæœ¬2.6.17èµ·ï¼Œtypeå‚æ•°å¯ä»¥æ¥å—ä¸Šè¿°æœåŠ¡ç±»å‹ä¸ä¸‹é¢ä¸¤ä¸ªé‡è¦çš„æ ‡å¿—ç›¸ä¸çš„å€¼ï¼šSOCK_NONBLOCKå’ŒSOCK_CLOEXECã€‚å®ƒä»¬åˆ†åˆ«è¡¨ç¤ºå°†æ–°åˆ›å»ºçš„socketè®¾ä¸ºéé˜»å¡çš„ï¼Œä»¥åŠç”¨forkè°ƒç”¨åˆ›å»ºå­è¿›ç¨‹æ—¶åœ¨å­è¿›ç¨‹ä¸­å…³é—­è¯¥socketã€‚åœ¨å†…æ ¸ç‰ˆæœ¬2.6.17ä¹‹å‰çš„Linuxä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„è¿™ä¸¤ä¸ªå±æ€§éƒ½éœ€è¦ä½¿ç”¨é¢å¤–çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆæ¯”å¦‚fcntlï¼‰æ¥è®¾ç½®ã€‚ protocolå‚æ•°æ˜¯åœ¨å‰ä¸¤ä¸ªå‚æ•°æ„æˆçš„åè®®é›†åˆä¸‹ï¼Œå†é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„åè®®ã€‚ä¸è¿‡è¿™ä¸ªå€¼é€šå¸¸éƒ½æ˜¯å”¯ä¸€çš„ï¼ˆå‰ä¸¤ä¸ªå‚æ•°å·²ç»å®Œå…¨å†³å®šäº†å®ƒçš„å€¼ï¼‰ã€‚å‡ ä¹åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥æŠŠå®ƒè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤åè®®ã€‚ socketç³»ç»Ÿè°ƒç”¨æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªsocketæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errno å‘½åsocketå°†ä¸€ä¸ªsocketä¸socketåœ°å€ç»‘å®šç§°ä¸ºç»™socketå‘½åã€‚åœ¨æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¦å‘½åsocketï¼Œå› ä¸ºåªæœ‰å‘½ååå®¢æˆ·ç«¯æ‰èƒ½çŸ¥é“è¯¥å¦‚ä½•è¿æ¥å®ƒã€‚å®¢æˆ·ç«¯åˆ™é€šå¸¸ä¸éœ€è¦å‘½åsocketï¼Œè€Œæ˜¯é‡‡ç”¨åŒ¿åæ–¹å¼ï¼Œå³ä½¿ç”¨æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„socketåœ°å€ã€‚å‘½åsocketçš„ç³»ç»Ÿè°ƒç”¨æ˜¯bindï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 123#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼int bind(int sockfd,const struct sockaddr*my_addr,socklen_t addrlen); bindå°†my_addræ‰€æŒ‡çš„socketåœ°å€åˆ†é…ç»™æœªå‘½åçš„sockfdæ–‡ä»¶æè¿°ç¬¦ï¼Œaddrlenå‚æ•°æŒ‡å‡ºè¯¥socketåœ°å€çš„é•¿åº¦ã€‚bindæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚å…¶ä¸­ä¸¤ç§å¸¸è§çš„errnoæ˜¯EACCESå’ŒEADDRINUSEï¼Œå®ƒä»¬çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼š EACCESï¼Œè¢«ç»‘å®šçš„åœ°å€æ˜¯å—ä¿æŠ¤çš„åœ°å€ï¼Œä»…è¶…çº§ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ã€‚æ¯”å¦‚æ™®é€šç”¨æˆ·å°†socketç»‘å®šåˆ°çŸ¥åæœåŠ¡ç«¯å£ï¼ˆç«¯å£å·ä¸º0ï½1023ï¼‰ä¸Šæ—¶ï¼Œbindå°†è¿”å›EACCESé”™è¯¯ EADDRINUSEï¼Œè¢«ç»‘å®šçš„åœ°å€æ­£åœ¨ä½¿ç”¨ä¸­ã€‚æ¯”å¦‚å°†socketç»‘å®šåˆ°ä¸€ä¸ªå¤„äºTIME_WAITçŠ¶æ€çš„socketåœ°å€ã€‚ ç›‘å¬socketsocketè¢«å‘½åä¹‹åï¼Œè¿˜ä¸èƒ½é©¬ä¸Šæ¥å—å®¢æˆ·è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¦‚ä¸‹ç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºä¸€ä¸ªç›‘å¬é˜Ÿåˆ—ä»¥å­˜æ”¾å¾…å¤„ç†çš„å®¢æˆ·è¿æ¥ï¼š 12#includeï¼œsys/socket.hï¼int listen(int sockfd,int backlog); sockfdå‚æ•°æŒ‡å®šè¢«ç›‘å¬çš„socketã€‚ backlogå‚æ•°æç¤ºå†…æ ¸ç›‘å¬é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚ç›‘å¬é˜Ÿåˆ—çš„é•¿åº¦å¦‚æœè¶…è¿‡backlogï¼ŒæœåŠ¡å™¨å°†ä¸å—ç†æ–°çš„å®¢æˆ·è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°†æ”¶åˆ°ECONNREFUSEDé”™è¯¯ä¿¡æ¯ã€‚åœ¨å†…æ ¸ç‰ˆæœ¬2.2ä¹‹å‰çš„Linuxä¸­ï¼Œbacklogå‚æ•°æ˜¯æŒ‡æ‰€æœ‰å¤„äºåŠè¿æ¥çŠ¶æ€ï¼ˆSYN_RCVDï¼‰å’Œå®Œå…¨è¿æ¥çŠ¶æ€ï¼ˆESTABLISHEDï¼‰çš„socketçš„ä¸Šé™ã€‚ä½†è‡ªå†…æ ¸ç‰ˆæœ¬2.2ä¹‹åï¼Œå®ƒåªè¡¨ç¤ºå¤„äºå®Œå…¨è¿æ¥çŠ¶æ€çš„socketçš„ä¸Šé™ï¼Œå¤„äºåŠè¿æ¥çŠ¶æ€çš„socketçš„ä¸Šé™åˆ™ç”±&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_max_syn_backlogå†…æ ¸å‚æ•°å®šä¹‰ã€‚backlogå‚æ•°çš„å…¸å‹å€¼æ˜¯5ã€‚ listenæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errno ç ”ç©¶backlogå‚æ•°å¯¹listenç³»ç»Ÿè°ƒç”¨çš„å®é™…å½±å“ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;signal.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;assert.h&gt;//assertå®#include &lt;stdio.h&gt;#include &lt;string.h&gt;//bzero//#include &lt;libgen.h&gt;static bool stop = false;/*SIGTERMä¿¡å·çš„å¤„ç†å‡½æ•°ï¼Œè§¦å‘æ—¶ç»“æŸä¸»ç¨‹åºä¸­çš„å¾ªç¯*/static void handle_term(int sig)&#123; stop = true;&#125;int main(int argc, char *argv[])&#123; signal(SIGTERM, handle_term);//è®¾ç½®SIGTERMä¿¡å·çš„å¤„ç†å‡½æ•°ä¸ºhandle_term SIGTERMæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç»ˆæ­¢ç¨‹åºè¿è¡Œçš„ä¿¡å· if (argc &lt;= 3)//æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°æ˜¯å¦æ»¡è¶³è¦æ±‚ &#123; printf(&quot;usage:%s ip_address port_numberbacklog\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int backlog = atoi(argv[3]); int sock = socket(PF_INET, SOCK_STREAM, 0);//åˆ›å»ºsocket assert(sock &gt;= 0); //ä½¿ç”¨ assert å®æ¥éªŒè¯ sock çš„å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äº0ã€‚ ä¸æ»¡è¶³åˆ™é€€å‡ºç¨‹åº /*åˆ›å»ºä¸€ä¸ªIPv4 socketåœ°å€*/ struct sockaddr_in address; bzero(&amp;address, sizeof(address));//bzero å°†å†…å­˜å—æ¸…ç©º ç°åœ¨æ›´å¤šä½¿ç”¨memset(&amp;address, 0, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr);//ç»‘å®šip ç½‘ç»œå­—èŠ‚åº address.sin_port = htons(port);//ç»‘å®šip int ret = bind(sock, (struct sockaddr *)&amp;address, sizeof(address));//å‘½å assert(ret != -1); ret = listen(sock, backlog);//ç›‘å¬ assert(ret != -1); /*å¾ªç¯ç­‰å¾…è¿æ¥ï¼Œç›´åˆ°æœ‰SIGTERMä¿¡å·å°†å®ƒä¸­æ–­*/ while (!stop) &#123; sleep(1); &#125; /*å…³é—­socketï¼Œè§åæ–‡*/ close(sock); return 0;&#125; æˆ‘å†™çš„ï¼š 123456789101112131415161718192021222324252627282930313233#include&lt;netinet/in.h&gt;//è½¬æ¢å¤§ç«¯å°ç«¯#include &lt;stdio.h&gt; #include &lt;iostream&gt;#include &lt;bits/socket.h&gt;#include &lt;arpa/inet.h&gt;//ipåœ°å€è½¬æ¢#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;assert.h&gt;using namespace std;int main() &#123; //æºip port const char* ip=&quot;192.168.6.208&quot;; unsigned short int port=5005; //ä¸“ç”¨socketç»“æ„ä½“ sockaddr_in addr; addr.sin_family=AF_INET;//ç»‘å®šåœ°å€æ— addr.sin_port = htons(port);//ç»‘å®šç«¯å£ ç½‘ç»œå­—èŠ‚åº if(inet_aton(ip,&amp;addr.sin_addr)==1)&#123;//ç»‘å®šip ç½‘ç»œå­—èŠ‚åº cout&lt;&lt;addr.sin_addr.s_addr&lt;&lt;endl; &#125; //ä¸“ç”¨ç»“æ„ä½“è½¬åŒ–ä¸ºé€šç”¨ç»“æ„ä½“ //const struct sockaddr*new_addr=(sockaddr*)&amp;addr; //åˆ›å»ºsocket int pre_name_socket; pre_name_socket=socket(PF_INET,SOCK_STREAM,0);//ipv4 tcp SOCK_NONBLOCK è¾“å‡º3 //å‘½åsocket int ret=bind(pre_name_socket,(sockaddr*)&amp;addr,sizeof(addr)); assert(ret != -1); cout&lt;&lt;&quot;bind success&quot;&lt;&lt;endl; //ç›‘å¬ ret = listen(pre_name_socket, 5);//ç›‘å¬ return 0;&#125; è¯¥æœåŠ¡å™¨ç¨‹åºï¼ˆåä¸ºtestlistenï¼‰æ¥æ”¶3ä¸ªå‚æ•°ï¼šIPåœ°å€ã€ç«¯å£å·å’Œbacklogå€¼ã€‚æˆ‘ä»¬åœ¨Kongming20ä¸Šè¿è¡Œè¯¥æœåŠ¡å™¨ç¨‹åºï¼Œå¹¶åœ¨ernestlaptopä¸Šå¤šæ¬¡æ‰§è¡Œtelnetå‘½ä»¤æ¥è¿æ¥è¯¥æœåŠ¡å™¨ç¨‹åºã€‚åŒæ—¶ï¼Œæ¯ä½¿ç”¨telnetå‘½ä»¤å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå°±æ‰§è¡Œä¸€æ¬¡netstatå‘½ä»¤æ¥æŸ¥çœ‹æœåŠ¡å™¨ä¸Šè¿æ¥çš„çŠ¶æ€ã€‚å…·ä½“æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 123$./testlisten 192.168.1.109 12345 5 #è¿è¡Œä»£ç  ç›‘å¬12345ç«¯å£ï¼Œç»™backlogä¼ é€’å…¸å‹å€¼5$telnet 192.168.1.109 12345#å¤šæ¬¡æ‰§è¡Œä¹‹$netstat-nt|grep 12345#å¤šæ¬¡æ‰§è¡Œä¹‹ æ˜¯netstatå‘½ä»¤æŸæ¬¡è¾“å‡ºçš„å†…å®¹ï¼Œå®ƒæ˜¾ç¤ºäº†è¿™ä¸€æ—¶åˆ»listenç›‘å¬é˜Ÿåˆ—çš„å†…å®¹ã€‚ 123456789101112Proto Recv-Q Send-Q Local Address Foreign Address Statetcptcp 0 0 192.168.1.109:12345 192.168.1.108:2240 SYN_RECVtcp 0 0 192.168.1.109:12345 192.168.1.108:2228 SYN_RECV[1]tcp 0 0 192.168.1.109:12345 192.168.1.108:2230 SYN_RECVtcp 0 0 192.168.1.109:12345 192.168.1.108:2238 SYN_RECVtcp 0 0 192.168.1.109:12345 192.168.1.108:2236 SYN_RECVtcp 0 0 192.168.1.109:12345 192.168.1.108:2217 ESTABLISHEDtcp 0 0 192.168.1.109:12345 192.168.1.108:2226 ESTABLISHEDtcp 0 0 192.168.1.109:12345 192.168.1.108:2224 ESTABLISHEDtcp 0 0 192.168.1.109:12345 192.168.1.108:2212 ESTABLISHEDtcp 0 0 192.168.1.109:12345 192.168.1.108:2220 ESTABLISHEDtcp 0 0 192.168.1.109:12345 192.168.1.108:2222 ESTABLISHED å¯è§ï¼Œåœ¨ç›‘å¬é˜Ÿåˆ—ä¸­ï¼Œå¤„äºESTABLISHEDçŠ¶æ€çš„è¿æ¥åªæœ‰6ä¸ªï¼ˆbacklogå€¼åŠ 1ï¼‰ï¼Œå…¶ä»–çš„è¿æ¥éƒ½å¤„äºSYN_RCVDçŠ¶æ€(TCPçŠ¶æ€è½¬ç§»)ã€‚æˆ‘ä»¬æ”¹å˜æœåŠ¡å™¨ç¨‹åºçš„ç¬¬3ä¸ªå‚æ•°å¹¶é‡æ–°è¿è¡Œä¹‹ï¼Œèƒ½å‘ç°åŒæ ·çš„è§„å¾‹ï¼Œå³å®Œæ•´è¿æ¥æœ€å¤šæœ‰ï¼ˆbacklog+1ï¼‰ä¸ªã€‚åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šï¼Œè¿è¡Œç»“æœä¼šæœ‰äº›å·®åˆ«ï¼Œä¸è¿‡ç›‘å¬é˜Ÿåˆ—ä¸­å®Œæ•´è¿æ¥çš„ä¸Šé™é€šå¸¸æ¯”backlogå€¼ç•¥å¤§ã€‚ æ‰€ä»¥æœåŠ¡å™¨å¯ä»¥ æ¥å—å¤šä¸ªè¿æ¥ï¼Œèƒ½å»ºç«‹è¿æ¥çš„ä¸ªæ•°å–å†³äºbacklogå€¼ï¼Œä¸èƒ½è¿æ¥çš„å°±å¤„äºç›‘å¬çŠ¶æ€ï¼Ÿï¼Ÿï¼Ÿ æ¥å—è¿æ¥123#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼int accept(int sockfd,struct sockaddr*addr,socklen_t*addrlen); sockfdå‚æ•°æ˜¯æ‰§è¡Œè¿‡listenç³»ç»Ÿè°ƒç”¨çš„ç›‘å¬socketã€‚ addrå‚æ•°ç”¨æ¥è·å–è¢«æ¥å—è¿æ¥çš„è¿œç«¯socketåœ°å€ï¼Œè¯¥socketåœ°å€çš„é•¿åº¦ç”±addrlenå‚æ•°æŒ‡å‡ºã€‚ acceptæˆåŠŸæ—¶è¿”å›ä¸€ä¸ªæ–°çš„è¿æ¥socketï¼Œè¯¥socketå”¯ä¸€åœ°æ ‡è¯†äº†è¢«æ¥å—çš„è¿™ä¸ªè¿æ¥ï¼ŒæœåŠ¡å™¨å¯é€šè¿‡è¯»å†™è¯¥socketæ¥ä¸è¢«æ¥å—è¿æ¥å¯¹åº”çš„å®¢æˆ·ç«¯é€šä¿¡ã€‚ acceptå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚ ç°åœ¨è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼šå¦‚æœç›‘å¬é˜Ÿåˆ—ä¸­å¤„äºESTABLISHEDçŠ¶æ€çš„è¿æ¥å¯¹åº”çš„å®¢æˆ·ç«¯å‡ºç°ç½‘ç»œå¼‚å¸¸ï¼ˆæ¯”å¦‚æ‰çº¿ï¼‰ï¼Œæˆ–è€…æå‰é€€å‡ºï¼Œé‚£ä¹ˆæœåŠ¡å™¨å¯¹è¿™ä¸ªè¿æ¥æ‰§è¡Œçš„acceptè°ƒç”¨æ˜¯å¦æˆåŠŸï¼Ÿæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç¨‹åºæ¥æµ‹è¯•ä¹‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;//ç”¨äºinet_ntopå‡½æ•°ä½¿ç”¨å®#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int sock = socket(PF_INET, SOCK_STREAM, 0); assert(sock &gt;= 0); int ret = bind(sock, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(sock, 5); assert(ret != -1); /*æš‚åœ20ç§’ä»¥ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥å’Œç›¸å…³æ“ä½œï¼ˆæ‰çº¿æˆ–è€…é€€å‡ºï¼‰å®Œæˆ*/ sleep(20); //å»ºç«‹æ–°çš„åœ°å€ struct sockaddr_in client; socklen_t client_addrlength = sizeof(client); //æ¥å—è¿æ¥ int connfd = accept(sock, (struct sockaddr *)&amp;client, &amp;client_addrlength); if (connfd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); &#125; else &#123; /*æ¥å—è¿æ¥æˆåŠŸåˆ™æ‰“å°å‡ºå®¢æˆ·ç«¯çš„IPåœ°å€å’Œç«¯å£å·*/ char remote[INET_ADDRSTRLEN];//å® ç”¨äºinet_ntopæ¥æ”¶å¤§å° printf(&quot;connected with ip:%s and port:%d\\n&quot;, inet_ntop(AF_INET, &amp;client.sin_addr, remote, INET_ADDRSTRLEN), ntohs(client.sin_port)); close(connfd);//å…³é—­è¿™ä¸ªè¿æ¥socket &#125; close(sock);//å…³é—­æœåŠ¡å™¨ç›‘å¬socket return 0;&#125; $.&#x2F;testaccept 192.168.1.109 54321#ç›‘å¬54321ç«¯å£ $telnet 192.168.1.109 54321 å¦ä¸€ä¸ªæœºå™¨ä¸Šè¿è¡Œ å¯åŠ¨telnetå®¢æˆ·ç«¯ç¨‹åºåï¼Œç«‹å³æ–­å¼€è¯¥å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥ï¼ˆå»ºç«‹å’Œæ–­å¼€è¿æ¥çš„è¿‡ç¨‹è¦åœ¨æœåŠ¡å™¨å¯åŠ¨å20ç§’å†…å®Œæˆï¼‰ã€‚ç»“æœå‘ç°acceptè°ƒç”¨èƒ½å¤Ÿæ­£å¸¸è¿”å›ï¼ŒæœåŠ¡å™¨è¾“å‡ºå¦‚ä¸‹ï¼š connected with ip:192.168.1.108 and port:38545 åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œnetstatå‘½ä»¤ä»¥æŸ¥çœ‹acceptè¿”å›çš„è¿æ¥socketçš„çŠ¶æ€ $netstat-nt|grep 54321 tcp 0 0 192.168.1.109:54321 192.168.1.108:38545 ESTABLISHED netstatå‘½ä»¤çš„è¾“å‡ºè¯´æ˜ï¼Œacceptè°ƒç”¨å¯¹äºå®¢æˆ·ç«¯ç½‘ç»œæ–­å¼€æ¯«ä¸çŸ¥æƒ…ã€‚ ä¸‹é¢æˆ‘ä»¬é‡æ–°æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ï¼Œä¸è¿‡è¿™æ¬¡ä¸æ–­å¼€å®¢æˆ·ç«¯ç½‘ç»œè¿æ¥ï¼Œè€Œæ˜¯åœ¨å»ºç«‹è¿æ¥åç«‹å³é€€å‡ºå®¢æˆ·ç«¯ç¨‹åºã€‚è¿™æ¬¡acceptè°ƒç”¨åŒæ ·æ­£å¸¸è¿”å›ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œnetstatå‘½ä»¤ä»¥æŸ¥çœ‹acceptè¿”å›çš„è¿æ¥socketçš„çŠ¶æ€ä¹Ÿæ­£å¸¸ ç”±æ­¤å¯è§ï¼Œacceptåªæ˜¯ä»ç›‘å¬é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥ï¼Œè€Œä¸è®ºè¿æ¥å¤„äºä½•ç§çŠ¶æ€ï¼ˆå¦‚ä¸Šé¢çš„ESTABLISHEDçŠ¶æ€å’ŒCLOSE_WAITçŠ¶æ€ï¼‰ï¼Œæ›´ä¸å…³å¿ƒä»»ä½•ç½‘ç»œçŠ¶å†µçš„å˜åŒ– æˆ‘ä»¬æŠŠæ‰§è¡Œè¿‡listenè°ƒç”¨ã€å¤„äºLISTENçŠ¶æ€çš„socketç§°ä¸ºç›‘å¬socketï¼Œè€Œæ‰€æœ‰å¤„äºESTABLISHEDçŠ¶æ€çš„socketåˆ™ç§°ä¸ºè¿æ¥socketã€‚ å‘èµ·è¿æ¥å¦‚æœè¯´æœåŠ¡å™¨é€šè¿‡listenè°ƒç”¨æ¥è¢«åŠ¨æ¥å—è¿æ¥ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯éœ€è¦é€šè¿‡å¦‚ä¸‹ç³»ç»Ÿè°ƒç”¨æ¥ä¸»åŠ¨ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ 123#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼int connect(int sockfd,const struct sockaddr*serv_addr,socklen_t addrlen); sockfdå‚æ•°ç”±socketç³»ç»Ÿè°ƒç”¨è¿”å›ä¸€ä¸ªsocketã€‚serv_addrå‚æ•°æ˜¯æœåŠ¡å™¨ç›‘å¬çš„socketåœ°å€ï¼Œaddrlenå‚æ•°åˆ™æŒ‡å®šè¿™ä¸ªåœ°å€çš„é•¿åº¦ connectæˆåŠŸæ—¶è¿”å›0ã€‚ä¸€æ—¦æˆåŠŸå»ºç«‹è¿æ¥ï¼Œsockfdå°±å”¯ä¸€åœ°æ ‡è¯†äº†è¿™ä¸ªè¿æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è¯»å†™sockfdæ¥ä¸æœåŠ¡å™¨é€šä¿¡ã€‚connectå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚å…¶ä¸­ä¸¤ç§å¸¸è§çš„errnoæ˜¯ECONNREFUSEDå’ŒETIMEDOUTï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š ECONNREFUSEDï¼Œç›®æ ‡ç«¯å£ä¸å­˜åœ¨ï¼Œè¿æ¥è¢«æ‹’ç» ETIMEDOUTï¼Œè¿æ¥è¶…æ—¶ å…³é—­è¿æ¥å…³é—­ä¸€ä¸ªè¿æ¥å®é™…ä¸Šå°±æ˜¯å…³é—­è¯¥è¿æ¥å¯¹åº”çš„socketï¼Œè¿™å¯ä»¥é€šè¿‡å¦‚ä¸‹å…³é—­æ™®é€šæ–‡ä»¶æè¿°ç¬¦çš„ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆ 12#includeï¼œunistd.hï¼int close(int fd); fdå‚æ•°æ˜¯å¾…å…³é—­çš„socketã€‚ä¸è¿‡ï¼Œcloseç³»ç»Ÿè°ƒç”¨å¹¶éæ€»æ˜¯ç«‹å³å…³é—­ä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯å°†fdçš„å¼•ç”¨è®¡æ•°å‡1ã€‚åªæœ‰å½“fdçš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ‰çœŸæ­£å…³é—­è¿æ¥ã€‚å¤šè¿›ç¨‹ç¨‹åºä¸­ï¼Œä¸€æ¬¡forkç³»ç»Ÿè°ƒç”¨é»˜è®¤å°†ä½¿çˆ¶è¿›ç¨‹ä¸­æ‰“å¼€çš„socketçš„å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­éƒ½å¯¹è¯¥socketæ‰§è¡Œcloseè°ƒç”¨æ‰èƒ½å°†è¿æ¥å…³é—­ã€‚ å¦‚æœæ— è®ºå¦‚ä½•éƒ½è¦ç«‹å³ç»ˆæ­¢è¿æ¥ï¼ˆè€Œä¸æ˜¯å°†socketçš„å¼•ç”¨è®¡æ•°å‡1ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„shutdownç³»ç»Ÿè°ƒç”¨ï¼ˆç›¸å¯¹äºcloseæ¥è¯´ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºç½‘ç»œç¼–ç¨‹è®¾è®¡çš„ï¼‰ 12#includeï¼œsys/socket.hï¼int shutdown(int sockfd,int howto); sockfdå‚æ•°æ˜¯å¾…å…³é—­çš„socketã€‚howtoå‚æ•°å†³å®šäº†shutdownçš„è¡Œä¸ºï¼Œå®ƒå¯å–è¡¨çš„æŸä¸ªå€¼ ç”±æ­¤å¯è§ï¼Œshutdownèƒ½å¤Ÿåˆ†åˆ«å…³é—­socketä¸Šçš„è¯»æˆ–å†™ï¼Œæˆ–è€…éƒ½å…³é—­ã€‚è€Œcloseåœ¨å…³é—­è¿æ¥æ—¶åªèƒ½å°†socketä¸Šçš„è¯»å’Œå†™åŒæ—¶å…³é—­ã€‚ shutdownæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚ æ•°æ®è¯»å†™TCPæ•°æ®è¯»å†™å¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œreadå’ŒwriteåŒæ ·é€‚ç”¨äºsocketã€‚ä½†æ˜¯socketç¼–ç¨‹æ¥å£æä¾›äº†å‡ ä¸ªä¸“é—¨ç”¨äºsocketæ•°æ®è¯»å†™çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒä»¬å¢åŠ äº†å¯¹æ•°æ®è¯»å†™çš„æ§åˆ¶ã€‚å…¶ä¸­ç”¨äºTCPæµæ•°æ®è¯»å†™çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ï¼š 1234#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼ssize_t recv(int sockfd,void*buf,size_t len,int flags);ssize_t send(int sockfd,const void*buf,size_t len,int flags); recvè¯»å–sockfdä¸Šçš„æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šè¯»ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ï¼Œflagså‚æ•°çš„å«ä¹‰è§åæ–‡ï¼Œé€šå¸¸è®¾ç½®ä¸º0å³å¯ã€‚recvæˆåŠŸæ—¶è¿”å›å®é™…è¯»å–åˆ°çš„æ•°æ®çš„é•¿åº¦ï¼Œå®ƒå¯èƒ½å°äºæˆ‘ä»¬æœŸæœ›çš„é•¿åº¦lenã€‚å› æ­¤æˆ‘ä»¬å¯èƒ½è¦å¤šæ¬¡è°ƒç”¨recvï¼Œæ‰èƒ½è¯»å–åˆ°å®Œæ•´çš„æ•°æ®ã€‚recvå¯èƒ½è¿”å›0ï¼Œè¿™æ„å‘³ç€é€šä¿¡å¯¹æ–¹å·²ç»å…³é—­è¿æ¥äº†ã€‚recvå‡ºé”™æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚ sendå¾€sockfdä¸Šå†™å…¥æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šå†™ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚sendæˆåŠŸæ—¶è¿”å›å®é™…å†™å…¥çš„æ•°æ®çš„é•¿åº¦ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errno flagså‚æ•°ä¸ºæ•°æ®æ”¶å‘æä¾›äº†é¢å¤–çš„æ§åˆ¶ æˆ‘ä»¬ä¸¾ä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™äº›é€‰é¡¹ã€‚MSG_OOBé€‰é¡¹ç»™åº”ç”¨ç¨‹åºæä¾›äº†å‘é€å’Œæ¥æ”¶å¸¦å¤–æ•°æ®çš„æ–¹æ³• å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); //socketåœ°å€ struct sockaddr_in server_address; bzero(&amp;server_address, sizeof(server_address)); server_address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;server_address.sin_addr); server_address.sin_port = htons(port); //åˆ›å»ºsocket int sockfd = socket(PF_INET, SOCK_STREAM, 0); assert(sockfd &gt;= 0); //ä¸ç”¨å‘½åå’Œç›‘å¬ç›´æ¥è¿æ¥-å§‹ç»ˆåªæœ‰ä¸€ä¸ªsocket if (connect(sockfd, (struct sockaddr *)&amp;server_address, sizeof(server_address)) &lt; 0) &#123; printf(&quot;connection failed\\n&quot;); &#125; else &#123; const char *oob_data = &quot;abc&quot;; const char *normal_data = &quot;123&quot;; send(sockfd, normal_data, strlen(normal_data), 0); send(sockfd, oob_data, strlen(oob_data), MSG_OOB); send(sockfd, normal_data, strlen(normal_data), 0); &#125; close(sockfd); return 0;&#125; æœåŠ¡å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#define BUF_SIZE 1024int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); //åœ°å€ struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); //åˆ›å»º int sock = socket(PF_INET, SOCK_STREAM, 0); assert(sock &gt;= 0); //å‘½å int ret = bind(sock, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); //ç›‘å¬ ret = listen(sock, 5); assert(ret != -1); //è¿æ¥åœ°å€ struct sockaddr_in client; socklen_t client_addrlength = sizeof(client); //æ¥å—è¿æ¥ int connfd = accept(sock, (struct sockaddr *)&amp;client, &amp;client_addrlength); if (connfd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); &#125; else &#123; char buffer[BUF_SIZE]; memset(buffer, &#x27;\\0&#x27;, BUF_SIZE); //ä½¿ç”¨ç›‘å¬socketæ¥å—æ¶ˆæ¯ ret = recv(connfd, buffer, BUF_SIZE - 1, 0); printf(&quot;got%d bytes of normal data&#x27;%s&#x27;\\n&quot;, ret, buffer); memset(buffer, &#x27;\\0&#x27;, BUF_SIZE); ret = recv(connfd, buffer, BUF_SIZE - 1, MSG_OOB); printf(&quot;got%d bytes of oob data&#x27;%s&#x27;\\n&quot;, ret, buffer); memset(buffer, &#x27;\\0&#x27;, BUF_SIZE); ret = recv(connfd, buffer, BUF_SIZE - 1, 0); printf(&quot;got%d bytes of normal data&#x27;%s&#x27;\\n&quot;, ret, buffer); close(connfd); &#125; close(sock); return 0;&#125; è¿è¡Œå¹¶tcpdumpæŠ“å–è¿™ä¸€è¿‡ç¨‹ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µ 123$./testoobrecv 192.168.1.109 54321 #åœ¨Kongming20ä¸Šæ‰§è¡ŒæœåŠ¡å™¨ç¨‹åºï¼Œç›‘å¬54321ç«¯å£$./testoobsend 192.168.1.109 54321 #åœ¨ernest-laptopä¸Šæ‰§è¡Œå®¢æˆ·ç«¯ç¨‹åº$sudo tcpdump-ntx-i eth0 port 54321 æœåŠ¡å™¨è¾“å‡º got 5 bytes of normal dataâ€™123abâ€™ got 1 bytes of oob dataâ€™câ€™ got 3 bytes of normal dataâ€™123â€™ ç”±æ­¤å¯è§ï¼Œå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„3å­—èŠ‚çš„å¸¦å¤–æ•°æ®â€œabcâ€ä¸­ï¼Œä»…æœ‰æœ€åä¸€ä¸ªå­—ç¬¦â€œcâ€è¢«æœåŠ¡å™¨å½“æˆçœŸæ­£çš„å¸¦å¤–æ•°æ®æ¥æ”¶ã€‚å¹¶ä¸”ï¼ŒæœåŠ¡å™¨å¯¹æ­£å¸¸æ•°æ®çš„æ¥æ”¶å°†è¢«å¸¦å¤–æ•°æ®æˆªæ–­ï¼Œå³å‰ä¸€éƒ¨åˆ†æ­£å¸¸æ•°æ®â€œ123abâ€å’Œåç»­çš„æ­£å¸¸æ•°æ®â€œ123â€æ˜¯ä¸èƒ½è¢«ä¸€ä¸ªrecvè°ƒç”¨å…¨éƒ¨è¯»å‡ºçš„ã€‚ å«å¸¦å¤–æ•°æ®çš„TCPæŠ¥æ–‡æ®µ 12IP 192.168.1.108.60460ï¼192.168.1.109.54321:Flags[P.U],seq 4:7,ack 1,win 92,urg 3,options[nop,nop,TS val 102794322 ecr154703423],length 3 è¿™é‡Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡çœ‹åˆ°tcpdumpè¾“å‡ºæ ‡å¿—Uï¼Œè¿™è¡¨ç¤ºè¯¥TCPæŠ¥æ–‡æ®µçš„å¤´éƒ¨è¢«è®¾ç½®äº†ç´§æ€¥æ ‡å¿—ã€‚ â€œurg 3â€æ˜¯ç´§æ€¥åç§»å€¼ï¼Œå®ƒæŒ‡å‡ºå¸¦å¤–æ•°æ®åœ¨å­—èŠ‚æµä¸­çš„ä½ç½®çš„ä¸‹ä¸€å­—èŠ‚ä½ç½®æ˜¯7ï¼ˆ3+4ï¼Œå…¶ä¸­4æ˜¯è¯¥TCPæŠ¥æ–‡æ®µçš„åºå·å€¼ç›¸å¯¹åˆå§‹åºå·å€¼çš„åç§»ï¼‰ã€‚ å› æ­¤ï¼Œå¸¦å¤–æ•°æ®æ˜¯å­—èŠ‚æµä¸­çš„ç¬¬6å­—èŠ‚ï¼Œå³å­—ç¬¦â€œcâ€ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œflagså‚æ•°åªå¯¹sendå’Œrecvçš„å½“å‰è°ƒç”¨ç”Ÿæ•ˆï¼Œè€Œåé¢æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•é€šè¿‡setsockoptç³»ç»Ÿè°ƒç”¨æ°¸ä¹…æ€§åœ°ä¿®æ”¹socketçš„æŸäº›å±æ€§ã€‚ UDPæ•°æ®è¯»å†™1234#includeï¼œsys/types.hï¼#includeï¼œsys/socket.hï¼ssize_t recvfrom(int sockfd,void*buf,size_t len,int flags,struct sockaddr*src_addr,socklen_t*addrlen);ssize_t sendto(int sockfd,const void*buf,size_t len,int flags,const struct sockaddr*dest_addr,socklen_t addrlen); recvfromè¯»å–sockfdä¸Šçš„æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šè¯»ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚å› ä¸ºUDPé€šä¿¡æ²¡æœ‰è¿æ¥çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡è¯»å–æ•°æ®éƒ½éœ€è¦è·å–å‘é€ç«¯çš„socketåœ°å€ï¼Œå³å‚æ•°src_addræ‰€æŒ‡çš„å†…å®¹ï¼Œaddrlenå‚æ•°åˆ™æŒ‡å®šè¯¥åœ°å€çš„é•¿åº¦ sendtoå¾€sockfdä¸Šå†™å…¥æ•°æ®ï¼Œbufå’Œlenå‚æ•°åˆ†åˆ«æŒ‡å®šå†™ç¼“å†²åŒºçš„ä½ç½®å’Œå¤§å°ã€‚dest_addrå‚æ•°æŒ‡å®šæ¥æ”¶ç«¯çš„socketåœ°å€ï¼Œaddrlenå‚æ•°åˆ™æŒ‡å®šè¯¥åœ°å€çš„é•¿åº¦ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œrecvfrom&#x2F;sendtoç³»ç»Ÿè°ƒç”¨ä¹Ÿå¯ä»¥ç”¨äºé¢å‘è¿æ¥ï¼ˆSTREAMï¼‰çš„socketçš„æ•°æ®è¯»å†™ï¼Œåªéœ€è¦æŠŠæœ€åä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸ºNULLä»¥å¿½ç•¥å‘é€ç«¯&#x2F;æ¥æ”¶ç«¯çš„socketåœ°å€ï¼ˆå› ä¸ºæˆ‘ä»¬å·²ç»å’Œå¯¹æ–¹å»ºç«‹äº†è¿æ¥ï¼Œæ‰€ä»¥å·²ç»çŸ¥é“å…¶socketåœ°å€äº†ï¼‰ã€‚ é€šç”¨æ•°æ®è¯»å†™å‡½æ•°é€‚ç”¨tcpå’Œudp 123#includeï¼œsys/socket.hï¼ssize_t recvmsg(int sockfd,struct msghdr*msg,int flags);ssize_t sendmsg(int sockfd,struct msghdr*msg,int flags); sockfdå‚æ•°æŒ‡å®šè¢«æ“ä½œçš„ç›®æ ‡socketã€‚msgå‚æ•°æ˜¯msghdrç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œmsghdrç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910struct msghdr&#123; void*msg_name;/*socketåœ°å€*/ socklen_t msg_namelen;/*socketåœ°å€çš„é•¿åº¦*/ struct iovec*msg_iov;/*åˆ†æ•£çš„å†…å­˜å—ï¼Œè§åæ–‡*/ int msg_iovlen;/*åˆ†æ•£å†…å­˜å—çš„æ•°é‡*/ void*msg_control;/*æŒ‡å‘è¾…åŠ©æ•°æ®çš„èµ·å§‹ä½ç½®*/ socklen_t msg_controllen;/*è¾…åŠ©æ•°æ®çš„å¤§å°*/ int msg_flags;/*å¤åˆ¶å‡½æ•°ä¸­çš„flagså‚æ•°ï¼Œå¹¶åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ›´æ–°*/&#125;; msg_nameæˆå‘˜æŒ‡å‘ä¸€ä¸ªsocketåœ°å€ç»“æ„å˜é‡ã€‚å®ƒæŒ‡å®šé€šä¿¡å¯¹æ–¹çš„socketåœ°å€ã€‚å¯¹äºé¢å‘è¿æ¥çš„TCPåè®®ï¼Œè¯¥æˆå‘˜æ²¡æœ‰æ„ä¹‰ï¼Œå¿…é¡»è¢«è®¾ç½®ä¸ºNULLã€‚è¿™æ˜¯å› ä¸ºå¯¹æ•°æ®æµsocketè€Œè¨€ï¼Œå¯¹æ–¹çš„åœ°å€å·²ç»çŸ¥é“ã€‚msg_namelenæˆå‘˜åˆ™æŒ‡å®šäº†msg_nameæ‰€æŒ‡socketåœ°å€çš„é•¿åº¦ã€‚msg_iovæˆå‘˜æ˜¯iovecç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œiovecç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ 12345struct iovec&#123;void*iov_base;/*å†…å­˜èµ·å§‹åœ°å€*/size_t iov_len;/*è¿™å—å†…å­˜çš„é•¿åº¦*/&#125;; ç”±ä¸Šå¯è§ï¼Œiovecç»“æ„ä½“å°è£…äº†ä¸€å—å†…å­˜çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦ã€‚msg_iovlenæŒ‡å®šè¿™æ ·çš„iovecç»“æ„å¯¹è±¡æœ‰å¤šå°‘ä¸ªã€‚å¯¹äºrecvmsgè€Œè¨€ï¼Œæ•°æ®å°†è¢«è¯»å–å¹¶å­˜æ”¾åœ¨msg_iovlenå—åˆ†æ•£çš„å†…å­˜ä¸­ï¼Œè¿™äº›å†…å­˜çš„ä½ç½®å’Œé•¿åº¦åˆ™ç”±msg_iovæŒ‡å‘çš„æ•°ç»„æŒ‡å®šï¼Œè¿™ç§°ä¸ºåˆ†æ•£è¯»ï¼ˆscatter readï¼‰ï¼›å¯¹äºsendmsgè€Œè¨€ï¼Œmsg_iovlenå—åˆ†æ•£å†…å­˜ä¸­çš„æ•°æ®å°†è¢«ä¸€å¹¶å‘é€ï¼Œè¿™ç§°ä¸ºé›†ä¸­å†™ï¼ˆgather writeï¼‰ msg_controlå’Œmsg_controllenæˆå‘˜ç”¨äºè¾…åŠ©æ•°æ®çš„ä¼ é€ã€‚æˆ‘ä»¬ä¸è¯¦ç»†è®¨è®ºå®ƒä»¬ï¼Œä»…åœ¨ç¬¬13ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥å®ç°åœ¨è¿›ç¨‹é—´ä¼ é€’æ–‡ä»¶æè¿°ç¬¦ã€‚ msg_flagsæˆå‘˜æ— é¡»è®¾å®šï¼Œå®ƒä¼šå¤åˆ¶recvmsg&#x2F;sendmsgçš„flagså‚æ•°çš„å†…å®¹ä»¥å½±å“æ•°æ®è¯»å†™è¿‡ç¨‹ã€‚recvmsgè¿˜ä¼šåœ¨è°ƒç”¨ç»“æŸå‰ï¼Œå°†æŸäº›æ›´æ–°åçš„æ ‡å¿—è®¾ç½®åˆ°msg_flagsä¸­ã€‚ recvmsg&#x2F;sendmsgçš„flagså‚æ•°ä»¥åŠè¿”å›å€¼çš„å«ä¹‰å‡ä¸send&#x2F;recvçš„flagså‚æ•°åŠè¿”å›å€¼ç›¸åŒã€‚ ç”±äºsocketè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œè¿™é‡Œçš„â€œè¯»ç«¯â€æ˜¯é’ˆå¯¹é€šä¿¡å¯¹æ–¹è€Œè¨€çš„ å®ç°è‡ªå·±çš„ç®€å•çš„tcpé€šä¿¡å¸¦å¤–æ ‡è®°ç´§æ€¥æ ‡å¿— ###åœ°å€ä¿¡æ¯å‡½æ•° è·å–ä¸€ä¸ªè¿æ¥socketçš„æœ¬ç«¯socketåœ°å€ï¼Œä»¥åŠè¿œç«¯çš„socketåœ°å€ socketé€‰é¡¹ä¸“é—¨ç”¨æ¥è¯»å–å’Œè®¾ç½®socketæ–‡ä»¶æè¿°ç¬¦å±æ€§ ç½‘ç»œä¿¡æ¯APIipv4è½¬ç§»åˆ°ipv6ä¸ä¾¿æ‰©å±•ï¼Œä½¿ç”¨ä¸»æœºåè®¿é—®æœºå™¨ï¼Œé¿å…ç›´æ¥ä½¿ç”¨ip é«˜çº§I&#x2F;Oå‡½æ•°-ä¸å¸¸ç”¨ï¼Œä½†æ˜¯ç‰¹å®šå’Œåœºæ™¯ä¸‹æ€§èƒ½ä¼˜ç§€ ç”¨äºåˆ›å»ºæ–‡ä»¶æè¿°ç¬¦çš„å‡½æ•°ï¼ŒåŒ…æ‹¬pipeã€dup&#x2F;dup2å‡½æ•° æ–‡ä»¶æè¿°ç¬¦çš„è¯»å†™æ•°æ®ï¼ŒåŒ…æ‹¬readv&#x2F;writevã€sendfileã€mmap&#x2F;munmapã€spliceå’Œteeå‡½æ•° ç”¨äºæ§åˆ¶I&#x2F;Oè¡Œä¸ºå’Œå±æ€§çš„å‡½æ•°ï¼ŒåŒ…æ‹¬fcntlå‡½æ•° pipeå‡½æ•°åˆ›å»ºç®¡é“ è¿›ç¨‹é—´é€šä¿¡ dupå‡½æ•°å’Œdup2å‡½æ•°dupå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–°æ–‡ä»¶æè¿°ç¬¦å’ŒåŸæœ‰æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ç›¸åŒçš„æ–‡ä»¶ã€ç®¡é“æˆ–è€…ç½‘ç»œè¿æ¥ã€‚å¹¶ä¸”dupè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ€»æ˜¯å–ç³»ç»Ÿå½“å‰å¯ç”¨çš„æœ€å°æ•´æ•°å€¼ã€‚ readvå‡½æ•°å’Œwritevå‡½æ•°readvå‡½æ•°å°†æ•°æ®ä»æ–‡ä»¶æè¿°ç¬¦è¯»åˆ°åˆ†æ•£çš„å†…å­˜å—ä¸­ï¼Œå³åˆ†æ•£è¯»ï¼› writevå‡½æ•°åˆ™å°†å¤šå—åˆ†æ•£çš„å†…å­˜æ•°æ®ä¸€å¹¶å†™å…¥æ–‡ä»¶æè¿°ç¬¦ä¸­ LinuxæœåŠ¡å™¨ç¨‹åºè§„èŒƒ LinuxæœåŠ¡å™¨ç¨‹åºä¸€èˆ¬ä»¥åå°è¿›ç¨‹å½¢å¼è¿è¡Œã€‚åå°è¿›ç¨‹åˆç§°å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ã€‚å®ƒæ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œå› è€Œä¹Ÿä¸ä¼šæ„å¤–æ¥æ”¶åˆ°ç”¨æˆ·è¾“å…¥ã€‚å®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹é€šå¸¸æ˜¯initè¿›ç¨‹ï¼ˆPIDä¸º1çš„è¿›ç¨‹ï¼‰ã€‚ LinuxæœåŠ¡å™¨ç¨‹åºé€šå¸¸æœ‰ä¸€å¥—æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒè‡³å°‘èƒ½è¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ï¼Œæœ‰çš„é«˜çº§æœåŠ¡å™¨è¿˜èƒ½è¾“å‡ºæ—¥å¿—åˆ°ä¸“é—¨çš„UDPæœåŠ¡å™¨ã€‚å¤§éƒ¨åˆ†åå°è¿›ç¨‹éƒ½åœ¨&#x2F;var&#x2F;logç›®å½•ä¸‹æ‹¥æœ‰è‡ªå·±çš„æ—¥å¿—ç›®å½•ã€‚ LinuxæœåŠ¡å™¨ç¨‹åºä¸€èˆ¬ä»¥æŸä¸ªä¸“é—¨çš„érootèº«ä»½è¿è¡Œã€‚æ¯”å¦‚mysqldã€httpdã€syslogdç­‰åå°è¿›ç¨‹ï¼Œåˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„è¿è¡Œè´¦æˆ·mysqlã€apacheå’Œsyslog LinuxæœåŠ¡å™¨ç¨‹åºé€šå¸¸æ˜¯å¯é…ç½®çš„ã€‚æœåŠ¡å™¨ç¨‹åºé€šå¸¸èƒ½å¤„ç†å¾ˆå¤šå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¦‚æœä¸€æ¬¡è¿è¡Œçš„é€‰é¡¹å¤ªå¤šï¼Œåˆ™å¯ä»¥ç”¨é…ç½®æ–‡ä»¶æ¥ç®¡ç†ã€‚ç»å¤§å¤šæ•°æœåŠ¡å™¨ç¨‹åºéƒ½æœ‰é…ç½®æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åœ¨&#x2F;etcç›®å½•ä¸‹ã€‚æ¯”å¦‚ç¬¬4ç« è®¨è®ºçš„squidæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;squid3&#x2F;squid.confã€‚ LinuxæœåŠ¡å™¨è¿›ç¨‹é€šå¸¸ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªPIDæ–‡ä»¶å¹¶å­˜å…¥&#x2F;var&#x2F;runç›®å½•ä¸­ï¼Œä»¥è®°å½•è¯¥åå°è¿›ç¨‹çš„PIDã€‚æ¯”å¦‚syslogdçš„PIDæ–‡ä»¶æ˜¯&#x2F;var&#x2F;run&#x2F;syslogd.pid LinuxæœåŠ¡å™¨ç¨‹åºé€šå¸¸éœ€è¦è€ƒè™‘ç³»ç»Ÿèµ„æºå’Œé™åˆ¶ï¼Œä»¥é¢„æµ‹è‡ªèº«èƒ½æ‰¿å—å¤šå¤§è´Ÿè·ï¼Œæ¯”å¦‚è¿›ç¨‹å¯ç”¨æ–‡ä»¶æè¿°ç¬¦æ€»æ•°å’Œå†…å­˜æ€»é‡ç­‰ æ—¥å¿—####Linuxç³»ç»Ÿæ—¥å¿— å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ ä½œç”¨ æœåŠ¡å™¨çš„è°ƒè¯•å’Œç»´æŠ¤éƒ½éœ€è¦ä¸€ä¸ªä¸“ä¸šçš„æ—¥å¿—ç³»ç»Ÿã€‚ åŸç† Linuxæä¾›ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹æ¥å¤„ç†ç³»ç»Ÿæ—¥å¿—â€”â€”syslogdçš„å‡çº§ç‰ˆrsyslogdã€‚rsyslogdå®ˆæŠ¤è¿›ç¨‹æ—¢èƒ½æ¥æ”¶ç”¨æˆ·è¿›ç¨‹è¾“å‡ºçš„æ—¥å¿—ï¼Œåˆèƒ½æ¥æ”¶å†…æ ¸æ—¥å¿—ã€‚ æ¥æ”¶ç”¨æˆ·è¿›ç¨‹è¾“å‡ºçš„æ—¥å¿— ç”¨æˆ·è¿›ç¨‹æ˜¯é€šè¿‡è°ƒç”¨syslogå‡½æ•°ç”Ÿæˆç³»ç»Ÿæ—¥å¿—çš„ã€‚è¯¥å‡½æ•°å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸€ä¸ªUNIXæœ¬åœ°åŸŸsocketç±»å‹ï¼ˆAF_UNIXï¼‰çš„æ–‡ä»¶&#x2F;dev&#x2F;logä¸­ï¼Œrsyslogdåˆ™ç›‘å¬è¯¥æ–‡ä»¶ä»¥è·å–ç”¨æˆ·è¿›ç¨‹çš„è¾“å‡ºã€‚ æ¥æ”¶å†…æ ¸æ—¥å¿— å†…æ ¸æ—¥å¿—åœ¨è€çš„ç³»ç»Ÿä¸Šæ˜¯é€šè¿‡å¦å¤–ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹rklogdæ¥ç®¡ç†çš„ï¼Œrsyslogdåˆ©ç”¨é¢å¤–çš„æ¨¡å—å®ç°äº†ç›¸åŒçš„åŠŸèƒ½ã€‚å†…æ ¸æ—¥å¿—ç”±printkç­‰å‡½æ•°æ‰“å°è‡³å†…æ ¸çš„ç¯çŠ¶ç¼“å­˜ï¼ˆring bufferï¼‰ä¸­ã€‚ç¯çŠ¶ç¼“å­˜çš„å†…å®¹ç›´æ¥æ˜ å°„åˆ°&#x2F;proc&#x2F;kmsgæ–‡ä»¶ä¸­ã€‚rsyslogdåˆ™é€šè¿‡è¯»å–è¯¥æ–‡ä»¶è·å¾—å†…æ ¸æ—¥å¿—rsyslogdå®ˆæŠ¤è¿›ç¨‹åœ¨æ¥æ”¶åˆ°ç”¨æˆ·è¿›ç¨‹æˆ–å†…æ ¸è¾“å…¥çš„æ—¥å¿—åï¼Œä¼šæŠŠå®ƒä»¬è¾“å‡ºè‡³æŸäº›ç‰¹å®šçš„æ—¥å¿—æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒè¯•ä¿¡æ¯ä¼šä¿å­˜è‡³&#x2F;var&#x2F;log&#x2F;debugæ–‡ä»¶ï¼Œæ™®é€šä¿¡æ¯ä¿å­˜è‡³&#x2F;var&#x2F;log&#x2F;messagesæ–‡ä»¶ï¼Œå†…æ ¸æ¶ˆæ¯åˆ™ä¿å­˜è‡³&#x2F;var&#x2F;log&#x2F;kern.logæ–‡ä»¶ã€‚ é…ç½®æ–‡ä»¶ æ—¥å¿—ä¿¡æ¯å…·ä½“å¦‚ä½•åˆ†å‘ï¼Œå¯ä»¥åœ¨rsyslogdçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚rsyslogdçš„ä¸»é…ç½®æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;rsyslog.confï¼Œå…¶ä¸­ä¸»è¦å¯ä»¥è®¾ç½®çš„é¡¹åŒ…æ‹¬ï¼šå†…æ ¸æ—¥å¿—è¾“å…¥è·¯å¾„ï¼Œæ˜¯å¦æ¥æ”¶UDPæ—¥å¿—åŠå…¶ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤æ˜¯514ï¼Œè§&#x2F;etc&#x2F;servicesæ–‡ä»¶ï¼‰ï¼Œæ˜¯å¦æ¥æ”¶TCPæ—¥å¿—åŠå…¶ç›‘å¬ç«¯å£ï¼Œæ—¥å¿—æ–‡ä»¶çš„æƒé™ï¼ŒåŒ…å«å“ªäº›å­é…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚&#x2F;etc&#x2F;rsyslog.d&#x2F;*.confï¼‰ã€‚rsyslogdçš„å­é…ç½®æ–‡ä»¶åˆ™æŒ‡å®šå„ç±»æ—¥å¿—çš„ç›®æ ‡å­˜å‚¨æ–‡ä»¶ syslogå‡½æ•°#includeï¼œsyslog.hï¼ void syslog(int priority,const char*message,â€¦) è¯¥å‡½æ•°é‡‡ç”¨å¯å˜å‚æ•°ï¼ˆç¬¬äºŒä¸ªå‚æ•°messageå’Œç¬¬ä¸‰ä¸ªå‚æ•°â€¦ï¼‰æ¥ç»“æ„åŒ–è¾“å‡ºã€‚priorityå‚æ•°æ˜¯æ‰€è°“çš„è®¾æ–½å€¼ä¸æ—¥å¿—çº§åˆ«çš„æŒ‰ä½æˆ–ã€‚è®¾æ–½å€¼çš„é»˜è®¤å€¼æ˜¯LOG_USERï¼Œæˆ‘ä»¬ä¸‹é¢çš„è®¨è®ºä¹Ÿåªé™äºè¿™ä¸€ç§è®¾æ–½å€¼ã€‚æ—¥å¿—çº§åˆ«æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š 123456789#includeï¼œsyslog.hï¼#define LOG_EMERG 0/*ç³»ç»Ÿä¸å¯ç”¨*/#define LOG_ALERT 1/*æŠ¥è­¦ï¼Œéœ€è¦ç«‹å³é‡‡å–åŠ¨ä½œ*/#define LOG_CRIT 2/*éå¸¸ä¸¥é‡çš„æƒ…å†µ*/#define LOG_ERR 3/*é”™è¯¯*/#define LOG_WARNING 4/*è­¦å‘Š*/#define LOG_NOTICE 5/*é€šçŸ¥*/#define LOG_INFO 6/*ä¿¡æ¯*/#define LOG_DEBUG 7/*è°ƒè¯•*/ ä¸‹é¢è¿™ä¸ªå‡½æ•°å¯ä»¥æ”¹å˜syslogçš„é»˜è®¤è¾“å‡ºæ–¹å¼ï¼Œè¿›ä¸€æ­¥ç»“æ„åŒ–æ—¥å¿—å†…å®¹ï¼š #includeï¼œsyslog.hï¼ void openlog(const char*ident,int logopt,int facility) identå‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²å°†è¢«æ·»åŠ åˆ°æ—¥å¿—æ¶ˆæ¯çš„æ—¥æœŸå’Œæ—¶é—´ä¹‹åï¼Œå®ƒé€šå¸¸è¢«è®¾ç½®ä¸ºç¨‹åºçš„åå­—ã€‚logoptå‚æ•°å¯¹åç»­syslogè°ƒç”¨çš„è¡Œä¸ºè¿›è¡Œé…ç½®ï¼Œå®ƒå¯å–ä¸‹åˆ—å€¼çš„æŒ‰ä½æˆ–ï¼š 1234#define LOG_PID 0x01/*åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­åŒ…å«ç¨‹åºPID*/#define LOG_CONS 0x02/*å¦‚æœæ¶ˆæ¯ä¸èƒ½è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œåˆ™æ‰“å°è‡³ç»ˆç«¯*/#define LOG_ODELAY 0x04/*å»¶è¿Ÿæ‰“å¼€æ—¥å¿—åŠŸèƒ½ç›´åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨syslog*/#define LOG_NDELAY 0x08/*ä¸å»¶è¿Ÿæ‰“å¼€æ—¥å¿—åŠŸèƒ½*/ facilityå‚æ•°å¯ç”¨æ¥ä¿®æ”¹syslogå‡½æ•°ä¸­çš„é»˜è®¤è®¾æ–½å€¼ã€‚ æ­¤å¤–ï¼Œæ—¥å¿—çš„è¿‡æ»¤ä¹Ÿå¾ˆé‡è¦ã€‚ç¨‹åºåœ¨å¼€å‘é˜¶æ®µå¯èƒ½éœ€è¦è¾“å‡ºå¾ˆå¤šè°ƒè¯•ä¿¡æ¯ï¼Œè€Œå‘å¸ƒä¹‹åæˆ‘ä»¬åˆéœ€è¦å°†è¿™äº›è°ƒè¯•ä¿¡æ¯å…³é—­ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å¹¶ä¸æ˜¯åœ¨ç¨‹åºå‘å¸ƒä¹‹ååˆ é™¤è°ƒè¯•ä»£ç ï¼ˆå› ä¸ºæ—¥åå¯èƒ½è¿˜éœ€è¦ç”¨åˆ°ï¼‰ï¼Œè€Œæ˜¯ç®€å•åœ°è®¾ç½®æ—¥å¿—æ©ç ï¼Œä½¿æ—¥å¿—çº§åˆ«å¤§äºæ—¥å¿—æ©ç çš„æ—¥å¿—ä¿¡æ¯è¢«ç³»ç»Ÿå¿½ç•¥ã€‚ä¸‹é¢è¿™ä¸ªå‡½æ•°ç”¨äºè®¾ç½®syslogçš„æ—¥å¿—æ©ç ï¼š #includeï¼œsyslog.hï¼ int setlogmask(int maskpri); maskpriå‚æ•°æŒ‡å®šæ—¥å¿—æ©ç å€¼ã€‚è¯¥å‡½æ•°å§‹ç»ˆä¼šæˆåŠŸï¼Œå®ƒè¿”å›è°ƒç”¨è¿›ç¨‹å…ˆå‰çš„æ—¥å¿—æ©ç å€¼ã€‚æœ€åï¼Œä¸è¦å¿˜äº†ä½¿ç”¨å¦‚ä¸‹å‡½æ•°å…³é—­æ—¥å¿—åŠŸèƒ½ï¼š #includeï¼œsyslog.hï¼ void closelog(); é«˜æ€§èƒ½æœåŠ¡å™¨ç¨‹åºæ¡†æ¶ I&#x2F;Oå¤„ç†å•å…ƒã€‚æœ¬ç« å°†ä»‹ç»I&#x2F;Oå¤„ç†å•å…ƒçš„å››ç§I&#x2F;Oæ¨¡å‹å’Œä¸¤ç§é«˜æ•ˆäº‹ä»¶å¤„ç†æ¨¡å¼ é€»è¾‘å•å…ƒã€‚æœ¬ç« å°†ä»‹ç»é€»è¾‘å•å…ƒçš„ä¸¤ç§é«˜æ•ˆå¹¶å‘æ¨¡å¼ï¼Œä»¥åŠé«˜æ•ˆçš„é€»è¾‘å¤„ç†æ–¹å¼â€”â€”æœ‰é™çŠ¶æ€æœº å­˜å‚¨å•å…ƒã€‚æœ¬ä¹¦ä¸è®¨è®ºå­˜å‚¨å•å…ƒï¼Œå› ä¸ºå®ƒåªæ˜¯æœåŠ¡å™¨ç¨‹åºçš„å¯é€‰æ¨¡å—ï¼Œè€Œä¸”å…¶å†…å®¹ä¸ç½‘ç»œç¼–ç¨‹æœ¬èº«æ— å…³ æœåŠ¡å™¨æ¨¡å‹C&#x2F;Sæ¨¡å‹ æœåŠ¡å™¨å¯åŠ¨åï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç›‘å¬socketï¼Œå¹¶è°ƒç”¨bindå‡½æ•°å°†å…¶ç»‘å®šåˆ°æœåŠ¡å™¨æ„Ÿå…´è¶£çš„ç«¯å£ä¸Šï¼Œç„¶åè°ƒç”¨listenå‡½æ•°ç­‰å¾…å®¢æˆ·è¿æ¥ã€‚ æœåŠ¡å™¨ç¨³å®šè¿è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥è°ƒç”¨connectå‡½æ•°å‘æœåŠ¡å™¨å‘èµ·è¿æ¥äº†ã€‚ ç”±äºå®¢æˆ·è¿æ¥è¯·æ±‚æ˜¯éšæœºåˆ°è¾¾çš„å¼‚æ­¥äº‹ä»¶ï¼ŒæœåŠ¡å™¨éœ€è¦ä½¿ç”¨æŸç§I&#x2F;Oæ¨¡å‹æ¥ç›‘å¬è¿™ä¸€äº‹ä»¶ã€‚I&#x2F;Oæ¨¡å‹æœ‰å¤šç§ï¼Œå›¾8-2ä¸­ï¼ŒæœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯I&#x2F;Oå¤ç”¨æŠ€æœ¯ä¹‹ä¸€çš„selectç³»ç»Ÿè°ƒç”¨ã€‚å½“ç›‘å¬åˆ°è¿æ¥è¯·æ±‚åï¼ŒæœåŠ¡å™¨å°±è°ƒç”¨acceptå‡½æ•°æ¥å—å®ƒï¼Œå¹¶åˆ†é…ä¸€ä¸ªé€»è¾‘å•å…ƒä¸ºæ–°çš„è¿æ¥æœåŠ¡ã€‚é€»è¾‘å•å…ƒå¯ä»¥æ˜¯æ–°åˆ›å»ºçš„å­è¿›ç¨‹ã€å­çº¿ç¨‹æˆ–è€…å…¶ä»–ã€‚å›¾8-2ä¸­ï¼ŒæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯åˆ†é…çš„é€»è¾‘å•å…ƒæ˜¯ç”±forkç³»ç»Ÿè°ƒç”¨åˆ›å»ºçš„å­è¿›ç¨‹ã€‚é€»è¾‘å•å…ƒè¯»å–å®¢æˆ·è¯·æ±‚ï¼Œå¤„ç†è¯¥è¯·æ±‚ï¼Œç„¶åå°†å¤„ç†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ æœåŠ¡å™¨åœ¨å¤„ç†ä¸€ä¸ªå®¢æˆ·è¯·æ±‚çš„åŒæ—¶è¿˜ä¼šç»§ç»­ç›‘å¬å…¶ä»–å®¢æˆ·è¯·æ±‚ï¼Œå¦åˆ™å°±å˜æˆäº†æ•ˆç‡ä½ä¸‹çš„ä¸²è¡ŒæœåŠ¡å™¨äº†å›¾8-2ä¸­ï¼ŒæœåŠ¡å™¨åŒæ—¶ç›‘å¬å¤šä¸ªå®¢æˆ·è¯·æ±‚æ˜¯é€šè¿‡selectç³»ç»Ÿè°ƒç”¨å®ç°çš„ã€‚ C&#x2F;Sæ¨¡å‹éå¸¸é€‚åˆèµ„æºç›¸å¯¹é›†ä¸­çš„åœºåˆï¼Œå¹¶ä¸”å®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œä½†å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæœåŠ¡å™¨æ˜¯é€šä¿¡çš„ä¸­å¿ƒï¼Œå½“è®¿é—®é‡è¿‡å¤§æ—¶ï¼Œå¯èƒ½æ‰€æœ‰å®¢æˆ·éƒ½å°†å¾—åˆ°å¾ˆæ…¢çš„å“åº”ã€‚ä¸‹é¢è®¨è®ºçš„P2Pæ¨¡å‹è§£å†³äº†è¿™ä¸ªé—®é¢˜ ####P2Pæ¨¡å‹ P2Pï¼ˆPeer to Peerï¼Œç‚¹å¯¹ç‚¹ï¼‰æ¨¡å‹æ¯”C&#x2F;Sæ¨¡å‹æ›´ç¬¦åˆç½‘ç»œé€šä¿¡çš„å®é™…æƒ…å†µã€‚å®ƒæ‘’å¼ƒäº†ä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„æ ¼å±€ï¼Œè®©ç½‘ç»œä¸Šæ‰€æœ‰ä¸»æœºé‡æ–°å›å½’å¯¹ç­‰çš„åœ°ä½ã€‚ P2Pæ¨¡å‹å¦‚å›¾8-3aæ‰€ç¤ºã€‚P2Pæ¨¡å‹ä½¿å¾—æ¯å°æœºå™¨åœ¨æ¶ˆè€—æœåŠ¡çš„åŒæ—¶ä¹Ÿç»™åˆ«äººæä¾›æœåŠ¡ï¼Œè¿™æ ·èµ„æºèƒ½å¤Ÿå……åˆ†ã€è‡ªç”±åœ°å…±äº«ã€‚äº‘è®¡ç®—æœºç¾¤å¯ä»¥çœ‹ä½œP2Pæ¨¡å‹çš„ä¸€ä¸ªå…¸èŒƒã€‚ä½†P2Pæ¨¡å‹çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šå½“ç”¨æˆ·ä¹‹é—´ä¼ è¾“çš„è¯·æ±‚è¿‡å¤šæ—¶ï¼Œç½‘ç»œçš„è´Ÿè½½å°†åŠ é‡ã€‚ å›¾8-3aæ‰€ç¤ºçš„P2Pæ¨¡å‹å­˜åœ¨ä¸€ä¸ªæ˜¾è‘—çš„é—®é¢˜ï¼Œå³ä¸»æœºä¹‹é—´å¾ˆéš¾äº’ç›¸å‘ç°ã€‚æ‰€ä»¥å®é™…ä½¿ç”¨çš„P2Pæ¨¡å‹é€šå¸¸å¸¦æœ‰ä¸€ä¸ªä¸“é—¨çš„å‘ç°æœåŠ¡å™¨ï¼Œå¦‚å›¾8-3bæ‰€ç¤ºã€‚è¿™ä¸ªå‘ç°æœåŠ¡å™¨é€šå¸¸è¿˜æä¾›æŸ¥æ‰¾æœåŠ¡ï¼ˆç”šè‡³è¿˜å¯ä»¥æä¾›å†…å®¹æœåŠ¡ï¼‰ï¼Œä½¿æ¯ä¸ªå®¢æˆ·éƒ½èƒ½å°½å¿«åœ°æ‰¾åˆ°è‡ªå·±éœ€è¦çš„èµ„æºã€‚ ä»ç¼–ç¨‹è§’åº¦æ¥è®²ï¼ŒP2Pæ¨¡å‹å¯ä»¥çœ‹ä½œC&#x2F;Sæ¨¡å‹çš„æ‰©å±•ï¼šæ¯å°ä¸»æœºæ—¢æ˜¯å®¢æˆ·ç«¯ï¼Œåˆæ˜¯æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶é‡‡ç”¨C&#x2F;Sæ¨¡å‹æ¥è®¨è®ºç½‘ç»œç¼–ç¨‹ æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶ è¯¥å›¾æ—¢èƒ½ç”¨æ¥æè¿°ä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿèƒ½ç”¨æ¥æè¿°ä¸€ä¸ªæœåŠ¡å™¨æœºç¾¤ æ¨¡å— å•ä¸ªæœåŠ¡å™¨ æœåŠ¡å™¨é›†ç¾¤ I&#x2F;Oå¤„ç†å•å…ƒ å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œè¯»å†™ç½‘ç»œæ•°æ® ä½œä¸ºæ¥å…¥æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ é€»è¾‘å•å…ƒ ä¸šåŠ¡è¿›ç¨‹ï¼Œçº¿ç¨‹ é€»è¾‘æœåŠ¡å™¨ ç½‘ç»œå­˜å‚¨å•å…ƒ æœ¬åœ°æ•°æ®åº“ï¼Œæ–‡ä»¶ï¼Œç¼“å­˜ æ•°æ®åº“æœåŠ¡å™¨ è¯·æ±‚é˜Ÿåˆ— å„å•å…ƒä¹‹é—´é€šä¿¡æ–¹å¼ å„æœåŠ¡å™¨ä¹‹é—´æ°¸ä¹…tcpè¿æ¥ è´Ÿè½½å‡è¡¡ï¼Œä»æ‰€æœ‰é€»è¾‘æœåŠ¡å™¨ä¸­é€‰å–è´Ÿè·æœ€å°çš„ä¸€å°æ¥ä¸ºæ–°å®¢æˆ·æœåŠ¡ã€‚ æœåŠ¡å™¨é€šå¸¸æ‹¥æœ‰å¤šä¸ªé€»è¾‘å•å…ƒï¼Œä»¥å®ç°å¯¹å¤šä¸ªå®¢æˆ·ä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ã€‚ ç½‘ç»œå­˜å‚¨å•å…ƒä¸æ˜¯å¿…é¡»çš„ï¼Œæ¯”å¦‚sshã€telnetç­‰ç™»å½•æœåŠ¡å°±ä¸éœ€è¦è¿™ä¸ªå•å…ƒ è¯·æ±‚é˜Ÿåˆ—æ˜¯å„å•å…ƒä¹‹é—´çš„é€šä¿¡æ–¹å¼çš„æŠ½è±¡ã€‚I&#x2F;Oå¤„ç†å•å…ƒæ¥æ”¶åˆ°å®¢æˆ·è¯·æ±‚æ—¶ï¼Œéœ€è¦ä»¥æŸç§æ–¹å¼é€šçŸ¥ä¸€ä¸ªé€»è¾‘å•å…ƒæ¥å¤„ç†è¯¥è¯·æ±‚ã€‚åŒæ ·ï¼Œå¤šä¸ªé€»è¾‘å•å…ƒåŒæ—¶è®¿é—®ä¸€ä¸ªå­˜å‚¨å•å…ƒæ—¶ï¼Œä¹Ÿéœ€è¦é‡‡ç”¨æŸç§æœºåˆ¶æ¥åè°ƒå¤„ç†ç«æ€æ¡ä»¶ã€‚è¯·æ±‚é˜Ÿåˆ—é€šå¸¸è¢«å®ç°ä¸ºæ± çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæœåŠ¡å™¨æœºç¾¤è€Œè¨€ï¼Œè¯·æ±‚é˜Ÿåˆ—æ˜¯å„å°æœåŠ¡å™¨ä¹‹é—´é¢„å…ˆå»ºç«‹çš„ã€é™æ€çš„ã€æ°¸ä¹…çš„TCPè¿æ¥ã€‚è¿™ç§TCPè¿æ¥èƒ½æé«˜æœåŠ¡å™¨ä¹‹é—´äº¤æ¢æ•°æ®çš„æ•ˆç‡ï¼Œå› ä¸ºå®ƒé¿å…äº†åŠ¨æ€å»ºç«‹TCPè¿æ¥å¯¼è‡´çš„é¢å¤–çš„ç³»ç»Ÿå¼€é”€ã€‚ I&#x2F;Oæ¨¡å‹socketåœ¨åˆ›å»ºçš„æ—¶å€™é»˜è®¤æ˜¯é˜»å¡çš„ã€‚æˆ‘ä»¬å¯ä»¥ç»™socketç³»ç»Ÿè°ƒç”¨çš„ç¬¬2ä¸ªå‚æ•°ä¼ é€’SOCK_NONBLOCKæ ‡å¿—ï¼Œæˆ–è€…é€šè¿‡fcntlç³»ç»Ÿè°ƒç”¨çš„F_SETFLå‘½ä»¤ï¼Œå°†å…¶è®¾ç½®ä¸ºéé˜»å¡çš„ã€‚é˜»å¡å’Œéé˜»å¡çš„æ¦‚å¿µèƒ½åº”ç”¨äºæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œä¸ä»…ä»…æ˜¯socketã€‚æˆ‘ä»¬ç§°é˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ä¸ºé˜»å¡I&#x2F;Oï¼Œç§°éé˜»å¡çš„æ–‡ä»¶æè¿°ç¬¦ä¸ºéé˜»å¡I&#x2F;Oã€‚ é’ˆå¯¹é˜»å¡I&#x2F;Oæ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨å¯èƒ½å› ä¸ºæ— æ³•ç«‹å³å®Œæˆè€Œè¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ï¼Œç›´åˆ°ç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿä¸ºæ­¢ã€‚socketçš„åŸºç¡€APIä¸­ï¼Œå¯èƒ½è¢«é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨åŒ…æ‹¬acceptã€sendã€recvå’Œconnectã€‚ é’ˆå¯¹éé˜»å¡I&#x2F;Oæ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨åˆ™æ€»æ˜¯ç«‹å³è¿”å›ï¼Œè€Œä¸ç®¡äº‹ä»¶æ˜¯å¦å·²ç»å‘ç”Ÿã€‚å¦‚æœäº‹ä»¶æ²¡æœ‰ç«‹å³å‘ç”Ÿï¼Œè¿™äº›ç³»ç»Ÿè°ƒç”¨å°±è¿”å›-1ï¼Œå’Œå‡ºé”™çš„æƒ…å†µä¸€æ ·ã€‚æ­¤æ—¶æˆ‘ä»¬å¿…é¡»æ ¹æ®errnoæ¥åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µã€‚å¯¹acceptã€sendå’Œrecvè€Œè¨€ï¼Œäº‹ä»¶æœªå‘ç”Ÿæ—¶errnoé€šå¸¸è¢«è®¾ç½®æˆEAGAINï¼ˆæ„ä¸ºâ€œå†æ¥ä¸€æ¬¡â€ï¼‰æˆ–è€…EWOULDBLOCKï¼ˆæ„ä¸ºâ€œæœŸæœ›é˜»å¡â€ï¼‰ï¼›å¯¹connectè€Œè¨€ï¼Œerrnoåˆ™è¢«è®¾ç½®æˆEINPROGRESSï¼ˆæ„ä¸ºâ€œåœ¨å¤„ç†ä¸­â€ï¼‰ã€‚å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬åªæœ‰åœ¨äº‹ä»¶å·²ç»å‘ç”Ÿçš„æƒ…å†µä¸‹æ“ä½œéé˜»å¡I&#x2F;Oï¼ˆè¯»ã€å†™ç­‰ï¼‰ï¼Œæ‰èƒ½æé«˜ç¨‹åºçš„æ•ˆç‡ã€‚å› æ­¤ï¼Œéé˜»å¡I&#x2F;Oé€šå¸¸è¦å’Œå…¶ä»–I&#x2F;Oé€šçŸ¥æœºåˆ¶ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚I&#x2F;Oå¤ç”¨å’ŒSIGIOä¿¡å·ã€‚ I&#x2F;Oå¤ç”¨æ˜¯æœ€å¸¸ä½¿ç”¨çš„I&#x2F;Oé€šçŸ¥æœºåˆ¶ã€‚å®ƒæŒ‡çš„æ˜¯ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡I&#x2F;Oå¤ç”¨å‡½æ•°å‘å†…æ ¸æ³¨å†Œä¸€ç»„äº‹ä»¶ï¼Œå†…æ ¸é€šè¿‡I&#x2F;Oå¤ç”¨å‡½æ•°æŠŠå…¶ä¸­å°±ç»ªçš„äº‹ä»¶é€šçŸ¥ç»™åº”ç”¨ç¨‹åºã€‚Linuxä¸Šå¸¸ç”¨çš„I&#x2F;Oå¤ç”¨å‡½æ•°æ˜¯selectã€pollå’Œepoll_waitã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒI&#x2F;Oå¤ç”¨å‡½æ•°æœ¬èº«æ˜¯é˜»å¡çš„ï¼Œå®ƒä»¬èƒ½æé«˜ç¨‹åºæ•ˆç‡çš„åŸå› åœ¨äºå®ƒä»¬å…·æœ‰åŒæ—¶ç›‘å¬å¤šä¸ªI&#x2F;Oäº‹ä»¶çš„èƒ½åŠ›ã€‚ SIGIOä¿¡å·ä¹Ÿå¯ä»¥ç”¨æ¥æŠ¥å‘ŠI&#x2F;Oäº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶æè¿°ç¬¦æŒ‡å®šå®¿ä¸»è¿›ç¨‹ï¼Œé‚£ä¹ˆè¢«æŒ‡å®šçš„å®¿ä¸»è¿›ç¨‹å°†æ•è·åˆ°SIGIOä¿¡å·ã€‚è¿™æ ·ï¼Œå½“ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSIGIOä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°å°†è¢«è§¦å‘ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥åœ¨è¯¥ä¿¡å·å¤„ç†å‡½æ•°ä¸­å¯¹ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦æ‰§è¡Œéé˜»å¡I&#x2F;Oæ“ä½œäº†ã€‚ ä»ç†è®ºä¸Šè¯´ï¼Œé˜»å¡I&#x2F;Oã€I&#x2F;Oå¤ç”¨å’Œä¿¡å·é©±åŠ¨I&#x2F;Oéƒ½æ˜¯åŒæ­¥I&#x2F;Oæ¨¡å‹ã€‚å› ä¸ºåœ¨è¿™ä¸‰ç§I&#x2F;Oæ¨¡å‹ä¸­ï¼ŒI&#x2F;Oçš„è¯»å†™æ“ä½œï¼Œéƒ½æ˜¯åœ¨I&#x2F;Oäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œç”±åº”ç”¨ç¨‹åºæ¥å®Œæˆçš„ã€‚è€ŒPOSIXè§„èŒƒæ‰€å®šä¹‰çš„å¼‚æ­¥I&#x2F;Oæ¨¡å‹åˆ™ä¸åŒã€‚å¯¹å¼‚æ­¥I&#x2F;Oè€Œè¨€ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥å¯¹I&#x2F;Oæ‰§è¡Œè¯»å†™æ“ä½œï¼Œè¿™äº›æ“ä½œå‘Šè¯‰å†…æ ¸ç”¨æˆ·è¯»å†™ç¼“å†²åŒºçš„ä½ç½®ï¼Œä»¥åŠI&#x2F;Oæ“ä½œå®Œæˆä¹‹åå†…æ ¸é€šçŸ¥åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚å¼‚æ­¥I&#x2F;Oçš„è¯»å†™æ“ä½œæ€»æ˜¯ç«‹å³è¿”å›ï¼Œè€Œä¸è®ºI&#x2F;Oæ˜¯å¦æ˜¯é˜»å¡çš„ï¼Œå› ä¸ºçœŸæ­£çš„è¯»å†™æ“ä½œå·²ç»ç”±å†…æ ¸æ¥ç®¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ­¥I&#x2F;Oæ¨¡å‹è¦æ±‚ç”¨æˆ·ä»£ç è‡ªè¡Œæ‰§è¡ŒI&#x2F;Oæ“ä½œï¼ˆå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºè¯»å…¥ç”¨æˆ·ç¼“å†²åŒºï¼Œæˆ–å°†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºå†™å…¥å†…æ ¸ç¼“å†²åŒºï¼‰ï¼Œè€Œå¼‚æ­¥I&#x2F;Oæœºåˆ¶åˆ™ç”±å†…æ ¸æ¥æ‰§è¡ŒI&#x2F;Oæ“ä½œï¼ˆæ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„ç§»åŠ¨æ˜¯ç”±å†…æ ¸åœ¨â€œåå°â€å®Œæˆçš„ï¼‰ã€‚ä½ å¯ä»¥è¿™æ ·è®¤ä¸ºï¼ŒåŒæ­¥I&#x2F;Oå‘åº”ç”¨ç¨‹åºé€šçŸ¥çš„æ˜¯I&#x2F;Oå°±ç»ªäº‹ä»¶ï¼Œè€Œå¼‚æ­¥I&#x2F;Oå‘åº”ç”¨ç¨‹åºé€šçŸ¥çš„æ˜¯I&#x2F;Oå®Œæˆäº‹ä»¶ã€‚Linuxç¯å¢ƒä¸‹ï¼Œaio.hå¤´æ–‡ä»¶ä¸­å®šä¹‰çš„å‡½æ•°æä¾›äº†å¯¹å¼‚æ­¥I&#x2F;Oçš„æ”¯æŒã€‚ä¸è¿‡è¿™éƒ¨åˆ†å†…å®¹ä¸æ˜¯æœ¬ä¹¦çš„é‡ç‚¹ï¼Œæ‰€ä»¥åªåšç®€å•çš„è®¨è®º ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼æœåŠ¡å™¨ç¨‹åºé€šå¸¸éœ€è¦å¤„ç†ä¸‰ç±»äº‹ä»¶ï¼šI&#x2F;Oäº‹ä»¶ã€ä¿¡å·åŠå®šæ—¶äº‹ä»¶ã€‚ ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼ï¼šReactorå’ŒProactorã€‚ åŒæ­¥I&#x2F;Oæ¨¡å‹é€šå¸¸ç”¨äºå®ç°Reactoræ¨¡å¼ï¼Œå¼‚æ­¥I&#x2F;Oæ¨¡å‹åˆ™ç”¨äºå®ç°Proactoræ¨¡å¼ã€‚ Reactoræ¨¡å¼ä¸»çº¿ç¨‹ï¼ˆI&#x2F;Oå¤„ç†å•å…ƒï¼‰åªè´Ÿè´£ç›‘å¬æ–‡ä»¶æè¿°ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæœ‰çš„è¯å°±ç«‹å³å°†è¯¥äº‹ä»¶é€šçŸ¥å·¥ä½œçº¿ç¨‹ï¼ˆé€»è¾‘å•å…ƒï¼Œä¸‹åŒï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸»çº¿ç¨‹ä¸åšä»»ä½•å…¶ä»–å®è´¨æ€§çš„å·¥ä½œã€‚è¯»å†™æ•°æ®ï¼Œæ¥å—æ–°çš„è¿æ¥ï¼Œä»¥åŠå¤„ç†å®¢æˆ·è¯·æ±‚å‡åœ¨å·¥ä½œçº¿ç¨‹ä¸­å®Œæˆã€‚ ä½¿ç”¨åŒæ­¥I&#x2F;Oæ¨¡å‹ï¼ˆä»¥epoll_waitä¸ºä¾‹ï¼‰å®ç°çš„Reactoræ¨¡å¼çš„å·¥ä½œæµç¨‹æ˜¯ï¼š 1ï¼‰ä¸»çº¿ç¨‹å¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œsocketä¸Šçš„è¯»å°±ç»ªäº‹ä»¶ã€‚ 2ï¼‰ä¸»çº¿ç¨‹è°ƒç”¨epoll_waitç­‰å¾…socketä¸Šæœ‰æ•°æ®å¯è¯»ã€‚ 3ï¼‰å½“socketä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œepoll_waité€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹åˆ™å°†socketå¯è¯»äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚ 4ï¼‰ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒä»socketè¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶åå¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œè¯¥socketä¸Šçš„å†™å°±ç»ªäº‹ä»¶ã€‚ 5ï¼‰ä¸»çº¿ç¨‹è°ƒç”¨epoll_waitç­‰å¾…socketå¯å†™ã€‚ 6ï¼‰å½“socketå¯å†™æ—¶ï¼Œepoll_waité€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å°†socketå¯å†™äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚ 7ï¼‰ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒå¾€socketä¸Šå†™å…¥æœåŠ¡å™¨å¤„ç†å®¢æˆ·è¯·æ±‚çš„ç»“æœ å·¥ä½œçº¿ç¨‹ä»è¯·æ±‚é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶åï¼Œå°†æ ¹æ®äº‹ä»¶çš„ç±»å‹æ¥å†³å®šå¦‚ä½•å¤„ç†å®ƒï¼šå¯¹äºå¯è¯»äº‹ä»¶ï¼Œæ‰§è¡Œè¯»æ•°æ®å’Œå¤„ç†è¯·æ±‚çš„æ“ä½œï¼›å¯¹äºå¯å†™äº‹ä»¶ï¼Œæ‰§è¡Œå†™æ•°æ®çš„æ“ä½œã€‚å› æ­¤ï¼Œæ‰€ç¤ºçš„Reactoræ¨¡å¼ä¸­ï¼Œæ²¡å¿…è¦åŒºåˆ†æ‰€è°“çš„â€œè¯»å·¥ä½œçº¿ç¨‹â€å’Œâ€œå†™å·¥ä½œçº¿ç¨‹â€ã€‚ Proactoræ¨¡å¼ä¸Reactoræ¨¡å¼ä¸åŒï¼ŒProactoræ¨¡å¼å°†æ‰€æœ‰I&#x2F;Oæ“ä½œéƒ½äº¤ç»™ä¸»çº¿ç¨‹å’Œå†…æ ¸æ¥å¤„ç†ï¼Œå·¥ä½œçº¿ç¨‹ä»…ä»…è´Ÿè´£ä¸šåŠ¡é€»è¾‘ã€‚Proactoræ¨¡å¼æ›´ç¬¦åˆæœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶ã€‚ ä½¿ç”¨å¼‚æ­¥I&#x2F;Oæ¨¡å‹ï¼ˆä»¥aio_readå’Œaio_writeä¸ºä¾‹ï¼‰å®ç°çš„Proactoræ¨¡å¼çš„å·¥ä½œæµç¨‹æ˜¯ï¼š 1ï¼‰ä¸»çº¿ç¨‹è°ƒç”¨aio_readå‡½æ•°å‘å†…æ ¸æ³¨å†Œsocketä¸Šçš„è¯»å®Œæˆäº‹ä»¶ï¼Œå¹¶å‘Šè¯‰å†…æ ¸ç”¨æˆ·è¯»ç¼“å†²åŒºçš„ä½ç½®ï¼Œä»¥åŠè¯»æ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥åº”ç”¨ç¨‹åºï¼ˆè¿™é‡Œä»¥ä¿¡å·ä¸ºä¾‹ï¼Œè¯¦æƒ…è¯·å‚è€ƒsigeventçš„manæ‰‹å†Œï¼‰ã€‚ 2ï¼‰ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–é€»è¾‘ã€‚ 3ï¼‰å½“socketä¸Šçš„æ•°æ®è¢«è¯»å…¥ç”¨æˆ·ç¼“å†²åŒºåï¼Œå†…æ ¸å°†å‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å·²ç»å¯ç”¨ã€‚ 4ï¼‰åº”ç”¨ç¨‹åºé¢„å…ˆå®šä¹‰å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°é€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†å®¢æˆ·è¯·æ±‚ã€‚å·¥ä½œçº¿ç¨‹å¤„ç†å®Œå®¢æˆ·è¯·æ±‚ä¹‹åï¼Œè°ƒç”¨aio_writeå‡½æ•°å‘å†…æ ¸æ³¨å†Œsocketä¸Šçš„å†™å®Œæˆäº‹ä»¶ï¼Œå¹¶å‘Šè¯‰å†…æ ¸ç”¨æˆ·å†™ç¼“å†²åŒºçš„ä½ç½®ï¼Œä»¥åŠå†™æ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥åº”ç”¨ç¨‹åºï¼ˆä»ç„¶ä»¥ä¿¡å·ä¸ºä¾‹ï¼‰ã€‚ 5ï¼‰ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–é€»è¾‘ã€‚ 6ï¼‰å½“ç”¨æˆ·ç¼“å†²åŒºçš„æ•°æ®è¢«å†™å…¥socketä¹‹åï¼Œå†…æ ¸å°†å‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å·²ç»å‘é€å®Œæ¯•ã€‚ 7ï¼‰åº”ç”¨ç¨‹åºé¢„å…ˆå®šä¹‰å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°é€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥åšå–„åå¤„ç†ï¼Œæ¯”å¦‚å†³å®šæ˜¯å¦å…³é—­socketã€‚ è¿æ¥socketä¸Šçš„è¯»å†™äº‹ä»¶æ˜¯é€šè¿‡aio_read&#x2F;aio_writeå‘å†…æ ¸æ³¨å†Œçš„ï¼Œå› æ­¤å†…æ ¸å°†é€šè¿‡ä¿¡å·æ¥å‘åº”ç”¨ç¨‹åºæŠ¥å‘Šè¿æ¥socketä¸Šçš„è¯»å†™äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œä¸»çº¿ç¨‹ä¸­çš„epoll_waitè°ƒç”¨ä»…èƒ½ç”¨æ¥æ£€æµ‹ç›‘å¬socketä¸Šçš„è¿æ¥è¯·æ±‚äº‹ä»¶ï¼Œè€Œä¸èƒ½ç”¨æ¥æ£€æµ‹è¿æ¥socketä¸Šçš„è¯»å†™äº‹ä»¶ã€‚ æ¨¡æ‹ŸProactoræ¨¡å¼ä½¿ç”¨åŒæ­¥I&#x2F;Oæ–¹å¼æ¨¡æ‹Ÿå‡ºProactoræ¨¡å¼çš„ä¸€ç§æ–¹æ³•ã€‚å…¶åŸç†æ˜¯ï¼šä¸»çº¿ç¨‹æ‰§è¡Œæ•°æ®è¯»å†™æ“ä½œï¼Œè¯»å†™å®Œæˆä¹‹åï¼Œä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹é€šçŸ¥è¿™ä¸€â€œå®Œæˆäº‹ä»¶â€ã€‚é‚£ä¹ˆä»å·¥ä½œçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬å°±ç›´æ¥è·å¾—äº†æ•°æ®è¯»å†™çš„ç»“æœï¼Œæ¥ä¸‹æ¥è¦åšçš„åªæ˜¯å¯¹è¯»å†™çš„ç»“æœè¿›è¡Œé€»è¾‘å¤„ç†ã€‚ ä½¿ç”¨åŒæ­¥I&#x2F;Oæ¨¡å‹ï¼ˆä»ç„¶ä»¥epoll_waitä¸ºä¾‹ï¼‰æ¨¡æ‹Ÿå‡ºçš„Proactoræ¨¡å¼çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š 1ï¼‰ä¸»çº¿ç¨‹å¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œsocketä¸Šçš„è¯»å°±ç»ªäº‹ä»¶ã€‚ 2ï¼‰ä¸»çº¿ç¨‹è°ƒç”¨epoll_waitç­‰å¾…socketä¸Šæœ‰æ•°æ®å¯è¯»ã€‚ 3ï¼‰å½“socketä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œepoll_waité€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹ä»socketå¾ªç¯è¯»å–æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œç„¶åå°†è¯»å–åˆ°çš„æ•°æ®å°è£…æˆä¸€ä¸ªè¯·æ±‚å¯¹è±¡å¹¶æ’å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚ 4ï¼‰ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒè·å¾—è¯·æ±‚å¯¹è±¡å¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶åå¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œsocketä¸Šçš„å†™å°±ç»ªäº‹ä»¶ã€‚ 5ï¼‰ä¸»çº¿ç¨‹è°ƒç”¨epoll_waitç­‰å¾…socketå¯å†™ã€‚ 6ï¼‰å½“socketå¯å†™æ—¶ï¼Œepoll_waité€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å¾€socketä¸Šå†™å…¥æœåŠ¡å™¨å¤„ç†å®¢æˆ·è¯·æ±‚çš„ç»“æœã€‚ ä¸¤ç§é«˜æ•ˆçš„å¹¶å‘æ¨¡å¼å¹¶å‘ç¼–ç¨‹çš„ç›®çš„æ˜¯è®©ç¨‹åºâ€œåŒæ—¶â€æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚å¦‚æœç¨‹åºæ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œå¹¶å‘ç¼–ç¨‹å¹¶æ²¡æœ‰ä¼˜åŠ¿ï¼Œåè€Œç”±äºä»»åŠ¡çš„åˆ‡æ¢ä½¿æ•ˆç‡é™ä½ã€‚ ä½†å¦‚æœç¨‹åºæ˜¯I&#x2F;Oå¯†é›†å‹çš„ï¼Œæ¯”å¦‚ç»å¸¸è¯»å†™æ–‡ä»¶ï¼Œè®¿é—®æ•°æ®åº“ç­‰ï¼Œåˆ™æƒ…å†µå°±ä¸åŒäº†ã€‚ç”±äºI&#x2F;Oæ“ä½œçš„é€Ÿåº¦è¿œæ²¡æœ‰CPUçš„è®¡ç®—é€Ÿåº¦å¿«ï¼Œæ‰€ä»¥è®©ç¨‹åºé˜»å¡äºI&#x2F;Oæ“ä½œå°†æµªè´¹å¤§é‡çš„CPUæ—¶é—´ã€‚ å¹¶å‘ç¼–ç¨‹ä¸»è¦æœ‰å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ä¸¤ç§æ–¹å¼ï¼Œè¿™ä¸€èŠ‚å…ˆè®¨è®ºå¹¶å‘æ¨¡å¼ã€‚ æœåŠ¡å™¨ä¸»è¦æœ‰ä¸¤ç§å¹¶å‘ç¼–ç¨‹æ¨¡å¼ï¼šåŠåŒæ­¥&#x2F;åŠå¼‚æ­¥ï¼ˆhalf-sync&#x2F;halfasyncï¼‰æ¨¡å¼å’Œé¢†å¯¼è€…&#x2F;è¿½éšè€…ï¼ˆLeader&#x2F;Followersï¼‰æ¨¡å¼ã€‚ åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼åœ¨I&#x2F;Oæ¨¡å‹ä¸­ï¼Œâ€œåŒæ­¥â€å’Œâ€œå¼‚æ­¥â€åŒºåˆ†çš„æ˜¯å†…æ ¸å‘åº”ç”¨ç¨‹åºé€šçŸ¥çš„æ˜¯ä½•ç§I&#x2F;Oäº‹ä»¶ï¼ˆæ˜¯å°±ç»ªäº‹ä»¶è¿˜æ˜¯å®Œæˆäº‹ä»¶ï¼‰ï¼Œä»¥åŠè¯¥ç”±è°æ¥å®ŒæˆI&#x2F;Oè¯»å†™ï¼ˆæ˜¯åº”ç”¨ç¨‹åºè¿˜æ˜¯å†…æ ¸ï¼‰ã€‚ åœ¨å¹¶å‘æ¨¡å¼ä¸­ï¼Œâ€œåŒæ­¥â€æŒ‡çš„æ˜¯ç¨‹åºå®Œå…¨æŒ‰ç…§ä»£ç åºåˆ—çš„é¡ºåºæ‰§è¡Œï¼›â€œå¼‚æ­¥â€æŒ‡çš„æ˜¯ç¨‹åºçš„æ‰§è¡Œéœ€è¦ç”±ç³»ç»Ÿäº‹ä»¶æ¥é©±åŠ¨ã€‚å¸¸è§çš„ç³»ç»Ÿäº‹ä»¶åŒ…æ‹¬ä¸­æ–­ã€ä¿¡å·ç­‰ã€‚ æŒ‰ç…§åŒæ­¥æ–¹å¼è¿è¡Œçš„çº¿ç¨‹ç§°ä¸ºåŒæ­¥çº¿ç¨‹ï¼ŒæŒ‰ç…§å¼‚æ­¥æ–¹å¼è¿è¡Œçš„çº¿ç¨‹ç§°ä¸ºå¼‚æ­¥çº¿ç¨‹ã€‚æ˜¾ç„¶ï¼Œå¼‚æ­¥çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡é«˜ï¼Œå®æ—¶æ€§å¼ºï¼Œè¿™æ˜¯å¾ˆå¤šåµŒå…¥å¼ç¨‹åºé‡‡ç”¨çš„æ¨¡å‹ã€‚ä½†ç¼–å†™ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œçš„ç¨‹åºç›¸å¯¹å¤æ‚ï¼Œéš¾äºè°ƒè¯•å’Œæ‰©å±•ï¼Œè€Œä¸”ä¸é€‚åˆäºå¤§é‡çš„å¹¶å‘ã€‚è€ŒåŒæ­¥çº¿ç¨‹åˆ™ç›¸åï¼Œå®ƒè™½ç„¶æ•ˆç‡ç›¸å¯¹è¾ƒä½ï¼Œå®æ—¶æ€§è¾ƒå·®ï¼Œä½†é€»è¾‘ç®€å•ã€‚å› æ­¤ï¼Œå¯¹äºåƒæœåŠ¡å™¨è¿™ç§æ—¢è¦æ±‚è¾ƒå¥½çš„å®æ—¶æ€§ï¼Œåˆè¦æ±‚èƒ½åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·è¯·æ±‚çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°±åº”è¯¥åŒæ—¶ä½¿ç”¨åŒæ­¥çº¿ç¨‹å’Œå¼‚æ­¥çº¿ç¨‹æ¥å®ç°ï¼Œå³é‡‡ç”¨åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼æ¥å®ç°ã€‚ åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ä¸­ï¼ŒåŒæ­¥çº¿ç¨‹ç”¨äºå¤„ç†å®¢æˆ·é€»è¾‘ï¼›å¼‚æ­¥çº¿ç¨‹ç”¨äºå¤„ç†I&#x2F;Oäº‹ä»¶ã€‚å¼‚æ­¥çº¿ç¨‹ç›‘å¬åˆ°å®¢æˆ·è¯·æ±‚åï¼Œå°±å°†å…¶å°è£…æˆè¯·æ±‚å¯¹è±¡å¹¶æ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚è¯·æ±‚é˜Ÿåˆ—å°†é€šçŸ¥æŸä¸ªå·¥ä½œåœ¨åŒæ­¥æ¨¡å¼çš„å·¥ä½œçº¿ç¨‹æ¥è¯»å–å¹¶å¤„ç†è¯¥è¯·æ±‚å¯¹è±¡ã€‚å…·ä½“é€‰æ‹©å“ªä¸ªå·¥ä½œçº¿ç¨‹æ¥ä¸ºæ–°çš„å®¢æˆ·è¯·æ±‚æœåŠ¡ï¼Œåˆ™å–å†³äºè¯·æ±‚é˜Ÿåˆ—çš„è®¾è®¡ã€‚æ¯”å¦‚æœ€ç®€å•çš„è½®æµé€‰å–å·¥ä½œçº¿ç¨‹çš„Round Robinç®—æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¡ä»¶å˜é‡æˆ–ä¿¡å·é‡æ¥éšæœºåœ°é€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚ åœ¨æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œå¦‚æœç»“åˆè€ƒè™‘ä¸¤ç§äº‹ä»¶å¤„ç†æ¨¡å¼å’Œå‡ ç§I&#x2F;Oæ¨¡å‹ï¼Œåˆ™åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼å°±å­˜åœ¨å¤šç§å˜ä½“ã€‚å…¶ä¸­æœ‰ä¸€ç§å˜ä½“ç§°ä¸ºåŠåŒæ­¥&#x2F;åŠååº”å †ï¼ˆhalf-sync&#x2F;half-reactiveï¼‰æ¨¡å¼ å¼‚æ­¥çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œç”±ä¸»çº¿ç¨‹æ¥å……å½“ã€‚å®ƒè´Ÿè´£ç›‘å¬æ‰€æœ‰socketä¸Šçš„äº‹ä»¶ã€‚å¦‚æœç›‘å¬socketä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿï¼Œå³æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°æ¥ï¼Œä¸»çº¿ç¨‹å°±æ¥å—ä¹‹ä»¥å¾—åˆ°æ–°çš„è¿æ¥socketï¼Œç„¶åå¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œè¯¥socketä¸Šçš„è¯»å†™äº‹ä»¶ã€‚å¦‚æœè¿æ¥socketä¸Šæœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿï¼Œå³æœ‰æ–°çš„å®¢æˆ·è¯·æ±‚åˆ°æ¥æˆ–æœ‰æ•°æ®è¦å‘é€è‡³å®¢æˆ·ç«¯ï¼Œä¸»çº¿ç¨‹å°±å°†è¯¥è¿æ¥socketæ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚æ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šï¼Œå½“æœ‰ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œå®ƒä»¬å°†é€šè¿‡ç«äº‰ï¼ˆæ¯”å¦‚ç”³è¯·äº’æ–¥é”ï¼‰è·å¾—ä»»åŠ¡çš„æ¥ç®¡æƒã€‚è¿™ç§ç«äº‰æœºåˆ¶ä½¿å¾—åªæœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹æ‰æœ‰æœºä¼šæ¥å¤„ç†æ–°ä»»åŠ¡ï¼Œè¿™æ˜¯å¾ˆåˆç†çš„ã€‚ ä¸»çº¿ç¨‹æ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ˜¯å°±ç»ªçš„è¿æ¥socketã€‚è¿™è¯´æ˜è¯¥å›¾æ‰€ç¤ºçš„åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼é‡‡ç”¨çš„äº‹ä»¶å¤„ç†æ¨¡å¼æ˜¯Reactoræ¨¡å¼ï¼šå®ƒè¦æ±‚å·¥ä½œçº¿ç¨‹è‡ªå·±ä»socketä¸Šè¯»å–å®¢æˆ·è¯·æ±‚å’Œå¾€socketå†™å…¥æœåŠ¡å™¨åº”ç­”ã€‚è¿™å°±æ˜¯è¯¥æ¨¡å¼çš„åç§°ä¸­â€œhalf-reactiveâ€çš„å«ä¹‰ã€‚å®é™…ä¸Šï¼ŒåŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿçš„Proactoräº‹ä»¶å¤„ç†æ¨¡å¼ï¼Œå³ç”±ä¸»çº¿ç¨‹æ¥å®Œæˆæ•°æ®çš„è¯»å†™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹ä¸€èˆ¬ä¼šå°†åº”ç”¨ç¨‹åºæ•°æ®ã€ä»»åŠ¡ç±»å‹ç­‰ä¿¡æ¯å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç„¶åå°†å…¶ï¼ˆæˆ–è€…æŒ‡å‘è¯¥ä»»åŠ¡å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆï¼‰æ’å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚å·¥ä½œçº¿ç¨‹ä»è¯·æ±‚é˜Ÿåˆ—ä¸­å–å¾—ä»»åŠ¡å¯¹è±¡ä¹‹åï¼Œå³å¯ç›´æ¥å¤„ç†ä¹‹ï¼Œè€Œæ— é¡»æ‰§è¡Œè¯»å†™æ“ä½œäº†ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬15ç« ç»™å‡ºä¸€ä¸ªç”¨åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼å®ç°çš„ç®€å•WebæœåŠ¡å™¨çš„ä»£ç ã€‚ åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼å­˜åœ¨å¦‚ä¸‹ç¼ºç‚¹ï¼š ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹å…±äº«è¯·æ±‚é˜Ÿåˆ—ã€‚ä¸»çº¿ç¨‹å¾€è¯·æ±‚é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œæˆ–è€…å·¥ä½œçº¿ç¨‹ä»è¯·æ±‚é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œéƒ½éœ€è¦å¯¹è¯·æ±‚é˜Ÿåˆ—åŠ é”ä¿æŠ¤ï¼Œä»è€Œç™½ç™½è€—è´¹CPUæ—¶é—´ã€‚ æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·æ•°é‡è¾ƒå¤šï¼Œè€Œå·¥ä½œçº¿ç¨‹è¾ƒå°‘ï¼Œåˆ™è¯·æ±‚é˜Ÿåˆ—ä¸­å°†å †ç§¯å¾ˆå¤šä»»åŠ¡å¯¹è±¡ï¼Œå®¢æˆ·ç«¯çš„å“åº”é€Ÿåº¦å°†è¶Šæ¥è¶Šæ…¢ã€‚å¦‚æœé€šè¿‡å¢åŠ å·¥ä½œçº¿ç¨‹æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåˆ™å·¥ä½œçº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿå°†è€—è´¹å¤§é‡CPUæ—¶é—´ã€‚ ä¸€ç§é«˜æ•ˆçš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½èƒ½åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·è¿æ¥ã€‚ ä¸»çº¿ç¨‹åªç®¡ç†ç›‘å¬socketï¼Œè¿æ¥socketç”±å·¥ä½œçº¿ç¨‹æ¥ç®¡ç†ã€‚å½“æœ‰æ–°çš„è¿æ¥åˆ°æ¥æ—¶ï¼Œä¸»çº¿ç¨‹å°±æ¥å—ä¹‹å¹¶å°†æ–°è¿”å›çš„è¿æ¥socketæ´¾å‘ç»™æŸä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ­¤åè¯¥æ–°socketä¸Šçš„ä»»ä½•I&#x2F;Oæ“ä½œéƒ½ç”±è¢«é€‰ä¸­çš„å·¥ä½œçº¿ç¨‹æ¥å¤„ç†ï¼Œç›´åˆ°å®¢æˆ·å…³é—­è¿æ¥ã€‚ä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹æ´¾å‘socketçš„æœ€ç®€å•çš„æ–¹å¼ï¼Œæ˜¯å¾€å®ƒå’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´çš„ç®¡é“é‡Œå†™æ•°æ®ã€‚å·¥ä½œçº¿ç¨‹æ£€æµ‹åˆ°ç®¡é“ä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå°±åˆ†ææ˜¯å¦æ˜¯ä¸€ä¸ªæ–°çš„å®¢æˆ·è¿æ¥è¯·æ±‚åˆ°æ¥ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æŠŠè¯¥æ–°socketä¸Šçš„è¯»å†™äº‹ä»¶æ³¨å†Œåˆ°è‡ªå·±çš„epollå†…æ ¸äº‹ä»¶è¡¨ä¸­ã€‚ æ¯ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ï¼‰éƒ½ç»´æŒè‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œå®ƒä»¬å„è‡ªç‹¬ç«‹åœ°ç›‘å¬ä¸åŒçš„äº‹ä»¶ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§é«˜æ•ˆçš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å·¥ä½œåœ¨å¼‚æ­¥æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒå¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ã€‚ é¢†å¯¼è€…&#x2F;è¿½éšè€…æ¨¡å¼é¢†å¯¼è€…&#x2F;è¿½éšè€…æ¨¡å¼æ˜¯å¤šä¸ªå·¥ä½œçº¿ç¨‹è½®æµè·å¾—äº‹ä»¶æºé›†åˆï¼Œè½®æµç›‘å¬ã€åˆ†å‘å¹¶å¤„ç†äº‹ä»¶çš„ä¸€ç§æ¨¡å¼ã€‚åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œç¨‹åºéƒ½ä»…æœ‰ä¸€ä¸ªé¢†å¯¼è€…çº¿ç¨‹ï¼Œå®ƒè´Ÿè´£ç›‘å¬I&#x2F;Oäº‹ä»¶ã€‚è€Œå…¶ä»–çº¿ç¨‹åˆ™éƒ½æ˜¯è¿½éšè€…ï¼Œå®ƒä»¬ä¼‘çœ åœ¨çº¿ç¨‹æ± ä¸­ç­‰å¾…æˆä¸ºæ–°çš„é¢†å¯¼è€…ã€‚å½“å‰çš„é¢†å¯¼è€…å¦‚æœæ£€æµ‹åˆ°I&#x2F;Oäº‹ä»¶ï¼Œé¦–å…ˆè¦ä»çº¿ç¨‹æ± ä¸­æ¨é€‰å‡ºæ–°çš„é¢†å¯¼è€…çº¿ç¨‹ï¼Œç„¶åå¤„ç†I&#x2F;Oäº‹ä»¶ã€‚æ­¤æ—¶ï¼Œæ–°çš„é¢†å¯¼è€…ç­‰å¾…æ–°çš„I&#x2F;Oäº‹ä»¶ï¼Œè€ŒåŸæ¥çš„é¢†å¯¼è€…åˆ™å¤„ç†I&#x2F;Oäº‹ä»¶ï¼ŒäºŒè€…å®ç°äº†å¹¶å‘ã€‚ é¢†å¯¼è€…&#x2F;è¿½éšè€…æ¨¡å¼åŒ…å«å¦‚ä¸‹å‡ ä¸ªç»„ä»¶ï¼šå¥æŸ„é›†ï¼ˆHandleSetï¼‰ã€çº¿ç¨‹é›†ï¼ˆThreadSetï¼‰ã€äº‹ä»¶å¤„ç†å™¨ï¼ˆEventHandlerï¼‰å’Œå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ï¼ˆConcreteEventHandlerï¼‰ã€‚ æœ‰é™çŠ¶æ€æœºæœ‰çš„åº”ç”¨å±‚åè®®å¤´éƒ¨åŒ…å«æ•°æ®åŒ…ç±»å‹å­—æ®µï¼Œæ¯ç§ç±»å‹å¯ä»¥æ˜ å°„ä¸ºé€»è¾‘å•å…ƒçš„ä¸€ç§æ‰§è¡ŒçŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥æ ¹æ®å®ƒæ¥ç¼–å†™ç›¸åº”çš„å¤„ç†é€»è¾‘ 1234567891011STATE_MACHINE(Package_pack)&#123; PackageType_type=_pack.GetType(); switch(_type)&#123; case type_A: process_package_A(_pack); break; case type_B: process_package_B(_pack); break; &#125;&#125; è¯¥çŠ¶æ€æœºçš„æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³çŠ¶æ€ä¹‹é—´æ²¡æœ‰ç›¸äº’è½¬ç§»ã€‚çŠ¶æ€ä¹‹é—´çš„è½¬ç§»æ˜¯éœ€è¦çŠ¶æ€æœºå†…éƒ¨é©±åŠ¨çš„ 12345678910111213141516STATE_MACHINE()&#123; State cur_State=type_A; while(cur_State!=type_C)&#123; Package_pack=getNewPackage(); switch(cur_State)&#123; case type_A: process_package_state_A(_pack); cur_State=type_B; break; case type_B: process_package_state_B(_pack); cur_State=type_C; break; &#125; &#125;&#125; è¯¥çŠ¶æ€æœºåŒ…å«ä¸‰ç§çŠ¶æ€ï¼štype_Aã€type_Bå’Œtype_Cï¼Œå…¶ä¸­type_Aæ˜¯çŠ¶æ€æœºçš„å¼€å§‹çŠ¶æ€ï¼Œtype_Cæ˜¯çŠ¶æ€æœºçš„ç»“æŸçŠ¶æ€ã€‚çŠ¶æ€æœºçš„å½“å‰çŠ¶æ€è®°å½•åœ¨cur_Stateå˜é‡ä¸­ã€‚åœ¨ä¸€è¶Ÿå¾ªç¯è¿‡ç¨‹ä¸­ï¼ŒçŠ¶æ€æœºå…ˆé€šè¿‡getNewPackageæ–¹æ³•è·å¾—ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ï¼Œç„¶åæ ¹æ®cur_Stateå˜é‡çš„å€¼åˆ¤æ–­å¦‚ä½•å¤„ç†è¯¥æ•°æ®åŒ…ã€‚æ•°æ®åŒ…å¤„ç†å®Œä¹‹åï¼ŒçŠ¶æ€æœºé€šè¿‡ç»™cur_Stateå˜é‡ä¼ é€’ç›®æ ‡çŠ¶æ€å€¼æ¥å®ç°çŠ¶æ€è½¬ç§»ã€‚é‚£ä¹ˆå½“çŠ¶æ€æœºè¿›å…¥ä¸‹ä¸€è¶Ÿå¾ªç¯æ—¶ï¼Œå®ƒå°†æ‰§è¡Œæ–°çš„çŠ¶æ€å¯¹åº”çš„é€»è¾‘ã€‚ ä¸‹é¢æˆ‘ä»¬è€ƒè™‘æœ‰é™çŠ¶æ€æœºåº”ç”¨çš„ä¸€ä¸ªå®ä¾‹ï¼šHTTPè¯·æ±‚çš„è¯»å–å’Œåˆ†æã€‚å¾ˆå¤šç½‘ç»œåè®®ï¼ŒåŒ…æ‹¬TCPåè®®å’ŒIPåè®®ï¼Œéƒ½åœ¨å…¶å¤´éƒ¨ä¸­æä¾›å¤´éƒ¨é•¿åº¦å­—æ®µã€‚ç¨‹åºæ ¹æ®è¯¥å­—æ®µçš„å€¼å°±å¯ä»¥çŸ¥é“æ˜¯å¦æ¥æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„åè®®å¤´éƒ¨ã€‚ä½†HTTPåè®®å¹¶æœªæä¾›è¿™æ ·çš„å¤´éƒ¨é•¿åº¦å­—æ®µï¼Œå¹¶ä¸”å…¶å¤´éƒ¨é•¿åº¦å˜åŒ–ä¹Ÿå¾ˆå¤§ï¼Œå¯ä»¥åªæœ‰åå‡ å­—èŠ‚ï¼Œä¹Ÿå¯ä»¥æœ‰ä¸Šç™¾å­—èŠ‚ã€‚æ ¹æ®åè®®è§„å®šï¼Œ æˆ‘ä»¬åˆ¤æ–­HTTPå¤´éƒ¨ç»“æŸçš„ä¾æ®æ˜¯é‡åˆ°ä¸€ä¸ªç©ºè¡Œï¼Œè¯¥ç©ºè¡Œä»…åŒ…å«ä¸€å¯¹å›è½¦æ¢è¡Œç¬¦ï¼ˆï¼œCRï¼ï¼œLFï¼ï¼‰ã€‚å¦‚æœä¸€æ¬¡è¯»æ“ä½œæ²¡æœ‰è¯»å…¥HTTPè¯·æ±‚çš„æ•´ä¸ªå¤´éƒ¨ï¼Œå³æ²¡æœ‰é‡åˆ°ç©ºè¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ç­‰å¾…å®¢æˆ·ç»§ç»­å†™æ•°æ®å¹¶å†æ¬¡è¯»å…¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ¯å®Œæˆä¸€æ¬¡è¯»æ“ä½œï¼Œå°±è¦åˆ†ææ–°è¯»å…¥çš„æ•°æ®ä¸­æ˜¯å¦æœ‰ç©ºè¡Œã€‚ä¸è¿‡åœ¨å¯»æ‰¾ç©ºè¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å®Œæˆå¯¹æ•´ä¸ªHTTPè¯·æ±‚å¤´éƒ¨çš„åˆ†æï¼ˆè®°ä½ï¼Œç©ºè¡Œå‰é¢è¿˜æœ‰è¯·æ±‚è¡Œå’Œå¤´éƒ¨åŸŸï¼‰ï¼Œä»¥æé«˜è§£æHTTPè¯·æ±‚çš„æ•ˆç‡ã€‚ä»£ç æ¸…å•8-3ä½¿ç”¨ä¸»ã€ä»ä¸¤ä¸ªæœ‰é™çŠ¶æ€æœºå®ç°äº†æœ€ç®€å•çš„HTTPè¯·æ±‚çš„è¯»å–å’Œåˆ†æã€‚ä¸ºäº†ä½¿è¡¨è¿°ç®€æ´ï¼Œæˆ‘ä»¬çº¦å®šï¼Œç›´æ¥ç§°HTTPè¯·æ±‚çš„ä¸€è¡Œï¼ˆåŒ…æ‹¬è¯·æ±‚è¡Œå’Œå¤´éƒ¨å­—æ®µï¼‰ä¸ºè¡Œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#define BUFFER_SIZE 4096 /*è¯»ç¼“å†²åŒºå¤§å°*//*ä¸»çŠ¶æ€æœºçš„ä¸¤ç§å¯èƒ½çŠ¶æ€ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼šå½“å‰æ­£åœ¨åˆ†æè¯·æ±‚è¡Œï¼Œå½“å‰æ­£åœ¨åˆ†æå¤´éƒ¨å­—æ®µ*/enum CHECK_STATE&#123; CHECK_STATE_REQUESTLINE = 0, CHECK_STATE_HEADER&#125;;/*ä»çŠ¶æ€æœºçš„ä¸‰ç§å¯èƒ½çŠ¶æ€ï¼Œå³è¡Œçš„è¯»å–çŠ¶æ€ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼šè¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œã€è¡Œå‡ºé”™å’Œè¡Œæ•°æ®å°šä¸”ä¸å®Œæ•´*/enum LINE_STATUS&#123; LINE_OK = 0, LINE_BAD, LINE_OPEN&#125;;/*æœåŠ¡å™¨å¤„ç†HTTPè¯·æ±‚çš„ç»“æœï¼šNO_REQUESTè¡¨ç¤ºè¯·æ±‚ä¸å®Œæ•´ï¼Œéœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®ï¼›GET_REQUESTè¡¨ç¤ºè·å¾—äº†ä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·è¯·æ±‚ï¼›BAD_REQUESTè¡¨ç¤ºå®¢æˆ·è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼›FORBIDDEN_REQUESTè¡¨ç¤ºå®¢æˆ·å¯¹èµ„æºæ²¡æœ‰è¶³å¤Ÿçš„è®¿é—®æƒé™ï¼›INTERNAL_ERRORè¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼›CLOSED_CONNECTIONè¡¨ç¤ºå®¢æˆ·ç«¯å·²ç»å…³é—­è¿æ¥äº†*/enum HTTP_CODE&#123; NO_REQUEST, GET_REQUEST, BAD_REQUEST, FORBIDDEN_REQUEST, INTERNAL_ERROR, CLOSED_CONNECTION&#125;;/*ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬æ²¡æœ‰ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå®Œæ•´çš„HTTPåº”ç­”æŠ¥æ–‡ï¼Œè€Œåªæ˜¯æ ¹æ®æœåŠ¡å™¨çš„å¤„ç†ç»“æœå‘é€å¦‚ä¸‹æˆåŠŸæˆ–å¤±è´¥ä¿¡æ¯*/static const char *szret[] = &#123;&quot;I get a correct result\\n&quot;, &quot;Something wrong\\n &quot;&#125;;/*ä»çŠ¶æ€æœºï¼Œç”¨äºè§£æå‡ºä¸€è¡Œå†…å®¹*/LINE_STATUS parse_line(char *buffer, int &amp;checked_index, int &amp;read_index)&#123; char temp; /*checked_indexæŒ‡å‘bufferï¼ˆåº”ç”¨ç¨‹åºçš„è¯»ç¼“å†²åŒºï¼‰ä¸­å½“å‰æ­£åœ¨åˆ†æçš„å­—èŠ‚ï¼Œ read_indexæŒ‡å‘bufferä¸­å®¢æˆ·æ•°æ®çš„å°¾éƒ¨çš„ä¸‹ä¸€å­—èŠ‚ã€‚bufferä¸­ç¬¬0ï½checked_index å­—èŠ‚éƒ½å·²åˆ†æå®Œæ¯•ï¼Œç¬¬checked_indexï½(read_index-1)å­—èŠ‚ç”±ä¸‹é¢çš„å¾ªç¯æŒ¨ä¸ªåˆ†æ*/ for (; checked_index &lt; read_index; ++checked_index) &#123; /*è·å¾—å½“å‰è¦åˆ†æçš„å­—èŠ‚*/ temp = buffer[checked_index]; /*å¦‚æœå½“å‰çš„å­—èŠ‚æ˜¯â€œ\\râ€ï¼Œå³å›è½¦ç¬¦ï¼Œåˆ™è¯´æ˜å¯èƒ½è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ*/ if (temp == &#x27;\\r&#x27;) &#123; /*å¦‚æœâ€œ\\râ€å­—ç¬¦ç¢°å·§æ˜¯ç›®å‰bufferä¸­çš„æœ€åä¸€ä¸ªå·²ç»è¢«è¯»å…¥çš„å®¢æˆ·æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ¬¡åˆ† ææ²¡æœ‰è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œï¼Œè¿”å›LINE_OPENä»¥è¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ† æ*/ if ((checked_index + 1) == read_index) &#123; return LINE_OPEN; &#125; /*å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯â€œ\\nâ€ï¼Œåˆ™è¯´æ˜æˆ‘ä»¬æˆåŠŸè¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ*/ else if (buffer[checked_index + 1] == &#x27;\\n&#x27;) &#123; buffer[checked_index++] = &#x27;\\0&#x27;; buffer[checked_index++] = &#x27;\\0&#x27;; return LINE_OK; &#125; /*å¦åˆ™çš„è¯ï¼Œè¯´æ˜å®¢æˆ·å‘é€çš„HTTPè¯·æ±‚å­˜åœ¨è¯­æ³•é—®é¢˜*/ return LINE_BAD; &#125; /*å¦‚æœå½“å‰çš„å­—èŠ‚æ˜¯â€œ\\nâ€ï¼Œå³æ¢è¡Œç¬¦ï¼Œåˆ™ä¹Ÿè¯´æ˜å¯èƒ½è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œ*/ else if (temp == &#x27;\\n&#x27;) &#123; if ((checked_index &gt; 1) &amp;&amp; buffer[checked_index - 1] == &#x27;\\r&#x27;) &#123; buffer[checked_index - 1] = &#x27;\\0&#x27;; buffer[checked_index++] = &#x27;\\0&#x27;; return LINE_OK; &#125; return LINE_BAD; &#125; &#125; /*å¦‚æœæ‰€æœ‰å†…å®¹éƒ½åˆ†æå®Œæ¯•ä¹Ÿæ²¡é‡åˆ°â€œ\\râ€å­—ç¬¦ï¼Œåˆ™è¿”å›LINE_OPENï¼Œè¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯» å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ†æ*/ return LINE_OPEN;&#125;/*åˆ†æè¯·æ±‚è¡Œ*/HTTP_CODE parse_requestline(char *temp, CHECK_STATE &amp;checkstate)&#123; char *url = strpbrk(temp, &quot;\\t&quot;); /*å¦‚æœè¯·æ±‚è¡Œä¸­æ²¡æœ‰ç©ºç™½å­—ç¬¦æˆ–â€œ\\tâ€å­—ç¬¦ï¼Œåˆ™HTTPè¯·æ±‚å¿…æœ‰é—®é¢˜*/ if (!url) &#123; return BAD_REQUEST; &#125; *url++ = &#x27;\\0&#x27;; char *method = temp; if (strcasecmp(method, &quot;GET&quot;) == 0) /*ä»…æ”¯æŒGETæ–¹æ³•*/ &#123; printf(&quot;The request method is GET\\n&quot;); &#125; else &#123; return BAD_REQUEST; &#125; url += strspn(url, &quot;\\t&quot;); char *version = strpbrk(url, &quot;\\t&quot;); if (!version) &#123; return BAD_REQUEST; &#125; *version++ = &#x27;\\0&#x27;; version += strspn(version, &quot;\\t&quot;); /*ä»…æ”¯æŒHTTP/1.1*/ if (strcasecmp(version, &quot;HTTP/1.1&quot;) != 0) &#123; return BAD_REQUEST; &#125; /*æ£€æŸ¥URLæ˜¯å¦åˆæ³•*/ if (strncasecmp(url, &quot;http://&quot;, 7) == 0) &#123; url += 7; url = strchr(url, &#x27;/&#x27;); &#125; if (!url || url[0] != &#x27;/&#x27;) &#123; return BAD_REQUEST; &#125; printf(&quot;The request URL is:%s\\n&quot;, url); /*HTTPè¯·æ±‚è¡Œå¤„ç†å®Œæ¯•ï¼ŒçŠ¶æ€è½¬ç§»åˆ°å¤´éƒ¨å­—æ®µçš„åˆ†æ*/ checkstate = CHECK_STATE_HEADER; return NO_REQUEST;&#125;/*åˆ†æå¤´éƒ¨å­—æ®µ*/HTTP_CODE parse_headers(char *temp)&#123; /*é‡åˆ°ä¸€ä¸ªç©ºè¡Œï¼Œè¯´æ˜æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ­£ç¡®çš„HTTPè¯·æ±‚*/ if (temp[0] == &#x27;\\0&#x27;) &#123; return GET_REQUEST; &#125; else if (strncasecmp(temp, &quot;Host:&quot;, 5) == 0) /*å¤„ç†â€œHOSTâ€å¤´éƒ¨å­—æ®µ*/ &#123; temp += 5; temp += strspn(temp, &quot;\\t&quot;); printf(&quot;the request host is:%s\\n&quot;, temp); &#125; else /*å…¶ä»–å¤´éƒ¨å­—æ®µéƒ½ä¸å¤„ç†*/ &#123; printf(&quot;I can not handle this header\\n&quot;); &#125; return NO_REQUEST;&#125;/*åˆ†æHTTPè¯·æ±‚çš„å…¥å£å‡½æ•°*/HTTP_CODE parse_content(char *buffer, int &amp;checked_index, CHECK_STATE &amp;checkstate, int &amp;read_index, int &amp;start_line)&#123; LINE_STATUS linestatus = LINE_OK; /*è®°å½•å½“å‰è¡Œçš„è¯»å–çŠ¶æ€*/ HTTP_CODE retcode = NO_REQUEST; /*è®°å½•HTTPè¯·æ±‚çš„å¤„ç†ç»“æœ*/ /*ä¸»çŠ¶æ€æœºï¼Œç”¨äºä»bufferä¸­å–å‡ºæ‰€æœ‰å®Œæ•´çš„è¡Œ*/ while ((linestatus = parse_line(buffer, checked_index, read_index)) == LINE_OK) &#123; char *temp = buffer + start_line; /*start_lineæ˜¯è¡Œåœ¨bufferä¸­çš„èµ·å§‹ä½ç½®*/ start_line = checked_index; /*è®°å½•ä¸‹ä¸€è¡Œçš„èµ·å§‹ä½ç½®*/ /*checkstateè®°å½•ä¸»çŠ¶æ€æœºå½“å‰çš„çŠ¶æ€*/ switch (checkstate) &#123; case CHECK_STATE_REQUESTLINE: /*ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ†æè¯·æ±‚è¡Œ*/ &#123; retcode = parse_requestline(temp, checkstate); if (retcode == BAD_REQUEST) &#123; return BAD_REQUEST; &#125; break; &#125; case CHECK_STATE_HEADER: /*ç¬¬äºŒä¸ªçŠ¶æ€ï¼Œåˆ†æå¤´éƒ¨å­—æ®µ*/ &#123; retcode = parse_headers(temp); if (retcode == BAD_REQUEST) &#123; return BAD_REQUEST; &#125; else if (retcode == GET_REQUEST) &#123; return GET_REQUEST; &#125; break; &#125; default: &#123; return INTERNAL_ERROR; &#125; &#125; &#125; /*è‹¥æ²¡æœ‰è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„è¡Œï¼Œåˆ™è¡¨ç¤ºè¿˜éœ€è¦ç»§ç»­è¯»å–å®¢æˆ·æ•°æ®æ‰èƒ½è¿›ä¸€æ­¥åˆ†æ*/ if (linestatus == LINE_OPEN) &#123; return NO_REQUEST; &#125; else &#123; return BAD_REQUEST; &#125;&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int listenfd = socket(PF_INET, SOCK_STREAM, 0); assert(listenfd &gt;= 0); int ret = bind(listenfd, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(listenfd, 5); assert(ret != -1); struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int fd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); if (fd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); &#125; else &#123; char buffer[BUFFER_SIZE]; /*è¯»ç¼“å†²åŒº*/ memset(buffer, &#x27;\\0&#x27;, BUFFER_SIZE); int data_read = 0; int read_index = 0; /*å½“å‰å·²ç»è¯»å–äº†å¤šå°‘å­—èŠ‚çš„å®¢æˆ·æ•°æ®*/ int checked_index = 0; /*å½“å‰å·²ç»åˆ†æå®Œäº†å¤šå°‘å­—èŠ‚çš„å®¢æˆ·æ•°æ®*/ int start_line = 0; /*è¡Œåœ¨bufferä¸­çš„èµ·å§‹ä½ç½®*/ /*è®¾ç½®ä¸»çŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€*/ CHECK_STATE checkstate = CHECK_STATE_REQUESTLINE; while (1) /*å¾ªç¯è¯»å–å®¢æˆ·æ•°æ®å¹¶åˆ†æä¹‹*/ &#123; data_read = recv(fd, buffer + read_index, BUFFER_SIZE - read_index, 0); if (data_read == -1) &#123; printf(&quot;reading failed\\n&quot;); break; &#125; else if (data_read == 0) &#123; printf(&quot;remote client has closed the connection\\n&quot;); break; &#125; read_index += data_read; /*åˆ†æç›®å‰å·²ç»è·å¾—çš„æ‰€æœ‰å®¢æˆ·æ•°æ®*/ HTTP_CODE result = parse_content(buffer, checked_index, checkstate, read_index, start_line); if (result == NO_REQUEST) /*å°šæœªå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„HTTPè¯·æ±‚*/ &#123; continue; &#125; else if (result == GET_REQUEST) /*å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„ã€æ­£ç¡®çš„HTTPè¯·æ±‚*/ &#123; send(fd, szret[0], strlen(szret[0]), 0); break; &#125; else /*å…¶ä»–æƒ…å†µè¡¨ç¤ºå‘ç”Ÿé”™è¯¯*/ &#123; send(fd, szret[1], strlen(szret[1]), 0); break; &#125; &#125; close(fd); &#125; close(listenfd); return 0;&#125; æˆ‘ä»¬å°†ä»£ç æ¸…å•ä¸­çš„ä¸¤ä¸ªæœ‰é™çŠ¶æ€æœºåˆ†åˆ«ç§°ä¸ºä¸»çŠ¶æ€æœºå’Œä»çŠ¶æ€æœºï¼Œè¿™ä½“ç°äº†å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼šä¸»çŠ¶æ€æœºåœ¨å†…éƒ¨è°ƒç”¨ä»çŠ¶æ€æœºã€‚ä¸‹é¢å…ˆåˆ†æä»çŠ¶æ€æœºï¼Œå³parse_lineå‡½æ•°ï¼Œå®ƒä»bufferä¸­è§£æå‡ºä¸€ä¸ªè¡Œã€‚å›¾8-15æè¿°äº†å…¶å¯èƒ½çš„çŠ¶æ€åŠçŠ¶æ€è½¬ç§»è¿‡ç¨‹ æé«˜æœåŠ¡å™¨æ€§èƒ½çš„å…¶ä»–å»ºè®®æ± æ—¢ç„¶æœåŠ¡å™¨çš„ç¡¬ä»¶èµ„æºâ€œå……è£•â€ï¼Œé‚£ä¹ˆæé«˜æœåŠ¡å™¨æ€§èƒ½çš„ä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•å°±æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œè¿™å°±æ˜¯æ± ï¼ˆpoolï¼‰çš„æ¦‚å¿µã€‚æ± æ˜¯ä¸€ç»„èµ„æºçš„é›†åˆï¼Œè¿™ç»„èµ„æºåœ¨æœåŠ¡å™¨å¯åŠ¨ä¹‹åˆå°±è¢«å®Œå…¨åˆ›å»ºå¥½å¹¶åˆå§‹åŒ–ï¼Œè¿™ç§°ä¸ºé™æ€èµ„æºåˆ†é…ã€‚å½“æœåŠ¡å™¨è¿›å…¥æ­£å¼è¿è¡Œé˜¶æ®µï¼Œå³å¼€å§‹å¤„ç†å®¢æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå®ƒéœ€è¦ç›¸å…³çš„èµ„æºï¼Œå°±å¯ä»¥ç›´æ¥ä»æ± ä¸­è·å–ï¼Œæ— é¡»åŠ¨æ€åˆ†é…ã€‚å¾ˆæ˜¾ç„¶ï¼Œç›´æ¥ä»æ± ä¸­å–å¾—æ‰€éœ€èµ„æºæ¯”åŠ¨æ€åˆ†é…èµ„æºçš„é€Ÿåº¦è¦å¿«å¾—å¤šã€‚å½“æœåŠ¡å™¨å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·è¿æ¥åï¼Œå¯ä»¥æŠŠç›¸å…³çš„èµ„æºæ”¾å›æ± ä¸­ï¼Œæ— é¡»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥é‡Šæ”¾èµ„æºã€‚ä»æœ€ç»ˆçš„æ•ˆæœæ¥çœ‹ï¼Œæ± ç›¸å½“äºæœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿèµ„æºçš„åº”ç”¨å±‚è®¾æ–½ï¼Œå®ƒé¿å…äº†æœåŠ¡å™¨å¯¹å†…æ ¸çš„é¢‘ç¹è®¿é—®ã€‚ ä¸è¿‡ï¼Œæ—¢ç„¶æ± ä¸­çš„èµ„æºæ˜¯é¢„å…ˆé™æ€åˆ†é…çš„ï¼Œæˆ‘ä»¬å°±æ— æ³•é¢„æœŸåº”è¯¥åˆ†é…å¤šå°‘èµ„æºã€‚è¿™ä¸ªé—®é¢˜åˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åˆ†é…â€œè¶³å¤Ÿå¤šâ€çš„èµ„æº è¿™é€šå¸¸ä¼šå¯¼è‡´èµ„æºçš„æµªè´¹ è¿˜æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é¢„å…ˆåˆ†é…ä¸€å®šçš„èµ„æºï¼Œæ­¤åå¦‚æœå‘ç°èµ„æºä¸å¤Ÿç”¨ï¼Œå°±å†åŠ¨æ€åˆ†é…ä¸€äº›å¹¶åŠ å…¥æ± ä¸­ã€‚ æ ¹æ®ä¸åŒçš„èµ„æºç±»å‹ï¼Œæ± å¯åˆ†ä¸ºå¤šç§ï¼Œå¸¸è§çš„æœ‰å†…å­˜æ± ã€è¿›ç¨‹æ± ã€çº¿ç¨‹æ± å’Œè¿æ¥æ± ã€‚ å†…å­˜æ± é€šå¸¸ç”¨äºsocketçš„æ¥æ”¶ç¼“å­˜å’Œå‘é€ç¼“å­˜ã€‚å¯¹äºæŸäº›é•¿åº¦æœ‰é™çš„å®¢æˆ·è¯·æ±‚ï¼Œæ¯”å¦‚HTTPè¯·æ±‚ï¼Œé¢„å…ˆåˆ†é…ä¸€ä¸ªå¤§å°è¶³å¤Ÿï¼ˆæ¯”å¦‚5000å­—èŠ‚ï¼‰çš„æ¥æ”¶ç¼“å­˜åŒºæ˜¯å¾ˆåˆç†çš„ã€‚å½“å®¢æˆ·è¯·æ±‚çš„é•¿åº¦è¶…è¿‡æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¢å¼ƒè¯·æ±‚æˆ–è€…åŠ¨æ€æ‰©å¤§æ¥æ”¶ç¼“å†²åŒºã€‚ è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹å¸¸ç”¨çš„â€œä¼ä¿©â€ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥ä½œè¿›ç¨‹æˆ–å·¥ä½œçº¿ç¨‹æ¥å¤„ç†æ–°åˆ°æ¥çš„å®¢æˆ·è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»è¿›ç¨‹æ± æˆ–çº¿ç¨‹æ± ä¸­å–å¾—ä¸€ä¸ªæ‰§è¡Œå®ä½“ï¼Œè€Œæ— é¡»åŠ¨æ€åœ°è°ƒç”¨forkæˆ–pthread_createç­‰å‡½æ•°æ¥åˆ›å»ºè¿›ç¨‹å’Œçº¿ç¨‹ã€‚ è¿æ¥æ± é€šå¸¸ç”¨äºæœåŠ¡å™¨æˆ–æœåŠ¡å™¨æœºç¾¤çš„å†…éƒ¨æ°¸ä¹…è¿æ¥ã€‚æ¯ä¸ªé€»è¾‘å•å…ƒå¯èƒ½éƒ½éœ€è¦é¢‘ç¹åœ°è®¿é—®æœ¬åœ°çš„æŸä¸ªæ•°æ®åº“ã€‚è¿æ¥æ± æ˜¯æœåŠ¡å™¨é¢„å…ˆå’Œæ•°æ®åº“ç¨‹åºå»ºç«‹çš„ä¸€ç»„è¿æ¥çš„é›†åˆã€‚å½“æŸä¸ªé€»è¾‘å•å…ƒéœ€è¦è®¿é—®æ•°æ®åº“æ—¶ï¼Œå®ƒå¯ä»¥ç›´æ¥ä»è¿æ¥æ± ä¸­å–å¾—ä¸€ä¸ªè¿æ¥çš„å®ä½“å¹¶ä½¿ç”¨ä¹‹ã€‚å¾…å®Œæˆæ•°æ®åº“çš„è®¿é—®ä¹‹åï¼Œé€»è¾‘å•å…ƒå†å°†è¯¥è¿æ¥è¿”è¿˜ç»™è¿æ¥æ± ã€‚ æ•°æ®å¤åˆ¶é«˜æ€§èƒ½æœåŠ¡å™¨åº”è¯¥é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶ï¼Œå°¤å…¶æ˜¯å½“æ•°æ®å¤åˆ¶å‘ç”Ÿåœ¨ç”¨æˆ·ä»£ç å’Œå†…æ ¸ä¹‹é—´çš„æ—¶å€™ã€‚å¦‚æœå†…æ ¸å¯ä»¥ç›´æ¥å¤„ç†ä»socketæˆ–è€…æ–‡ä»¶è¯»å…¥çš„æ•°æ®ï¼Œåˆ™åº”ç”¨ç¨‹åºå°±æ²¡å¿…è¦å°†è¿™äº›æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºä¸­ã€‚è¿™é‡Œè¯´çš„â€œç›´æ¥å¤„ç†â€æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºä¸å…³å¿ƒè¿™äº›æ•°æ®çš„å†…å®¹ï¼Œä¸éœ€è¦å¯¹å®ƒä»¬åšä»»ä½•åˆ†æã€‚æ¯”å¦‚ftpæœåŠ¡å™¨ï¼Œå½“å®¢æˆ·è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨åªéœ€è¦æ£€æµ‹ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠå®¢æˆ·æ˜¯å¦æœ‰è¯»å–å®ƒçš„æƒé™ï¼Œè€Œç»å¯¹ä¸ä¼šå…³å¿ƒæ–‡ä»¶çš„å…·ä½“å†…å®¹ã€‚è¿™æ ·çš„è¯ï¼ŒftpæœåŠ¡å™¨å°±æ— é¡»æŠŠç›®æ ‡æ–‡ä»¶çš„å†…å®¹å®Œæ•´åœ°è¯»å…¥åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºä¸­å¹¶è°ƒç”¨sendå‡½æ•°æ¥å‘é€ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨â€œé›¶æ‹·è´â€å‡½æ•°sendfileæ¥ç›´æ¥å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ æ­¤å¤–ï¼Œç”¨æˆ·ä»£ç å†…éƒ¨ï¼ˆä¸è®¿é—®å†…æ ¸ï¼‰çš„æ•°æ®å¤åˆ¶ä¹Ÿæ˜¯åº”è¯¥é¿å…çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ å½“ä¸¤ä¸ªå·¥ä½œè¿›ç¨‹ä¹‹é—´è¦ä¼ é€’å¤§é‡çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥è€ƒè™‘ä½¿ç”¨å…±äº«å†…å­˜æ¥åœ¨å®ƒä»¬ä¹‹é—´ç›´æ¥å…±äº«è¿™äº›æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç®¡é“æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¼ é€’ æˆ‘ä»¬ç”¨æŒ‡é’ˆï¼ˆstart_lineï¼‰æ¥æŒ‡å‡ºæ¯ä¸ªè¡Œåœ¨bufferä¸­çš„èµ·å§‹ä½ç½®ï¼Œä»¥ä¾¿éšåå¯¹è¡Œå†…å®¹è¿›è¡Œè®¿é—®ï¼Œè€Œä¸æ˜¯æŠŠè¡Œçš„å†…å®¹å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªç¼“å†²åŒºä¸­æ¥ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ ·æ—¢æµªè´¹ç©ºé—´ï¼Œåˆæ•ˆç‡ä½ä¸‹ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”å¹¶å‘ç¨‹åºå¿…é¡»è€ƒè™‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰çš„é—®é¢˜ï¼Œå³è¿›ç¨‹åˆ‡æ¢æˆ–çº¿ç¨‹åˆ‡æ¢å¯¼è‡´çš„çš„ç³»ç»Ÿå¼€é”€ã€‚å³ä½¿æ˜¯I&#x2F;Oå¯†é›†å‹çš„æœåŠ¡å™¨ï¼Œä¹Ÿä¸åº”è¯¥ä½¿ç”¨è¿‡å¤šçš„å·¥ä½œçº¿ç¨‹ï¼ˆæˆ–å·¥ä½œè¿›ç¨‹ï¼Œä¸‹åŒï¼‰ï¼Œå¦åˆ™çº¿ç¨‹é—´çš„åˆ‡æ¢å°†å ç”¨å¤§é‡çš„CPUæ—¶é—´ï¼ŒæœåŠ¡å™¨çœŸæ­£ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘çš„CPUæ—¶é—´çš„æ¯”é‡å°±æ˜¾å¾—ä¸è¶³äº†ã€‚å› æ­¤ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·è¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„æœåŠ¡å™¨æ¨¡å‹æ˜¯ä¸å¯å–çš„ã€‚å›¾8-11æ‰€æè¿°çš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒåˆç†çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·è¿æ¥ã€‚æ­¤å¤–ï¼Œå¤šçº¿ç¨‹æœåŠ¡å™¨çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ä¸åŒçš„çº¿ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šã€‚å½“çº¿ç¨‹çš„æ•°é‡ä¸å¤§äºCPUçš„æ•°ç›®æ—¶ï¼Œä¸Šä¸‹æ–‡çš„åˆ‡æ¢å°±ä¸æ˜¯é—®é¢˜äº†ã€‚ å¹¶å‘ç¨‹åºéœ€è¦è€ƒè™‘çš„å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯å…±äº«èµ„æºçš„åŠ é”ä¿æŠ¤ã€‚é”é€šå¸¸è¢«è®¤ä¸ºæ˜¯å¯¼è‡´æœåŠ¡å™¨æ•ˆç‡ä½ä¸‹çš„ä¸€ä¸ªå› ç´ ï¼Œå› ä¸ºç”±å®ƒå¼•å…¥çš„ä»£ç ä¸ä»…ä¸å¤„ç†ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”éœ€è¦è®¿é—®å†…æ ¸èµ„æºã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å¦‚æœæœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå°±åº”è¯¥é¿å…ä½¿ç”¨é”ã€‚æ˜¾ç„¶ï¼Œå›¾8-11æ‰€æè¿°çš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼å°±æ¯”å›¾8-10æ‰€æè¿°çš„åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼çš„æ•ˆç‡é«˜ã€‚å¦‚æœæœåŠ¡å™¨å¿…é¡»ä½¿ç”¨â€œé”â€ï¼Œåˆ™å¯ä»¥è€ƒè™‘å‡å°é”çš„ç²’åº¦ï¼Œæ¯”å¦‚ä½¿ç”¨è¯»å†™é”ã€‚å½“æ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½åªè¯»å–ä¸€å—å…±äº«å†…å­˜çš„å†…å®¹æ—¶ï¼Œè¯»å†™é”å¹¶ä¸ä¼šå¢åŠ ç³»ç»Ÿçš„é¢å¤–å¼€é”€ã€‚åªæœ‰å½“å…¶ä¸­æŸä¸€ä¸ªå·¥ä½œçº¿ç¨‹éœ€è¦å†™è¿™å—å†…å­˜æ—¶ï¼Œç³»ç»Ÿæ‰å¿…é¡»å»é”ä½è¿™å—åŒºåŸŸ I&#x2F;Oå¤ç”¨I&#x2F;Oå¤ç”¨å…è®¸å•ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªI&#x2F;Oæ“ä½œ,è€Œä¸éœ€è¦ä¸ºæ¯ä¸ªI&#x2F;Oæ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æˆ–è¿›ç¨‹ å½“å†…æ ¸å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªI&#x2F;Oæ¡ä»¶å°±ç»ªæ—¶ï¼ˆå¦‚è¾“å…¥æ•°æ®å·²å‡†å¤‡å¥½è¢«è¯»å–ï¼Œæˆ–è¾“å‡ºç¼“å†²åŒºæœ‰ç©ºé—´æ¥æ”¶æ•°æ®ï¼‰ï¼Œå®ƒä¼šç»™è¿›ç¨‹ä¸€ä¸ªé€šçŸ¥ã€‚è¿™ç§åŠŸèƒ½ä¸»è¦é€šè¿‡selectã€pollå’Œepollç­‰ç³»ç»Ÿè°ƒç”¨å®ç°ã€‚ I&#x2F;Oå¤ç”¨ä½¿å¾—ç¨‹åºèƒ½åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™å¯¹æé«˜ç¨‹åºçš„æ€§èƒ½è‡³å…³é‡è¦ å®¢æˆ·ç«¯ç¨‹åºè¦åŒæ—¶å¤„ç†å¤šä¸ªsocketã€‚æ¯”å¦‚æœ¬ç« å°†è¦è®¨è®ºçš„éé˜»å¡connectæŠ€æœ¯ å®¢æˆ·ç«¯ç¨‹åºè¦åŒæ—¶å¤„ç†ç”¨æˆ·è¾“å…¥å’Œç½‘ç»œè¿æ¥ã€‚æ¯”å¦‚æœ¬ç« å°†è¦è®¨è®ºçš„èŠå¤©å®¤ç¨‹åº TCPæœåŠ¡å™¨è¦åŒæ—¶å¤„ç†ç›‘å¬socketå’Œè¿æ¥socketã€‚è¿™æ˜¯I&#x2F;Oå¤ç”¨ä½¿ç”¨æœ€å¤šçš„åœºåˆã€‚ æœåŠ¡å™¨è¦åŒæ—¶å¤„ç†TCPè¯·æ±‚å’ŒUDPè¯·æ±‚ã€‚æ¯”å¦‚æœ¬ç« å°†è¦è®¨è®ºçš„å›å°„æœåŠ¡å™¨ æœåŠ¡å™¨è¦åŒæ—¶ç›‘å¬å¤šä¸ªç«¯å£ï¼Œæˆ–è€…å¤„ç†å¤šç§æœåŠ¡ã€‚æ¯”å¦‚æœ¬ç« å°†è¦è®¨è®ºçš„xinetdæœåŠ¡å™¨ I&#x2F;Oå¤ç”¨è™½ç„¶èƒ½åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½†å®ƒæœ¬èº«æ˜¯é˜»å¡çš„ã€‚å¹¶ä¸”å½“å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦åŒæ—¶å°±ç»ªæ—¶ï¼Œå¦‚æœä¸é‡‡å–é¢å¤–çš„æªæ–½ï¼Œç¨‹åºå°±åªèƒ½æŒ‰é¡ºåºä¾æ¬¡å¤„ç†å…¶ä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä½¿å¾—æœåŠ¡å™¨ç¨‹åºçœ‹èµ·æ¥åƒæ˜¯ä¸²è¡Œå·¥ä½œçš„ã€‚å¦‚æœè¦å®ç°å¹¶å‘ï¼Œåªèƒ½ä½¿ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ç­‰ç¼–ç¨‹æ‰‹æ®µã€‚ ###selectç³»ç»Ÿè°ƒç”¨ selectç³»ç»Ÿè°ƒç”¨çš„ç”¨é€”æ˜¯ï¼šåœ¨ä¸€æ®µæŒ‡å®šæ—¶é—´å†…ï¼Œç›‘å¬ç”¨æˆ·æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶ã€‚ select API12#includeï¼œsys/select.hï¼int select(int nfds,fd_set* readfds,fd_set* writefds,fd_set* exceptfds,struct timeval*timeout); nfdså‚æ•°æŒ‡å®šè¢«ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦çš„æ€»æ•°ã€‚å®ƒé€šå¸¸è¢«è®¾ç½®ä¸ºselectç›‘å¬çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ä¸­çš„æœ€å¤§å€¼åŠ 1ï¼Œå› ä¸ºæ–‡ä»¶æè¿°ç¬¦æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ readfdsã€writefdså’Œexceptfdså‚æ•°åˆ†åˆ«æŒ‡å‘å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚åº”ç”¨ç¨‹åºè°ƒç”¨selectå‡½æ•°æ—¶ï¼Œé€šè¿‡è¿™3ä¸ªå‚æ•°ä¼ å…¥è‡ªå·±æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ã€‚selectè°ƒç”¨è¿”å›æ—¶ï¼Œå†…æ ¸å°†ä¿®æ”¹å®ƒä»¬æ¥é€šçŸ¥åº”ç”¨ç¨‹åºå“ªäº›æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªã€‚ fd_setç»“æ„ä½“ 12345678910111213141516#includeï¼œtypesizes.hï¼#define__FD_SETSIZE 1024#includeï¼œsys/select.hï¼#define FD_SETSIZE__FD_SETSIZEtypedef long int__fd_mask;#undef__NFDBITS#define__NFDBITS(8*(int)sizeof(__fd_mask))typedef struct&#123;#ifdef__USE_XOPEN__fd_mask fds_bits[__FD_SETSIZE/__NFDBITS];#define__FDS_BITS(set)((set)-ï¼fds_bits)#else__fd_mask__fds_bits[__FD_SETSIZE/__NFDBITS];#define__FDS_BITS(set)((set)-ï¼__fds_bits)#endif&#125;fd_set; ç”±ä»¥ä¸Šå®šä¹‰å¯è§ï¼Œfd_setç»“æ„ä½“ä»…åŒ…å«ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„æ¯ä¸€ä½ï¼ˆbitï¼‰æ ‡è®°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚fd_setèƒ½å®¹çº³çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ç”±FD_SETSIZEæŒ‡å®šï¼Œè¿™å°±é™åˆ¶äº†selectèƒ½åŒæ—¶å¤„ç†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ€»é‡ã€‚ ç”±äºä½æ“ä½œè¿‡äºçƒ¦çï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä¸‹é¢çš„ä¸€ç³»åˆ—å®æ¥è®¿é—®fd_setç»“æ„ä½“ä¸­çš„ä½ï¼š 12345#includeï¼œsys/select.hï¼FD_ZERO(fd_set*fdset);/*æ¸…é™¤fdsetçš„æ‰€æœ‰ä½*/FD_SET(int fd,fd_set*fdset);/*è®¾ç½®fdsetçš„ä½fd*/FD_CLR(int fd,fd_set*fdset);/*æ¸…é™¤fdsetçš„ä½fd*/int FD_ISSET(int fd,fd_set*fdset);/*æµ‹è¯•fdsetçš„ä½fdæ˜¯å¦è¢«è®¾ç½®*/ timeoutå‚æ•°ç”¨æ¥è®¾ç½®selectå‡½æ•°çš„è¶…æ—¶æ—¶é—´ã€‚å®ƒæ˜¯ä¸€ä¸ªtimevalç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œé‡‡ç”¨æŒ‡é’ˆå‚æ•°æ˜¯å› ä¸ºå†…æ ¸å°†ä¿®æ”¹å®ƒä»¥å‘Šè¯‰åº”ç”¨ç¨‹åºselectç­‰å¾…äº†å¤šä¹…ã€‚ä¸è¿‡æˆ‘ä»¬ä¸èƒ½å®Œå…¨ä¿¡ä»»selectè°ƒç”¨è¿”å›åçš„timeoutå€¼ï¼Œæ¯”å¦‚è°ƒç”¨å¤±è´¥æ—¶timeoutå€¼æ˜¯ä¸ç¡®å®šçš„ã€‚timevalç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234struct timeval&#123;long tv_sec;/*ç§’æ•°*/long tv_usec;/*å¾®ç§’æ•°*/&#125;; ç”±ä»¥ä¸Šå®šä¹‰å¯è§ï¼Œselectç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¾®ç§’çº§çš„å®šæ—¶æ–¹å¼ã€‚å¦‚æœç»™timeoutå˜é‡çš„tv_secæˆå‘˜å’Œtv_usecæˆå‘˜éƒ½ä¼ é€’0ï¼Œåˆ™selectå°†ç«‹å³è¿”å›ã€‚å¦‚æœç»™timeoutä¼ é€’NULLï¼Œåˆ™selectå°†ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æŸä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªã€‚selectæˆåŠŸæ—¶è¿”å›å°±ç»ªï¼ˆå¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ï¼‰æ–‡ä»¶æè¿°ç¬¦çš„æ€»æ•°ã€‚å¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œselectå°†è¿”å›0ã€‚selectå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚å¦‚æœåœ¨selectç­‰å¾…æœŸé—´ï¼Œç¨‹åºæ¥æ”¶åˆ°ä¿¡å·ï¼Œåˆ™selectç«‹å³è¿”å›-1ï¼Œå¹¶è®¾ç½®errnoä¸ºEINTR æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ¡ä»¶å“ªäº›æƒ…å†µä¸‹æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¢«è®¤ä¸ºæ˜¯å¯è¯»ã€å¯å†™æˆ–è€…å‡ºç°å¼‚å¸¸ï¼Œå¯¹äºselectçš„ä½¿ç”¨éå¸¸å…³é”®ã€‚ ä¸‹åˆ—æƒ…å†µä¸‹socketå¯è¯»ï¼š socketå†…æ ¸æ¥æ”¶ç¼“å­˜åŒºä¸­çš„å­—èŠ‚æ•°å¤§äºæˆ–ç­‰äºå…¶ä½æ°´ä½æ ‡è®°SO_RCVLOWATã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ— é˜»å¡åœ°è¯»è¯¥socketï¼Œå¹¶ä¸”è¯»æ“ä½œè¿”å›çš„å­—èŠ‚æ•°å¤§äº0ã€‚ socketé€šä¿¡çš„å¯¹æ–¹å…³é—­è¿æ¥ã€‚æ­¤æ—¶å¯¹è¯¥socketçš„è¯»æ“ä½œå°†è¿”å›0ã€‚ ç›‘å¬socketä¸Šæœ‰æ–°çš„è¿æ¥è¯·æ±‚ã€‚ socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getsockoptæ¥è¯»å–å’Œæ¸…é™¤è¯¥é”™è¯¯ã€‚ ä¸‹åˆ—æƒ…å†µä¸‹socketå¯å†™ï¼š socketå†…æ ¸å‘é€ç¼“å­˜åŒºä¸­çš„å¯ç”¨å­—èŠ‚æ•°å¤§äºæˆ–ç­‰äºå…¶ä½æ°´ä½æ ‡è®°SO_SNDLOWATã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ— é˜»å¡åœ°å†™è¯¥socketï¼Œå¹¶ä¸”å†™æ“ä½œè¿”å›çš„å­—èŠ‚æ•°å¤§äº0ã€‚ socketçš„å†™æ“ä½œè¢«å…³é—­ã€‚å¯¹å†™æ“ä½œè¢«å…³é—­çš„socketæ‰§è¡Œå†™æ“ä½œå°†è§¦å‘ä¸€ä¸ªSIGPIPEä¿¡å·ã€‚ socketä½¿ç”¨éé˜»å¡connectè¿æ¥æˆåŠŸæˆ–è€…å¤±è´¥ï¼ˆè¶…æ—¶ï¼‰ä¹‹åã€‚ socketä¸Šæœ‰æœªå¤„ç†çš„é”™è¯¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨getsockoptæ¥è¯»å–å’Œæ¸…é™¤è¯¥é”™è¯¯ã€‚ ç½‘ç»œç¨‹åºä¸­ï¼Œselectèƒ½å¤„ç†çš„å¼‚å¸¸æƒ…å†µåªæœ‰ä¸€ç§ï¼šsocketä¸Šæ¥æ”¶åˆ°å¸¦å¤–æ•°æ® å¤„ç†å¸¦å¤–æ•°æ®socketä¸Šæ¥æ”¶åˆ°æ™®é€šæ•°æ®å’Œå¸¦å¤–æ•°æ®éƒ½å°†ä½¿selectè¿”å›ï¼Œä½†socketå¤„äºä¸åŒçš„å°±ç»ªçŠ¶æ€ï¼šå‰è€…å¤„äºå¯è¯»çŠ¶æ€ï¼Œåè€…å¤„äºå¼‚å¸¸çŠ¶æ€ã€‚ä»£ç æ¸…å•9-1æè¿°äº†selectæ˜¯å¦‚ä½•åŒæ—¶å¤„ç†äºŒè€…çš„ã€‚ åŒæ—¶æ¥æ”¶æ™®é€šæ•°æ®å’Œå¸¦å¤–æ•°æ® 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int listenfd = socket(PF_INET, SOCK_STREAM, 0); assert(listenfd &gt;= 0); ret = bind(listenfd, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(listenfd, 5); assert(ret != -1); struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); if (connfd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); close(listenfd); &#125; char buf[1024]; fd_set read_fds;//å£°æ˜æ–‡ä»¶æè¿°ç¬¦ fd_set exception_fds; FD_ZERO(&amp;read_fds); FD_ZERO(&amp;exception_fds);//æ¸…é™¤æ‰€æœ‰ä½ while (1) &#123; memset(buf, &#x27;\\0&#x27;, sizeof(buf)); /*æ¯æ¬¡è°ƒç”¨selectå‰éƒ½è¦é‡æ–°åœ¨read_fdså’Œexception_fdsä¸­è®¾ç½®æ–‡ä»¶æè¿°ç¬¦connfdï¼Œå› ä¸ºäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œæ–‡ä»¶æè¿°ç¬¦é›†åˆå°†è¢«å†…æ ¸ä¿®æ”¹*/ FD_SET(connfd, &amp;read_fds);//è®¾ç½®ä½ FD_SET(connfd, &amp;exception_fds); ret = select(connfd + 1, &amp;read_fds, NULL, &amp;exception_fds, NULL); if (ret &lt; 0) &#123; printf(&quot;selection failure\\n&quot;); break; &#125; /*å¯¹äºå¯è¯»äº‹ä»¶ï¼Œé‡‡ç”¨æ™®é€šçš„recvå‡½æ•°è¯»å–æ•°æ®*/ if (FD_ISSET(connfd, &amp;read_fds))//å¦‚æœä½è¢«è®¾ç½® &#123; ret = recv(connfd, buf, sizeof(buf) - 1, 0); if (ret &lt;= 0) &#123; break; &#125; printf(&quot;get%d bytes of normal data:%s\\n&quot;, ret, buf); &#125; /*å¯¹äºå¼‚å¸¸äº‹ä»¶ï¼Œé‡‡ç”¨å¸¦MSG_OOBæ ‡å¿—çš„recvå‡½æ•°è¯»å–å¸¦å¤–æ•°æ®*/ else if (FD_ISSET(connfd, &amp;exception_fds)) &#123; ret = recv(connfd, buf, sizeof(buf) - 1, MSG_OOB); if (ret &lt;= 0) &#123; break; &#125; printf(&quot;get%d bytes of oob data:%s\\n&quot;, ret, buf); &#125; &#125; close(connfd); close(listenfd); return 0;&#125; pollç³»ç»Ÿè°ƒç”¨pollç³»ç»Ÿè°ƒç”¨å’Œselectç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨æŒ‡å®šæ—¶é—´å†…è½®è¯¢ä¸€å®šæ•°é‡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥æµ‹è¯•å…¶ä¸­æ˜¯å¦æœ‰å°±ç»ªè€… 12#includeï¼œpoll.hï¼int poll(struct pollfd*fds,nfds_t nfds,int timeout); fdså‚æ•°æ˜¯ä¸€ä¸ªpollfdç»“æ„ç±»å‹çš„æ•°ç»„ï¼Œå®ƒæŒ‡å®šæ‰€æœ‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šå‘ç”Ÿçš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶ã€‚pollfdç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345struct pollfd&#123; int fd;/*æ–‡ä»¶æè¿°ç¬¦*/ short events;/*æ³¨å†Œçš„äº‹ä»¶*/ //å‘Šè¯‰pollç›‘å¬å“ªäº›äº‹ä»¶ short revents;/*å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”±å†…æ ¸å¡«å……*/&#125;; ä½¿ç”¨POLLRDHUPäº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç æœ€å¼€å§‹å¤„å®šä¹‰_GNU_SOURCE nfdså‚æ•°æŒ‡å®šè¢«ç›‘å¬äº‹ä»¶é›†åˆfdsçš„å¤§å°ã€‚å…¶ç±»å‹nfds_tçš„å®šä¹‰ typedef unsigned long int nfds_t; timeoutå‚æ•°æŒ‡å®špollçš„è¶…æ—¶å€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚å½“timeoutä¸º-1æ—¶ï¼Œpollè°ƒç”¨å°†æ°¸è¿œé˜»å¡ï¼Œç›´åˆ°æŸä¸ªäº‹ä»¶å‘ç”Ÿï¼›å½“timeoutä¸º0æ—¶ï¼Œpollè°ƒç”¨å°†ç«‹å³è¿”å›ã€‚ è¿”å›å€¼ä¸selectè¿”å›å€¼å«ä¹‰ç›¸åŒ å¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œè¿”å›0ã€‚å¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚å¦‚æœåœ¨ç­‰å¾…æœŸé—´ï¼Œç¨‹åºæ¥æ”¶åˆ°ä¿¡å·ï¼Œåˆ™ç«‹å³è¿”å›-1ï¼Œå¹¶è®¾ç½®errnoä¸ºEINTR epollç³»åˆ—ç³»ç»Ÿè°ƒç”¨å†…æ ¸äº‹ä»¶è¡¨epollæ˜¯Linuxç‰¹æœ‰çš„I&#x2F;Oå¤ç”¨å‡½æ•°ã€‚å®ƒåœ¨å®ç°å’Œä½¿ç”¨ä¸Šä¸selectã€pollæœ‰å¾ˆå¤§å·®å¼‚ã€‚é¦–å…ˆï¼Œepollä½¿ç”¨ä¸€ç»„å‡½æ•°æ¥å®Œæˆä»»åŠ¡ï¼Œè€Œä¸æ˜¯å•ä¸ªå‡½æ•°ã€‚å…¶æ¬¡ï¼ŒepollæŠŠç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶æ”¾åœ¨å†…æ ¸é‡Œçš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œä»è€Œæ— é¡»åƒselectå’Œpollé‚£æ ·æ¯æ¬¡è°ƒç”¨éƒ½è¦é‡å¤ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦é›†æˆ–äº‹ä»¶é›†ã€‚ä½†epolléœ€è¦ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¥å”¯ä¸€æ ‡è¯†å†…æ ¸ä¸­çš„è¿™ä¸ªäº‹ä»¶è¡¨ã€‚è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨å¦‚ä¸‹epoll_createå‡½æ•°æ¥åˆ›å»ºï¼š 12#includeï¼œsys/epoll.hï¼int epoll_create(int size) sizeå‚æ•°ç°åœ¨å¹¶ä¸èµ·ä½œç”¨ï¼Œåªæ˜¯ç»™å†…æ ¸ä¸€ä¸ªæç¤ºï¼Œå‘Šè¯‰å®ƒäº‹ä»¶è¡¨éœ€è¦å¤šå¤§ã€‚è¯¥å‡½æ•°è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦å°†ç”¨ä½œå…¶ä»–æ‰€æœ‰epollç³»ç»Ÿè°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä»¥æŒ‡å®šè¦è®¿é—®çš„å†…æ ¸äº‹ä»¶è¡¨ã€‚ ä¸‹é¢çš„å‡½æ•°ç”¨æ¥æ“ä½œepollçš„å†…æ ¸äº‹ä»¶è¡¨ï¼š int epoll_ctl(int epfd,int op,int fd,struct epoll_event*event) fdå‚æ•°æ˜¯è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦ opå‚æ•°åˆ™æŒ‡å®šæ“ä½œç±»å‹ã€‚æ“ä½œç±»å‹æœ‰å¦‚ä¸‹3ç§ï¼š EPOLL_CTL_ADDï¼Œå¾€äº‹ä»¶è¡¨ä¸­æ³¨å†Œfdä¸Šçš„äº‹ä»¶ EPOLL_CTL_MODï¼Œä¿®æ”¹fdä¸Šçš„æ³¨å†Œäº‹ä»¶ EPOLL_CTL_DELï¼Œåˆ é™¤fdä¸Šçš„æ³¨å†Œäº‹ä»¶ eventå‚æ•°æŒ‡å®šäº‹ä»¶ï¼Œå®ƒæ˜¯epoll_eventç»“æ„æŒ‡é’ˆç±»å‹ã€‚epoll_eventçš„å®šä¹‰å¦‚ä¸‹ struct epoll_event&#123; __uint32_t events;/*epolläº‹ä»¶*/ epoll_data_t data;/*ç”¨æˆ·æ•°æ®*/ &#125;; 123456789101112* å…¶ä¸­eventsæˆå‘˜æè¿°äº‹ä»¶ç±»å‹ã€‚epollæ”¯æŒçš„äº‹ä»¶ç±»å‹å’ŒpollåŸºæœ¬ç›¸åŒã€‚è¡¨ç¤ºepolläº‹ä»¶ç±»å‹çš„å®æ˜¯åœ¨pollå¯¹åº”çš„å®å‰åŠ ä¸Šâ€œEâ€ï¼Œæ¯”å¦‚epollçš„æ•°æ®å¯è¯»äº‹ä»¶æ˜¯EPOLLINã€‚ä½†epollæœ‰ä¸¤ä¸ªé¢å¤–çš„äº‹ä»¶ç±»å‹â€”â€”EPOLLETå’ŒEPOLLONESHOTã€‚å®ƒä»¬å¯¹äºepollçš„é«˜æ•ˆè¿ä½œéå¸¸å…³é”®* dataæˆå‘˜ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œå…¶ç±»å‹epoll_data_tçš„å®šä¹‰å¦‚ä¸‹ï¼š* * ~~~c typedef union epoll_data&#123; void*ptr; int fd; uint32_t u32; uint64_t u64; &#125;epoll_data_t; * epoll_data_tæ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œå…¶4ä¸ªæˆå‘˜ä¸­ä½¿ç”¨æœ€å¤šçš„æ˜¯fdï¼Œå®ƒæŒ‡å®šäº‹ä»¶æ‰€ä»å±çš„ç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ã€‚ptræˆå‘˜å¯ç”¨æ¥æŒ‡å®šä¸fdç›¸å…³çš„ç”¨æˆ·æ•°æ®ã€‚ä½†ç”±äºepoll_data_tæ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œæˆ‘ä»¬ä¸èƒ½åŒæ—¶ä½¿ç”¨å…¶ptræˆå‘˜å’Œfdæˆå‘˜ï¼Œå› æ­¤ï¼Œå¦‚æœè¦å°†æ–‡ä»¶æè¿°ç¬¦å’Œç”¨æˆ·æ•°æ®å…³è”èµ·æ¥ï¼ˆæ­£å¦‚8.5.2å°èŠ‚è®¨è®ºçš„å°†å¥æŸ„å’Œäº‹ä»¶å¤„ç†å™¨ç»‘å®šä¸€æ ·ï¼‰ï¼Œä»¥å®ç°å¿«é€Ÿçš„æ•°æ®è®¿é—®ï¼Œåªèƒ½ä½¿ç”¨å…¶ä»–æ‰‹æ®µï¼Œæ¯”å¦‚æ”¾å¼ƒä½¿ç”¨epoll_data_tçš„fdæˆå‘˜ï¼Œè€Œåœ¨ptræŒ‡å‘çš„ç”¨æˆ·æ•°æ®ä¸­åŒ…å«fdã€‚ * epoll_ctlæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚ ####epoll_waitå‡½æ•° epollç³»åˆ—ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒåœ¨ä¸€æ®µè¶…æ—¶æ—¶é—´å†…ç­‰å¾…ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ 12#includeï¼œsys/epoll.hï¼int epoll_wait(int epfd,struct epoll_event*events,int maxevents,int timeout); è¯¥å‡½æ•°æˆåŠŸæ—¶è¿”å›å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œå¤±è´¥æ—¶è¿”å›-1å¹¶è®¾ç½®errnoã€‚ timeoutå‚æ•°çš„å«ä¹‰ä¸pollæ¥å£çš„timeoutå‚æ•°ç›¸åŒã€‚ maxeventså‚æ•°æŒ‡å®šæœ€å¤šç›‘å¬å¤šå°‘ä¸ªäº‹ä»¶ï¼Œå®ƒå¿…é¡»å¤§äº0ã€‚ epoll_waitå‡½æ•°å¦‚æœæ£€æµ‹åˆ°äº‹ä»¶ï¼Œå°±å°†æ‰€æœ‰å°±ç»ªçš„äº‹ä»¶ä»å†…æ ¸äº‹ä»¶è¡¨ï¼ˆç”±epfdå‚æ•°æŒ‡å®šï¼‰ä¸­å¤åˆ¶åˆ°å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°eventsæŒ‡å‘çš„æ•°ç»„ä¸­ã€‚è¿™ä¸ªæ•°ç»„åªç”¨äºè¾“å‡ºepoll_waitæ£€æµ‹åˆ°çš„å°±ç»ªäº‹ä»¶ï¼Œè€Œä¸åƒselectå’Œpollçš„æ•°ç»„å‚æ•°é‚£æ ·æ—¢ç”¨äºä¼ å…¥ç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ï¼Œåˆç”¨äºè¾“å‡ºå†…æ ¸æ£€æµ‹åˆ°çš„å°±ç»ªäº‹ä»¶ã€‚è¿™å°±æå¤§åœ°æé«˜äº†åº”ç”¨ç¨‹åºç´¢å¼•å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ•ˆç‡ã€‚ pollå’Œepollåœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ« 12345678910111213141516/*å¦‚ä½•ç´¢å¼•pollè¿”å›çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦*/int ret=poll(fds,MAX_EVENT_NUMBER,-1);/*å¿…é¡»éå†æ‰€æœ‰å·²æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦å¹¶æ‰¾åˆ°å…¶ä¸­çš„å°±ç»ªè€…ï¼ˆå½“ç„¶ï¼Œå¯ä»¥åˆ©ç”¨retæ¥ç¨åšä¼˜åŒ–ï¼‰*/for(int i=0;iï¼œMAX_EVENT_NUMBER;++i)&#123; if(fds[i].reventsï¼†POLLIN)&#123; /*åˆ¤æ–­ç¬¬iä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ª*/ int sockfd=fds[i].fd; /*å¤„ç†sockfd*/ &#125;&#125;/*å¦‚ä½•ç´¢å¼•epollè¿”å›çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦*/int ret=epoll_wait(epollfd,events,MAX_EVENT_NUMBER,-1);/*ä»…éå†å°±ç»ªçš„retä¸ªæ–‡ä»¶æè¿°ç¬¦*/for(int i=0;iï¼œret;i++)&#123; int sockfd=events[i].data.fd;/*sockfdè‚¯å®šå°±ç»ªï¼Œç›´æ¥å¤„ç†*/&#125; LTå’ŒETæ¨¡å¼epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆLevel Triggerï¼Œç”µå¹³è§¦å‘ï¼‰æ¨¡å¼å’ŒETï¼ˆEdge Triggerï¼Œè¾¹æ²¿è§¦å‘ï¼‰æ¨¡å¼ã€‚LTæ¨¡å¼æ˜¯é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹epollç›¸å½“äºä¸€ä¸ªæ•ˆç‡è¾ƒé«˜çš„pollã€‚å½“å¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„EPOLLETäº‹ä»¶æ—¶ï¼Œepollå°†ä»¥ETæ¨¡å¼æ¥æ“ä½œè¯¥æ–‡ä»¶æè¿°ç¬¦ã€‚ETæ¨¡å¼æ˜¯epollçš„é«˜æ•ˆå·¥ä½œæ¨¡å¼ã€‚ å¯¹äºé‡‡ç”¨LTå·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“epoll_waitæ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚è¿™æ ·ï¼Œå½“åº”ç”¨ç¨‹åºä¸‹ä¸€æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œepoll_waitè¿˜ä¼šå†æ¬¡å‘åº”ç”¨ç¨‹åºé€šå‘Šæ­¤äº‹ä»¶ï¼Œç›´åˆ°è¯¥äº‹ä»¶è¢«å¤„ç†ã€‚ å¯¹äºé‡‡ç”¨ETå·¥ä½œæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“epoll_waitæ£€æµ‹åˆ°å…¶ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œå› ä¸ºåç»­çš„epoll_waitè°ƒç”¨å°†ä¸å†å‘åº”ç”¨ç¨‹åºé€šçŸ¥è¿™ä¸€äº‹ä»¶ã€‚å¯è§ï¼ŒETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†åŒä¸€ä¸ªepolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚ LTå’ŒETæ¨¡å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/epoll.h&gt;#include &lt;pthread.h&gt;#define MAX_EVENT_NUMBER 1024#define BUFFER_SIZE 10/*å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡çš„*/int setnonblocking(int fd)&#123; int old_option = fcntl(fd, F_GETFL); int new_option = old_option | O_NONBLOCK; fcntl(fd, F_SETFL, new_option); return old_option;&#125;/*å°†æ–‡ä»¶æè¿°ç¬¦fdä¸Šçš„EPOLLINæ³¨å†Œåˆ°epollfdæŒ‡ç¤ºçš„epollå†…æ ¸äº‹ä»¶è¡¨ä¸­ï¼Œå‚æ•°enable_etæŒ‡å®šæ˜¯å¦å¯¹fdå¯ç”¨ETæ¨¡å¼*/void addfd(int epollfd, int fd, bool enable_et)&#123; epoll_event event; event.data.fd = fd; event.events = EPOLLIN; if (enable_et) &#123; event.events |= EPOLLET; &#125; epoll_ctl(epollfd, EPOLL_CTL_ADD, fd, &amp;event); setnonblocking(fd);&#125;/*LTæ¨¡å¼çš„å·¥ä½œæµç¨‹*/void lt(epoll_event *events, int number, int epollfd, int listenfd)&#123; char buf[BUFFER_SIZE]; for (int i = 0; i &lt; number; i++) &#123; int sockfd = events[i].data.fd; if (sockfd == listenfd) &#123; struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); addfd(epollfd, connfd, false); /*å¯¹connfdç¦ç”¨ETæ¨¡å¼*/ &#125; else if (events[i].events &amp; EPOLLIN) &#123; /*åªè¦socketè¯»ç¼“å­˜ä¸­è¿˜æœ‰æœªè¯»å‡ºçš„æ•°æ®ï¼Œè¿™æ®µä»£ç å°±è¢«è§¦å‘*/ printf(&quot;event trigger once\\n&quot;); memset(buf, &#x27;\\0&#x27;, BUFFER_SIZE); int ret = recv(sockfd, buf, BUFFER_SIZE - 1, 0); if (ret &lt;= 0) &#123; close(sockfd); continue; &#125; printf(&quot;get%d bytes of content:%s\\n&quot;, ret, buf); &#125; else &#123; printf(&quot;something else happened\\n&quot;); &#125; &#125;&#125;/*ETæ¨¡å¼çš„å·¥ä½œæµç¨‹*/void et(epoll_event *events, int number, int epollfd, int listenfd)&#123; char buf[BUFFER_SIZE]; for (int i = 0; i &lt; number; i++) &#123; int sockfd = events[i].data.fd; if (sockfd == listenfd) &#123; struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); addfd(epollfd, connfd, true); /*å¯¹connfdå¼€å¯ETæ¨¡å¼*/ &#125; else if (events[i].events &amp; EPOLLIN) &#123; /*è¿™æ®µä»£ç ä¸ä¼šè¢«é‡å¤è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ªç¯è¯»å–æ•°æ®ï¼Œä»¥ç¡®ä¿æŠŠsocketè¯»ç¼“å­˜ä¸­çš„æ‰€ æœ‰æ•°æ®è¯»å‡º*/ printf(&quot;event trigger once\\n&quot;); while (1) &#123; memset(buf, &#x27;\\0&#x27;, BUFFER_SIZE); int ret = recv(sockfd, buf, BUFFER_SIZE - 1, 0); if (ret &lt; 0) &#123; /*å¯¹äºéé˜»å¡IOï¼Œä¸‹é¢çš„æ¡ä»¶æˆç«‹è¡¨ç¤ºæ•°æ®å·²ç»å…¨éƒ¨è¯»å–å®Œæ¯•ã€‚æ­¤åï¼Œepollå°±èƒ½å†æ¬¡ è§¦å‘sockfdä¸Šçš„EPOLLINäº‹ä»¶ï¼Œä»¥é©±åŠ¨ä¸‹ä¸€æ¬¡è¯»æ“ä½œ*/ if ((errno == EAGAIN) || (errno == EWOULDBLOCK)) &#123; printf(&quot;read later\\n&quot;); break; &#125; close(sockfd); break; &#125; else if (ret == 0) &#123; close(sockfd); &#125; else &#123; printf(&quot;get%d bytes of content:%s\\n&quot;, ret, buf); &#125; &#125; &#125; else &#123; printf(&quot;something else happened\\n&quot;); &#125; &#125;&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int listenfd = socket(PF_INET, SOCK_STREAM, 0); assert(listenfd &gt;= 0); ret = bind(listenfd, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(listenfd, 5); assert(ret != -1); epoll_event events[MAX_EVENT_NUMBER]; int epollfd = epoll_create(5); assert(epollfd != -1); addfd(epollfd, listenfd, true); while (1) &#123; int ret = epoll_wait(epollfd, events, MAX_EVENT_NUMBER, -1); if (ret &lt; 0) &#123; printf(&quot;epoll failure\\n&quot;); break; &#125; lt(events, ret, epollfd, listenfd); /*ä½¿ç”¨LTæ¨¡å¼*/ // et(events,ret,epollfd,listenfd);/*ä½¿ç”¨ETæ¨¡å¼*/ &#125; close(listenfd); return 0;&#125; è¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç ï¼Œç„¶åtelnetåˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºä¸Šå¹¶ä¸€æ¬¡ä¼ è¾“è¶…è¿‡10å­—èŠ‚ï¼ˆBUFFER_SIZEçš„å¤§å°ï¼‰çš„æ•°æ®ï¼Œç„¶åæ¯”è¾ƒLTæ¨¡å¼å’ŒETæ¨¡å¼çš„å¼‚åŒã€‚ä½ ä¼šå‘ç°ï¼Œæ­£å¦‚æˆ‘ä»¬é¢„æœŸçš„ï¼ŒETæ¨¡å¼ä¸‹äº‹ä»¶è¢«è§¦å‘çš„æ¬¡æ•°è¦æ¯”LTæ¨¡å¼ä¸‹å°‘å¾ˆå¤š æ¯ä¸ªä½¿ç”¨ETæ¨¡å¼çš„æ–‡ä»¶æè¿°ç¬¦éƒ½åº”è¯¥æ˜¯éé˜»å¡çš„ã€‚å¦‚æœæ–‡ä»¶æè¿°ç¬¦æ˜¯é˜»å¡çš„ï¼Œé‚£ä¹ˆè¯»æˆ–å†™æ“ä½œå°†ä¼šå› ä¸ºæ²¡æœ‰åç»­çš„äº‹ä»¶è€Œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼ˆé¥¥æ¸´çŠ¶æ€ï¼‰ã€‚ EPOLLONESHOTäº‹ä»¶å³ä½¿æˆ‘ä»¬ä½¿ç”¨ETæ¨¡å¼ï¼Œä¸€ä¸ªsocketä¸Šçš„æŸä¸ªäº‹ä»¶è¿˜æ˜¯å¯èƒ½è¢«è§¦å‘å¤šæ¬¡ã€‚è¿™åœ¨å¹¶å‘ç¨‹åºä¸­å°±ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è¿›ç¨‹ï¼‰åœ¨è¯»å–å®ŒæŸä¸ªsocketä¸Šçš„æ•°æ®åå¼€å§‹å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œåœ¨æ•°æ®çš„å¤„ç†è¿‡ç¨‹ä¸­è¯¥socketä¸Šåˆæœ‰æ–°æ•°æ®å¯è¯»ï¼ˆEPOLLINå†æ¬¡è¢«è§¦å‘ï¼‰ï¼Œæ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’æ¥è¯»å–è¿™äº›æ–°çš„æ•°æ®ã€‚äºæ˜¯å°±å‡ºç°äº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªsocketçš„å±€é¢ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ã€‚æˆ‘ä»¬æœŸæœ›çš„æ˜¯ä¸€ä¸ªsocketè¿æ¥åœ¨ä»»ä¸€æ—¶åˆ»éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä½¿ç”¨epollçš„EPOLLONESHOTäº‹ä»¶å®ç°ã€‚ å¯¹äºæ³¨å†Œäº†EPOLLONESHOTäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿæœ€å¤šè§¦å‘å…¶ä¸Šæ³¨å†Œçš„ä¸€ä¸ªå¯è¯»ã€å¯å†™æˆ–è€…å¼‚å¸¸äº‹ä»¶ï¼Œä¸”åªè§¦å‘ä¸€æ¬¡ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨epoll_ctlå‡½æ•°é‡ç½®è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šæ³¨å†Œçš„EPOLLONESHOTäº‹ä»¶ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†æŸä¸ªsocketæ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯èƒ½æœ‰æœºä¼šæ“ä½œè¯¥socketçš„ã€‚ä½†åè¿‡æ¥æ€è€ƒï¼Œæ³¨å†Œäº†EPOLLONESHOTäº‹ä»¶çš„socketä¸€æ—¦è¢«æŸä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ï¼Œè¯¥çº¿ç¨‹å°±åº”è¯¥ç«‹å³é‡ç½®è¿™ä¸ªsocketä¸Šçš„EPOLLONESHOTäº‹ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/epoll.h&gt;#include &lt;pthread.h&gt;#define MAX_EVENT_NUMBER 1024#define BUFFER_SIZE 1024struct fds&#123; int epollfd; int sockfd;&#125;;int setnonblocking(int fd)&#123; int old_option = fcntl(fd, F_GETFL); int new_option = old_option | O_NONBLOCK; fcntl(fd, F_SETFL, new_option); return old_option;&#125;/*å°†fdä¸Šçš„EPOLLINå’ŒEPOLLETäº‹ä»¶æ³¨å†Œåˆ°epollfdæŒ‡ç¤ºçš„epollå†…æ ¸äº‹ä»¶è¡¨ä¸­ï¼Œå‚æ•°oneshotæŒ‡å®šæ˜¯å¦æ³¨å†Œfdä¸Šçš„EPOLLONESHOTäº‹ä»¶*/void addfd(int epollfd, int fd, bool oneshot)&#123; epoll_event event; event.data.fd = fd; event.events = EPOLLIN | EPOLLET; if (oneshot) &#123; event.events |= EPOLLONESHOT; &#125; epoll_ctl(epollfd, EPOLL_CTL_ADD, fd, &amp;event); setnonblocking(fd);&#125;/*é‡ç½®fdä¸Šçš„äº‹ä»¶ã€‚è¿™æ ·æ“ä½œä¹‹åï¼Œå°½ç®¡fdä¸Šçš„EPOLLONESHOTäº‹ä»¶è¢«æ³¨å†Œï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿä»ç„¶ä¼šè§¦å‘fdä¸Šçš„EPOLLINäº‹ä»¶ï¼Œä¸”åªè§¦å‘ä¸€æ¬¡*/void reset_oneshot(int epollfd, int fd)&#123; epoll_event event; event.data.fd = fd; event.events = EPOLLIN | EPOLLET | EPOLLONESHOT; epoll_ctl(epollfd, EPOLL_CTL_MOD, fd, &amp;event);&#125;/*å·¥ä½œçº¿ç¨‹*/void *worker(void *arg)&#123; int sockfd = ((fds *)arg)-&gt;sockfd; int epollfd = ((fds *)arg)-&gt;epollfd; printf(&quot;start new thread to receive data on fd:%d\\n&quot;, sockfd); char buf[BUFFER_SIZE]; memset(buf, &#x27;\\0&#x27;, BUFFER_SIZE); /*å¾ªç¯è¯»å–sockfdä¸Šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°EAGAINé”™è¯¯*/ while (1) &#123; int ret = recv(sockfd, buf, BUFFER_SIZE - 1, 0); if (ret == 0) &#123; close(sockfd); printf(&quot;foreiner closed the connection\\n&quot;); break; &#125; else if (ret &lt; 0) &#123; if (errno == EAGAIN) &#123; reset_oneshot(epollfd, sockfd); printf(&quot;read later\\n&quot;); break; &#125; &#125; else &#123; printf(&quot;get content:%s\\n&quot;, buf); /*ä¼‘çœ 5sï¼Œæ¨¡æ‹Ÿæ•°æ®å¤„ç†è¿‡ç¨‹*/ sleep(5); &#125; &#125; printf(&quot;end thread receiving data on fd:%d\\n&quot;, sockfd);&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int listenfd = socket(PF_INET, SOCK_STREAM, 0); assert(listenfd &gt;= 0); ret = bind(listenfd, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(listenfd, 5); assert(ret != -1); epoll_event events[MAX_EVENT_NUMBER]; int epollfd = epoll_create(5); assert(epollfd != -1); /*æ³¨æ„ï¼Œç›‘å¬socket listenfdä¸Šæ˜¯ä¸èƒ½æ³¨å†ŒEPOLLONESHOTäº‹ä»¶çš„ï¼Œå¦åˆ™åº”ç”¨ç¨‹åº åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·è¿æ¥ï¼å› ä¸ºåç»­çš„å®¢æˆ·è¿æ¥è¯·æ±‚å°†ä¸å†è§¦å‘listenfdä¸Šçš„EPOLLINäº‹ä»¶ */ addfd(epollfd, listenfd, false); while (1) &#123; int ret = epoll_wait(epollfd, events, MAX_EVENT_NUMBER, -1); if (ret &lt; 0) &#123; printf(&quot;epoll failure\\n&quot;); break; &#125; for (int i = 0; i &lt; ret; i++) &#123; int sockfd = events[i].data.fd; if (sockfd == listenfd) &#123; struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); /*å¯¹æ¯ä¸ªéç›‘å¬æ–‡ä»¶æè¿°ç¬¦éƒ½æ³¨å†ŒEPOLLONESHOTäº‹ä»¶*/ addfd(epollfd, connfd, true); &#125; else if (events[i].events &amp; EPOLLIN) &#123; pthread_t thread; fds fds_for_new_worker; fds_for_new_worker.epollfd = epollfd; fds_for_new_worker.sockfd = sockfd; /*æ–°å¯åŠ¨ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ä¸ºsockfdæœåŠ¡*/ pthread_create(&amp;thread, NULL, worker, (void *)&amp;fds_for_new_worker); &#125; else &#123; printf(&quot;something else happened\\n&quot;); &#125; &#125; &#125; close(listenfd); return 0;&#125; ä»å·¥ä½œçº¿ç¨‹å‡½æ•°workeræ¥çœ‹ï¼Œå¦‚æœä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†å®ŒæŸä¸ªsocketä¸Šçš„ä¸€æ¬¡è¯·æ±‚ï¼ˆæˆ‘ä»¬ç”¨ä¼‘çœ 5 sæ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼‰ä¹‹åï¼Œåˆæ¥æ”¶åˆ°è¯¥socketä¸Šæ–°çš„å®¢æˆ·è¯·æ±‚ï¼Œåˆ™è¯¥çº¿ç¨‹å°†ç»§ç»­ä¸ºè¿™ä¸ªsocketæœåŠ¡ã€‚å¹¶ä¸”å› ä¸ºè¯¥socketä¸Šæ³¨å†Œäº†EPOLLONESHOTäº‹ä»¶ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰æœºä¼šæ¥è§¦è¿™ä¸ªsocketï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹ç­‰å¾…5 såä»ç„¶æ²¡æ”¶åˆ°è¯¥socketä¸Šçš„ä¸‹ä¸€æ‰¹å®¢æˆ·æ•°æ®ï¼Œåˆ™å®ƒå°†æ”¾å¼ƒä¸ºè¯¥socketæœåŠ¡ã€‚åŒæ—¶ï¼Œå®ƒè°ƒç”¨reset_oneshotå‡½æ•°æ¥é‡ç½®è¯¥socketä¸Šçš„æ³¨å†Œäº‹ä»¶ï¼Œè¿™å°†ä½¿epollæœ‰æœºä¼šå†æ¬¡æ£€æµ‹åˆ°è¯¥socketä¸Šçš„EPOLLINäº‹ä»¶ï¼Œè¿›è€Œä½¿å¾—å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šä¸ºè¯¥socketæœåŠ¡ã€‚ ç”±æ­¤çœ‹æ¥ï¼Œå°½ç®¡ä¸€ä¸ªsocketåœ¨ä¸åŒæ—¶é—´å¯èƒ½è¢«ä¸åŒçš„çº¿ç¨‹å¤„ç†ï¼Œä½†åŒä¸€æ—¶åˆ»è‚¯å®šåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸ºå®ƒæœåŠ¡ã€‚è¿™å°±ä¿è¯äº†è¿æ¥çš„å®Œæ•´æ€§ï¼Œä»è€Œé¿å…äº†å¾ˆå¤šå¯èƒ½çš„ç«æ€æ¡ä»¶ã€‚ ä¸‰ç»„I&#x2F;Oå¤ç”¨å‡½æ•°çš„æ¯”è¾ƒç›´æ¥çœ‹æœ€å è¿™3ç»„ç³»ç»Ÿè°ƒç”¨éƒ½èƒ½åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒä»¬å°†ç­‰å¾…ç”±timeoutå‚æ•°æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ï¼Œç›´åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰äº‹ä»¶å‘ç”Ÿæ—¶è¿”å›ï¼Œè¿”å›å€¼æ˜¯å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ã€‚è¿”å›0è¡¨ç¤ºæ²¡æœ‰äº‹ä»¶å‘ç”Ÿã€‚ç°åœ¨æˆ‘ä»¬ä»äº‹ä»¶é›†ã€æœ€å¤§æ”¯æŒæ–‡ä»¶æè¿°ç¬¦æ•°ã€å·¥ä½œæ¨¡å¼å’Œå…·ä½“å®ç°ç­‰å››ä¸ªæ–¹é¢ è¿™3ç»„å‡½æ•°éƒ½é€šè¿‡æŸç§ç»“æ„ä½“å˜é‡æ¥å‘Šè¯‰å†…æ ¸ç›‘å¬å“ªäº›æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å“ªäº›äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨è¯¥ç»“æ„ä½“ç±»å‹çš„å‚æ•°æ¥è·å–å†…æ ¸å¤„ç†çš„ç»“æœã€‚ selectçš„å‚æ•°ç±»å‹fd_setæ²¡æœ‰å°†æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ç»‘å®šï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå› æ­¤selectéœ€è¦æä¾›3ä¸ªè¿™ç§ç±»å‹çš„å‚æ•°æ¥åˆ†åˆ«ä¼ å…¥å’Œè¾“å‡ºå¯è¯»ã€å¯å†™åŠå¼‚å¸¸ç­‰äº‹ä»¶ã€‚å†…æ ¸å¯¹fd_seté›†åˆçš„åœ¨çº¿ä¿®æ”¹ï¼Œåº”ç”¨ç¨‹åºä¸‹æ¬¡è°ƒç”¨selectå‰ä¸å¾—ä¸é‡ç½®è¿™3ä¸ªfd_seté›†åˆã€‚ pollçš„å‚æ•°ç±»å‹pollfdåˆ™å¤šå°‘â€œèªæ˜â€ä¸€äº›ã€‚å®ƒæŠŠæ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶éƒ½å®šä¹‰å…¶ä¸­ï¼Œä»»ä½•äº‹ä»¶éƒ½è¢«ç»Ÿä¸€å¤„ç†ï¼Œä»è€Œä½¿å¾—ç¼–ç¨‹æ¥å£ç®€æ´å¾—å¤šã€‚å¹¶ä¸”å†…æ ¸æ¯æ¬¡ä¿®æ”¹çš„æ˜¯pollfdç»“æ„ä½“çš„reventsæˆå‘˜ï¼Œè€Œeventsæˆå‘˜ä¿æŒä¸å˜ï¼Œå› æ­¤ä¸‹æ¬¡è°ƒç”¨pollæ—¶åº”ç”¨ç¨‹åºæ— é¡»é‡ç½®pollfdç±»å‹çš„äº‹ä»¶é›†å‚æ•°ã€‚ ç”±äºæ¯æ¬¡selectå’Œpollè°ƒç”¨éƒ½è¿”å›æ•´ä¸ªç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶é›†åˆï¼ˆå…¶ä¸­åŒ…æ‹¬å°±ç»ªçš„å’Œæœªå°±ç»ªçš„ï¼‰ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºç´¢å¼•å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆnï¼‰ã€‚ epollåˆ™é‡‡ç”¨ä¸selectå’Œpollå®Œå…¨ä¸åŒçš„æ–¹å¼æ¥ç®¡ç†ç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ã€‚å®ƒåœ¨å†…æ ¸ä¸­ç»´æŠ¤ä¸€ä¸ªäº‹ä»¶è¡¨ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿè°ƒç”¨epoll_ctlæ¥æ§åˆ¶å¾€å…¶ä¸­æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹äº‹ä»¶ã€‚è¿™æ ·ï¼Œæ¯æ¬¡epoll_waitè°ƒç”¨éƒ½ç›´æ¥ä»è¯¥å†…æ ¸äº‹ä»¶è¡¨ä¸­å–å¾—ç”¨æˆ·æ³¨å†Œçš„äº‹ä»¶ï¼Œè€Œæ— é¡»åå¤ä»ç”¨æˆ·ç©ºé—´è¯»å…¥è¿™äº›äº‹ä»¶ã€‚epoll_waitç³»ç»Ÿè°ƒç”¨çš„eventså‚æ•°ä»…ç”¨æ¥è¿”å›å°±ç»ªçš„äº‹ä»¶ï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºç´¢å¼•å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ—¶é—´å¤æ‚åº¦è¾¾åˆ°Oï¼ˆ1ï¼‰ã€‚ pollå’Œepoll_waitåˆ†åˆ«ç”¨nfdså’Œmaxeventså‚æ•°æŒ‡å®šæœ€å¤šç›‘å¬å¤šå°‘ä¸ªæ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ã€‚è¿™ä¸¤ä¸ªæ•°å€¼éƒ½èƒ½è¾¾åˆ°ç³»ç»Ÿå…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œå³65 535ï¼ˆcat&#x2F;proc&#x2F;sys&#x2F;fs&#x2F;file-maxï¼‰ã€‚è€Œselectå…è®¸ç›‘å¬çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡é€šå¸¸æœ‰é™åˆ¶ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™ä¸ªé™åˆ¶ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´ä¸å¯é¢„æœŸçš„åæœ selectå’Œpolléƒ½åªèƒ½å·¥ä½œåœ¨ç›¸å¯¹ä½æ•ˆçš„LTæ¨¡å¼ï¼Œè€Œepollåˆ™å¯ä»¥å·¥ä½œåœ¨ETé«˜æ•ˆæ¨¡å¼ã€‚å¹¶ä¸”epollè¿˜æ”¯æŒEPOLLONESHOTäº‹ä»¶ã€‚è¯¥äº‹ä»¶èƒ½è¿›ä¸€æ­¥å‡å°‘å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸ç­‰äº‹ä»¶è¢«è§¦å‘çš„æ¬¡æ•°ã€‚ selectå’Œpollé‡‡ç”¨çš„éƒ½æ˜¯è½®è¯¢çš„æ–¹å¼ï¼Œå³æ¯æ¬¡è°ƒç”¨éƒ½è¦æ‰«ææ•´ä¸ªæ³¨å†Œæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå¹¶å°†å…¶ä¸­å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ç”¨æˆ·ç¨‹åºï¼Œå› æ­¤å®ƒä»¬æ£€æµ‹å°±ç»ªäº‹ä»¶çš„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆnï¼‰ã€‚epoll_waitåˆ™ä¸åŒï¼Œå®ƒé‡‡ç”¨çš„æ˜¯å›è°ƒçš„æ–¹å¼ã€‚å†…æ ¸æ£€æµ‹åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå°†è§¦å‘å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å°±å°†è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šå¯¹åº”çš„äº‹ä»¶æ’å…¥å†…æ ¸å°±ç»ªäº‹ä»¶é˜Ÿåˆ—ã€‚å†…æ ¸æœ€ååœ¨é€‚å½“çš„æ—¶æœºå°†è¯¥å°±ç»ªäº‹ä»¶é˜Ÿåˆ—ä¸­çš„å†…å®¹æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚å› æ­¤epoll_waitæ— é¡»è½®è¯¢æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ£€æµ‹å“ªäº›äº‹ä»¶å·²ç»å°±ç»ªï¼Œå…¶ç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“æ´»åŠ¨è¿æ¥æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œepoll_waitçš„æ•ˆç‡æœªå¿…æ¯”selectå’Œpollé«˜ï¼Œå› ä¸ºæ­¤æ—¶å›è°ƒå‡½æ•°è¢«è§¦å‘å¾—è¿‡äºé¢‘ç¹ã€‚æ‰€ä»¥epoll_waité€‚ç”¨äºè¿æ¥æ•°é‡å¤šï¼Œä½†æ´»åŠ¨è¿æ¥è¾ƒå°‘çš„æƒ…å†µã€‚ å…¶ä»–æƒ…å†µç”¨pollï¼Œselectæ²¡å•¥å¥½å¤„ I&#x2F;Oå¤ç”¨çš„é«˜çº§åº”ç”¨ä¸€ï¼šéé˜»å¡connectè¿™æ®µè¯æè¿°äº†connectå‡ºé”™æ—¶çš„ä¸€ç§errnoå€¼ï¼šEINPROGRESSã€‚è¿™ç§é”™è¯¯å‘ç”Ÿåœ¨å¯¹éé˜»å¡çš„socketè°ƒç”¨connectï¼Œè€Œè¿æ¥åˆæ²¡æœ‰ç«‹å³å»ºç«‹æ—¶ã€‚æ ¹æ®manæ–‡æ¡£çš„è§£é‡Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨selectã€pollç­‰å‡½æ•°æ¥ç›‘å¬è¿™ä¸ªè¿æ¥å¤±è´¥çš„socketä¸Šçš„å¯å†™äº‹ä»¶ã€‚å½“selectã€pollç­‰å‡½æ•°è¿”å›åï¼Œå†åˆ©ç”¨getsockoptæ¥è¯»å–é”™è¯¯ç å¹¶æ¸…é™¤è¯¥socketä¸Šçš„é”™è¯¯ã€‚å¦‚æœé”™è¯¯ç æ˜¯0ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸå»ºç«‹ï¼Œå¦åˆ™è¿æ¥å¤±è´¥ã€‚ é€šè¿‡ä¸Šé¢æè¿°çš„éé˜»å¡connectæ–¹å¼ï¼Œæˆ‘ä»¬å°±èƒ½åŒæ—¶å‘èµ·å¤šä¸ªè¿æ¥å¹¶ä¸€èµ·ç­‰å¾… 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;stdlib.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;time.h&gt;#include &lt;errno.h&gt;#include &lt;fcntl.h&gt;#include &lt;sys/ioctl.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#define BUFFER_SIZE 1023int setnonblocking(int fd)&#123; int old_option = fcntl(fd, F_GETFL); int new_option = old_option | O_NONBLOCK; fcntl(fd, F_SETFL, new_option); return old_option;&#125;/*è¶…æ—¶è¿æ¥å‡½æ•°ï¼Œå‚æ•°åˆ†åˆ«æ˜¯æœåŠ¡å™¨IPåœ°å€ã€ç«¯å£å·å’Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚å‡½æ•°æˆåŠŸæ—¶è¿”å›å·²ç»å¤„äºè¿æ¥çŠ¶æ€çš„socketï¼Œå¤±è´¥åˆ™è¿”å›-1*/int unblock_connect(const char *ip, int port, int time)&#123; int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int sockfd = socket(PF_INET, SOCK_STREAM, 0); int fdopt = setnonblocking(sockfd); ret = connect(sockfd, (struct sockaddr *)&amp;address, sizeof(address)); if (ret == 0) &#123; /*å¦‚æœè¿æ¥æˆåŠŸï¼Œåˆ™æ¢å¤sockfdçš„å±æ€§ï¼Œå¹¶ç«‹å³è¿”å›ä¹‹*/ printf(&quot;connect with server immediately\\n&quot;); fcntl(sockfd, F_SETFL, fdopt); return sockfd; &#125; else if (errno != EINPROGRESS) &#123; /*å¦‚æœè¿æ¥æ²¡æœ‰ç«‹å³å»ºç«‹ï¼Œé‚£ä¹ˆåªæœ‰å½“errnoæ˜¯EINPROGRESSæ—¶æ‰è¡¨ç¤ºè¿æ¥è¿˜åœ¨è¿› è¡Œï¼Œå¦åˆ™å‡ºé”™è¿”å›*/ printf(&quot;unblock connect not support\\n&quot;); return -1; &#125; fd_set readfds; fd_set writefds; struct timeval timeout; FD_ZERO(&amp;readfds); FD_SET(sockfd, &amp;writefds); timeout.tv_sec = time; timeout.tv_usec = 0; ret = select(sockfd + 1, NULL, &amp;writefds, NULL, &amp;timeout); if (ret &lt;= 0) &#123; /*selectè¶…æ—¶æˆ–è€…å‡ºé”™ï¼Œç«‹å³è¿”å›*/ printf(&quot;connection time out\\n&quot;); close(sockfd); return -1; &#125; if (!FD_ISSET(sockfd, &amp;writefds)) &#123; printf(&quot;no events on sockfd found\\n&quot;); close(sockfd); return -1; &#125; int error = 0; socklen_t length = sizeof(error); /*è°ƒç”¨getsockoptæ¥è·å–å¹¶æ¸…é™¤sockfdä¸Šçš„é”™è¯¯*/ if (getsockopt(sockfd, SOL_SOCKET, SO_ERROR, &amp;error, &amp;length) &lt; 0) &#123; printf(&quot;get socket option failed\\n&quot;); close(sockfd); return -1; &#125; /*é”™è¯¯å·ä¸ä¸º0è¡¨ç¤ºè¿æ¥å‡ºé”™*/ if (error != 0) &#123; printf(&quot;connection failed after select with the error:%d\\n&quot;, error); close(sockfd); return -1; &#125; /*è¿æ¥æˆåŠŸ*/ printf(&quot;connection ready after select with the socket:%d\\n&quot;, sockfd); fcntl(sockfd, F_SETFL, fdopt); return sockfd;&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int sockfd = unblock_connect(ip, port, 10); if (sockfd &lt; 0) &#123; return 1; &#125; close(sockfd); return 0;&#125; ä½†é—æ†¾çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨å‡ å¤„ç§»æ¤æ€§é—®é¢˜ã€‚é¦–å…ˆï¼Œéé˜»å¡çš„socketå¯èƒ½å¯¼è‡´connectå§‹ç»ˆå¤±è´¥ã€‚å…¶æ¬¡ï¼Œselectå¯¹å¤„äºEINPROGRESSçŠ¶æ€ä¸‹çš„socketå¯èƒ½ä¸èµ·ä½œç”¨ã€‚æœ€åï¼Œå¯¹äºå‡ºé”™çš„socketï¼Œgetsockoptåœ¨æœ‰äº›ç³»ç»Ÿï¼ˆæ¯”å¦‚Linuxï¼‰ä¸Šè¿”å›-1ï¼ˆæ­£å¦‚ä»£ç æ¸…å•9-5æ‰€æœŸæœ›çš„ï¼‰ï¼Œè€Œåœ¨æœ‰äº›ç³»ç»Ÿï¼ˆæ¯”å¦‚æºè‡ªä¼¯å…‹åˆ©çš„UNIXï¼‰ä¸Šåˆ™è¿”å›0ã€‚è¿™äº›é—®é¢˜æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§£å†³æ–¹æ³• I&#x2F;Oå¤ç”¨çš„é«˜çº§åº”ç”¨äºŒï¼šèŠå¤©å®¤ç¨‹åºåƒsshè¿™æ ·çš„ç™»å½•æœåŠ¡é€šå¸¸è¦åŒæ—¶å¤„ç†ç½‘ç»œè¿æ¥å’Œç”¨æˆ·è¾“å…¥ï¼Œè¿™ä¹Ÿå¯ä»¥ä½¿ç”¨I&#x2F;Oå¤ç”¨æ¥å®ç°ã€‚ æˆ‘ä»¬ä»¥pollä¸ºä¾‹å®ç°ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ç¨‹åºï¼Œä»¥é˜è¿°å¦‚ä½•ä½¿ç”¨I&#x2F;Oå¤ç”¨æŠ€æœ¯æ¥åŒæ—¶å¤„ç†ç½‘ç»œè¿æ¥å’Œç”¨æˆ·è¾“å…¥ã€‚è¯¥èŠå¤©å®¤ç¨‹åºèƒ½è®©æ‰€æœ‰ç”¨æˆ·åŒæ—¶åœ¨çº¿ç¾¤èŠï¼Œå®ƒåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ä¸ªéƒ¨åˆ†ã€‚ å…¶ä¸­å®¢æˆ·ç«¯ç¨‹åºæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼šä¸€æ˜¯ä»æ ‡å‡†è¾“å…¥ç»ˆç«¯è¯»å…¥ç”¨æˆ·æ•°æ®ï¼Œå¹¶å°†ç”¨æˆ·æ•°æ®å‘é€è‡³æœåŠ¡å™¨ï¼›äºŒæ˜¯å¾€æ ‡å‡†è¾“å‡ºç»ˆç«¯æ‰“å°æœåŠ¡å™¨å‘é€ç»™å®ƒçš„æ•°æ®ã€‚ æœåŠ¡å™¨çš„åŠŸèƒ½æ˜¯æ¥æ”¶å®¢æˆ·æ•°æ®ï¼Œå¹¶æŠŠå®¢æˆ·æ•°æ®å‘é€ç»™æ¯ä¸€ä¸ªç™»å½•åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„å®¢æˆ·ç«¯ï¼ˆæ•°æ®å‘é€è€…é™¤å¤–ï¼‰ã€‚ å®¢æˆ·ç«¯å®¢æˆ·ç«¯ç¨‹åºä½¿ç”¨pollåŒæ—¶ç›‘å¬ç”¨æˆ·è¾“å…¥å’Œç½‘ç»œè¿æ¥ï¼Œå¹¶åˆ©ç”¨spliceå‡½æ•°å°†ç”¨æˆ·è¾“å…¥å†…å®¹ç›´æ¥å®šå‘åˆ°ç½‘ç»œè¿æ¥ä¸Šä»¥å‘é€ä¹‹ï¼Œä»è€Œå®ç°æ•°æ®é›¶æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576#define _GNU_SOURCE 1 //ä¸ºäº†ä½¿ç”¨POLLRDHUPäº‹ä»¶#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;#include &lt;poll.h&gt;#include &lt;fcntl.h&gt;#define BUFFER_SIZE 64int main(int argc, char *argv[])&#123; //socketåœ°å€ åˆ›å»º è¿æ¥ if (argc &lt;= 2)&#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); struct sockaddr_in server_address; bzero(&amp;server_address, sizeof(server_address)); server_address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;server_address.sin_addr); server_address.sin_port = htons(port); int sockfd = socket(PF_INET, SOCK_STREAM, 0); assert(sockfd &gt;= 0); if (connect(sockfd, (struct sockaddr *)&amp;server_address, sizeof(server_address)) &lt; 0) &#123; printf(&quot;connection failed\\n&quot;); close(sockfd); return 1; &#125; pollfd fds[2];//pollè½®è¯¢å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°/*æ³¨å†Œæ–‡ä»¶æè¿°ç¬¦0ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰å’Œæ–‡ä»¶æè¿°ç¬¦sockfdä¸Šçš„å¯è¯»äº‹ä»¶*/ fds[0].fd = 0;//æ–‡ä»¶æè¿°ç¬¦ fds[0].events = POLLIN;//ç›‘å¬äº‹ä»¶ï¼šæ•°æ®å¯è¯» fds[0].revents = 0;//å®é™…äº‹ä»¶ï¼Œå†…æ ¸å¡«å…… fds[1].fd = sockfd;//æ–‡ä»¶æè¿°ç¬¦ä¸º è¿æ¥socket fds[1].events = POLLIN | POLLRDHUP; //pollç›‘å¬ï¼šæ•°æ®å¯è¯» æˆ– tcpè¢«å¯¹æ–¹å…³é—­æˆ–å¯¹æ–¹å…³é—­äº†å†™æ“ä½œ fds[1].revents = 0; char read_buf[BUFFER_SIZE]; int pipefd[2]; int ret = pipe(pipefd);//pipefdåˆ›å»ºæ–‡ä»¶æè¿°ç¬¦ assert(ret != -1); while (1) &#123; //ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«ç›‘å¬äº‹ä»¶é›†åˆfdsçš„å¤§å° ret = poll(fds, 2, -1);//è½®è¯¢æ–‡ä»¶æè¿°ç¬¦ï¼Œçœ‹æ˜¯å¦æœ‰å°±ç»ªè€… -1ï¼šæ°¸è¿œé˜»å¡ã€‚ç›´åˆ°ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿ if (ret &lt; 0)//å¤±è´¥è¿”å›-1 &#123; printf(&quot;poll failure\\n&quot;); break; &#125; if (fds[1].revents &amp; POLLRDHUP) &#123; printf(&quot;server close the connection\\n&quot;); break; &#125; else if (fds[1].revents &amp; POLLIN) &#123; memset(read_buf, &#x27;\\0&#x27;, BUFFER_SIZE); recv(fds[1].fd, read_buf, BUFFER_SIZE - 1, 0); printf(&quot;%s\\n&quot;, read_buf); &#125; if (fds[0].revents &amp; POLLIN)//ï¼Ÿï¼Ÿï¼Ÿä¸ºå•¥ä¸æ˜¯POLLOUT &#123; /*ä½¿ç”¨spliceå°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ç›´æ¥å†™åˆ°sockfdä¸Šï¼ˆé›¶æ‹·è´ï¼‰*/ ret = splice(0, NULL, pipefd[1], NULL, 32768, SPLICE_F_MORE | SPLICE_F_MOVE); ret = splice(pipefd[0], NULL, sockfd, NULL, 32768, SPLICE_F_MORE | SPLICE_F_MOVE); &#125; &#125; close(sockfd); return 0;&#125; å“ªé‡Œå†™æ•°æ®ï¼Ÿï¼Ÿï¼Ÿ æœåŠ¡å™¨ä½¿ç”¨pollåŒæ—¶ç®¡ç†ç›‘å¬socketå’Œè¿æ¥socketï¼Œå¹¶ä¸”ä½¿ç”¨ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´çš„ç­–ç•¥æ¥æé«˜æœåŠ¡å™¨æ€§èƒ½ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184#define _GNU_SOURCE 1#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;#include &lt;poll.h&gt;#define USER_LIMIT 5 /*æœ€å¤§ç”¨æˆ·æ•°é‡*/#define BUFFER_SIZE 64 /*è¯»ç¼“å†²åŒºçš„å¤§å°*/#define FD_LIMIT 65535 /*æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶*//*å®¢æˆ·æ•°æ®ï¼šå®¢æˆ·ç«¯socketåœ°å€ã€å¾…å†™åˆ°å®¢æˆ·ç«¯çš„æ•°æ®çš„ä½ç½®ã€ä»å®¢æˆ·ç«¯è¯»å…¥çš„æ•°æ®*/struct client_data&#123; sockaddr_in address; char *write_buf; char buf[BUFFER_SIZE];&#125;;int setnonblocking(int fd)&#123; int old_option = fcntl(fd, F_GETFL); int new_option = old_option | O_NONBLOCK; fcntl(fd, F_SETFL, new_option); return old_option;&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int listenfd = socket(PF_INET, SOCK_STREAM, 0); assert(listenfd &gt;= 0); ret = bind(listenfd, (struct sockaddr *)&amp;address, sizeof(address)); assert(ret != -1); ret = listen(listenfd, 5); assert(ret != -1); /*åˆ›å»ºusersæ•°ç»„ï¼Œåˆ†é…FD_LIMITä¸ªclient_dataå¯¹è±¡ã€‚å¯ä»¥é¢„æœŸï¼šæ¯ä¸ªå¯èƒ½çš„ socketè¿æ¥éƒ½å¯ä»¥è·å¾—ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œå¹¶ä¸”socketçš„å€¼å¯ä»¥ç›´æ¥ç”¨æ¥ç´¢å¼•ï¼ˆä½œä¸ºæ•°ç»„çš„ ä¸‹æ ‡ï¼‰socketè¿æ¥å¯¹åº”çš„client_dataå¯¹è±¡ï¼Œè¿™æ˜¯å°†socketå’Œå®¢æˆ·æ•°æ®å…³è”çš„ç®€å•è€Œé«˜ æ•ˆçš„æ–¹å¼*/ client_data *users = new client_data[FD_LIMIT]; /*å°½ç®¡æˆ‘ä»¬åˆ†é…äº†è¶³å¤Ÿå¤šçš„client_dataå¯¹è±¡ï¼Œä½†ä¸ºäº†æé«˜pollçš„æ€§èƒ½ï¼Œä»ç„¶æœ‰å¿…è¦é™åˆ¶ç”¨æˆ·çš„æ•°é‡*/ pollfd fds[USER_LIMIT + 1]; int user_counter = 0; for (int i = 1; i &lt;= USER_LIMIT; ++i) &#123; fds[i].fd = -1; fds[i].events = 0; &#125; fds[0].fd = listenfd; fds[0].events = POLLIN | POLLERR; fds[0].revents = 0; while (1) &#123; ret = poll(fds, user_counter + 1, -1); if (ret &lt; 0) &#123; printf(&quot;poll failure\\n&quot;); break; &#125; for (int i = 0; i &lt; user_counter + 1; ++i) &#123; if ((fds[i].fd == listenfd) &amp;&amp; (fds[i].revents &amp; POLLIN)) &#123; struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); if (connfd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); continue; &#125; /*å¦‚æœè¯·æ±‚å¤ªå¤šï¼Œåˆ™å…³é—­æ–°åˆ°çš„è¿æ¥*/ if (user_counter &gt;= USER_LIMIT) &#123; const char *info = &quot;too many users\\n&quot;; printf(&quot;%s&quot;, info); send(connfd, info, strlen(info), 0); close(connfd); continue; &#125; /*å¯¹äºæ–°çš„è¿æ¥ï¼ŒåŒæ—¶ä¿®æ”¹fdså’Œusersæ•°ç»„ã€‚å‰æ–‡å·²ç»æåˆ°ï¼Œusers[connfd]å¯¹åº” äºæ–°è¿æ¥æ–‡ä»¶æè¿°ç¬¦connfdçš„å®¢æˆ·æ•°æ®*/ user_counter++; users[connfd].address = client_address; setnonblocking(connfd); fds[user_counter].fd = connfd; fds[user_counter].events = POLLIN | POLLRDHUP | POLLERR; fds[user_counter].revents = 0; printf(&quot;comes a new user,now have%d users\\n&quot;, user_counter); &#125; else if (fds[i].revents &amp; POLLERR) &#123; printf(&quot;get an error from%d\\n&quot;, fds[i].fd); char errors[100]; memset(errors, &#x27;\\0&#x27;, 100); socklen_t length = sizeof(errors); if (getsockopt(fds[i].fd, SOL_SOCKET, SO_ERROR, &amp;errors, &amp;length) &lt; 0) &#123; printf(&quot;get socket option failed\\n&quot;); &#125; continue; &#125; else if (fds[i].revents &amp; POLLRDHUP) &#123; /*å¦‚æœå®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œåˆ™æœåŠ¡å™¨ä¹Ÿå…³é—­å¯¹åº”çš„è¿æ¥ï¼Œå¹¶å°†ç”¨æˆ·æ€»æ•°å‡1*/ users[fds[i].fd] = users[fds[user_counter].fd]; close(fds[i].fd); fds[i] = fds[user_counter]; i--; user_counter--; printf(&quot;a client left\\n&quot;); &#125; else if (fds[i].revents &amp; POLLIN) &#123; int connfd = fds[i].fd; memset(users[connfd].buf, &#x27;\\0&#x27;, BUFFER_SIZE); ret = recv(connfd, users[connfd].buf, BUFFER_SIZE - 1, 0); printf(&quot;get%d bytes of client data%sfrom%d\\n&quot;, ret, users[connfd].buf, connfd); if (ret &lt; 0) &#123; /*å¦‚æœè¯»æ“ä½œå‡ºé”™ï¼Œåˆ™å…³é—­è¿æ¥*/ if (errno != EAGAIN) &#123; close(connfd); users[fds[i].fd] = users[fds[user_counter].fd]; fds[i] = fds[user_counter]; i--; user_counter--; &#125; &#125; else if (ret == 0) &#123; &#125; else &#123; /*å¦‚æœæ¥æ”¶åˆ°å®¢æˆ·æ•°æ®ï¼Œåˆ™é€šçŸ¥å…¶ä»–socketè¿æ¥å‡†å¤‡å†™æ•°æ®*/ for (int j = 1; j &lt;= user_counter; ++j) &#123; if (fds[j].fd == connfd) &#123; continue; &#125; fds[j].events |= ~POLLIN; fds[j].events |= POLLOUT; users[fds[j].fd].write_buf = users[connfd].buf; &#125; &#125; &#125; else if (fds[i].revents &amp; POLLOUT) &#123; int connfd = fds[i].fd; if (!users[connfd].write_buf) &#123; continue; &#125; ret = send(connfd, users[connfd].write_buf, strlen(users[connfd].write_buf), 0); users[connfd].write_buf = NULL; /*å†™å®Œæ•°æ®åéœ€è¦é‡æ–°æ³¨å†Œfds[i]ä¸Šçš„å¯è¯»äº‹ä»¶*/ fds[i].events |= ~POLLOUT; fds[i].events |= POLLIN; &#125; &#125; &#125; delete[] users; close(listenfd); return 0;&#125; ###I&#x2F;Oå¤ç”¨çš„é«˜çº§åº”ç”¨ä¸‰ï¼šåŒæ—¶å¤„ç†TCPå’ŒUDPæœåŠ¡ è¶…çº§æœåŠ¡xinetdä¿¡å·ä¿¡å·æ˜¯ç”±ç”¨æˆ·ã€ç³»ç»Ÿæˆ–è€…è¿›ç¨‹ å‘é€ç»™ ç›®æ ‡è¿›ç¨‹ çš„ä¿¡æ¯ï¼Œä»¥é€šçŸ¥ç›®æ ‡è¿›ç¨‹æŸä¸ªçŠ¶æ€çš„æ”¹å˜æˆ–ç³»ç»Ÿå¼‚å¸¸ å¯¹äºå‰å°è¿›ç¨‹ï¼Œæ¯”å¦‚è¾“å…¥Ctrl+Cé€šå¸¸ä¼šç»™è¿›ç¨‹å‘é€ä¸€ä¸ªä¸­æ–­ä¿¡å· ç³»ç»Ÿå¼‚å¸¸ã€‚æ¯”å¦‚æµ®ç‚¹å¼‚å¸¸å’Œéæ³•å†…å­˜æ®µè®¿é—®ã€‚ ç³»ç»ŸçŠ¶æ€å˜åŒ–ã€‚æ¯”å¦‚alarmå®šæ—¶å™¨åˆ°æœŸå°†å¼•èµ·SIGALRMä¿¡å·ã€‚ è¿è¡Œkillå‘½ä»¤æˆ–è°ƒç”¨killå‡½æ•°ã€‚ æœåŠ¡å™¨ç¨‹åºå¿…é¡»å¤„ç†ï¼ˆæˆ–è‡³å°‘å¿½ç•¥ï¼‰ä¸€äº›å¸¸è§çš„ä¿¡å·ï¼Œä»¥å…å¼‚å¸¸ç»ˆæ­¢ Linuxä¿¡å·æ¦‚è¿°å‘é€ä¿¡å·Linuxä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹ç»™å…¶ä»–è¿›ç¨‹å‘é€ä¿¡å·çš„APIæ˜¯killå‡½æ•°ã€‚ 123#includeï¼œsys/types.hï¼#includeï¼œsignal.hï¼int kill(pid_t pid,int sig); è¯¥å‡½æ•°æŠŠä¿¡å·sigå‘é€ç»™ç›®æ ‡è¿›ç¨‹ï¼›ç›®æ ‡è¿›ç¨‹ç”±pidå‚æ•°æŒ‡å®šï¼Œå…¶å¯èƒ½çš„å–å€¼åŠå«ä¹‰å¦‚è¡¨æ‰€ç¤ºã€‚ Linuxå®šä¹‰çš„ä¿¡å·å€¼éƒ½å¤§äº0ï¼Œå¦‚æœsigå–å€¼ä¸º0ï¼Œåˆ™killå‡½æ•°ä¸å‘é€ä»»ä½•ä¿¡å·ã€‚ä½†å°†sigè®¾ç½®ä¸º0å¯ä»¥ç”¨æ¥æ£€æµ‹ç›®æ ‡è¿›ç¨‹æˆ–è¿›ç¨‹ç»„æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºæ£€æŸ¥å·¥ä½œæ€»æ˜¯åœ¨ä¿¡å·å‘é€ä¹‹å‰å°±æ‰§è¡Œã€‚ä¸è¿‡è¿™ç§æ£€æµ‹æ–¹å¼æ˜¯ä¸å¯é çš„ã€‚ä¸€æ–¹é¢ç”±äºè¿›ç¨‹PIDçš„å›ç»•ï¼Œå¯èƒ½å¯¼è‡´è¢«æ£€æµ‹çš„PIDä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„è¿›ç¨‹çš„PIDï¼›å¦ä¸€æ–¹é¢ï¼Œè¿™ç§æ£€æµ‹æ–¹æ³•ä¸æ˜¯åŸå­æ“ä½œã€‚ è¯¥å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚å‡ ç§å¯èƒ½çš„errno ä¿¡å·å¤„ç†æ–¹å¼ç›®æ ‡è¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·æ—¶ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ¥æ”¶å‡½æ•°æ¥å¤„ç†ä¹‹ã€‚ä¿¡å·å¤„ç†å‡½æ•°çš„åŸå‹å¦‚ä¸‹ 12#includeï¼œsignal.hï¼typedef void(*__sighandler_t)(int); ä¿¡å·å¤„ç†å‡½æ•°åªå¸¦æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°ï¼Œè¯¥å‚æ•°ç”¨æ¥æŒ‡ç¤ºä¿¡å·ç±»å‹ã€‚ä¿¡å·å¤„ç†å‡½æ•°åº”è¯¥æ˜¯å¯é‡å…¥çš„ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å¼•å‘ä¸€äº›ç«æ€æ¡ä»¶ã€‚æ‰€ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ä¸¥ç¦è°ƒç”¨ä¸€äº›ä¸å®‰å…¨çš„å‡½æ•°ã€‚é™¤äº†ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·å¤„ç†å‡½æ•°å¤–ï¼Œbits&#x2F;signum.hå¤´æ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¿¡å·çš„ä¸¤ç§å…¶ä»–å¤„ç†æ–¹å¼â€”â€”SIG_IGNå’ŒSIG_DELï¼š 1234#includeï¼œbits/signum.hï¼#define SIG_DFL((__sighandler_t)0)#define SIG_IGN((__sighandler_t)1)//SIG_IGNè¡¨ç¤ºå¿½ç•¥ç›®æ ‡ä¿¡å·ï¼ŒSIG_DFLè¡¨ç¤ºä½¿ç”¨ä¿¡å·çš„é»˜è®¤å¤„ç†æ–¹å¼ã€‚ä¿¡å·çš„é»˜è®¤å¤„ç†æ–¹å¼æœ‰å¦‚ä¸‹å‡ ç§ï¼šç»“æŸè¿›ç¨‹ï¼ˆTermï¼‰ã€å¿½ç•¥ä¿¡å·ï¼ˆIgnï¼‰ã€ç»“æŸè¿›ç¨‹å¹¶ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼ˆCoreï¼‰ã€æš‚åœè¿›ç¨‹ï¼ˆStopï¼‰ï¼Œä»¥åŠç»§ç»­è¿›ç¨‹ï¼ˆContï¼‰ã€‚ ä¸­æ–­ç³»ç»Ÿè°ƒç”¨å¦‚æœç¨‹åºåœ¨æ‰§è¡Œå¤„äºé˜»å¡çŠ¶æ€çš„ç³»ç»Ÿè°ƒç”¨æ—¶æ¥æ”¶åˆ°ä¿¡å·ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ºè¯¥ä¿¡å·è®¾ç½®äº†ä¿¡å·å¤„ç†å‡½æ•°ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ç³»ç»Ÿè°ƒç”¨å°†è¢«ä¸­æ–­ï¼Œå¹¶ä¸”errnoè¢«è®¾ç½®ä¸ºEINTRã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨sigactionå‡½æ•°ï¼ˆè§åæ–‡ï¼‰ä¸ºä¿¡å·è®¾ç½®SA_RESTARTæ ‡å¿—ä»¥è‡ªåŠ¨é‡å¯è¢«è¯¥ä¿¡å·ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨ã€‚ å¯¹äºé»˜è®¤è¡Œä¸ºæ˜¯æš‚åœè¿›ç¨‹çš„ä¿¡å·ï¼ˆæ¯”å¦‚SIGSTOPã€SIGTTINï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸ºå®ƒä»¬è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ï¼Œåˆ™å®ƒä»¬ä¹Ÿå¯ä»¥ä¸­æ–­æŸäº›ç³»ç»Ÿè°ƒç”¨ï¼ˆæ¯”å¦‚connectã€epoll_waitï¼‰ã€‚POSIXæ²¡æœ‰è§„å®šè¿™ç§è¡Œä¸ºï¼Œè¿™æ˜¯Linuxç‹¬æœ‰çš„ã€‚ ä¿¡å·å‡½æ•°signalç³»ç»Ÿè°ƒç”¨ä¸ºä¸€ä¸ªä¿¡å·è®¾ç½®å¤„ç†å‡½æ•° 12#includeï¼œsignal.hï¼_sighandler_t signal(int sig,_sighandler_t_handler) sigå‚æ•°æŒ‡å‡ºè¦æ•è·çš„ä¿¡å·ç±»å‹ã€‚_handlerå‚æ•°æ˜¯_sighandler_tç±»å‹çš„å‡½æ•°æŒ‡é’ˆï¼Œç”¨äºæŒ‡å®šä¿¡å·sigçš„å¤„ç†å‡½æ•°ã€‚ signalå‡½æ•°æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¯¥å‡½æ•°æŒ‡é’ˆçš„ç±»å‹ä¹Ÿæ˜¯_sighandler_tã€‚è¿™ä¸ªè¿”å›å€¼æ˜¯å‰ä¸€æ¬¡è°ƒç”¨signalå‡½æ•°æ—¶ä¼ å…¥çš„å‡½æ•°æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¿¡å·sigå¯¹åº”çš„é»˜è®¤å¤„ç†å‡½æ•°æŒ‡é’ˆSIG_DEFï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨signalçš„è¯ï¼‰ã€‚ signalç³»ç»Ÿè°ƒç”¨å‡ºé”™æ—¶è¿”å›SIG_ERRï¼Œå¹¶è®¾ç½®errnoã€‚ sigactionç³»ç»Ÿè°ƒç”¨è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°æ›´å¥½çš„ç‰ˆæœ¬ 12#includeï¼œsignal.hï¼int sigaction(int sig,const struct sigaction*act,struct sigaction*oact); sigå‚æ•°æŒ‡å‡ºè¦æ•è·çš„ä¿¡å·ç±»å‹ï¼Œactå‚æ•°æŒ‡å®šæ–°çš„ä¿¡å·å¤„ç†æ–¹å¼ï¼Œoactå‚æ•°åˆ™è¾“å‡ºä¿¡å·å…ˆå‰çš„å¤„ç†æ–¹å¼ï¼ˆå¦‚æœä¸ä¸ºNULLçš„è¯ï¼‰ã€‚actå’Œoactéƒ½æ˜¯sigactionç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œsigactionç»“æ„ä½“æè¿°äº†ä¿¡å·å¤„ç†çš„ç»†èŠ‚ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516struct sigaction&#123; #ifdef__USE_POSIX199309 union&#123; _sighandler_t sa_handler; void(*sa_sigaction)(int,siginfo_t*,void*); &#125; _sigaction_handler;#define sa_handler__sigaction_handler.sa_handler#define sa_sigaction__sigaction_handler.sa_sigaction#else _sighandler_t sa_handler;#endif _sigset_t sa_mask; int sa_flags; void(*sa_restorer)(void);&#125;; è¯¥ç»“æ„ä½“ä¸­çš„sa_handeræˆå‘˜æŒ‡å®šä¿¡å·å¤„ç†å‡½æ•°ã€‚sa_maskæˆå‘˜è®¾ç½®è¿›ç¨‹çš„ä¿¡å·æ©ç ï¼ˆç¡®åˆ‡åœ°è¯´æ˜¯åœ¨è¿›ç¨‹åŸæœ‰ä¿¡å·æ©ç çš„åŸºç¡€ä¸Šå¢åŠ ä¿¡å·æ©ç ï¼‰ï¼Œä»¥æŒ‡å®šå“ªäº›ä¿¡å·ä¸èƒ½å‘é€ç»™æœ¬è¿›ç¨‹ã€‚sa_maskæ˜¯ä¿¡å·é›†sigset_tï¼ˆ_sigset_tçš„åŒä¹‰è¯ï¼‰ç±»å‹ï¼Œè¯¥ç±»å‹æŒ‡å®šä¸€ç»„ä¿¡å·ã€‚å…³äºä¿¡å·é›†ï¼Œæˆ‘ä»¬å°†åœ¨åé¢ä»‹ç»ã€‚sa_flagsæˆå‘˜ç”¨äºè®¾ç½®ç¨‹åºæ”¶åˆ°ä¿¡å·æ—¶çš„è¡Œä¸ºï¼Œå…¶å¯é€‰å€¼å¦‚è¡¨10-4æ‰€ç¤ºã€‚ sa_restoreræˆå‘˜å·²ç»è¿‡æ—¶ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ã€‚sigactionæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚ ä¿¡å·é›†Linuxä½¿ç”¨æ•°æ®ç»“æ„sigset_tæ¥è¡¨ç¤ºä¸€ç»„ä¿¡å·ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š 12345#includeï¼œbits/sigset.hï¼#define_SIGSET_NWORDS(1024/(8*sizeof(unsigned long int)))typedef struct&#123; unsigned long int__val[_SIGSET_NWORDS];&#125;__sigset_t; ç”±è¯¥å®šä¹‰å¯è§ï¼Œsigset_tå®é™…ä¸Šæ˜¯ä¸€ä¸ªé•¿æ•´å‹æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„æ¯ä¸ªä½è¡¨ç¤ºä¸€ä¸ªä¿¡å·ã€‚è¿™ç§å®šä¹‰æ–¹å¼å’Œæ–‡ä»¶æè¿°ç¬¦é›†fd_setç±»ä¼¼ã€‚Linuxæä¾›äº†å¦‚ä¸‹ä¸€ç»„å‡½æ•°æ¥è®¾ç½®ã€ä¿®æ”¹ã€åˆ é™¤å’ŒæŸ¥è¯¢ä¿¡å·é›†ï¼š è¿›ç¨‹ä¿¡å·æ©ç è¢«æŒ‚èµ·çš„ä¿¡å·è®¾ç½®è¿›ç¨‹ä¿¡å·æ©ç åï¼Œè¢«å±è”½çš„ä¿¡å·å°†ä¸èƒ½è¢«è¿›ç¨‹æ¥æ”¶ã€‚ ç»Ÿä¸€äº‹ä»¶æºä¿¡å·æ˜¯ä¸€ç§å¼‚æ­¥äº‹ä»¶ï¼šä¿¡å·å¤„ç†å‡½æ•°å’Œç¨‹åºçš„ä¸»å¾ªç¯æ˜¯ä¸¤æ¡ä¸åŒçš„æ‰§è¡Œè·¯çº¿ã€‚å¾ˆæ˜¾ç„¶ï¼Œä¿¡å·å¤„ç†å‡½æ•°éœ€è¦å°½å¯èƒ½å¿«åœ°æ‰§è¡Œå®Œæ¯•ï¼Œä»¥ç¡®ä¿è¯¥ä¿¡å·ä¸è¢«å±è”½ï¼ˆå‰é¢æåˆ°è¿‡ï¼Œä¸ºäº†é¿å…ä¸€äº›ç«æ€æ¡ä»¶ï¼Œä¿¡å·åœ¨å¤„ç†æœŸé—´ï¼Œç³»ç»Ÿä¸ä¼šå†æ¬¡è§¦å‘å®ƒï¼‰å¤ªä¹…ã€‚ä¸€ç§å…¸å‹çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæŠŠä¿¡å·çš„ä¸»è¦å¤„ç†é€»è¾‘æ”¾åˆ°ç¨‹åºçš„ä¸»å¾ªç¯ä¸­ï¼Œå½“ä¿¡å·å¤„ç†å‡½æ•°è¢«è§¦å‘æ—¶ï¼Œå®ƒåªæ˜¯ç®€å•åœ°é€šçŸ¥ä¸»å¾ªç¯ç¨‹åºæ¥æ”¶åˆ°ä¿¡å·ï¼Œå¹¶æŠŠä¿¡å·å€¼ä¼ é€’ç»™ä¸»å¾ªç¯ï¼Œä¸»å¾ªç¯å†æ ¹æ®æ¥æ”¶åˆ°çš„ä¿¡å·å€¼æ‰§è¡Œç›®æ ‡ä¿¡å·å¯¹åº”çš„é€»è¾‘ä»£ç ã€‚ä¿¡å·å¤„ç†å‡½æ•°é€šå¸¸ä½¿ç”¨ç®¡é“æ¥å°†ä¿¡å·â€œä¼ é€’â€ç»™ä¸»å¾ªç¯ï¼šä¿¡å·å¤„ç†å‡½æ•°å¾€ç®¡é“çš„å†™ç«¯å†™å…¥ä¿¡å·å€¼ï¼Œä¸»å¾ªç¯åˆ™ä»ç®¡é“çš„è¯»ç«¯è¯»å‡ºè¯¥ä¿¡å·å€¼ã€‚é‚£ä¹ˆä¸»å¾ªç¯æ€ä¹ˆçŸ¥é“ç®¡é“ä¸Šä½•æ—¶æœ‰æ•°æ®å¯è¯»å‘¢?è¿™å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨æ¥ç›‘å¬ç®¡é“çš„è¯»ç«¯æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å¯è¯»äº‹ä»¶ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¿¡å·äº‹ä»¶å°±èƒ½å’Œå…¶ä»–I&#x2F;Oäº‹ä»¶ä¸€æ ·è¢«å¤„ç†ï¼Œå³ç»Ÿä¸€äº‹ä»¶æºã€‚ ç½‘ç»œç¼–ç¨‹ç›¸å…³ä¿¡å·SIGHUPå½“æŒ‚èµ·è¿›ç¨‹çš„æ§åˆ¶ç»ˆç«¯æ—¶ï¼ŒSIGHUPä¿¡å·å°†è¢«è§¦å‘ã€‚å¯¹äºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„ç½‘ç»œåå°ç¨‹åºè€Œè¨€ï¼Œå®ƒä»¬é€šå¸¸åˆ©ç”¨SIGHUPä¿¡å·æ¥å¼ºåˆ¶æœåŠ¡å™¨é‡è¯»é…ç½®æ–‡ä»¶ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯xinetdè¶…çº§æœåŠ¡ç¨‹åºã€‚xinetdç¨‹åºåœ¨æ¥æ”¶åˆ°SIGHUPä¿¡å·ä¹‹åå°†è°ƒç”¨hard_reconfigå‡½æ•°ï¼ˆè§xinetdæºç ï¼‰ï¼Œå®ƒå¾ªç¯è¯»å–&#x2F;etc&#x2F;xinetd.d&#x2F;ç›®å½•ä¸‹çš„æ¯ä¸ªå­é…ç½®æ–‡ä»¶ï¼Œå¹¶æ£€æµ‹å…¶å˜åŒ–ã€‚å¦‚æœæŸä¸ªæ­£åœ¨è¿è¡Œçš„å­æœåŠ¡çš„é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹ä»¥åœæ­¢æœåŠ¡ï¼Œåˆ™xinetdä¸»è¿›ç¨‹å°†ç»™è¯¥å­æœåŠ¡è¿›ç¨‹å‘é€SIGTERMä¿¡å·ä»¥ç»“æŸå®ƒã€‚å¦‚æœæŸä¸ªå­æœåŠ¡çš„é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹ä»¥å¼€å¯æœåŠ¡ï¼Œåˆ™xinetdå°†åˆ›å»ºæ–°çš„socketå¹¶å°†å…¶ç»‘å®šåˆ°è¯¥æœåŠ¡å¯¹åº”çš„ç«¯å£ä¸Šã€‚ä¸‹é¢æˆ‘ä»¬ç®€å•åœ°åˆ†æxinetdå¤„ç†SIGHUPä¿¡å·çš„æµç¨‹ã€‚ ##å®šæ—¶å™¨ æ¯”å¦‚å®šæœŸæ£€æµ‹ä¸€ä¸ªå®¢æˆ·è¿æ¥çš„æ´»åŠ¨çŠ¶æ€ã€‚æˆ‘ä»¬è¦å°†æ¯ä¸ªå®šæ—¶äº‹ä»¶åˆ†åˆ«å°è£…æˆå®šæ—¶å™¨ï¼Œå¹¶ä½¿ç”¨æŸç§å®¹å™¨ç±»æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚é“¾è¡¨ã€æ’åºé“¾è¡¨å’Œæ—¶é—´è½®ï¼Œå°†æ‰€æœ‰å®šæ—¶å™¨ä¸²è”èµ·æ¥ï¼Œä»¥å®ç°å¯¹å®šæ—¶äº‹ä»¶çš„ç»Ÿä¸€ç®¡ç†ã€‚ å®šæ—¶æ˜¯æŒ‡åœ¨ä¸€æ®µæ—¶é—´ä¹‹åè§¦å‘æŸæ®µä»£ç çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™æ®µä»£ç ä¸­ä¾æ¬¡å¤„ç†æ‰€æœ‰åˆ°æœŸçš„å®šæ—¶å™¨ linuxä¸‰ç§å®šæ—¶æ–¹æ³• socketé€‰é¡¹SO_RCVTIMEOå’ŒSO_SNDTIMEO SIGALRMä¿¡å· I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨çš„è¶…æ—¶å‚æ•° ###socketé€‰é¡¹SO_RCVTIMEOå’ŒSO_SNDTIMEO åˆ†åˆ«è®¾ç½®socketæ¥æ”¶æ•°æ®è¶…æ—¶æ—¶é—´å’Œå‘é€æ•°æ®è¶…æ—¶æ—¶é—´ æˆ‘ä»¬å¯ä»¥æ ¹æ®ç³»ç»Ÿè°ƒç”¨ï¼ˆsendã€sendmsgã€recvã€recvmsgã€acceptå’Œconnectï¼‰çš„è¿”å›å€¼ä»¥åŠerrnoæ¥åˆ¤æ–­è¶…æ—¶æ—¶é—´æ˜¯å¦å·²åˆ°ï¼Œè¿›è€Œå†³å®šæ˜¯å¦å¼€å§‹å¤„ç†å®šæ—¶ä»»åŠ¡ã€‚ connectä¸ºä¾‹ï¼Œè¯´æ˜ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨SO_SNDTIMEOé€‰é¡¹æ¥å®šæ—¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;stdlib.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;errno.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;/*è¶…æ—¶è¿æ¥å‡½æ•°*/int timeout_connect(const char *ip, int port, int time)&#123; int ret = 0; struct sockaddr_in address; bzero(&amp;address, sizeof(address)); address.sin_family = AF_INET; inet_pton(AF_INET, ip, &amp;address.sin_addr); address.sin_port = htons(port); int sockfd = socket(PF_INET, SOCK_STREAM, 0); assert(sockfd &gt;= 0); /*é€šè¿‡é€‰é¡¹SO_RCVTIMEOå’ŒSO_SNDTIMEOæ‰€è®¾ç½®çš„è¶…æ—¶æ—¶é—´çš„ç±»å‹æ˜¯timevalï¼Œè¿™å’Œ selectç³»ç»Ÿè°ƒç”¨çš„è¶…æ—¶å‚æ•°ç±»å‹ç›¸åŒ*/ struct timeval timeout; timeout.tv_sec = time; timeout.tv_usec = 0; socklen_t len = sizeof(timeout); ret = setsockopt(sockfd, SOL_SOCKET, SO_SNDTIMEO, &amp;timeout, len); assert(ret != -1); ret = connect(sockfd, (struct sockaddr *)&amp;address, sizeof(address)); if (ret == -1) &#123; /*è¶…æ—¶å¯¹åº”çš„é”™è¯¯å·æ˜¯EINPROGRESSã€‚ä¸‹é¢è¿™ä¸ªæ¡ä»¶å¦‚æœæˆç«‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤„ç†å®šæ—¶ä»» åŠ¡äº†*/ if (errno == EINPROGRESS) &#123; printf(&quot;connecting timeout,process timeout logic\\n&quot;); return -1; &#125; printf(&quot;error occur when connecting to server\\n&quot;); return -1; &#125; return sockfd;&#125;int main(int argc, char *argv[])&#123; if (argc &lt;= 2) &#123; printf(&quot;usage:%s ip_address port_number\\n&quot;, basename(argv[0])); return 1; &#125; const char *ip = argv[1]; int port = atoi(argv[2]); int sockfd = timeout_connect(ip, port, 10); if (sockfd &lt; 0) &#123; return 1; &#125; return 0;&#125; SIGALRMä¿¡å·ç”±alarmå’Œsetitimerå‡½æ•°è®¾ç½®çš„å®æ—¶é—¹é’Ÿä¸€æ—¦è¶…æ—¶ï¼Œå°†è§¦å‘SIGALRMä¿¡å·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥ä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°æ¥å¤„ç†å®šæ—¶ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å¤„ç†å¤šä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸æ–­åœ°è§¦å‘SIGALRMä¿¡å·ï¼Œå¹¶åœ¨å…¶ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ‰§è¡Œåˆ°æœŸçš„ä»»åŠ¡ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒSIGALRMä¿¡å·æŒ‰ç…§å›ºå®šçš„é¢‘ç‡ç”Ÿæˆï¼Œå³ç”±alarmæˆ–setitimerå‡½æ•°è®¾ç½®çš„å®šæ—¶å‘¨æœŸTä¿æŒä¸å˜ã€‚å¦‚æœæŸä¸ªå®šæ—¶ä»»åŠ¡çš„è¶…æ—¶æ—¶é—´ä¸æ˜¯Tçš„æ•´æ•°å€ï¼Œé‚£ä¹ˆå®ƒå®é™…è¢«æ‰§è¡Œçš„æ—¶é—´å’Œé¢„æœŸçš„æ—¶é—´å°†ç•¥æœ‰åå·®ã€‚å› æ­¤å®šæ—¶å‘¨æœŸTåæ˜ äº†å®šæ—¶çš„ç²¾åº¦ã€‚ æœ¬èŠ‚ä¸­æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹â€”â€”å¤„ç†éæ´»åŠ¨è¿æ¥ï¼Œæ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨SIGALRMä¿¡å·å®šæ—¶ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç»™å‡ºä¸€ç§ç®€å•çš„å®šæ—¶å™¨å®ç°â€”â€”åŸºäºå‡åºé“¾è¡¨çš„å®šæ—¶å™¨ï¼Œå¹¶æŠŠå®ƒåº”ç”¨åˆ°å¤„ç†éæ´»åŠ¨è¿æ¥è¿™ä¸ªå®ä¾‹ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½è§‚å¯Ÿåˆ°SIGALRMä¿¡å·å¤„ç†å‡½æ•°æ˜¯å¦‚ä½•å¤„ç†å®šæ—¶å™¨å¹¶æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä»‹ç»è¿™ç§å®šæ—¶å™¨ä¹Ÿæ˜¯ä¸ºäº†å’Œåé¢è¦è®¨è®ºçš„é«˜æ•ˆå®šæ—¶å™¨â€”â€”æ—¶é—´è½®å’Œæ—¶é—´å †åšå¯¹æ¯”ã€‚ åŸºäºå‡åºé“¾è¡¨çš„å®šæ—¶å™¨å®šæ—¶å™¨é€šå¸¸è‡³å°‘è¦åŒ…å«ä¸¤ä¸ªæˆå‘˜ï¼šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼ˆç›¸å¯¹æ—¶é—´æˆ–è€…ç»å¯¹æ—¶é—´ï¼‰å’Œä¸€ä¸ªä»»åŠ¡å›è°ƒå‡½æ•°ã€‚æœ‰çš„æ—¶å€™è¿˜å¯èƒ½åŒ…å«å›è°ƒå‡½æ•°è¢«æ‰§è¡Œæ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠæ˜¯å¦é‡å¯å®šæ—¶å™¨ç­‰ä¿¡æ¯ã€‚ å‡åºå®šæ—¶å™¨é“¾è¡¨å°†å…¶ä¸­çš„å®šæ—¶å™¨æŒ‰ç…§è¶…æ—¶æ—¶é—´åšå‡åºæ’åºã€‚ ä»£ç ã€‚ã€‚ã€‚ ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œæˆ‘ä»¬å°†å®ç°åŒ…å«åœ¨å¤´æ–‡ä»¶ä¸­ã€‚sort_timer_lstæ˜¯ä¸€ä¸ªå‡åºé“¾è¡¨ã€‚å…¶æ ¸å¿ƒå‡½æ•°tickç›¸å½“äºä¸€ä¸ªå¿ƒæå‡½æ•°ï¼Œå®ƒæ¯éš”ä¸€æ®µå›ºå®šçš„æ—¶é—´å°±æ‰§è¡Œä¸€æ¬¡ï¼Œä»¥æ£€æµ‹å¹¶å¤„ç†åˆ°æœŸçš„ä»»åŠ¡ã€‚åˆ¤æ–­å®šæ—¶ä»»åŠ¡åˆ°æœŸçš„ä¾æ®æ˜¯å®šæ—¶å™¨çš„expireå€¼å°äºå½“å‰çš„ç³»ç»Ÿæ—¶é—´ã€‚ä»æ‰§è¡Œæ•ˆç‡æ¥çœ‹ï¼Œæ·»åŠ å®šæ—¶å™¨çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œåˆ é™¤å®šæ—¶å™¨çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚ å¤„ç†éæ´»åŠ¨è¿æ¥å‡åºå®šæ—¶å™¨é“¾è¡¨çš„å®é™…åº”ç”¨-å®šæœŸå¤„ç†éæ´»åŠ¨è¿æ¥ ç»™å®¢æˆ·ç«¯å‘ä¸€ä¸ªé‡è¿è¯·æ±‚ï¼Œæˆ–è€…å…³é—­è¯¥è¿æ¥ï¼Œæˆ–è€…å…¶ä»–ã€‚Linuxåœ¨å†…æ ¸ä¸­æä¾›äº†å¯¹è¿æ¥æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€çš„å®šæœŸæ£€æŸ¥æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡socketé€‰é¡¹KEEPALIVEæ¥æ¿€æ´»å®ƒã€‚ä¸è¿‡ä½¿ç”¨è¿™ç§æ–¹å¼å°†ä½¿å¾—åº”ç”¨ç¨‹åºå¯¹è¿æ¥çš„ç®¡ç†å˜å¾—å¤æ‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨åº”ç”¨å±‚å®ç°ç±»ä¼¼äºKEEPALIVEçš„æœºåˆ¶ï¼Œä»¥ç®¡ç†æ‰€æœ‰é•¿æ—¶é—´å¤„äºéæ´»åŠ¨çŠ¶æ€çš„è¿æ¥ã€‚æ¯”å¦‚ï¼Œä»£ç æ¸…å•11-3åˆ©ç”¨alarmå‡½æ•°å‘¨æœŸæ€§åœ°è§¦å‘SIGALRMä¿¡å·ï¼Œè¯¥ä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°åˆ©ç”¨ç®¡é“é€šçŸ¥ä¸»å¾ªç¯æ‰§è¡Œå®šæ—¶å™¨é“¾è¡¨ä¸Šçš„å®šæ—¶ä»»åŠ¡â€”â€”å…³é—­éæ´»åŠ¨çš„è¿æ¥ã€‚ ä»£ç ã€‚ã€‚ã€‚ I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨çš„è¶…æ—¶å‚æ•°Linuxä¸‹çš„3ç»„I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨éƒ½å¸¦æœ‰è¶…æ—¶å‚æ•°ï¼Œå› æ­¤å®ƒä»¬ä¸ä»…èƒ½ç»Ÿä¸€å¤„ç†ä¿¡å·å’ŒI&#x2F;Oäº‹ä»¶ï¼Œä¹Ÿèƒ½ç»Ÿä¸€å¤„ç†å®šæ—¶äº‹ä»¶ã€‚ä½†æ˜¯ç”±äºI&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨å¯èƒ½åœ¨è¶…æ—¶æ—¶é—´åˆ°æœŸä¹‹å‰å°±è¿”å›ï¼ˆæœ‰I&#x2F;Oäº‹ä»¶å‘ç”Ÿï¼‰ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦åˆ©ç”¨å®ƒä»¬æ¥å®šæ—¶ï¼Œå°±éœ€è¦ä¸æ–­æ›´æ–°å®šæ—¶å‚æ•°ä»¥åæ˜ å‰©ä½™çš„æ—¶é—´ ä»£ç ã€‚ã€‚ã€‚ é«˜æ€§èƒ½å®šæ—¶å™¨æ—¶é—´è½®åŸºäºæ’åºé“¾è¡¨çš„å®šæ—¶å™¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæ·»åŠ å®šæ—¶å™¨çš„æ•ˆç‡åä½ æ—¶é—´å †å‰é¢è®¨è®ºçš„å®šæ—¶æ–¹æ¡ˆéƒ½æ˜¯ä»¥å›ºå®šçš„é¢‘ç‡è°ƒç”¨å¿ƒæå‡½æ•°tickï¼Œå¹¶åœ¨å…¶ä¸­ä¾æ¬¡æ£€æµ‹åˆ°æœŸçš„å®šæ—¶å™¨ï¼Œç„¶åæ‰§è¡Œåˆ°æœŸå®šæ—¶å™¨ä¸Šçš„å›è°ƒå‡½æ•°ã€‚è®¾è®¡å®šæ—¶å™¨çš„å¦å¤–ä¸€ç§æ€è·¯æ˜¯ï¼šå°†æ‰€æœ‰å®šæ—¶å™¨ä¸­è¶…æ—¶æ—¶é—´æœ€å°çš„ä¸€ä¸ªå®šæ—¶å™¨çš„è¶…æ—¶å€¼ä½œä¸ºå¿ƒæé—´éš”ã€‚è¿™æ ·ï¼Œä¸€æ—¦å¿ƒæå‡½æ•°tickè¢«è°ƒç”¨ï¼Œè¶…æ—¶æ—¶é—´æœ€å°çš„å®šæ—¶å™¨å¿…ç„¶åˆ°æœŸï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨tickå‡½æ•°ä¸­å¤„ç†è¯¥å®šæ—¶å™¨ã€‚ç„¶åï¼Œå†æ¬¡ä»å‰©ä½™çš„å®šæ—¶å™¨ä¸­æ‰¾å‡ºè¶…æ—¶æ—¶é—´æœ€å°çš„ä¸€ä¸ªï¼Œå¹¶å°†è¿™æ®µæœ€å°æ—¶é—´è®¾ç½®ä¸ºä¸‹ä¸€æ¬¡å¿ƒæé—´éš”ã€‚å¦‚æ­¤åå¤ï¼Œå°±å®ç°äº†è¾ƒä¸ºç²¾ç¡®çš„å®šæ—¶ æœ€å°å †å¾ˆé€‚åˆå¤„ç†è¿™ç§å®šæ—¶æ–¹æ¡ˆã€‚æœ€å°å †æ˜¯æŒ‡æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼çš„å®Œå…¨äºŒå‰æ ‘ã€‚å›¾11-2ç»™å‡ºäº†ä¸€ä¸ªå…·æœ‰6ä¸ªå…ƒç´ çš„æœ€å°å †ã€‚ é«˜æ€§èƒ½I&#x2F;Oæ¡†æ¶åº“Libeventå‰é¢æˆ‘ä»¬åˆ©ç”¨ä¸‰ç« çš„ç¯‡å¹…è¾ƒä¸ºç»†è‡´åœ°è®¨è®ºäº†LinuxæœåŠ¡å™¨ç¨‹åºå¿…é¡»å¤„ç†çš„ä¸‰ç±»äº‹ä»¶ï¼šI&#x2F;Oäº‹ä»¶ã€ä¿¡å·å’Œå®šæ—¶äº‹ä»¶ã€‚åœ¨å¤„ç†è¿™ä¸‰ç±»äº‹ä»¶æ—¶æˆ‘ä»¬é€šå¸¸éœ€è¦è€ƒè™‘å¦‚ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š ç»Ÿä¸€äº‹ä»¶æºã€‚å¾ˆæ˜æ˜¾ï¼Œç»Ÿä¸€å¤„ç†è¿™ä¸‰ç±»äº‹ä»¶æ—¢èƒ½ä½¿ä»£ç ç®€å•æ˜“æ‡‚ï¼Œåˆèƒ½é¿å…ä¸€äº›æ½œåœ¨çš„é€»è¾‘é”™è¯¯ã€‚å‰é¢æˆ‘ä»¬å·²ç»è®¨è®ºäº†å®ç°ç»Ÿä¸€äº‹ä»¶æºçš„ä¸€èˆ¬æ–¹æ³•â€”â€”åˆ©ç”¨I&#x2F;Oå¤ç”¨ç³»ç»Ÿè°ƒç”¨æ¥ç®¡ç†æ‰€æœ‰äº‹ä»¶ å¯ç§»æ¤æ€§ã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿå…·æœ‰ä¸åŒçš„I&#x2F;Oå¤ç”¨æ–¹å¼ï¼Œæ¯”å¦‚Solarisçš„dev&#x2F;pollæ–‡ä»¶ï¼ŒFreeBSDçš„kqueueæœºåˆ¶ï¼ŒLinuxçš„epollç³»åˆ—ç³»ç»Ÿè°ƒç”¨ã€‚ å¯¹å¹¶å‘ç¼–ç¨‹çš„æ”¯æŒã€‚åœ¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å„æ‰§è¡Œå®ä½“å¦‚ä½•ååŒå¤„ç†å®¢æˆ·è¿æ¥ã€ä¿¡å·å’Œå®šæ—¶å™¨ï¼Œä»¥é¿å…ç«æ€æ¡ä»¶ æ‰€å¹¸çš„æ˜¯ï¼Œå¼€æºç¤¾åŒºæä¾›äº†è¯¸å¤šä¼˜ç§€çš„I&#x2F;Oæ¡†æ¶åº“ã€‚å®ƒä»¬ä¸ä»…è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œè®©å¼€å‘è€…å¯ä»¥å°†ç²¾åŠ›å®Œå…¨æ”¾åœ¨ç¨‹åºçš„é€»è¾‘ä¸Šï¼Œè€Œä¸”ç¨³å®šæ€§ã€æ€§èƒ½ç­‰å„æ–¹é¢éƒ½ç›¸å½“å‡ºè‰²ã€‚æ¯”å¦‚ACEã€ASIOå’ŒLibeventã€‚æœ¬ç« å°†ä»‹ç»å…¶ä¸­ç›¸å¯¹è½»é‡çº§çš„Libeventæ¡†æ¶åº“ã€‚ å¤šè¿›ç¨‹ç¼–ç¨‹ å¤åˆ¶è¿›ç¨‹æ˜ åƒçš„forkç³»ç»Ÿè°ƒç”¨å’Œæ›¿æ¢è¿›ç¨‹æ˜ åƒçš„execç³»åˆ—ç³»ç»Ÿè°ƒç”¨ åƒµå°¸è¿›ç¨‹ä»¥åŠå¦‚ä½•é¿å…åƒµå°¸è¿›ç¨‹ è¿›ç¨‹é—´é€šä¿¡ï¼ˆInter-Process Communicationï¼ŒIPCï¼‰æœ€ç®€å•çš„æ–¹å¼ï¼šç®¡é“ã€‚ 3ç§System Vè¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼šä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜ã€‚å®ƒä»¬éƒ½æ˜¯ç”±ATï¼†T System V2ç‰ˆæœ¬çš„UNIXå¼•å…¥çš„ï¼Œæ‰€ä»¥ç»Ÿç§°ä¸ºSystem V IPC åœ¨è¿›ç¨‹é—´ä¼ é€’æ–‡ä»¶æè¿°ç¬¦çš„é€šç”¨æ–¹æ³•ï¼šé€šè¿‡UNIXæœ¬åœ°åŸŸsocketä¼ é€’ç‰¹æ®Šçš„è¾…åŠ©æ•°æ® ###forkç³»ç»Ÿè°ƒç”¨ åˆ›å»ºæ–°è¿›ç¨‹ å¤šçº¿ç¨‹ç¼–ç¨‹ï¼ˆè¯·å¿½ç•¥ï¼‰æ—©æœŸLinuxä¸æ”¯æŒçº¿ç¨‹ï¼Œç›´åˆ°1996å¹´ï¼ŒXavier Leroyç­‰äººæ‰å¼€å‘å‡ºç¬¬ä¸€ä¸ªåŸºæœ¬ç¬¦åˆPOSIXæ ‡å‡†çš„çº¿ç¨‹åº“LinuxThreadsã€‚ä½†LinuxThreadsæ•ˆç‡ä½è€Œä¸”é—®é¢˜å¾ˆå¤šã€‚è‡ªå†…æ ¸2.6å¼€å§‹ï¼ŒLinuxæ‰çœŸæ­£æä¾›å†…æ ¸çº§çš„çº¿ç¨‹æ”¯æŒï¼Œå¹¶æœ‰ä¸¤ä¸ªç»„ç»‡è‡´åŠ›äºç¼–å†™æ–°çš„çº¿ç¨‹åº“ï¼šNGPTï¼ˆNext Generation POSIX Threadsï¼‰å’ŒNPTLï¼ˆNative POSIX Thread Libraryï¼‰ã€‚ä¸è¿‡å‰è€…åœ¨2003å¹´å°±æ”¾å¼ƒäº†ï¼Œå› æ­¤æ–°çš„çº¿ç¨‹åº“å°±ç§°ä¸ºNPTLã€‚NPTLæ¯”LinuxThreadsæ•ˆç‡é«˜ï¼Œä¸”æ›´ç¬¦åˆPOSIXè§„èŒƒï¼Œæ‰€ä»¥å®ƒå·²ç»æˆä¸ºglibcçš„ä¸€éƒ¨åˆ†ã€‚æœ¬ä¹¦æ‰€æœ‰çº¿ç¨‹ç›¸å…³çš„ä¾‹ç¨‹ä½¿ç”¨çš„çº¿ç¨‹åº“éƒ½æ˜¯NPTLã€‚ æœ¬ç« è¦è®¨è®ºçš„çº¿ç¨‹ç›¸å…³çš„å†…å®¹éƒ½å±äºPOSIXçº¿ç¨‹ï¼ˆç®€ç§°pthreadï¼‰æ ‡å‡†ï¼Œè€Œä¸å±€é™äºNPTLå®ç°ï¼Œå…·ä½“åŒ…æ‹¬ï¼š åˆ›å»ºçº¿ç¨‹å’Œç»“æŸçº¿ç¨‹ è¯»å–å’Œè®¾ç½®çº¿ç¨‹å±æ€§ POSIXçº¿ç¨‹åŒæ­¥æ–¹å¼ï¼šPOSIXä¿¡å·é‡ã€äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ Linuxçº¿ç¨‹æ¦‚è¿°çº¿ç¨‹æ¨¡å‹çº¿ç¨‹æ˜¯ç¨‹åºä¸­å®Œæˆä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡çš„å®Œæ•´æ‰§è¡Œåºåˆ—ï¼Œå³ä¸€ä¸ªå¯è°ƒåº¦çš„å®ä½“ã€‚æ ¹æ®è¿è¡Œç¯å¢ƒå’Œè°ƒåº¦è€…çš„èº«ä»½ï¼Œçº¿ç¨‹å¯åˆ†ä¸ºå†…æ ¸çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ã€‚å†…æ ¸çº¿ç¨‹ï¼Œåœ¨æœ‰çš„ç³»ç»Ÿä¸Šä¹Ÿç§°ä¸ºLWPï¼ˆLight Weight Processï¼Œè½»é‡çº§è¿›ç¨‹ï¼‰ï¼Œè¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸æ¥è°ƒåº¦ï¼›ç”¨æˆ·çº¿ç¨‹è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œç”±çº¿ç¨‹åº“æ¥è°ƒåº¦ã€‚å½“è¿›ç¨‹çš„ä¸€ä¸ªå†…æ ¸çº¿ç¨‹è·å¾—CPUçš„ä½¿ç”¨æƒæ—¶ï¼Œå®ƒå°±åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ã€‚å¯è§ï¼Œå†…æ ¸çº¿ç¨‹ç›¸å½“äºç”¨æˆ·çº¿ç¨‹è¿è¡Œçš„â€œå®¹å™¨â€ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰Mä¸ªå†…æ ¸çº¿ç¨‹å’ŒNä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œå…¶ä¸­Mâ‰¤Nã€‚å¹¶ä¸”åœ¨ä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰è¿›ç¨‹ä¸­ï¼ŒMå’ŒNçš„æ¯”å€¼éƒ½æ˜¯å›ºå®šçš„ã€‚æŒ‰ç…§M:Nçš„å–å€¼ï¼Œçº¿ç¨‹çš„å®ç°æ–¹å¼å¯åˆ†ä¸ºä¸‰ç§æ¨¡å¼ï¼šå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´å®ç°ã€å®Œå…¨ç”±å†…æ ¸è°ƒåº¦å’ŒåŒå±‚è°ƒåº¦ï¼ˆtwo level schedulerï¼‰ã€‚ å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹æ— é¡»å†…æ ¸çš„æ”¯æŒï¼Œå†…æ ¸ç”šè‡³æ ¹æœ¬ä¸çŸ¥é“è¿™äº›çº¿ç¨‹çš„å­˜åœ¨ã€‚çº¿ç¨‹åº“è´Ÿè´£ç®¡ç†æ‰€æœ‰æ‰§è¡Œçº¿ç¨‹ï¼Œæ¯”å¦‚çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€æ—¶é—´ç‰‡ç­‰ã€‚çº¿ç¨‹åº“åˆ©ç”¨longjmpæ¥åˆ‡æ¢çº¿ç¨‹çš„æ‰§è¡Œï¼Œä½¿å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯â€œå¹¶å‘â€æ‰§è¡Œçš„ã€‚ä½†å®é™…ä¸Šå†…æ ¸ä»ç„¶æ˜¯æŠŠæ•´ä¸ªè¿›ç¨‹ä½œä¸ºæœ€å°å•ä½æ¥è°ƒåº¦çš„ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰æ‰§è¡Œçº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ—¶é—´ç‰‡ï¼Œå®ƒä»¬å¯¹å¤–è¡¨ç°å‡ºç›¸åŒçš„ä¼˜å…ˆçº§ã€‚å› æ­¤ï¼Œå¯¹è¿™ç§å®ç°æ–¹å¼è€Œè¨€ï¼ŒN&#x3D;1ï¼Œå³Mä¸ªç”¨æˆ·ç©ºé—´çº¿ç¨‹å¯¹åº”1ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œè€Œè¯¥å†…æ ¸çº¿ç¨‹å®é™…ä¸Šå°±æ˜¯è¿›ç¨‹æœ¬èº«ã€‚å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹çš„ä¼˜ç‚¹æ˜¯ï¼šåˆ›å»ºå’Œè°ƒåº¦çº¿ç¨‹éƒ½æ— é¡»å†…æ ¸çš„å¹²é¢„ï¼Œå› æ­¤é€Ÿåº¦ç›¸å½“å¿«ã€‚å¹¶ä¸”ç”±äºå®ƒä¸å ç”¨é¢å¤–çš„å†…æ ¸èµ„æºï¼Œæ‰€ä»¥å³ä½¿ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºäº†å¾ˆå¤šçº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆæ˜æ˜¾çš„å½±å“ã€‚å…¶ç¼ºç‚¹æ˜¯ï¼šå¯¹äºå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹æ— æ³•è¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šï¼Œå› ä¸ºå†…æ ¸æ˜¯æŒ‰ç…§å…¶æœ€å°è°ƒåº¦å•ä½æ¥åˆ†é…CPUçš„ã€‚æ­¤å¤–ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§åªå¯¹åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æœ‰æ•ˆï¼Œæ¯”è¾ƒä¸åŒè¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§æ²¡æœ‰æ„ä¹‰ã€‚æ—©æœŸçš„ä¼¯å…‹åˆ©UNIXçº¿ç¨‹å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼å®ç°çš„ å®Œå…¨ç”±å†…æ ¸è°ƒåº¦çš„æ¨¡å¼å°†åˆ›å»ºã€è°ƒåº¦çº¿ç¨‹çš„ä»»åŠ¡éƒ½äº¤ç»™äº†å†…æ ¸ï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“æ— é¡»æ‰§è¡Œç®¡ç†ä»»åŠ¡ï¼Œè¿™ä¸å®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹æ°æ°ç›¸åã€‚äºŒè€…çš„ä¼˜ç¼ºç‚¹ä¹Ÿæ­£å¥½äº’æ¢ã€‚è¾ƒæ—©çš„Linuxå†…æ ¸å¯¹å†…æ ¸çº¿ç¨‹çš„æ§åˆ¶èƒ½åŠ›æœ‰é™ï¼Œçº¿ç¨‹åº“é€šå¸¸è¿˜è¦æä¾›é¢å¤–çš„æ§åˆ¶èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œä¸è¿‡ç°ä»£Linuxå†…æ ¸å·²ç»å¤§å¤§å¢å¼ºäº†å¯¹çº¿ç¨‹çš„æ”¯æŒã€‚å®Œå…¨ç”±å†…æ ¸è°ƒåº¦çš„è¿™ç§çº¿ç¨‹å®ç°æ–¹å¼æ»¡è¶³M:N&#x3D;1:1ï¼Œå³1ä¸ªç”¨æˆ·ç©ºé—´çº¿ç¨‹è¢«æ˜ å°„ä¸º1ä¸ªå†…æ ¸çº¿ç¨‹ã€‚ åŒå±‚è°ƒåº¦æ¨¡å¼æ˜¯å‰ä¸¤ç§å®ç°æ¨¡å¼çš„æ··åˆä½“ï¼šå†…æ ¸è°ƒåº¦Mä¸ªå†…æ ¸çº¿ç¨‹ï¼Œçº¿ç¨‹åº“è°ƒåº¦Nä¸ªç”¨æˆ·çº¿ç¨‹ã€‚è¿™ç§çº¿ç¨‹å®ç°æ–¹å¼ç»“åˆäº†å‰ä¸¤ç§æ–¹å¼çš„ä¼˜ç‚¹ï¼šä¸ä½†ä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„å†…æ ¸èµ„æºï¼Œè€Œä¸”çº¿ç¨‹åˆ‡æ¢é€Ÿåº¦ä¹Ÿè¾ƒå¿«ï¼ŒåŒæ—¶å®ƒå¯ä»¥å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨çš„ä¼˜åŠ¿ Linuxçº¿ç¨‹åº“Linuxä¸Šä¸¤ä¸ªæœ€æœ‰åçš„çº¿ç¨‹åº“æ˜¯LinuxThreadså’ŒNPTLï¼Œå®ƒä»¬éƒ½æ˜¯é‡‡ç”¨1:1çš„æ–¹å¼å®ç°çš„ã€‚ç”±äºLinuxThreadsåœ¨å¼€å‘çš„æ—¶å€™ï¼ŒLinuxå†…æ ¸å¯¹çº¿ç¨‹çš„æ”¯æŒè¿˜éå¸¸æœ‰é™ï¼Œæ‰€ä»¥å…¶å¯ç”¨æ€§ã€ç¨³å®šæ€§ä»¥åŠPOSIXå…¼å®¹æ€§éƒ½è¿œè¿œä¸åŠNPTLã€‚ç°ä»£Linuxä¸Šé»˜è®¤ä½¿ç”¨çš„çº¿ç¨‹åº“æ˜¯NPTLã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šæ‰€ä½¿ç”¨çš„çº¿ç¨‹åº“ï¼š $getconf GNU_LIBPTHREAD_VERSION NPTL 2.28 åˆ›å»ºçº¿ç¨‹å’Œç»“æŸçº¿ç¨‹pthread_create 12#includeï¼œpthread.hï¼int pthread_create(pthread_t* thread,const pthread_attr_t* attr,void*(*start_routine)(void*),void*arg); threadå‚æ•°æ˜¯æ–°çº¿ç¨‹çš„æ ‡è¯†ç¬¦ ç±»å‹pthread_tçš„å®šä¹‰å¦‚ä¸‹ï¼š #includeï¼œbits&#x2F;pthreadtypes.hï¼ typedef unsigned long int pthread_t; attrå‚æ•°ç”¨äºè®¾ç½®æ–°çº¿ç¨‹çš„å±æ€§ã€‚ç»™å®ƒä¼ é€’NULLè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹å±æ€§ã€‚çº¿ç¨‹æ‹¥æœ‰ä¼—å¤šå±æ€§ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è¯¦ç»†è®¨è®ºä¹‹ã€‚ start_routineå’Œargå‚æ•°åˆ†åˆ«æŒ‡å®šæ–°çº¿ç¨‹å°†è¿è¡Œçš„å‡½æ•°åŠå…¶å‚æ•° pthread_createæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‰“å¼€çš„çº¿ç¨‹æ•°é‡ä¸èƒ½è¶…è¿‡RLIMIT_NPROCè½¯èµ„æºé™åˆ¶ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿä¸Šæ‰€æœ‰ç”¨æˆ·èƒ½åˆ›å»ºçš„çº¿ç¨‹æ€»æ•°ä¹Ÿä¸å¾—è¶…è¿‡&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;threads-maxå†…æ ¸å‚æ•°æ‰€å®šä¹‰çš„å€¼ pthread_join çº¿ç¨‹ä¸€æ—¦è¢«åˆ›å»ºå¥½ï¼Œå†…æ ¸å°±å¯ä»¥è°ƒåº¦å†…æ ¸çº¿ç¨‹æ¥æ‰§è¡Œstart_routineå‡½æ•°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å‡½æ•°äº†ã€‚çº¿ç¨‹å‡½æ•°åœ¨ç»“æŸæ—¶æœ€å¥½è°ƒç”¨å¦‚ä¸‹å‡½æ•°ï¼Œä»¥ç¡®ä¿å®‰å…¨ã€å¹²å‡€åœ°é€€å‡ºï¼š 12#includeï¼œpthread.hï¼void pthread_exit(void*retval); pthread_exitå‡½æ•°é€šè¿‡retvalå‚æ•°å‘çº¿ç¨‹çš„å›æ”¶è€…ä¼ é€’å…¶é€€å‡ºä¿¡æ¯ã€‚å®ƒæ‰§è¡Œå®Œä¹‹åä¸ä¼šè¿”å›åˆ°è°ƒç”¨è€…ï¼Œè€Œä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚ pthread_join ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è°ƒç”¨pthread_joinå‡½æ•°æ¥å›æ”¶å…¶ä»–çº¿ç¨‹ï¼ˆå‰ææ˜¯ç›®æ ‡çº¿ç¨‹æ˜¯å¯å›æ”¶çš„ï¼‰ï¼Œå³ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»“æŸï¼Œè¿™ç±»ä¼¼äºå›æ”¶è¿›ç¨‹çš„waitå’Œwaitpidç³»ç»Ÿè°ƒç”¨ã€‚pthread_joinçš„å®šä¹‰å¦‚ä¸‹ï¼š 12#includeï¼œpthread.hï¼int pthread_join(pthread_t thread,void**retval); threadå‚æ•°æ˜¯ç›®æ ‡çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œretvalå‚æ•°åˆ™æ˜¯ç›®æ ‡çº¿ç¨‹è¿”å›çš„é€€å‡ºä¿¡æ¯ã€‚è¯¥å‡½æ•°ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¢«å›æ”¶çš„çº¿ç¨‹ç»“æŸä¸ºæ­¢ã€‚è¯¥å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ pthread_cancel å¼‚å¸¸ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å–æ¶ˆçº¿ç¨‹ int pthread_cancel(pthread_t thread); æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ æ¥æ”¶åˆ°å–æ¶ˆè¯·æ±‚çš„ç›®æ ‡çº¿ç¨‹å¯ä»¥å†³å®šæ˜¯å¦å…è®¸è¢«å–æ¶ˆä»¥åŠå¦‚ä½•å–æ¶ˆï¼Œè¿™åˆ†åˆ«ç”±å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°å®Œæˆ 123#includeï¼œpthread.hï¼int pthread_setcancelstate(int state,int*oldstate);int pthread_setcanceltype(int type,int*oldtype); è¿™ä¸¤ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åˆ†åˆ«ç”¨äºè®¾ç½®çº¿ç¨‹çš„å–æ¶ˆçŠ¶æ€ï¼ˆæ˜¯å¦å…è®¸å–æ¶ˆï¼‰å’Œå–æ¶ˆç±»å‹ï¼ˆå¦‚ä½•å–æ¶ˆï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™åˆ†åˆ«è®°å½•çº¿ç¨‹åŸæ¥çš„å–æ¶ˆçŠ¶æ€å’Œå–æ¶ˆç±»å‹ã€‚ stateå‚æ•°æœ‰ä¸¤ä¸ªå¯é€‰å€¼ï¼š â‘PTHREAD_CANCEL_ENABLEï¼Œå…è®¸çº¿ç¨‹è¢«å–æ¶ˆã€‚å®ƒæ˜¯çº¿ç¨‹è¢«åˆ›å»ºæ—¶çš„é»˜è®¤å–æ¶ˆçŠ¶æ€ã€‚ â‘PTHREAD_CANCEL_DISABLEï¼Œç¦æ­¢çº¿ç¨‹è¢«å–æ¶ˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ”¶åˆ°å–æ¶ˆè¯·æ±‚ï¼Œåˆ™å®ƒä¼šå°†è¯·æ±‚æŒ‚èµ·ï¼Œç›´åˆ°è¯¥çº¿ç¨‹å…è®¸è¢«å–æ¶ˆã€‚ typeå‚æ•°ä¹Ÿæœ‰ä¸¤ä¸ªå¯é€‰å€¼ â‘PTHREAD_CANCEL_ASYNCHRONOUSï¼Œçº¿ç¨‹éšæ—¶éƒ½å¯ä»¥è¢«å–æ¶ˆã€‚å®ƒå°†ä½¿å¾—æ¥æ”¶åˆ°å–æ¶ˆè¯·æ±‚çš„ç›®æ ‡çº¿ç¨‹ç«‹å³é‡‡å–è¡ŒåŠ¨ã€‚ çº¿ç¨‹å±æ€§123456#includeï¼œbits/pthreadtypes.hï¼#define__SIZEOF_PTHREAD_ATTR_T 36typedef union&#123; char__size[__SIZEOF_PTHREAD_ATTR_T]; long int__align;&#125;pthread_attr_t; å„ç§çº¿ç¨‹å±æ€§å…¨éƒ¨åŒ…å«åœ¨ä¸€ä¸ªå­—ç¬¦æ•°ç»„ä¸­ã€‚ 123456789101112131415161718192021222324#includeï¼œpthread.hï¼/*åˆå§‹åŒ–çº¿ç¨‹å±æ€§å¯¹è±¡*/int pthread_attr_init(pthread_attr_t*attr);/*é”€æ¯çº¿ç¨‹å±æ€§å¯¹è±¡ã€‚è¢«é”€æ¯çš„çº¿ç¨‹å±æ€§å¯¹è±¡åªæœ‰å†æ¬¡åˆå§‹åŒ–ä¹‹åæ‰èƒ½ç»§ç»­ä½¿ç”¨*/int pthread_attr_destroy(pthread_attr_t*attr);/*ä¸‹é¢è¿™äº›å‡½æ•°ç”¨äºè·å–å’Œè®¾ç½®çº¿ç¨‹å±æ€§å¯¹è±¡çš„æŸä¸ªå±æ€§*/int pthread_attr_getdetachstate(const pthread_attr_t*attr,int*detachstate);int pthread_attr_setdetachstate(pthread_attr_t* attr,int detachstate);int pthread_attr_getstackaddr(const pthread_attr_t*attr,void**stackaddr);int pthread_attr_setstackaddr(pthread_attr_t*attr,void*stackaddr);int pthread_attr_getstacksize(const pthread_attr_t*attr,size_t*stacksize);int pthread_attr_setstacksize(pthread_attr_t*attr,size_t stacksize);int pthread_attr_getstack(const pthread_attr_t*attr,void**stackaddr,size_t*stacksize);int pthread_attr_setstack(pthread_attr_t*attr,void*stackaddr,size_t stacksize);int pthread_attr_getguardsize(const pthread_attr_t*__attr,size_t*guardsize);int pthread_attr_setguardsize(pthread_attr_t*attr,size_t guardsize);int pthread_attr_getschedparam(const pthread_attr_t*attr,struct sched_param*param);int pthread_attr_setschedparam(pthread_attr_t*attr,const struct sched_param*param);int pthread_attr_getschedpolicy(const pthread_attr_t*attr,int*policy);int pthread_attr_setschedpolicy(pthread_attr_t*attr,int policy);int pthread_attr_getinheritsched(const pthread_attr_t*attr,int*inherit);int pthread_attr_setinheritsched(pthread_attr_t*attr,int inherit);int pthread_attr_getscope(const pthread_attr_t*attr,int*scope);int pthread_attr_setscope(pthread_attr_t*attr,int scope); detachstateï¼Œçº¿ç¨‹çš„è„±ç¦»çŠ¶æ€ã€‚å®ƒæœ‰PTHREAD_CREATE_JOINABLEå’ŒPTHREAD_CREATE_DETACHä¸¤ä¸ªå¯é€‰å€¼ã€‚å‰è€…æŒ‡å®šçº¿ç¨‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„ï¼Œåè€…ä½¿è°ƒç”¨çº¿ç¨‹è„±ç¦»ä¸è¿›ç¨‹ä¸­å…¶ä»–çº¿ç¨‹çš„åŒæ­¥ã€‚è„±ç¦»äº†ä¸å…¶ä»–çº¿ç¨‹åŒæ­¥çš„çº¿ç¨‹ç§°ä¸ºâ€œè„±ç¦»çº¿ç¨‹â€ã€‚è„±ç¦»çº¿ç¨‹åœ¨é€€å‡ºæ—¶å°†è‡ªè¡Œé‡Šæ”¾å…¶å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚çº¿ç¨‹åˆ›å»ºæ—¶è¯¥å±æ€§çš„é»˜è®¤å€¼æ˜¯PTHREAD_CREATE_JOINABLEã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨pthread_detachå‡½æ•°ç›´æ¥å°†çº¿ç¨‹è®¾ç½®ä¸ºè„±ç¦»çº¿ç¨‹ã€‚ stackaddrå’Œstacksizeï¼Œçº¿ç¨‹å †æ ˆçš„èµ·å§‹åœ°å€å’Œå¤§å° guardsizeï¼Œä¿æŠ¤åŒºåŸŸå¤§å° schedparamï¼Œçº¿ç¨‹è°ƒåº¦å‚æ•° schedpolicyï¼Œçº¿ç¨‹è°ƒåº¦ç­–ç•¥ inheritschedï¼Œæ˜¯å¦ç»§æ‰¿è°ƒç”¨çº¿ç¨‹çš„è°ƒåº¦å±æ€§ scopeï¼Œçº¿ç¨‹é—´ç«äº‰CPUçš„èŒƒå›´ï¼Œå³çº¿ç¨‹ä¼˜å…ˆçº§çš„æœ‰æ•ˆèŒƒå›´ POSIXä¿¡å·é‡çº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ï¼šPOSIXä¿¡å·é‡ã€äº’æ–¥é‡å’Œæ¡ä»¶å˜é‡ ä¿¡å·é‡APIæœ‰ä¸¤ç»„ã€‚ä¸€ç»„æ˜¯è®¨è®ºè¿‡çš„System VIPCä¿¡å·é‡ï¼Œå¦å¤–ä¸€ç»„æ˜¯POSIXä¿¡å·é‡ åŸç†è¯­ä¹‰ç›¸åŒ 123456#includeï¼œsemaphore.hï¼int sem_init(sem_t*sem,int pshared,unsigned int value);int sem_destroy(sem_t*sem);int sem_wait(sem_t*sem);int sem_trywait(sem_t*sem);int sem_post(sem_t*sem); semæŒ‡å‘è¢«æ“ä½œçš„ä¿¡å·é‡ sem_initå‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæœªå‘½åçš„ä¿¡å·é‡ï¼ˆPOSIXä¿¡å·é‡APIæ”¯æŒå‘½åä¿¡å·é‡ï¼‰ã€‚psharedå‚æ•°æŒ‡å®šä¿¡å·é‡çš„ç±»å‹ã€‚å¦‚æœå…¶å€¼ä¸º0ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªä¿¡å·é‡æ˜¯å½“å‰è¿›ç¨‹çš„å±€éƒ¨ä¿¡å·é‡ï¼Œå¦åˆ™è¯¥ä¿¡å·é‡å°±å¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ã€‚valueå‚æ•°æŒ‡å®šä¿¡å·é‡çš„åˆå§‹å€¼ã€‚æ­¤å¤–ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå·²ç»è¢«åˆå§‹åŒ–çš„ä¿¡å·é‡å°†å¯¼è‡´ä¸å¯é¢„æœŸçš„ç»“æœã€‚ sem_destroyå‡½æ•°ç”¨äºé”€æ¯ä¿¡å·é‡ï¼Œä»¥é‡Šæ”¾å…¶å ç”¨çš„å†…æ ¸èµ„æºã€‚å¦‚æœé”€æ¯ä¸€ä¸ªæ­£è¢«å…¶ä»–çº¿ç¨‹ç­‰å¾…çš„ä¿¡å·é‡ï¼Œåˆ™å°†å¯¼è‡´ä¸å¯é¢„æœŸçš„ç»“æœ sem_waitå‡½æ•°ä»¥åŸå­æ“ä½œçš„æ–¹å¼å°†ä¿¡å·é‡çš„å€¼å‡1ã€‚å¦‚æœä¿¡å·é‡çš„å€¼ä¸º0ï¼Œåˆ™sem_waitå°†è¢«é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ªä¿¡å·é‡å…·æœ‰é0å€¼ã€‚ sem_trywaitä¸sem_waitå‡½æ•°ç›¸ä¼¼ï¼Œä¸è¿‡å®ƒå§‹ç»ˆç«‹å³è¿”å›ï¼Œè€Œä¸è®ºè¢«æ“ä½œçš„ä¿¡å·é‡æ˜¯å¦å…·æœ‰é0å€¼ï¼Œç›¸å½“äºsem_waitçš„éé˜»å¡ç‰ˆæœ¬ã€‚å½“ä¿¡å·é‡çš„å€¼é0æ—¶ï¼Œsem_trywaitå¯¹ä¿¡å·é‡æ‰§è¡Œå‡1æ“ä½œã€‚å½“ä¿¡å·é‡çš„å€¼ä¸º0æ—¶ï¼Œå®ƒå°†è¿”å›-1å¹¶è®¾ç½®errnoä¸ºEAGAINã€‚ sem_postå‡½æ•°ä»¥åŸå­æ“ä½œçš„æ–¹å¼å°†ä¿¡å·é‡çš„å€¼åŠ 1ã€‚å½“ä¿¡å·é‡çš„å€¼å¤§äº0æ—¶ï¼Œå…¶ä»–æ­£åœ¨è°ƒç”¨sem_waitç­‰å¾…ä¿¡å·é‡çš„çº¿ç¨‹å°†è¢«å”¤é†’ã€‚ ä¸Šé¢è¿™äº›å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1å¹¶è®¾ç½®errnoã€‚ äº’æ–¥é”äº’æ–¥é”ï¼ˆä¹Ÿç§°äº’æ–¥é‡ï¼‰å¯ä»¥ç”¨äºä¿æŠ¤å…³é”®ä»£ç æ®µï¼Œä»¥ç¡®ä¿å…¶ç‹¬å å¼çš„è®¿é—®ï¼Œè¿™æœ‰ç‚¹åƒä¸€ä¸ªäºŒè¿›åˆ¶ä¿¡å·é‡ã€‚å½“è¿›å…¥å…³é”®ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—äº’æ–¥é”å¹¶å°†å…¶åŠ é”ï¼Œè¿™ç­‰ä»·äºäºŒè¿›åˆ¶ä¿¡å·é‡çš„Pæ“ä½œï¼›å½“ç¦»å¼€å…³é”®ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹äº’æ–¥é”è§£é”ï¼Œä»¥å”¤é†’å…¶ä»–ç­‰å¾…è¯¥äº’æ–¥é”çš„çº¿ç¨‹ï¼Œè¿™ç­‰ä»·äºäºŒè¿›åˆ¶ä¿¡å·é‡çš„Væ“ä½œã€‚ ####äº’æ–¥é”åŸºç¡€API 123456#includeï¼œpthread.hï¼int pthread_mutex_init(pthread_mutex_t*mutex,const pthread_mutexattr_t*mutexattr);int pthread_mutex_destroy(pthread_mutex_t*mutex);int pthread_mutex_lock(pthread_mutex_t*mutex);int pthread_mutex_trylock(pthread_mutex_t*mutex);int pthread_mutex_unlock(pthread_mutex_t*mutex); mutexæŒ‡å‘è¦æ“ä½œçš„ç›®æ ‡äº’æ–¥é”ï¼Œäº’æ–¥é”çš„ç±»å‹æ˜¯pthread_mutex_tç»“æ„ä½“ã€‚ pthread_mutex_initå‡½æ•°ç”¨äºåˆå§‹åŒ–äº’æ–¥é”ã€‚mutexattrå‚æ•°æŒ‡å®šäº’æ–¥é”çš„å±æ€§ã€‚å¦‚æœå°†å®ƒè®¾ç½®ä¸ºNULLï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨é»˜è®¤å±æ€§ã€‚ ä½¿ç”¨å¦ä¸€ç§æ–¹å¼åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é” pthread_mutex_t mutex&#x3D;PTHREAD_MUTEX_INITIALIZER; è¿™ä¸ªå®æŠŠäº’æ–¥é”çš„å„ä¸ªå­—æ®µéƒ½åˆå§‹åŒ–ä¸º0 pthread_mutex_destroyå‡½æ•°ç”¨äºé”€æ¯äº’æ–¥é”ï¼Œä»¥é‡Šæ”¾å…¶å ç”¨çš„å†…æ ¸èµ„æºã€‚é”€æ¯ä¸€ä¸ªå·²ç»åŠ é”çš„äº’æ–¥é”å°†å¯¼è‡´ä¸å¯é¢„æœŸçš„åæœ pthread_mutex_lockå‡½æ•°ä»¥åŸå­æ“ä½œçš„æ–¹å¼ç»™ä¸€ä¸ªäº’æ–¥é”åŠ é”ã€‚å¦‚æœç›®æ ‡äº’æ–¥é”å·²ç»è¢«é”ä¸Šï¼Œåˆ™pthread_mutex_lockè°ƒç”¨å°†é˜»å¡ï¼Œç›´åˆ°è¯¥äº’æ–¥é”çš„å æœ‰è€…å°†å…¶è§£é”ã€‚ pthread_mutex_trylockï¼Œå§‹ç»ˆç«‹å³è¿”å›ï¼Œç›¸å½“äºpthread_mutex_lockçš„éé˜»å¡ç‰ˆæœ¬ã€‚å½“ç›®æ ‡äº’æ–¥é”æœªè¢«åŠ é”æ—¶ï¼Œpthread_mutex_trylockå¯¹äº’æ–¥é”æ‰§è¡ŒåŠ é”æ“ä½œã€‚å½“äº’æ–¥é”å·²ç»è¢«åŠ é”æ—¶ï¼Œpthread_mutex_trylockå°†è¿”å›é”™è¯¯ç EBUSYã€‚ pthread_mutex_unlockå‡½æ•°ä»¥åŸå­æ“ä½œçš„æ–¹å¼ç»™ä¸€ä¸ªäº’æ–¥é”è§£é”ã€‚å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¿™ä¸ªäº’æ–¥é”ï¼Œåˆ™è¿™äº›çº¿ç¨‹ä¸­çš„æŸä¸€ä¸ªå°†è·å¾—å®ƒã€‚ ä¸Šé¢è¿™äº›å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ äº’æ–¥é”å±æ€§pthread_mutexattr_tç»“æ„ä½“å®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„äº’æ–¥é”å±æ€§ã€‚çº¿ç¨‹åº“æä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥æ“ä½œpthread_mutexattr_tç±»å‹çš„å˜é‡ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬è·å–å’Œè®¾ç½®äº’æ–¥é”å±æ€§ã€‚è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºå…¶ä¸­ä¸€äº›ä¸»è¦çš„å‡½æ•°ï¼š 1234567891011#includeï¼œpthread.hï¼/*åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¯¹è±¡*/int pthread_mutexattr_init(pthread_mutexattr_t*attr);/*é”€æ¯äº’æ–¥é”å±æ€§å¯¹è±¡*/int pthread_mutexattr_destroy(pthread_mutexattr_t*attr);/*è·å–å’Œè®¾ç½®äº’æ–¥é”çš„psharedå±æ€§*/int pthread_mutexattr_getpshared(const pthread_mutexattr_t*attr,int*pshared);int pthread_mutexattr_setpshared(pthread_mutexattr_t*attr,int pshared);/*è·å–å’Œè®¾ç½®äº’æ–¥é”çš„typeå±æ€§*/int pthread_mutexattr_gettype(const pthread_mutexattr_t*attr,int*type);int pthread_mutexattr_settype(pthread_mutexattr_t*attr,int type); ä¸¤ç§å¸¸ç”¨å±æ€§:psharedå’Œtypeã€‚ psharedæŒ‡å®šæ˜¯å¦å…è®¸è·¨è¿›ç¨‹å…±äº«äº’æ–¥é”ï¼Œå…¶å¯é€‰å€¼æœ‰ä¸¤ä¸ª PTHREAD_PROCESS_SHAREDã€‚äº’æ–¥é”å¯ä»¥è¢«è·¨è¿›ç¨‹å…±äº« PTHREAD_PROCESS_PRIVATEã€‚äº’æ–¥é”åªèƒ½è¢«å’Œé”çš„åˆå§‹åŒ–çº¿ç¨‹éš¶å±äºåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å…±äº« typeæŒ‡å®šäº’æ–¥é”çš„ç±»å‹ PTHREAD_MUTEX_NORMALï¼Œæ™®é€šé”ã€‚è¿™æ˜¯äº’æ–¥é”é»˜è®¤çš„ç±»å‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªæ™®é€šé”åŠ é”ä»¥åï¼Œå…¶ä½™è¯·æ±‚è¯¥é”çš„çº¿ç¨‹å°†å½¢æˆä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶åœ¨è¯¥é”è§£é”åæŒ‰ä¼˜å…ˆçº§è·å¾—å®ƒã€‚è¿™ç§é”ç±»å‹ä¿è¯äº†èµ„æºåˆ†é…çš„å…¬å¹³æ€§ã€‚ä½†è¿™ç§é”ä¹Ÿå¾ˆå®¹æ˜“å¼•å‘é—®é¢˜ï¼šä¸€ä¸ªçº¿ç¨‹å¦‚æœå¯¹ä¸€ä¸ªå·²ç»åŠ é”çš„æ™®é€šé”å†æ¬¡åŠ é”ï¼Œå°†å¼•å‘æ­»é”ï¼›å¯¹ä¸€ä¸ªå·²ç»è¢«å…¶ä»–çº¿ç¨‹åŠ é”çš„æ™®é€šé”è§£é”ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå·²ç»è§£é”çš„æ™®é€šé”å†æ¬¡è§£é”ï¼Œå°†å¯¼è‡´ä¸å¯é¢„æœŸçš„åæœ PTHREAD_MUTEX_ERRORCHECKï¼Œæ£€é”™é”ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœå¯¹ä¸€ä¸ªå·²ç»åŠ é”çš„æ£€é”™é”å†æ¬¡åŠ é”ï¼Œåˆ™åŠ é”æ“ä½œè¿”å›EDEADLKã€‚å¯¹ä¸€ä¸ªå·²ç»è¢«å…¶ä»–çº¿ç¨‹åŠ é”çš„æ£€é”™é”è§£é”ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå·²ç»è§£é”çš„æ£€é”™é”å†æ¬¡è§£é”ï¼Œåˆ™è§£é”æ“ä½œè¿”å›EPERM PTHREAD_MUTEX_RECURSIVEï¼ŒåµŒå¥—é”ã€‚è¿™ç§é”å…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾é”ä¹‹å‰å¤šæ¬¡å¯¹å®ƒåŠ é”è€Œä¸å‘ç”Ÿæ­»é”ã€‚ä¸è¿‡å…¶ä»–çº¿ç¨‹å¦‚æœè¦è·å¾—è¿™ä¸ªé”ï¼Œåˆ™å½“å‰é”çš„æ‹¥æœ‰è€…å¿…é¡»æ‰§è¡Œç›¸åº”æ¬¡æ•°çš„è§£é”æ“ä½œã€‚å¯¹ä¸€ä¸ªå·²ç»è¢«å…¶ä»–çº¿ç¨‹åŠ é”çš„åµŒå¥—é”è§£é”ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå·²ç»è§£é”çš„åµŒå¥—é”å†æ¬¡è§£é”ï¼Œåˆ™è§£é”æ“ä½œè¿”å›EPERM PTHREAD_MUTEX_DEFAULTï¼Œé»˜è®¤é”ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœå¯¹ä¸€ä¸ªå·²ç»åŠ é”çš„é»˜è®¤é”å†æ¬¡åŠ é”ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå·²ç»è¢«å…¶ä»–çº¿ç¨‹åŠ é”çš„é»˜è®¤é”è§£é”ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå·²ç»è§£é”çš„é»˜è®¤é”å†æ¬¡è§£é”ï¼Œå°†å¯¼è‡´ä¸å¯é¢„æœŸçš„åæœã€‚è¿™ç§é”åœ¨å®ç°çš„æ—¶å€™å¯èƒ½è¢«æ˜ å°„ä¸ºä¸Šé¢ä¸‰ç§é”ä¹‹ä¸€ã€‚ æ­»é”ä¸¾ä¾‹æ­»é”ä½¿å¾—ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è¢«æŒ‚èµ·è€Œæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œè€Œä¸”è¿™ç§æƒ…å†µè¿˜ä¸å®¹æ˜“è¢«å‘ç°ã€‚å‰æ–‡æåˆ°ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯¹ä¸€ä¸ªå·²ç»åŠ é”çš„æ™®é€šé”å†æ¬¡åŠ é”ï¼Œå°†å¯¼è‡´æ­»é”ã€‚è¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨è®¾è®¡å¾—ä¸å¤Ÿä»”ç»†çš„é€’å½’å‡½æ•°ä¸­ã€‚å¦å¤–ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§ä¸åŒçš„é¡ºåºæ¥ç”³è¯·ä¸¤ä¸ªäº’æ–¥é”ï¼Œä¹Ÿå®¹æ˜“äº§ç”Ÿæ­»é” 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;pthread.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;int a = 0;int b = 0;pthread_mutex_t mutex_a;pthread_mutex_t mutex_b;void *another(void *arg)&#123; pthread_mutex_lock(&amp;mutex_b); printf(&quot;in child thread,got mutex b,waiting for mutex a\\n&quot;); sleep(5); ++b; pthread_mutex_lock(&amp;mutex_a); b += a++; pthread_mutex_unlock(&amp;mutex_a); pthread_mutex_unlock(&amp;mutex_b); pthread_exit(NULL);&#125;int main()&#123; pthread_t id; pthread_mutex_init(&amp;mutex_a, NULL); pthread_mutex_init(&amp;mutex_b, NULL); pthread_create(&amp;id, NULL, another, NULL); pthread_mutex_lock(&amp;mutex_a); printf(&quot;in parent thread,got mutex a,waiting for mutex b\\n&quot;); sleep(5); ++a; pthread_mutex_lock(&amp;mutex_b); a += b++; pthread_mutex_unlock(&amp;mutex_b); pthread_mutex_unlock(&amp;mutex_a); pthread_join(id, NULL); pthread_mutex_destroy(&amp;mutex_a); pthread_mutex_destroy(&amp;mutex_b); return 0;&#125; ä¸»çº¿ç¨‹è¯•å›¾å…ˆå æœ‰äº’æ–¥é”mutex_aï¼Œç„¶åæ“ä½œè¢«è¯¥é”ä¿æŠ¤çš„å˜é‡aï¼Œä½†æ“ä½œå®Œæ¯•ä¹‹åï¼Œä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ç«‹å³é‡Šæ”¾äº’æ–¥é”mutex_aï¼Œè€Œæ˜¯åˆç”³è¯·äº’æ–¥é”mutex_bï¼Œå¹¶åœ¨ä¸¤ä¸ªäº’æ–¥é”çš„ä¿æŠ¤ä¸‹ï¼Œæ“ä½œå˜é‡aå’Œbï¼Œæœ€åæ‰ä¸€èµ·é‡Šæ”¾è¿™ä¸¤ä¸ªäº’æ–¥é”ï¼› ä¸æ­¤åŒæ—¶ï¼Œå­çº¿ç¨‹åˆ™æŒ‰ç…§ç›¸åçš„é¡ºåºæ¥ç”³è¯·äº’æ–¥é”mutex_aå’Œmutex_bï¼Œå¹¶åœ¨ä¸¤ä¸ªé”çš„ä¿æŠ¤ä¸‹æ“ä½œå˜é‡aå’Œbã€‚ æˆ‘ä»¬ç”¨sleepå‡½æ•°æ¥æ¨¡æ‹Ÿè¿ç»­ä¸¤æ¬¡è°ƒç”¨pthread_mutex_lockä¹‹é—´çš„æ—¶é—´å·®ï¼Œä»¥ç¡®ä¿ä»£ç ä¸­çš„ä¸¤ä¸ªçº¿ç¨‹å„è‡ªå…ˆå æœ‰ä¸€ä¸ªäº’æ–¥é”ï¼ˆä¸»çº¿ç¨‹å æœ‰mutex_aï¼Œå­çº¿ç¨‹å æœ‰mutex_bï¼‰ï¼Œç„¶åç­‰å¾…å¦å¤–ä¸€ä¸ªäº’æ–¥é”ï¼ˆä¸»çº¿ç¨‹ç­‰å¾…mutex_bï¼Œå­çº¿ç¨‹ç­‰å¾…mutex_aï¼‰ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªçº¿ç¨‹å°±åƒµæŒä½äº†ï¼Œè°éƒ½ä¸èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œä»è€Œå½¢æˆæ­»é”ã€‚ å¦‚æœä»£ç ä¸­ä¸åŠ å…¥sleepå‡½æ•°ï¼Œåˆ™è¿™æ®µä»£ç æˆ–è®¸æ€»èƒ½æˆåŠŸåœ°è¿è¡Œï¼Œä»è€Œä¸ºç¨‹åºç•™ä¸‹äº†ä¸€ä¸ªæ½œåœ¨çš„BUGã€‚ æ¡ä»¶å˜é‡å¦‚æœè¯´äº’æ–¥é”æ˜¯ç”¨äºåŒæ­¥çº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆæ¡ä»¶å˜é‡åˆ™æ˜¯ç”¨äºåœ¨çº¿ç¨‹ä¹‹é—´åŒæ­¥å…±äº«æ•°æ®çš„å€¼ã€‚æ¡ä»¶å˜é‡æä¾›äº†ä¸€ç§çº¿ç¨‹é—´çš„é€šçŸ¥æœºåˆ¶ï¼šå½“æŸä¸ªå…±äº«æ•°æ®è¾¾åˆ°æŸä¸ªå€¼çš„æ—¶å€™ï¼Œå”¤é†’ç­‰å¾…è¿™ä¸ªå…±äº«æ•°æ®çš„çº¿ç¨‹ 123456#includeï¼œpthread.hï¼int pthread_cond_init(pthread_cond_t*cond,const pthread_condattr_t* cond_attr);int pthread_cond_destroy(pthread_cond_t*cond);int pthread_cond_broadcast(pthread_cond_t*cond);int pthread_cond_signal(pthread_cond_t*cond);int pthread_cond_wait(pthread_cond_t*cond,pthread_mutex_t*mutex); è¿™äº›å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°condæŒ‡å‘è¦æ“ä½œçš„ç›®æ ‡æ¡ä»¶å˜é‡ï¼Œæ¡ä»¶å˜é‡çš„ç±»å‹æ˜¯pthread_cond_tç»“æ„ä½“ pthread_cond_initå‡½æ•°ç”¨äºåˆå§‹åŒ–æ¡ä»¶å˜é‡ã€‚cond_attrå‚æ•°æŒ‡å®šæ¡ä»¶å˜é‡çš„å±æ€§ã€‚å¦‚æœå°†å®ƒè®¾ç½®ä¸ºNULLï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨é»˜è®¤å±æ€§ã€‚æ¡ä»¶å˜é‡çš„å±æ€§ä¸å¤šï¼Œè€Œä¸”å’Œäº’æ–¥é”çš„å±æ€§ç±»å‹ç›¸ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å†èµ˜è¿°ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥åˆå§‹åŒ–ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼š pthread_cond_t cond&#x3D;PTHREAD_COND_INITIALIZER; æ˜¯æŠŠæ¡ä»¶å˜é‡çš„å„ä¸ªå­—æ®µéƒ½åˆå§‹åŒ–ä¸º0 pthread_cond_destroyå‡½æ•°ç”¨äºé”€æ¯æ¡ä»¶å˜é‡ï¼Œä»¥é‡Šæ”¾å…¶å ç”¨çš„å†…æ ¸èµ„æºã€‚é”€æ¯ä¸€ä¸ªæ­£åœ¨è¢«ç­‰å¾…çš„æ¡ä»¶å˜é‡å°†å¤±è´¥å¹¶è¿”å›EBUSYã€‚ pthread_cond_broadcastå‡½æ•°ä»¥å¹¿æ’­çš„æ–¹å¼å”¤é†’æ‰€æœ‰ç­‰å¾…ç›®æ ‡æ¡ä»¶å˜é‡çš„çº¿ç¨‹ã€‚ pthread_cond_signalå‡½æ•°ç”¨äºå”¤é†’ä¸€ä¸ªç­‰å¾…ç›®æ ‡æ¡ä»¶å˜é‡çš„çº¿ç¨‹ã€‚è‡³äºå“ªä¸ªçº¿ç¨‹å°†è¢«å”¤é†’ï¼Œåˆ™å–å†³äºçº¿ç¨‹çš„ä¼˜å…ˆçº§å’Œè°ƒåº¦ç­–ç•¥ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½æƒ³å”¤é†’ä¸€ä¸ªæŒ‡å®šçš„çº¿ç¨‹ï¼Œä½†pthreadæ²¡æœ‰å¯¹è¯¥éœ€æ±‚æä¾›è§£å†³æ–¹æ³•ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é—´æ¥åœ°å®ç°è¯¥éœ€æ±‚ï¼šå®šä¹‰ä¸€ä¸ªèƒ½å¤Ÿå”¯ä¸€è¡¨ç¤ºç›®æ ‡çº¿ç¨‹çš„å…¨å±€å˜é‡ï¼Œåœ¨å”¤é†’ç­‰å¾…æ¡ä»¶å˜é‡çš„çº¿ç¨‹å‰å…ˆè®¾ç½®è¯¥å˜é‡ä¸ºç›®æ ‡çº¿ç¨‹ï¼Œç„¶åé‡‡ç”¨å¹¿æ’­æ–¹å¼å”¤é†’æ‰€æœ‰ç­‰å¾…æ¡ä»¶å˜é‡çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹è¢«å”¤é†’åéƒ½æ£€æŸ¥è¯¥å˜é‡ä»¥åˆ¤æ–­è¢«å”¤é†’çš„æ˜¯å¦æ˜¯è‡ªå·±ï¼Œå¦‚æœæ˜¯å°±å¼€å§‹æ‰§è¡Œåç»­ä»£ç ï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›ç»§ç»­ç­‰å¾…ã€‚ pthread_cond_waitå‡½æ•°ç”¨äºç­‰å¾…ç›®æ ‡æ¡ä»¶å˜é‡ã€‚mutexå‚æ•°æ˜¯ç”¨äºä¿æŠ¤æ¡ä»¶å˜é‡çš„äº’æ–¥é”ï¼Œä»¥ç¡®ä¿pthread_cond_waitæ“ä½œçš„åŸå­æ€§ã€‚åœ¨è°ƒç”¨pthread_cond_waitå‰ï¼Œå¿…é¡»ç¡®ä¿äº’æ–¥é”mutexå·²ç»åŠ é”ï¼Œå¦åˆ™å°†å¯¼è‡´ä¸å¯é¢„æœŸçš„ç»“æœã€‚pthread_cond_waitå‡½æ•°æ‰§è¡Œæ—¶ï¼Œé¦–å…ˆæŠŠè°ƒç”¨çº¿ç¨‹æ”¾å…¥æ¡ä»¶å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°†äº’æ–¥é”mutexè§£é”ã€‚å¯è§ï¼Œä»pthread_cond_waitå¼€å§‹æ‰§è¡Œåˆ°å…¶è°ƒç”¨çº¿ç¨‹è¢«æ”¾å…¥æ¡ä»¶å˜é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¹‹é—´çš„è¿™æ®µæ—¶é—´å†…ï¼Œpthread_cond_signalå’Œpthread_cond_broadcastç­‰å‡½æ•°ä¸ä¼šä¿®æ”¹æ¡ä»¶å˜é‡ã€‚æ¢è¨€ä¹‹ï¼Œpthread_cond_waitå‡½æ•°ä¸ä¼šé”™è¿‡ç›®æ ‡æ¡ä»¶å˜é‡çš„ä»»ä½•å˜åŒ–ã€‚å½“pthread_cond_waitå‡½æ•°æˆåŠŸè¿”å›æ—¶ï¼Œäº’æ–¥é”mutexå°†å†æ¬¡è¢«é”ä¸Šã€‚ ä¸Šé¢è¿™äº›å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ çº¿ç¨‹åŒæ­¥æœºåˆ¶åŒ…è£…ç±»ä¸ºäº†å……åˆ†å¤ç”¨ä»£ç ï¼ŒåŒæ—¶ç”±äºåæ–‡çš„éœ€è¦ï¼Œæˆ‘ä»¬å°†å‰é¢è®¨è®ºçš„3ç§çº¿ç¨‹åŒæ­¥æœºåˆ¶åˆ†åˆ«å°è£…æˆ3ä¸ªç±»ï¼Œå®ç°åœ¨locker.hæ–‡ä»¶ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112#ifndef LOCKER_H#define LOCKER_H#include &lt;exception&gt;#include &lt;pthread.h&gt;#include &lt;semaphore.h&gt;/*å°è£…ä¿¡å·é‡çš„ç±»*/class sem&#123;public: /*åˆ›å»ºå¹¶åˆå§‹åŒ–ä¿¡å·é‡*/ sem() &#123; if (sem_init(&amp;m_sem, 0, 0) != 0) &#123; /*æ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æŠ¥å‘Šé”™è¯¯*/ throw std::exception(); &#125; &#125; /*é”€æ¯ä¿¡å·é‡*/ ~sem() &#123; sem_destroy(&amp;m_sem); &#125; /*ç­‰å¾…ä¿¡å·é‡*/ bool wait() &#123; return sem_wait(&amp;m_sem) == 0; &#125; /*å¢åŠ ä¿¡å·é‡*/ bool post() &#123; return sem_post(&amp;m_sem) == 0; &#125;private: sem_t m_sem;&#125;;/*å°è£…äº’æ–¥é”çš„ç±»*/class locker&#123;public: /*åˆ›å»ºå¹¶åˆå§‹åŒ–äº’æ–¥é”*/ locker() &#123; if (pthread_mutex_init(&amp;m_mutex, NULL) != 0) &#123; throw std::exception(); &#125; &#125; /*é”€æ¯äº’æ–¥é”*/ ~locker() &#123; pthread_mutex_destroy(&amp;m_mutex); &#125; /*è·å–äº’æ–¥é”*/ bool lock() &#123; return pthread_mutex_lock(&amp;m_mutex) == 0; &#125; /*é‡Šæ”¾äº’æ–¥é”*/ bool unlock() &#123; return pthread_mutex_unlock(&amp;m_mutex) == 0; &#125;private: pthread_mutex_t m_mutex;&#125;;/*å°è£…æ¡ä»¶å˜é‡çš„ç±»*/class cond&#123;public: /*åˆ›å»ºå¹¶åˆå§‹åŒ–æ¡ä»¶å˜é‡*/ cond() &#123; if (pthread_mutex_init(&amp;m_mutex, NULL) != 0) &#123; throw std::exception(); &#125; if (pthread_cond_init(&amp;m_cond, NULL) != 0) &#123; /*æ„é€ å‡½æ•°ä¸­ä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°±åº”è¯¥ç«‹å³é‡Šæ”¾å·²ç»æˆåŠŸåˆ†é…äº†çš„èµ„æº*/ pthread_mutex_destroy(&amp;m_mutex); throw std::exception(); &#125; &#125; /*é”€æ¯æ¡ä»¶å˜é‡*/ ~cond() &#123; pthread_mutex_destroy(&amp;m_mutex); pthread_cond_destroy(&amp;m_cond); &#125; /*ç­‰å¾…æ¡ä»¶å˜é‡*/ bool wait() &#123; int ret = 0; pthread_mutex_lock(&amp;m_mutex); ret = pthread_cond_wait(&amp;m_cond, &amp;m_mutex); pthread_mutex_unlock(&amp;m_mutex); return ret == 0; &#125; /*å”¤é†’ç­‰å¾…æ¡ä»¶å˜é‡çš„çº¿ç¨‹*/ bool signal() &#123; return pthread_cond_signal(&amp;m_cond) == 0; &#125;private: pthread_mutex_t m_mutex; pthread_cond_t m_cond;&#125;;#endif å¤šçº¿ç¨‹ç¯å¢ƒå¯é‡å…¥å‡½æ•°å¦‚æœä¸€ä¸ªå‡½æ•°èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ä¸”ä¸å‘ç”Ÿç«æ€æ¡ä»¶ï¼Œåˆ™æˆ‘ä»¬ç§°å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆthread safeï¼‰ï¼Œæˆ–è€…è¯´å®ƒæ˜¯å¯é‡å…¥å‡½æ•°ã€‚Linuxåº“å‡½æ•°åªæœ‰ä¸€å°éƒ¨åˆ†æ˜¯ä¸å¯é‡å…¥çš„ï¼Œæ¯”å¦‚inet_ntoaå‡½æ•°ï¼Œä»¥åŠgetservbynameå’Œgetservbyportå‡½æ•°ã€‚è¿™äº›åº“å‡½æ•°ä¹‹æ‰€ä»¥ä¸å¯é‡å…¥ï¼Œä¸»è¦æ˜¯å› ä¸ºå…¶å†…éƒ¨ä½¿ç”¨äº†é™æ€å˜é‡ã€‚ä¸è¿‡Linuxå¯¹å¾ˆå¤šä¸å¯é‡å…¥çš„åº“å‡½æ•°æä¾›äº†å¯¹åº”çš„å¯é‡å…¥ç‰ˆæœ¬ï¼Œè¿™äº›å¯é‡å…¥ç‰ˆæœ¬çš„å‡½æ•°åæ˜¯åœ¨åŸå‡½æ•°åå°¾éƒ¨åŠ ä¸Š_rã€‚æ¯”å¦‚ï¼Œå‡½æ•°localtimeå¯¹åº”çš„å¯é‡å…¥å‡½æ•°æ˜¯localtime_rã€‚åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­è°ƒç”¨åº“å‡½æ•°ï¼Œä¸€å®šè¦ä½¿ç”¨å…¶å¯é‡å…¥ç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´é¢„æƒ³ä¸åˆ°çš„ç»“æœã€‚ çº¿ç¨‹å’Œè¿›ç¨‹æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºçš„æŸä¸ªçº¿ç¨‹è°ƒç”¨äº†forkå‡½æ•°ï¼Œé‚£ä¹ˆæ–°åˆ›å»ºçš„å­è¿›ç¨‹æ˜¯å¦å°†è‡ªåŠ¨åˆ›å»ºå’Œçˆ¶è¿›ç¨‹ç›¸åŒæ•°é‡çš„çº¿ç¨‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯â€œå¦â€ï¼Œæ­£å¦‚æˆ‘ä»¬æœŸæœ›çš„é‚£æ ·ã€‚å­è¿›ç¨‹åªæ‹¥æœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œå®ƒæ˜¯è°ƒç”¨forkçš„é‚£ä¸ªçº¿ç¨‹çš„å®Œæ•´å¤åˆ¶ã€‚å¹¶ä¸”å­è¿›ç¨‹å°†è‡ªåŠ¨ç»§æ‰¿çˆ¶è¿›ç¨‹ä¸­äº’æ–¥é”ï¼ˆæ¡ä»¶å˜é‡ä¸ä¹‹ç±»ä¼¼ï¼‰çš„çŠ¶æ€ã€‚è¿™å°±å¼•èµ·äº†ä¸€ä¸ªé—®é¢˜ï¼šå­è¿›ç¨‹å¯èƒ½ä¸æ¸…æ¥šä»çˆ¶è¿›ç¨‹ç»§æ‰¿è€Œæ¥çš„äº’æ–¥é”çš„å…·ä½“çŠ¶æ€ï¼ˆæ˜¯åŠ é”çŠ¶æ€è¿˜æ˜¯è§£é”çŠ¶æ€ï¼‰ã€‚è¿™ä¸ªäº’æ–¥é”å¯èƒ½è¢«åŠ é”äº†ï¼Œä½†å¹¶ä¸æ˜¯ç”±è°ƒç”¨forkå‡½æ•°çš„é‚£ä¸ªçº¿ç¨‹é”ä½çš„ï¼Œè€Œæ˜¯ç”±å…¶ä»–çº¿ç¨‹é”ä½çš„ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™å­è¿›ç¨‹è‹¥å†æ¬¡å¯¹è¯¥äº’æ–¥é”æ‰§è¡ŒåŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ­»é”ï¼Œå¦‚ä»£ç æ¸…å•æ‰€ç¤ºã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;pthread.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;wait.h&gt;pthread_mutex_t mutex;/*å­çº¿ç¨‹è¿è¡Œçš„å‡½æ•°ã€‚å®ƒé¦–å…ˆè·å¾—äº’æ–¥é”mutexï¼Œç„¶åæš‚åœ5 sï¼Œå†é‡Šæ”¾è¯¥äº’æ–¥é”*/void *another(void *arg)&#123; printf(&quot;in child thread,lock the mutex\\n&quot;); pthread_mutex_lock(&amp;mutex); sleep(5); pthread_mutex_unlock(&amp;mutex);&#125;int main()&#123; pthread_mutex_init(&amp;mutex, NULL); pthread_t id; pthread_create(&amp;id, NULL, another, NULL); /*çˆ¶è¿›ç¨‹ä¸­çš„ä¸»çº¿ç¨‹æš‚åœ1 sï¼Œä»¥ç¡®ä¿åœ¨æ‰§è¡Œforkæ“ä½œä¹‹å‰ï¼Œå­çº¿ç¨‹å·²ç»å¼€å§‹è¿è¡Œå¹¶è· å¾—äº†äº’æ–¥å˜é‡mutex*/ sleep(1); int pid = fork(); if (pid &lt; 0) &#123; pthread_join(id, NULL); pthread_mutex_destroy(&amp;mutex); return 1; &#125; else if (pid == 0) &#123; printf(&quot;I am in the child,want to get the lock\\n&quot;); /*å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹ç»§æ‰¿äº†äº’æ–¥é”mutexçš„çŠ¶æ€ï¼Œè¯¥äº’æ–¥é”å¤„äºé”ä½çš„çŠ¶æ€ï¼Œè¿™æ˜¯ç”±çˆ¶è¿› ç¨‹ä¸­çš„å­çº¿ç¨‹æ‰§è¡Œpthread_mutex_lockå¼•èµ·çš„ï¼Œå› æ­¤ï¼Œä¸‹é¢è¿™å¥åŠ é”æ“ä½œä¼šä¸€ç›´é˜»å¡ï¼Œ å°½ç®¡ä»é€»è¾‘ä¸Šæ¥è¯´å®ƒæ˜¯ä¸åº”è¯¥é˜»å¡çš„*/ pthread_mutex_lock(&amp;mutex); printf(&quot;I can not run to here,oop...\\n&quot;); pthread_mutex_unlock(&amp;mutex); exit(0); &#125; else &#123; wait(NULL); &#125; pthread_join(id, NULL); pthread_mutex_destroy(&amp;mutex); return 0;&#125; pthreadæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°pthread_atforkï¼Œä»¥ç¡®ä¿forkè°ƒç”¨åçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªæ¸…æ¥šçš„é”çŠ¶æ€ã€‚è¯¥å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š 1int pthread_atfork(void(*prepare)(void),void(*parent)(void),void(*child)(void)); è¯¥å‡½æ•°å°†å»ºç«‹3ä¸ªforkå¥æŸ„æ¥å¸®åŠ©æˆ‘ä»¬æ¸…ç†äº’æ–¥é”çš„çŠ¶æ€ã€‚prepareå¥æŸ„å°†åœ¨forkè°ƒç”¨åˆ›å»ºå‡ºå­è¿›ç¨‹ä¹‹å‰è¢«æ‰§è¡Œã€‚å®ƒå¯ä»¥ç”¨æ¥é”ä½æ‰€æœ‰çˆ¶è¿›ç¨‹ä¸­çš„äº’æ–¥é”ã€‚parentå¥æŸ„åˆ™æ˜¯forkè°ƒç”¨åˆ›å»ºå‡ºå­è¿›ç¨‹ä¹‹åï¼Œè€Œforkè¿”å›ä¹‹å‰ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­è¢«æ‰§è¡Œã€‚å®ƒçš„ä½œç”¨æ˜¯é‡Šæ”¾æ‰€æœ‰åœ¨prepareå¥æŸ„ä¸­è¢«é”ä½çš„äº’æ–¥é”ã€‚childå¥æŸ„æ˜¯forkè¿”å›ä¹‹å‰ï¼Œåœ¨å­è¿›ç¨‹ä¸­è¢«æ‰§è¡Œã€‚å’Œparentå¥æŸ„ä¸€æ ·ï¼Œchildå¥æŸ„ä¹Ÿæ˜¯ç”¨äºé‡Šæ”¾æ‰€æœ‰åœ¨prepareå¥æŸ„ä¸­è¢«é”ä½çš„äº’æ–¥é”ã€‚è¯¥å‡½æ•°æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç  forkè°ƒç”¨å‰åŠ å…¥ä»£ç  1234567void prepare()&#123; pthread_mutex_lock(ï¼†mutex);&#125;void infork()&#123; pthread_mutex_unlock(ï¼†mutex);&#125;pthread_atfork(prepare,infork,infork); çº¿ç¨‹å’Œä¿¡å·æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°è®¾ç½®ä¿¡å·æ©ç ã€‚æˆ‘ä»¬è®¨è®ºè¿‡è®¾ç½®è¿›ç¨‹ä¿¡å·æ©ç çš„å‡½æ•°sigprocmaskï¼Œä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„pthreadç‰ˆæœ¬çš„sigprocmaskå‡½æ•°æ¥è®¾ç½®çº¿ç¨‹ä¿¡å·æ©ç ï¼š 123#includeï¼œpthread.hï¼#includeï¼œsignal.hï¼int pthread_sigmask(int how,const sigset_t*newmask,sigset_t*oldmask); è¯¥å‡½æ•°çš„å‚æ•°çš„å«ä¹‰ä¸sigprocmaskçš„å‚æ•°å®Œå…¨ç›¸åŒï¼Œå› æ­¤ä¸å†èµ˜è¿°ã€‚pthread_sigmaskæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ ç”±äºè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„ä¿¡å·ï¼Œæ‰€ä»¥çº¿ç¨‹åº“å°†æ ¹æ®çº¿ç¨‹æ©ç å†³å®šæŠŠä¿¡å·å‘é€ç»™å“ªä¸ªå…·ä½“çš„çº¿ç¨‹ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªå­çº¿ç¨‹ä¸­éƒ½å•ç‹¬è®¾ç½®ä¿¡å·æ©ç ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´é€»è¾‘é”™è¯¯ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ä¿¡å·å¤„ç†å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è®¾ç½®äº†æŸä¸ªä¿¡å·çš„ä¿¡å·å¤„ç†å‡½æ•°åï¼Œå®ƒå°†è¦†ç›–å…¶ä»–çº¿ç¨‹ä¸ºåŒä¸€ä¸ªä¿¡å·è®¾ç½®çš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚è¿™ä¸¤ç‚¹éƒ½è¯´æ˜ï¼Œæˆ‘ä»¬åº”è¯¥å®šä¹‰ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰çš„ä¿¡å·ã€‚è¿™å¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤æ¥å®ç° åœ¨ä¸»çº¿ç¨‹åˆ›å»ºå‡ºå…¶ä»–å­çº¿ç¨‹ä¹‹å‰å°±è°ƒç”¨pthread_sigmaskæ¥è®¾ç½®å¥½ä¿¡å·æ©ç ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å­çº¿ç¨‹éƒ½å°†è‡ªåŠ¨ç»§æ‰¿è¿™ä¸ªä¿¡å·æ©ç ã€‚è¿™æ ·åšä¹‹åï¼Œå®é™…ä¸Šæ‰€æœ‰çº¿ç¨‹éƒ½ä¸ä¼šå“åº”è¢«å±è”½çš„ä¿¡å·äº† åœ¨æŸä¸ªçº¿ç¨‹ä¸­è°ƒç”¨å¦‚ä¸‹å‡½æ•°æ¥ç­‰å¾…ä¿¡å·å¹¶å¤„ç†ä¹‹ 12#includeï¼œsignal.hï¼int sigwait(const sigset_t*set,int*sig); setå‚æ•°æŒ‡å®šéœ€è¦ç­‰å¾…çš„ä¿¡å·çš„é›†åˆã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å…¶æŒ‡å®šä¸ºåœ¨ç¬¬1æ­¥ä¸­åˆ›å»ºçš„ä¿¡å·æ©ç ï¼Œè¡¨ç¤ºåœ¨è¯¥çº¿ç¨‹ä¸­ç­‰å¾…æ‰€æœ‰è¢«å±è”½çš„ä¿¡å·ã€‚å‚æ•°sigæŒ‡å‘çš„æ•´æ•°ç”¨äºå­˜å‚¨è¯¥å‡½æ•°è¿”å›çš„ä¿¡å·å€¼ã€‚sigwaitæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç ã€‚ä¸€æ—¦sigwaitæ­£ç¡®è¿”å›ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ¥æ”¶åˆ°çš„ä¿¡å·åšå¤„ç†äº†ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†sigwaitï¼Œå°±ä¸åº”è¯¥å†ä¸ºä¿¡å·è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°äº†ã€‚è¿™æ˜¯å› ä¸ºå½“ç¨‹åºæ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼ŒäºŒè€…ä¸­åªèƒ½æœ‰ä¸€ä¸ªèµ·ä½œç”¨ã€‚ ä»£ç å–è‡ªpthread_sigmaskå‡½æ•°çš„manæ‰‹å†Œã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•é€šè¿‡ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤å®ç°åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ç»Ÿä¸€å¤„ç†æ‰€æœ‰ä¿¡å·ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;pthread.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;signal.h&gt;#include &lt;errno.h&gt;#define handle_error_en(en, msg) \\ do \\ &#123; \\ errno = en; \\ perror(msg); \\ exit(EXIT_FAILURE); \\ &#125; while (0)static void *sig_thread(void *arg)&#123; sigset_t *set = (sigset_t *)arg; int s, sig; for (;;) &#123; /*ç¬¬äºŒä¸ªæ­¥éª¤ï¼Œè°ƒç”¨sigwaitç­‰å¾…ä¿¡å·*/ s = sigwait(set, &amp;sig); if (s != 0) handle_error_en(s, &quot;sigwait&quot;); printf(&quot;Signal handling thread got signal%d\\n&quot;, sig); &#125;&#125;int main(int argc, char *argv[])&#123; pthread_t thread; sigset_t set; int s; /*ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®ä¿¡å·æ©ç */ sigemptyset(&amp;set); sigaddset(&amp;set, SIGQUIT); sigaddset(&amp;set, SIGUSR1); s = pthread_sigmask(SIG_BLOCK, &amp;set, NULL); if (s != 0) handle_error_en(s, &quot;pthread_sigmask&quot;); s = pthread_create(&amp;thread, NULL, &amp;sig_thread, (void *)&amp;set); if (s != 0) handle_error_en(s, &quot;pthread_create&quot;); pause();&#125; æœ€åï¼Œpthreadè¿˜æä¾›äº†ä¸‹é¢çš„æ–¹æ³•ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å°†ä¸€ä¸ªä¿¡å·å‘é€ç»™æŒ‡å®šçš„çº¿ç¨‹ #includeï¼œsignal.hï¼ int pthread_kill(pthread_t thread,int sig); å…¶ä¸­ï¼Œthreadå‚æ•°æŒ‡å®šç›®æ ‡çº¿ç¨‹ï¼Œsigå‚æ•°æŒ‡å®šå¾…å‘é€çš„ä¿¡å·ã€‚å¦‚æœsigä¸º0ï¼Œåˆ™pthread_killä¸å‘é€ä¿¡å·ï¼Œä½†å®ƒä»»ç„¶ä¼šæ‰§è¡Œé”™è¯¯æ£€æŸ¥ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹å¼æ¥æ£€æµ‹ç›®æ ‡çº¿ç¨‹æ˜¯å¦å­˜åœ¨ã€‚pthread_killæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›é”™è¯¯ç  è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡åŠ¨æ€åˆ›å»ºå­è¿›ç¨‹ï¼ˆæˆ–å­çº¿ç¨‹ï¼‰æ¥å®ç°å¹¶å‘æœåŠ¡å™¨çš„ã€‚è¿™æ ·åšæœ‰å¦‚ä¸‹ç¼ºç‚¹ åŠ¨æ€åˆ›å»ºè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰æ˜¯æ¯”è¾ƒè€—è´¹æ—¶é—´çš„ï¼Œè¿™å°†å¯¼è‡´è¾ƒæ…¢çš„å®¢æˆ·å“åº”ã€‚ åŠ¨æ€åˆ›å»ºçš„å­è¿›ç¨‹ï¼ˆæˆ–å­çº¿ç¨‹ï¼‰é€šå¸¸åªç”¨æ¥ä¸ºä¸€ä¸ªå®¢æˆ·æœåŠ¡ï¼ˆé™¤éæˆ‘ä»¬åšç‰¹æ®Šçš„å¤„ç†ï¼‰ï¼Œè¿™å°†å¯¼è‡´ç³»ç»Ÿä¸Šäº§ç”Ÿå¤§é‡çš„ç»†å¾®è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ã€‚è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰é—´çš„åˆ‡æ¢å°†æ¶ˆè€—å¤§é‡CPUæ—¶é—´ åŠ¨æ€åˆ›å»ºçš„å­è¿›ç¨‹æ˜¯å½“å‰è¿›ç¨‹çš„å®Œæ•´æ˜ åƒã€‚å½“å‰è¿›ç¨‹å¿…é¡»è°¨æ…åœ°ç®¡ç†å…¶åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦å’Œå †å†…å­˜ç­‰ç³»ç»Ÿèµ„æºï¼Œå¦åˆ™å­è¿›ç¨‹å¯èƒ½å¤åˆ¶è¿™äº›èµ„æºï¼Œä»è€Œä½¿ç³»ç»Ÿçš„å¯ç”¨èµ„æºæ€¥å‰§ä¸‹é™ï¼Œè¿›è€Œå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± æ¦‚è¿°è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± ç›¸ä¼¼ï¼Œä»¥è¿›ç¨‹æ± ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚ æ•°ç›® è¿›ç¨‹æ± æ˜¯ç”±æœåŠ¡å™¨é¢„å…ˆåˆ›å»ºçš„ä¸€ç»„å­è¿›ç¨‹ï¼Œè¿™äº›å­è¿›ç¨‹çš„æ•°ç›®åœ¨3ï½10ä¸ªä¹‹é—´ï¼ˆå…¸å‹æƒ…å†µï¼‰ã€‚ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡åº”è¯¥å’ŒCPUæ•°é‡å·®ä¸å¤šã€‚ è¿›ç¨‹æ± ä¸­çš„æ‰€æœ‰å­è¿›ç¨‹éƒ½è¿è¡Œç€ç›¸åŒçš„ä»£ç ï¼Œå¹¶å…·æœ‰ç›¸åŒçš„å±æ€§ï¼Œæ¯”å¦‚ä¼˜å…ˆçº§ã€PGIDç­‰ã€‚å› ä¸ºè¿›ç¨‹æ± åœ¨æœåŠ¡å™¨å¯åŠ¨ä¹‹åˆå°±åˆ›å»ºå¥½äº†ï¼Œæ‰€ä»¥æ¯ä¸ªå­è¿›ç¨‹éƒ½ç›¸å¯¹â€œå¹²å‡€â€ï¼Œæ²¡æœ‰æ‰“å¼€ä¸å¿…è¦çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆä»çˆ¶è¿›ç¨‹ç»§æ‰¿è€Œæ¥ï¼‰ï¼Œä¹Ÿä¸ä¼šé”™è¯¯åœ°ä½¿ç”¨å¤§å—çš„å †å†…å­˜ï¼ˆä»çˆ¶è¿›ç¨‹å¤åˆ¶å¾—åˆ°ï¼‰ã€‚ ä»»åŠ¡åˆ†é… ä¸»è¿›ç¨‹ä½¿ç”¨æŸç§ç®—æ³•æ¥ä¸»åŠ¨é€‰æ‹©å­è¿›ç¨‹ã€‚æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„ç®—æ³•æ˜¯éšæœºç®—æ³•å’ŒRound Robinï¼ˆè½®æµé€‰å–ï¼‰ç®—æ³•ï¼Œä½†æ›´å¥½çš„ç®—æ³•å‡åŒ€åˆ†é…ä»»åŠ¡åˆ°å·¥ä½œçº¿ç¨‹ ä¸»è¿›ç¨‹å’Œæ‰€æœ‰å­è¿›ç¨‹é€šè¿‡ä¸€ä¸ªå…±äº«çš„å·¥ä½œé˜Ÿåˆ—æ¥åŒæ­¥ï¼Œå­è¿›ç¨‹éƒ½ç¡çœ åœ¨è¯¥å·¥ä½œé˜Ÿåˆ—ä¸Šã€‚å½“æœ‰æ–°çš„ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œä¸»è¿›ç¨‹å°†ä»»åŠ¡æ·»åŠ åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚è¿™å°†å”¤é†’æ­£åœ¨ç­‰å¾…ä»»åŠ¡çš„å­è¿›ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªå­è¿›ç¨‹å°†è·å¾—æ–°ä»»åŠ¡çš„â€œæ¥ç®¡æƒâ€ï¼Œå®ƒå¯ä»¥ä»å·¥ä½œé˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œä¹‹ ä»»åŠ¡é€šçŸ¥å’Œæ•°æ®ä¼ é€’ ä»»åŠ¡åˆ†é…ä¹‹åï¼Œä¸»è¿›ç¨‹è¿˜éœ€è¦å‘Šè¯‰ç›®æ ‡å­è¿›ç¨‹æœ‰æ–°ä»»åŠ¡éœ€è¦å¤„ç†ï¼Œå¹¶ä¼ é€’å¿…è¦çš„æ•°æ®ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼Œåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´é¢„å…ˆå»ºç«‹å¥½ä¸€æ¡ç®¡é“ï¼Œç„¶åé€šè¿‡è¯¥ç®¡é“æ¥å®ç°æ‰€æœ‰çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆå½“ç„¶ï¼Œè¦é¢„å…ˆå®šä¹‰å¥½ä¸€å¥—åè®®æ¥è§„èŒƒç®¡é“çš„ä½¿ç”¨ï¼‰ã€‚ åœ¨çˆ¶çº¿ç¨‹å’Œå­çº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®å°±è¦ç®€å•å¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ•°æ®å®šä¹‰ä¸ºå…¨å±€çš„ï¼Œé‚£ä¹ˆå®ƒä»¬æœ¬èº«å°±æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ã€‚ å¤„ç†å¤šå®¢æˆ· ç›‘å¬socketå’Œè¿æ¥socketæ˜¯å¦éƒ½ç”±ä¸»è¿›ç¨‹æ¥ç»Ÿä¸€ç®¡ç† åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼æ˜¯ç”±ä¸»è¿›ç¨‹ç»Ÿä¸€ç®¡ç†è¿™ä¸¤ç§socketçš„ é«˜æ•ˆçš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ï¼Œä»¥åŠé¢†å¯¼è€…&#x2F;è¿½éšè€…æ¨¡å¼ï¼Œåˆ™æ˜¯ç”±ä¸»è¿›ç¨‹ç®¡ç†æ‰€æœ‰ç›‘å¬socketï¼Œè€Œå„ä¸ªå­è¿›ç¨‹åˆ†åˆ«ç®¡ç†å±äºè‡ªå·±çš„è¿æ¥socketçš„ å¯¹äºå‰ä¸€ç§æƒ…å†µï¼Œä¸»è¿›ç¨‹æ¥å—æ–°çš„è¿æ¥ä»¥å¾—åˆ°è¿æ¥socketï¼Œç„¶åå®ƒéœ€è¦å°†è¯¥socketä¼ é€’ç»™å­è¿›ç¨‹ï¼ˆå¯¹äºçº¿ç¨‹æ± è€Œè¨€ï¼Œçˆ¶çº¿ç¨‹å°†socketä¼ é€’ç»™å­çº¿ç¨‹æ˜¯å¾ˆç®€å•çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å…±äº«è¯¥socketã€‚ä½†å¯¹äºè¿›ç¨‹æ± è€Œè¨€ï¼Œæˆ‘ä»¬å¿…é¡»ä¼ é€’è¯¥socketï¼‰ã€‚ åä¸€ç§æƒ…å†µçš„çµæ´»æ€§æ›´å¤§ä¸€äº›ï¼Œå› ä¸ºå­è¿›ç¨‹å¯ä»¥è‡ªå·±è°ƒç”¨acceptæ¥æ¥å—æ–°çš„è¿æ¥ï¼Œè¿™æ ·çˆ¶è¿›ç¨‹å°±æ— é¡»å‘å­è¿›ç¨‹ä¼ é€’socketï¼Œè€Œåªéœ€è¦ç®€å•åœ°é€šçŸ¥ä¸€å£°ï¼šâ€œæˆ‘æ£€æµ‹åˆ°æ–°çš„è¿æ¥ï¼Œä½ æ¥æ¥å—å®ƒ ä¸€ä¸ªå®¢æˆ·è¿æ¥ä¸Šçš„æ‰€æœ‰ä»»åŠ¡æ˜¯å¦å§‹ç»ˆç”±ä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç† å¦‚æœè¯´å®¢æˆ·ä»»åŠ¡æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸åŒçš„å­è¿›ç¨‹æ¥ä¸ºè¯¥å®¢æˆ·çš„ä¸åŒè¯·æ±‚æœåŠ¡ å¦‚æœå®¢æˆ·ä»»åŠ¡æ˜¯å­˜åœ¨ä¸Šä¸‹æ–‡å…³ç³»çš„ï¼Œåˆ™æœ€å¥½ä¸€ç›´ç”¨åŒä¸€ä¸ªå­è¿›ç¨‹æ¥ä¸ºä¹‹æœåŠ¡ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸åœ¨å„å­è¿›ç¨‹ä¹‹é—´ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ã€‚æˆ‘ä»¬è®¨è®ºäº†epollçš„EPOLLONESHOTäº‹ä»¶ï¼Œè¿™ä¸€äº‹ä»¶èƒ½å¤Ÿç¡®ä¿ä¸€ä¸ªå®¢æˆ·è¿æ¥åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä»…è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç† åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥è¿›ç¨‹æ± å®ç°ä¸ºäº†é¿å…åœ¨çˆ¶ã€å­è¿›ç¨‹ä¹‹é—´ä¼ é€’æ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬å°†æ¥å—æ–°è¿æ¥çš„æ“ä½œæ”¾åˆ°å­è¿›ç¨‹ä¸­ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¯¹äºè¿™ç§æ¨¡å¼è€Œè¨€ï¼Œä¸€ä¸ªå®¢æˆ·è¿æ¥ä¸Šçš„æ‰€æœ‰ä»»åŠ¡å§‹ç»ˆæ˜¯ç”±ä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423// filename:processpool.h#ifndef PROCESSPOOL_H#define PROCESSPOOL_H#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;assert.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/epoll.h&gt;#include &lt;signal.h&gt;#include &lt;sys/wait.h&gt;#include &lt;sys/stat.h&gt;/*æè¿°ä¸€ä¸ªå­è¿›ç¨‹çš„ç±»ï¼Œm_pidæ˜¯ç›®æ ‡å­è¿›ç¨‹çš„PIDï¼Œm_pipefdæ˜¯çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹é€šä¿¡ç”¨çš„ç®¡é“*/class process&#123;public: process() : m_pid(-1) &#123;&#125;public: pid_t m_pid; int m_pipefd[2];&#125;;/*è¿›ç¨‹æ± ç±»ï¼Œå°†å®ƒå®šä¹‰ä¸ºæ¨¡æ¿ç±»æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ã€‚å…¶æ¨¡æ¿å‚æ•°æ˜¯å¤„ç†é€»è¾‘ä»»åŠ¡çš„ç±»*/template &lt;typename T&gt;class processpool&#123;private: /*å°†æ„é€ å‡½æ•°å®šä¹‰ä¸ºç§æœ‰çš„ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½é€šè¿‡åé¢çš„createé™æ€å‡½æ•°æ¥åˆ›å»º processpoolå®ä¾‹*/ processpool(int listenfd, int process_number = 8);public: /*å•ä½“æ¨¡å¼ï¼Œä»¥ä¿è¯ç¨‹åºæœ€å¤šåˆ›å»ºä¸€ä¸ªprocesspoolå®ä¾‹ï¼Œè¿™æ˜¯ç¨‹åºæ­£ç¡®å¤„ç†ä¿¡å·çš„ å¿…è¦æ¡ä»¶*/ static processpool&lt;T&gt; *create(int listenfd, int process_number = 8) &#123; if (!m_instance) &#123; m_instance = new processpool&lt;T&gt;(listenfd, process_number); &#125; return m_instance; &#125; ï½processpool() &#123; delete[] m_sub_process; &#125; /*å¯åŠ¨è¿›ç¨‹æ± */ void run();private: void setup_sig_pipe(); void run_parent(); void run_child();private: /*è¿›ç¨‹æ± å…è®¸çš„æœ€å¤§å­è¿›ç¨‹æ•°é‡*/ static const int MAX_PROCESS_NUMBER = 16; /*æ¯ä¸ªå­è¿›ç¨‹æœ€å¤šèƒ½å¤„ç†çš„å®¢æˆ·æ•°é‡*/ static const int USER_PER_PROCESS = 65536; /*epollæœ€å¤šèƒ½å¤„ç†çš„äº‹ä»¶æ•°*/ static const int MAX_EVENT_NUMBER = 10000; /*è¿›ç¨‹æ± ä¸­çš„è¿›ç¨‹æ€»æ•°*/ int m_process_number; /*å­è¿›ç¨‹åœ¨æ± ä¸­çš„åºå·ï¼Œä»0å¼€å§‹*/ int m_idx; /*æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªepollå†…æ ¸äº‹ä»¶è¡¨ï¼Œç”¨m_epollfdæ ‡è¯†*/ int m_epollfd; /*ç›‘å¬socket*/ int m_listenfd; /*å­è¿›ç¨‹é€šè¿‡m_stopæ¥å†³å®šæ˜¯å¦åœæ­¢è¿è¡Œ*/ int m_stop; /*ä¿å­˜æ‰€æœ‰å­è¿›ç¨‹çš„æè¿°ä¿¡æ¯*/ process *m_sub_process; /*è¿›ç¨‹æ± é™æ€å®ä¾‹*/ static processpool&lt;T&gt; *m_instance;&#125;;template &lt;typename T&gt;processpool&lt;T&gt; *processpool&lt;T&gt;::m_instance = NULL;/*ç”¨äºå¤„ç†ä¿¡å·çš„ç®¡é“ï¼Œä»¥å®ç°ç»Ÿä¸€äº‹ä»¶æºã€‚åé¢ç§°ä¹‹ä¸ºä¿¡å·ç®¡é“*/static int sig_pipefd[2];static int setnonblocking(int fd)&#123; int old_option = fcntl(fd, F_GETFL); int new_option = old_option | O_NONBLOCK; fcntl(fd, F_SETFL, new_option); return old_option;&#125;static void addfd(int epollfd, int fd)&#123; epoll_event event; event.data.fd = fd; event.events = EPOLLIN | EPOLLET; epoll_ctl(epollfd, EPOLL_CTL_ADD, fd, &amp;event); setnonblocking(fd);&#125;/*ä»epollfdæ ‡è¯†çš„epollå†…æ ¸äº‹ä»¶è¡¨ä¸­åˆ é™¤fdä¸Šçš„æ‰€æœ‰æ³¨å†Œäº‹ä»¶*/static void removefd(int epollfd, int fd)&#123; epoll_ctl(epollfd, EPOLL_CTL_DEL, fd, 0); close(fd);&#125;static void sig_handler(int sig)&#123; int save_errno = errno; int msg = sig; send(sig_pipefd[1], (char *)&amp;msg, 1, 0); errno = save_errno;&#125;static void addsig(int sig, void(handler)(int), bool restart = true)&#123; struct sigaction sa; memset(&amp;sa, &#x27;\\0&#x27;, sizeof(sa)); sa.sa_handler = handler; if (restart) &#123; sa.sa_flags |= SA_RESTART; &#125; sigfillset(&amp;sa.sa_mask); assert(sigaction(sig, &amp;sa, NULL) != -1);&#125;/*è¿›ç¨‹æ± æ„é€ å‡½æ•°ã€‚å‚æ•°listenfdæ˜¯ç›‘å¬socketï¼Œå®ƒå¿…é¡»åœ¨åˆ›å»ºè¿›ç¨‹æ± ä¹‹å‰è¢«åˆ›å»ºï¼Œå¦åˆ™å­è¿›ç¨‹æ— æ³•ç›´æ¥å¼•ç”¨å®ƒã€‚å‚æ•°process_numberæŒ‡å®šè¿›ç¨‹æ± ä¸­å­è¿›ç¨‹çš„æ•°é‡*/template &lt;typename T&gt;processpool&lt;T&gt;::processpool(int listenfd, int process_number) : m_listenfd(listenfd), m_process_number(process_number), m_idx(-1), m_stop(false)&#123; assert((process_number &gt; 0) &amp;&amp; (process_number &lt; = MAX_PROCESS_NUMBER)); m_sub_process = new process[process_number]; assert(m_sub_process); /*åˆ›å»ºprocess_numberä¸ªå­è¿›ç¨‹ï¼Œå¹¶å»ºç«‹å®ƒä»¬å’Œçˆ¶è¿›ç¨‹ä¹‹é—´çš„ç®¡é“*/ for (int i = 0; i &lt; process_number; ++i) &#123; int ret = socketpair(PF_UNIX, SOCK_STREAM, 0, m_sub_process[i].m_pipefd); assert(ret == 0); m_sub_process[i].m_pid = fork(); assert(m_sub_process[i].m_pid &gt;= 0); if (m_sub_process[i].m_pid &gt; 0) &#123; close(m_sub_process[i].m_pipefd[1]); continue; &#125; else &#123; close(m_sub_process[i].m_pipefd[0]); m_idx = i; break; &#125; &#125;&#125;/*ç»Ÿä¸€äº‹ä»¶æº*/template &lt;typename T&gt;void processpool&lt;T&gt;::setup_sig_pipe()&#123; /*åˆ›å»ºepolläº‹ä»¶ç›‘å¬è¡¨å’Œä¿¡å·ç®¡é“*/ m_epollfd = epoll_create(5); assert(m_epollfd != -1); int ret = socketpair(PF_UNIX, SOCK_STREAM, 0, sig_pipefd); assert(ret != -1); setnonblocking(sig_pipefd[1]); addfd(m_epollfd, sig_pipefd[0]); /*è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°*/ addsig(SIGCHLD, sig_handler); addsig(SIGTERM, sig_handler); addsig(SIGINT, sig_handler); addsig(SIGPIPE, SIG_IGN);&#125;/*çˆ¶è¿›ç¨‹ä¸­m_idxå€¼ä¸º-1ï¼Œå­è¿›ç¨‹ä¸­m_idxå€¼å¤§äºç­‰äº0ï¼Œæˆ‘ä»¬æ®æ­¤åˆ¤æ–­æ¥ä¸‹æ¥è¦è¿è¡Œçš„æ˜¯çˆ¶è¿›ç¨‹ä»£ç è¿˜æ˜¯å­è¿›ç¨‹ä»£ç */template &lt;typename T&gt;void processpool&lt;T&gt;::run()&#123; if (m_idx != -1) &#123; run_child(); return; &#125; run_parent();&#125;template &lt;typename T&gt;void processpool&lt;T&gt;::run_child()&#123; setup_sig_pipe(); /*æ¯ä¸ªå­è¿›ç¨‹éƒ½é€šè¿‡å…¶åœ¨è¿›ç¨‹æ± ä¸­çš„åºå·å€¼m_idxæ‰¾åˆ°ä¸çˆ¶è¿›ç¨‹é€šä¿¡çš„ç®¡é“*/ int pipefd = m_sub_process[m_idx].m_pipefd[1]; /*å­è¿›ç¨‹éœ€è¦ç›‘å¬ç®¡é“æ–‡ä»¶æè¿°ç¬¦pipefdï¼Œå› ä¸ºçˆ¶è¿›ç¨‹å°†é€šè¿‡å®ƒæ¥é€šçŸ¥å­è¿›ç¨‹accept æ–°è¿æ¥*/ addfd(m_epollfd, pipefd); epoll_event events[MAX_EVENT_NUMBER]; T *users = new T[USER_PER_PROCESS]; assert(users); int number = 0; int ret = -1; while (!m_stop) &#123; number = epoll_wait(m_epollfd, events, MAX_EVENT_NUMBER, -1); if ((number &lt; 0) &amp;&amp; (errno != EINTR)) &#123; printf(&quot;epoll failure\\n&quot;); break; &#125; for (int i = 0; i &lt; number; i++) &#123; int sockfd = events[i].data.fd; if ((sockfd == pipefd) &amp;&amp; (events[i].events &amp; EPOLLIN)) &#123; int client = 0; /*ä»çˆ¶ã€å­è¿›ç¨‹ä¹‹é—´çš„ç®¡é“è¯»å–æ•°æ®ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å˜é‡clientä¸­ã€‚å¦‚æœè¯»å–æˆ åŠŸï¼Œåˆ™è¡¨ç¤ºæœ‰æ–°å®¢æˆ·è¿æ¥åˆ°æ¥*/ ret = recv(sockfd, (char *)&amp;client, sizeof(client), 0); if (((ret &lt; 0) &amp;&amp; (errno != EAGAIN)) || ret == 0) &#123; continue; &#125; else &#123; struct sockaddr_in client_address; socklen_t client_addrlength = sizeof(client_address); int connfd = accept(m_listenfd, (struct sockaddr *)&amp;client_address, &amp;client_addrlength); if (connfd &lt; 0) &#123; printf(&quot;errno is:%d\\n&quot;, errno); continue; &#125; addfd(m_epollfd, connfd); /*æ¨¡æ¿ç±»Tå¿…é¡»å®ç°initæ–¹æ³•ï¼Œä»¥åˆå§‹åŒ–ä¸€ä¸ªå®¢æˆ·è¿æ¥ã€‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨connfdæ¥ç´¢å¼• é€»è¾‘å¤„ç†å¯¹è±¡ï¼ˆTç±»å‹çš„å¯¹è±¡ï¼‰ï¼Œä»¥æé«˜ç¨‹åºæ•ˆç‡*/ users[connfd].init(m_epollfd, connfd, client_address); &#125; &#125; /*ä¸‹é¢å¤„ç†å­è¿›ç¨‹æ¥æ”¶åˆ°çš„ä¿¡å·*/ else if ((sockfd == sig_pipefd[0]) &amp;&amp; (events[i].events &amp; EPOLLIN)) &#123; int sig; char signals[1024]; ret = recv(sig_pipefd[0], signals, sizeof(signals), 0); if (ret &lt;= 0) &#123; continue; &#125; else &#123; for (int i = 0; i &lt; ret; ++i) &#123; switch (signals[i]) &#123; case SIGCHLD: &#123; pid_t pid; int stat; while ((pid = waitpid(-1, &amp;stat, WNOHANG)) &gt; 0) &#123; continue; &#125; break; &#125; case SIGTERM: case SIGINT: &#123; m_stop = true; break; &#125; default: &#123; break; &#125; &#125; &#125; &#125; &#125; /*å¦‚æœæ˜¯å…¶ä»–å¯è¯»æ•°æ®ï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯å®¢æˆ·è¯·æ±‚åˆ°æ¥ã€‚è°ƒç”¨é€»è¾‘å¤„ç†å¯¹è±¡çš„processæ–¹æ³• å¤„ç†ä¹‹*/ else if (events[i].events &amp; EPOLLIN) &#123; users[sockfd].process(); &#125; else &#123; continue; &#125; &#125; &#125; delete[] users; users = NULL; close(pipefd); // close(m_listenfd);è¿™å¥è¯æ³¨é‡Šæ‰ï¼Œä»¥æé†’è¯»è€…ï¼šåº”è¯¥ç”±m_listenfdçš„åˆ›å»ºè€…æ¥å…³é—­è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆè§åæ–‡ï¼‰, // å³æ‰€è°“çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåˆæˆ–è€…ä¸€æ®µå †å†…å­˜ï¼‰ç”±å“ªä¸ªå‡½æ•°åˆ›å»ºï¼Œå°±åº”è¯¥ç”±å“ªä¸ªå‡½æ•°é”€æ¯â€*/ close(m_epollfd);&#125;template &lt;typename T&gt;void processpool&lt;T&gt;::run_parent()&#123; setup_sig_pipe(); /*çˆ¶è¿›ç¨‹ç›‘å¬m_listenfd*/ addfd(m_epollfd, m_listenfd); epoll_event events[MAX_EVENT_NUMBER]; int sub_process_counter = 0; int new_conn = 1; int number = 0; int ret = -1; while (!m_stop) &#123; number = epoll_wait(m_epollfd, events, MAX_EVENT_NUMBER, -1); if ((number &lt; 0) &amp;&amp; (errno != EINTR)) &#123; printf(&quot;epoll failure\\n&quot;); break; &#125; for (int i = 0; i &lt; number; i++) &#123; int sockfd = events[i].data.fd; if (sockfd == m_listenfd) &#123; /*å¦‚æœæœ‰æ–°è¿æ¥åˆ°æ¥ï¼Œå°±é‡‡ç”¨Round Robinæ–¹å¼å°†å…¶åˆ†é…ç»™ä¸€ä¸ªå­è¿›ç¨‹å¤„ç†*/ int i = sub_process_counter; do &#123; if (m_sub_process[i].m_pid != -1) &#123; break; &#125; i = (i + 1) % m_process_number; &#125; while (i != sub_process_counter); if (m_sub_process[i].m_pid == -1) &#123; m_stop = true; break; &#125; sub_process_counter = (i + 1) % m_process_number; send(m_sub_process[i].m_pipefd[0], (char *)&amp;new_conn, sizeof(new_conn), 0); printf(&quot;send request to child%d\\n&quot;, i); &#125; /*ä¸‹é¢å¤„ç†çˆ¶è¿›ç¨‹æ¥æ”¶åˆ°çš„ä¿¡å·*/ else if ((sockfd == sig_pipefd[0]) &amp;&amp; (events[i].events &amp; EPOLLIN)) &#123; int sig; char signals[1024]; ret = recv(sig_pipefd[0], signals, sizeof(signals), 0); if (ret &lt;= 0) &#123; continue; &#125; else &#123; for (int i = 0; i &lt; ret; ++i) &#123; switch (signals[i]) &#123; case SIGCHLD: &#123; pid_t pid; int stat; while ((pid = waitpid(-1, &amp;stat, WNOHANG)) &gt; 0) &#123; for (int i = 0; i &lt; m_process_number; ++i) &#123; /*å¦‚æœè¿›ç¨‹æ± ä¸­ç¬¬iä¸ªå­è¿›ç¨‹é€€å‡ºäº†ï¼Œåˆ™ä¸»è¿›ç¨‹å…³é—­ç›¸åº”çš„é€šä¿¡ç®¡é“ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„ m_pidä¸º-1ï¼Œä»¥æ ‡è®°è¯¥å­è¿›ç¨‹å·²ç»é€€å‡º*/ if (m_sub_process[i].m_pid == pid) &#123; printf(&quot;child%d join\\n&quot;, i); close(m_sub_process[i].m_pipefd[0]); m_sub_process[i].m_pid = -1; &#125; &#125; &#125; /*å¦‚æœæ‰€æœ‰å­è¿›ç¨‹éƒ½å·²ç»é€€å‡ºäº†ï¼Œåˆ™çˆ¶è¿›ç¨‹ä¹Ÿé€€å‡º*/ m_stop = true; for (int i = 0; i &lt; m_process_number; ++i) &#123; if (m_sub_process[i].m_pid != -1) &#123; m_stop = false; &#125; &#125; break; &#125; case SIGTERM: case SIGINT: &#123; /*å¦‚æœçˆ¶è¿›ç¨‹æ¥æ”¶åˆ°ç»ˆæ­¢ä¿¡å·ï¼Œé‚£ä¹ˆå°±æ€æ­»æ‰€æœ‰å­è¿›ç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒä»¬å…¨éƒ¨ç»“æŸã€‚å½“ç„¶ï¼Œ é€šçŸ¥å­è¿›ç¨‹ç»“æŸæ›´å¥½çš„æ–¹æ³•æ˜¯å‘çˆ¶ã€å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ç®¡é“å‘é€ç‰¹æ®Šæ•°æ®ï¼Œè¯»è€…ä¸å¦¨è‡ªå·±å® ç°ä¹‹*/ printf(&quot;kill all the clild now\\n&quot;); for (int i = 0; i &lt; m_process_number; ++i) &#123; int pid = m_sub_process[i].m_pid; if (pid != -1) &#123; kill(pid, SIGTERM); &#125; &#125; break; &#125; default: &#123; break; &#125; &#125; &#125; &#125; &#125; else &#123; continue; &#125; &#125; &#125; // close(m_listenfd);/*ç”±åˆ›å»ºè€…å…³é—­è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆè§åæ–‡ï¼‰*/ close(m_epollfd);&#125;#endif ç”¨è¿›ç¨‹æ± å®ç°çš„ç®€å•CGIæœåŠ¡å™¨åŠåŒæ­¥&#x2F;åŠååº”å †çº¿ç¨‹æ± å®ç°è¯¥çº¿ç¨‹æ± çš„é€šç”¨æ€§è¦é«˜å¾—å¤šï¼Œå› ä¸ºå®ƒä½¿ç”¨ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—å®Œå…¨è§£é™¤äº†ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹çš„è€¦åˆå…³ç³»ï¼šä¸»çº¿ç¨‹å¾€å·¥ä½œé˜Ÿåˆ—ä¸­æ’å…¥ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹é€šè¿‡ç«äº‰æ¥å–å¾—ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒã€‚ä¸è¿‡ï¼Œå¦‚æœè¦å°†è¯¥çº¿ç¨‹æ± åº”ç”¨åˆ°å®é™…æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ä¿è¯æ‰€æœ‰å®¢æˆ·è¯·æ±‚éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œå› ä¸ºåŒä¸€ä¸ªè¿æ¥ä¸Šçš„ä¸åŒè¯·æ±‚å¯èƒ½ä¼šç”±ä¸åŒçš„çº¿ç¨‹å¤„ç†ã€‚ ç”¨çº¿ç¨‹æ± å®ç°çš„ç®€å•WebæœåŠ¡å™¨æˆ‘ä»¬æ›¾ä½¿ç”¨æœ‰é™çŠ¶æ€æœºå®ç°è¿‡ä¸€ä¸ªéå¸¸ç®€å•çš„è§£æHTTPè¯·æ±‚çš„æœåŠ¡å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°†åˆ©ç”¨å‰é¢ä»‹ç»çš„çº¿ç¨‹æ± æ¥é‡æ–°å®ç°ä¸€ä¸ªå¹¶å‘çš„WebæœåŠ¡å™¨","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[]},{"title":"æ–‡å¿ƒä¸€è¨€","slug":"source/åç«¯/æ–‡å¿ƒä¸€è¨€api","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2025/03/02/source/åç«¯/æ–‡å¿ƒä¸€è¨€api/","permalink":"http://example.com/2025/03/02/source/%E5%90%8E%E7%AB%AF/%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80api/","excerpt":"","text":"ç™»å½•ç™¾åº¦æ™ºèƒ½äº‘è´¦å·å¹¶å®å ç™¾åº¦æ™ºèƒ½äº‘-äº‘æ™ºä¸€ä½“æ·±å…¥äº§ä¸š (baidu.com) è®¿é—®åƒå¸†å¹³å°-ç«‹å³ä½¿ç”¨ç™¾åº¦æ™ºèƒ½äº‘åƒå¸†å¤§æ¨¡å‹å¹³å°ModelBuilder (baidu.com) æˆ–è€…ç™¾åº¦æ™ºèƒ½äº‘æ§åˆ¶å° (baidu.com) åº”ç”¨æ¥å…¥-åˆ›å»ºåº”ç”¨-è·å–api keyå’ŒSecret key è·å–access_token ä¸€ä¸ªæœˆæœ‰æ•ˆ æ›¿æ¢ä¸‹æ–¹å‚æ•°æµè§ˆå™¨è®¿é—®å³å¯æˆ–è€…çœ‹ä»£ç ç¤ºä¾‹è¯·æ±‚ https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=[API Key]&amp;client_secret&#x3D;[Secret Key] apiæ–‡æ¡£APIåˆ—è¡¨ - åƒå¸†å¤§æ¨¡å‹å¹³å° | ç™¾åº¦æ™ºèƒ½äº‘æ–‡æ¡£ (baidu.com) ä»£ç ç¤ºä¾‹ä¸­å¿ƒç™¾åº¦æ™ºèƒ½äº‘æ§åˆ¶å° (baidu.com)","categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"}],"tags":[{"name":"æ–‡å¿ƒä¸€è¨€","slug":"æ–‡å¿ƒä¸€è¨€","permalink":"http://example.com/tags/%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/"}]},{"title":"è®¡ç®—æœºç»„æˆåŸç†","slug":"source/åŸºç¡€å››å¤§ä»¶/è®¡ç®—æœºç»„æˆåŸç†","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2025/03/02/source/åŸºç¡€å››å¤§ä»¶/è®¡ç®—æœºç»„æˆåŸç†/","permalink":"http://example.com/2025/03/02/source/%E5%9F%BA%E7%A1%80%E5%9B%9B%E5%A4%A7%E4%BB%B6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/","excerpt":"","text":"è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°##è®¡ç®—æœºå‘å±•å†ç¨‹ ä»€ä¹ˆæ˜¯è®¡ç®—æœºç³»ç»Ÿï¼Ÿ ç¡¬ä»¶+è½¯ä»¶(ç³»ç»Ÿè½¯ä»¶ åº”ç”¨è½¯ä»¶) ç¡¬ä»¶çš„å‘å±• ç¬¬ä¸€å°è®¡ç®—æœº ENIAC 1946 å†¯è¯ºä¾æ›¼é¡¾é—® é€»è¾‘å…ƒä»¶ 1.8wä¸ªç”µå­ç®¡ æœºå™¨è¯­è¨€ç¼–ç¨‹-çº¸å¸¦ æœ‰å­”ä¸º0 bugï¼šå°è™«å­ ç¬¬äºŒä»£ è´å°”å®éªŒå®¤å‘æ˜æ™¶ä½“ç®¡ é¢å‘è¿‡ç¨‹è¯­è¨€ï¼šFORTRAN æ“ä½œç³»ç»Ÿ ç¬¬ä¸‰ä»£ ä¸­å°è§„æ¨¡é›†æˆç”µè·¯ é«˜çº§è¯­è¨€ åˆ†æ—¶æ“ä½œç³»ç»Ÿ ç¬¬å››ä»£ å¤§è§„æ¨¡ï¼Œè¶…å¤§è§„æ¨¡é›†æˆç”µè·¯ æ‘©å°”å®šå¾‹ï¼šé›†æˆç”µè·¯çš„æ™¶ä½“ç®¡éš”18ä¸ªæœˆèƒ½å¢å¼ºä¸€å€ï¼Œæ€§èƒ½å¢å¼ºä¸€å€ ###è®¡ç®—æœºç¡¬ä»¶çš„åŸºæœ¬ç»„æˆ æ—©æœŸå†¯è¯ºä¾æ›¼ç»“æ„ ç¬¬ä¸€ä»£ENIACéœ€è¦æ‰‹åŠ¨æ¥çº¿è¾“å…¥æŒ‡ä»¤ï¼Œä»–æå‡ºå­˜å‚¨ç¨‹åºï¼šå°†æŒ‡ä»¤ä»¥äºŒè¿›åˆ¶ä»£ç çš„å½¢å¼äº‹å…ˆè¾“å…¥åˆ°è®¡ç®—æœºçš„ä¸»å­˜å‚¨å™¨ ä»¥è¿ç®—å™¨ä¸ºä¸­å¿ƒå¯¼è‡´æ•ˆç‡é™ä½ ä¸»å­˜æ˜¯å†…å­˜ è¾…å­˜æ˜¯ç¡¬ç›˜ å„ä¸ªç¡¬ä»¶çš„å·¥ä½œåŸç† &#x3D;&#x3D;ä¸»å­˜å‚¨å™¨&#x3D;&#x3D;çš„åŸºæœ¬ç»„æˆï¼šå­˜å‚¨ä½“ + MAR(å­˜å‚¨åœ°å€å¯„å­˜å™¨) + MDR(å­˜å‚¨æ•°æ®å¯„å­˜å™¨) MARç»™å‡ºæ‰€éœ€æ•°æ®çš„åœ°å€ï¼Œæ‹¿åˆ°æ•°æ®åæ”¾åˆ°MDR å­˜å‚¨å­—é•¿æ˜¯8çš„æ•´æ•°å€ ç”µå­å…ƒä»¶æ˜¯ç”µå®¹ MARçš„ä½æ•°ååº”å­˜å‚¨å•å…ƒçš„ä¸ªæ•° MAR 4ä½è¡¨ç¤ºä¸€å…±2^4ä¸ªå­˜å‚¨å•å…ƒ MDRä½æ•°&#x3D;å­˜å‚¨å­—é•¿ 16ä½MDR æ¯ä¸ªå•å…ƒå¯æ”¾16bit 1ä¸ªå­—&#x3D;16bit (è¿™é‡Œçš„å­—ä¸æ˜¯å­—èŠ‚(B)8bit) 100MbpsæŒ‡çš„æ˜¯ä¸‹è½½é€Ÿåº¦100M bit&#x2F;s ä¸‹è½½å™¨100&#x2F;8M B&#x2F;s &#x3D;&#x3D;è¿ç®—å™¨&#x3D;&#x3D; ACC + MQ + X + ALU ä½œç”¨ï¼šç®—æœ¯ï¼Œé€»è¾‘è¿ç®— ACC å¯„å­˜å™¨&#x2F;ç´¯åŠ å™¨ å­˜æ“ä½œæ•°æˆ–è¿ç®—ç»“æœ MQ ä¹˜é™¤æ—¶å­˜æ“ä½œæ•°æˆ–è¿ç®—ç»“æœ X é€šç”¨å¯„å­˜å™¨ å­˜æ“ä½œæ•° ALU ï¼ˆæ ¸å¿ƒï¼‰ç®—æœ¯é€»è¾‘å•å…ƒ å®ç°ç®—æœ¯å’Œé€»è¾‘è¿ç®— äº†è§£ä¸€ä¸‹ &#x3D;&#x3D;æ§åˆ¶å™¨&#x3D;&#x3D; CU æ§åˆ¶å•å…ƒ åˆ†ææŒ‡ä»¤ï¼Œç»™å‡ºæ§åˆ¶ä¿¡å· IR æŒ‡ä»¤å¯„å­˜å™¨ å­˜å½“å‰æ‰§è¡Œçš„æŒ‡å®š PC ç¨‹åºè®¡æ•°å™¨ å­˜ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ è‡ª+1 é¡ºåº PC-&gt;IR-&gt;CU PCå–å®ŒæŒ‡ä»¤åï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€2 å¤šçº§å±‚æ¬¡ç»“æ„ é«˜çº§è¯­è¨€ æ±‡ç¼–è¯­è¨€ æœºå™¨è¯­è¨€ ç¼–è¯‘ç¨‹åºï¼šé«˜çº§è¯­è¨€å…¨éƒ¨è¯‘ä¸ºæ±‡ç¼–è¯­è¨€æˆ–æœºå™¨è¯­è¨€ æ±‡ç¼–ç¨‹åºï¼šæ±‡ç¼–åˆ°æœºå™¨ è§£é‡Šç¨‹åºï¼šé«˜çº§åˆ°æœºå™¨ ç¿»è¯‘ä¸€å¥æ‰§è¡Œä¸€å¥ è®¡ç®—æœºçš„æ€§èƒ½æŒ‡æ ‡###å­˜å‚¨å™¨æ€§èƒ½æŒ‡æ ‡ ä¸»å­˜å‚¨å™¨æ€»å®¹é‡ï¼šMAR32ä½ MDR8ä½ 2^32*8bit&#x3D;4GB MARä½æ•°ååº”å­˜å‚¨å•å…ƒçš„ä¸ªæ•° MDRä½æ•°ååº”æ¯ä¸ªå­˜å‚¨å•å…ƒçš„å¤§å° CPUä¸»é¢‘ CPUæ•°å­—è„‰å†²ä¿¡å·éœ‡è¡çš„é¢‘ç‡ xGHz è¶Šé«˜cpuå¤„ç†è¶Šå¿« CPI æ¯æ¡æŒ‡ä»¤çš„æ‰§è¡Œéœ€è¦å¤šå°‘ä¸ªæ—¶é’Ÿå‘¨æœŸ 1000Hz 100æ¡æŒ‡ä»¤ å¹³å‡CPI&#x3D;3 éœ€è¦æ‰§è¡Œå¤šä¹…ï¼Ÿ 100*3*1&#x2F;1000&#x3D;0.3s IPS æ¯ç§’å¤šå°‘æ¡æŒ‡ä»¤ ä¸»é¢‘&#x2F;CPI FLOPS æ¯ç§’å¤šå°‘æ¬¡æµ®ç‚¹è¿ç®— å‰é¢å¯ä»¥åŠ K M G T åˆ†åˆ«æ˜¯10çš„ 3 6 9 12æ¬¡æ–¹ æ–‡ä»¶å¤§å° 2^10 K 2^20 M 2^30 G 2^40 T ç³»ç»Ÿæ•´ä½“æ€§èƒ½æŒ‡æ ‡æ•°æ®é€šè·¯å¸¦å®½ï¼šæ•°æ®æ€»çº¿ä¸€æ¬¡èƒ½å¹¶è¡Œä¼ é€’ä¿¡æ¯çš„ä½æ•° ååé‡ï¼šç³»ç»Ÿå•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°é‡ å“åº”æ—¶é—´ï¼šå‘è®¡ç®—æœºå‘é€è¯·æ±‚åˆ°è·å¾—å“åº”éœ€è¦ç­‰å¾…çš„æ—¶é—´ åŸºå‡†ç¨‹åºï¼šè·‘åˆ†è½¯ä»¶ æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—è¿›ä½è½¬æ¢&#x3D;&#x3D;äºŒè¿›åˆ¶è½¬åŒ–ä¸º8è¿›åˆ¶&#x3D;&#x3D;ï¼šä¸‰ä½ä¸€ç»„ï¼Œï¼ˆåˆ†åˆ«æ˜¯4 2 1*å¯¹åº”ä½å€¼ï¼‰æ¯ç»„è¡¨ç¤º0-7 ï¼Œ å‰é¢ä¸è¶³çš„è¡¥0ï¼Œå°æ•°ç‚¹åçš„æœ€åä¸è¶³çš„è¡¥0 &#x3D;&#x3D;äºŒè¿›åˆ¶è½¬åŒ–ä¸º16è¿›åˆ¶&#x3D;&#x3D;ï¼šå››ä½ä¸€ç»„ &#x3D;&#x3D;åå…­è¿›åˆ¶ï¼Œå…«è¿›åˆ¶è½¬åŒ–ä¸ºäºŒè¿›åˆ¶&#x3D;&#x3D;ï¼šæ¯ä¸ªæ•°å­—æˆ–å­—æ¯è½¬åŒ–ä¸ºå››ä½æˆ–ä¸‰ä½äºŒè¿›åˆ¶ï¼Œå»æ‰å¤´å°¾çš„0 &#x3D;&#x3D;ç¬¦å·è¡¨ç¤º&#x3D;&#x3D; åå…­è¿›åˆ¶ï¼š(1652)16 1652H 0x1652 äºŒè¿›åˆ¶ B åè¿›åˆ¶ D &#x3D;&#x3D;åè¿›åˆ¶è½¬ä¸ºå…¶ä»–è¿›åˆ¶&#x3D;&#x3D; æ•´æ•°éƒ¨åˆ† å°æ•°éƒ¨åˆ† æ— é™å¾ªç¯ BCDç &#x3D;&#x3D;8421ç &#x3D;&#x3D;ï¼šæ¯ä½åè¿›åˆ¶æ•°ç”¨å››ä½äºŒè¿›åˆ¶è¡¨ç¤º æƒé‡åˆ†åˆ«ä¸º8 4 2 1 åŠ æ³•ï¼š(æ‰‹ç®—)ï¼š5+8&#x3D;13 ç”¨8421è¡¨ç¤º13 0001 0011 â€‹ ï¼ˆç”µè„‘ï¼‰ï¼š0101+1000&#x3D;1101ä¸åœ¨æ˜ å°„è¡¨é‡Œé¢ åˆ™å†åŠ ä¸Šæ•°å­—å…­çš„BCDç 0110 1101+0110&#x3D;1 0011 &#x3D;&#x3D;ä½™3ç &#x3D;&#x3D;ï¼š8421å¯¹åº”è§„åˆ™+3(0011) &#x3D;&#x3D;2421ç &#x3D;&#x3D;ï¼š5-9é¦–ä½æ˜¯1 ##unsigned unsigned char 1B ASCLLæ˜¯0-127 unsigned short 2B unsigned int 4B &#x3D;&#x3D;å‡æ³•&#x3D;&#x3D;ï¼šå‡æ•°å…¨éƒ¨å–åï¼Œæœ«ä½+1ï¼Œå‡æ³•å˜åŠ æ³• &#x3D;&#x3D;ä½è¿ç®—&#x3D;&#x3D;:é€‚åˆå¯¹æ— ç¬¦å·ç±»å‹å¿«é€Ÿè®¡ç®— æ— ç¬¦å·-åŸç è¡¨ç¤º å†…å­˜ä¸­éƒ½æ˜¯äºŒè¿›åˆ¶ä½†æ˜¯è§£é‡Šçš„æ—¶å€™ä¼šæ ¹æ®å®šä¹‰çš„ç±»å‹ &lt;&lt; å‘å·¦ç§»åŠ¨ä½ä½è¡¥0 å·¦ç§»ä¸€æ¬¡*2 &gt;&gt; å³ç§»,é«˜ä½è¡¥0&#x2F;1 é™¤2 &gt;&gt;&gt; æ— ç¬¦å·å³ç§»,é«˜ä½è¡¥1 ##å¸¦ç¬¦å·æ•´æ•° short 2B int 4B åŸç ï¼Œè¡¥ç ï¼Œåç  åŒä¸€ä¸ªæ•°çš„ä¸åŒè¡¨ç°å½¢å¼ï¼Œå«ä¹‰ç›¸åŒ æœºå™¨å­—é•¿ 64ä½æˆ–è€…32ä½ è¡¨ç¤ºé€šç”¨å¯„å­˜å™¨èƒ½å­˜å¤šå°‘ä½ èƒ½è¿›è¡Œå¤šå°‘ä½çš„å¸¦ç¬¦å·æ•´æ•°çš„è¿ç®— ä»¥8ä½é€šç”¨å¯„å­˜å™¨ä¸ºä¾‹å­ 8ä½æ˜¯æœ€å°å­˜å‚¨å•å…ƒ &#x3D;&#x3D;åŸç &#x3D;&#x3D;ï¼š1ä½ç¬¦å·ä½ 7ä½æ•°å€¼ä½ æœºå™¨å­—é•¿n+1ä½ å¸¦ç¬¦å·æ•´æ•°è¡¨ç¤º -(2^n-1) &lt;&#x3D; x &lt;&#x3D; 2^n-1 +0 ä¸ -0 å«ä¹‰ç›¸åŒ åŸç è¿ç®—ï¼šç¬¦å·ä½ä¸èƒ½å‚ä¸è¿ç®—ï¼Œéœ€è¦è®¾è®¡å¤æ‚çš„ç”µè·¯æ‰èƒ½å¤„ç† &#x3D;&#x3D;è¡¥ç &#x3D;&#x3D;:æ­£æ•°çš„è¡¥ç æ˜¯æœ¬èº«,è´Ÿæ•°æ˜¯å…¶äºŒè¿›åˆ¶å–å+1 åŸç  -&gt; åç  -&gt; è¡¥ç  æ­£æ•° ä¸‰ç§çŠ¶æ€ä¸€æ · è´Ÿæ•° -ç¬¦å·ä½ä¸å˜ æ•°å€¼ä½å–å&gt; åç  -æœ«ä½+1&gt; è¡¥ç  å¿«é€Ÿè½¬æ¢ï¼šè´Ÿæ•°åŸç  -&gt; è¡¥ç  ä»å³å¾€å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª1ï¼Œå·¦è¾¹æ‰€æœ‰çš„æ•°å€¼ä½å–å åŠ æ³•ï¼šå…¨éƒ¨æŒ‰ä½ç›¸åŠ  å‡æ³•ï¼šå‡æ³•çœ‹ä½œåŠ æ³•ï¼ŒA-B&#x3D;A+(-B) æ±‚-Bçš„è¡¥ç ï¼šå…¨éƒ¨ä½å–åï¼Œæœ«å°¾+1 å¿«é€Ÿï¼šä»å³å¾€å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª1ï¼Œå·¦è¾¹æ‰€æœ‰ä½å–å å› æ­¤åŒä¸€å¥—ç”µè·¯å¯ä»¥å®ç°æ— ç¬¦å·å’Œæœ‰ç¬¦å·çš„è¿ç®— æœ€ç»ˆä¸€ä¸ªå­—èŠ‚èŒƒå›´[-128,127) 11111111 -1 (è§„å®š) 11111110 è¡¨ç¤º-2 -1 + -2 11111101 &#x3D; -3 10000001 è¡¨ç¤º-127 10000000 -128 00000000 0 00000001 1 01111111 127 &#x3D;&#x3D;ç‰¹æ€§æ¯”è¾ƒ&#x3D;&#x3D;ï¼šnä½èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ä¸º2^n - 1 n+1ä½ åŸç  [-(2^n - 1) , 2^n - 1] åç  [-(2^n - 1) , 2^n - 1] è¡¥ç  [-2^n , 2^n - 1] æ— ç¬¦å·æ•´æ•° [0 , 2^n+1 - 1] æ˜¯å¦å‘ç”Ÿæº¢å‡ºï¼š-64+(-64) ç”¨åŸç åˆ™æº¢å‡ºï¼Œè¡¥ç åˆ™æ²¡æœ‰æº¢å‡º æ‰€ä»¥éšå¼è½¬åŒ–å°±æ˜¯éè´Ÿæ•°å‰é¢+0ï¼Œè´Ÿæ•°å‰é¢+1,å¼ºåˆ¶è½¬æ¢å°±æ˜¯æŠŠå‰é¢å¤šä½™çš„å­—èŠ‚ç›´æ¥åˆ‡æ‰,æå¤§å¯èƒ½å¯¼è‡´æ•°æ®æ”¹å˜ &#x3D;&#x3D;ç§»ç &#x3D;&#x3D;ï¼šè¡¥ç åŸºç¡€ä¸Šï¼Œç¬¦å·ä½å–å åªèƒ½è¡¨ç¤ºæ•´æ•° ä»¥8ä½ä¸ºä¾‹ï¼Œä»-128åˆ°127 ä»00000000åˆ°11111111 é€šå¸¸ç”¨äºæµ®ç‚¹æ•°çš„é˜¶ç å½“ä¸­ å®šç‚¹å°æ•° å®šç‚¹ï¼šå°æ•°ç‚¹ä½ç½®å›ºå®š å®šç‚¹æ•´æ•°ï¼šæœ‰ç¬¦å·æ•´æ•° åŸç ï¼Œåç ï¼Œè¡¥ç ï¼Œç§»ç  å®šç‚¹å°æ•°ï¼š åŸç ï¼Œåç ï¼Œè¡¥ç  æ•´æ•°.å°æ•° å°æ•°ç‚¹é»˜è®¤åœ¨æ•´æ•°çš„æœ€åï¼Œåœ¨å°æ•°çš„ç¬¦å·ä½åé¢ ç¬¦å·ä½.ä½æƒ 0&#x2F;1.2^-1 2^-2 â€¦ 2^-7 -0.5 0.25 0.125 è½¬æ¢è§„åˆ™ä¸æ•´æ•°ä¸€æ‘¸ä¸€æ · åŠ æ³•å‡æ³•ï¼Œä¸æ•´æ•°çš„è§„åˆ™ä¹Ÿä¸€æ · åŸç  [-(1 - 2^n) , 1 - 2^n] åç  [-(1 - 2^n) , 1 - 2^n] è¡¥ç  [-1 , 1- 2^n] ##ç”µè·¯ ALU ç®—æœ¯é€»è¾‘å•å…ƒ è¾“å…¥ä¿¡å· è¾“å‡ºä¿¡å· æ§åˆ¶ä¿¡å·(cu) -&gt; ç®—æœ¯&#x2F;é€»è¾‘è¿ç®— ALUå¤šå°‘ä½ å¯„å­˜å™¨å°±å¤šå°‘ä½ ä¹Ÿå°±æ˜¯æœºå™¨å­—é•¿ åŸºæœ¬é€»è¾‘è¿ç®—ï¼šä¸ &amp;&amp; æˆ– || é ! å¯¹åº”ä¸‰ä¸ªé—¨ç”µè·¯ * + ä¼˜å…ˆçº§:ä¸ &gt; æˆ– åˆ†é…å¾‹ ç»“åˆå¾‹ å®ç°ç”µè·¯ç®€åŒ– å¼‚æˆ– :ç›¸åŒä¸º0 &#x3D;&#x3D;1ä½å…¨åŠ å™¨ FA&#x3D;&#x3D;: ä¸²è¡ŒåŠ æ³•å™¨:è¿›ä½ä¿¡æ¯ä¿å­˜èµ·æ¥,è®¡ç®—ä¸¤ä¸ªnä½ç›¸åŠ ,ä¸²è¡Œæ‰§è¡Œnæ¬¡,æ¯æ¬¡è¾“å‡ºä¸€ä¸ªç»“æœ å¹¶è¡ŒåŠ æ³•å™¨: &#x3D;&#x3D;å¹¶è¡Œè¿›ä½åŠ æ³•å™¨ CLA&#x3D;&#x3D;:æ¯ä¸ªè¿›ä½å¹¶è¡ŒåŒæ—¶äº§ç”Ÿ &#x3D;&#x3D;è¡¥ç åŠ å‡è¿ç®—å™¨&#x3D;&#x3D;:å‡æ•°å…¨éƒ¨æŒ‰ä½å–å+1 å˜åŠ æ³• ç”¨Subæ§åˆ¶åŠ æ³•æˆ–è€…å‡æ³•,åŠ æ³•ä¸º0,ä¸åšä»»ä½•å¤„ç†,è¿›ä½ä¸º0 å‡æ³•åˆ™è¿›ä½ä¸º0 å‡æ•°å–å,è¿›ä½ä¸º1 æ— ç¬¦å·ä¹Ÿå¯ä»¥ä½¿ç”¨ &#x3D;&#x3D;åŸç çš„åŠ å‡&#x3D;&#x3D;: &#x3D;&#x3D;è¡¥ç çš„åŠ å‡è¿ç®—&#x3D;&#x3D;:ä¸ç”¨è€ƒè™‘ç¬¦å·ä½,ç›´æ¥å‚ä¸è¿ç®— åªæœ‰æ­£æ•°+æ­£æ•° è´Ÿæ•°+è´Ÿæ•° æ‰ä¼šæº¢å‡º æ­£æ•°+æ­£æ•° å¾—åˆ°çš„ç»“æœçœ‹èµ·æ¥æ˜¯è´Ÿæ•° è´Ÿæ•°+è´Ÿæ•° å¾—åˆ°çš„ç»“æœçœ‹èµ·æ¥æ˜¯æ­£æ•° &#x3D;&#x3D;æº¢å‡ºåˆ¤æ–­&#x3D;&#x3D;: æ–¹æ³•ä¸€:vçš„å€¼ä¸º1 åˆ™æœ‰æº¢å‡º ABSåˆ†åˆ«è¡¨ç¤ºABçš„ç¬¦å·å’Œç»“æœçš„ç¬¦å·ä½ æ–¹æ³•äºŒ:ç¬¦å·ä½å¾€æ›´é«˜ä½è¿›ä½ä¸ºCs ç¬¦å·ä½C1 ä»–ä»¬å¼‚æˆ–ä¸º1 åˆ™æº¢å‡º æ–¹æ³•ä¸‰:åŒç¬¦å·ä½:00 11 éƒ½å‚ä¸è¿ç®— ä¸æ³•äºŒä¸€æ · åŒç¬¦å·ä½ :æ¨¡4è¡¥ç  å®é™…ä¹Ÿæ˜¯å­˜ä¸€ä¸ªç¬¦å·ä½,å¦ä¸€ä¸ªæ˜¯è¿ç®—æ—¶å¤åˆ¶çš„ å•ç¬¦å·ä½:æ¨¡2è¡¥ç  ###æ ‡å¿—ä½ OF æœ‰ç¬¦å·è¿ç®—çš„åŠ å‡è¿ç®—æ˜¯å¦æº¢å‡º 1è¡¨ç¤ºæº¢å‡º æœ€é«˜ä½äº§ç”Ÿçš„è¿›ä½ä¸æ¬¡é«˜ä½äº§ç”Ÿçš„è¿›ä½å¼‚æˆ– SF æœ‰ç¬¦å·åŠ å‡è¿ç®—ç»“æœçš„æ­£è´Ÿæ€§ 0è¡¨ç¤ºæ­£æ•° æœ€é«˜ä½çš„è¾“å‡º ZF è¡¨ç¤ºè¿ç®—ç»“æœæ˜¯å¦ä¸º0 ZF1ä¸ºè¡¨ç¤ºç»“æœä¸º0 å…¨0 CF è¡¨ç¤ºæ— ç¬¦å·æ•°çš„åŠ å‡æ³•æ˜¯å¦äº§ç”Ÿäº†è¿›ä½æˆ–è€…å€Ÿä½ 1å‘ç”Ÿ æœ€é«˜ä½çš„è¿›ä½å¼‚æˆ–sub(sub&#x3D;0è¡¨ç¤ºåŠ æ³•) ç§»ä½è¿ç®—ç§»ä½ï¼šæ”¹å˜æ•°ç ä½å’Œå°æ•°ç‚¹çš„ç›¸å¯¹ä½ç½®ï¼Œä»è€Œæ”¹å˜æ•°ç ä½çš„ä½æƒã€‚ å¯ä»¥ç”¨ç®—æœ¯ç§»ä½æ¥å®ç°ä¹˜æ³•å’Œé™¤æ³• ç®—æœ¯ç§»ä½å°æ•°ç‚¹å‰åç§»åŠ¨ï¼Œæ•°*10^n &#x3D;&#x3D;åŸç &#x3D;&#x3D;ï¼šç¬¦å·ä½ä¸å˜ã€‚æ•°å€¼ä½ç§»ä½ å³ç§»ï¼šé«˜ä½è¡¥0ï¼Œä½ä½èˆå¼ƒï¼Œèˆå¼ƒä½ä¸º0ï¼Œç›¸å½“äºÃ·2ï¼Œèˆå¼ƒä¸º1ï¼Œä¸¢å¤±ç²¾åº¦ å·¦ç§»ï¼šä½ä½è¡¥0ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œèˆå¼ƒä½ä¸º0 *2 ä¸º1 ä¸¥é‡è¯¯å·® å®šç‚¹å°æ•°çš„åŸç åŒæ · &#x3D;&#x3D;åç &#x3D;&#x3D;ï¼š æ­£æ•°ä¸åŸç ä¸€æ · è´Ÿæ•°ï¼šè¡¥ä½è¡¥1 &#x3D;&#x3D;è¡¥ç &#x3D;&#x3D;ï¼š æ­£æ•°ï¼šä¸åŸç ä¸€è‡´ è´Ÿæ•°ï¼šè¡¥ä½è§„åˆ™ï¼Œæœ€å³è¾¹çš„1åŠå…¶å³ä¾§åŒåŸç (å³ç§» é«˜ä½è¡¥1)ï¼Œå·¦è¾¹çš„åŒè¡¥ç (å·¦ç§» ä½ä½è¡¥0) é€»è¾‘ç§»ä½é€»è¾‘å³ç§»ï¼šé«˜ä½è¡¥0ï¼Œä½ä½èˆå¼ƒ é€»è¾‘å·¦ç§»ï¼šä½ä½è¡¥0ï¼Œé«˜ä½èˆå¼ƒ çœ‹ä½œæ— ç¬¦å·æ•°çš„ç§»ä½ åº”ç”¨ä¾‹å­ï¼šRGBï¼Œç”¨24ä½æ¥å­˜å‚¨ï¼Œå…ˆç”¨24ä½å¤§å°çš„æ•°ç»„å¡«å……Rï¼Œç„¶åå·¦ç§»16ä½ï¼Œç„¶åä¾æ¬¡å¾—åˆ°ä¸‰ä¸ªæ•°ç»„ï¼Œç›¸åŠ å¾—åˆ°æœ€åçš„è¡¨ç¤º ###å¾ªç¯ç§»ä½ å·¦ç§»çš„æ—¶å€™ç§»é™¤çš„é«˜ä½æ”¾åˆ°æœ€ä½ä½ å¸¦è¿›ä½çš„å¾ªç¯å·¦ç§»ï¼šè¿›ä½ä¿¡æ¯CFä¹Ÿå‚ä¸å¾ªç¯ åº”ç”¨ï¼šé€‚åˆé«˜å­—èŠ‚ä¸ä½å­—èŠ‚çš„è°ƒæ¢ å¦‚å¤§ç«¯å’Œå°ç«¯çš„è°ƒæ¢ ä¹˜é™¤åŸç çš„ä¹˜æ³•è®¡ç®—X*Y è¿ç®—å™¨ä¸­ACC MQ X ALU Xå­˜ |x|çš„åŸç ï¼Œä¹Ÿå°±æ˜¯ç¬¦å·ä½ä¸º0å…¶ä½™ä¸å˜ MQ å­˜æ”¾|Y|çš„åŸç å’Œä¹˜ç§¯ä½ä½ ACC å­˜ä¹˜ç§¯é«˜ä½ æœºå™¨å­—é•¿ä½n+1 åŸç çš„ä¸€ä½ä¹˜æ³• ç¬¦å·ä½å•ç‹¬å¤„ç†ï¼šå¼‚æˆ– æ•°å€¼ä½ç»å¯¹å€¼ç›¸ä¹˜ ä¹˜æ³•ä¹‹å‰ï¼ŒACCæ¸…0ï¼Œç¬¬ä¸€æ¬¡è®¡ç®—ï¼šMQçš„æœ€ä½ä½å¦‚æœä¸º1 ACCåŠ ä¸ŠXï¼Œä¸º0åˆ™åŠ 0(ç”±ALUå®Œæˆ)ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡çš„æ—¶å€™ï¼ŒACCå’ŒMQå¹¶èµ·æ¥é€»è¾‘å³ç§»ï¼ŒåŒæ ·æ˜¯MQçš„æœ€ä½ä½ï¼Œä¸€å…±è¿›è¡Œnæ¬¡ï¼Œæœ€åä¿®æ”¹ç¬¦å·ä½ è¡¥ç çš„ä¹˜æ³•è¿ç®— MQä¸­æ‰©å±•ä¸€ä½ï¼Œç§°ä¸ºè¾…åŠ©ä½ï¼Œåˆå§‹åŒ–ä¸º0ï¼Œå‚ä¸å³ç§»ï¼ŒMQå¢åŠ ä¸€ä½ï¼ŒACCï¼ŒXéƒ½ä¼šå¢åŠ ä¸€ä½ï¼Œå¯ä»¥é‡‡ç”¨åŒç¬¦å·ä½è¡¥ç è¿ç®— ä¼šæœ‰ä¸€ä¸ªè¾…åŠ©ç”µè·¯å¤„ç†|-x|è¡¥ç ï¼Œå†äº¤ç»™ALU åŸç çš„é™¤æ³•è§„å¾‹ï¼šå¿½ç•¥å°æ•°ç‚¹ï¼Œæ¯ç¡®å®šä¸€ä¸ªå•†è¿›è¡Œä¸€æ¬¡å‡æ³•ï¼Œå¾—åˆ°å››ä½ä½™æ•°ï¼Œä½™æ•°æœ«å°¾è¡¥0ï¼Œå†ç¡®å®šä¸‹ä¸€ä½å•†ï¼Œç›´åˆ°5ä½å•†(æœºå™¨å­—é•¿5) &#x3D;&#x3D;æ¢å¤ä½™æ•°æ³•&#x3D;&#x3D;ï¼š ç¬¦å·ä½å•ç‹¬å¤„ç†ï¼Œå¼‚æˆ– æ•°å€¼ä½å–ç»å¯¹å€¼è¿›è¡Œé™¤æ³•è¿ç®— åˆ†åˆ«å†™å‡º |X|åŸ |-X|åŸ |Y|è¡¥ |-Y|è¡¥ å•†MQåˆå§‹åŒ–ä¸º0 ACCå­˜|X| Xå­˜|Y| ä»MQä½ä½å¼€å§‹ç¡®å®šä¸€ä½å•†ï¼Œé»˜è®¤ä¸º1ï¼Œé”™äº†å†æ”¹ä¸º0 ACC+|-Y|è¡¥ -&gt; ACC æœ€é«˜ä½ä¸º1ï¼Œåˆ™ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥å•†æ”¹ä¸º0ï¼Œç„¶åACC+|Y|è¡¥ -&gt; ACC ACCå’ŒMQé€»è¾‘å·¦ç§» å¾ªç¯næ¬¡ ä¿®æ”¹ç¬¦å·ä½ ä½™æ•°&#x3D;å¾—åˆ°çš„å•†MQ*2^-n &#x3D;&#x3D;åŠ å‡äº¤æ›¿æ³•&#x3D;&#x3D;ï¼šå…ˆä¸ç¡®å®šå•†ä½ï¼ŒACC+|-Y|è¡¥ -&gt; ACCå†ç»™å‡ºå•†çš„ ç„¶åACCå·¦ç§»åŠ ä¸Š|Y|è¡¥ä¸ºä¸‹ä¸€ä¸ªACCï¼Œå†ç¡®å®šä¸€ä¸ªå•† è¡¥ç çš„é™¤æ³•ç¬¦å·ä½å‚ä¸è¿ç®—ï¼Œé‡‡ç”¨åŒç¬¦å·ä½ï¼Œè¢«é™¤æ•°ä¸é™¤æ•°å¼‚å·åˆ™+|Y|è¡¥ï¼ŒåŒå·åˆ™+|-Y|è¡¥ï¼Œæ ¹æ®ä½™æ•°å’Œé™¤æ•°åŒå·åˆ™å•†1ï¼Œå·¦ç§»ï¼Œå¾ªç¯ï¼Œæœ«ä½å•†æ¨ªç½®ä¸º1ï¼Œ*2^-n å¼ºåˆ¶ç±»å‹è½¬æ¢ cè¯­è¨€ä¸­çš„å®šç‚¹æ•´æ•° short int lang éƒ½æ˜¯è¡¥ç çš„å½¢å¼å­˜å‚¨ unsigned æ— ç¬¦å· short x&#x3D;-4321 2å­—èŠ‚ 16bit 1110 1111 0001 1111 å¼ºåˆ¶è½¬æ¢ï¼š unsigned short y &#x3D; (unsigned short)x y &#x3D; 61215 éƒ½æ˜¯2å­—èŠ‚åˆ™bitä½åŸå°ä¸åŒ int å¼ºåˆ¶è½¬åŒ–ä¸º short æ—¶ï¼Œæˆªæ–­é«˜å­—èŠ‚ å°å­—èŠ‚è½¬åŒ–ä¸ºå¤§å­—èŠ‚-ç¬¦å·æ‰©å±• çœŸå€¼ä¸å˜ è´Ÿæ•°åœ¨ç¬¦å·ä½å’Œæ•°å€¼ä½é—´æ·»1ï¼Œæ­£æ•°åœ¨ç¬¦å·ä½å’Œæ•°å€¼ä½ä¹‹é—´æ·»0 æ•°æ®çš„å­˜å‚¨å’Œæ’åˆ—å¤§å°ç«¯æ¨¡å¼4å­—èŠ‚int 01 23 45 67 H (16è¿›åˆ¶) 1908878743 D (10è¿›åˆ¶) 01 MSB æœ€é«˜æœ‰æ•ˆå­—èŠ‚ 67 LSB æœ€ä½æœ‰æ•ˆå­—èŠ‚ å¤§ç«¯:å†…å­˜ä½åœ°å€-&gt;é«˜åœ°å€ MSB-&gt;LSB ç¬¦åˆé˜…è¯»ä¹ æƒ¯ å°ç«¯:ä¾¿äºæœºå™¨å¤„ç† è¾¹ç•Œå¯¹é½æŒ‰å­—èŠ‚ç¼–å€:æ¯ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªåœ°å€ å‡è®¾ä¸€ä¸ªå­—32ä½,åˆ™åŠå­—16ä½,ä¸€ä¸ªå­—èŠ‚8bit å¯»å€æ–¹å¼:å¯ä»¥æŒ‰ç…§å­—,åŠå­—,å­—èŠ‚å¯»å€,ä½†æ˜¯éƒ½è¦éœ€è¦è½¬åŒ–ä¸ºå­—èŠ‚åœ°å€ å­—å’ŒåŠå­—å¯»å€éœ€è¦é€»è¾‘å·¦ç§»è½¬åŒ–ä¸ºå­—èŠ‚åœ°å€ å­—åœ°å€-&gt;å­—èŠ‚åœ°å€ é€»è¾‘å·¦ç§»2ä½ *4 æ¯”å¦‚2å·å­—,ä¹Ÿå°±æ˜¯ç¬¬3è¡Œ,10,å·¦ç§»2ä½,1000,8,8å·å­—èŠ‚,2å·å­—åˆ™æ˜¯ä»8å·å­—èŠ‚å¼€å§‹è¿ç»­è¯»4å­—èŠ‚å†…å®¹ åŠå­—-&gt;å­—èŠ‚åœ°å€,é€»è¾‘å·¦ç§»1ä½ è¾¹ç•Œå¯¹é½:æ¯”å¦‚ä¸€ä¸ªç»“æ„ä½“,å­˜å‚¨3ä¸ªchar,3ä¸ªshort,1ä¸ªint,å‘ç°æœ‰ä¸¤ä¸ªéœ€è¦å¡«å……çš„ç©ºç™½ è¾¹ç•Œå¯¹é½è®¿é—®æ›´å¿« ##æµ®ç‚¹æ•° å®šç‚¹æ•°è¡¨ç¤ºçš„æ•°æ®èŒƒå›´æœ‰é™ æµ®ç‚¹æ•°:ä½æ•°ä¸å˜çš„æƒ…å†µä¸‹å¢åŠ èŒƒå›´ ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º +3.026*10^11 &#x3D; +11 +3.062 N&#x3D;r^EÃ—M Eæ˜¯é˜¶ç ,Mæ˜¯å°¾æ•° åº•ré€šå¸¸ä¸º2.æ–¹ä¾¿å·¦ç§»å³ç§»å¾—åˆ°çœŸå€¼ Eè¡¨ç¤ºèŒƒå›´,Mè¡¨ç¤ºç²¾åº¦ æµ®ç‚¹æ•°å°¾æ•°å­—çš„è§„æ ¼åŒ–,å°¾æ•°çš„æœ€é«˜ä½å¿…é¡»æ˜¯æœ‰æ•ˆå€¼,å°½å¯èƒ½ä¿ç•™ç²¾åº¦ å·¦è§„:è§„æ ¼åŒ–,å°¾æ•°å·¦ç§»,é˜¶ç -1 å³è§„:å°¾æ•°æº¢å‡º(åŒç¬¦å·ä½ä¸º01æˆ–10),å°¾æ•°å³ç§»,é˜¶ç +1 IEEE 754é˜¶ç ç”¨ç§»ç çš„æ–¹å¼è¡¨ç¤º ç§»ç :è¡¥ç çš„åŸºç¡€ä¸Šç¬¦å·ä½å–å,åªèƒ½è¡¨ç¤ºæ•´æ•° ç§»ç &#x3D;çœŸå€¼+åç½®å€¼ å½“n&#x3D;8,åç½®å€¼&#x3D;128D&#x3D;1000 0000 å³ 2^n-1 eg:çœŸå€¼-127&#x3D;-111 1111B ç§»ç &#x3D;-111 1111+1000 0000 &#x3D; 0000 0001 IEEE 754 ä¸­åç½®ç½®æ˜¯127D &#x3D; 2^n-1 - 1 M23ä½æ˜¯å› ä¸ºé»˜è®¤å°¾æ•°ä¸º1.xxx float 4å­—èŠ‚ 1+8+23 çœŸå€¼:(-1)^s Ã— 1.M Ã— 2^(E-127) double 8å­—èŠ‚ 1+11+52 æµ®ç‚¹æ•°çš„è¿ç®— èˆå…¥:è§„æ ¼åŒ–å°¾æ•°å³ç§»æ—¶å¦‚æœèˆå¼ƒäº†å³ä¾§çš„1è¦+1,å¦‚æœ+1ååˆæº¢å‡º,åˆéœ€è¦å³è§„ æˆ– å¦‚æœèˆå¼ƒäº†1éœ€è¦æŠŠæœ€åä¸€ä½æ”¹ä¸º1 åˆ¤æº¢å‡º:é˜¶ç +1çœ‹ç¬¦å·ä½æ˜¯å¦æ”¹å˜ 32ä½æœºå™¨longå 32ä½,64ä½æœºå™¨longå 64ä½ 64ä½æœºå™¨,langå‘doubleè½¬åŒ–ä¼šæœ‰ç²¾åº¦æŸå¤± int -&gt; float ä¼šæŸå¤±ç²¾åº¦,ä½†æ˜¯èŒƒå›´ä¸æŸå¤± float -&gt; int å¯èƒ½æŸå¤±ç²¾åº¦,å¯èƒ½æº¢å‡º å­˜å‚¨ç³»ç»ŸåŸºæœ¬æ¦‚å¿µå±‚æ¬¡ç»“æ„ 16+512 16æ˜¯ä¸»å­˜ï¼Œ512æ˜¯è¾…å­˜ï¼Œä½¿ç”¨è¾…å­˜æ•°æ®è¦å…ˆæ‰å…¥ä¸»å­˜ï¼ŒCPUèƒ½ç›´æ¥è®¿é—®çš„æ˜¯å†…å­˜å’ŒCache åˆ†ç±»æŒ‰å­˜å‚¨ä»‹è´¨åˆ†ç±» åŠå¯¼ä½“å™¨ä»¶ï¼Œä¸»å­˜ Cache ç£è¡¨é¢å­˜å‚¨å™¨ï¼Œç£ç›˜ï¼Œç£å¸¦ å…‰å­˜å‚¨å™¨ï¼Œå…‰ç›˜ï¼ŒDVD å­˜å–æ–¹å¼ éšæœºå­˜å–å­˜å‚¨å™¨ RAMï¼Œè¯»å†™ä»»ä½•ä¸€ä¸ªå­˜å‚¨å•å…ƒéœ€è¦çš„æ—¶é—´éƒ½ç›¸åŒ å†…å­˜æ¡ é¡ºåºå­˜å–å­˜å‚¨å™¨ SAM å–å†³äºå­˜å‚¨å•å…ƒæ‰€åœ¨ç»´æŒ ç£å¸¦ ç›´æ¥å­˜å–å­˜å‚¨å™¨ DAM ç£ç›˜ å…¼å…·ç‰¹æ€§ ç›¸è”å­˜å‚¨å™¨ CAM æŒ‰ç…§å†…å®¹æ£€ç´¢åˆ°å­˜å‚¨ä½ç½®è¿›è¡Œè¯»å†™ â€œå¿«è¡¨â€ ä¿¡æ¯å¯æ›´æ”¹æ€§ è¯»å†™å­˜å‚¨å™¨ï¼Œç£ç›˜ï¼Œå†…å­˜ï¼ŒCache åªè¯»å­˜å‚¨å™¨ï¼ŒROM å®ä½“ä¸“è¾‘ï¼ŒBIOS ä¿¡æ¯å¯ä¿å­˜æ€§ æ˜“å¤±æ€§å­˜å‚¨å™¨ï¼šæ–­ç”µåå­˜å‚¨ä¿¡æ¯æ¶ˆå¤±ï¼Œä¸»å­˜ï¼ŒCache éæ˜“å¤±æ€§ï¼šç£ç›˜ï¼Œå…‰ç›˜ ç ´åæ€§è¯»å‡ºï¼šä¿¡æ¯è¯»å‡ºååŸä¿¡æ¯è¢«ç ´åï¼ŒDRAMèŠ¯ç‰‡ï¼Œè¯»å‡ºåéœ€è¦é‡å†™ éç ´åæ€§ï¼šSRAMèŠ¯ç‰‡ï¼Œç£ç›˜ï¼Œå…‰ç›˜ ###æ€§èƒ½æŒ‡æ ‡ å­˜å‚¨å®¹é‡ï¼šå­˜å‚¨å­—é•¿ Ã— å­—é•¿ (1M Ã— 8ä½) å•ä½æˆæœ¬ï¼šæ¯ä½ä»·æ ¼&#x3D;æ€»æˆæœ¬&#x2F;æ€»å®¹é‡ å­˜å‚¨é€Ÿåº¦ï¼šæ•°æ®ä¼ è¾“é€Ÿç‡&#x3D;æ•°æ®çš„å®½åº¦&#x2F;å­˜å‚¨å‘¨æœŸ å­˜å‚¨å‘¨æœŸ&#x3D;å­˜å–æ—¶é—´+æ¢å¤æ—¶é—´ ä¸»å­˜å‚¨å™¨çš„åŸºæœ¬ç»„æˆ###åŠå¯¼ä½“å…ƒä»¶çš„åŸç† ###å­˜å‚¨èŠ¯ç‰‡çš„åŸç† å­˜å‚¨ä½“ç”±å¾ˆå¤šå­˜å‚¨å•å…ƒç»„æˆï¼Œå­˜å‚¨å•å…ƒç”±å­˜å‚¨åŸç»„æˆï¼Œä¸€ä¸ªå­˜å‚¨å­—æ˜¯ä¸€æ¡çº¿è¿æ¥çš„MOSç®¡çš„å­—èŠ‚æ•° MAR è¯‘ç å™¨ï¼šnä½çš„åœ°å€ -&gt; 2^nä¸ªå­˜å‚¨å•å…ƒ,ç»™å‡ºå“ªä¸ªåœ°å€å°±è½¬åŒ–å¯¹åº”çš„å­˜å‚¨å•å…ƒä¸ºé«˜ç”µé¢‘ä¿¡å· åˆ¤æ–­å­˜å‚¨å•å…ƒçš„é‡‘å±å¼•è„šçš„æ•°ç›® åé€‰çº¿æ˜¯é€‰æ‹©å¯¹å“ªä¸€å—å­˜å‚¨å•å…ƒè¿ç®—,ä¸€ä¸ªå†…å­˜æ¡ä¸Šå¤šä¸ªå­˜å‚¨å•å…ƒ ###å¦‚ä½•å®ç°ä¸åŒçš„å¯»å€æ–¹å¼ ä¸€ä¸ªå°æ ¼æ˜¯ä¸€ä¸ªå­—èŠ‚8bitï¼Œä¸€æ•´è¡Œæ˜¯ä¸€ä¸ªå­˜å‚¨å­—ï¼Œä¸€è¡Œå››å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å­—é•¿ä¸º4Bï¼Œ å¦‚æœæ€»å®¹é‡ä¸º1KBï¼Œä¹Ÿå°±æ˜¯256ä¸ªå­—ï¼Œä¹Ÿå°±æ˜¯256è¡Œ ç°ä»£è®¡ç®—æœºæŒ‰å­—èŠ‚ç¼–å€ï¼Œä¸€ä¸ªå­—èŠ‚å°±æ˜¯ä¸€ä¸ªåœ°å€ï¼Œ1KBï¼Œä¹Ÿå°±æ˜¯æœ‰1Kä¸ªåœ°å€ æŒ‰å­—èŠ‚ç¼–å€ï¼Œä½†æ˜¯ä¹Ÿå¯æŒ‰å­—èŠ‚å¯»å€ï¼ŒæŒ‰å­—å¯»å€ï¼ŒæŒ‰åŠå­—å¯»å€ï¼ŒæŒ‰åŒå­—å¯»å€ 1KB åœ°å€çº¿10æ ¹ï¼Œ2^10&#x3D;1 K æ‰€ä»¥10æ ¹åœ°å€çº¿æ‰èƒ½è¡¨ç¤º1Kçš„åœ°å€ æŒ‰å­—å¯»å€ï¼šä»¥è¡Œä¸ºå•ä½ï¼Œä¸€å…±256ä¸ªå•ä½(è¡Œ)ï¼Œè½¬åŒ–ä¸ºå­—èŠ‚åœ°å€ï¼Œéœ€è¦ç®—æœ¯å·¦ç§»ä¸¤ä½ï¼Œæœ«å°¾+2ä¸ª0ï¼Œå› ä¸ºä¸€è¡Œå››ä¸ªå­—èŠ‚ï¼Œ2^2 &#x3D; 4, SRAMå’ŒDRAMå­˜å‚¨å…ƒä»¶ä¸åŒå¯¼è‡´çš„ç‰¹æ€§å·®å¼‚DRAMç”¨çš„æ …æç”µå®¹ï¼Œå¦‚ä¸Šï¼Œè¯»å–çš„æ—¶å€™æ˜¯ç ´åæ€§è¯»å‡ºï¼Œè¯»å‡ºååº”è¯¥æœ‰é‡å†™æ“ä½œã€‚é€Ÿåº¦æ›´æ…¢ï¼Œå¸¸åšä¸»å­˜ï¼Œé›†æˆåº¦é«˜ã€‚å‘çƒ­ç›¸å¯¹è¦å° SRAMç”¨çš„åŒç¨³æ€è§¦å‘å™¨ï¼Œéç ´åæ€§è¯»å‡ºï¼Œä¸éœ€è¦é‡å†™ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œç”¨äºCacheï¼Œé›†æˆåº¦ä½ï¼Œå‘çƒ­å¤§ DRAMçš„åˆ·æ–° ###DRAMçš„åœ°å€çº¿å¤ç”¨æŠ€æœ¯ nä½çš„åœ°å€ç”¨n&#x2F;2æ¡åœ°å€çº¿ä»£æ›¿næ¡ï¼Œåˆ†ä¸¤æ¬¡ä¼ è¡Œåœ°å€å’Œåˆ—åœ°å€ï¼Œåœ°å€çº¿å‡åŠï¼ŒèŠ¯ç‰‡å¼•è„šå‡å°‘ SRAMåŒæ—¶é€è¡Œåˆ—åœ°å€ï¼Œä¸ç”¨åœ°å€å¤ç”¨æŠ€æœ¯ï¼Œå› ä¸ºé›†æˆåº¦ä½ç‚¹ DRAMé‡‡ç”¨åœ°å€çº¿å¤ç”¨æŠ€æœ¯ åˆ·æ–°ç”±å­˜å‚¨å™¨æ§åˆ¶ä¸ç”±CPUæ§åˆ¶ åªè¯»å­˜å‚¨å™¨ROMRAM-æ˜“å¤±æ€§ï¼Œæ–­ç”µåæ•°æ®æ¶ˆå¤± ROM-éæ˜“å¤± BIOSèŠ¯ç‰‡ROMç”¨äºå¼•å¯¼å¼€æœºï¼Œå°†è¾…å­˜ROMä¸­çš„æŒ‡ä»¤è°ƒå…¥ä¸»å­˜RAMï¼Œç„¶åCPUå°±å¯ä»¥æ‰§è¡ŒæŒ‡ä»¤äº† å†…å­˜ä¼˜åŒ–æŠ€æœ¯å­˜å–å‘¨æœŸï¼šå¯è¿ç»­è¯»å†™çš„æœ€çŸ­æ—¶é—´&#x3D;å­˜å–æ—¶é—´+æ¢å¤æ—¶é—´ DRAMèŠ¯ç‰‡çš„æ¢å¤æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæœ‰å¯èƒ½æ˜¯å­˜å–æ—¶é—´çš„å¥½å‡ å€ åŒç«¯å£RAMå¿½ç•¥ï¼Œä¸è€ƒ å¤šæ¨¡å—å­˜å‚¨å™¨####å¤šä½“å¹¶è¡Œå­˜å‚¨å™¨ é«˜ä½äº¤å‰ç¼–å€çš„å¤šä½“å­˜å‚¨å™¨ ä½“å·+ä½“å†…åœ°å€ ä½ä½äº¤å‰ç¼–å€çš„å¤šä½“å­˜å‚¨å™¨ ä½“å†…åœ°å€+ä½“å· å…ˆæ ¹æ®ä½“å·é€‰æ‹©ä¸åŒçš„å­˜å‚¨ä½“ï¼Œç„¶åæ ¹æ®ä½“å†…åœ°å€å†åœ¨å­˜å‚¨ä½“å†…å¯»å€ï¼Œä½ä½æ•ˆç‡é«˜äºé«˜ä½ æ‰€ä»¥è¿ç»­è®¿é—®æ›´å¿«ï¼å­˜å–å‘¨æœŸTï¼Œå­˜å–æ—¶é—´rï¼Œä¸ºäº†ä½¿æµæ°´çº¿ä¸é—´æ–­ï¼Œåº”ä¿è¯æ¨¡å—æ•°m&gt;&#x3D;T&#x2F;r ,æœ€å¥½&#x3D;ï¼Œå°äºä¼šæ›´å¾…ï¼Œå¤§äºä¼šè¿‡å‰©ç©ºé—²æ—¶é—´ ####å•ä½“å¤šå­—å­˜å‚¨å™¨ ä¸»å­˜å‚¨å™¨å’Œcpuçš„è¿æ¥å­—æ‰©å±•ï¼šæ‰©å±•ä¸»å­˜å­—æ•° ä½æ‰©å±•ï¼šå½“æ•°æ®æ€»çº¿(æ¯”å¦‚64ä½è®¡ç®—æœº)&gt;å­˜å‚¨èŠ¯ç‰‡å­—é•¿(ä¸€ä¸ªèŠ¯ç‰‡åªæœ‰8*8ä½) &#x3D;&#x3D;ä½æ‰©å±•&#x3D;&#x3D; è¿™é‡Œçš„8K Ã— 1ä½ è¡¨ç¤º8kä¸ªåœ°å€ å³2^13æ¬¡æ–¹ï¼Œæ‰€ä»¥éœ€è¦13æ ¹åœ°å€çº¿ï¼Œç„¶åæ¯ä¸ªåœ°å€åªæœ‰1ä½ï¼Œæ•°æ®çº¿ä¸€æ ¹ï¼Œè¿™é‡Œè¿äº†ä¸¤ä¸ªèŠ¯ç‰‡ å½“è¿ç»­æ¥äº†8ä¸ªèŠ¯ç‰‡ä¹‹åï¼Œå³8ç‰‡8k*1ä½çš„å­˜å‚¨èŠ¯ç‰‡ï¼Œå¾—åˆ°ä¸€ä¸ª8K*8ä½çš„å­˜å‚¨å™¨ï¼Œå®¹é‡8KB çº¿é€‰æ³•ï¼šæ ¹æ®ä¸åŒçš„æ•°æ®çº¿ï¼Œnæ¡æ•°æ®çº¿è¿nä¸ªèŠ¯ç‰‡ &#x3D;&#x3D;å­—æ‰©å±•&#x3D;&#x3D; è¿æ¥å¤šä¸ª8K*8ä½çš„å­˜å‚¨èŠ¯ç‰‡ï¼Œç„¶åç„¶åæ ¹æ®A13-A15æ¥æ§åˆ¶é€‰æ‹©ä¸åŒçš„èŠ¯ç‰‡ è¯‘ç å™¨ç‰‡é€‰æ³•ï¼šnæ¡çº¿ï¼Œ2^nä¸ªç‰‡é€‰ä¿¡å·ï¼Œn&#x3D;3æ—¶ï¼Œå¯ä»¥è¿8ä¸ªå­˜å‚¨èŠ¯ç‰‡(38è¯‘ç å™¨)ï¼Œè¿™æ ·å°±å¾—åˆ°äº†8K*64ä½çš„å­˜å‚¨å™¨ ä¸‹é¢å³ä¸Šæ–¹æ˜¯74LS138è¯‘ç å™¨ï¼Œä¸‰ä¸ªä½¿èƒ½ç«¯ï¼Œä¸‰ä¸ªè¾“å…¥ç«¯ï¼Œ8ä¸ªåˆå§‹ç«¯ï¼Œå¤´ä¸Šå¸¦æ¨ªçº¿æ˜¯ä½ç”µå¹³æœ‰æ•ˆ å¤–éƒ¨å­˜å‚¨å™¨###ç£ç›˜å­˜å‚¨å™¨ RAID å¤šä¸ªç‹¬ç«‹çš„ç‰©ç†ç£ç›˜ç»„æˆä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘ç›˜ å›ºæ€ç¡¬ç›˜SSD CacheCacheè¢«é›†æˆåˆ°CPUå†…éƒ¨ï¼Œç”¨SRAMå®ç° è®¾tcä¸ºè®¿é—®ä¸€æ¬¡Cacheéœ€è¦çš„æ—¶é—´ï¼Œtmä¸ºè®¿é—®ä¸€æ¬¡ä¸»å­˜éœ€è¦çš„æ—¶é—´ å‘½ä¸­ç‡Hï¼šCPUæ¬²è®¿é—®çš„ä¿¡æ¯å·²ç»åœ¨cacheä¸­çš„æ¯”ç‡ ç¼ºå¤±ç‡ï¼šM&#x3D;1-H ç³»ç»Ÿçš„å¹³å‡è®¿é—®æ—¶é—´t&#x3D;Htc+(1-H)(tc+tm) æˆ–t&#x3D;Htc+(1-H)tm åŒæ—¶è®¿é—®cacheå’Œå†…å­˜ï¼Œè‹¥cacheå‘½ä¸­åˆ™åœæ­¢è®¿é—®ä¸»å­˜ å°†cpuç›®å‰è®¿é—®åœ°å€çš„å‘¨å›´çš„æ•°æ®æ”¾åˆ°cacheä¸­ï¼Œå¦‚ä½•å®šä¹‰å‘¨å›´ï¼Ÿ å°†ä¸»å­˜çš„å­˜å‚¨ç©ºé—´åˆ†å—&#x2F;é¡µï¼Œä¸»å­˜ä¸Cacheä¹‹é—´ä»¥å—ä¸ºå•ä½è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œæ¯”å¦‚1kbä¸€å—ï¼Œä¸»å­˜4Mï¼Œåˆ†ä¸º4096å—ï¼Œæ¯ä¸€å—è¿›è¡Œç¼–å· Cacheä¸­çš„å—ä¹Ÿç§°ä¸ºè¡Œ Cacheä¸ä¸»å­˜çš„æ˜ å°„ aï¼šæœ€æ…¢ï¼Œå‘½ä¸­ç‡é«˜ï¼Œç©ºé—´åˆ©ç”¨å……åˆ† bï¼šæœ€å¿«ï¼Œå‘½ä¸­ç‡ä½ï¼Œç©ºé—´åˆ©ç”¨ä¸å……åˆ† cï¼šæŠ˜ä¸­ æ›¿æ¢ç®—æ³•Cacheæ»¡äº†ä¹‹åæ€ä¹ˆåŠ aï¼šæ»¡äº†æ‰éœ€è¦æ¢ bï¼šç›´æ¥æ›¿æ¢ cï¼šåˆ†ç»„æ»¡äº†æ‰æ›¿æ¢ RANDéšæœºç®—æ³• FIFOå…ˆè¿›å…ˆå‡ºç®—æ³• æŠ–åŠ¨ç°è±¡ï¼šé¢‘ç¹æ›¿æ¢ï¼Œåˆšè¢«æ›¿æ¢çš„å—å¾ˆå¿«åˆè¢«è°ƒå…¥ LRUè¿‘æœŸæœ€å°‘ä½¿ç”¨ LFUæœ€ä¸ç»å¸¸ä½¿ç”¨ç®—æ³• Cacheå†™ç­–ç•¥å†™å‘½ä¸­ å†™å›æ³•ï¼šåªä¿®æ”¹Cacheä¸­çš„å†…å®¹ï¼Œå½“å—è¢«æ¢å‡ºæ—¶æ‰å†™å›ä¸»å­˜ å…¨å†™æ³•ï¼šåŒæ—¶å†™å…¥Cacheå’Œä¸»å­˜ï¼Œä¸€èˆ¬ä½¿ç”¨å†™ç¼“å†²(SRAMå®ç°çš„FIFOé˜Ÿåˆ—)ï¼Œå¯èƒ½å†™ç¼“å†²é¥±å’Œå‘ç”Ÿé˜»å¡ å†™ä¸å‘½ä¸­ å†™åˆ†é…æ³•ï¼šæŠŠä¸»å­˜ä¸­çš„å—æ‰å…¥Cacheï¼Œå†å†™ï¼Œé€šå¸¸æ­é…å†™å›æ³•ä½¿ç”¨ éå†™åˆ†é…æ³•ï¼šåªå†™å…¥ä¸»å­˜ï¼Œä¸æ‰å…¥Cacheï¼Œæ­é…å…¨å†™æ³• é¡µå¼å­˜å‚¨å™¨è¿›ç¨‹åˆ†ä¸ºé¡µï¼Œé¡µå¤§å°ä¸ä¸»å­˜ç‰©ç†å—å¤§å°ç›¸åŒï¼Œæ¯ä¸ªé¡µé¢ç¦»æ•£çš„æ”¾å…¥ä¸åŒçš„ä¸»å­˜å— é€»è¾‘åœ°å€ï¼šè™šåœ°å€ ç¨‹åºå‘˜çœ‹åˆ°çš„åœ°å€ ç‰©ç†åœ°å€ï¼šå®åœ°å€ ä¸»å­˜ä¸­çœ‹åˆ°çš„åœ°å€ é€»è¾‘åœ°å€ï¼šé€»è¾‘é¡µå·+é¡µå†…åœ°å€ -&gt; ç‰©ç†åœ°å€ï¼šä¸»å­˜å—å·+å—å†…åœ°å€ é¡µè¡¨ï¼šé€»è¾‘é¡µå· -&gt; ä¸»å­˜å—å· å¿«è¡¨ï¼šSRAM æ…¢è¡¨ï¼šDRAM è™šæ‹Ÿå­˜å‚¨å™¨è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿï¼Œæ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªç¨‹åºä¸ä¼šè°ƒå…¥å…¨éƒ¨çš„æ•°æ®è€Œæ˜¯è°ƒå…¥éƒ¨åˆ† é¡µå¼è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿï¼š äº†è§£ï¼š æŒ‡ä»¤ç³»ç»Ÿ##æŒ‡ä»¤æ ¼å¼ æŒ‡ä»¤ï¼šæ“ä½œç OP+åœ°å€ç A (åšä»€ä¹ˆ+å¯¹è°åš) æ ¹æ®æŒ‡ä»¤çš„åœ°å€ç æ•°é‡åˆ† é›¶åœ°å€æŒ‡ä»¤ ä¸éœ€è¦æ“ä½œæ•°æˆ–è€…å †æ ˆè®¡ç®—æœº(æ“ä½œæ•°éšå«åœ¨æ ˆé¡¶å’Œæ¬¡æ ˆé¡¶-åç¼€è¡¨è¾¾å¼) ä¸€åœ°å€æŒ‡ä»¤ åªéœ€è¦å•æ“ä½œæ•° +1 -1 å–å å–è¡¥ ç­‰ æˆ– å…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°è¢«éšå«åœ¨å¯„å­˜å™¨ä¸­ äºŒåœ°å€æŒ‡ä»¤ a+b ä¸‰åœ°å€æŒ‡ä»¤ ç»“æœå­˜åˆ°ç¬¬ä¸‰ä¸ªåœ°å€ å››åœ°å€æŒ‡ä»¤ å°†ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€æŒ‡å‘ç¬¬å››ä¸ªåœ°å€ æŒ‡ä»¤å­—é•¿ï¼šå¯èƒ½ä¼šå˜ æœºå™¨å­—é•¿ï¼šä¸å˜ï¼Œå’Œcpuæœ‰å…³ï¼Œä¸€æ¬¡æ•´æ•°è¿ç®—èƒ½å¤„ç†çš„äºŒè¿›åˆ¶ä½æ•° å­˜å‚¨å­—é•¿ï¼šä¸€ä¸ªå­˜å‚¨å•å…ƒä¸­äºŒè¿›åˆ¶ä»£ç çš„ä½æ•° å’Œä¸»å­˜æœ‰å…³ æ‰©å±•æ“ä½œç æŒ‡ä»¤æ ¼å¼ å®šé•¿æŒ‡ä»¤å­—ç»“æ„+å¯å˜æ“ä½œç  æŒ‡ä»¤å¯»å€æŒ‡ä»¤å¯»å€ï¼šå¦‚ä½•ç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„å­˜æ”¾åœ°å€ ç¨‹åºè®¡æ•°å™¨PCæŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤çš„å­˜æ”¾åœ°å€ é¡ºåºå¯»å€ å®šé•¿æŒ‡ä»¤å­—ç»“æ„+æŒ‡ä»¤å­—é•¿&#x3D;å­˜å‚¨å­—é•¿&#x3D;2B+ä¸»å­˜æŒ‰å­—ç¼–åˆ¶ æ¯æ¬¡PC+1 å®šé•¿æŒ‡ä»¤å­—ç»“æ„+æŒ‡ä»¤å­—é•¿&#x3D;å­˜å‚¨å­—é•¿&#x3D;2B+ä¸»å­˜æŒ‰å­—èŠ‚ç¼–åˆ¶ ï¼ˆæ¯ä¸ªæŒ‡ä»¤å ä¸¤ä¸ªå­—èŠ‚ï¼‰ æ¯æ¬¡PC+2 å˜é•¿æŒ‡ä»¤å­—ç»“æ„ + ä¸»å­˜å­—èŠ‚ç¼–å€ è¯»å…¥ç¬¬ä¸€ä¸ªå­—ï¼Œæ ¹æ®æ“ä½œç ç¡®å®šè¯¥æŒ‡ä»¤å nå­—èŠ‚ï¼Œç„¶åPC+n è·³è·ƒå¯»å€ ç”±è½¬ç§»æŒ‡ä»¤æŒ‡å‡º å®šé•¿æŒ‡ä»¤å­—ç»“æ„+æŒ‡ä»¤å­—é•¿&#x3D;å­˜å‚¨å­—é•¿&#x3D;2B+ä¸»å­˜æŒ‰å­—ç¼–åˆ¶ æ¯æ¬¡æ‰§è¡ŒæŒ‡ä»¤PC+1ï¼Œå¦‚æœæŒ‡ä»¤æ˜¯è½¬ç§»æŒ‡ä»¤JMPï¼ŒPCè·³åˆ°è½¬ç§»æŒ‡ä»¤æŒ‡å®šçš„ä½ç½® æ•°æ®å¯»å€ç¡®å®šæœ¬æ¡æŒ‡ä»¤çš„åœ°å€ç æŒ‡æ˜çš„çœŸå®åœ°å€ åŸºäºæŒ‡ä»¤å­—é•¿&#x3D;æœºå™¨å­—é•¿&#x3D;å­˜å‚¨å­—é•¿ çš„ ä¸€åœ°å€æŒ‡ä»¤ ç›´æ¥å¯»å€ EA&#x3D;A è®¿å­˜ä¸¤æ¬¡ å–æŒ‡ä»¤+æ‰§è¡ŒæŒ‡ä»¤ é—´æ¥å¯»å€ EA&#x3D;(A) Aæ˜¯æœ‰æ•ˆåœ°å€æ‰€åœ¨å­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œè¦åœ¨ä¸»å­˜ä¸­å¯»æ‰¾ è®¿å­˜ä¸‰æ¬¡å–æŒ‡ä»¤+æ‰§è¡ŒæŒ‡ä»¤2 å¯„å­˜å™¨å¯»å€ EA&#x3D;Ri æ“ä½œæ•°åœ¨Riæ‰€æŒ‡çš„å¯„å­˜å™¨å†… è®¿å­˜ä¸€æ¬¡ï¼šå–åœ°å€ é€Ÿåº¦å¿« å¯„å­˜å™¨é—´æ¥å¯»å€ EA&#x3D;(Ri) 2 éšå«å¯»å€ å¦ä¸€ä¸ªæ“ä½œæ•°åœ¨ACCä¸­ ç«‹å³å¯»å€ Aå°±æ˜¯æ“ä½œæ•°æœ¬èº« #+ç«‹å³æ•° 1 åç§»å¯»å€ å †æ ˆå¯»å€ CPUåŠŸèƒ½å’Œç»“æ„cpuçš„åŠŸèƒ½ï¼š æŒ‡ä»¤æ§åˆ¶ æ“ä½œæ§åˆ¶ æ—¶é—´æ§åˆ¶ æ•°æ®åŠ å·¥ ä¸­æ–­å¤„ç† &#x3D;&#x3D;CPU&#x3D;&#x3D;ï¼š è¿ç®—å™¨ å¯¹æ•°æ®åŠ å·¥ æ§åˆ¶å™¨ åè°ƒå¹¶æ§åˆ¶è®¡ç®—æœºå„éƒ¨ä»¶æ‰§è¡Œç¨‹åºçš„æŒ‡ä»¤åºåˆ—ï¼ŒåŒ…æ‹¬ï¼šå–æŒ‡ä»¤ï¼Œåˆ†ææŒ‡ä»¤ï¼Œæ‰§è¡ŒæŒ‡ä»¤ &#x3D;&#x3D;è¿ç®—å™¨çš„ç»“æ„&#x3D;&#x3D; è¿ç®—å™¨çš„æ ¸å¿ƒï¼šALU ç®—æœ¯é€»è¾‘å•å…ƒ é€šç”¨å¯„å­˜å™¨R0 R1 R2 SP(å †æ ˆå¯„å­˜å™¨) å…¶ä¸­ä¿å­˜çš„æ•°æ®å¯èƒ½ä½œä¸ºALUçš„è¾“å…¥Aæˆ–Bï¼Œç”¨MUXå¤šè·¯é€‰æ‹©å™¨ä¸ALUçš„è¾“å…¥ç«¯è¿æ¥ï¼Œæˆ–è€…ä½¿ç”¨å†…éƒ¨å•æ€»çº¿çš„æ–¹å¼ï¼Œæ‰€æœ‰å¯„å­˜å™¨çš„è¾“å…¥è¾“å‡ºéƒ½è¿åˆ°ä¸€æ¡å…¬å…±çš„é€šè·¯ä¸Š æš‚å­˜å¯„å­˜å™¨ï¼šæš‚å­˜ä»ä¸»å­˜è¯»è¿‡æ¥çš„æ•°æ® ç¨‹åºçŠ¶æ€å­—å¯„å­˜å™¨ ç§»ä½å™¨ è®¡æ•°å™¨ &#x3D;&#x3D;æ§åˆ¶å™¨çš„ç»“æ„&#x3D;&#x3D; ç¨‹åºè®¡æ•°å™¨PC æŒ‡å‡ºä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€ æŒ‡ä»¤å¯„å­˜å™¨ ä¿å­˜æ­£åœ¨æ‰§è¡Œçš„é‚£æ¡æŒ‡ä»¤ æŒ‡ä»¤è¯‘ç å™¨ ä»…å¯¹æ“ä½œç è¿›è¡Œè¯‘ç ï¼Œå‘æ§åˆ¶å™¨æä¾›ç‰¹å®šä¿¡å· å¾®æ“ä½œä¿¡å·å‘ç”Ÿå™¨ æ—¶åºç³»ç»Ÿ å­˜å‚¨å™¨åœ°å€å¯„å­˜å™¨MAR å­˜æ”¾è¦è®¿é—®çš„ä¸»å­˜å•å…ƒçš„åœ°å€ å­˜å‚¨å™¨æ•°æ®å¯„å­˜å™¨MDR å­˜æ”¾ä»ä¸»å­˜è¯»å…¥çš„ä¿¡æ¯ æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ å–å€å‘¨æœŸ","categories":[{"name":"å››å¤§ä»¶","slug":"å››å¤§ä»¶","permalink":"http://example.com/categories/%E5%9B%9B%E5%A4%A7%E4%BB%B6/"}],"tags":[]},{"title":"æ“ä½œç³»ç»Ÿ","slug":"source/åŸºç¡€å››å¤§ä»¶/æ“ä½œç³»ç»Ÿ","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-12T03:07:30.034Z","comments":true,"path":"2025/03/02/source/åŸºç¡€å››å¤§ä»¶/æ“ä½œç³»ç»Ÿ/","permalink":"http://example.com/2025/03/02/source/%E5%9F%BA%E7%A1%80%E5%9B%9B%E5%A4%A7%E4%BB%B6/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"æ“ä½œç³»ç»Ÿç¯å¢ƒå‡†å¤‡###å®‰è£…ç¼–è¯‘å·¥å…· 12345sudo yum groupinstall &quot;Development Tools&quot; (GCC make Debug)yum install kernel-devel (å†…æ ¸å¼€å‘ç›¸å…³çš„å¤´æ–‡ä»¶)yum install genisoimage ç”¨äºç”ŸæˆISOå…‰ç›˜æ˜ åƒæ–‡ä»¶ 123456789å®‰è£…æ±‡ç¼–è¯­è¨€ç¼–è¯‘å™¨ nasmyum install wgetwget https://www.nasm.us/pub/nasm/releasebuilds/2.15.05/nasm-2.15.05.tar.gztar -xf nasm-2.15.05.tar.gzcd nasm-2.15.05./configuremakesudo make installnasm -v ###å®‰è£…è™šæ‹Ÿæœº-Bochs ä¸‹è½½åœ°å€ï¼šhttps://sourceforge.net/projects/bochs/files/bochs/ ä¸‹è½½2.8 tar.gz åœ°å€ï¼šhttps://sourceforge.net/projects/bochs/files/bochs/2.8/bochs-2.8.tar.gz/download è¿™é‡Œæˆ‘é€‰æ‹©ç›´æ¥ä½¿ç”¨curlä¸‹è½½ curl -L -o bochs-2.8.tar.gz https://sourceforge.net/projects/bochs/files/bochs/2.8/bochs-2.8.tar.gz/download tar xvf bochs-2.8.tar.gz cd bochs-2.8 ./configure \\ --prefix=/root/bochs \\ --enable-debugger \\ --enable-disasm \\ --enable-iodebug \\ --enable-x86-debugger \\ --with-x \\ --with-x11 â€“prefixæ˜¯å®‰è£…çš„ç›®å½•çš„ä½ç½®ï¼Œè¿™é‡Œæˆ‘æ˜¯ &#x2F;root&#x2F;bochs&#x2F; make install æˆ‘é‡åˆ°äº†æ‰¾ä¸åˆ°X11çš„é”™è¯¯ sudo yum install libX11-devel make ###é…ç½®bochs ç±»ä¼¼äºé…ç½®biosï¼ŒçŸ¥é“æœ‰å“ªäº›ç¡¬ä»¶ï¼Œå¯åŠ¨é¡ºåºæ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œéœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‚è€ƒæ–‡ä»¶åœ¨å®‰è£…ç›®å½•ä¸‹çš„share&#x2F;doc&#x2F;bochs&#x2F;bochsrc-sample.txtï¼Œå¯åŠ¨é¡ºåºå¤§æ¦‚åœ¨531-543è¡Œ ä¸‹æ–¹æ–‡ä»¶æ”¾åˆ°&#x2F;root&#x2F;bochs&#x2F;bochsrc.txt 123456789megs : 512romimage: file=/root/bochs/share/bochs/BIOS-bochs-latest //æ³¨æ„è·¯å¾„vgaromimage: file=/root/bochs/share/bochs/VGABIOS-lgpl-latest //æ³¨æ„è·¯å¾„boot: disklog: bochs.outmouse:enabled=0keyboard:keymap=/root/bochs/share/bochs/keymaps/x11-pc-us.map //æ³¨æ„è·¯å¾„ata0:enabled=1,ioaddr1=0x1f0,ioaddr2=0x3f0,irq=14#gdbstub:enabled=1,port=1234,text_base=0,data_base=0,bss_base=0 cd /root/bochs sudo bin/bochs -f bochsrc.txt -q è¿è¡Œbochs -f æŒ‡å®šé…ç½®æ–‡ä»¶ -q è·³è¿‡ç•Œé¢æŒ‡å¼• æŠ¥é”™ï¼šcannot connect to X server åŸå› ï¼šæˆ‘ä½¿ç”¨çš„vscodeè¿œç¨‹è¿æ¥æ²¡æœ‰è®¿é—®Linux centoså›¾å½¢ç•Œé¢çš„æƒåŠ›,ç”¨MobaXtermæ˜¯å¯ä»¥çš„æœ‰X server æŠ¥é”™ï¼šNo bootable device æ²¡æœ‰å¯åŠ¨ç›˜ è®¾ç½®å¯åŠ¨ç›˜BIOSä¼šå°†PCçš„æ§åˆ¶æƒè½¬ç§»åˆ°å¼•å¯¼åŠ è½½ç¨‹åºï¼Œä½¿ç”¨ç°æœ‰çš„å¼•å¯¼åŠ è½½ç¨‹åºGNU GRand(GRUB)ï¼ŒGRUBå¯ä»¥å°†æ“ä½œç³»ç»Ÿæ„å»ºä¸ºæ™®é€šçš„ELFå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åç”±GRUBå°†å…¶åŠ è½½åˆ°æ­£ç¡®çš„å†…å­˜ä½ç½®ã€‚ GRUBå°†å¯»æ‰¾ä¸€ä¸ªæ•°(å…·ä½“çš„)ä»¥ç¡®ä¿å®ƒå®é™…ä¸Šæ˜¯åœ¨è·³è½¬åˆ°æ“ä½œç³»ç»Ÿã€‚ç„¶åGRUBè·³è½¬åˆ°å†…å­˜ä¸­çš„æŸä¸ªä½ç½®å°†æ§åˆ¶æƒè½¬ç§»åˆ°OSã€‚ æ“ä½œç³»ç»Ÿçš„è¿™ä¸€éƒ¨åˆ†å¿…é¡»ç”¨æ±‡ç¼–ä»£ç ç¼–å†™ï¼Œå› ä¸ºCéœ€è¦ä¸€ä¸ªä¸å¯ç”¨çš„å †æ ˆã€‚å°†ä»¥ä¸‹ä»£ç ä¿å­˜åœ¨ä¸€ä¸ªåä¸ºloader.sçš„æ–‡ä»¶ä¸­ 1234567891011121314151617global loader ; the entry symbol for ELFMAGIC_NUMBER equ 0x1BADB002 ; define the magic number constantFLAGS equ 0x0 ; multiboot flagsCHECKSUM equ -MAGIC_NUMBER ; calculate the checksum ; (magic number + checksum + flags should equal 0)section .text: ; start of the text (code) sectionalign 4 ; the code must be 4 byte aligned dd MAGIC_NUMBER ; write the magic number to the machine code, dd FLAGS ; the flags, dd CHECKSUM ; and the checksumloader: ; the loader label (defined as entry point in linker script) mov eax, 0xCAFEBABE ; place the number 0xCAFEBABE in the register eax.loop: jmp .loop ; loop forever åŠŸèƒ½ï¼šå°†0xCAFEBABEå†™å…¥eaxå¯„å­˜å™¨ åç»­å¼€å‘ä¸­ï¼Œ.loopå¾ªç¯ä¼šè¢«æ›¿æ¢ä¸ºçœŸæ­£çš„å†…æ ¸åˆå§‹åŒ–ä»£ç  mkdir /root/tutuio nasm -f elf32 loader.s å°†loader.sæ–‡ä»¶ç¼–è¯‘ä¸º32ä½ELFç›®æ ‡æ–‡ä»¶ ###é“¾æ¥å†…æ ¸ ç°åœ¨å¿…é¡»é“¾æ¥ä»£ç ä»¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚æˆ‘ä»¬å¸Œæœ›GRUBåœ¨å¤§äºæˆ–ç­‰äº0x00100000ï¼ˆ1å…†å­—èŠ‚ï¼ˆMBï¼‰ï¼‰çš„å†…å­˜åœ°å€ä¸ŠåŠ è½½å†…æ ¸ï¼Œå› ä¸ºGRUBæœ¬èº«ï¼ŒBIOSå’Œå†…å­˜æ˜ å°„çš„I &#x2F; Oä½¿ç”¨å°äº1 MBçš„åœ°å€ã€‚å› æ­¤ï¼Œéœ€è¦ä»¥ä¸‹é“¾æ¥ç¨‹åºè„šæœ¬ï¼ˆä¸ºGNU LDç¼–å†™ï¼‰ 1234567891011121314151617181920212223242526ENTRY(loader) /* the name of the entry label */SECTIONS &#123; . = 0x00100000; /* the code should be loaded at 1 MB */ .text ALIGN (0x1000) : /* align at 4 KB */ &#123; *(.text) /* all text sections from all files */ &#125; .rodata ALIGN (0x1000) : /* align at 4 KB */ &#123; *(.rodata*) /* all read-only data sections from all files */ &#125; .data ALIGN (0x1000) : /* align at 4 KB */ &#123; *(.data) /* all data sections from all files */ &#125; .bss ALIGN (0x1000) : /* align at 4 KB */ &#123; *(COMMON) /* all COMMON sections from all files */ *(.bss) /* all bss sections from all files */ &#125;&#125; å°†é“¾æ¥ç¨‹åºè„šæœ¬ä¿å­˜åˆ°åä¸ºlink.ldçš„æ–‡ä»¶ä¸­ ld -T link.ld -melf_i386 loader.o -o kernel.elf ###åˆ›å»ºå¯å¼•å¯¼çš„soé•œåƒ æˆ‘ä»¬å°†ä½¿ç”¨çš„GRUBç‰ˆæœ¬æ˜¯GRUB Legacyï¼Œå› ä¸ºå¯ä»¥åœ¨åŒæ—¶ä½¿ç”¨GRUB Legacyå’ŒGRUB 2çš„ç³»ç»Ÿä¸Šç”ŸæˆOS ISOæ˜ åƒã€‚å°†ä½¿ç”¨GRUB Legacy stage2_eltoritoå¼•å¯¼ç¨‹åºã€‚ æ•™ç¨‹ä¸­wget ftp://alpha.gnu.org/gnu/grub/grub-0.97.tar.gz ç„¶åæ„å»ºæ–‡ä»¶ï¼Œæˆ‘ç¼–è¯‘å¤±è´¥ ä»http://littleosbook.github.com/files/stage2_eltoritoç›´æ¥ä¸‹è½½stage2_eltoritoæ–‡ä»¶ï¼Œè¿™ä¸ªåœ°å€ä¹Ÿå¤±æ•ˆäº† ä»syslinuxæ„å»ºisolinux.bin å³stage2_eltoritoæ–‡ä»¶ 12345678wget https://mirrors.edge.kernel.org/pub/linux/utils/boot/syslinux/syslinux-6.03.tar.gztar xzf syslinux-6.03.tar.gzcd syslinux-6.03make biosmkdir -p /root/iso/boot/grub cp /root/syslinux-6.03/bios/core/isolinux.bin /root/iso/boot/grub/cp /root/tutuio/kernel.elf /root/iso/boot/ æ­¤æ—¶çš„ç›®å½•ç»“æ„ï¼š menu.lstå†…å®¹å¦‚ä¸‹ 12345default=0timeout=0title oskernel /boot/kernel.elf åœ¨isoåŒçº§ç›®å½•ä¸‹è¿è¡Œä¸‹æ–¹æŒ‡ä»¤ï¼Œ isolinux.binæœ¬æ¥æ˜¯stage2_eltoritoè¢«æˆ‘æ›¿æ¢äº† å¯ä»¥ä½¿ç”¨man genisoimageæŸ¥çœ‹å‚æ•°å«ä¹‰ 12345678910genisoimage -R \\ -b boot/grub/isolinux.bin \\ -no-emul-boot \\ -boot-load-size 4 \\ -A os \\ -input-charset utf8 \\ -quiet \\ -boot-info-table \\ -o os.iso \\ iso æ­¤æ—¶isoåŒçº§ç›®å½•ä¸‹ä¼šç”Ÿæˆ os.isoæ–‡ä»¶ ä»¥isolinux.binæ„å»ºçš„isoå¹¶ä¸ä½¿ç”¨ï¼Œä¼šå‡ºç°æŠ¥é”™failed to load ldlinux.32c æ‰€ä»¥ç”¨GRUB 2æ„å»ºiso sudo yum install grub2 grub2-tools grub2-tools-extra mtools xorriso æ–°çš„ç›®å½•ç»“æ„ grub2-mkrescue -o os.iso /root/iso å¯åŠ¨bochssudo bin/bochs -f bochsrc.txt -q c æˆåŠŸå¯åŠ¨ï¼ cat bochslog.txt | grep &#39;EAX=&#39;æŸ¥çœ‹æ—¥å¿—å¹¶æ²¡æœ‰EAX &#x3D; CAFEBABEçš„å­—æ ·ï¼Ÿ è¿‡æ¸¡åˆ°cæ“ä½œç³»ç»ŸçœŸç›¸è¿˜åŸè½¯ä»¶æ˜¯å¦‚ä½•è®¿é—®ç¡¬ä»¶çš„ï¼Ÿ ç¡¬ä»¶å‘å±•è¿…é€Ÿï¼Œæ“ä½œç³»ç»Ÿä¸å¯èƒ½åŠæ—¶æ›´æ–°é©±åŠ¨ï¼Œäºæ˜¯ä½¿ç”¨ç¡¬ä»¶é€‚é…å™¨ï¼Œä¹Ÿå°±æ˜¯IOæ¥å£ï¼Œç”Ÿäº§å‡ºæ¥çš„è®¾å¤‡æŒ‰ç…§è¿™ä¸ªæ ‡å‡†å·¥ä½œå°±å®ç°äº†é€šç”¨ è®¿é—®å¤–éƒ¨ç¡¬ä»¶æœ‰ä¸¤ä¸ªæ–¹å¼ã€‚ ï¼ˆ1ï¼‰å°†æŸä¸ªå¤–è®¾çš„å†…å­˜æ˜ å°„åˆ°ä¸€å®šèŒƒå›´çš„åœ°å€ç©ºé—´ä¸­ï¼ŒCPU é€šè¿‡åœ°å€æ€»çº¿è®¿é—®è¯¥å†…å­˜åŒºåŸŸæ—¶ä¼šè½åˆ°å¤–è®¾çš„å†…å­˜ä¸­ æ¯”å¦‚æ˜¾å¡ï¼Œæ˜¾å¡æ˜¯æ˜¾ç¤ºå™¨çš„é€‚é…å™¨ï¼ŒCPU ä¸ç›´æ¥å’Œæ˜¾ç¤ºå™¨äº¤äº’ï¼Œå®ƒåªå’Œæ˜¾å¡é€šä¿¡ã€‚æ˜¾å¡ä¸Šæœ‰ç‰‡å†…å­˜å«æ˜¾å­˜ï¼Œå®ƒè¢«æ˜ å°„åˆ°ä¸»æœºç‰©ç†å†…å­˜ä¸Šçš„ä½ç«¯ 1MB çš„ 0xB8000ï½0xBFFFFã€‚CPU è®¿é—®è¿™ç‰‡å†…å­˜å°±æ˜¯è®¿é—®æ˜¾å­˜ï¼Œå¾€è¿™ç‰‡å†…å­˜ä¸Šå†™å­—èŠ‚ä¾¿æ˜¯å¾€å±å¹•ä¸Šæ‰“å°å†…å®¹ã€‚è®¡ç®—æœºä¸­å¤„å¤„æ˜¯åˆ†å±‚ï¼Œæˆ‘ä»¬è¦å……åˆ†ç›¸ä¿¡ä¸Šä¸€å±‚çš„å·¥ä½œã€‚ ï¼ˆ2ï¼‰å¤–è®¾æ˜¯é€šè¿‡ IO æ¥å£ä¸ CPU é€šä¿¡çš„ï¼ŒCPU è®¿é—®å¤–è®¾ï¼Œå°±æ˜¯è®¿é—® IO æ¥å£ï¼Œç”± IO æ¥å£å°†ä¿¡æ¯ä¼ é€’ç»™å¦ä¸€ç«¯çš„å¤–è®¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒCPU ä»æ¥ä¸çŸ¥é“æœ‰è¿™äº›è®¾å¤‡çš„å­˜åœ¨ï¼Œå®ƒåªçŸ¥é“è‡ªå·±æ“ä½œçš„ IO æ¥å£ï¼Œä½ çœ‹ï¼Œå¤„å¤„ä½“ç°ç€åˆ†å±‚ã€‚ äºæ˜¯é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•è®¿é—®åˆ° IO æ¥å£å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯ IO æ¥å£ä¸Šé¢æœ‰ä¸€äº›å¯„å­˜å™¨ï¼Œè®¿é—® IO æ¥å£æœ¬è´¨ä¸Šå°±æ˜¯è®¿é—®è¿™äº›å¯„å­˜å™¨ï¼Œè¿™äº›å¯„å­˜å™¨å°±æ˜¯äººä»¬å¸¸è¯´çš„ç«¯å£ã€‚è¿™äº›ç«¯å£æ˜¯äººå®¶ IO æ¥å£ç»™å’±ä»¬æä¾›çš„æ¥å£ã€‚äººå®¶æ¥å£ç”µè·¯ä¹Ÿæœ‰è‡ªå·±çš„æ€ç»´ï¼ˆç³»ç»Ÿï¼‰ï¼Œçœ‹åˆ°å¯„å­˜å™¨ä¸­å†™äº†ä»€ä¹ˆå°±åšå‡ºç›¸åº”çš„ååº”ã€‚ éƒ¨ç½²å·¥ä½œç¯å¢ƒCentOS 9 (CentOS-Stream-9-latest-x86_64-dvd1.iso) æˆ‘ä½¿ç”¨CentOS 7è¯•è¿‡ï¼Œæ— æ³•è¿æ¥åˆ°X serverï¼Œéœ€è¦å®‰è£…å›¾å½¢ç•Œé¢ï¼Œæˆ‘å°±æ²¡æœ‰å°è¯•äº† nasm æ±‡ç¼–è¯­è¨€ç¼–è¯‘å™¨ (åªèƒ½ä½¿ç”¨æ±‡ç¼–è¯­è¨€ä¿®æ”¹å¯„å­˜å™¨) bochs è™šæ‹Ÿæœº virtualBox è™šæ‹Ÿæœº æˆ‘ç”¨çš„vmware åªæœ‰ä»æºç å®‰è£…çš„ç‰ˆæœ¬æ‰ä¼šåœ¨å…¶é…ç½®å’Œç¼–è¯‘è¿‡ç¨‹ä¸­æ ¹æ®æ‰€åœ¨çš„å¹³å°çš„ç‰¹æ€§å»ä¼˜åŒ–ï¼Œè¿™äº›æ˜¯å…¶ä»–å½¢å¼çš„è½¯ä»¶åŒ…ä¸å¯æ¯”æ‹Ÿçš„ã€‚ ##å®‰è£…bochs ä¸‹è½½åœ°å€ï¼šhttp://sourceforge.net/projects/bochs/files/bochs/ 1234curl -L -o bochs-2.8.tar.gz https://sourceforge.net/projects/bochs/files/bochs/2.8/bochs-2.8.tar.gz/downloadtar xvf bochs-2.8.tar.gzä¹¦ç±ä¸­ä½¿ç”¨çš„2.6.2 æˆ‘ä½¿ç”¨çš„æ—¶å€™å·²ç»makeç¼–è¯‘ä¸è¿‡äº†ï¼Œéœ€è¦&lt;gtk/gtk.h&gt; ç¼–è¯‘ ä¸‰éƒ¨æ›²configure make make install 1234567891011121314151617cd bochs-2.8./configure \\ --prefix=/root/tutuos/bochs-2.8-installed \\ --enable-debugger \\ --enable-disasm \\ --enable-iodebug \\ --enable-x86-debugger \\ --with-x \\ --with-x11æ³¨æ„å„è¡Œç»“å°¾çš„&#x27;\\&#x27;å­—ç¬¦å‰é¢æœ‰ä¸ªç©ºæ ¼//ç›´æ¥å¤åˆ¶å¯ä½¿ç”¨ç‰ˆæœ¬ï¼š./configure --prefix=/root/tutuos/bochs-2.8-installed --enable-debugger --enable-disasm --enable-iodebug --enable-x86-debugger --with-x --with-x11æˆ‘ä½¿ç”¨2.8å‡ºç°æŠ¥é”™ï¼šconfigure: WARNING: unrecognized options: --enable-disasm æˆ‘æš‚æ—¶æ²¡æœ‰ç†ä¼šï¼Œå¯ä»¥å–æ¶ˆè¿™ä¸ªé€‰é¡¹åº”è¯¥æ²¡æœ‰å½±å“ â€“enable-gdb-stubæ›¿æ¢â€“enable-debuggeræ¥ä½¿ç”¨gdbè°ƒè¯•ï¼Œä½†æ˜¯ä¸å»ºè®® 12makemake install é…ç½®bochsç±»ä¼¼BIOSçš„ä½œç”¨ å®‰è£…ç›®å½•ä¸‹æœ‰é…ç½®æ–‡ä»¶çš„æ ·æœ¬æ–‡ä»¶ï¼šshare&#x2F;doc&#x2F;bochs&#x2F;bochsrc-sample.txt åœ¨å®‰è£…ç›®å½•ä¸‹æ–°å»ºbochsrc.disk æ–‡ä»¶åå’Œä½ç½®éƒ½ä¸å›ºå®šï¼Œæ³¨æ„æ–‡ä»¶ 12345678910111213141516171819202122232425262728############################################### # Configuration file for Bochs ############################################### # ç¬¬ä¸€æ­¥ï¼Œé¦–å…ˆè®¾ç½® Bochs åœ¨è¿è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜ï¼Œæœ¬ä¾‹ä¸º 32MBã€‚# å…³é”®å­—ä¸ºï¼šmegs megs: 32 # ç¬¬äºŒæ­¥ï¼Œè®¾ç½®å¯¹åº”çœŸå®æœºå™¨çš„ BIOS å’Œ VGA BIOSã€‚# å¯¹åº”ä¸¤ä¸ªå…³é”®å­—ä¸ºï¼šromimage å’Œ vgaromimage romimage: file=/root/tutuos/bochs-2.8-installed/share/bochs/BIOS-bochs-latest vgaromimage: file=/root/tutuos/bochs-2.8-installed/share/bochs/VGABIOS-lgpl-latest # ç¬¬ä¸‰æ­¥ï¼Œè®¾ç½® Bochs æ‰€ä½¿ç”¨çš„ç£ç›˜ï¼Œè½¯ç›˜çš„å…³é”®å­—ä¸º floppyã€‚# è‹¥åªæœ‰ä¸€ä¸ªè½¯ç›˜ï¼Œåˆ™ä½¿ç”¨ floppya å³å¯ï¼Œè‹¥æœ‰å¤šä¸ªï¼Œåˆ™ä¸º floppyaï¼Œfloppybâ€¦#floppya: 1_44=a.img, status=inserted # ç¬¬å››æ­¥ï¼Œé€‰æ‹©å¯åŠ¨ç›˜ç¬¦ã€‚#boot: floppy #é»˜è®¤ä»è½¯ç›˜å¯åŠ¨ï¼Œå°†å…¶æ³¨é‡Šboot: disk #æ”¹ä¸ºä»ç¡¬ç›˜å¯åŠ¨ã€‚æˆ‘ä»¬çš„ä»»ä½•ä»£ç éƒ½å°†ç›´æ¥å†™åœ¨ç¡¬ç›˜ä¸Šï¼Œæ‰€ä»¥ä¸ä¼šå†æœ‰è¯»å†™è½¯ç›˜çš„æ“ä½œã€‚# ç¬¬äº”æ­¥ï¼Œè®¾ç½®æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºã€‚log: bochs.out # ç¬¬å…­æ­¥ï¼Œå¼€å¯æˆ–å…³é—­æŸäº›åŠŸèƒ½ã€‚# ä¸‹é¢æ˜¯å…³é—­é¼ æ ‡ï¼Œå¹¶æ‰“å¼€é”®ç›˜ã€‚mouse: enabled=0 keyboard:keymap=/root/tutuos/bochs-2.8-installed/share/bochs/keymaps/x11-pc-us.map# ç¡¬ç›˜è®¾ç½®ata0: enabled=1, ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14 ata0-master: type=disk, path=&quot;hd60M.img&quot;, mode=flat, cylinders=121, heads=16, spt=63# ä¸‹é¢çš„æ˜¯å¼€æ”¾çš„ bochs å¯¹ gdb çš„æ”¯æŒï¼Œè¿™æ · gdb ä¾¿å¯ä»¥è¿œç¨‹è¿æ¥åˆ°æ­¤æœºå™¨çš„ 1234 ç«¯å£è°ƒè¯•äº†#gdbstub: enabled=1, port=4567, text_base=0, data_base=0, bss_base=0 æ³¨é‡Šæ‰ï¼Œä¼šå‡ºç°æ®µé”™è¯¯################### é…ç½®æ–‡ä»¶ç»“æŸ ##################### è¿è¡Œbochsåœ¨ bochs å®‰è£…è·¯å¾„ä¸‹ 1234bin/bochsç¬¬ä¸€ä¸ªé»˜è®¤é€‰æ‹©æ˜¯2ï¼Œé€‰æ‹©é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œ2.8ç‰ˆæœ¬å‡ºç°æ®µé”™è¯¯ï¼Œåº”è¯¥æ¸²æŸ“é€‰é¡¹ç•Œé¢å‡ºé”™ï¼Œä½†æ˜¯æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•è§£å†³sudo bin/bochs -f bochsrc.disk -q æŒ‡å®šé…ç½®æ–‡ä»¶å¹¶è·³è¿‡æŒ‡å¼• 1234åˆ›å»ºå¯åŠ¨ç¡¬ç›˜bin/bximage -hd -mode=flat -size=60 -q hd60M.imgbin/bximage -func=create -hd=60 -imgmode=flat -q hd60M.imgbin/bochs â€“f bochsrc.disk ç¼–å†™ MBR ä¸»å¼•å¯¼è®°å½•ä¸ºä»€ä¹ˆç¨‹åºè¦è½½å…¥å†…å­˜ï¼Ÿ å†…å­˜å¿«ä¸”å®¹é‡å¤§ æ“ä½œç³»ç»Ÿå¯ä»¥å­˜å‚¨åœ¨å¤šç§å­˜å‚¨ä»‹è´¨ä¸­ ä»€ä¹ˆæ˜¯è½½å…¥å†…å­˜ï¼Ÿ ç¨‹åºè¢«åŠ è½½å™¨ï¼ˆè½¯ä»¶æˆ–ç¡¬ä»¶ï¼‰åŠ è½½åˆ°å†…å­˜æŸä¸ªåŒºåŸŸ CPU çš„ csï¼šip å¯„å­˜å™¨è¢«æŒ‡å‘è¿™ä¸ªç¨‹åºçš„èµ·å§‹åœ°å€ ##BIOS Base Input &amp; Output Systemï¼Œå³åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ å®æ¨¡å¼ä¸‹1mbå†…å­˜å¸ƒå±€Intel 8086 æœ‰ 20 æ¡åœ°å€çº¿ï¼Œæ•…å…¶å¯ä»¥è®¿é—® 1MB çš„å†…å­˜ç©ºé—´ï¼Œå³ 2 çš„ 20 æ¬¡æ–¹&#x3D;1048576&#x3D;1MBï¼Œåœ°å€èŒƒå›´è‹¥æŒ‰åå…­è¿›åˆ¶æ¥è¡¨ç¤ºï¼Œæ˜¯ 0x00000 åˆ° 0xFFFFF åœ°å€ 0ï½0x9FFFF å¤„æ˜¯ DRAM(åŠ¨æ€éšæœºè®¿é—®å†…å­˜)ï¼Œæˆ‘ä»¬æ‰€è£…çš„ç‰©ç†å†…å­˜å°±æ˜¯ DRAM åŠ¨æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ åŠ¨æ€æŒ‡æ­¤ç§å­˜å‚¨ä»‹è´¨ç”±äºæœ¬èº«ç”µæ°”å…ƒä»¶çš„æ€§è´¨ï¼Œéœ€è¦å®šæœŸåœ°åˆ·æ–°(ç”µå®¹æ¼ç”µï¼ŒåŠæ—¶è¡¥ç‚¹æ¥ä¿å­˜æ•°æ®ï¼Œç§°ä¸ºåˆ·æ–°) çœ‹é¡¶éƒ¨çš„ 0xF0000ï½0xFFFFFï¼Œè¿™ 64KB çš„å†…å­˜æ˜¯ ROMã€‚è¿™é‡Œé¢å­˜çš„å°±æ˜¯ BIOS çš„ä»£ç  BIOSçš„ä½œç”¨ï¼š è¿‡â€œint ä¸­æ–­å·â€æ¥å®ç°ç›¸å…³çš„ç¡¬ä»¶è°ƒç”¨ï¼Œå³å¯¹ç¡¬ä»¶çš„è¾“å…¥è¾“å‡ºï¼Œä½†ç”±äºå°± 64KB å¤§å°çš„ç©ºé—´ï¼ŒæŒ‘ä¸€äº›é‡è¦çš„ã€ä¿è¯è®¡ç®—æœºèƒ½è¿è¡Œçš„é‚£äº›ç¡¬ä»¶çš„åŸºæœ¬ IO æ“ä½œ BIOSä¸ç”¨æ›´è¯¥,è¢«å†™è¿›ROMï¼Œæ˜ å°„åœ¨ä½ç«¯1MBå†…å­˜é¡¶éƒ¨ï¼Œ0xF0000å…¥å£åœ°å€ å¼€æœºæŒ‡ä»¤æ‰§è¡Œé¡ºåºï¼š å¼€æœºçš„ç¬é—´CPU çš„ csï¼šip å¯„å­˜å™¨è¢«å¼ºåˆ¶åˆå§‹åŒ–ä¸º 0xF000ï¼š0xFFF0 æ‰§è¡Œè·³è½¬æŒ‡ä»¤ jmp far f000ï¼še05b è·³è½¬åˆ°0xfe05b å¤„(æ®µåŸºå€ 0xf000 å·¦ç§» 4 ä½+0xe05b)ï¼Œè¿™æ˜¯ BIOS ä»£ç çœŸæ­£å¼€å§‹çš„åœ°æ–¹ csï¼šf000 åŠ ç”µï¼Œå¼ºåˆ¶å°† cs ç½®ä¸º f000 æ¥ä¸‹æ¥ BIOS ä¾¿é©¬ä¸åœè¹„åœ°æ£€æµ‹å†…å­˜ã€æ˜¾å¡ç­‰å¤–è®¾ä¿¡æ¯ï¼Œå½“æ£€æµ‹é€šè¿‡ï¼Œå¹¶åˆå§‹åŒ–å¥½ç¡¬ä»¶åï¼Œå¼€å§‹åœ¨å†…å­˜ä¸­ 0x000ï½0x3FF å¤„å»ºç«‹æ•°æ®ç»“æ„ï¼Œä¸­æ–­å‘é‡è¡¨ IVT å¹¶å¡«å†™ä¸­æ–­ä¾‹ç¨‹ã€‚ BIOS æœ€åä¸€é¡¹å·¥ä½œæ ¡éªŒå¯åŠ¨ç›˜ä¸­ä½äº 0 ç›˜ 0 é“ 1 æ‰‡åŒºçš„å†…å®¹ï¼ˆæœ€å¼€å§‹é‚£ä¸ªåŒºåŸŸ CHSæ–¹æ³•ï¼‰ï¼Œä¹Ÿå°±æ˜¯MBRæ‰€åœ¨ä½ç½® MBRå¦‚æœæ­¤æ‰‡åŒºæœ«å°¾çš„ä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯é­”æ•° 0x55 å’Œ 0xaaï¼ŒBIOS ä¾¿è®¤ä¸ºæ­¤æ‰‡åŒºä¸­ç¡®å®å­˜åœ¨å¯æ‰§è¡Œçš„ç¨‹åºï¼ŒåŠ è½½åˆ°ç‰©ç†åœ°å€ 0x7c00 MBR çš„å¤§å°å¿…é¡»æ˜¯ 512 å­—èŠ‚ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯ 0x55 å’Œ 0xaa è¿™ä¸¤ä¸ªé­”æ•°æ°å¥½å‡ºç°åœ¨è¯¥æ‰‡åŒºçš„æœ€åä¸¤ä¸ªå­—èŠ‚å¤„ï¼Œå³ç¬¬ 510 å­—èŠ‚å¤„å’Œç¬¬ 511 å­—èŠ‚å¤„ï¼Œç”±äºæˆ‘ä»¬çš„ bochs æ¨¡æ‹Ÿçš„æ˜¯ x86 å¹³å°ï¼Œæ‰€ä»¥æ˜¯å°ç«¯å­—èŠ‚åºï¼Œæ•…å…¶æœ€åä¸¤ä¸ªå­—èŠ‚å†…å®¹æ˜¯ 0xaa55 ç¥å¥‡å¥½ç”¨çš„$å’Œ$$ï¼Œä»¤äººè¿·æƒ‘çš„ section$å’Œ$$æ˜¯ç¼–è¯‘å™¨ NASM é¢„ç•™çš„å…³é”®å­—ï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰è¡Œå’Œæœ¬ section çš„åœ°å€ï¼Œèµ·åˆ°äº†æ ‡å·çš„ä½œç”¨ï¼Œå®ƒæ˜¯ NASM æä¾›çš„ï¼Œå¹¶ä¸æ˜¯ CPU åŸç”Ÿæ”¯æŒçš„ï¼Œç›¸å½“äºä¼ªæŒ‡ä»¤ä¸€æ ·ï¼Œå¯¹ CPU æ¥è¯´æ˜¯å‡çš„ã€‚ 1234code_start: mov ax, 0code_startè¢«nasmè®¤ä¸ºæ˜¯ä¸€ä¸ªåœ°å€ï¼Œæ­¤åœ°å€æ˜¯ï¼šmov ax, 0è¿™æ¡æŒ‡ä»¤æ‰€åœ¨çš„åœ°å€ $å±äºâ€œéšå¼åœ°â€è—åœ¨æœ¬è¡Œä»£ç å‰çš„æ ‡å·ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨ç»™å½“å‰è¡Œå®‰æ’çš„åœ°å€ï¼Œçœ‹ä¸åˆ°å´åˆæ— å¤„ä¸åœ¨ï¼Œ$åœ¨æ¯è¡Œéƒ½æœ‰ã€‚ 123code_start: jmp $ ç­‰æ•ˆäºjmp code_start $$æŒ‡ä»£æœ¬ section çš„èµ·å§‹åœ°å€ p70ï¼Œæš‚ä¸”è·³è¿‡ NASMç®€å•ç”¨æ³•nasm -f &lt;format&gt;&lt;filename&gt; [-o &lt;output&gt;] -fæŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤binï¼Œéœ€è¦ç”¨elfæ ¼å¼æ‰ä½¿ç”¨-fï¼Œä¸€å…±21ä¸­æ ¼å¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253; ä¸»å¼•å¯¼ç¨‹åºSECTION MBR vstart=0x7c00 mov ax, cs mov ds, ax mov es, ax mov ss, ax mov fs, ax mov sp, 0x7c00 ; æ¸…å±åˆ©ç”¨ 0x06 å·åŠŸèƒ½,ä¸Šå·å…¨éƒ¨è¡Œ,åˆ™å¯æ¸…å±ã€‚; INT 0x10 åŠŸèƒ½å·:0x06 åŠŸèƒ½æè¿°:ä¸Šå·çª—å£; è¾“å…¥: ; AH åŠŸèƒ½å· = 0x06 ; AL = ä¸Šå·çš„è¡Œæ•°(å¦‚æœä¸º 0,è¡¨ç¤ºå…¨éƒ¨) ; BH = ä¸Šå·è¡Œå±æ€§; (CL,CH) = çª—å£å·¦ä¸Šè§’çš„(X,Y)ä½ç½®; (DL,DH) = çª—å£å³ä¸‹è§’çš„(X,Y)ä½ç½®; æ— è¿”å›å€¼: mov ax, 0x600 mov bx, 0x700 mov cx, 0 ; å·¦ä¸Šè§’: (0, 0) mov dx, 0x184f ; å³ä¸‹è§’: (80,25) ; VGA æ–‡æœ¬æ¨¡å¼ä¸­,ä¸€è¡Œåªèƒ½å®¹çº³ 80 ä¸ªå­—ç¬¦,å…± 25 è¡Œã€‚; ä¸‹æ ‡ä» 0 å¼€å§‹,æ‰€ä»¥ 0x18=24,0x4f=79 int 0x10 ; int 0x10 ;.get_cursor è·å–å½“å‰å…‰æ ‡ä½ç½®,åœ¨å…‰æ ‡ä½ç½®å¤„æ‰“å°å­—ç¬¦ã€‚mov ah, 3 ; è¾“å…¥: 3 å·å­åŠŸèƒ½æ˜¯è·å–å…‰æ ‡ä½ç½®,éœ€è¦å­˜å…¥ ah å¯„å­˜å™¨mov bh, 0 ; bh å¯„å­˜å™¨å­˜å‚¨çš„æ˜¯å¾…è·å–å…‰æ ‡çš„é¡µå·int 0x10 ; è¾“å‡º: ch=å…‰æ ‡å¼€å§‹è¡Œ,cl=å…‰æ ‡ç»“æŸè¡Œ; dh=å…‰æ ‡æ‰€åœ¨è¡Œå·,dl=å…‰æ ‡æ‰€åœ¨åˆ—å·; æ‰“å°å­—ç¬¦ä¸² ; è¿˜æ˜¯ç”¨ 10h ä¸­æ–­,ä¸è¿‡è¿™æ¬¡è°ƒç”¨ 13 å·å­åŠŸèƒ½æ‰“å°å­—ç¬¦ä¸²mov ax, message mov bp, ax ; es:bp ä¸ºä¸²é¦–åœ°å€,es æ­¤æ—¶åŒ cs ä¸€è‡´, ; å¼€å¤´æ—¶å·²ç»ä¸º sreg åˆå§‹åŒ–; å…‰æ ‡ä½ç½®è¦ç”¨åˆ° dx å¯„å­˜å™¨ä¸­å†…å®¹,cx ä¸­çš„å…‰æ ‡ä½ç½®å¯å¿½ç•¥mov cx, 5 ; cx ä¸ºä¸²é•¿åº¦,ä¸åŒ…æ‹¬ç»“æŸç¬¦ 0 çš„å­—ç¬¦ä¸ªæ•°mov ax, 0x1301 ; å­åŠŸèƒ½å· 13 æ˜¾ç¤ºå­—ç¬¦åŠå±æ€§,è¦å­˜å…¥ ah å¯„å­˜å™¨, ; al è®¾ç½®å†™å­—ç¬¦æ–¹å¼ ah=01: æ˜¾ç¤ºå­—ç¬¦ä¸²,å…‰æ ‡è·Ÿéšç§»åŠ¨mov bx, 0x2 ; bh å­˜å‚¨è¦æ˜¾ç¤ºçš„é¡µå·,æ­¤å¤„æ˜¯ç¬¬ 0 é¡µ, ; bl ä¸­æ˜¯å­—ç¬¦å±æ€§,å±æ€§é»‘åº•ç»¿å­—(bl = 02h) int 0x10 ; æ‰§è¡Œ BIOS 0x10 å·ä¸­æ–­jmp $ ; ä½¿ç¨‹åºæ‚¬åœåœ¨æ­¤message db &quot;1 MBR&quot; times 510-($-$$) db 0 db 0x55,0xaa ä»£ç åŠŸèƒ½ï¼šåœ¨å±å¹•ä¸Šæ‰“å°å­—ç¬¦ä¸²â€œ1 MBRâ€ï¼ŒèƒŒæ™¯è‰²ä¸ºé»‘è‰²ï¼Œå‰æ™¯è‰²ä¸ºç»¿è‰² æ²¡æœ‰ä½¿ç”¨æ˜¾å¡ï¼Œæœ¬æ®µä»£ç ä¸­å…³äºâ€œæ‰“å°æ˜¾ç¤ºâ€çš„æ“ä½œéƒ½åˆ©ç”¨ BIOS å»ºç«‹å¥½çš„ä¾‹ç¨‹å°±å¥½äº†ï¼Œè¿™é‡Œç¬¬ 0x10 å·ä¸­æ–­ä¾¿æ˜¯è´Ÿè´£æœ‰å…³æ‰“å°çš„ä¾‹ç¨‹ã€‚ ç¬¬ 3 è¡Œçš„â€œvstart&#x3D;0x7c00â€è¡¨ç¤ºæœ¬ç¨‹åºåœ¨ç¼–è¯‘æ—¶ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼ŒæŠŠæˆ‘çš„èµ·å§‹åœ°å€ç¼–è¯‘ä¸º 0x7c00ã€‚ ç¬¬ 4ï½8 è¡Œæ˜¯ç”¨ cs å¯„å­˜å™¨çš„å€¼å»åˆå§‹åŒ–å…¶ä»–å¯„å­˜å™¨ã€‚ç”±äº BIOS æ˜¯é€šè¿‡ jmp 0ï¼š0x7c00 è·³è½¬åˆ° MBR çš„ï¼Œæ•…cs æ­¤æ—¶ä¸º 0ã€‚å¯¹äº dsã€esã€fsã€gs è¿™ç±» sregï¼ŒCPU ä¸­ä¸èƒ½ç›´æ¥ç»™å®ƒä»¬èµ‹å€¼ï¼Œæ²¡æœ‰ä»ç«‹å³æ•°åˆ°æ®µå¯„å­˜å™¨çš„ç”µè·¯å®ç°ï¼Œåªæœ‰é€šè¿‡å…¶ä»–å¯„å­˜å™¨æ¥ä¸­è½¬ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯é€šç”¨å¯„å­˜å™¨ ax æ¥ä¸­è½¬ã€‚ä¾‹å¦‚ mov dsï¼š0x7c00ï¼Œè¿™æ ·å°±é”™äº†ã€‚ ç¬¬ 9 è¡Œæ˜¯åˆå§‹åŒ–æ ˆæŒ‡é’ˆï¼Œåœ¨ CPU ä¸Šè¿è¡Œçš„ç¨‹åºå¾—éµä» CPU çš„è§„åˆ™ï¼Œmbr ä¹Ÿæ˜¯ç¨‹åºï¼Œæ˜¯ç¨‹åºå°±è¦ç”¨åˆ°æ ˆã€‚ç›®å‰ 0x7c00 ä»¥ä¸‹æš‚æ—¶æ˜¯å®‰å…¨çš„åŒºåŸŸï¼Œå°±æŠŠå®ƒå½“ä½œæ ˆæ¥ç”¨ã€‚ ç¬¬ 11ï½28 è¡Œæ˜¯æ¸…å±ã€‚å› ä¸ºåœ¨ BIOS å·¥ä½œä¸­ï¼Œä¼šæœ‰ä¸€äº›è¾“å‡ºï¼Œå¦‚æ£€æµ‹ç¡¬ä»¶çš„ç»“æœä¿¡æ¯ã€‚ä¸ºäº†è®©å¤§å®¶çœ‹æ¸…æ¥šæˆ‘ä»¬åœ¨ MBR ä¸­çš„è¾“å‡ºå­—ç¬¦ä¸²ï¼Œæ•…å…ˆæŠŠ BIOS çš„è¾“å‡ºæ¸…æ‰ï¼Œè¿™é‡Œæ¼”ç¤ºçš„æ˜¯ BIOS ä¸­æ–­ int 0x10 çš„ç”¨æ³•ã€‚ ç¬¬30ï½35 è¡Œæ˜¯åšæ‰“å°å‰çš„å·¥ä½œï¼Œå…ˆè·å–å…‰æ ‡ä½ç½®ï¼Œç›®çš„æ˜¯é¿å…æ‰“å°å­—ç¬¦æ··ä¹±ï¼Œè¦†ç›–åˆ«äººçš„è¾“å‡ºã€‚å­—ç¬¦æ‰“å°çš„ä½ç½®ï¼Œä¸ä¸€å®šè¦åœ¨å…‰æ ‡å¤„ï¼Œå­— ç¬¦çš„ä½ç½®åªå’Œæ˜¾å­˜ä¸­çš„åœ°å€æœ‰å…³ï¼Œå’Œå…‰æ ‡æ˜¯æ²¡å…³ç³»çš„ï¼Œè¿™åªæ˜¯äººä¸ºåœ°åŠ ä¸ªçº¦æŸï¼Œæ¯•ç«Ÿå…‰æ ‡åœ¨è§†è§‰ä¸Šå‘Šè¯‰äº†æˆ‘ä»¬å½“å‰å­—ç¬¦å†™åˆ°å“ªé‡Œäº†ï¼Œå®Œå…¨æ˜¯ä¸ºäº†å¥½çœ‹ï¼Œä¸è¦ä»¥ä¸ºå…‰æ ‡å°±æ˜¯æ–°æ‰“å°å­—ç¬¦çš„ä½ç½®ã€‚æ›´å¤šç»†èŠ‚ï¼Œä»¥åè®²æ˜¾å¡æ—¶ä¼šæåˆ°ã€‚ &#x3D;&#x3D;é¡µ&#x3D;&#x3D; ç¬¬ 33 è¡Œï¼Œå¾€ bh å¯„å­˜å™¨ä¸­å†™å…¥äº† 0ï¼Œè¿™æ˜¯å‘Šè¯‰ BIOS ä¾‹ç¨‹ï¼Œæˆ‘è¦è·å–ç¬¬0 é¡µå½“å‰çš„å…‰æ ‡ æ˜¾ç¤ºå™¨æœ‰å¾ˆå¤šç§æ¨¡å¼ï¼Œå¦‚å›¾å½¢æ¨¡å¼ã€æ–‡æœ¬æ¨¡å¼ç­‰ï¼Œåœ¨æ–‡æœ¬æ¨¡å¼ä¸­ï¼Œåˆå¯ä»¥å·¥ä½œäº 80*25 å’Œ 40*25 ç­‰æ˜¾ç¤ºæ–¹å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä¸ªäººè®¡ç®—æœºä¸Šçš„æ˜¾å¡åœ¨åŠ ç”µåéƒ½å°†è‡ªå·±ç½®ä¸º 80*25 è¿™ç§æ˜¾ç¤ºæ–¹å¼ã€‚80*25 æ˜¯æŒ‡ä¸€å±å¯ä»¥æ˜¾ç¤º 25 è¡Œã€æ¯è¡Œ 80 åˆ—çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ 2000 ä¸ªå­—ç¬¦ã€‚ä½†ç”±äºä¸€ä¸ªå­—ç¬¦è¦ç”¨ä¸¤å­—èŠ‚æ¥è¡¨ç¤ºï¼Œä½å­—ç¬¦æ˜¯å­—ç¬¦çš„ ASCII ç¼–ç ï¼Œé«˜å­—èŠ‚æ˜¯å­—ç¬¦å±æ€§ï¼Œæ•…æ˜¾ç¤ºä¸€å±å­—ç¬¦éœ€è¦ç”¨ 4000 å­—èŠ‚ï¼ˆå®é™…ä¸Šï¼Œåˆ†é…ç»™ä¸€å±çš„å®¹é‡æ˜¯ 4KBï¼‰ï¼Œè¿™ä¸€å±å°±ç§°ä¸ºä¸€é¡µï¼Œ0 é¡µæ˜¯é»˜è®¤é¡µã€‚ ç¬¬ 38ï½52 è¡Œæ˜¯å¾€å…‰æ ‡å¤„æ‰“å°å­—ç¬¦ã€‚è¯´ä¸€ä¸‹ç¬¬ 48 è¡Œçš„ mov axï¼Œ0x1301ï¼Œ13 å¯¹åº”çš„æ˜¯ ah å¯„å­˜å™¨ï¼Œè¿™æ˜¯è°ƒç”¨0x13 å·å­åŠŸèƒ½ã€‚01 å¯¹åº”çš„æ˜¯ al å¯„å­˜å™¨ï¼Œè¡¨ç¤ºçš„æ˜¯å†™å­—ç¬¦æ–¹å¼ï¼Œå…¶ä½ 2 ä½æ‰æœ‰æ„ä¹‰ï¼Œå„ä½åŠŸèƒ½æè¿°å¦‚ä¸‹ã€‚ ï¼ˆ1ï¼‰al&#x3D;0ï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å…‰æ ‡è¿”å›èµ·å§‹ä½ç½®ã€‚ ï¼ˆ2ï¼‰al&#x3D;1ï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å…‰æ ‡è·Ÿéšåˆ°æ–°ä½ç½®ã€‚ ï¼ˆ3ï¼‰al&#x3D;2ï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸²åŠå…¶å±æ€§ï¼Œå¹¶ä¸”å…‰æ ‡è¿”å›èµ·å§‹ä½ç½®ã€‚ ï¼ˆ4ï¼‰al&#x3D;3ï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸²åŠå…¶å±æ€§ï¼Œå…‰æ ‡è·Ÿéšåˆ°æ–°ä½ç½®ã€‚ ç¬¬ 55 è¡Œæ‰§è¡Œäº†ä¸ªæ­»å¾ªç¯ï¼Œ$æ˜¯æœ¬è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼Œè¿™å±äºä¼ªæŒ‡ä»¤ï¼Œæ˜¯æ±‡ç¼–å™¨åœ¨ç¼–è¯‘æœŸé—´åˆ†é…çš„åœ°å€ã€‚åœ¨æœ€ç»ˆç¼–è¯‘å‡ºæ¥çš„ç¨‹åºä¸­ï¼Œ$ä¼šè¢«æ›¿æ¢ä¸ºæŒ‡ä»¤å®é™…æ‰€åœ¨è¡Œçš„åœ°å€ã€‚jmp æ˜¯ä¸ªè¿‘è·³è½¬ï¼Œ$æ˜¯ jmp è‡ªå·±çš„åœ°å€ï¼Œäºæ˜¯è·³åˆ°è‡ªå·±æ‰€åœ¨çš„åœ°å€å†æ‰§è¡Œè‡ªå·±ï¼Œåˆæ˜¯è·³åˆ°è‡ªå·±æ‰€åœ¨çš„åœ°å€å†ç»§ç»­æ‰§è¡Œè·³è½¬ï¼Œè¿™æ ·ä¾¿å®ç°äº†æ­»å¾ªç¯ã€‚ ç¬¬ 57 è¡Œæ˜¯å®šä¹‰æ‰“å°çš„å­—ç¬¦ä¸²ã€‚ ç¬¬ 58 è¡Œçš„$$æ˜¯æŒ‡æœ¬ section çš„èµ·å§‹åœ°å€ï¼Œä¸Šé¢è¯´è¿‡äº†$æ˜¯æœ¬è¡Œæ‰€åœ¨çš„åœ°å€ï¼Œæ•…$-$$æ˜¯æœ¬è¡Œåˆ°æœ¬ sectionçš„åç§»é‡ã€‚ç”±äº MBR çš„æœ€åä¸¤ä¸ªå­—èŠ‚æ˜¯å›ºå®šçš„å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ 0x55 å’Œ 0xaaï¼Œè¦é¢„ç•™å‡ºè¿™ 2 ä¸ªå­—èŠ‚ï¼Œæ•…æœ¬æ‰‡åŒºå†…å‰ 512-2&#x3D;510 å­—èŠ‚è¦å¡«æ»¡ï¼Œé‚£åˆ°åº•è¦ç”¨å¤šå°‘å­—èŠ‚æ‰èƒ½å¡«æ»¡æ­¤æ‰‡åŒºå‘¢ã€‚ç”¨ 510 å­—èŠ‚å‡å»ä¸Šé¢é€šè¿‡$-$$å¾—åˆ°çš„åç§»é‡ï¼Œå…¶ç»“æœä¾¿æ˜¯æœ¬æ‰‡åŒºå†…çš„å‰©ä½™é‡ï¼Œä¹Ÿå°±æ˜¯è¦å¡«å……çš„å­—èŠ‚æ•°ã€‚ç”±æ­¤å¯è§ç¬¬ 50 è¡Œçš„â€œtimes 510-ï¼ˆ$-$$ï¼‰ db 0â€æ˜¯åœ¨ç”¨ 0 å°†æœ¬æ‰‡åŒºå‰©ä½™ç©ºé—´å¡«å……ã€‚ 123456789ç¼–è¯‘nasm -o mbr.bin mbr.SéªŒè¯æ˜¯å¦ä¸º512å­—èŠ‚ls -lb mbr.binç£ç›˜æ“ä½œï¼Œå°†æ–‡ä»¶å†™å…¥ 0 ç›˜ 0 é“ 1 æ‰‡åŒºdd if=/root/tutuos/mbr.bin of=/root/tutuos/bochs-2.8-installed/hd60M.img bs=512 count=1 conv=notruncè¿è¡Œbin/bochs -f bochsrc.disk -qè¾“å…¥cåå›è½¦ ç¬¬ä¸€ä¸ªæç¤ºè®¾ç½®ç¯å¢ƒå˜é‡ï¼šexport BXSHARE&#x3D;&#x2F;root&#x2F;tutuos&#x2F;bochs-2.8-installed&#x2F;share&#x2F;bochs å®Œå–„MBRåœ°å€ section vstartæµ…å°ä»€ä¹ˆæ˜¯åœ°å€åœ°å€ï¼šæè¿°å„ç§ç¬¦å·åœ¨æºæ–‡ä»¶ä¸­çš„ä½ç½®ï¼Œå„ç¬¦å·åç§»æ–‡ä»¶å¼€å¤´çš„è·ç¦» ç¼–è¯‘å™¨ï¼šç»™å„ç¬¦å·ç¼–å€ï¼Œæ ¹æ®ç¡¬ä»¶å¹³å°ç‰¹æ€§ï¼Œä¸è€ƒè™‘å¯¹é½åˆ™å½¼æ­¤ç›¸è¿ æ¯ä¸ªå˜é‡çš„åœ°å€æ˜¯å‰ä¸€ä¸ªå˜é‡çš„åœ°å€+å‰ä¸€ä¸ªå˜é‡çš„å†…å­˜ç©ºé—´å¤§å°ã€‚ ä»£ç ç¼–è¯‘ä¹‹åï¼Œæºä»£ç ä¸­çš„æ ‡å·(æ¯”å¦‚$)ä¼šè¢«æ›¿æ¢ä¸ºå®é™…åœ°å€ ä¸ºäº†çœ‹ç¨‹åºç¼–è¯‘åçš„å„æŒ‡ä»¤æˆ–æ ‡å·çš„åœ°å€ï¼Œå¯ä»¥ç”¨åæ±‡ç¼–æ¥æŸ¥çœ‹ï¼Œç”¨ ndisasm è¿™ä¸ªå·¥å…·å®Œæˆ æŒ‡ä»¤ mov ds,axï¼Œè¢«ç¼–è¯‘å™¨å¤„ç†ä¹‹åï¼Œå…¶æ‰€åœ¨åœ°å€å¤„çš„å†…å®¹å°±æ˜¯æœºå™¨ç  8ED8 var dw 0x99 æ•°æ®å®šä¹‰ å®šä¹‰ä¸€ä¸ªåŒå­—èŠ‚å­—ï¼Œç¼–è¯‘åä¸º99 00 x86å°ç«¯åºï¼Œä½åœ°å€åœ¨99 çœ‹ç¬¬ 1 è¡Œçš„ mov æŒ‡ä»¤ï¼Œ$$è¡¨ç¤ºçš„æ˜¯æ‰€åœ¨çš„ section çš„èµ·å§‹åœ°å€ï¼Œç”±äºè¿™ 6 è¡Œä»£ç ä¸­æ²¡æœ‰å®šä¹‰ sectionï¼Œæ•… nasm é»˜è®¤æŠŠå…¨ä½“æ–‡ä»¶å½“æˆä¸€ä¸ªå¤§çš„ sectionï¼Œå…¨ä½“æ–‡ä»¶è‡ªç„¶åç§»åœ°å€ä¸º 0ï¼Œæ‰€ä»¥åœ¨åæ±‡ç¼–ä»£ç é‚£åˆ—ä¸­ï¼Œèµ·å§‹åœ°å€$$è¢«ç½®æ¢ä¸º 0ã€‚ ç¬¬ 2 è¡Œä»£ç æ˜¯çœŸæŒ‡ä»¤ï¼Œä¸ç‰µæ¶‰åˆ°ç¬¦å·è½¬æ¢ï¼Œæ‰€ä»¥åæ±‡ç¼–åçš„ä»£ç åŒæºç ä¸€è‡´ã€‚ ç¬¬ 3 è¡Œå¼•ç”¨äº† var å˜é‡çš„å€¼ï¼Œ[]ç¬¦å·æ˜¯å–æ‰€åœ¨åœ°å€å¤„çš„å†…å®¹ã€‚åœ¨ç›¸åº”çš„åæ±‡ç¼–ä»£ç ä¸­ï¼Œç›¸åº”çš„ç¬¬ä¸‰è¡Œä¸­ var è¿™ä¸ªç¬¦å·åœ°å€è¢«ç¼–è¯‘å™¨æ›¿æ¢ä¸º 0xdã€‚ç»“åˆåœ°å€åˆ—æŸ¥çœ‹ä¸€ä¸‹å†…å®¹åˆ—ï¼Œåœ°å€ä¸º 0xd çš„å†…å®¹ä¸º 99ï¼Œè¿™æ­£æ˜¯var çš„å€¼ã€‚ ç¬¬ 4 è¡Œæºç ä¸ºâ€œlabel: mov ax,$â€,label æ˜¯ä¸ªæ ‡å·ï¼Œä»£è¡¨æŒ‡ä»¤â€œmov axï¼Œ$â€æ‰€åœ¨åœ°å€ã€‚$æ˜¯ä¸ªéšå¼çš„æ ‡å·ï¼Œè¡¨ç¤ºå½“å‰è¡Œåœ°å€ã€‚æŒ‰ç†è¯´è¿™ä¸¤ä¸ªæ ‡å·å€¼åº”è¯¥æ˜¯ä¸€è‡´çš„ï¼ŒéªŒè¯ä¸€ä¸‹ï¼šæŸ¥çœ‹ä¸‹åæ±‡ç¼–ä»£ç åˆ—çš„ç¬¬ 4 è¡Œï¼Œ$è¢«æ›¿æ¢ä¸º0x8ï¼Œå³æœ¬è¡Œ mov æŒ‡ä»¤åœ°å€æ˜¯ 0x8ï¼Œåœ¨åœ°å€åˆ—ç¬¬ 4 è¡ŒæŸ¥çœ‹ï¼Œåœ°å€ç¡®å®ä¸º 8ï¼Œå»åˆã€‚ ç¬¬ 5 è¡Œçš„â€œjmp labelâ€ç¼–è¯‘åè¢«æ›¿æ¢ä¸º jmp short 0x8ï¼Œè¿™æ˜¯çŸ­è·³è½¬æŒ‡ä»¤ï¼Œåœ°å€ä¸º 8 å¤„çš„å†…å®¹æ˜¯ç¬¬ 4 è¡Œçš„â€œmov axï¼Œ$â€ï¼ŒåŒæ ·å»åˆã€‚ &#x3D;&#x3D;åœ°å€ç­‰äºä¸Šä¸€ä¸ªåœ°å€+ä¸Šä¸€ä¸ªåœ°å€å¤„çš„å†…å®¹çš„é•¿åº¦ã€‚ä¾‹å¦‚åœ°å€åˆ—ç¬¬äºŒè¡Œçš„ 3 ç­‰äºâ€œä¸Šä¸€ä¸ªåœ°å€ 0â€+â€œä¸Šä¸€ä¸ªåœ°å€0 å¤„çš„å†…å®¹ï¼šB80000 çš„é•¿åº¦ 3(ä¸€ä¸ªé•¿åº¦32ä½)â€ï¼Œä»¥æ­¤ç±»æ¨ã€‚&#x3D;&#x3D; èŠ‚ sectionç¼–è¯‘å™¨æä¾›çš„ä¼ªæŒ‡ä»¤ï¼Œå°†ç¨‹åºé€»è¾‘ä¸Šåˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚å°†æŒ‡ä»¤å’Œæ•°æ®åˆ†å¼€ä¾¿äºç»´æŠ¤ç­‰ vstartæ˜¯ section ç”¨ vstart&#x3D;æ¥ä¿®é¥°åï¼Œå¯ä»¥è¢«èµ‹äºˆä¸€ä¸ªè™šæ‹Ÿèµ·å§‹åœ°å€ï¼Œå®ƒè¢«ç”¨æ¥è®¡ç®—åœ¨è¯¥ section å†…çš„æ‰€æœ‰å†…å­˜å¼•ç”¨åœ°å€ã€‚ åœ¨ section ä¸­æ·»åŠ äº† vstartï¼Œè¿™ä¸ªå‚æ•°æ˜¯è®©ç¼–è¯‘å™¨å°† section ä¸­çš„æ•°æ®çš„åœ°å€ä»¥ vstart çš„å€¼ä¸ºèµ·å§‹ï¼Œä¸å†ä»æ•´ä¸ªç¨‹åºå¼€å¤´ç®—èµ·ã€‚åªæœ‰ä»¥ç¨‹åºå¼€å¤´ 0 ç®—èµ·çš„åœ°å€æ‰æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œåœ¨è¿™ä¸ªåœ°å€ä¸Šèƒ½è®¿é—®åˆ°ç›¸åº”çš„ç¬¦å·ï¼Œæ‰€ä»¥ä¸ä»¥ç¨‹åºå¼€å¤´ç®—èµ·çš„åœ°å€ï¼Œå¿…ç„¶åœ¨ç¨‹åºå†…éƒ¨ä¸å­˜åœ¨ï¼Œæ˜¯è™šæ‹Ÿçš„ã€‚ æºç ç¬¬ 1 è¡Œçš„ section å«æœ‰ vstart&#x3D;0x7c00ï¼Œæ•…è¯¥èŠ‚ä¸­çš„æ•°æ®åœ°å€ä»¥ 0x7c00 ä¸ºèµ·å§‹ç¼–å€ã€‚æ­¤ 0x7c00 ä¾¿æ˜¯è™šæ‹Ÿçš„åœ°å€ï¼Œåœ¨ç¨‹åºä¸­æ²¡æœ‰åç§»æ–‡ä»¶å¼€å¤´ä¸º 0x7c00 çš„åœ°å€ï¼Œæ•´ä¸ªç¨‹åºä¸åˆ° 100 å­—èŠ‚ã€‚ æºç ç¬¬ 2 è¡Œçš„$$åœ¨ç¼–è¯‘åè¢«æ›¿æ¢ä¸º vstart çš„å€¼ 0x7c00 ç¬¬ 5 è¡Œçš„$åœ¨æ–‡ä»¶ä¸­çš„åœ°å€æ˜¯ 0x9ï¼Œç»ç¼–è¯‘åå˜æˆäº† 0x7c09ï¼Œä»¥vstartä¸ºèµ·å§‹è®¡ç®—çš„ ç¬¬ 6ã€7 è¡Œä¸­å¼•ç”¨çš„å˜é‡ var1 å’Œ var2 å±äº data èŠ‚ï¼Œæ ¹æ®ç¬¬äºŒä¸ªvstartè®¡ç®—çš„ CPUçš„å®æ¨¡å¼(æ±‡ç¼–è®²è§£)å®æ¨¡å¼å…¶å®å°±æ˜¯ 8086 CPU çš„å·¥ä½œç¯å¢ƒã€å·¥ä½œæ–¹å¼ã€å·¥ä½œçŠ¶æ€ï¼Œè¿™æ˜¯ä¸€æ•´å¥—çš„å†…å®¹ï¼Œå®æ¨¡å¼æ˜¯æŒ‡ 8086 CPU çš„å¯»å€æ–¹å¼ã€å¯„å­˜å™¨å¤§å°ã€æŒ‡ä»¤ç”¨æ³•ç­‰ï¼Œæ˜¯ç”¨æ¥ååº” CPU åœ¨è¯¥ç¯å¢ƒä¸‹å¦‚ä½•å·¥ä½œçš„æ¦‚å¿µ å®æ¨¡å¼çš„â€œå®â€ä½“ç°åœ¨ï¼šç¨‹åºä¸­ç”¨åˆ°çš„åœ°å€éƒ½æ˜¯çœŸå®çš„ç‰©ç†åœ°å€ï¼Œâ€œæ®µåŸºå€ï¼šæ®µå†…åç§»â€äº§ç”Ÿçš„é€»è¾‘åœ°å€å°±æ˜¯ç‰©ç†åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºå‘˜çœ‹åˆ°çš„å®Œå…¨æ˜¯çœŸå®çš„å†…å­˜ ç›´æ¥å¯¹æ˜¾ç¤ºå™¨è¯´ç‚¹ä»€ä¹ˆCPUå¦‚ä½•ä¸å¤–è®¾é€šä¿¡-IOæ¥å£IOæ¥å£ï¼šCPUå’Œå¤–è®¾ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œå½¢å¼ä¸é™ IOæ¥å£çš„å¤šåŠŸèƒ½å’Œå¤šå·¥ä½œæ¨¡å¼ï¼Œç”šè‡³å¤šè®¾å¤‡ï¼Œé€šè¿‡è½¯ä»¶æŒ‡ä»¤å®ï¼Œç§°ä¸ºâ€œIOæ¥å£æ§åˆ¶ç¼–ç¨‹â€ï¼Œé€šè¿‡ç«¯å£è¯»å†™æŒ‡ä»¤in&#x2F;outå®ç° IOæ¥å£çš„åŠŸèƒ½ï¼š è®¾ç½®æ•°æ®ç¼“å†²ï¼Œè§£å†³é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ è®¾ç½®ä¿¡å·ç”µå¹³è½¬æ¢ç”µè·¯ï¼ŒCPUæ˜¯TTLç”µå¹³ï¼Œå¤–è®¾å¤§å¤šæœºç”µè®¾å¤‡æ— æ³•è¢«TTLé©±åŠ¨ è®¾ç½®æ•°æ®æ ¼å¼è½¬æ¢ è®¾ç½®æ—¶åºæ§åˆ¶ç”µè·¯åŒæ­¥CPUå’Œå¤–è®¾ æä¾›åœ°å€è¯‘ç ï¼Œå¤šç«¯å£è®¾å¤‡ åŒä¸€æ—¶åˆ»CPU åªèƒ½å’Œä¸€ä¸ª IO æ¥å£é€šä¿¡,CPUå°†é€‰æ‹©è¿™ä¸ªå·¥ä½œäº¤ç»™è¾“å…¥è¾“å‡ºæ§åˆ¶ä¸­å¿ƒï¼ˆI&#x2F;O control hubï¼ŒICHï¼‰ï¼Œä¹Ÿå°±æ˜¯å—æ¡¥èŠ¯ç‰‡ å—æ¡¥ç”¨äºè¿æ¥ pciã€pci-expressã€AGP ç­‰ä½é€Ÿè®¾å¤‡ï¼ŒåŒ—æ¡¥ç”¨äºè¿æ¥é«˜é€Ÿè®¾å¤‡ï¼Œå¦‚å†…å­˜ IA32 ä½“ç³»ç³»ç»Ÿä¸­ï¼Œå› ä¸ºç”¨äºå­˜å‚¨ç«¯å£å·çš„å¯„å­˜å™¨æ˜¯ 16 ä½çš„ï¼Œæ‰€ä»¥æœ€å¤§æœ‰ 65536 ä¸ªç«¯å£ï¼Œå³ 0ï½65535ã€‚è¦æ˜¯é€šè¿‡å†…å­˜æ˜ å°„ï¼Œç«¯å£å°±å¯ä»¥ç”¨ mov æŒ‡ä»¤æ¥æ“ä½œã€‚ä½†ç”±äºç”¨çš„æ˜¯ç‹¬ç«‹ç¼–å€ï¼Œæ‰€ä»¥å°±ä¸èƒ½æŠŠå®ƒå½“ä½œ å†…å­˜æ¥æ“ä½œï¼Œå› æ­¤ CPU æä¾›äº†ä¸“é—¨çš„æŒ‡ä»¤æ¥å¹²è¿™äº‹ï¼Œin å’Œ outã€‚ 1234567891011in æŒ‡ä»¤ç”¨äºä»ç«¯å£ä¸­è¯»å–æ•°æ®ï¼Œå…¶ä¸€èˆ¬å½¢å¼æ˜¯ï¼šï¼ˆ1ï¼‰in al, dxï¼›ï¼ˆ2ï¼‰in ax, dx; å…¶ä¸­ al å’Œ ax ç”¨æ¥å­˜å‚¨ä»ç«¯å£è·å–çš„æ•°æ®ï¼Œdx æ˜¯æŒ‡ç«¯å£å·ç›®çš„æ“ä½œæ•°æ˜¯ç”¨ alï¼Œè¿˜æ˜¯ axï¼Œå–å†³äº dx ç«¯å£æŒ‡ä»£çš„å¯„å­˜å™¨æ˜¯ 8 ä½å®½åº¦ï¼Œè¿˜æ˜¯ 16 ä½å®½åº¦ï¼ˆ1ï¼‰out dx, alï¼›ï¼ˆ2ï¼‰out dx,axï¼›ï¼ˆ3ï¼‰out ç«‹å³æ•°, alï¼›ï¼ˆ4ï¼‰out ç«‹å³æ•°, ax; æ˜¾å¡æ¦‚è¿°mbrè¿è¡Œåœ¨å®æ¨¡å¼ä¸‹ï¼Œå®æ¨¡å¼ä¸‹æ‰æœ‰ä¸­æ–­å‘é‡è¡¨ï¼Œå°†æ¥è¿è¡Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹å°±ä¸èƒ½è°ƒç”¨BIOSä¸­æ–­0x10æ‰“å°å­—ç¬¦ä¸² æ˜¾å­˜ï¼Œæ˜¾å¡ï¼Œæ˜¾ç¤ºå™¨æ˜¾å¡çš„å·¥ä½œï¼šä¸æ–­è¯»å–æ˜¾å­˜ä¸­çš„å†…å®¹ï¼Œå‘é€åˆ°å±å¹•ä¸Š æ ¹æ®ASCLLç¼–ç å¾€æ˜¾ç¤ºå±å†™å…¥å­—ç¬¦ æŒ‡ä»¤ä¸­çš„åœ°å€ç”±åœ°å€æ€»çº¿å¯»å€ï¼ŒæŒ‡å‘æŸä¸ªä»‹è´¨ï¼Œè€Œä¸æ˜¯éƒ½é€šè¿‡å†…å­˜æ¡ æ˜¾å¡é»˜è®¤æ–‡æœ¬æ¨¡å¼ä¸º80*25 ä¸€å±å¯ä»¥æ‰“å°2000ä¸ªå­—ç¬¦ï¼Œä¸€è¡Œ80ä¸ªå…±25è¡Œ æ‰“å‡ºå½©è‰²å­—ç¬¦ï¼šASCLLç ä¸€ä½ï¼Œé¢œè‰²ä¸€ä½ï¼Œé¢œè‰²RGB+I(1é«˜äº®) å¯ç”¨é¢œè‰²ï¼š æ”¹è¿›MBRï¼Œç›´æ¥æ“ä½œæ˜¾å¡mbr.S 1234567891011121314151617181920212223242526272829303132SECTION MBR vstart=0x7c00 ;æ ‡è®°ä¸€ä¸ªMBRæ®µ èµ·å§‹åœ°å€ä¸º0x7c00 mov ax, cs mov ds, ax mov es, ax mov ss, ax mov fs, ax mov sp, 0x7c00 ;æ ˆæŒ‡é’ˆèµ‹å€¼ï¼Œä»7c00å¼€å§‹ mov ax, 0xb800 ;0xb800æ˜¯æ–‡æœ¬æ¨¡å¼ä¸‹æ˜¾å­˜çš„æ®µåœ°å€ï¼Œåç»­é€šè¿‡gsè®¿é—®æ˜¾å­˜ mov gs, axmov ax, 0x600 ;æ»šåŠ¨çª—å£mov bx, 0x700 ;é»‘åº•ç™½å­—mov cx, 0 ;å·¦ä¸Šè§’è¡Œåˆ—åæ ‡ (0,0)mov dx, 0x184f ;å³ä¸‹è§’è¡Œåˆ—åæ ‡ (80,25)int 10h ;è°ƒç”¨ BIOS çš„ INT 10H ä¸­æ–­æ¥æ¸…å±mov byte [gs:0x00],&#x27;1&#x27; ;ç›´æ¥å‘æ˜¾å­˜å†™å…¥æ•°æ®ï¼ŒASCLLç +å±æ€§mov byte [gs:0x01],0xA4mov byte [gs:0x02],&#x27; &#x27;mov byte [gs:0x03],0xA4mov byte [gs:0x04],&#x27;M&#x27;mov byte [gs:0x05],0xA4mov byte [gs:0x06],&#x27;B&#x27;mov byte [gs:0x07],0xA4mov byte [gs:0x08],&#x27;R&#x27;mov byte [gs:0x09],0xA4jmp $ ;æ— é™å¾ªç¯times 510-($-$$) db 0 ;å¡«å……å‰©ä½™ç©ºé—´db 0x55,0xaa ;ç»“æŸæ ‡å¿— 123nasm -o mbr.bin mbr.Sdd if=/root/tutuos/mbr.bin of=/root/tutuos/bochs-2.8-installed/hd60M.img bs=512 count=1 conv=notruncbin/bochs -f bochsrc.disk -q bochsè°ƒè¯•æ–¹æ³•bochsä¸€èˆ¬ç”¨æ³•","categories":[{"name":"å››å¤§ä»¶","slug":"å››å¤§ä»¶","permalink":"http://example.com/categories/%E5%9B%9B%E5%A4%A7%E4%BB%B6/"}],"tags":[]},{"title":"shellè„šæœ¬","slug":"source/å·¥å…·-ç¯å¢ƒ/shellè„šæœ¬","date":"2025-03-01T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/03/02/source/å·¥å…·-ç¯å¢ƒ/shellè„šæœ¬/","permalink":"http://example.com/2025/03/02/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/shell%E8%84%9A%E6%9C%AC/","excerpt":"","text":"shellï¼šå‘½ä»¤è¡Œè§£é‡Šå™¨-æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤-è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸å»æ‰§è¡Œ-è¿”å›ç»“æœ è¿è¡Œç¯å¢ƒï¼šlinux-bash windows-powershell åˆ‡æ¢shellç‰ˆæœ¬ vi hello.sh çº¦å®šä»¥shï¼Œå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•æˆ–è€…æ²¡æœ‰ 12345#!/bin/bash#è¡¨ç¤ºè¿™ä¸ªè„šæœ¬ä½¿ç”¨çš„æ˜¯Bashè§£é‡Šå™¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œå¯ä»¥æ›¿æ¢æˆæƒ³ç”¨çš„è·¯å¾„echo &quot;hello&quot;datewhoami è¿è¡Œè„šæœ¬ bash hello.sh .&#x2F;hello.sh è¿™ç§æ–¹å¼éœ€è¦æƒé™ chmod +x hello.sh æ·»åŠ æ‰§è¡Œæƒé™ ä½¿ç”¨å‚æ•° 12345bash hello.sh param1 param2$0 $1read name#æ§åˆ¶å°è¯»å–name=$0#ä½¿ç”¨å‚æ•°echo&quot;$name&quot; 123name=jokeer#ä¼šè¯å˜é‡export name=joker#ç¯å¢ƒå˜é‡ï¼Œè„šæœ¬ä¸­å¯ä»¥ä½¿ç”¨ ä½†æ˜¯æ¨å‡ºä¼šè¯å°±å¤±æ•ˆäº†~ä¸‹ ls -a æŸ¥çœ‹éšè—æ–‡ä»¶ ~ä¸‹ ls -a æŸ¥çœ‹éšè—æ–‡ä»¶ .profile .bashrc(æ¨è)éƒ½å¯ä»¥ç”¨æ¥å­˜å‚¨ç¯å¢ƒå˜é‡ å°†export name&#x3D;jokeræ·»åŠ åˆ°æœ€åå°±å¯ä»¥äº† source .bashrc æˆ– . .bashrc æˆ– é‡æ–°ç™»å½•ä¼šè¯ ä½¿ç”Ÿæ•ˆ .bashrc è¿˜å­˜æœ‰ä¸€äº›ç®€åŒ–å‘½ä»¤ ç”Ÿæˆéšæœºæ•° shuf -i 1-10 -n 1 è¾“å‡ºä¸€ä¸ª1-10çš„éšæœºæ•° å†™è¿›sh 12345678910111213num=&#x27;shuf -i 1-10 -n 1&#x27;æˆ–num=$(shuf -i 1-10 -n 1) #(æ¨è)read guessif [[$guess -eq $num]]; then #-ltå°äº -gtå¤§äº echo &quot;yes&quot;else echo &quot;no&quot;fiwhile [[$guess -ne $num]]#å¾ªç¯ ä¸Šé¢çš„åˆ¤æ–­æ”¾è¿›å»å°±è¡Œäº† trueä¸éœ€è¦[[]]do done $RANDOMç”Ÿæˆ0-32767çš„éšæœºæ•° $((RANDOM % 10 + 1))","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"shell","slug":"shell","permalink":"http://example.com/tags/shell/"}]},{"title":"OpenCV","slug":"source/åº“/OpenCV","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.388Z","comments":true,"path":"2025/03/02/source/åº“/OpenCV/","permalink":"http://example.com/2025/03/02/source/%E5%BA%93/OpenCV/","excerpt":"","text":"ä¸‹è½½ msvcç¼–è¯‘çš„ç‰ˆæœ¬ å®˜ç½‘ï¼šhttps://opencv.org/releases/ ä¸‹è½½windowsç‰ˆæœ¬ ç¯å¢ƒå˜é‡Path C:\\APP\\opencv\\build\\x64\\vc16\\bin MinGWç¼–è¯‘ç‰ˆ https://github.com/huihut/OpenCV-MinGW-Build ä¸‹è½½ ç¯å¢ƒå˜é‡ C:\\APP\\OpenCV-MinGW-Build\\x64\\mingw\\bin Qtä¸­ä½¿ç”¨OpenCVæ•™ç¨‹ï¼šhttps://blog.csdn.net/kdnnnd/article/details/132840038 æŸ¥çœ‹qtä¸­ä½¿ç”¨çš„ç¼–è¯‘å™¨æ˜¯ä»€ä¹ˆï¼Œæˆ‘ç”¨çš„æ˜¯MinGW proæ–‡ä»¶å†™å…¥å†…å®¹ 1234INCLUDEPATH+= C:\\APP\\OpenCV-MinGW-Build\\include\\ C:\\APP\\OpenCV-MinGW-Build\\include\\opencv2LIBS+=C:\\APP\\OpenCV-MinGW-Build\\x64\\mingw\\bin\\libopencv_*.dll æµ‹è¯• 1234567891011#include &lt;QCoreApplication&gt;#include &quot;opencv2/opencv.hpp&quot;int main(int argc, char *argv[])&#123; QCoreApplication a(argc, argv); using namespace cv; Mat image=imread(&quot;C:/MY/Qt-project/yun1/Default.jpg&quot;); imshow(&quot;Output&quot;,image); return a.exec();&#125; MSVCç¼–è¯‘å™¨åˆ™ä¸º 1234567INCLUDEPATH +=C:\\OpenCV_s\\opencv_vc\\opencv\\build\\include\\ C:\\OpenCV_s\\opencv_vc\\opencv\\build\\include\\opencv\\ C:\\OpenCV_s\\opencv_vc\\opencv\\build\\include\\opencv2LIBS +=C:\\OpenCV_s\\opencv_vc\\opencv\\build\\x64\\vc15\\lib\\opencv_world3414.lib æˆ– C:\\OpenCV_s\\opencv_vc\\opencv\\build\\x64\\vc15\\lib\\opencv_world3414d.libæ³¨æ„: opencv_world3414d.lib ä¸ºdebugç‰ˆ,opencv_world3414.libä¸ºreleaseç‰ˆ","categories":[{"name":"åº“","slug":"åº“","permalink":"http://example.com/categories/%E5%BA%93/"}],"tags":[]},{"title":"æŠ€æœ¯è¿è¥","slug":"source/é¢è¯•/æŠ€æœ¯è¿è¥","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2025/03/02/source/é¢è¯•/æŠ€æœ¯è¿è¥/","permalink":"http://example.com/2025/03/02/source/%E9%9D%A2%E8%AF%95/%E6%8A%80%E6%9C%AF%E8%BF%90%E8%90%A5/","excerpt":"","text":"å¯¹æŠ€æœ¯è¿è¥çš„çœ‹æ³•ï¼Ÿ ä¿éšœæŠ€æœ¯ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œï¼Œæ¨åŠ¨ä¸šåŠ¡çš„å‘å±•å’Œåˆ›æ–°ï¼Œè´Ÿè´£æœåŠ¡å™¨ç»´æŠ¤ã€ç½‘ç»œç®¡ç†ã€æ•°æ®åº“ä¼˜åŒ–ç­‰åŸºç¡€å·¥ä½œï¼Œç¡®ä¿æ•´ä¸ªæŠ€æœ¯æ¶æ„çš„ç¨³å®šå¯é ï¼Œä¼˜åŒ–ä¸šåŠ¡æµç¨‹ç­‰ã€‚ ç³»ç»Ÿè¿ç»´ä¸ç›‘æ§ æŠ€æœ¯æ”¯æŒä¸ä¼˜åŒ– æ•°æ®ç®¡ç†ä¸åˆ†æ æŠ€æœ¯èƒ½åŠ›ï¼šåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€ç½‘ç»œæŠ€æœ¯ã€æ•°æ®åº“ç®¡ç†ã€ç¼–ç¨‹è¯­è¨€ç­‰æ–¹é¢çš„çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œè¦ç†Ÿç»ƒæŒæ¡ Linux ç³»ç»Ÿçš„æ“ä½œå’Œç®¡ç†ï¼Œèƒ½å¤Ÿä½¿ç”¨ Python ç­‰ç¼–ç¨‹è¯­è¨€è¿›è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™ æ²Ÿé€šèƒ½åŠ›è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œä¿è¯ä¸šåŠ¡è¿ç»­ï¼Œæå‡ä¸šåŠ¡æ•ˆç‡ ä½ éƒ½ç”¨è¿‡å“ªäº›Linuxå¼€æºç¨‹åº vim docker nginx mysql PostgreSQL apache äº†è§£è¿‡nginxå—ï¼Ÿ Nginx æ˜¯ä¸€æ¬¾è½»é‡çº§çš„é«˜æ€§èƒ½ Web æœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ä»¥åŠç”µå­é‚®ä»¶ï¼ˆIMAP&#x2F;POP3ï¼‰ä»£ç†æœåŠ¡å™¨ http æœåŠ¡å™¨ï¼šå¤„ç†é™æ€èµ„æº åå‘ä»£ç†ï¼šå°†è¯·æ±‚è½¬å‘åˆ°çœŸå®çš„æœåŠ¡å™¨ è´Ÿè½½å‡è¡¡ï¼šè½®è¯¢ã€åŠ æƒè½®è¯¢ã€IPå“ˆå¸Œï¼Œæœ€å°‘è¿æ¥ï¼Œéšæœº SSL&#x2F;TLS åŠ å¯† ä½¿ç”¨apacheè¿‡ç¨‹ä¸­é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆåˆ†æçš„ ps -ef | grep httpd å‘ç°apacheè¿›ç¨‹è¿‡å¤šæˆ–è€…æ ¹æœ¬æ— æ³•å¯åŠ¨ å‚æ•°é…ç½®è¿‡å¤§ï¼šMaxClients MaxRequestWorkers å†…å­˜æ³„æ¼ï¼šæŸäº› Apache æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹æ’ä»¶å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå¯¼è‡´è¿›ç¨‹ä¸æ–­å ç”¨å†…å­˜ï¼Œä½¿ç”¨ç³»ç»Ÿç›‘æ§å·¥å…·ï¼Œå¦‚ topã€htop æˆ– vmstat ç­‰ï¼Œè§‚å¯Ÿ Apache è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å¦‚æœå‘ç°æŸä¸ªè¿›ç¨‹çš„å†…å­˜å ç”¨æŒç»­å¢é•¿ï¼Œå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ æœåŠ¡å™¨çš„ CPUã€å†…å­˜ã€ç£ç›˜ I&#x2F;O ç­‰èµ„æºä¸è¶³ï¼ŒApache å¤„ç†è¯·æ±‚è¿‡äºå¤æ‚ï¼Œæˆ–è€…å­˜åœ¨æ­»å¾ªç¯ä½¿CPUä½¿ç”¨è¿‡é«˜ï¼Œå¦‚æœç£ç›˜ I&#x2F;O è¿‡é«˜ï¼Œå¯èƒ½æ˜¯æ—¥å¿—æ–‡ä»¶å†™å…¥é¢‘ç¹æˆ–ç£ç›˜æ€§èƒ½ä¸ä½³ ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œé¡µé¢åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå“åº”ç¼“æ…¢ æœåŠ¡å™¨çš„ç¡¬ä»¶èµ„æºä¸è¶³ï¼Œå¦‚ CPU æ€§èƒ½ä½ä¸‹ã€å†…å­˜ä¸è¶³ã€ç£ç›˜ I&#x2F;O ç¼“æ…¢ç­‰ï¼Œä½¿ç”¨ç³»ç»Ÿç›‘æ§å·¥å…·ï¼Œå¦‚ topã€htopã€iostat ç­‰ ç½‘ç»œå¸¦å®½ä¸è¶³ã€ç½‘ç»œå»¶è¿Ÿé«˜ã€ç½‘ç»œä¸¢åŒ…ç­‰é—®é¢˜ï¼Œping traceroute ifconfig Apache é…ç½®ä¸åˆç†ï¼šApache çš„ä¸€äº›é…ç½®å‚æ•°ï¼Œå¦‚ KeepAliveã€Timeout ç­‰ï¼Œè®¾ç½®ä¸åˆç†ï¼Œä¼šå½±å“æœåŠ¡å™¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜ï¼Œå¦‚æœç½‘ç«™ä½¿ç”¨äº†åŠ¨æ€è„šæœ¬è¯­è¨€ï¼Œå¦‚ PHPã€Python ç­‰ï¼Œåº”ç”¨ç¨‹åºæœ¬èº«çš„æ€§èƒ½é—®é¢˜ä¹Ÿä¼šå½±å“ Apache çš„è®¿é—®é€Ÿåº¦ã€‚PHP çš„ Xdebugã€Python çš„ cProfile ç­‰ï¼Œå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æ ç¼“å­˜é…ç½®ä¸å½“ï¼šå¦‚æœç½‘ç«™æ²¡æœ‰åˆç†é…ç½®ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°ç”Ÿæˆé¡µé¢å†…å®¹ï¼Œä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œå¯¼è‡´è®¿é—®é€Ÿåº¦å˜æ…¢ã€‚æ£€æŸ¥ç¼“å­˜é…ç½®ï¼Œæ˜¯å¦å¯ç”¨äº† mod_cacheæ¨¡å—ï¼Œæ˜¯å¦è®¾ç½®äº†åˆç†çš„ç¼“å­˜è§„åˆ™ tcpè¿æ¥æ•° netstat -ant | grep ESTABLISHED | wc -l ss -ant | grep ESTABLISHED | wc -l Windowsï¼š netstat -an | findstr &#x2F;i â€œESTABLISHEDâ€ | find &#x2F;c &#x2F;v â€œâ€ ä¸€ä¸ªå°æ—¶å†…çš„æ¯ä¸ªipè®¿é—®æœåŠ¡å™¨çš„æ•°ç›® nginxæˆ–apacheçš„æ—¥å¿—æ–‡ä»¶ï¼Œä½¿ç”¨grepè¿›è¡Œç­›é€‰ç»Ÿè®¡ ç”¨è¿‡awkå—ï¼Ÿå¦‚æœæˆ‘è¦æ›¿æ¢æ–‡ä¸­å­—ç¬¦ï¼Œè¡Œé—´ç”¨tabåˆ†å‰²ï¼Œç”¨awkæ€ä¹ˆè§£å†³ï¼Ÿ awk æ›¿æ¢å’Œæå–ï¼Œawk â€˜{gsub(&#x2F;apple&#x2F;, â€œgrapeâ€); print}â€™ OFS&#x3D;â€™\\tâ€™ data.txt æ›¿æ¢å‡½æ•°gsub 8.ä¸€è¡Œå‘½ä»¤æ›¿æ¢æ‰€æœ‰ä¸­æ–‡ï¼Œä¸ä½¿ç”¨awk sed â€˜s&#x2F;hello&#x2F;hi&#x2F;gâ€™ example.txt sedæµç¼–è¾‘å™¨ï¼Œå°†æ‰€æœ‰helloæ›¿æ¢ä¸ºhi ç»™ä¸€ä¸ªPIDï¼Œè¿”å›è¿›ç¨‹æ–‡ä»¶çš„ä½ç½® readlink &#x2F;proc&#x2F;&#x2F;exe æ€ä¹ˆè·å–Linuxç³»ç»Ÿå½“å‰çš„æ‰€æœ‰çŠ¶æ€ï¼ˆCPUï¼Œå†…å­˜ï¼Œç¡¬ç›˜å‰©ä½™ç­‰ï¼‰ cpuï¼štop&#x2F;htop m mpstat -P ALL å†…å­˜ï¼š free -h vmstat 1 ç¡¬ç›˜ï¼šdf -h du -sh &#x2F;path&#x2F;to&#x2F;directory&#x2F;* æ–‡ä»¶æˆ–ç›®å½•çš„ä½¿ç”¨é‡ lvm é€»è¾‘å·ç®¡ç†å™¨ï¼Œç£ç›˜åˆ†åŒºç®¡ç†ï¼Œlvmå¯ä»¥åŠ¨æ€è°ƒæ•´é€»è¾‘å·å¤§å° é” æ•°æ®åº“é”ï¼šè¡Œçº§é” åœ¨äº‹åŠ¡æŸ¥è¯¢ç»“æœé›†ä¸ŠåŠ ï¼Œè¿™äº›æ•°æ®æ— æ³•è¢«åˆ é™¤ï¼Œä¿®æ”¹ï¼Œç›´åˆ°äº‹åŠ¡é‡Šæ”¾ è¡¨çº§é”ï¼šæ•´ä¸ªè¡¨åŠ é”ï¼Œæ•°æ®å¤‡ä»½ï¼Œå¯¼å…¥å¯¼å‡º é¡µçº§é”ï¼š å…±äº«é”ï¼šå¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶åŠ ï¼ŒåŠ äº†é”çš„æ— æ³•ä¿®æ”¹ æ’ä»–é”ï¼šå…¶ä»–äº‹åŠ¡æ— æ³•åœ¨å…¶åŸºç¡€ä¸ŠåŠ é”ï¼ŒæŒæœ‰è€…å¯ä»¥ä¿®æ”¹ æ„å‘é”ï¼šä¸ºäº†åœ¨è¿›è¡Œè¡¨çº§é”æ“ä½œæ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿåˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰è¡Œæˆ–é¡µå·²ç»è¢«åŠ é”ï¼Œä»è€Œé¿å…å…¨è¡¨æ‰«æã€‚ äº’æ–¥é”ï¼šmutex è¯»å†™é”ï¼šå¯ä»¥åŒæ—¶æŒæœ‰è¯»é”ï¼Œä½†æ˜¯æœ‰äººæŒæœ‰å†™é”æ—¶å…¶ä»–äººä¸èƒ½æŒæœ‰è¯»é” è‡ªæ—‹é”ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–è‡ªæ—‹é”æ—¶ï¼Œå¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œè€Œæ˜¯ä¼šä¸æ–­åœ°å¾ªç¯æ£€æŸ¥é”æ˜¯å¦è¢«é‡Šæ”¾ linuxä¿¡å· åœ¨linuxä¸‹æœ‰å¾ˆå¤šä¿¡å·ï¼ŒæŒ‰å¯é æ€§åˆ†ä¸ºå¯é ä¿¡å·å’Œéå¯é ä¿¡å·ï¼ŒæŒ‰æ—¶é—´åˆ†ä¸ºå®æ—¶ä¿¡å·å’Œéå®æ—¶ä¿¡å·ï¼Œlinuxè¿›ç¨‹ä¹Ÿæœ‰ä¸‰ç§æ–¹å¼æ¥å¤„ç†æ”¶åˆ°çš„ä¿¡å·ï¼š ï¼ˆ1ï¼‰å¿½ç•¥ä¿¡å·ï¼Œå³å¯¹ä¿¡å·ä¸åšä»»ä½•å¤„ç†ï¼Œå…¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¿¡å·ä¸èƒ½å¿½ç•¥ï¼šSIGKILLåŠSIGSTOPï¼› ï¼ˆ2ï¼‰æ•æ‰ä¿¡å·ã€‚å®šä¹‰ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“ä¿¡å·å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†å‡½æ•°ï¼› ï¼ˆ3ï¼‰æ‰§è¡Œç¼ºçœæ“ä½œï¼ŒLinuxå¯¹æ¯ç§ä¿¡å·éƒ½è§„å®šäº†é»˜è®¤æ“ä½œã€‚ å¸¸è§çš„ä¿¡å·ï¼š â‘  SIGINT (2) ç¨‹åºç»ˆæ­¢(interrupt)ä¿¡å·ï¼Œåœ¨ç”¨æˆ·é”®å…¥INTRå­—ç¬¦(é€šå¸¸æ˜¯Ctrl + C)æ—¶å‘å‡ºã€‚ â‘¡ SIGQUIT (3) å’ŒSIGINTç±»ä¼¼ï¼Œä½†ç”±QUITå­—ç¬¦(é€šå¸¸æ˜¯Ctrl + )æ¥æ§åˆ¶ã€‚è¿›ç¨‹åœ¨å› æ”¶åˆ° SIGQUITé€€å‡ºæ—¶ä¼šäº§ç”Ÿcoreæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ„ä¹‰ä¸Šç±»ä¼¼äºä¸€ä¸ªç¨‹åºé”™è¯¯ä¿¡å·ã€‚ â‘¢ SIGKILL (9) ç”¨æ¥ç«‹å³ç»“æŸç¨‹åºçš„è¿è¡Œã€‚æœ¬ä¿¡å·ä¸èƒ½è¢«é˜»å¡ã€å¤„ç†å’Œå¿½ç•¥ã€‚ â‘£ SIGTERM (15) ç¨‹åºç»“æŸ(terminate)ä¿¡å·ã€‚ä¸SIGKILLä¸åŒçš„æ˜¯è¯¥ä¿¡å·å¯ä»¥è¢«é˜»å¡å’Œå¤„ç†ã€‚é€šå¸¸ç”¨æ¥è¦æ±‚ç¨‹åºè‡ªå·±æ­£å¸¸ï¼ˆä¼˜é›…åœ°ï¼‰é€€å‡ºã€‚shellå‘½ä»¤killç¼ºçœäº§ç”Ÿè¿™ä¸ªä¿¡å·ã€‚ â‘¤ SIGSTOP (19) åœæ­¢(stopped)è¿›ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„å®ƒå’Œterminateä»¥åŠinterruptçš„åŒºåˆ«ï¼šè¯¥è¿›ç¨‹è¿˜æœªç»“æŸï¼Œåªæ˜¯æš‚åœæ‰§è¡Œã€‚æœ¬ä¿¡å·ä¸èƒ½è¢«é˜»å¡ã€å¤„ç†æˆ–å¿½ç•¥ã€‚ 16.Http çŸ­è¿æ¥å’Œé•¿è¿æ¥çš„åŒºåˆ«ï¼Œä»¥åŠå„è‡ªä½¿ç”¨çš„åœºæ™¯ï¼Œä»¥åŠé•¿è¿æ¥çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ é•¿è¿æ¥å¯ä»¥çœå»è¾ƒå¤šçš„TCPå»ºç«‹å’Œå…³é—­çš„æ“ä½œï¼Œå‡å°‘æµªè´¹ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚å¯¹äºé¢‘ç¹è¯·æ±‚èµ„æºçš„å®¢æˆ·æ¥è¯´ï¼Œè¾ƒé€‚ç”¨é•¿è¿æ¥ã€‚ è€ŒåƒWEBç½‘ç«™çš„httpæœåŠ¡ä¸€èˆ¬éƒ½ç”¨çŸ­é“¾æ¥ï¼Œå› ä¸ºé•¿è¿æ¥å¯¹äºæœåŠ¡ç«¯æ¥è¯´ä¼šè€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€ŒåƒWEBç½‘ç«™è¿™ä¹ˆé¢‘ç¹çš„æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šäº¿å®¢æˆ·ç«¯çš„è¿æ¥ç”¨çŸ­è¿æ¥ä¼šæ›´çœä¸€äº›èµ„æºï¼Œå¦‚æœç”¨é•¿è¿æ¥ï¼Œè€Œä¸”åŒæ—¶æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·éƒ½å ç”¨ä¸€ä¸ªè¿æ¥çš„è¯ï¼Œé‚£å¯æƒ³è€ŒçŸ¥å§ã€‚æ‰€ä»¥å¹¶å‘é‡å¤§ï¼Œä½†æ¯ä¸ªç”¨æˆ·æ— éœ€é¢‘ç¹æ“ä½œæƒ…å†µä¸‹éœ€ç”¨çŸ­è¿æ¥å¥½ã€‚ è¿­ä»£å’Œé€’å½’çš„åŒºåˆ«å— é€’å½’ï¼šé‡å¤è°ƒç”¨å‡½æ•°è‡ªèº«å®ç°å¾ªç¯ç§°ä¸ºé€’å½’ï¼› è¿­ä»£ï¼šåˆ©ç”¨å˜é‡çš„åŸå€¼æ¨å‡ºæ–°å€¼ç§°ä¸ºè¿­ä»£ï¼Œæˆ–ç€è¯´è¿­ä»£æ˜¯å‡½æ•°å†…æŸæ®µä»£ç å®ç°å¾ªç¯ï¼› redisåˆ†å¸ƒå¼é” åˆ†å¸ƒå¼é”æ¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæœåŠ¡å®ä¾‹èƒ½å¤Ÿè®¿é—®è¯¥èµ„æºï¼Œsetnxè®¾ç½®é”®å€¼å¯¹æ¥ä¸Šé”ï¼Œå¯ä»¥ä½¿ç”¨ Redlock ç®—æ³•æ¥æé«˜åˆ†å¸ƒå¼é”çš„å¯é æ€§ rediså¤šçº¿ç¨‹ Redis çš„å¤šçº¿ç¨‹ä¸»è¦æ˜¯ç”¨äºå¤„ç†ç½‘ç»œ I&#x2F;O ï¼Œé”®å€¼å¯¹çš„è¯»å†™æ“ä½œä»ç„¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œä¸»çº¿ç¨‹æ¥å—å¤šä¸ªè¿æ¥æ”¾å…¥é˜Ÿåˆ—ï¼ŒIOçº¿ç¨‹ä»é˜Ÿåˆ—å–å‡ºè¯·æ±‚è¿›è¡Œç½‘ç»œIO(è¯»å–è¯·æ±‚å‘é€å“åº”)ï¼Œç„¶åå°†è¯·æ±‚è¿”å›ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å¤„ç†ä¹‹åå†ç»™IOçº¿ç¨‹ï¼ŒIOçº¿ç¨‹è¿”å›ç»™å®¢æˆ·ç«¯ æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç† ä»»åŠ¡ï¼š å†…å­˜åˆ†é…ï¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…æ‰€éœ€çš„å†…å­˜ç©ºé—´ï¼Œç¡®ä¿è¿›ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚æ“ä½œç³»ç»Ÿéœ€è¦æ ¹æ®è¿›ç¨‹çš„éœ€æ±‚å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œåˆç†åœ°åˆ†é…å†…å­˜å—ã€‚ å†…å­˜å›æ”¶ï¼šå½“è¿›ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–ä¸å†éœ€è¦æŸäº›å†…å­˜ç©ºé—´æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åŠæ—¶å›æ”¶è¿™äº›å†…å­˜ï¼Œä»¥ä¾¿é‡æ–°åˆ†é…ç»™å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚ åœ°å€æ˜ å°„ï¼šå°†è¿›ç¨‹çš„é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚è¿›ç¨‹åœ¨ç¼–å†™ç¨‹åºæ—¶ä½¿ç”¨çš„æ˜¯é€»è¾‘åœ°å€ï¼Œè€Œå†…å­˜ä¸­çš„å®é™…å­˜å‚¨ä½ç½®æ˜¯ç‰©ç†åœ°å€ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å®Œæˆè¿™ä¸¤è€…ä¹‹é—´çš„æ˜ å°„ã€‚ å†…å­˜ä¿æŠ¤ï¼šé˜²æ­¢ä¸åŒè¿›ç¨‹ä¹‹é—´çš„å†…å­˜ç›¸äº’å¹²æ‰°å’Œç ´åã€‚æ¯ä¸ªè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±è¢«åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦æä¾›ç›¸åº”çš„æœºåˆ¶æ¥ç¡®ä¿å†…å­˜çš„å®‰å…¨æ€§ã€‚ å†…å­˜æ‰©å……ï¼šå½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦é€šè¿‡è™šæ‹Ÿå†…å­˜ç­‰æŠ€æœ¯ï¼Œä¸ºè¿›ç¨‹æä¾›æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œä»¥æ»¡è¶³è¿›ç¨‹çš„éœ€æ±‚ã€‚ å†…å­˜åˆ†é…ï¼š å•ä¸€è¿ç»­åˆ†é…ï¼šå°†å†…å­˜åˆ†ä¸ºç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºï¼Œç³»ç»ŸåŒºä¾›æ“ä½œç³»ç»Ÿä½¿ç”¨ï¼Œç”¨æˆ·åŒºä¾›ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ä½¿ç”¨ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå†…å­˜ä¸­åªæœ‰ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ã€‚ åˆ†åŒºåˆ†é…ï¼šå›ºå®šåˆ†åŒºåˆ†é…ï¼šå°†å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥å®¹çº³ä¸€ä¸ªè¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œè®°å½•æ¯ä¸ªåˆ†åŒºçš„ä½¿ç”¨æƒ…å†µã€‚ â€‹ åŠ¨æ€åˆ†åŒºåˆ†é…ï¼šå½“æœ‰æ–°è¿›ç¨‹éœ€è¦å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä»ç©ºé—²å†…å­˜ä¸­åˆ’åˆ†å‡ºä¸€ä¸ªåˆé€‚å¤§å°çš„åˆ†åŒºåˆ†é…ç»™è¯¥è¿›ç¨‹ åˆ†é¡µ&#x2F;æ®µå­˜å‚¨ç®¡ç†ï¼šå°†è¿›ç¨‹çš„é€»è¾‘åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„é¡µ&#x2F;æ®µï¼Œ(å°†å†…å­˜çš„ç‰©ç†åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸é¡µå¤§å°ç›¸ç­‰çš„å¸§)ã€‚é€šè¿‡é¡µ&#x2F;æ®µè¡¨ç®¡ç† æ®µé¡µå¼å­˜å‚¨ï¼ˆç°åœ¨ï¼‰ï¼šç»“åˆäº†åˆ†æ®µå­˜å‚¨ç®¡ç†å’Œåˆ†é¡µå­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹ã€‚å…ˆå°†è¿›ç¨‹çš„é€»è¾‘åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µï¼Œå†å°†æ¯ä¸ªæ®µåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µã€‚é€šè¿‡æ®µè¡¨å’Œé¡µè¡¨æ¥å®ç°é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚ å†…å­˜åˆ†é…ç®—æ³• è™šæ‹Ÿå­˜å‚¨ï¼šå°†è¿›ç¨‹çš„éƒ¨åˆ†åœ°å€ç©ºé—´å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè€Œåªå°†å½“å‰éœ€è¦çš„éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­ topké—®é¢˜ï¼Œç»´æŠ¤å°æ ¹å †çš„å¤æ‚åº¦åˆ†æï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰åˆ«çš„æ–¹æ³•å— TopK é—®é¢˜æŒ‡çš„æ˜¯ä»åŒ…å«nä¸ªå…ƒç´ çš„æ•°æ®é›†ä¸­æ‰¾å‡ºæœ€å¤§çš„kä¸ªå…ƒç´  å°æ ¹å †æ–¹æ³•ï¼šå‰kä¸ªå…ƒç´ æ„å»ºå°æ ¹å †ï¼Œé¡¶ç«¯æœ€å°ï¼Œéå†k+1ä¹‹åï¼Œæ¯”å †é¡¶å¤§å°±æ›¿æ¢ç„¶åè°ƒæ•´å †é¡¶O(nlogk) æ’åºæ³•ï¼šå¿«é€Ÿæ’åºã€å½’å¹¶æ’åºO(nlogn) æ¡¶æ’åºï¼šå‰æï¼šæ•°æ®èŒƒå›´å°ï¼Œç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åä»å¤§åˆ°å°éå†æ¡¶ï¼Œæ‰¾å‡ºæœ€å¤§çš„kä¸ªå…ƒç´ O(n+m,mæ˜¯èŒƒå›´) B+æ ‘çŸ¥é“å—ï¼Ÿè¦†ç›–ç´¢å¼•æ€ä¹ˆä¼˜åŒ–çš„ ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ ¹æ®æŸ¥è¯¢é”®å€¼ä¸èŠ‚ç‚¹ä¸­é”®å€¼çš„å¤§å°å…³ç³»ï¼Œé€‰æ‹©åˆé€‚çš„å­èŠ‚ç‚¹ç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°åˆ°è¾¾å¶å­èŠ‚ç‚¹æ‰¾åˆ°ç›®æ ‡æ•°æ®è®°å½•ã€‚ç”±äºæ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼ŒèŒƒå›´æŸ¥è¯¢æ—¶å¯ä»¥é€šè¿‡å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆé¡ºåºéå†ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚ è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œåªéœ€è¦ä»ç´¢å¼•ä¸­è·å–æ•°æ®ï¼Œè€Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼ˆå³ä¸éœ€è¦å†åˆ°æ•°æ®è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®è¡Œï¼‰ å‡å°‘ç£ç›˜IOå³å›è¡¨ å‡å°‘å†…å­˜å ç”¨ï¼Œç´¢å¼•é€šå¸¸æ¯”æ•°æ®è¡¨å°ï¼Œå‘½ä¸­ç‡æå‡ é¿å…æ’åºï¼Œb+æ•°ç´¢å¼•æœ‰åº æ•°æ®åº“éš”ç¦»çº§åˆ«ä»‹ç»ï¼ŸRRéš”ç¦»çº§åˆ«å¦‚ä½•è§£å†³è„è¯»é—®é¢˜çš„ è¯»æœªæäº¤ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ï¼Œä¼šäº§ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼Œè„è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ® è¯»å·²æäº¤ï¼šè§£å†³äº†è„è¯»é—®é¢˜ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»(å¤šæ¬¡è¯»å–çš„ç»“æœä¸åŒ)å’Œå¹»è¯»é—®é¢˜ å¯é‡å¤è¯»ï¼šå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œåœ¨æŸäº›æ•°æ®åº“ä¸­å¯èƒ½ä»ç„¶å­˜åœ¨å¹»è¯»é—®é¢˜ ä¸²è¡ŒåŒ–ï¼šåªèƒ½äº‹åŠ¡ç»“æŸæ‰èƒ½æ–°äº‹åŠ¡ RR(å¯é‡å¤è¯»)éš”ç¦»çº§åˆ«è§£å†³è„è¯»é—®é¢˜çš„åŸç†ï¼šå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶MVCC+è¡Œé”(ä¿®æ”¹æŸä¸€è¡Œæ•°æ®æ—¶åŠ é”) OSPF OSPF å³å¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼ˆOpen Shortest Path Firstï¼‰ï¼Œæ˜¯ç”¨äºåœ¨å•ä¸€è‡ªæ²»ç³»ç»Ÿï¼ˆASï¼‰å†…åŠ¨æ€åœ°å»ºç«‹ã€ç»´æŠ¤å’Œæ›´æ–°è·¯ç”±ä¿¡æ¯çš„å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ OSPF å¯ä»¥é€šè¿‡åŒºåŸŸåˆ’åˆ†æ¥ç®¡ç†ç½‘ç»œï¼Œæé«˜ç½‘ç»œçš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚ æ“ä½œç³»ç»Ÿè¿›ç¨‹é—´é€šä¿¡æ–¹å¼ç®¡é“( pipe )ï¼šç®¡é“æ˜¯ä¸€ç§åŠåŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œæ•°æ®åªèƒ½å•å‘æµåŠ¨ï¼Œè€Œä¸”åªèƒ½åœ¨å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ã€‚è¿›ç¨‹çš„äº²ç¼˜å…³ç³»é€šå¸¸æ˜¯æŒ‡çˆ¶å­è¿›ç¨‹å…³ç³»ã€‚ ä¿¡å·é‡( semophore ) ï¼š ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚å®ƒå¸¸ä½œä¸ºä¸€ç§é”æœºåˆ¶ï¼Œé˜²æ­¢æŸè¿›ç¨‹æ­£åœ¨è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿè®¿é—®è¯¥èµ„æºã€‚å› æ­¤ï¼Œä¸»è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹å†…ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µã€‚ æ¶ˆæ¯é˜Ÿåˆ—( message queue ) ï¼š æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç”±æ¶ˆæ¯çš„é“¾è¡¨ï¼Œå­˜æ”¾åœ¨å†…æ ¸ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡# è¯†ã€‚æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘ã€ç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ã€‚ å…±äº«å†…å­˜( shared memory ) ï¼šå…±äº«å†…å­˜å°±æ˜¯æ˜ å°„ä¸€æ®µèƒ½è¢«å…¶ä»–è¿›ç¨‹æ‰€è®¿é—®çš„å†…å­˜ï¼Œè¿™æ®µå…±äº«å†…å­˜ç”±ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºï¼Œä½†å¤šä¸ªè¿›ç¨‹éƒ½å¯ä»¥è®¿é—®ã€‚å…±äº«å†…å­˜æ˜¯æœ€å¿«çš„ IPC æ–¹å¼ï¼Œå®ƒæ˜¯é’ˆå¯¹å…¶ä»–è¿›ç¨‹é—´é€šä¿¡æ–¹å¼è¿è¡Œæ•ˆç‡ä½è€Œä¸“é—¨è®¾è®¡çš„ã€‚å®ƒå¾€å¾€ä¸å…¶ä»–é€šä¿¡æœºåˆ¶ï¼Œå¦‚ä¿¡å·ä¸¤ï¼Œé…åˆä½¿ç”¨ï¼Œæ¥å®ç°è¿›ç¨‹é—´çš„åŒæ­¥å’Œé€šä¿¡ã€‚ å¥—æ¥å­—( socket ) ï¼š å¥—è§£å£ä¹Ÿæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œä¸å…¶ä»–é€šä¿¡æœºåˆ¶ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ç”¨äºä¸åŒåŠå…¶é—´çš„è¿›ç¨‹é€šä¿¡ã€‚ æ•°æ®åº“ç´¢å¼• æ™®é€šç´¢å¼•ï¼Œé¢‘ç¹æŸ¥è¯¢æŸä¸ªå­—æ®µ å”¯ä¸€ç´¢å¼•ï¼Œç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚å¦‚æœæ˜¯ç»„åˆå”¯ä¸€ç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ ä¸»é”®ç´¢å¼•ï¼šä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ å…¨æ–‡ç´¢å¼•ï¼šç”¨äºå†…å®¹æœç´¢ ç»„åˆç´¢å¼•ï¼šå¤šä¸ªåˆ—ä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œæ•°æ®åº“ä¼šæ ¹æ®è¿™äº›åˆ—çš„é¡ºåºæ¥ä½¿ç”¨ç´¢å¼•ã€‚ k8s åº”ç”¨æœåŠ¡å’ŒæœåŠ¡å™¨çš„ä¸­é—´å±‚ï¼Œè…¾è®¯äº‘ä¸­å«TKEï¼Œå†™ä¸€ä»½é…ç½®æ–‡ä»¶è€Œå·²å°†åº”ç”¨è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œk8så°†æœåŠ¡å™¨åˆ†ä¸ºæ§åˆ¶å¹³é¢+å·¥ä½œèŠ‚ç‚¹nodeï¼Œæ§åˆ¶å¹³é¢å†³å®šå°†åº”ç”¨éƒ¨ç½²åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œnodeè´Ÿè´£éƒ¨ç½²å®é™…åº”ç”¨æœåŠ¡Pod,Podå¯ä»¥è‡ªåŠ¨æ”¹å˜å®¹é‡ï¼Œå¦‚ä½•è®©nodeèŠ‚ç‚¹ä¹Ÿå¼¹æ€§ä¼¸ç¼©ï¼šå†åŠ ä¸€å±‚ä¸­é—´å±‚å®ç°èŠ‚ç‚¹ä¼¸ç¼©ï¼šCA&#x2F;Kapernterï¼Œä»¥podå½¢å¼éƒ¨ç½²ç„¶åé€šè¿‡æ§åˆ¶å¹³é¢è·å–é›†ç¾¤èµ„æºçŠ¶æ€ï¼Œä¸€ä¸ªåŠ¨æ€ä¸€ä¸ªé™æ€ã€‚è¿˜èƒ½èŠ‚ç‚¹æ•´åˆï¼ŒèŠ‚ç‚¹æ›¿æ¢(å½“å‡ºç°é”™è¯¯) ä»lsæˆ–è€…cdå‘½ä»¤ä¸¾ä¾‹ï¼Œå‘½ä»¤èƒŒåå¦‚ä½•æ‰§è¡Œçš„ã€‚å¦‚ä½•ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€æ‰§è¡Œï¼Œå‘½ä»¤çš„æ•´ä½“æµç¨‹ è§£æshell forkåˆ›å»ºè¿›ç¨‹ å†…æ ¸ä¸ºæ–°è¿›ç¨‹åˆ†é…èµ„æºï¼ŒåŒ…æ‹¬å†…å­˜ç©ºé—´ã€è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ç­‰ï¼Œå¹¶å¤åˆ¶çˆ¶è¿›ç¨‹ï¼ˆShellï¼‰çš„ç›¸å…³ä¿¡æ¯ã€‚ å­è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨execve()æ¥åŠ è½½lså‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œç¨‹åº æ‰§è¡Œç³»ç»Ÿè°ƒç”¨è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚å½“æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒCPU ä¼šå°†å½“å‰è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°å†…æ ¸æ ˆä¸­ï¼Œç„¶åæ ¹æ®ç³»ç»Ÿè°ƒç”¨å·æŸ¥æ‰¾å¯¹åº”çš„å†…æ ¸å‡½æ•°ï¼Œå¹¶è·³è½¬åˆ°å†…æ ¸å‡½æ•°çš„å…¥å£åœ°å€å¼€å§‹æ‰§è¡Œã€‚ å†…æ ¸å®Œæˆæ“ä½œåï¼Œå°†ç»“æœè¿”å›ç»™lsç¨‹åºã€‚lsç¨‹åºæ¥æ”¶åˆ°ç»“æœåï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¦‚æŒ‰ç…§ä¸€å®šçš„æ ¼å¼å°†æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šã€‚ lsç¨‹åºæ‰§è¡Œå®Œæ¯•åï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨exit()ç»“æŸè¿›ç¨‹ å†…æ ¸æ€æ‰èƒ½æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ bios ROM(åªè¯»)ï¼Œç°åœ¨ä½¿ç”¨é—ªå­˜èŠ¯ç‰‡","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"æ•°æ®åº“","slug":"source/é¢è¯•/æ•°æ®åº“","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2025/03/02/source/é¢è¯•/æ•°æ®åº“/","permalink":"http://example.com/2025/03/02/source/%E9%9D%A2%E8%AF%95/%E6%95%B0%E6%8D%AE%E5%BA%93/","excerpt":"","text":"B+æ ‘å’ŒBæ ‘çš„åŒºåˆ« Bæ ‘ï¼šæ•°æ®å¯ä»¥åœ¨å†…éƒ¨èŠ‚ç‚¹ï¼Œæ’å…¥åˆ é™¤å¯èƒ½ç ´åç»“æ„é€ æˆæ›´å¤šæ“ä½œï¼Œé€‚åˆéšæœºè®¿é—®è¦æ±‚é«˜ï¼Œå¦‚æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç´¢å¼• B+æ ‘ï¼šæ•°æ®åªåœ¨å¶å­èŠ‚ç‚¹ï¼Œæ’å…¥åˆ é™¤æ›´ç®€å•ï¼Œé€‚åˆèŒƒå›´æŸ¥è¯¢å’Œé¡ºåºæŸ¥è¯¢ï¼Œå¦‚æ•°æ®åº“ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å½¢æˆåŒå‘é“¾è¡¨æ–¹ä¾¿æŸ¥æ‰¾ mysqléš”ç¦»çº§åˆ« T1äº‹åŠ¡å¯èƒ½è¯»å–åˆ°T2äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œä½†æ˜¯æœ€åT2å›æ»šäº†ï¼Œå¯¼è‡´T1è¯»å–åˆ°äº†ä¸€ä¸ªæœªå­˜åœ¨çš„æ•°æ®ï¼Œä»è€Œå¯¼è‡´è„è¯»ç°è±¡ T1åœ¨è¯»å–åŒä¸€è¡Œæ•°æ®çš„ä¸¤æ¬¡ç»“æœä¸ä¸€æ ·ï¼Œä»è€Œå¯¼è‡´ä¸å¯é‡å¤è¯»çš„é—®é¢˜ T1åœ¨æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢æˆ–èŒƒå›´ä¿®æ”¹çš„æ—¶å€™,T2æ’å…¥äº†ä¸€æ¡å±äºT1èŒƒå›´å†…çš„æ•°æ®ï¼Œå¹¶ä¸”æäº¤äº†ï¼Œè¿™ä¸ªæ—¶å€™T1æŸ¥è¯¢çš„æ—¶å€™å‘ç°å¤šäº†ä¸€æ¡æ•°æ®ï¼Œé€ æˆäº†å¹»è¯»ç°è±¡ è¯»æœªæäº¤ï¼šç›´æ¥è¯»å–æ•°æ®ç‰ˆæœ¬é“¾ä¸­çš„æœ€æ–°ç‰ˆæœ¬ è¯»å·²æäº¤ï¼šä½¿ç”¨å¿«ç…§è¯»ï¼Œå³æŒ‰ç…§MVCCè¯»å–ç¬¦åˆReadViewè¦æ±‚çš„ç‰ˆæœ¬æ•°æ®ï¼Œç”Ÿæˆå¤šä¸ªReadViewï¼Œè§£å†³äº†è„è¯» å¯é‡å¤è¯»ï¼šä½¿ç”¨å¿«ç…§è¯»ï¼Œåªä¼šåœ¨é¦–æ¬¡æŸ¥è¯¢æ—¶ç”ŸæˆReadViewï¼Œè§£å†³äº†ä¸å¯é‡å¤è¯» ä¸²è¡ŒåŒ–ï¼šè¯»å–æ—¶åŠ å…¥å…±äº«è¡¨é”ï¼Œæ›´æ–°æ—¶åŠ å…¥ç‹¬å è¡¨é”ï¼Œè§£å†³äº†å¹»è¯» Innodbé»˜è®¤æ˜¯å¯é‡å¤è¯»ï¼Œå› ä¸ºä»–éœ€è¦ä¿è¯äº‹åŠ¡ACIDç‰¹æ€§ä¸­çš„éš”ç¦»æ€§ï¼Œé€šè¿‡Next-keyé¿å…å¹»è¯» MVCCå°±æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™å¯¹æ•°æ®åº“æ‹äº†ä¸ªå¿«ç…§ï¼Œä¿ç•™äº†é‚£ä¸ªæ—¶å€™çš„çŠ¶æ€ï¼Œè¿™ä¸ªäº‹åŠ¡åç»­çš„è¯»å–éƒ½ä»å¿«ç…§ä¸­è·å–ï¼Œå“ªæ€•åŠ äº†æ–°çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“ æ„å‘é”æ„å‘é”æ˜¯ä¸€ç§ç”¨äºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå®ƒè¯•å›¾åœ¨é”å®šèµ„æºä¹‹å‰è¡¨æ˜äº‹åŠ¡å¸Œæœ›é”å®šè¯¥èµ„æºã€‚å½“ä¸€ä¸ªäº‹åŠ¡æƒ³è¦è·å¾—é”æ—¶ï¼Œæ•°æ®åº“ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨èµ„æºçš„æ„å‘é”ã€‚ å›è¡¨å›è¡¨æ˜¯æŒ‡äºŒçº§ç´¢å¼•ï¼Œä½ é€šè¿‡å½“å‰ç´¢å¼•ä¸èƒ½æŸ¥è¯¢åˆ°æƒ³è¦çš„æ•°æ®ï¼Œéœ€è¦å†æŸ¥æ‰¾ä¸€ä¸ªä¸»é”®ä¸»é”®ç´¢å¼•æ‰èƒ½æ‰¾åˆ°ã€‚é¿å…å›è¡¨çš„æ–¹æ³•ï¼šåœ¨ç´¢å¼•ä¸­åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰å­—æ®µï¼Œè¿™æ ·ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œä¸éœ€è¦å†å›åŸè¡¨ã€‚ ç´¢å¼•è¦†ç›–ä¸ç”¨å›è¡¨ mysqlé”å…¨å±€é”ï¼šåŠ é”åæ•´ä¸ªæ•°æ®åº“å®ä¾‹éƒ½å¤„äºåªè¯»çŠ¶æ€ã€‚ è¡¨é”ï¼šé”å®šæ•´å¼ è¡¨ è¡Œé”ï¼šå¹¶å‘åº¦é«˜ï¼Œä½†æ˜¯åŠ é”èµ„æºå¼€é”€æ¯”è¾ƒå¤§ï¼ŒInnodbæ”¯æŒ æ…¢æŸ¥è¯¢ä¼˜åŒ–æ˜¯å¦ç”¨äº†ç´¢å¼•ï¼Œè¯¥ç´¢å¼•æ˜¯å¦æ˜¯æœ€å·¦ç´¢å¼•æ˜¯å¦è¿”å›äº†è¿‡å¤šå­—æ®µï¼ŒæŸ¥å‡ºäº†å¤šä½™æ•°æ®æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡å¤šï¼Œæ˜¯å¦åº”è¯¥è¿›è¡Œåˆ†åº“åˆ†è¡¨æ£€æŸ¥æ•°æ®åº“å®ä¾‹æ‰€åœ¨çš„æœºå™¨æ€§èƒ½ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šåœ¨my.iniæ–‡ä»¶ä¸­ï¼Œæ…¢æŸ¥è¯¢çš„å®šä¹‰äº‹ä»¶æ˜¯è¶…è¿‡2ç§’ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æ…¢æŸ¥è¯¢çš„å®šä¹‰ä¼˜åŒ–æ•°æ®åº“ç»“æ„ï¼šåˆç†çš„æ•°æ®åº“ç»“æ„ä¸ä»…å¯ä»¥ä½¿æ•°æ®åº“å ç”¨æ›´å°çš„ç£ç›˜ç©ºé—´ï¼Œè€Œä¸”èƒ½å¤Ÿä½¿æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚å°‘ä½¿ç”¨joinè¯­å¥ï¼šæ¯”å¦‚å·¦è¿æ¥å¿…é¡»å…ˆæŸ¥å·¦è¡¨å…¨è¡¨æ‰«æï¼Œç„¶åä¸€æ¡æ¡åˆ°å¤–è¡¨å»æŸ¥è¯¢åˆ©ç”¨explainçš„keyï¼Œçœ‹çœ‹åˆ°åº•ä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼ŒæŠŠç”¨ä¸åˆ°çš„ç´¢å¼•åˆ é™¤æ‰å¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œè€ƒè™‘æ˜¯å¦æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå°½é‡å°‘ä½¿ç”¨èšåˆå‡½æ•°likeæ¨¡ç³ŠæŸ¥è¯¢çš„%ä¸å¯ä»¥æ”¾åœ¨æœ€å‰é¢ï¼Œä¸è¦ä½¿ç”¨orã€unionï¼ˆå»é‡ï¼‰ã€not inè¿™äº›æ¡ä»¶æŸ¥è¯¢ èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•éƒ½æ˜¯B+æ ‘ èšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åœ¨ä¸€å—ï¼Œæ‰¾åˆ°äº†ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ® éèšç°‡ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œå­˜å‚¨çš„æ˜¯æ•°æ®è¡Œåœ°å€ï¼Œéœ€è¦å›è¡¨ï¼Œç›¸å½“äºå­—å…¸æŸ¥è¯¢ä¸­çš„æŒ‰ç…§åæ—æŸ¥æ‰¾ Rediså’ŒMySQLå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ å»¶è¿ŸåŒåˆ ï¼šå…ˆåˆ redisï¼Œå†æ›´æ–°mysqlï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†åˆ redisï¼Œè¿™æ ·å°±ç®—åœ¨æ›´æ–°mysqlæ—¶ï¼Œæœ‰å…¶ä»–çº¿ç¨‹è¯»äº†mysqlï¼ŒæŠŠè€æ•°æ®è¯»åˆ°äº†redisä¸­ï¼Œä¹Ÿä¼šè¢«åˆ æ‰ï¼Œä»è€Œä¿è¯æ•°æ®ä¸€è‡´ ä¸€é¡µå¤šå¤§ä¸€é¡µ16kbï¼Œæ“ä½œç³»ç»Ÿä¸€é¡µ4kb","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"è®¡ç®—æœºç½‘ç»œ","slug":"source/é¢è¯•/è®¡ç®—æœºç½‘ç»œ","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T14:07:47.760Z","comments":true,"path":"2025/03/02/source/é¢è¯•/è®¡ç®—æœºç½‘ç»œ/","permalink":"http://example.com/2025/03/02/source/%E9%9D%A2%E8%AF%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","excerpt":"","text":"socketçŠ¶æ€è½¬å˜ ç‰¹æ®Šæƒ…å†µï¼šåŒæ—¶è°ƒç”¨closeï¼ŒåŒæ—¶å…ˆæ”¶åˆ°FINåŒ…çš„çŠ¶æ€ï¼šFIN_WAIT_1 -&gt; ClOSE -&gt; TIME_WAITï¼ˆå¦ä¸€ä¸ªèµ°1 2ï¼‰ï¼Œå¦‚æœåŒæ—¶æ”¶åˆ°FINåˆ™éƒ½èµ°è¿™ç§çŠ¶æ€ è¶…æ—¶æ—¶é—´ï¼š2MSL ä¸‰æ¬¡æ¡æ‰‹ ä½ èƒ½å¬åˆ°å—ï¼Ÿæˆ‘æºå¸¦äº†åºåˆ—å·(SYN),æˆ‘çš„åºåˆ—å·(seq&#x3D;x)æ˜¯x ä½ èƒ½å¬åˆ°å—ï¼Ÿæˆ‘ç¡®è®¤èƒ½å¬åˆ°(ACK&#x3D;1),æˆ‘æºå¸¦äº†åºåˆ—å·(SYN)ï¼Œæˆ‘çš„åºåˆ—å·æ˜¯(seq&#x3D;y)æ˜¯yï¼Œä¸‹ä¸€ä¸ªæ•°æ®åŒ…ç»™æˆ‘å‘é€åºåˆ—å·(ack&#x3D;x+1) æˆ‘ç¡®è®¤èƒ½å¬åˆ°(ACK&#x3D;1)ï¼Œæˆ‘çš„åºåˆ—å·æ˜¯(seq&#x3D;x+1)ï¼Œä¸‹ä¸€ä¸ªæ•°æ®åŒ…ç»™æˆ‘å‘é€åºåˆ—å·(ack&#x3D;y+1) å››æ¬¡æŒ¥æ‰‹ è¶…æ—¶æ—¶é—´ï¼š2MSLï¼Œ2MSLæ˜¯æŠ¥æ–‡å­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œç¡®è®¤æœ€åå®¢æˆ·ç«¯å‘é€çš„ACKèƒ½åˆ°è¾¾æœåŠ¡å™¨ TLS SSL TLSæ˜¯SSLæ›´å®‰å…¨çš„è¿›åŒ–ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç°åœ¨ä¸»æµã€‚TLSæ˜¯OSIæ¨¡å‹ä¸­çš„ä¼šè¯å±‚ OSIä¸ƒå±‚æ¨¡å‹ ç‰©ç†å±‚ bit æ•°æ®é“¾è·¯å±‚ å¸§ äº¤æ¢æœº&#x2F;ç½‘æ¡¥&#x2F;MAC ç½‘ç»œå±‚ æ•°æ®åŒ… è·¯ç”±å™¨&#x2F;IP ä¼ è¾“å±‚ æ®µ&#x2F;æ•°æ®æŠ¥ TCP&#x2F;UDP ä¼šè¯å±‚ æŠ¥æ–‡ TLS&#x2F;SSL ï¼ˆè´Ÿè´£å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ä¸åŒä¸»æœºä¹‹é—´çš„ä¼šè¯è¿æ¥ï¼‰ è¡¨ç¤ºå±‚ æŠ¥æ–‡ï¼ˆæ•°æ®çš„è¡¨ç¤ºå’Œè½¬æ¢ï¼‰ åº”ç”¨å±‚ æŠ¥æ–‡ HTTP&#x2F;FTP&#x2F;SMTP&#x2F;snmp ç½‘é¡µ&#x2F;æ–‡ä»¶ä¼ è¾“&#x2F;é‚®ä»¶","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"IOå¤ç”¨","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/IOå¤ç”¨","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/IOå¤ç”¨/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/IO%E5%A4%8D%E7%94%A8/","excerpt":"","text":"IOå¤ç”¨ä¸ºä»€ä¹ˆè¦å°è£…ï¼Ÿ å°è£…å„ä¸ªæ¥å£ç®€åŒ–è°ƒç”¨ï¼Œå¹¶ä¸”æ–¹ä¾¿ä½¿ç”¨waitç„¶åå¾ªç¯éå†å„ä¸ªäº‹ä»¶ï¼Œæ ¹æ®ä¸åŒçš„äº‹ä»¶å¤„ç†ä¸åŒçš„é€»è¾‘ epollå­˜å‚¨å½¢å¼ int epollFd_; æ„é€ çš„æ—¶å€™epoll_create(512) è¿”å›fdå¹¶æŒ‡å®šæœ€å¤§å¯ç›‘å¬512ä¸ªï¼Œè¾ƒæ–°çš„linuxå†…æ ¸ç”¨epoll_create1 std::vector events_; waitçš„æ—¶å€™å­˜å‚¨ç›‘å¬åˆ°çš„äº‹ä»¶ ç›‘å¬äº‹ä»¶ï¼š 123456789101112131415161718åŸºç¡€äº‹ä»¶EPOLLIN: å¯è¯»äº‹ä»¶EPOLLOUT: å¯å†™äº‹ä»¶EPOLLRDHUP: TCPè¿æ¥å¯¹ç«¯å…³é—­æˆ–è€…åŠå…³é—­EPOLLERR: é”™è¯¯äº‹ä»¶EPOLLHUP: æŒ‚èµ·äº‹ä»¶EPOLLPRI: ç´§æ€¥æ•°æ®åˆ°è¾¾äº‹ä»¶ä¿®é¥°ç¬¦EPOLLET: è¾¹ç¼˜è§¦å‘æ¨¡å¼EPOLLONESHOT: ä¸€æ¬¡æ€§è§¦å‘ï¼Œè§¦å‘åéœ€è¦é‡æ–°æ·»åŠ EPOLLWAKEUP: å½“äº‹ä»¶è§¦å‘æ—¶é˜²æ­¢ç³»ç»Ÿä¼‘çœ EPOLLEXCLUSIVE: å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨å¤šä¸ª epoll å®ä¾‹ä¸­åªæœ‰ä¸€ä¸ªä¼šè§¦å‘ï¼ˆä» Linux 4.5 å¼€å§‹æ”¯æŒï¼‰æœ€å¸¸ç”¨çš„ç»„åˆæ˜¯ï¼šEPOLLIN | EPOLLET: è¾¹ç¼˜è§¦å‘çš„è¯»äº‹ä»¶EPOLLIN | EPOLLOUT | EPOLLET: è¾¹ç¼˜è§¦å‘çš„è¯»å†™äº‹ä»¶EPOLLIN | EPOLLRDHUP: ç”¨äºæ£€æµ‹å¯¹ç«¯å…³é—­ 12345678910111213struct epoll_event&#123; uint32_t events; epoll_data_t data;&#125; __EPOLL_PACKED;typedef union epoll_data&#123; void *ptr; int fd; uint32_t u32; uint64_t u64;&#125; epoll_data_t; epoller.h123456789101112131415161718192021222324252627#ifndef EPOLLER_H#define EPOLLER_H#include &lt;sys/epoll.h&gt; //epoll_ctl()#include &lt;unistd.h&gt; // å¯¹ POSIX æ“ä½œç³»ç»Ÿ API çš„è®¿é—®#include &lt;assert.h&gt; #include &lt;vector&gt;#include &lt;errno.h&gt;class Epoller &#123;public: explicit Epoller(int maxEvent = 1024); ~Epoller(); bool AddFd(int fd, uint32_t events); bool ModFd(int fd, uint32_t events);//ä¿®æ”¹æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶ç±»å‹ bool DelFd(int fd); int Wait(int timeoutMs = -1);//ç­‰å¾…äº‹ä»¶å‘ç”Ÿå¹¶è¿”å›äº‹ä»¶çš„ä¸ªæ•° int GetEventFd(size_t i) const; uint32_t GetEvents(size_t i) const; private: int epollFd_; std::vector&lt;struct epoll_event&gt; events_; //æˆ–è€…epoll_event events[MAX_EVENT_NUMBER]; waitçš„æ—¶å€™å°±ä¼ events &#125;;#endif //EPOLLER_H epoller.cpp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &quot;epoller.h&quot;Epoller::Epoller(int maxEvent):epollFd_(epoll_create(512)), events_(maxEvent)&#123; assert(epollFd_ &gt;= 0 &amp;&amp; events_.size() &gt; 0); //epollFd_ epollçš„å®ä¾‹ vectorå­˜æ”¾æ³¨å†Œçš„ç›‘å¬äº‹ä»¶&#125;Epoller::~Epoller() &#123; close(epollFd_);&#125;bool Epoller::AddFd(int fd, uint32_t events) &#123; if(fd &lt; 0) return false; epoll_event ev = &#123;0&#125;; ev.data.fd = fd; ev.events = events; return 0 == epoll_ctl(epollFd_, EPOLL_CTL_ADD, fd, &amp;ev);&#125;bool Epoller::ModFd(int fd, uint32_t events) &#123; if(fd &lt; 0) return false; epoll_event ev = &#123;0&#125;; ev.data.fd = fd; ev.events = events; return 0 == epoll_ctl(epollFd_, EPOLL_CTL_MOD, fd, &amp;ev);&#125;bool Epoller::DelFd(int fd) &#123; if(fd &lt; 0) return false; return 0 == epoll_ctl(epollFd_, EPOLL_CTL_DEL, fd, 0);&#125;// è¿”å›äº‹ä»¶æ•°é‡int Epoller::Wait(int timeoutMs) &#123; return epoll_wait(epollFd_, &amp;events_[0], static_cast&lt;int&gt;(events_.size()), timeoutMs);&#125;//ä½¿ç”¨events_å°†å‘ç”Ÿçš„epoll_eventå­˜å…¥events_ä¸­// è·å–äº‹ä»¶çš„fdint Epoller::GetEventFd(size_t i) const &#123; assert(i &lt; events_.size() &amp;&amp; i &gt;= 0); return events_[i].data.fd;&#125;// è·å–äº‹ä»¶å±æ€§uint32_t Epoller::GetEvents(size_t i) const &#123; assert(i &lt; events_.size() &amp;&amp; i &gt;= 0); return events_[i].events;&#125; ###main.cpp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667#include &quot;epoller.h&quot;#include &lt;iostream&gt;#include &lt;cstring&gt;#include &lt;thread&gt;#include &lt;chrono&gt;void simulate_read_event(int pipe_fd) &#123; // å†™å…¥ &quot;hello&quot; åˆ°ç®¡é“ const char* message = &quot;hello&quot;; write(pipe_fd, message, strlen(message));&#125;int main() &#123; int pipe_fds[2]; if (pipe(pipe_fds) == -1) &#123; perror(&quot;pipe&quot;); return 1; &#125; Epoller epoller(10); if (!epoller.AddFd(pipe_fds[0], EPOLLIN)) &#123; std::cerr &lt;&lt; &quot;Failed to add fd to epoller&quot; &lt;&lt; std::endl; return 1; &#125; std::thread waiter([&amp;epoller]() &#123; // ç§»é™¤ &amp;pipe_fdsï¼Œå› ä¸ºä¸éœ€è¦ while (true) &#123; int n = epoller.Wait(1000); if (n &gt; 0) &#123; for (int i = 0; i &lt; n; ++i) &#123; int fd = epoller.GetEventFd(i); uint32_t evt = epoller.GetEvents(i); // æ‰“å°è§¦å‘çš„äº‹ä»¶ç±»å‹ std::cout &lt;&lt; &quot;è§¦å‘çš„äº‹ä»¶ç±»å‹: &quot;; if (evt &amp; EPOLLIN) std::cout &lt;&lt; &quot;EPOLLIN &quot;; if (evt &amp; EPOLLOUT) std::cout &lt;&lt; &quot;EPOLLOUT &quot;; if (evt &amp; EPOLLERR) std::cout &lt;&lt; &quot;EPOLLERR &quot;; if (evt &amp; EPOLLHUP) std::cout &lt;&lt; &quot;EPOLLHUP &quot;; std::cout &lt;&lt; std::endl; // è¯»å–å¹¶æ‰“å°æ•°æ® char buffer[128] = &#123;0&#125;; int bytes_read = read(fd, buffer, sizeof(buffer) - 1); if (bytes_read &gt; 0) &#123; std::cout &lt;&lt; &quot;æ”¶åˆ°æ•°æ®: &quot; &lt;&lt; buffer &lt;&lt; std::endl; &#125; return; &#125; &#125; &#125; &#125;); std::thread simulator([&amp;pipe_fds]() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(500)); simulate_read_event(pipe_fds[1]); &#125;); simulator.join(); waiter.join(); close(pipe_fds[0]); close(pipe_fds[1]); return 0;&#125; è¿™é‡Œæ˜¯ä½¿ç”¨çš„ç®¡é“æ¥ä½¿ç”¨çš„epoll å½“ç®¡é“çš„å†™ç«¯å¾€å†…æ ¸ç¼“å†²åŒº64KBå†™å…¥æ•°æ®æ—¶ï¼Œè¯»ç«¯è§¦å‘EPOLLINä¿¡å·ï¼Œç„¶åæ‰“å°æ•°æ® è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘æ°´å¹³è§¦å‘ï¼šLT é»˜è®¤ åªè¦æœ‰æ•°æ®(æ²¡æœ‰è¢«å¤„ç†å®Œ)å°±ä¸€ç›´è§¦å‘ è¾¹ç¼˜è§¦å‘ETã€‚æ»¡è¶³æ¡ä»¶çš„æ—¶å€™è§¦å‘(åªè§¦å‘ä¸€æ¬¡) å¿…é¡»ä¸€æ¬¡æ€§è¯»å–å®Œæ‰€æœ‰æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨å¾ªç¯è¯»å–ä¿è¯å–å®Œï¼Œå¿…é¡»è®¾ç½®éé˜»å¡æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œé€‚åˆé«˜å¹¶å‘ ä¸ºä»€ä¹ˆETéœ€è¦è®¾ç½®éé˜»å¡æ¨¡å¼ï¼Ÿ å¦‚æœä¸è®¾ç½®éé˜»å¡æ¨¡å¼ï¼Œä¼šåœ¨å¾ªç¯è¯»å–æ•°æ®çš„æ—¶å€™ä¸ä¼šè®¾ç½®errno &#x3D;&#x3D; EAGAIN || errno &#x3D;&#x3D; EWOULDBLOCKï¼Œreadçš„æ—¶å€™ä¼šä¸€ç›´é˜»å¡ç­‰å¾…æ–°æ•°æ® å¦‚ä½•ä½¿ç”¨ET 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889#include &quot;epoller.h&quot;#include &lt;iostream&gt;#include &lt;cstring&gt;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;fcntl.h&gt;void SetNonBlocking(int fd) &#123; int flags = fcntl(fd, F_GETFL); flags |= O_NONBLOCK; fcntl(fd, F_SETFL, flags);&#125;void simulate_read_event(int pipe_fd) &#123; const char* message = &quot;hello&quot;; write(pipe_fd, message, strlen(message));&#125;int main() &#123; int pipe_fds[2]; if (pipe(pipe_fds) == -1) &#123; perror(&quot;pipe&quot;); return 1; &#125; // è®¾ç½®éé˜»å¡æ¨¡å¼ SetNonBlocking(pipe_fds[0]); Epoller epoller(10); // ä½¿ç”¨ETæ¨¡å¼ if (!epoller.AddFd(pipe_fds[0], EPOLLIN | EPOLLET)) &#123; std::cerr &lt;&lt; &quot;Failed to add fd to epoller&quot; &lt;&lt; std::endl; return 1; &#125; std::thread waiter([&amp;epoller]() &#123; while (true) &#123; int n = epoller.Wait(1000); if (n &gt; 0) &#123; for (int i = 0; i &lt; n; ++i) &#123; int fd = epoller.GetEventFd(i); uint32_t evt = epoller.GetEvents(i); std::cout &lt;&lt; &quot;è§¦å‘çš„äº‹ä»¶ç±»å‹: &quot;; if (evt &amp; EPOLLIN) std::cout &lt;&lt; &quot;EPOLLIN &quot;; if (evt &amp; EPOLLOUT) std::cout &lt;&lt; &quot;EPOLLOUT &quot;; if (evt &amp; EPOLLERR) std::cout &lt;&lt; &quot;EPOLLERR &quot;; if (evt &amp; EPOLLHUP) std::cout &lt;&lt; &quot;EPOLLHUP &quot;; std::cout &lt;&lt; std::endl; // ETæ¨¡å¼ä¸‹çš„è¯»å–å¾ªç¯ while (true) &#123; char buffer[128] = &#123;0&#125;; int bytes_read = read(fd, buffer, sizeof(buffer) - 1); if (bytes_read &lt; 0) &#123; if (errno == EAGAIN || errno == EWOULDBLOCK) &#123; // æ•°æ®è¯»å–å®Œæ¯• break; &#125; // å¤„ç†å…¶ä»–é”™è¯¯ perror(&quot;read error&quot;); break; &#125; else if (bytes_read == 0) &#123; // è¿æ¥å…³é—­ std::cout &lt;&lt; &quot;è¿æ¥å…³é—­&quot; &lt;&lt; std::endl; break; &#125; std::cout &lt;&lt; &quot;æ”¶åˆ°æ•°æ®: &quot; &lt;&lt; buffer &lt;&lt; std::endl; &#125; return; // å®Œæˆä¸€æ¬¡è¯»å–åé€€å‡º &#125; &#125; &#125; &#125;); std::thread simulator([&amp;pipe_fds]() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(500)); simulate_read_event(pipe_fds[1]); &#125;); simulator.join(); waiter.join(); close(pipe_fds[0]); close(pipe_fds[1]); return 0;&#125; tcpç›‘å¬å¥—æ¥å­—æ³¨å†Œ EPOLLIN | EPOLLET è¿æ¥å¥—æ¥å­—æ³¨å†Œ EPOLLIN | EPOLLET æ ¹æ®éœ€è¦å¯ä»¥åŠ ä¸ŠEPOLLOUT å…³é—­å’Œé”™è¯¯&#x3D;&#x3D;EPOLLIN&#x3D;&#x3D;ï¼š å¯¹ç«¯å…³é—­æ—¶ä¼šè§¦å‘ read() è¿”å› 0 è¡¨ç¤ºå¯¹ç«¯å…³é—­ &#x3D;&#x3D;EPOLLRDHUP&#x3D;&#x3D;ï¼š å¯¹ç«¯å…³é—­è¿æ¥æ—¶è§¦å‘ éœ€è¦åœ¨æ³¨å†Œæ—¶æŒ‡å®šæ­¤äº‹ä»¶ &#x3D;&#x3D;EPOLLHUP&#x3D;&#x3D;ï¼š è¡¨ç¤ºç®¡é“å†™ç«¯è¢«å…³é—­ ä¸éœ€è¦ç‰¹åˆ«æ³¨å†Œï¼Œä¼šè‡ªåŠ¨è§¦å‘ &#x3D;&#x3D;EPOLLERR&#x3D;&#x3D;ï¼š å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ ä¸éœ€è¦ç‰¹åˆ«æ³¨å†Œï¼Œä¼šè‡ªåŠ¨è§¦å‘ selectã€poll å’Œ epoll åŒºåˆ«12345678910 select poll epoll-----------------------------------------------------------------æ“ä½œæ–¹å¼ éå† éå† å›è°ƒåº•å±‚å®ç° æ•°ç»„ é“¾è¡¨ çº¢é»‘æ ‘æœ€å¤§è¿æ¥æ•° 1024 æ— é™åˆ¶ æ— é™åˆ¶fdæ‹·è´ æ¯æ¬¡éƒ½éœ€è¦ æ¯æ¬¡éƒ½éœ€è¦ åªéœ€ä¸€æ¬¡è¿”å›å°±ç»ªfd éå†å…¨éƒ¨fd éå†å…¨éƒ¨fd åªæœ‰å°±ç»ªfdéå†å¤æ‚åº¦ O(n) O(n) O(1)è®¾ç½®ET å¦ å¦ æ˜¯å¹³å° å¤šå¹³å° å¤šå¹³å° Linux fd æ‹·è´æŒ‡çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„è¿‡ç¨‹ selectéœ€è¦æ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ³¨å†Œäº‹ä»¶ æ€§èƒ½å¯¹æ¯”ï¼šepoll&gt;poll&gt;select &#x3D;&#x3D;epollçš„ä¼˜åŠ¿&#x3D;&#x3D;ï¼š å†…æ ¸æ€æ“ä½œï¼Œä¸é€‚åˆçŸ­æœŸæ´»è·ƒè¿æ¥ å¯¹äºselectå’Œpollæ¥è¯´ï¼Œæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦éƒ½æ˜¯åœ¨ç”¨æˆ·æ€è¢«åŠ å…¥å…¶æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†æ•´ä¸ªé›†åˆæ‹·è´åˆ°å†…æ ¸æ€ï¼›epollåˆ™å°†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆç»´æŠ¤åœ¨å†…æ ¸æ€ï¼Œæ¯æ¬¡æ·»åŠ æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™éƒ½éœ€è¦æ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€æ˜¯å¾ˆå¤§çš„ï¼Œè€Œä¸”åœ¨æœ‰å¾ˆå¤šçŸ­æœŸæ´»è·ƒè¿æ¥çš„æƒ…å†µä¸‹ï¼Œepollå¯èƒ½ä¼šæ…¢äºselectå’Œpollç”±äºè¿™äº›å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨å¼€é”€ã€‚ åº•å±‚çº¢é»‘æ ‘ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªready lisst è¯»å–æ›´å¿«electä½¿ç”¨çº¿æ€§è¡¨æè¿°æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ–‡ä»¶æè¿°ç¬¦æœ‰ä¸Šé™ï¼›pollä½¿ç”¨é“¾è¡¨æ¥æè¿°ï¼› fdå°±ç»ªæ—¶é€šè¿‡å›è°ƒé€šçŸ¥ï¼Œæ›´å¿« selectå’Œpollçš„æœ€å¤§å¼€é”€æ¥è‡ªå†…æ ¸åˆ¤æ–­æ˜¯å¦æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªè¿™ä¸€è¿‡ç¨‹ï¼šæ¯æ¬¡æ‰§è¡Œselectæˆ–pollè°ƒç”¨æ—¶ï¼Œå®ƒä»¬ä¼šé‡‡ç”¨éå†çš„æ–¹å¼ï¼Œéå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆå»åˆ¤æ–­å„ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦æœ‰æ´»åŠ¨ï¼›epollè§¦å‘epollå›è°ƒå‡½æ•°ï¼Œæ”¾åˆ°ready listä¸­ç­‰å¾…epoll_waitè°ƒç”¨åè¢«å¤„ç†ã€‚ epollåŒæ—¶æ”¯æŒLTå’ŒETæ¨¡å¼ selectå’Œpolléƒ½åªèƒ½å·¥ä½œåœ¨ç›¸å¯¹ä½æ•ˆçš„LTæ¨¡å¼ä¸‹ã€‚ æ€»ç»“ï¼šå½“ç›‘æµ‹çš„fdæ•°é‡è¾ƒå°ï¼Œä¸”å„ä¸ªfdéƒ½å¾ˆæ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨selectå’Œpollï¼›å½“ç›‘å¬çš„fdæ•°é‡è¾ƒå¤šï¼Œä¸”å•ä½æ—¶é—´ä»…éƒ¨åˆ†fdæ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨epollä¼šæ˜æ˜¾æå‡æ€§èƒ½ã€‚","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"Linuxç¼–ç¨‹æ€»ç»“","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/Linuxç¼–ç¨‹æ€»ç»“","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/Linuxç¼–ç¨‹æ€»ç»“/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Linux%E7%BC%96%E7%A8%8B%E6%80%BB%E7%BB%93/","excerpt":"","text":"æœåŠ¡å™¨æ¡†æ¶æœåŠ¡å™¨æ¨¡å‹C&#x2F;Sæ¨¡å‹ B&#x2F;Sæ¨¡å‹ æµè§ˆå™¨æœåŠ¡å™¨æ¨¡å‹ P2Pæ¨¡å‹ æ¯ä¸ªèŠ‚ç‚¹éƒ½æ—¢æ˜¯æœåŠ¡å™¨åˆæ˜¯å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç›´æ¥ä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚ æœåŠ¡å™¨ç¼–ç¨‹æ¡†æ¶ æ¨¡å— å•ä¸ªæœåŠ¡å™¨ æœåŠ¡å™¨é›†ç¾¤ I&#x2F;Oå¤„ç†å•å…ƒ å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œè¯»å†™ç½‘ç»œæ•°æ® ä½œä¸ºæ¥å…¥æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ é€»è¾‘å•å…ƒ ä¸šåŠ¡è¿›ç¨‹ï¼Œçº¿ç¨‹ é€»è¾‘æœåŠ¡å™¨ ç½‘ç»œå­˜å‚¨å•å…ƒ æœ¬åœ°æ•°æ®åº“ï¼Œæ–‡ä»¶ï¼Œç¼“å­˜ æ•°æ®åº“æœåŠ¡å™¨ è¯·æ±‚é˜Ÿåˆ— å„å•å…ƒä¹‹é—´é€šä¿¡æ–¹å¼ å„æœåŠ¡å™¨ä¹‹é—´æ°¸ä¹…tcpè¿æ¥ ####I&#x2F;Oå¤„ç†å•å…ƒ #####I&#x2F;Oæ¨¡å‹ åœ¨I&#x2F;Oæ¨¡å‹ä¸­ï¼Œâ€œåŒæ­¥â€å’Œâ€œå¼‚æ­¥â€åŒºåˆ†çš„æ˜¯å†…æ ¸å‘åº”ç”¨ç¨‹åºé€šçŸ¥çš„æ˜¯ä½•ç§I&#x2F;Oäº‹ä»¶ï¼ˆæ˜¯å°±ç»ªäº‹ä»¶è¿˜æ˜¯å®Œæˆäº‹ä»¶ï¼‰ï¼Œä»¥åŠè¯¥ç”±è°æ¥å®ŒæˆI&#x2F;Oè¯»å†™ï¼ˆæ˜¯åº”ç”¨ç¨‹åºè¿˜æ˜¯å†…æ ¸ï¼‰ã€‚ I&#x2F;Oå¤ç”¨æŠ€æœ¯,æ¥å®ç°å¯¹ç›‘å¬socketï¼ˆlistenfdï¼‰å’Œè¿æ¥socketï¼ˆå®¢æˆ·è¯·æ±‚ï¼‰çš„åŒæ—¶ç›‘å¬ã€‚æ³¨æ„I&#x2F;Oå¤ç”¨è™½ç„¶å¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½†æ˜¯å®ƒæœ¬èº«æ˜¯é˜»å¡çš„ï¼Œå¹¶ä¸”å½“æœ‰å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦åŒæ—¶å°±ç»ªçš„æ—¶å€™ï¼Œå¦‚æœä¸é‡‡å–é¢å¤–æªæ–½ï¼Œç¨‹åºåˆ™åªèƒ½æŒ‰é¡ºåºå¤„ç†å…¶ä¸­å°±ç»ªçš„æ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ä¸ºæé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å°†åœ¨è¿™éƒ¨åˆ†é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°å¹¶å‘ï¼ˆå¤šçº¿ç¨‹å¹¶å‘ï¼‰ï¼Œä¸ºæ¯ä¸ªå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦åˆ†é…ä¸€ä¸ªé€»è¾‘å•å…ƒï¼ˆçº¿ç¨‹ï¼‰æ¥å¤„ç†ã€‚ &#x3D;&#x3D;åŒæ­¥IOå’Œå¼‚æ­¥IOçš„åŒºåˆ«&#x3D;&#x3D;ï¼š åŒæ­¥IOï¼šCPUä¸€æ—¦é‡åˆ°IOæ“ä½œï¼Œå¦‚è¯»å†™æ–‡ä»¶ã€å‘é€ç½‘ç»œæ•°æ®æ—¶ï¼Œå°±éœ€è¦ç­‰å¾…IOæ“ä½œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚è¿™ç§æƒ…å†µç§°ä¸ºåŒæ­¥IOã€‚ å¼‚æ­¥IOï¼šåªå‘å‡ºIOæŒ‡ä»¤ï¼Œå¹¶ä¸ç­‰å¾…IOç»“æœï¼Œç„¶åå°±å»æ‰§è¡Œå…¶ä»–ä»£ç äº†ã€‚ä¸€æ®µæ—¶é—´åï¼Œå½“IOè¿”å›ç»“æœæ—¶ï¼Œå†é€šçŸ¥CPUè¿›è¡Œå¤„ç†ã€‚å¼‚æ­¥IOæ¨¡å‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªIOè¯·æ±‚ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ‡æ¢çº¿ç¨‹çš„æ“ä½œå¼‚æ­¥IOæ¨¡å‹éœ€è¦ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œåœ¨æ¶ˆæ¯å¾ªç¯ä¸­ï¼Œä¸»çº¿ç¨‹ä¸æ–­åœ°é‡å¤â€œè¯»å–æ¶ˆæ¯-å¤„ç†æ¶ˆæ¯â€è¿™ä¸€è¿‡ç¨‹ï¼š 1234loop = get_event_loop()while True: event = loop.get_event() process_event(event) #####äº‹ä»¶å¤„ç†æ¨¡å¼ ######Reactoræ¨¡å¼ è¦æ±‚ä¸»çº¿ç¨‹ï¼ˆI&#x2F;Oå¤„ç†å•å…ƒï¼‰åªè´Ÿè´£ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆå¯è¯»ã€å¯å†™ï¼‰ï¼Œè‹¥æœ‰ï¼Œåˆ™ç«‹å³é€šçŸ¥å·¥ä½œçº¿ç¨‹ï¼ˆé€»è¾‘å•å…ƒï¼‰ï¼Œå°†socketå¯è¯»å¯å†™äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼Œäº¤ç»™å·¥ä½œçº¿ç¨‹å¤„ç†ã€‚ Reactorï¼ˆäº‹ä»¶åˆ†å‘å™¨ï¼‰ï¼š1. ç®¡ç†EventHandlerçš„æ³¨å†Œä¸é”€æ¯ 2. åˆ†å‘äº‹ä»¶ (æ ¹æ®Demultiplexerè¿”å›çš„æ³¨å†Œçš„äº‹ä»¶åˆ†å‘) Demultiplexerï¼ˆå¤šè·¯å¤ç”¨å™¨ ï¼š 1. åº•å±‚ç›‘å¬æœºåˆ¶ï¼ˆå¦‚selectã€pollã€epollï¼‰ EventHandlerï¼ˆäº‹ä»¶å¤„ç†å™¨ï¼‰ï¼š1. å®é™…å¤„ç†å„ç±»äº‹ä»¶çš„ç»„ä»¶ äº‹ä»¶æºï¼š1. å¯ä»¥æ˜¯Socketã€Timerã€Pipeç­‰ äº§ç”Ÿå„ç±»I&#x2F;Oäº‹ä»¶ Proactoræ¨¡å¼å°†æ‰€æœ‰çš„I&#x2F;Oæ“ä½œéƒ½äº¤ç»™ä¸»çº¿ç¨‹å’Œå†…æ ¸æ¥å¤„ç†ï¼ˆè¿›è¡Œè¯»ã€å†™ï¼‰ï¼Œå·¥ä½œçº¿ç¨‹ä»…è´Ÿè´£å¤„ç†é€»è¾‘ï¼Œå¦‚ä¸»çº¿ç¨‹è¯»å®Œæˆåusers[sockfd].read()ï¼Œé€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†å®¢æˆ·è¯·æ±‚pool-&gt;append(users + sockfd)ã€‚ Proactor Initiator: å‘èµ·å¼‚æ­¥æ“ä½œçš„åˆå§‹åŒ–å™¨ å¼‚æ­¥æ“ä½œå¤„ç†å™¨: è´Ÿè´£æäº¤å¼‚æ­¥æ“ä½œåˆ°æ“ä½œç³»ç»Ÿ æ“ä½œç³»ç»Ÿæ‰§è¡Œå®é™…çš„IOæ“ä½œ IOæ“ä½œå®Œæˆåé€šçŸ¥å®Œæˆç«¯å£ Completion Dispatcheræ¥æ”¶å®Œæˆé€šçŸ¥ åˆ†å‘ç»™å¯¹åº”çš„Completion Handler Handlerå¤„ç†å®Œæˆäº‹ä»¶å¹¶è¿”å›ç»“æœç»™åº”ç”¨ç¨‹åº æ¨¡æ‹ŸProactoræ¨¡å¼ä¸ºäº†å¯ä»¥åœ¨ä¸æ”¯æŒå¼‚æ­¥I&#x2F;Oçš„ç³»ç»Ÿä¸Šæ¨¡æ‹ŸProactoræ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¼‚æ­¥çš„æ¥å£äº† ä½¿ç”¨åŒæ­¥I&#x2F;Oæ–¹å¼æ¨¡æ‹Ÿå‡ºProactoræ¨¡å¼çš„ä¸€ç§æ–¹æ³•ï¼šä¸»çº¿ç¨‹æ‰§è¡Œæ•°æ®è¯»å†™æ“ä½œï¼Œè¯»å†™å®Œæˆä¹‹åï¼Œä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹é€šçŸ¥è¿™ä¸€â€œå®Œæˆäº‹ä»¶â€ã€‚é‚£ä¹ˆä»å·¥ä½œçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬å°±ç›´æ¥è·å¾—äº†æ•°æ®è¯»å†™çš„ç»“æœï¼Œæ¥ä¸‹æ¥è¦åšçš„åªæ˜¯å¯¹è¯»å†™çš„ç»“æœè¿›è¡Œé€»è¾‘å¤„ç†ã€‚ CompletionHandler: å®Œæˆäº‹ä»¶å¤„ç†æ¥å£ ThreadPool: æ‰§è¡ŒåŒæ­¥I&#x2F;Oçš„çº¿ç¨‹æ±  ProactorInitiator: å‘èµ·å¼‚æ­¥æ“ä½œçš„æ¥å£ Reactorå’ŒProactorçš„åŒºåˆ« I&#x2F;Oæ“ä½œå¤„ç†æ–¹å¼ Reactor: åº”ç”¨ç¨‹åºè´Ÿè´£è¿›è¡Œå®é™…çš„I&#x2F;Oæ“ä½œ Proactor: æ“ä½œç³»ç»Ÿè´Ÿè´£è¿›è¡Œå®é™…çš„I&#x2F;Oæ“ä½œ äº‹ä»¶é€šçŸ¥å†…å®¹ Reactor: é€šçŸ¥çš„æ˜¯I&#x2F;Oå°±ç»ªäº‹ä»¶ï¼ˆå¯è¯»&#x2F;å¯å†™ï¼‰ Proactor: é€šçŸ¥çš„æ˜¯I&#x2F;Oå®Œæˆäº‹ä»¶ ç¼–ç¨‹å¤æ‚åº¦ Reactor: ç›¸å¯¹ç®€å•ï¼Œç¬¦åˆåŒæ­¥ç¼–ç¨‹æ€ç»´ Proactor: è¾ƒå¤æ‚ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒå¼‚æ­¥I&#x2F;O é€‚ç”¨å¹³å° Reactor: åœ¨Linuxä¸‹åº”ç”¨å¹¿æ³›ï¼ˆå¦‚epollï¼‰ Proactor: åœ¨Windowsä¸‹åº”ç”¨å¹¿æ³›ï¼ˆå¦‚IOCPï¼‰ æ€§èƒ½ç‰¹ç‚¹ Reactor: éœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±æ‰§è¡ŒI&#x2F;Oï¼Œä¼šå ç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹ Proactor: I&#x2F;Oç”±æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºçº¿ç¨‹å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡ å®ç°ç¤ºä¾‹ Reactor: Linuxçš„epollã€selectã€poll Proactor: Windowsçš„IOCPã€Linuxçš„AIO èµ„æºæ¶ˆè€— Reactor: è¾ƒå°‘çš„ç³»ç»Ÿèµ„æº Proactor: éœ€è¦æ›´å¤šçš„ç³»ç»Ÿèµ„æºæ¥æ”¯æŒå¼‚æ­¥æ“ä½œ æ€»çš„æ¥è¯´ï¼ŒReactoræ˜¯åŒæ­¥éé˜»å¡I&#x2F;Oæ¨¡å‹ï¼Œè€ŒProactoræ˜¯å¼‚æ­¥I&#x2F;Oæ¨¡å‹ã€‚ å¹¶å‘æ¨¡å¼åœ¨å¹¶å‘æ¨¡å¼ä¸­ï¼Œâ€œåŒæ­¥â€æŒ‡çš„æ˜¯ç¨‹åºå®Œå…¨æŒ‰ç…§ä»£ç åºåˆ—çš„é¡ºåºæ‰§è¡Œï¼›â€œå¼‚æ­¥â€æŒ‡çš„æ˜¯ç¨‹åºçš„æ‰§è¡Œéœ€è¦ç”±ç³»ç»Ÿäº‹ä»¶æ¥é©±åŠ¨ã€‚å¸¸è§çš„ç³»ç»Ÿäº‹ä»¶åŒ…æ‹¬ä¸­æ–­ã€ä¿¡å·ç­‰ã€‚ å¦‚æœç¨‹åºæ˜¯IOå¯†é›†ï¼Œè€Œä¸æ˜¯è®¡ç®—å¯†é›†åˆ™éœ€è¦å¹¶å‘ å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ä¸¤ç§æ–¹å¼ ######åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ åŒæ­¥çº¿ç¨‹ç”¨äºå¤„ç†å®¢æˆ·é€»è¾‘ï¼›å¼‚æ­¥çº¿ç¨‹ç”¨äºå¤„ç†I&#x2F;Oäº‹ä»¶ å¼‚æ­¥çº¿ç¨‹ç›‘å¬åˆ°å®¢æˆ·è¯·æ±‚åï¼Œå°±å°†å…¶å°è£…æˆè¯·æ±‚å¯¹è±¡å¹¶æ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚è¯·æ±‚é˜Ÿåˆ—å°†é€šçŸ¥æŸä¸ªå·¥ä½œåœ¨åŒæ­¥æ¨¡å¼çš„å·¥ä½œçº¿ç¨‹æ¥è¯»å–å¹¶å¤„ç†è¯¥è¯·æ±‚å¯¹è±¡ åŒæ­¥æœåŠ¡å±‚ è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ ä»¥åŒæ­¥çš„æ–¹å¼å·¥ä½œ é€šå¸¸æ˜¯å¤šçº¿ç¨‹å®ç° æ’é˜Ÿå±‚ ä½œä¸ºåŒæ­¥å±‚å’Œå¼‚æ­¥å±‚ä¹‹é—´çš„ç¼“å†² é€šå¸¸ä½¿ç”¨é˜Ÿåˆ—å®ç° è§£è€¦åŒæ­¥å’Œå¼‚æ­¥æ“ä½œ å¼‚æ­¥æœåŠ¡å±‚ ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ ç®¡ç†å¼‚æ­¥IOæ“ä½œ åè°ƒå¼‚æ­¥å¤„ç†æµç¨‹ å¼‚æ­¥IOçº¿ç¨‹æ±  æ‰§è¡Œå®é™…çš„å¼‚æ­¥IOæ“ä½œ æé«˜ç³»ç»Ÿå¹¶å‘å¤„ç†èƒ½åŠ› é¿å…é˜»å¡ä¸»çº¿ç¨‹ åŠåŒæ­¥&#x2F;åŠååº”å †åœ¨æœåŠ¡å™¨ç¨‹åºä¸­ï¼Œå¦‚æœç»“åˆè€ƒè™‘ä¸¤ç§äº‹ä»¶å¤„ç†æ¨¡å¼å’Œå‡ ç§I&#x2F;Oæ¨¡å‹ï¼Œåˆ™åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼å°±å­˜åœ¨å¤šç§å˜ä½“ã€‚å…¶ä¸­æœ‰ä¸€ç§å˜ä½“ç§°ä¸ºåŠåŒæ­¥&#x2F;åŠååº”å † å¼‚æ­¥çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œç”±ä¸»çº¿ç¨‹æ¥å……å½“ã€‚å®ƒè´Ÿè´£ç›‘å¬æ‰€æœ‰socketä¸Šçš„äº‹ä»¶ã€‚å¦‚æœç›‘å¬socketä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿï¼Œå³æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°æ¥ï¼Œä¸»çº¿ç¨‹å°±æ¥å—ä¹‹ä»¥å¾—åˆ°æ–°çš„è¿æ¥socketï¼Œç„¶åå¾€epollå†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œè¯¥socketä¸Šçš„è¯»å†™äº‹ä»¶ã€‚å¦‚æœè¿æ¥socketä¸Šæœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿï¼Œå³æœ‰æ–°çš„å®¢æˆ·è¯·æ±‚åˆ°æ¥æˆ–æœ‰æ•°æ®è¦å‘é€è‡³å®¢æˆ·ç«¯ï¼Œä¸»çº¿ç¨‹å°±å°†è¯¥è¿æ¥socketæ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚æ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šï¼Œå½“æœ‰ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œå®ƒä»¬å°†é€šè¿‡ç«äº‰ï¼ˆæ¯”å¦‚ç”³è¯·äº’æ–¥é”ï¼‰è·å¾—ä»»åŠ¡çš„æ¥ç®¡æƒ ä¸»çº¿ç¨‹æ’å…¥è¯·æ±‚é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ˜¯å°±ç»ªçš„è¿æ¥socketã€‚è¿™è¯´æ˜è¯¥å›¾æ‰€ç¤ºçš„åŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼é‡‡ç”¨çš„äº‹ä»¶å¤„ç†æ¨¡å¼æ˜¯Reactoræ¨¡å¼ï¼šå®ƒè¦æ±‚å·¥ä½œçº¿ç¨‹è‡ªå·±ä»socketä¸Šè¯»å–å®¢æˆ·è¯·æ±‚å’Œå¾€socketå†™å…¥æœåŠ¡å™¨åº”ç­”ã€‚è¿™å°±æ˜¯è¯¥æ¨¡å¼çš„åç§°ä¸­â€œhalf-reactiveâ€çš„å«ä¹‰ã€‚å®é™…ä¸Šï¼ŒåŠåŒæ­¥&#x2F;åŠååº”å †æ¨¡å¼ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿçš„Proactoräº‹ä»¶å¤„ç†æ¨¡å¼ï¼Œå³ç”±ä¸»çº¿ç¨‹æ¥å®Œæˆæ•°æ®çš„è¯»å†™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹ä¸€èˆ¬ä¼šå°†åº”ç”¨ç¨‹åºæ•°æ®ã€ä»»åŠ¡ç±»å‹ç­‰ä¿¡æ¯å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç„¶åå°†å…¶ï¼ˆæˆ–è€…æŒ‡å‘è¯¥ä»»åŠ¡å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆï¼‰æ’å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚å·¥ä½œçº¿ç¨‹ä»è¯·æ±‚é˜Ÿåˆ—ä¸­å–å¾—ä»»åŠ¡å¯¹è±¡ä¹‹åï¼Œå³å¯ç›´æ¥å¤„ç†ä¹‹ï¼Œè€Œæ— é¡»æ‰§è¡Œè¯»å†™æ“ä½œäº†ã€‚ ç¼ºç‚¹ï¼š ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹å…±äº«è¯·æ±‚é˜Ÿåˆ—ã€‚ä¸»çº¿ç¨‹å¾€è¯·æ±‚é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ï¼Œæˆ–è€…å·¥ä½œçº¿ç¨‹ä»è¯·æ±‚é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œéƒ½éœ€è¦å¯¹è¯·æ±‚é˜Ÿåˆ—åŠ é”ä¿æŠ¤ï¼Œä»è€Œç™½ç™½è€—è´¹CPUæ—¶é—´ã€‚ æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·æ•°é‡è¾ƒå¤šï¼Œè€Œå·¥ä½œçº¿ç¨‹è¾ƒå°‘ï¼Œåˆ™è¯·æ±‚é˜Ÿåˆ—ä¸­å°†å †ç§¯å¾ˆå¤šä»»åŠ¡å¯¹è±¡ï¼Œå®¢æˆ·ç«¯çš„å“åº”é€Ÿåº¦å°†è¶Šæ¥è¶Šæ…¢ã€‚å¦‚æœé€šè¿‡å¢åŠ å·¥ä½œçº¿ç¨‹æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåˆ™å·¥ä½œçº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿå°†è€—è´¹å¤§é‡CPUæ—¶é—´ã€‚ ä¸€ç§é«˜æ•ˆçš„åŠåŒæ­¥&#x2F;åŠå¼‚æ­¥æ¨¡å¼ æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½èƒ½åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·è¿æ¥ ä¸»çº¿ç¨‹åªç®¡ç†ç›‘å¬socketï¼Œè¿æ¥socketç”±å·¥ä½œçº¿ç¨‹æ¥ç®¡ç†ã€‚å½“æœ‰æ–°çš„è¿æ¥åˆ°æ¥æ—¶ï¼Œä¸»çº¿ç¨‹å°±æ¥å—ä¹‹å¹¶å°†æ–°è¿”å›çš„è¿æ¥socketæ´¾å‘ç»™æŸä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ­¤åè¯¥æ–°socketä¸Šçš„ä»»ä½•I&#x2F;Oæ“ä½œéƒ½ç”±è¢«é€‰ä¸­çš„å·¥ä½œçº¿ç¨‹æ¥å¤„ç†ï¼Œç›´åˆ°å®¢æˆ·å…³é—­è¿æ¥ã€‚ä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹æ´¾å‘socketçš„æœ€ç®€å•çš„æ–¹å¼ï¼Œæ˜¯å¾€å®ƒå’Œå·¥ä½œçº¿ç¨‹ä¹‹é—´çš„ç®¡é“é‡Œå†™æ•°æ®ã€‚å·¥ä½œçº¿ç¨‹æ£€æµ‹åˆ°ç®¡é“ä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå°±åˆ†ææ˜¯å¦æ˜¯ä¸€ä¸ªæ–°çš„å®¢æˆ·è¿æ¥è¯·æ±‚åˆ°æ¥ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æŠŠè¯¥æ–°socketä¸Šçš„è¯»å†™äº‹ä»¶æ³¨å†Œåˆ°è‡ªå·±çš„epollå†…æ ¸äº‹ä»¶è¡¨ä¸­ã€‚ é¢†å¯¼è€…&#x2F;è¿½éšè€…æ¨¡å¼ Leaderçº¿ç¨‹ è´Ÿè´£ç­‰å¾…å’Œæ¥æ”¶æ–°çš„äº‹ä»¶ï¼Œå½“äº‹ä»¶åˆ°è¾¾æ—¶å¼€å§‹å¤„ç†ï¼Œåœ¨å¤„ç†ä¹‹å‰æå‡ä¸€ä¸ªæ–°çš„Leaderï¼Œå¤„ç†å®Œæˆåé‡æ–°åŠ å…¥çº¿ç¨‹æ±  socket123456789101112131415161718192021222324252627282930313233#include&lt;netinet/in.h&gt;//è½¬æ¢å¤§ç«¯å°ç«¯#include &lt;stdio.h&gt; #include &lt;iostream&gt;#include &lt;bits/socket.h&gt;#include &lt;arpa/inet.h&gt;//ipåœ°å€è½¬æ¢#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;assert.h&gt;using namespace std;int main() &#123; //æºip port const char* ip=&quot;192.168.6.208&quot;; unsigned short int port=5005; //ä¸“ç”¨socketç»“æ„ä½“ sockaddr_in addr; addr.sin_family=AF_INET;//ç»‘å®šåœ°å€æ— addr.sin_port = htons(port);//ç»‘å®šç«¯å£ ç½‘ç»œå­—èŠ‚åº if(inet_aton(ip,&amp;addr.sin_addr)==1)&#123;//ç»‘å®šip ç½‘ç»œå­—èŠ‚åº inet_atonï¼Ÿ cout&lt;&lt;addr.sin_addr.s_addr&lt;&lt;endl; &#125; //ä¸“ç”¨ç»“æ„ä½“è½¬åŒ–ä¸ºé€šç”¨ç»“æ„ä½“ //const struct sockaddr*new_addr=(sockaddr*)&amp;addr; //åˆ›å»ºsocket int pre_name_socket; pre_name_socket=socket(PF_INET,SOCK_STREAM,0);//ipv4 tcp SOCK_NONBLOCK è¾“å‡º3 //å‘½åsocket int ret=bind(pre_name_socket,(sockaddr*)&amp;addr,sizeof(addr)); assert(ret != -1); cout&lt;&lt;&quot;bind success&quot;&lt;&lt;endl; //ç›‘å¬ ret = listen(pre_name_socket, 5);//ç›‘å¬ return 0;&#125; ET è¾¹ç¼˜è§¦å‘ çŠ¶æ€æ”¹å˜æ‰ä¼š epollä¼šé€šçŸ¥ä¸€æ¬¡ LT æ°´å¹³è§¦å‘ ç¬¦åˆçŠ¶æ€å°±ä¼š(æŒç»­)é€šçŸ¥ é¡¹ç›®æ¼”ç¤ºé¡¹ç›®åœ°å€ï¼šhttps://github.com/qinguoyi/TinyWebServer æœºå™¨ï¼šcentos 9 12345678910111213141516171819202122232425yum install dockerdocker pull dockerpull.org/mysql:latestdocker tag dockerpull.org/mysql:latest mysql:latestdocker run -d --name mysql -e MYSQL_ROOT_PASSWORD=yourpassword -p 3306:3306 mysql:latestdocker start mysqldocker exec -it mysql bashmysql -h localhost -u root -p yourpassword// å»ºç«‹yourdbåº“create database yourdb;// åˆ›å»ºuserè¡¨USE yourdb;CREATE TABLE user( username char(50) NULL, passwd char(50) NULL)ENGINE=InnoDB;// æ·»åŠ æ•°æ®INSERT INTO user(username, passwd) VALUES(&#x27;name&#x27;, &#x27;passwd&#x27;); ä¿®æ”¹main.cpp , å¦‚æœå®åœ¨dockerä¸­è¿è¡Œçš„mysql webserver.cpp æ–‡ä»¶ä¸­ â€œlocalhostâ€ ä¿®æ”¹ä¸º â€œ127.0.0.1â€ å®‰è£…mysqlç¼–è¯‘åŒ… 123456789101112sudo dnf install https://dev.mysql.com/get/mysql80-community-release-el9-1.noarch.rpmsudo dnf install mysql-devel --nogpgcheckrpm -qi mysql-devel //éªŒè¯æ˜¾ç¤ºæ²¡æœ‰å®‰è£…mysql-develecho &quot;/usr/lib64/mysql&quot; | sudo tee /etc/ld.so.conf.d/mysql.conf //æ·»åŠ è·¯å¾„sudo ldconfig è¿˜æ˜¯æ‰¾ä¸åˆ°-Lmysqlclient//ä¿®æ”¹makefile æ‰‹åŠ¨æ·»åŠ è·¯å¾„MYSQL_LIBS = -L/usr/lib64/mysql -lmysqlclientserver:$(MYSQL_LIBS)//éš¾é“æ˜¯æ²¡æœ‰å®‰è£…mysqlçš„åŸå› ï¼Ÿå› ä¸ºæˆ‘æ˜¯åœ¨dockerä¸­è¿è¡Œçš„mysql å…³é—­centosé˜²ç«å¢™ systemctl stop firewalld systemctl disable firewalld systemctl status firewalld è¿è¡Œ sh .&#x2F;build.sh","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"Log","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/Log","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/Log/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Log/","excerpt":"","text":"syslogç³»ç»Ÿæ—¥å¿—mian.cpp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;syslog.h&gt; #include &lt;iostream&gt; #include &lt;string&gt; // å°è£…æ—¥å¿—å‡½æ•° class Logger &#123; public: Logger(const std::string&amp; appName) &#123; openlog(appName.c_str(), LOG_PID | LOG_CONS, LOG_USER); &#125; ~Logger() &#123; closelog(); &#125; void log(int priority, const std::string&amp; message) &#123; syslog(priority, &quot;%s&quot;, message.c_str()); &#125; // è®¾ç½®æ—¥å¿—æ©ç ä»¥è¿‡æ»¤æ—¥å¿—çº§åˆ« void setLogMask(int mask) &#123; setlogmask(mask); &#125; // ç¤ºä¾‹æ—¥å¿—æ–¹æ³• void debug(const std::string&amp; msg) &#123; log(LOG_DEBUG, msg); &#125; void info(const std::string&amp; msg) &#123; log(LOG_INFO, msg); &#125; void warning(const std::string&amp; msg) &#123; log(LOG_WARNING, msg); &#125; void error(const std::string&amp; msg) &#123; log(LOG_ERR, msg); &#125; &#125;; int main() &#123; Logger logger(&quot;MyApp&quot;); // è®¾ç½®æ—¥å¿—æ©ç ï¼Œè¿‡æ»¤æ‰ LOG_DEBUG çº§åˆ«çš„æ—¥å¿— logger.setLogMask(LOG_UPTO(LOG_INFO)); // å…è®¸ LOG_EMERG åˆ° LOG_INFOï¼Œä½†æ’é™¤ LOG_DEBUG // å°è¯•è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿— logger.debug(&quot;This is a debug message.&quot;); // è¿™å°†ä¸ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­ logger.info(&quot;This is an info message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ logger.warning(&quot;This is a warning message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ logger.error(&quot;This is an error message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ return 0; &#125; ä¼˜å…ˆçº§ï¼š ç‰¹æ€§ï¼š RAIIæ¨¡å¼ç®¡ç†æ—¥å¿—èµ„æºï¼ˆæ„é€ å‡½æ•°æ‰“å¼€ï¼Œææ„å‡½æ•°å…³é—­ï¼‰ æ”¯æŒæ—¥å¿—çº§åˆ«è¿‡æ»¤ 12345678LOG_EMERG (0) // ç³»ç»Ÿä¸å¯ç”¨ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰LOG_ALERT (1) // å¿…é¡»ç«‹å³é‡‡å–è¡ŒåŠ¨LOG_CRIT (2) // ä¸¥é‡é”™è¯¯LOG_ERR (3) // é”™è¯¯LOG_WARNING (4) // è­¦å‘ŠLOG_NOTICE (5) // æ­£å¸¸ä½†é‡è¦çš„æƒ…å†µLOG_INFO (6) // ä¿¡æ¯æ€§æ¶ˆæ¯LOG_DEBUG (7) // è°ƒè¯•ä¿¡æ¯ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰ LOG_UPTO(pri): è®°å½•ä¼˜å…ˆçº§ç­‰äºæˆ–é«˜äº pri çš„æ‰€æœ‰æ¶ˆæ¯ æ—¥å¿—ä¼šè¢«å†™å…¥ç³»ç»Ÿæ—¥å¿— #Ubuntu&#x2F;Debian tail -f &#x2F;var&#x2F;log&#x2F;syslog | grep MyApp #RHEL&#x2F;CentOS tail -f &#x2F;var&#x2F;log&#x2F;messages | grep MyApp æ—¥å¿—æ ¼å¼ æ—¶é—´æˆ³+ä¸»æœºå+ç¨‹åºå+è¿›ç¨‹ID+æ—¥å¿—æ¶ˆæ¯ æ—¥å¿—ç³»ç»Ÿå‚è€ƒhttps://blog.csdn.net/weixin_51322383/article/details/130464403 https://blog.csdn.net/weixin_51322383/article/details/130474753 é˜Ÿåˆ—å®ç°å¼‚æ­¥æ—¥å¿—çš„å…³é”®ï¼Œç”Ÿæˆçš„æ—¥å¿—æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œå†™çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºæ—¥å¿—å†™å…¥ï¼Œç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å®ç° ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ é…åˆmutexäº’æ–¥é” condition_variableï¼ˆæ¡ä»¶å˜é‡ï¼‰ å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ä¸é€šä¿¡ æ¨¡æ¿ blockqueue.h123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161# ifndef BLOCKQUEUE_H# define BLOCKQUEUE_H#include &lt;deque&gt;#include &lt;condition_variable&gt;#include &lt;mutex&gt;#include &lt;sys/time.h&gt;using namespace std;template&lt;typename T&gt;class BlockQueue &#123;public: explicit BlockQueue(size_t maxsize = 1000); ~BlockQueue(); bool empty(); bool full(); void push_back(const T&amp; item); void push_front(const T&amp; item); bool pop(T&amp; item); // å¼¹å‡ºçš„ä»»åŠ¡æ”¾å…¥item bool pop(T&amp; item, int timeout); // ç­‰å¾…æ—¶é—´ void clear(); T front(); T back(); size_t capacity(); size_t size(); void flush(); void Close();private: deque&lt;T&gt; deq_; // åº•å±‚æ•°æ®ç»“æ„ mutex mtx_; // é” bool isClose_; // å…³é—­æ ‡å¿— size_t capacity_; // å®¹é‡ condition_variable condConsumer_; // æ¶ˆè´¹è€…æ¡ä»¶å˜é‡ condition_variable condProducer_; // ç”Ÿäº§è€…æ¡ä»¶å˜é‡&#125;;template&lt;typename T&gt;BlockQueue&lt;T&gt;::BlockQueue(size_t maxsize) : capacity_(maxsize) &#123; assert(maxsize &gt; 0); isClose_ = false;&#125;template&lt;typename T&gt;BlockQueue&lt;T&gt;::~BlockQueue() &#123; Close();&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::Close() &#123; // lock_guard&lt;mutex&gt; locker(mtx_); // æ“æ§é˜Ÿåˆ—ä¹‹å‰ï¼Œéƒ½éœ€è¦ä¸Šé” // deq_.clear(); // æ¸…ç©ºé˜Ÿåˆ— clear(); isClose_ = true; condConsumer_.notify_all(); condProducer_.notify_all();&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::clear() &#123; lock_guard&lt;mutex&gt; locker(mtx_); deq_.clear();&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::empty() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return deq_.empty();&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::full() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return deq_.size() &gt;= capacity_;&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::push_back(const T&amp; item) &#123; // æ³¨æ„ï¼Œæ¡ä»¶å˜é‡éœ€è¦æ­é…unique_lock unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.size() &gt;= capacity_) &#123; // é˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾… condProducer_.wait(locker); // æš‚åœç”Ÿäº§ï¼Œç­‰å¾…æ¶ˆè´¹è€…å”¤é†’ç”Ÿäº§æ¡ä»¶å˜é‡ &#125; deq_.push_back(item); condConsumer_.notify_one(); // å”¤é†’æ¶ˆè´¹è€…&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::push_front(const T&amp; item) &#123; unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.size() &gt;= capacity_) &#123; // é˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾… condProducer_.wait(locker); // æš‚åœç”Ÿäº§ï¼Œç­‰å¾…æ¶ˆè´¹è€…å”¤é†’ç”Ÿäº§æ¡ä»¶å˜é‡ &#125; deq_.push_front(item); condConsumer_.notify_one(); // å”¤é†’æ¶ˆè´¹è€…&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::pop(T&amp; item) &#123; unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.empty()) &#123; if(isClose_) &#123; return false; &#125; condConsumer_.wait(locker); &#125; item = deq_.front(); deq_.pop_front(); condProducer_.notify_one(); return true;&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::pop(T &amp;item, int timeout) &#123; unique_lock&lt;std::mutex&gt; locker(mtx_); while(deq_.empty())&#123; if(condConsumer_.wait_for(locker, std::chrono::seconds(timeout)) == std::cv_status::timeout)&#123; return false; &#125; if(isClose_)&#123; return false; &#125; &#125; item = deq_.front(); deq_.pop_front(); condProducer_.notify_one(); return true;&#125;template&lt;typename T&gt;T BlockQueue&lt;T&gt;::front() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.front();&#125;template&lt;typename T&gt;T BlockQueue&lt;T&gt;::back() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.back();&#125;template&lt;typename T&gt;size_t BlockQueue&lt;T&gt;::capacity() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return capacity_;&#125;template&lt;typename T&gt;size_t BlockQueue&lt;T&gt;::size() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.size();&#125;// å”¤é†’æ¶ˆè´¹è€…template&lt;typename T&gt;void BlockQueue&lt;T&gt;::flush() &#123; condConsumer_.notify_one();&#125;# endif ç¼“å†²åŒº###buffer.h 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#ifndef BUFFER_H#define BUFFER_H#include &lt;cstring&gt; //perror#include &lt;iostream&gt;#include &lt;unistd.h&gt; // write#include &lt;sys/uio.h&gt; //readv#include &lt;vector&gt; //readv#include &lt;atomic&gt;#include &lt;assert.h&gt;class Buffer &#123;public: Buffer(int initBuffSize = 1024); ~Buffer() = default; size_t WritableBytes() const; size_t ReadableBytes() const ; size_t PrependableBytes() const; const char* Peek() const; void EnsureWriteable(size_t len); void HasWritten(size_t len); void Retrieve(size_t len); void RetrieveUntil(const char* end); void RetrieveAll(); std::string RetrieveAllToStr(); const char* BeginWriteConst() const; char* BeginWrite(); void Append(const std::string&amp; str); void Append(const char* str, size_t len); void Append(const void* data, size_t len); void Append(const Buffer&amp; buff); ssize_t ReadFd(int fd, int* Errno); ssize_t WriteFd(int fd, int* Errno);private: char* BeginPtr_(); // bufferå¼€å¤´ const char* BeginPtr_() const; void MakeSpace_(size_t len); std::vector&lt;char&gt; buffer_; std::atomic&lt;std::size_t&gt; readPos_; // è¯»çš„ä¸‹æ ‡ std::atomic&lt;std::size_t&gt; writePos_; // å†™çš„ä¸‹æ ‡&#125;;#endif //BUFFER_H buffer.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146#include &quot;buffer.h&quot;// è¯»å†™ä¸‹æ ‡åˆå§‹åŒ–ï¼Œvector&lt;char&gt;åˆå§‹åŒ–Buffer::Buffer(int initBuffSize) : buffer_(initBuffSize), readPos_(0), writePos_(0) &#123;&#125; // å¯å†™çš„æ•°é‡ï¼šbufferå¤§å° - å†™ä¸‹æ ‡size_t Buffer::WritableBytes() const &#123; return buffer_.size() - writePos_;&#125;// å¯è¯»çš„æ•°é‡ï¼šå†™ä¸‹æ ‡ - è¯»ä¸‹æ ‡size_t Buffer::ReadableBytes() const &#123; return writePos_ - readPos_;&#125;// å¯é¢„ç•™ç©ºé—´ï¼šå·²ç»è¯»è¿‡çš„å°±æ²¡ç”¨äº†ï¼Œç­‰äºè¯»ä¸‹æ ‡size_t Buffer::PrependableBytes() const &#123; return readPos_;&#125;const char* Buffer::Peek() const &#123; return &amp;buffer_[readPos_];&#125;// ç¡®ä¿å¯å†™çš„é•¿åº¦void Buffer::EnsureWriteable(size_t len) &#123; if(len &gt; WritableBytes()) &#123; MakeSpace_(len); &#125; assert(len &lt;= WritableBytes());&#125;// ç§»åŠ¨å†™ä¸‹æ ‡ï¼Œåœ¨Appendä¸­ä½¿ç”¨void Buffer::HasWritten(size_t len) &#123; writePos_ += len;&#125;// è¯»å–lené•¿åº¦ï¼Œç§»åŠ¨è¯»ä¸‹æ ‡void Buffer::Retrieve(size_t len) &#123; readPos_ += len;&#125;// è¯»å–åˆ°endä½ç½®void Buffer::RetrieveUntil(const char* end) &#123; assert(Peek() &lt;= end ); Retrieve(end - Peek()); // endæŒ‡é’ˆ - è¯»æŒ‡é’ˆ é•¿åº¦&#125;// å–å‡ºæ‰€æœ‰æ•°æ®ï¼Œbufferå½’é›¶ï¼Œè¯»å†™ä¸‹æ ‡å½’é›¶,åœ¨åˆ«çš„å‡½æ•°ä¸­ä¼šç”¨åˆ°void Buffer::RetrieveAll() &#123; bzero(&amp;buffer_[0], buffer_.size()); // è¦†ç›–åŸæœ¬æ•°æ® readPos_ = writePos_ = 0;&#125;// å–å‡ºå‰©ä½™å¯è¯»çš„strstd::string Buffer::RetrieveAllToStr() &#123; std::string str(Peek(), ReadableBytes()); RetrieveAll(); return str;&#125;// å†™æŒ‡é’ˆçš„ä½ç½®const char* Buffer::BeginWriteConst() const &#123; return &amp;buffer_[writePos_];&#125;char* Buffer::BeginWrite() &#123; return &amp;buffer_[writePos_];&#125;// æ·»åŠ stråˆ°ç¼“å†²åŒºvoid Buffer::Append(const char* str, size_t len) &#123; assert(str); EnsureWriteable(len); // ç¡®ä¿å¯å†™çš„é•¿åº¦ std::copy(str, str + len, BeginWrite()); // å°†stræ”¾åˆ°å†™ä¸‹æ ‡å¼€å§‹çš„åœ°æ–¹ HasWritten(len); // ç§»åŠ¨å†™ä¸‹æ ‡&#125;void Buffer::Append(const std::string&amp; str) &#123; Append(str.c_str(), str.size());&#125;void Append(const void* data, size_t len) &#123; Append(static_cast&lt;const char*&gt;(data), len);&#125;// å°†bufferä¸­çš„è¯»ä¸‹æ ‡çš„åœ°æ–¹æ”¾åˆ°è¯¥bufferä¸­çš„å†™ä¸‹æ ‡ä½ç½®void Append(const Buffer&amp; buff) &#123; Append(buff.Peek(), buff.ReadableBytes());&#125;// å°†fdçš„å†…å®¹è¯»åˆ°ç¼“å†²åŒºï¼Œå³writableçš„ä½ç½®ssize_t Buffer::ReadFd(int fd, int* Errno) &#123; char buff[65535]; // æ ˆåŒº struct iovec iov[2]; size_t writeable = WritableBytes(); // å…ˆè®°å½•èƒ½å†™å¤šå°‘ // åˆ†æ•£è¯»ï¼Œ ä¿è¯æ•°æ®å…¨éƒ¨è¯»å®Œ iov[0].iov_base = BeginWrite(); iov[0].iov_len = writeable; iov[1].iov_base = buff; iov[1].iov_len = sizeof(buff); ssize_t len = readv(fd, iov, 2); if(len &lt; 0) &#123; *Errno = errno; &#125; else if(static_cast&lt;size_t&gt;(len) &lt;= writeable) &#123; // è‹¥lenå°äºwritableï¼Œè¯´æ˜å†™åŒºå¯ä»¥å®¹çº³len writePos_ += len; // ç›´æ¥ç§»åŠ¨å†™ä¸‹æ ‡ &#125; else &#123; writePos_ = buffer_.size(); // å†™åŒºå†™æ»¡äº†,ä¸‹æ ‡ç§»åˆ°æœ€å Append(buff, static_cast&lt;size_t&gt;(len - writeable)); // å‰©ä½™çš„é•¿åº¦ &#125; return len;&#125;// å°†bufferä¸­å¯è¯»çš„åŒºåŸŸå†™å…¥fdä¸­ssize_t Buffer::WriteFd(int fd, int* Errno) &#123; ssize_t len = write(fd, Peek(), ReadableBytes()); if(len &lt; 0) &#123; *Errno = errno; return len; &#125; Retrieve(len); return len;&#125;char* Buffer::BeginPtr_() &#123; return &amp;buffer_[0];&#125;const char* Buffer::BeginPtr_() const&#123; return &amp;buffer_[0];&#125;// æ‰©å±•ç©ºé—´void Buffer::MakeSpace_(size_t len) &#123; if(WritableBytes() + PrependableBytes() &lt; len) &#123; buffer_.resize(writePos_ + len + 1); &#125; else &#123; size_t readable = ReadableBytes(); std::copy(BeginPtr_() + readPos_, BeginPtr_() + writePos_, BeginPtr_()); readPos_ = 0; writePos_ = readable; assert(readable == ReadableBytes()); &#125;&#125; å®ç°å•ä¾‹æ¨¡å¼ è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¼ å…¥åˆå§‹åŒ–å‚æ•°æ‰€ä»¥é€‰æ‹©æ‡’æ±‰æ¨¡å¼å°†ç±»çš„é™æ€å¯¹è±¡æ”¾åˆ°å‡½æ•°é™æ€å‡½æ•°ä¸­ã€‚ 1234567public: static Log* Instance()&#123;static Log log;return &amp;log;&#125; void init(...);private: Log();Log::Instance()-&gt;init(0, &quot;./log&quot;, &quot;.log&quot;, 1024); log.h123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#ifndef LOG_H#define LOG_H#include &lt;mutex&gt;#include &lt;string&gt;#include &lt;thread&gt;#include &lt;sys/time.h&gt;#include &lt;string.h&gt;#include &lt;stdarg.h&gt; // vastart va_end#include &lt;assert.h&gt;#include &lt;sys/stat.h&gt; // mkdir#include &quot;blockqueue.h&quot;#include &quot;../buffer/buffer.h&quot;class Log &#123;public: // åˆå§‹åŒ–æ—¥å¿—å®ä¾‹ï¼ˆé˜»å¡é˜Ÿåˆ—æœ€å¤§å®¹é‡ã€æ—¥å¿—ä¿å­˜è·¯å¾„ã€æ—¥å¿—æ–‡ä»¶åç¼€ï¼‰ void init(int level, const char* path = &quot;./log&quot;, const char* suffix =&quot;.log&quot;, int maxQueueCapacity = 1024); static Log* Instance(); static void FlushLogThread(); // å¼‚æ­¥å†™æ—¥å¿—å…¬æœ‰æ–¹æ³•ï¼Œè°ƒç”¨ç§æœ‰æ–¹æ³•asyncWrite void write(int level, const char *format,...); // å°†è¾“å‡ºå†…å®¹æŒ‰ç…§æ ‡å‡†æ ¼å¼æ•´ç† void flush(); int GetLevel(); void SetLevel(int level); bool IsOpen() &#123; return isOpen_; &#125;private: Log(); void AppendLogLevelTitle_(int level); virtual ~Log(); void AsyncWrite_(); // å¼‚æ­¥å†™æ—¥å¿—æ–¹æ³•private: static const int LOG_PATH_LEN = 256; // æ—¥å¿—æ–‡ä»¶æœ€é•¿æ–‡ä»¶å static const int LOG_NAME_LEN = 256; // æ—¥å¿—æœ€é•¿åå­— static const int MAX_LINES = 50000; // æ—¥å¿—æ–‡ä»¶å†…çš„æœ€é•¿æ—¥å¿—æ¡æ•° const char* path_; //è·¯å¾„å const char* suffix_; //åç¼€å int MAX_LINES_; // æœ€å¤§æ—¥å¿—è¡Œæ•° int lineCount_; //æ—¥å¿—è¡Œæ•°è®°å½• int toDay_; //æŒ‰å½“å¤©æ—¥æœŸåŒºåˆ†æ–‡ä»¶ bool isOpen_; Buffer buff_; // è¾“å‡ºçš„å†…å®¹ï¼Œç¼“å†²åŒº int level_; // æ—¥å¿—ç­‰çº§ bool isAsync_; // æ˜¯å¦å¼€å¯å¼‚æ­¥æ—¥å¿— FILE* fp_; //æ‰“å¼€logçš„æ–‡ä»¶æŒ‡é’ˆ std::unique_ptr&lt;BlockQueue&lt;std::string&gt;&gt; deque_; //é˜»å¡é˜Ÿåˆ— std::unique_ptr&lt;std::thread&gt; writeThread_; //å†™çº¿ç¨‹çš„æŒ‡é’ˆ std::mutex mtx_; //åŒæ­¥æ—¥å¿—å¿…éœ€çš„äº’æ–¥é‡&#125;;#define LOG_BASE(level, format, ...) \\ do &#123;\\ Log* log = Log::Instance();\\ if (log-&gt;IsOpen() &amp;&amp; log-&gt;GetLevel() &lt;= level) &#123;\\ log-&gt;write(level, format, ##__VA_ARGS__); \\ log-&gt;flush();\\ &#125;\\ &#125; while(0);// å››ä¸ªå®å®šä¹‰ï¼Œä¸»è¦ç”¨äºä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºï¼Œä¹Ÿæ˜¯å¤–éƒ¨ä½¿ç”¨æ—¥å¿—çš„æ¥å£// ...è¡¨ç¤ºå¯å˜å‚æ•°ï¼Œ__VA_ARGS__å°±æ˜¯å°†...çš„å€¼å¤åˆ¶åˆ°è¿™é‡Œ// å‰é¢åŠ ä¸Š##çš„ä½œç”¨æ˜¯ï¼šå½“å¯å˜å‚æ•°çš„ä¸ªæ•°ä¸º0æ—¶ï¼Œè¿™é‡Œçš„##å¯ä»¥æŠŠæŠŠå‰é¢å¤šä½™çš„&quot;,&quot;å»æ‰,å¦åˆ™ä¼šç¼–è¯‘å‡ºé”™ã€‚#define LOG_DEBUG(format, ...) do &#123;LOG_BASE(0, format, ##__VA_ARGS__)&#125; while(0); #define LOG_INFO(format, ...) do &#123;LOG_BASE(1, format, ##__VA_ARGS__)&#125; while(0);#define LOG_WARN(format, ...) do &#123;LOG_BASE(2, format, ##__VA_ARGS__)&#125; while(0);#define LOG_ERROR(format, ...) do &#123;LOG_BASE(3, format, ##__VA_ARGS__)&#125; while(0);#endif //LOG_H log.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209#include &quot;log.h&quot;#include &lt;errno.h&gt;#include &lt;unistd.h&gt;// æ„é€ å‡½æ•°Log::Log() &#123; fp_ = nullptr; deque_ = nullptr; writeThread_ = nullptr; lineCount_ = 0; toDay_ = 0; isAsync_ = false;&#125;Log::~Log() &#123; if(isAsync_) &#123; deque_-&gt;Close(); if(writeThread_ &amp;&amp; writeThread_-&gt;joinable()) &#123; writeThread_-&gt;join(); &#125; &#125; &#123; lock_guard&lt;mutex&gt; locker(mtx_); if(fp_) &#123; flush(); fclose(fp_); fp_ = nullptr; &#125; &#125;&#125;// å”¤é†’é˜»å¡é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼Œå¼€å§‹å†™æ—¥å¿—void Log::flush() &#123; if(isAsync_) &#123; // åªæœ‰å¼‚æ­¥æ—¥å¿—æ‰ä¼šç”¨åˆ°deque deque_-&gt;flush(); &#125; fflush(fp_); // æ¸…ç©ºè¾“å…¥ç¼“å†²åŒº&#125;// æ‡’æ±‰æ¨¡å¼ å±€éƒ¨é™æ€å˜é‡æ³•ï¼ˆè¿™ç§æ–¹æ³•ä¸éœ€è¦åŠ é”å’Œè§£é”æ“ä½œï¼‰Log* Log::Instance() &#123; static Log log; return &amp;log;&#125;// å¼‚æ­¥æ—¥å¿—çš„å†™çº¿ç¨‹å‡½æ•°void Log::FlushLogThread() &#123; Log::Instance()-&gt;AsyncWrite_();&#125;// å†™çº¿ç¨‹çœŸæ­£çš„æ‰§è¡Œå‡½æ•°void Log::AsyncWrite_() &#123; string str = &quot;&quot;; while(true) &#123; if(deque_-&gt;pop(str)) &#123; lock_guard&lt;mutex&gt; locker(mtx_); fputs(str.c_str(), fp_); fflush(fp_); &#125; else &#123; break; // é˜Ÿåˆ—å·²å…³é—­ &#125; &#125;&#125;// åˆå§‹åŒ–æ—¥å¿—å®ä¾‹void Log::init(int level, const char* path, const char* suffix, int maxQueCapacity) &#123; isOpen_ = true; level_ = level; path_ = path; suffix_ = suffix; if(maxQueCapacity) &#123; // å¼‚æ­¥æ–¹å¼ isAsync_ = true; if(!deque_) &#123; // ä¸ºç©ºåˆ™åˆ›å»ºä¸€ä¸ª unique_ptr&lt;BlockQueue&lt;std::string&gt;&gt; newQue(new BlockQueue&lt;std::string&gt;); // å› ä¸ºunique_pträ¸æ”¯æŒæ™®é€šçš„æ‹·è´æˆ–èµ‹å€¼æ“ä½œ,æ‰€ä»¥é‡‡ç”¨move // å°†åŠ¨æ€ç”³è¯·çš„å†…å­˜æƒç»™dequeï¼ŒnewDequeè¢«é‡Šæ”¾ deque_ = move(newQue); // å·¦å€¼å˜å³å€¼,æç©ºnewDeque unique_ptr&lt;thread&gt; newThread(new thread(FlushLogThread)); writeThread_ = move(newThread); &#125; &#125; else &#123; isAsync_ = false; &#125; lineCount_ = 0; time_t timer = time(nullptr); struct tm* systime = localtime(&amp;timer); char fileName[LOG_NAME_LEN] = &#123;0&#125;; snprintf(fileName, LOG_NAME_LEN - 1, &quot;%s/%04d_%02d_%02d%s&quot;, path_, systime-&gt;tm_year + 1900, systime-&gt;tm_mon + 1, systime-&gt;tm_mday, suffix_); toDay_ = systime-&gt;tm_mday; &#123; lock_guard&lt;mutex&gt; locker(mtx_); buff_.RetrieveAll(); if(fp_) &#123; // é‡æ–°æ‰“å¼€ flush(); fclose(fp_); &#125; // ç¡®ä¿ç›®å½•å­˜åœ¨ if (access(path_, F_OK) != 0) &#123; mkdir(path_, 0777); &#125; fp_ = fopen(fileName, &quot;a&quot;); if(fp_ == nullptr) &#123; // è¾“å‡ºé”™è¯¯ä¿¡æ¯ä¾¿äºè°ƒè¯• printf(&quot;Failed to open file %s, errno: %d\\n&quot;, fileName, errno); return; // æˆ–å…¶ä»–é”™è¯¯å¤„ç† &#125; assert(fp_ != nullptr); &#125;&#125;void Log::write(int level, const char *format, ...) &#123; struct timeval now = &#123;0, 0&#125;; gettimeofday(&amp;now, nullptr); time_t tSec = now.tv_sec; struct tm *sysTime = localtime(&amp;tSec); struct tm t = *sysTime; va_list vaList; // æ—¥å¿—æ—¥æœŸ æ—¥å¿—è¡Œæ•° å¦‚æœä¸æ˜¯ä»Šå¤©æˆ–è¡Œæ•°è¶…äº† if (toDay_ != t.tm_mday || (lineCount_ &amp;&amp; (lineCount_ % MAX_LINES == 0))) &#123; unique_lock&lt;mutex&gt; locker(mtx_); locker.unlock(); char newFile[LOG_NAME_LEN]; char tail[36] = &#123;0&#125;; snprintf(tail, 36, &quot;%04d_%02d_%02d&quot;, t.tm_year + 1900, t.tm_mon + 1, t.tm_mday); if (toDay_ != t.tm_mday) // æ—¶é—´ä¸åŒ¹é…ï¼Œåˆ™æ›¿æ¢ä¸ºæœ€æ–°çš„æ—¥å¿—æ–‡ä»¶å &#123; snprintf(newFile, LOG_NAME_LEN - 72, &quot;%s/%s%s&quot;, path_, tail, suffix_); toDay_ = t.tm_mday; lineCount_ = 0; &#125; else &#123; snprintf(newFile, LOG_NAME_LEN - 72, &quot;%s/%s-%d%s&quot;, path_, tail, (lineCount_ / MAX_LINES), suffix_); &#125; locker.lock(); flush(); fclose(fp_); fp_ = fopen(newFile, &quot;a&quot;); assert(fp_ != nullptr); &#125; // åœ¨bufferå†…ç”Ÿæˆä¸€æ¡å¯¹åº”çš„æ—¥å¿—ä¿¡æ¯ &#123; unique_lock&lt;mutex&gt; locker(mtx_); lineCount_++; int n = snprintf(buff_.BeginWrite(), 128, &quot;%d-%02d-%02d %02d:%02d:%02d.%06ld &quot;, t.tm_year + 1900, t.tm_mon + 1, t.tm_mday, t.tm_hour, t.tm_min, t.tm_sec, now.tv_usec); buff_.HasWritten(n); AppendLogLevelTitle_(level); va_start(vaList, format); int m = vsnprintf(buff_.BeginWrite(), buff_.WritableBytes(), format, vaList); va_end(vaList); buff_.HasWritten(m); buff_.Append(&quot;\\n\\0&quot;, 2); if(isAsync_ &amp;&amp; deque_ &amp;&amp; !deque_-&gt;full()) &#123; // å¼‚æ­¥æ–¹å¼ï¼ˆåŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…å†™çº¿ç¨‹è¯»å–æ—¥å¿—ä¿¡æ¯ï¼‰ deque_-&gt;push_back(buff_.RetrieveAllToStr()); &#125; else &#123; // åŒæ­¥æ–¹å¼ï¼ˆç›´æ¥å‘æ–‡ä»¶ä¸­å†™å…¥æ—¥å¿—ä¿¡æ¯ï¼‰ fputs(buff_.Peek(), fp_); // åŒæ­¥å°±ç›´æ¥å†™å…¥æ–‡ä»¶ &#125; buff_.RetrieveAll(); // æ¸…ç©ºbuff &#125;&#125;// æ·»åŠ æ—¥å¿—ç­‰çº§void Log::AppendLogLevelTitle_(int level) &#123; switch(level) &#123; case 0: buff_.Append(&quot;[debug]: &quot;, 9); break; case 1: buff_.Append(&quot;[info] : &quot;, 9); break; case 2: buff_.Append(&quot;[warn] : &quot;, 9); break; case 3: buff_.Append(&quot;[error]: &quot;, 9); break; default: buff_.Append(&quot;[info] : &quot;, 9); break; &#125;&#125;int Log::GetLevel() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return level_;&#125;void Log::SetLevel(int level) &#123; lock_guard&lt;mutex&gt; locker(mtx_); level_ = level;&#125; æµ‹è¯•main.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;string&gt;#include &quot;log/log.h&quot;void AsyncLog() &#123; int cnt = 0; int n = 5; while(n--) &#123; LOG_DEBUG(&quot;è¿™æ˜¯ç¬¬%dæ¡å¼‚æ­¥è°ƒè¯•æ—¥å¿—&quot;, ++cnt); LOG_INFO(&quot;è¿™æ˜¯ç¬¬%dæ¡å¼‚æ­¥ä¿¡æ¯æ—¥å¿—&quot;, cnt); LOG_WARN(&quot;è¿™æ˜¯ç¬¬%dæ¡å¼‚æ­¥è­¦å‘Šæ—¥å¿—&quot;, cnt); LOG_ERROR(&quot;è¿™æ˜¯ç¬¬%dæ¡å¼‚æ­¥é”™è¯¯æ—¥å¿—&quot;, cnt); &#125;&#125;void SyncLog() &#123; int cnt = 0; int n = 5; while(n--) &#123; LOG_DEBUG(&quot;è¿™æ˜¯ç¬¬%dæ¡åŒæ­¥è°ƒè¯•æ—¥å¿—&quot;, ++cnt); LOG_INFO(&quot;è¿™æ˜¯ç¬¬%dæ¡åŒæ­¥ä¿¡æ¯æ—¥å¿—&quot;, cnt); LOG_WARN(&quot;è¿™æ˜¯ç¬¬%dæ¡åŒæ­¥è­¦å‘Šæ—¥å¿—&quot;, cnt); LOG_ERROR(&quot;è¿™æ˜¯ç¬¬%dæ¡åŒæ­¥é”™è¯¯æ—¥å¿—&quot;, cnt); &#125;&#125;int main() &#123; //åˆå§‹åŒ–å¼‚æ­¥æ—¥å¿— Log::Instance()-&gt;init(0, &quot;./log&quot;, &quot;.log&quot;, 1024); std::cout &lt;&lt; &quot;æµ‹è¯•å¼‚æ­¥æ—¥å¿—...&quot; &lt;&lt; std::endl; AsyncLog(); // ç­‰å¾…å¼‚æ­¥æ—¥å¿—å¤„ç†å®Œæˆ std::this_thread::sleep_for(std::chrono::seconds(1)); // é‡æ–°åˆå§‹åŒ–ä¸ºåŒæ­¥æ—¥å¿— // Log::Instance()-&gt;init(0, &quot;./log&quot;, &quot;.log&quot;, 0); // std::cout &lt;&lt; &quot;æµ‹è¯•åŒæ­¥æ—¥å¿—...&quot; &lt;&lt; std::endl; // SyncLog(); return 0;&#125; è‡ªå·±å®ç°é˜»å¡é˜Ÿåˆ—éœ€è¦çš„åŠŸèƒ½ï¼šé€šè¿‡é˜Ÿåˆ—æŒ‡é’ˆå®ç°åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡ï¼Œæ·»åŠ å…ƒç´ ï¼Œå–å‡ºå…ƒç´  ç”¨æ¨¡æ¿è®¾è®¡ï¼Œæé«˜è¿™ä¸ªå·¥å…·çš„å¤ç”¨æ€§ ä½¿ç”¨æ ‡å‡†é˜Ÿåˆ—queueå®ç° ä½¿ç”¨mutexå’Œæ¡ä»¶å˜é‡ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸ªé˜Ÿåˆ— block_queue.hpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/* * @file block_queue.hpp * @brief é˜»å¡é˜Ÿåˆ—çš„æ¨¡æ¿ç±»å®ç° */#ifndef PROJECT_BLOCK_QUEUE_HPP_#define PROJECT_BLOCK_QUEUE_HPP_#include &lt;queue&gt;#include &lt;iostream&gt;#include &lt;condition_variable&gt;#include &lt;mutex&gt;using namespace std;template&lt;typename T&gt;class BlockQueue&#123;private: mutex mtx; condition_variable cvConsumer; condition_variable cvProducer; queue&lt;T&gt; blockQueue; int maxsize; //å•ä¾‹ BlockQueue()&#123;&#125; BlockQueue(const BlockQueue&amp;) = delete; BlockQueue&amp; operator=(const BlockQueue&amp;) = delete;public: //~BlockQueue(); static BlockQueue&amp; getInstance()&#123; static BlockQueue instance;//æˆ–è€…åœ¨ç±»å¤–å®šä¹‰ return instance; &#125; void init(int size)&#123;maxsize=size;&#125;; void push(T data); T pop();&#125;;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::push(T data)&#123; unique_lock&lt;mutex&gt; locker(mtx); while(blockQueue.size() &gt;= maxsize) &#123; // é˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾… cvProducer.wait(locker); // æš‚åœç”Ÿäº§ï¼Œç­‰å¾…æ¶ˆè´¹è€…å”¤é†’ç”Ÿäº§æ¡ä»¶å˜é‡ &#125; blockQueue.push(data); cvConsumer.notify_one(); &#125;template&lt;typename T&gt;T BlockQueue&lt;T&gt;::pop()&#123; unique_lock&lt;mutex&gt; locker(mtx); cvConsumer.wait(locker, [this]&#123; return blockQueue.size() != 0; &#125;); cvProducer.notify_one(); T temp=blockQueue.front(); blockQueue.pop(); return temp;&#125;#endif ###æµ‹è¯• main.cpp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &quot;block_queue.hpp&quot;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;string&gt;void producer(int id) &#123; auto&amp; queue = BlockQueue&lt;int&gt;::getInstance(); for(int i = 0; i &lt; 10; i++) &#123; int data = i + id * 100; queue.push(data); &#123; cout &lt;&lt; &quot;ç”Ÿäº§è€… &quot; &lt;&lt; id &lt;&lt; &quot; ç”Ÿäº§æ•°æ®: &quot; &lt;&lt; data &lt;&lt; endl; &#125; this_thread::sleep_for(chrono::milliseconds(200)); // æ¨¡æ‹Ÿç”Ÿäº§è¿‡ç¨‹ &#125;&#125;void consumer(int id) &#123; auto&amp; queue = BlockQueue&lt;int&gt;::getInstance(); for(int i = 0; i &lt; 5; i++) &#123; int data = queue.pop(); &#123; cout &lt;&lt; &quot;æ¶ˆè´¹è€… &quot; &lt;&lt; id &lt;&lt; &quot; æ¶ˆè´¹æ•°æ®: &quot; &lt;&lt; data &lt;&lt; endl; &#125; this_thread::sleep_for(chrono::milliseconds(500)); // æ¨¡æ‹Ÿæ¶ˆè´¹è¿‡ç¨‹ &#125;&#125;int main() &#123; auto&amp; queue = BlockQueue&lt;int&gt;::getInstance(); queue.init(5); vector&lt;thread&gt; producers; vector&lt;thread&gt; consumers; for(int i = 0; i &lt; 3; i++) &#123; producers.emplace_back(producer, i); &#125; for(int i = 0; i &lt; 2; i++) &#123; consumers.emplace_back(consumer, i); &#125; for(auto&amp; p : producers) &#123; p.join(); &#125; for(auto&amp; c : consumers) &#123; c.join(); &#125; return 0;&#125; ç¼“å†²åŒºä½œç”¨ï¼š é¿å…é¢‘ç¹å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œé‡å¤ä½¿ç”¨å·²åˆ†é…çš„ç©ºé—´ åŠŸèƒ½ï¼š * æ—¥å¿—åŠŸèƒ½ï¼š é˜»å¡å’Œéé˜»å¡åŠŸèƒ½ å•ä¾‹æ¨¡å¼ è®¾ç½®æ©ç æ‰“å°ä¸åŒç­‰çº§æ—¥å¿— æ‰“å°çš„æ—¥å¿—è‡ªåŠ¨åŠ ä¸Šæ—¶é—´","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"æ—¥å¿—ç³»ç»Ÿ","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/æ—¥å¿—ç³»ç»Ÿ","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/æ—¥å¿—ç³»ç»Ÿ/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"c 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;syslog.h&gt; #include &lt;iostream&gt; #include &lt;string&gt; // å°è£…æ—¥å¿—å‡½æ•° class Logger &#123; public: Logger(const std::string&amp; appName) &#123; openlog(appName.c_str(), LOG_PID | LOG_CONS, LOG_USER); &#125; ~Logger() &#123; closelog(); &#125; void log(int priority, const std::string&amp; message) &#123; syslog(priority, &quot;%s&quot;, message.c_str()); &#125; // è®¾ç½®æ—¥å¿—æ©ç ä»¥è¿‡æ»¤æ—¥å¿—çº§åˆ« void setLogMask(int mask) &#123; setlogmask(mask); &#125; // ç¤ºä¾‹æ—¥å¿—æ–¹æ³• void debug(const std::string&amp; msg) &#123; log(LOG_DEBUG, msg); &#125; void info(const std::string&amp; msg) &#123; log(LOG_INFO, msg); &#125; void warning(const std::string&amp; msg) &#123; log(LOG_WARNING, msg); &#125; void error(const std::string&amp; msg) &#123; log(LOG_ERR, msg); &#125; &#125;; int main() &#123; Logger logger(&quot;MyApp&quot;); // è®¾ç½®æ—¥å¿—æ©ç ï¼Œè¿‡æ»¤æ‰ LOG_DEBUG çº§åˆ«çš„æ—¥å¿— logger.setLogMask(LOG_UPTO(LOG_INFO)); // å…è®¸ LOG_EMERG åˆ° LOG_INFOï¼Œä½†æ’é™¤ LOG_DEBUG // å°è¯•è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿— logger.debug(&quot;This is a debug message.&quot;); // è¿™å°†ä¸ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­ logger.info(&quot;This is an info message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ logger.warning(&quot;This is a warning message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ logger.error(&quot;This is an error message.&quot;); // è¿™å°†å‡ºç°åœ¨æ—¥å¿—ä¸­ return 0; &#125; https://blog.csdn.net/weixin_51322383/article/details/130464403 https://blog.csdn.net/weixin_51322383/article/details/130474753 å•ä¾‹æ¨¡å¼è®¾è®¡æ—¥å¿—æ¨¡å— æ‡’æ±‰æ¨¡å¼ï¼šè°ƒç”¨getInstanceçš„æ—¶å€™ï¼Œæ‰ä¼šå»åˆå§‹åŒ–ï¼Œåœ¨C++11åï¼Œä¸éœ€è¦åŠ é”ï¼Œç›´æ¥ä½¿ç”¨å‡½æ•°å†…å±€éƒ¨é™æ€å¯¹è±¡å³å¯ã€‚ é¥¿æ±‰æ¨¡å¼ï¼šç¨‹åºè¿è¡Œæ—¶ç«‹å³åˆå§‹åŒ–ï¼Œä¸éœ€è¦åŠ é” å¼‚æ­¥æ—¥å¿— éé˜»å¡ï¼Œå°†æ‰€å†™çš„æ—¥å¿—å†…å®¹å…ˆå­˜å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå†™çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­å–å‡ºå†…å®¹ï¼Œå†™å…¥æ—¥å¿—ã€‚ æ—¥å¿—é˜Ÿåˆ—æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä»–çš„éœ€æ±‚å°±æ˜¯æ—¶ä¸æ—¶ä¼šæœ‰ä¸€æ®µæ—¥å¿—æ”¾åˆ°é˜Ÿåˆ—é‡Œé¢ï¼Œæ—¶ä¸æ—¶åˆä¼šè¢«å–å‡ºæ¥ä¸€æ®µï¼Œè¿™ä¸å°±æ˜¯ç»å…¸çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å—ï¼Ÿæ‰€ä»¥è¿˜éœ€è¦åŠ é”ã€æ¡ä»¶å˜é‡ç­‰æ¥å¸®åŠ©è¿™ä¸ªé˜Ÿåˆ—å®ç°ã€‚ blockqueue.h123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159# ifndef BLOCKQUEUE_H# define BLOCKQUEUE_H#include &lt;deque&gt;#include &lt;condition_variable&gt;#include &lt;mutex&gt;#include &lt;sys/time.h&gt;using namespace std;template&lt;typename T&gt;class BlockQueue &#123;public: explicit BlockQueue(size_t maxsize = 1000); ~BlockQueue(); bool empty(); bool full(); void push_back(const T&amp; item); void push_front(const T&amp; item); bool pop(T&amp; item); // å¼¹å‡ºçš„ä»»åŠ¡æ”¾å…¥item bool pop(T&amp; item, int timeout); // ç­‰å¾…æ—¶é—´ void clear(); T front(); T back(); size_t capacity(); size_t size(); void flush(); void Close();private: deque&lt;T&gt; deq_; // åº•å±‚æ•°æ®ç»“æ„ mutex mtx_; // é” bool isClose_; // å…³é—­æ ‡å¿— size_t capacity_; // å®¹é‡ condition_variable condConsumer_; // æ¶ˆè´¹è€…æ¡ä»¶å˜é‡ condition_variable condProducer_; // ç”Ÿäº§è€…æ¡ä»¶å˜é‡&#125;;template&lt;typename T&gt;BlockQueue&lt;T&gt;::BlockQueue(size_t maxsize) : capacity_(maxsize) &#123; assert(maxsize &gt; 0); isClose_ = false;&#125;template&lt;typename T&gt;BlockQueue&lt;T&gt;::~BlockQueue() &#123; Close();&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::Close() &#123; // lock_guard&lt;mutex&gt; locker(mtx_); // æ“æ§é˜Ÿåˆ—ä¹‹å‰ï¼Œéƒ½éœ€è¦ä¸Šé” // deq_.clear(); // æ¸…ç©ºé˜Ÿåˆ— clear(); isClose_ = true; condConsumer_.notify_all(); condProducer_.notify_all();&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::clear() &#123; lock_guard&lt;mutex&gt; locker(mtx_); deq_.clear();&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::empty() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return deq_.empty();&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::full() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return deq_.size() &gt;= capacity_;&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::push_back(const T&amp; item) &#123; // æ³¨æ„ï¼Œæ¡ä»¶å˜é‡éœ€è¦æ­é…unique_lock unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.size() &gt;= capacity_) &#123; // é˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾… condProducer_.wait(locker); // æš‚åœç”Ÿäº§ï¼Œç­‰å¾…æ¶ˆè´¹è€…å”¤é†’ç”Ÿäº§æ¡ä»¶å˜é‡ &#125; deq_.push_back(item); condConsumer_.notify_one(); // å”¤é†’æ¶ˆè´¹è€…&#125;template&lt;typename T&gt;void BlockQueue&lt;T&gt;::push_front(const T&amp; item) &#123; unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.size() &gt;= capacity_) &#123; // é˜Ÿåˆ—æ»¡äº†ï¼Œéœ€è¦ç­‰å¾… condProducer_.wait(locker); // æš‚åœç”Ÿäº§ï¼Œç­‰å¾…æ¶ˆè´¹è€…å”¤é†’ç”Ÿäº§æ¡ä»¶å˜é‡ &#125; deq_.push_front(item); condConsumer_.notify_one(); // å”¤é†’æ¶ˆè´¹è€…&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::pop(T&amp; item) &#123; unique_lock&lt;mutex&gt; locker(mtx_); while(deq_.empty()) &#123; condConsumer_.wait(locker); // é˜Ÿåˆ—ç©ºäº†ï¼Œéœ€è¦ç­‰å¾… &#125; item = deq_.front(); deq_.pop_front(); condProducer_.notify_one(); // å”¤é†’ç”Ÿäº§è€… return true;&#125;template&lt;typename T&gt;bool BlockQueue&lt;T&gt;::pop(T &amp;item, int timeout) &#123; unique_lock&lt;std::mutex&gt; locker(mtx_); while(deq_.empty())&#123; if(condConsumer_.wait_for(locker, std::chrono::seconds(timeout)) == std::cv_status::timeout)&#123; return false; &#125; if(isClose_)&#123; return false; &#125; &#125; item = deq_.front(); deq_.pop_front(); condProducer_.notify_one(); return true;&#125;template&lt;typename T&gt;T BlockQueue&lt;T&gt;::front() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.front();&#125;template&lt;typename T&gt;T BlockQueue&lt;T&gt;::back() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.back();&#125;template&lt;typename T&gt;size_t BlockQueue&lt;T&gt;::capacity() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return capacity_;&#125;template&lt;typename T&gt;size_t BlockQueue&lt;T&gt;::size() &#123; lock_guard&lt;std::mutex&gt; locker(mtx_); return deq_.size();&#125;// å”¤é†’æ¶ˆè´¹è€…template&lt;typename T&gt;void BlockQueue&lt;T&gt;::flush() &#123; condConsumer_.notify_one();&#125;# endif log.h123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#ifndef LOG_H#define LOG_H#include &lt;mutex&gt;#include &lt;string&gt;#include &lt;thread&gt;#include &lt;sys/time.h&gt;#include &lt;string.h&gt;#include &lt;stdarg.h&gt; // vastart va_end#include &lt;assert.h&gt;#include &lt;sys/stat.h&gt; // mkdir#include &quot;blockqueue.h&quot;#include &quot;../buffer/buffer.h&quot;class Log &#123;public: // åˆå§‹åŒ–æ—¥å¿—å®ä¾‹ï¼ˆé˜»å¡é˜Ÿåˆ—æœ€å¤§å®¹é‡ã€æ—¥å¿—ä¿å­˜è·¯å¾„ã€æ—¥å¿—æ–‡ä»¶åç¼€ï¼‰ void init(int level, const char* path = &quot;./log&quot;, const char* suffix =&quot;.log&quot;, int maxQueueCapacity = 1024); static Log* Instance(); static void FlushLogThread(); // å¼‚æ­¥å†™æ—¥å¿—å…¬æœ‰æ–¹æ³•ï¼Œè°ƒç”¨ç§æœ‰æ–¹æ³•asyncWrite void write(int level, const char *format,...); // å°†è¾“å‡ºå†…å®¹æŒ‰ç…§æ ‡å‡†æ ¼å¼æ•´ç† void flush(); int GetLevel(); void SetLevel(int level); bool IsOpen() &#123; return isOpen_; &#125; private: Log(); void AppendLogLevelTitle_(int level); virtual ~Log(); void AsyncWrite_(); // å¼‚æ­¥å†™æ—¥å¿—æ–¹æ³•private: static const int LOG_PATH_LEN = 256; // æ—¥å¿—æ–‡ä»¶æœ€é•¿æ–‡ä»¶å static const int LOG_NAME_LEN = 256; // æ—¥å¿—æœ€é•¿åå­— static const int MAX_LINES = 50000; // æ—¥å¿—æ–‡ä»¶å†…çš„æœ€é•¿æ—¥å¿—æ¡æ•° const char* path_; //è·¯å¾„å const char* suffix_; //åç¼€å int MAX_LINES_; // æœ€å¤§æ—¥å¿—è¡Œæ•° int lineCount_; //æ—¥å¿—è¡Œæ•°è®°å½• int toDay_; //æŒ‰å½“å¤©æ—¥æœŸåŒºåˆ†æ–‡ä»¶ bool isOpen_; Buffer buff_; // è¾“å‡ºçš„å†…å®¹ï¼Œç¼“å†²åŒº int level_; // æ—¥å¿—ç­‰çº§ bool isAsync_; // æ˜¯å¦å¼€å¯å¼‚æ­¥æ—¥å¿— FILE* fp_; //æ‰“å¼€logçš„æ–‡ä»¶æŒ‡é’ˆ std::unique_ptr&lt;BlockQueue&lt;std::string&gt;&gt; deque_; //é˜»å¡é˜Ÿåˆ— std::unique_ptr&lt;std::thread&gt; writeThread_; //å†™çº¿ç¨‹çš„æŒ‡é’ˆ std::mutex mtx_; //åŒæ­¥æ—¥å¿—å¿…éœ€çš„äº’æ–¥é‡&#125;;#define LOG_BASE(level, format, ...) \\ do &#123;\\ Log* log = Log::Instance();\\ if (log-&gt;IsOpen() &amp;&amp; log-&gt;GetLevel() &lt;= level) &#123;\\ log-&gt;write(level, format, ##__VA_ARGS__); \\ log-&gt;flush();\\ &#125;\\ &#125; while(0);// å››ä¸ªå®å®šä¹‰ï¼Œä¸»è¦ç”¨äºä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºï¼Œä¹Ÿæ˜¯å¤–éƒ¨ä½¿ç”¨æ—¥å¿—çš„æ¥å£// ...è¡¨ç¤ºå¯å˜å‚æ•°ï¼Œ__VA_ARGS__å°±æ˜¯å°†...çš„å€¼å¤åˆ¶åˆ°è¿™é‡Œ// å‰é¢åŠ ä¸Š##çš„ä½œç”¨æ˜¯ï¼šå½“å¯å˜å‚æ•°çš„ä¸ªæ•°ä¸º0æ—¶ï¼Œè¿™é‡Œçš„##å¯ä»¥æŠŠæŠŠå‰é¢å¤šä½™çš„&quot;,&quot;å»æ‰,å¦åˆ™ä¼šç¼–è¯‘å‡ºé”™ã€‚#define LOG_DEBUG(format, ...) do &#123;LOG_BASE(0, format, ##__VA_ARGS__)&#125; while(0); #define LOG_INFO(format, ...) do &#123;LOG_BASE(1, format, ##__VA_ARGS__)&#125; while(0);#define LOG_WARN(format, ...) do &#123;LOG_BASE(2, format, ##__VA_ARGS__)&#125; while(0);#define LOG_ERROR(format, ...) do &#123;LOG_BASE(3, format, ##__VA_ARGS__)&#125; while(0);#endif //LOG_H log.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191#include &quot;log.h&quot;// æ„é€ å‡½æ•°Log::Log() &#123; fp_ = nullptr; deque_ = nullptr; writeThread_ = nullptr; lineCount_ = 0; toDay_ = 0; isAsync_ = false;&#125;Log::~Log() &#123; while(!deque_-&gt;empty()) &#123; deque_-&gt;flush(); // å”¤é†’æ¶ˆè´¹è€…ï¼Œå¤„ç†æ‰å‰©ä¸‹çš„ä»»åŠ¡ &#125; deque_-&gt;Close(); // å…³é—­é˜Ÿåˆ— writeThread_-&gt;join(); // ç­‰å¾…å½“å‰çº¿ç¨‹å®Œæˆæ‰‹ä¸­çš„ä»»åŠ¡ if(fp_) &#123; // å†²æ´—æ–‡ä»¶ç¼“å†²åŒºï¼Œå…³é—­æ–‡ä»¶æè¿°ç¬¦ lock_guard&lt;mutex&gt; locker(mtx_); flush(); // æ¸…ç©ºç¼“å†²åŒºä¸­çš„æ•°æ® fclose(fp_); // å…³é—­æ—¥å¿—æ–‡ä»¶ &#125;&#125;// å”¤é†’é˜»å¡é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼Œå¼€å§‹å†™æ—¥å¿—void Log::flush() &#123; if(isAsync_) &#123; // åªæœ‰å¼‚æ­¥æ—¥å¿—æ‰ä¼šç”¨åˆ°deque deque_-&gt;flush(); &#125; fflush(fp_); // æ¸…ç©ºè¾“å…¥ç¼“å†²åŒº&#125;// æ‡’æ±‰æ¨¡å¼ å±€éƒ¨é™æ€å˜é‡æ³•ï¼ˆè¿™ç§æ–¹æ³•ä¸éœ€è¦åŠ é”å’Œè§£é”æ“ä½œï¼‰Log* Log::Instance() &#123; static Log log; return &amp;log;&#125;// å¼‚æ­¥æ—¥å¿—çš„å†™çº¿ç¨‹å‡½æ•°void Log::FlushLogThread() &#123; Log::Instance()-&gt;AsyncWrite_();&#125;// å†™çº¿ç¨‹çœŸæ­£çš„æ‰§è¡Œå‡½æ•°void Log::AsyncWrite_() &#123; string str = &quot;&quot;; while(deque_-&gt;pop(str)) &#123; lock_guard&lt;mutex&gt; locker(mtx_); fputs(str.c_str(), fp_); &#125;&#125;// åˆå§‹åŒ–æ—¥å¿—å®ä¾‹void Log::init(int level, const char* path, const char* suffix, int maxQueCapacity) &#123; isOpen_ = true; level_ = level; path_ = path; suffix_ = suffix; if(maxQueCapacity) &#123; // å¼‚æ­¥æ–¹å¼ isAsync_ = true; if(!deque_) &#123; // ä¸ºç©ºåˆ™åˆ›å»ºä¸€ä¸ª unique_ptr&lt;BlockQueue&lt;std::string&gt;&gt; newQue(new BlockQueue&lt;std::string&gt;); // å› ä¸ºunique_pträ¸æ”¯æŒæ™®é€šçš„æ‹·è´æˆ–èµ‹å€¼æ“ä½œ,æ‰€ä»¥é‡‡ç”¨move // å°†åŠ¨æ€ç”³è¯·çš„å†…å­˜æƒç»™dequeï¼ŒnewDequeè¢«é‡Šæ”¾ deque_ = move(newQue); // å·¦å€¼å˜å³å€¼,æç©ºnewDeque unique_ptr&lt;thread&gt; newThread(new thread(FlushLogThread)); writeThread_ = move(newThread); &#125; &#125; else &#123; isAsync_ = false; &#125; lineCount_ = 0; time_t timer = time(nullptr); struct tm* systime = localtime(&amp;timer); char fileName[LOG_NAME_LEN] = &#123;0&#125;; snprintf(fileName, LOG_NAME_LEN - 1, &quot;%s/%04d_%02d_%02d%s&quot;, path_, systime-&gt;tm_year + 1900, systime-&gt;tm_mon + 1, systime-&gt;tm_mday, suffix_); toDay_ = systime-&gt;tm_mday; &#123; lock_guard&lt;mutex&gt; locker(mtx_); buff_.RetrieveAll(); if(fp_) &#123; // é‡æ–°æ‰“å¼€ flush(); fclose(fp_); &#125; fp_ = fopen(fileName, &quot;a&quot;); // æ‰“å¼€æ–‡ä»¶è¯»å–å¹¶é™„åŠ å†™å…¥ if(fp_ == nullptr) &#123; mkdir(fileName, 0777); fp_ = fopen(fileName, &quot;a&quot;); // ç”Ÿæˆç›®å½•æ–‡ä»¶ï¼ˆæœ€å¤§æƒé™ï¼‰ &#125; assert(fp_ != nullptr); &#125;&#125;void Log::write(int level, const char *format, ...) &#123; struct timeval now = &#123;0, 0&#125;; gettimeofday(&amp;now, nullptr); time_t tSec = now.tv_sec; struct tm *sysTime = localtime(&amp;tSec); struct tm t = *sysTime; va_list vaList; // æ—¥å¿—æ—¥æœŸ æ—¥å¿—è¡Œæ•° å¦‚æœä¸æ˜¯ä»Šå¤©æˆ–è¡Œæ•°è¶…äº† if (toDay_ != t.tm_mday || (lineCount_ &amp;&amp; (lineCount_ % MAX_LINES == 0))) &#123; unique_lock&lt;mutex&gt; locker(mtx_); locker.unlock(); char newFile[LOG_NAME_LEN]; char tail[36] = &#123;0&#125;; snprintf(tail, 36, &quot;%04d_%02d_%02d&quot;, t.tm_year + 1900, t.tm_mon + 1, t.tm_mday); if (toDay_ != t.tm_mday) // æ—¶é—´ä¸åŒ¹é…ï¼Œåˆ™æ›¿æ¢ä¸ºæœ€æ–°çš„æ—¥å¿—æ–‡ä»¶å &#123; snprintf(newFile, LOG_NAME_LEN - 72, &quot;%s/%s%s&quot;, path_, tail, suffix_); toDay_ = t.tm_mday; lineCount_ = 0; &#125; else &#123; snprintf(newFile, LOG_NAME_LEN - 72, &quot;%s/%s-%d%s&quot;, path_, tail, (lineCount_ / MAX_LINES), suffix_); &#125; locker.lock(); flush(); fclose(fp_); fp_ = fopen(newFile, &quot;a&quot;); assert(fp_ != nullptr); &#125; // åœ¨bufferå†…ç”Ÿæˆä¸€æ¡å¯¹åº”çš„æ—¥å¿—ä¿¡æ¯ &#123; unique_lock&lt;mutex&gt; locker(mtx_); lineCount_++; int n = snprintf(buff_.BeginWrite(), 128, &quot;%d-%02d-%02d %02d:%02d:%02d.%06ld &quot;, t.tm_year + 1900, t.tm_mon + 1, t.tm_mday, t.tm_hour, t.tm_min, t.tm_sec, now.tv_usec); buff_.HasWritten(n); AppendLogLevelTitle_(level); va_start(vaList, format); int m = vsnprintf(buff_.BeginWrite(), buff_.WritableBytes(), format, vaList); va_end(vaList); buff_.HasWritten(m); buff_.Append(&quot;\\n\\0&quot;, 2); if(isAsync_ &amp;&amp; deque_ &amp;&amp; !deque_-&gt;full()) &#123; // å¼‚æ­¥æ–¹å¼ï¼ˆåŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…å†™çº¿ç¨‹è¯»å–æ—¥å¿—ä¿¡æ¯ï¼‰ deque_-&gt;push_back(buff_.RetrieveAllToStr()); &#125; else &#123; // åŒæ­¥æ–¹å¼ï¼ˆç›´æ¥å‘æ–‡ä»¶ä¸­å†™å…¥æ—¥å¿—ä¿¡æ¯ï¼‰ fputs(buff_.Peek(), fp_); // åŒæ­¥å°±ç›´æ¥å†™å…¥æ–‡ä»¶ &#125; buff_.RetrieveAll(); // æ¸…ç©ºbuff &#125;&#125;// æ·»åŠ æ—¥å¿—ç­‰çº§void Log::AppendLogLevelTitle_(int level) &#123; switch(level) &#123; case 0: buff_.Append(&quot;[debug]: &quot;, 9); break; case 1: buff_.Append(&quot;[info] : &quot;, 9); break; case 2: buff_.Append(&quot;[warn] : &quot;, 9); break; case 3: buff_.Append(&quot;[error]: &quot;, 9); break; default: buff_.Append(&quot;[info] : &quot;, 9); break; &#125;&#125;int Log::GetLevel() &#123; lock_guard&lt;mutex&gt; locker(mtx_); return level_;&#125;void Log::SetLevel(int level) &#123; lock_guard&lt;mutex&gt; locker(mtx_); level_ = level;&#125;","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"TCP/IPåè®®è¯¦è§£","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/TCPIPåè®®è¯¦è§£","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/TCPIPåè®®è¯¦è§£/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/TCPIP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ -æ¸¸åŒè‘— â€‹ ä½œè€…å……åˆ†ç†è§£å·¨ä½œã€ŠTCP&#x2F;IPåè®®è¯¦è§£ã€‹ï¼ˆä¸‰å·æœ¬ï¼‰ï¼Œä»¥åŠã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ï¼ˆä¸¤å·æœ¬ï¼‰åèå…¥è‡ªå·±çš„ç†è§£ç¼–å†™ â€‹ ä¸»é¢˜ï¼š&#x3D;&#x3D;å¦‚ä½•é€šè¿‡å„ç§æ‰‹æ®µç¼–å†™é«˜æ€§èƒ½çš„æœåŠ¡å™¨ç¨‹åº&#x3D;&#x3D; å¦‚ä½•æé«˜æœåŠ¡å™¨ç¨‹åºæ€§èƒ½ï¼Ÿ æ¯”å¦‚ä½¿ç”¨â€œæ± â€ä»¥ç‰ºç‰²ç©ºé—´æ¢å–æ•ˆç‡ï¼Œä½¿ç”¨é›¶æ‹·è´å‡½æ•°ä»¥é¿å…å†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„åˆ‡æ¢ç­‰ï¼› å…¶æ¬¡ï¼Œä»‹ç»ä¸€äº›é«˜æ•ˆçš„ç¼–ç¨‹æ¨¡å¼åŠå…¶åº”ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨æœ‰é™çŠ¶æ€æœºæ¥åˆ†æç”¨æˆ·æ•°æ®ï¼Œä½¿ç”¨è¿›ç¨‹æ± æˆ–çº¿ç¨‹æ± æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼›æœ€åï¼Œæ¢è®¨å¦‚ä½•é€šè¿‡è°ƒæ•´ç³»ç»Ÿå‚æ•°æ¥ä»æœåŠ¡å™¨ç¨‹åºå¤–éƒ¨æé«˜å…¶æ•´ä½“æ€§èƒ½ã€‚ ä¸ºäº†å¸®åŠ©è¯»è€…è¿›ä¸€æ­¥æŠŠä¹¦ä¸­çš„çŸ¥è¯†èæ±‡åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œç¬”è€…è¿˜ç‰¹æ„ç¼–å†™äº†ä¸€ä¸ªè¾ƒä¸ºå®Œæ•´çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç¨‹åºspringsnailã€‚è¯¥ç¨‹åºèƒ½ä»æ‰€æœ‰é€»è¾‘æœåŠ¡å™¨ä¸­é€‰å–è´Ÿè·æœ€å°çš„ä¸€å°æ¥å¤„ç†æ–°åˆ°çš„å®¢æˆ·è¿æ¥ã€‚åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œä½¿ç”¨äº†è¿›ç¨‹æ± ã€æœ‰é™çŠ¶æ€æœºã€é«˜æ•ˆæ•°æ®ç»“æ„æ¥æé«˜å…¶æ€§èƒ½ï¼›åŒæ—¶ï¼Œç»†è‡´åœ°å°è£…äº†æ¯ä¸ªå‡½æ•°å’Œæ¨¡å—ï¼Œä½¿ä¹‹æ›´ç¬¦åˆå®é™…å·¥ç¨‹é¡¹ç›®ã€‚ç”±äºç¯‡å¹…çš„é™åˆ¶ï¼Œç¬”è€…æœªå°†è¯¥ç¨‹åºçš„æºä»£ç åˆ—åœ¨ä¹¦ä¸­ï¼Œè¯»è€…å¯ä»åç« ç½‘ç«™www.hzbook.comã€‚ ä»¥ä¸Šå†…å®¹æ•´æœ¬ä¹¦é˜…è¯»å®Œä¹‹åå†çœ‹å§ æœ€å¼€å§‹çš„ç›®çš„æ˜¯å†™ä¸€ä¸ªèµ·ç æ˜¯å…ˆçœ‹æ‡‚tinywebserverè¿™ä¸ªé¡¹ç›® ç„¶åäº†è§£åˆ°è¦å…ˆçœ‹è¿™æœ¬ä¹¦ï¼Œç°åœ¨å¯è°“æ˜¯0åŸºç¡€å¼€å§‹ å…ˆå®‰è£…ä¸¤å°è™šæ‹Ÿæœºç”¨äºæµ‹è¯•ï¼Œæˆ‘æ‰“ç®—ä¸€å°Anolis OSä¸€å°Ubuntu Ubuntuæ­£åœ¨å®‰ï¼Œå‡ºäº†ç‚¹çŠ¶å†µï¼Œå®‰è£…ç•Œé¢ä¼šä¸€ç›´å¡ä½ TCP&#x2F;IPåè®®è¯¦è§£ #TCP&#x2F;IPåè®®æ— TCP&#x2F;IPåè®®æ—ä½“ç³»ç»“æ„ä»¥åŠä¸»è¦åè®®TCP&#x2F;IPåè®®æ—æ˜¯ä¸€ä¸ªå››å±‚åè®®ç³»ç»Ÿï¼Œè‡ªåº•è€Œä¸Šåˆ†åˆ«æ˜¯æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ ####æ•°æ®é“¾è·¯å±‚ å®ç°äº†ç½‘å¡æ¥å£çš„ç½‘ç»œé©±åŠ¨ç¨‹åº ä»¥å¤„ç†æ•°æ®åœ¨ç‰©ç†åª’ä»‹ï¼ˆæ¯”å¦‚ä»¥å¤ªç½‘ã€ä»¤ç‰Œç¯ç­‰ï¼‰ä¸Šçš„ä¼ è¾“ ç½‘ç»œé©±åŠ¨ç¨‹åºéšè—äº†è¿™äº›ç»†èŠ‚ä¸ºä¸Šå±‚åè®®æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ åè®® æ•°æ®é“¾è·¯å±‚ä¸¤ä¸ªå¸¸ç”¨çš„åè®®æ˜¯&#x3D;&#x3D;ARP&#x3D;&#x3D;åè®®ï¼ˆAddress ResolveProtocolï¼Œåœ°å€è§£æåè®®ï¼‰å’Œ&#x3D;&#x3D;RARP&#x3D;&#x3D;åè®®ï¼ˆReverse Address ResolveProtocolï¼Œé€†åœ°å€è§£æåè®®ï¼‰ã€‚å®ƒä»¬å®ç°äº†IPåœ°å€å’Œæœºå™¨ç‰©ç†åœ°å€ï¼ˆé€šå¸¸æ˜¯MACåœ°å€ï¼Œä»¥å¤ªç½‘ã€ä»¤ç‰Œç¯å’Œ802.11æ— çº¿ç½‘ç»œéƒ½ä½¿ç”¨MACåœ°å€ï¼‰ä¹‹é—´çš„ç›¸äº’è½¬æ¢ ä½œç”¨ ç½‘ç»œå±‚ä½¿ç”¨IPåœ°å€å¯»å€ä¸€å°æœºå™¨ï¼Œè€Œæ•°æ®é“¾è·¯å±‚ä½¿ç”¨ç‰©ç†åœ°å€å¯»å€ä¸€å°æœºå™¨ï¼Œå› æ­¤ç½‘ç»œå±‚å¿…é¡»å…ˆå°†ç›®æ ‡æœºå™¨çš„IPåœ°å€è½¬åŒ–æˆå…¶ç‰©ç†åœ°å€ï¼Œæ‰èƒ½ä½¿ç”¨æ•°æ®é“¾è·¯å±‚æä¾›çš„æœåŠ¡ï¼Œè¿™å°±æ˜¯ARPåè®®çš„ç”¨é€”ã€‚ RARPåè®®ä»…ç”¨äºç½‘ç»œä¸Šçš„æŸäº›æ— ç›˜å·¥ä½œç«™ã€‚å› ä¸ºç¼ºä¹å­˜å‚¨è®¾å¤‡ï¼Œæ— ç›˜å·¥ä½œç«™æ— æ³•è®°ä½è‡ªå·±çš„IPåœ°å€ï¼Œä½†å®ƒä»¬å¯ä»¥åˆ©ç”¨ç½‘å¡ä¸Šçš„ç‰©ç†åœ°å€æ¥å‘ç½‘ç»œç®¡ç†è€…ï¼ˆæœåŠ¡å™¨æˆ–ç½‘ç»œç®¡ç†è½¯ä»¶ï¼‰æŸ¥è¯¢è‡ªèº«çš„IPåœ°å€ã€‚è¿è¡ŒRARPæœåŠ¡çš„ç½‘ç»œç®¡ç†è€…é€šå¸¸å­˜æœ‰è¯¥ç½‘ç»œä¸Šæ‰€æœ‰æœºå™¨çš„ç‰©ç†åœ°å€åˆ°IPåœ°å€çš„æ˜ å°„ã€‚ ç½‘ç»œå±‚ç½‘ç»œå±‚å®ç°æ•°æ®åŒ…çš„é€‰è·¯å’Œè½¬å‘ è¿æ¥ WANï¼ˆWide Area Networkï¼Œå¹¿åŸŸç½‘ï¼‰é€šå¸¸ä½¿ç”¨ä¼—å¤šåˆ†çº§çš„è·¯ç”±å™¨æ¥è¿æ¥åˆ†æ•£çš„ä¸»æœºæˆ–LANï¼ˆLocalArea Networkï¼Œå±€åŸŸç½‘ï¼‰ï¼Œå› æ­¤ï¼Œé€šä¿¡çš„ä¸¤å°ä¸»æœºä¸€èˆ¬ä¸æ˜¯ç›´æ¥ç›¸è¿çš„ï¼Œè€Œæ˜¯é€šè¿‡å¤šä¸ªä¸­é—´èŠ‚ç‚¹ï¼ˆè·¯ç”±å™¨ï¼‰è¿æ¥çš„ã€‚ç½‘ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©è¿™äº›ä¸­é—´èŠ‚ç‚¹ï¼Œä»¥ç¡®å®šä¸¤å°ä¸»æœºä¹‹é—´çš„é€šä¿¡è·¯å¾„ã€‚åŒæ—¶ï¼Œç½‘ç»œå±‚å¯¹ä¸Šå±‚åè®®éšè—äº†ç½‘ç»œæ‹“æ‰‘è¿æ¥çš„ç»†èŠ‚ï¼Œä½¿å¾—åœ¨ä¼ è¾“å±‚å’Œç½‘ç»œåº”ç”¨ç¨‹åºçœ‹æ¥ï¼Œé€šä¿¡çš„åŒæ–¹æ˜¯ç›´æ¥ç›¸è¿çš„ã€‚ åè®® ç½‘ç»œå±‚æœ€æ ¸å¿ƒçš„åè®®æ˜¯&#x3D;&#x3D;IPåè®®&#x3D;&#x3D;ï¼ˆInternet Protocolï¼Œå› ç‰¹ç½‘åè®®ï¼‰ã€‚IPåè®®æ ¹æ®æ•°æ®åŒ…çš„ç›®çš„IPåœ°å€æ¥å†³å®šå¦‚ä½•æŠ•é€’å®ƒã€‚å¦‚æœæ•°æ®åŒ…ä¸èƒ½ç›´æ¥å‘é€ç»™ç›®æ ‡ä¸»æœºï¼Œé‚£ä¹ˆIPåè®®å°±ä¸ºå®ƒå¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„ä¸‹ä¸€è·³ï¼ˆnexthopï¼‰è·¯ç”±å™¨ï¼Œå¹¶å°†æ•°æ®åŒ…äº¤ä»˜ç»™è¯¥è·¯ç”±å™¨æ¥è½¬å‘ã€‚å¤šæ¬¡é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œæ•°æ®åŒ…æœ€ç»ˆåˆ°è¾¾ç›®æ ‡ä¸»æœºï¼Œæˆ–è€…ç”±äºå‘é€å¤±è´¥è€Œè¢«ä¸¢å¼ƒã€‚å¯è§ï¼ŒIPåè®®ä½¿ç”¨é€è·³ï¼ˆhop by hopï¼‰çš„æ–¹å¼ç¡®å®šé€šä¿¡è·¯å¾„ã€‚ ç½‘ç»œå±‚å¦å¤–ä¸€ä¸ªé‡è¦çš„åè®®æ˜¯&#x3D;&#x3D;ICMPåè®®&#x3D;&#x3D;ï¼ˆInternet Control MessageProtocolï¼Œå› ç‰¹ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼‰ã€‚å®ƒæ˜¯IPåè®®çš„é‡è¦è¡¥å……ï¼Œä¸»è¦ç”¨äºæ£€æµ‹ç½‘ç»œè¿æ¥ã€‚ 8ä½ç±»å‹å­—æ®µç”¨äºåŒºåˆ†æŠ¥æ–‡ç±»å‹ã€‚å®ƒå°†ICMPæŠ¥æ–‡åˆ†ä¸ºä¸¤å¤§ç±»ï¼šä¸€ç±»æ˜¯å·®é”™æŠ¥æ–‡ï¼Œè¿™ç±»æŠ¥æ–‡ä¸»è¦ç”¨æ¥å›åº”ç½‘ç»œé”™è¯¯ï¼Œæ¯”å¦‚ç›®æ ‡ä¸å¯åˆ°è¾¾ï¼ˆç±»å‹å€¼ä¸º3ï¼‰å’Œé‡å®šå‘ï¼ˆç±»å‹å€¼ä¸º5ï¼‰ï¼›å¦ä¸€ç±»æ˜¯æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¿™ç±»æŠ¥æ–‡ç”¨æ¥æŸ¥è¯¢ç½‘ç»œä¿¡æ¯ï¼Œæ¯”å¦‚pingç¨‹åºå°±æ˜¯ä½¿ç”¨ICMPæŠ¥æ–‡æŸ¥çœ‹ç›®æ ‡æ˜¯å¦å¯åˆ°è¾¾ï¼ˆç±»å‹å€¼ä¸º8ï¼‰çš„ã€‚ æœ‰çš„ICMPæŠ¥æ–‡è¿˜ä½¿ç”¨8ä½ä»£ç å­—æ®µæ¥è¿›ä¸€æ­¥ç»†åˆ†ä¸åŒçš„æ¡ä»¶ã€‚æ¯”å¦‚é‡å®šå‘æŠ¥æ–‡ä½¿ç”¨ä»£ç å€¼0è¡¨ç¤ºå¯¹ç½‘ç»œé‡å®šå‘ï¼Œä»£ç å€¼1è¡¨ç¤ºå¯¹ä¸»æœºé‡å®šå‘ã€‚ ICMPæŠ¥æ–‡ä½¿ç”¨16ä½æ ¡éªŒå’Œå­—æ®µå¯¹æ•´ä¸ªæŠ¥æ–‡ï¼ˆåŒ…æ‹¬å¤´éƒ¨å’Œå†…å®¹éƒ¨åˆ†ï¼‰è¿›è¡Œå¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCyclicRedundancy Checkï¼ŒCRCï¼‰ï¼Œä»¥æ£€éªŒæŠ¥æ–‡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåã€‚ ICMPåè®®å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„ç½‘ç»œå±‚åè®®ï¼Œå› ä¸ºå®ƒä½¿ç”¨å¤„äºåŒä¸€å±‚çš„IPåè®®æä¾›çš„æœåŠ¡ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œä¸Šå±‚åè®®ä½¿ç”¨ä¸‹å±‚åè®®æä¾›çš„æœåŠ¡ï¼‰ ä¼ è¾“å±‚ä¼ è¾“å±‚ä¸ºä¸¤å°ä¸»æœºä¸Šçš„åº”ç”¨ç¨‹åºæä¾›ç«¯åˆ°ç«¯ï¼ˆend to endï¼‰çš„é€šä¿¡ã€‚ä¸åœ¨ä¹ä¸­è½¬è¿‡ç¨‹ å®çº¿æ˜¯å®ä½“é€šä¿¡ï¼Œè™šçº¿æ˜¯é€»è¾‘é€šä¿¡ ä¼ è¾“å±‚åˆ™ä¸ºåº”ç”¨ç¨‹åºå°è£…äº†ä¸€æ¡ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡é“¾è·¯ï¼Œå®ƒè´Ÿè´£æ•°æ®çš„æ”¶å‘ã€é“¾è·¯çš„è¶…æ—¶é‡è¿ç­‰ åè®® &#x3D;&#x3D;TCPåè®®&#x3D;&#x3D;ï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰ä¸ºåº”ç”¨å±‚æä¾›å¯é çš„ã€é¢å‘è¿æ¥çš„å’ŒåŸºäºæµï¼ˆstreamï¼‰çš„æœåŠ¡ã€‚TCPåè®®ä½¿ç”¨è¶…æ—¶é‡ä¼ ã€æ•°æ®ç¡®è®¤ç­‰æ–¹å¼æ¥ç¡®ä¿æ•°æ®åŒ…è¢«æ­£ç¡®åœ°å‘é€è‡³ç›®çš„ç«¯ï¼Œå› æ­¤TCPæœåŠ¡æ˜¯å¯é çš„ã€‚ä½¿ç”¨TCPåè®®é€šä¿¡çš„åŒæ–¹å¿…é¡»å…ˆå»ºç«‹TCPè¿æ¥ï¼Œå¹¶åœ¨å†…æ ¸ä¸­ä¸ºè¯¥è¿æ¥ç»´æŒä¸€äº›å¿…è¦çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚è¿æ¥çš„çŠ¶æ€ã€è¯»å†™ç¼“å†²åŒºï¼Œä»¥åŠè¯¸å¤šå®šæ—¶å™¨ç­‰ã€‚å½“é€šä¿¡ç»“æŸæ—¶ï¼ŒåŒæ–¹å¿…é¡»å…³é—­è¿æ¥ä»¥é‡Šæ”¾è¿™äº›å†…æ ¸æ•°æ®ã€‚TCPæœåŠ¡æ˜¯åŸºäºæµçš„ã€‚åŸºäºæµçš„æ•°æ®æ²¡æœ‰è¾¹ç•Œï¼ˆé•¿åº¦ï¼‰é™åˆ¶ï¼Œå®ƒæºæºä¸æ–­åœ°ä»é€šä¿¡çš„ä¸€ç«¯æµå…¥å¦ä¸€ç«¯ã€‚å‘é€ç«¯å¯ä»¥é€ä¸ªå­—èŠ‚åœ°å‘æ•°æ®æµä¸­å†™å…¥æ•°æ®ï¼Œæ¥æ”¶ç«¯ä¹Ÿå¯ä»¥é€ä¸ªå­—èŠ‚åœ°å°†å®ƒä»¬è¯»å‡ºã€‚ &#x3D;&#x3D;UDPåè®®&#x3D;&#x3D;ï¼ˆUser Datagram Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰åˆ™ä¸TCPåè®®å®Œå…¨ç›¸åï¼Œå®ƒä¸ºåº”ç”¨å±‚æä¾›ä¸å¯é ã€æ— è¿æ¥å’ŒåŸºäºæ•°æ®æŠ¥çš„æœåŠ¡ã€‚â€œä¸å¯é â€æ„å‘³ç€UDPåè®®æ— æ³•ä¿è¯æ•°æ®ä»å‘é€ç«¯æ­£ç¡®åœ°ä¼ é€åˆ°ç›®çš„ç«¯ã€‚å¦‚æœæ•°æ®åœ¨ä¸­é€”ä¸¢å¤±ï¼Œæˆ–è€…ç›®çš„ç«¯é€šè¿‡æ•°æ®æ ¡éªŒå‘ç°æ•°æ®é”™è¯¯è€Œå°†å…¶ä¸¢å¼ƒï¼Œåˆ™UDPåè®®åªæ˜¯ç®€å•åœ°é€šçŸ¥åº”ç”¨ç¨‹åºå‘é€å¤±è´¥ã€‚å› æ­¤ï¼Œä½¿ç”¨UDPåè®®çš„åº”ç”¨ç¨‹åºé€šå¸¸è¦è‡ªå·±å¤„ç†æ•°æ®ç¡®è®¤ã€è¶…æ—¶é‡ä¼ ç­‰é€»è¾‘ã€‚UDPåè®®æ˜¯æ— è¿æ¥çš„ï¼Œå³é€šä¿¡åŒæ–¹ä¸ä¿æŒä¸€ä¸ªé•¿ä¹…çš„è”ç³»ï¼Œå› æ­¤åº”ç”¨ç¨‹åºæ¯æ¬¡å‘é€æ•°æ®éƒ½è¦æ˜ç¡®æŒ‡å®šæ¥æ”¶ç«¯çš„åœ°å€ï¼ˆIPåœ°å€ç­‰ä¿¡æ¯ï¼‰ã€‚åŸºäºæ•°æ®æŠ¥çš„æœåŠ¡ï¼Œæ˜¯ç›¸å¯¹åŸºäºæµçš„æœåŠ¡è€Œè¨€çš„ã€‚æ¯ä¸ªUDPæ•°æ®æŠ¥éƒ½æœ‰ä¸€ä¸ªé•¿åº¦ï¼Œæ¥æ”¶ç«¯å¿…é¡»ä»¥è¯¥é•¿åº¦ä¸ºæœ€å°å•ä½å°†å…¶æ‰€æœ‰å†…å®¹ä¸€æ¬¡æ€§è¯»å‡ºï¼Œå¦åˆ™æ•°æ®å°†è¢«æˆªæ–­ã€‚ &#x3D;&#x3D;SCTPåè®®&#x3D;&#x3D;ï¼ˆStream Control Transmission Protocolï¼Œæµæ§åˆ¶ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§ç›¸å¯¹è¾ƒæ–°çš„ä¼ è¾“å±‚åè®®ï¼Œå®ƒæ˜¯ä¸ºäº†åœ¨å› ç‰¹ç½‘ä¸Šä¼ è¾“ç”µè¯ä¿¡å·è€Œè®¾è®¡çš„ã€‚ åº”ç”¨å±‚åº”ç”¨å±‚è´Ÿè´£å¤„ç†åº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚å’Œä¼ è¾“å±‚è´Ÿè´£å¤„ç†ç½‘ç»œé€šä¿¡ç»†èŠ‚ åè®® &#x3D;&#x3D;ping&#x3D;&#x3D;æ˜¯åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯åè®®ï¼Œå‰é¢è¯´è¿‡å®ƒåˆ©ç”¨ICMPæŠ¥æ–‡æ£€æµ‹ç½‘ç»œè¿æ¥ï¼Œæ˜¯è°ƒè¯•ç½‘ç»œç¯å¢ƒçš„å¿…å¤‡å·¥å…·ã€‚ &#x3D;&#x3D;telnet&#x3D;&#x3D;åè®®æ˜¯ä¸€ç§è¿œç¨‹ç™»å½•åè®®ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½åœ¨æœ¬åœ°å®Œæˆè¿œç¨‹ä»»åŠ¡ï¼Œæœ¬ä¹¦åç»­ç« èŠ‚å°†ä¼šå¤šæ¬¡ä½¿ç”¨telnetå®¢æˆ·ç«¯ç™»å½•åˆ°å…¶ä»–æœåŠ¡ä¸Š &#x3D;&#x3D;OSPF&#x3D;&#x3D;ï¼ˆOpen Shortest Path Firstï¼Œå¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰åè®®æ˜¯ä¸€ç§åŠ¨æ€è·¯ç”±æ›´æ–°åè®®ï¼Œç”¨äºè·¯ç”±å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥å‘ŠçŸ¥å¯¹æ–¹å„è‡ªçš„è·¯ç”±ä¿¡æ¯ &#x3D;&#x3D;DNS&#x3D;&#x3D;ï¼ˆDomain Name Serviceï¼ŒåŸŸåæœåŠ¡ï¼‰åè®®æä¾›æœºå™¨åŸŸååˆ°IPåœ°å€çš„è½¬æ¢ åº”ç”¨å±‚åè®®ï¼ˆæˆ–ç¨‹åºï¼‰å¯èƒ½è·³è¿‡ä¼ è¾“å±‚ç›´æ¥ä½¿ç”¨ç½‘ç»œå±‚æä¾›çš„æœåŠ¡ï¼Œæ¯”å¦‚pingç¨‹åºå’ŒOSPFåè®®ã€‚åº”ç”¨å±‚åè®®ï¼ˆæˆ–ç¨‹åºï¼‰é€šå¸¸æ—¢å¯ä»¥ä½¿ç”¨TCPæœåŠ¡ï¼Œåˆå¯ä»¥ä½¿ç”¨UDPæœåŠ¡ï¼Œæ¯”å¦‚DNSåè®®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡&#x2F;etc&#x2F;servicesæ–‡ä»¶æŸ¥çœ‹æ‰€æœ‰çŸ¥åçš„åº”ç”¨å±‚åè®®ï¼Œä»¥åŠå®ƒä»¬éƒ½èƒ½ä½¿ç”¨å“ªäº›ä¼ è¾“å±‚æœåŠ¡ã€‚ å°è£…åº”ç”¨ç¨‹åºæ•°æ®åœ¨å‘é€åˆ°ç‰©ç†ç½‘ç»œä¸Šä¹‹å‰ï¼Œå°†æ²¿ç€åè®®æ ˆä»ä¸Šå¾€ä¸‹ä¾æ¬¡ä¼ é€’ã€‚æ¯å±‚åè®®éƒ½å°†åœ¨ä¸Šå±‚æ•°æ®çš„åŸºç¡€ä¸ŠåŠ ä¸Šè‡ªå·±çš„å¤´éƒ¨ä¿¡æ¯ï¼ˆæœ‰æ—¶è¿˜åŒ…æ‹¬å°¾éƒ¨ä¿¡æ¯ï¼‰ï¼Œä»¥å®ç°è¯¥å±‚çš„åŠŸèƒ½ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºå°è£… ç»è¿‡TCPå°è£…åçš„æ•°æ®ç§°ä¸ºTCPæŠ¥æ–‡æ®µï¼ŒTCPåè®®ä¸ºé€šä¿¡åŒæ–¹ç»´æŒä¸€ä¸ªè¿æ¥ï¼Œå¹¶ä¸”åœ¨å†…æ ¸ä¸­å­˜å‚¨ç›¸å…³æ•°æ®ã€‚è¿™éƒ¨åˆ†æ•°æ®ä¸­çš„TCPå¤´éƒ¨ä¿¡æ¯å’ŒTCPå†…æ ¸ç¼“å†²åŒºï¼ˆå‘é€ç¼“å†²åŒºæˆ–æ¥æ”¶ç¼“å†²åŒºï¼‰æ•°æ®ä¸€èµ·æ„æˆäº†TCPæŠ¥æ–‡æ®µ ç»è¿‡UDPå°è£…åçš„æ•°æ®ç§°ä¸ºUDPæ•°æ®æŠ¥ï¼ˆUDP datagramï¼‰ã€‚UDPå¯¹åº”ç”¨ç¨‹åºæ•°æ®çš„å°è£…ä¸TCPç±»ä¼¼ã€‚ä¸åŒçš„æ˜¯ï¼ŒUDPæ— é¡»ä¸ºåº”ç”¨å±‚æ•°æ®ä¿å­˜å‰¯æœ¬ï¼Œå› ä¸ºå®ƒæä¾›çš„æœåŠ¡æ˜¯ä¸å¯é çš„ã€‚å½“ä¸€ä¸ªUDPæ•°æ®æŠ¥è¢«æˆåŠŸå‘é€ä¹‹åï¼ŒUDPå†…æ ¸ç¼“å†²åŒºä¸­çš„è¯¥æ•°æ®æŠ¥å°±è¢«ä¸¢å¼ƒäº†ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ£€æµ‹åˆ°è¯¥æ•°æ®æŠ¥æœªèƒ½è¢«æ¥æ”¶ç«¯æ­£ç¡®æ¥æ”¶ï¼Œå¹¶æ‰“ç®—é‡å‘è¿™ä¸ªæ•°æ®æŠ¥ï¼Œåˆ™åº”ç”¨ç¨‹åºéœ€è¦é‡æ–°ä»ç”¨æˆ·ç©ºé—´å°†è¯¥æ•°æ®æŠ¥æ‹·è´åˆ°UDPå†…æ ¸å‘é€ç¼“å†²åŒºä¸­ã€‚ ç»è¿‡IPå°è£…åçš„æ•°æ®ç§°ä¸ºIPæ•°æ®æŠ¥ï¼ˆIP datagramï¼‰ã€‚IPæ•°æ®æŠ¥ä¹ŸåŒ…æ‹¬å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®éƒ¨åˆ†ï¼Œå…¶ä¸­æ•°æ®éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ªTCPæŠ¥æ–‡æ®µã€UDPæ•°æ®æŠ¥æˆ–è€…ICMPæŠ¥æ–‡ã€‚ ç»è¿‡æ•°æ®é“¾è·¯å±‚å°è£…çš„æ•°æ®ç§°ä¸ºå¸§ï¼ˆframeï¼‰ã€‚ä¼ è¾“åª’ä»‹ä¸åŒï¼Œå¸§çš„ç±»å‹ä¹Ÿä¸åŒã€‚æ¯”å¦‚ï¼Œä»¥å¤ªç½‘ä¸Šä¼ è¾“çš„æ˜¯ä»¥å¤ªç½‘å¸§ï¼ˆethernet frameï¼‰ï¼Œè€Œä»¤ç‰Œç¯ç½‘ç»œä¸Šä¼ è¾“çš„åˆ™æ˜¯ä»¤ç‰Œç¯å¸§ï¼ˆtoken ring frameï¼‰ 4å­—èŠ‚CRCå­—æ®µå¯¹å¸§çš„å…¶ä»–éƒ¨åˆ†æä¾›å¾ªç¯å†—ä½™æ ¡éªŒ å¸§çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMax Transmit Unitï¼ŒMTUï¼‰ï¼Œå³å¸§æœ€å¤šèƒ½æºå¸¦å¤šå°‘ä¸Šå±‚åè®®æ•°æ®ï¼ˆæ¯”å¦‚IPæ•°æ®æŠ¥ï¼‰ï¼Œé€šå¸¸å—åˆ°ç½‘ç»œç±»å‹çš„é™åˆ¶ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œè¿‡é•¿çš„IPæ•°æ®æŠ¥å¯èƒ½éœ€è¦è¢«åˆ†ç‰‡ï¼ˆfragmentï¼‰ä¼ è¾“ å¸§æ‰æ˜¯æœ€ç»ˆåœ¨ç‰©ç†ç½‘ç»œä¸Šä¼ é€çš„å­—èŠ‚åºåˆ— åˆ†ç”¨å½“å¸§åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼Œå°†æ²¿ç€åè®®æ ˆè‡ªåº•å‘ä¸Šä¾æ¬¡ä¼ é€’ã€‚å„å±‚åè®®ä¾æ¬¡å¤„ç†å¸§ä¸­æœ¬å±‚è´Ÿè´£çš„å¤´éƒ¨æ•°æ®ï¼Œä»¥è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¹¶æœ€ç»ˆå°†å¤„ç†åçš„å¸§äº¤ç»™ç›®æ ‡åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåˆ†ç”¨ åˆ†ç”¨æ˜¯ä¾é å¤´éƒ¨ä¿¡æ¯ä¸­çš„ç±»å‹å­—æ®µå®ç°çš„ åˆ†ç”¨å¸§ ä¸ºIPåè®®ã€ARPåè®®å’ŒRARPåè®®éƒ½ä½¿ç”¨å¸§ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥å¸§çš„å¤´éƒ¨éœ€è¦æä¾›æŸä¸ªå­—æ®µï¼ˆå…·ä½“æƒ…å†µå–å†³äºå¸§çš„ç±»å‹ï¼‰æ¥åŒºåˆ†å®ƒä»¬ ä»¥å¤ªç½‘å¸§ä¸ºä¾‹ï¼Œå®ƒä½¿ç”¨2å­—èŠ‚çš„ç±»å‹å­—æ®µæ¥æ ‡è¯†ä¸Šå±‚åè®®ã€‚å¦‚æœä¸»æœºæ¥æ”¶åˆ°çš„ä»¥å¤ªç½‘å¸§ç±»å‹å­—æ®µçš„å€¼ä¸º0x800ï¼Œåˆ™å¸§çš„æ•°æ®éƒ¨åˆ†ä¸ºIPæ•°æ®æŠ¥ï¼Œä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå°±å°†å¸§äº¤ä»˜ç»™IPæ¨¡å—ï¼›è‹¥ç±»å‹å­—æ®µçš„å€¼ä¸º0x806ï¼Œåˆ™å¸§çš„æ•°æ®éƒ¨åˆ†ä¸ºARPè¯·æ±‚æˆ–åº”ç­”æŠ¥æ–‡ï¼Œä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå°±å°†å¸§äº¤ä»˜ç»™ARPæ¨¡å—ï¼›è‹¥ç±»å‹å­—æ®µçš„å€¼ä¸º0x835ï¼Œåˆ™å¸§çš„æ•°æ®éƒ¨åˆ†ä¸ºRARPè¯·æ±‚æˆ–åº”ç­”æŠ¥æ–‡ï¼Œä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå°±å°†å¸§äº¤ä»˜ç»™RARPæ¨¡å— åˆ†ç”¨IPæ•°æ®æŠ¥ å› ä¸ºICMPåè®®ã€TCPåè®®å’ŒUDPåè®®éƒ½ä½¿ç”¨IPåè®®ï¼Œæ‰€ä»¥IPæ•°æ®æŠ¥çš„å¤´éƒ¨é‡‡ç”¨16ä½çš„åè®®ï¼ˆprotocolï¼‰å­—æ®µæ¥åŒºåˆ†å®ƒä»¬ã€‚ TCPæŠ¥æ–‡æ®µå’ŒUDPæ•°æ®æŠ¥åˆ™é€šè¿‡å…¶å¤´éƒ¨ä¸­çš„16ä½çš„ç«¯å£å·ï¼ˆportnumberï¼‰å­—æ®µæ¥åŒºåˆ†ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚æ¯”å¦‚DNSåè®®å¯¹åº”çš„ç«¯å£å·æ˜¯53ï¼ŒHTTPåè®®ï¼ˆHyper-Text Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ é€åè®®ï¼‰å¯¹åº”çš„ç«¯å£å·æ˜¯80ã€‚æ‰€æœ‰çŸ¥ååº”ç”¨å±‚åè®®ä½¿ç”¨çš„ç«¯å£å·éƒ½å¯åœ¨&#x2F;etc&#x2F;servicesæ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚ ARPåè®®å·¥ä½œåŸç†ARPåè®®èƒ½å®ç°ä»»æ„ç½‘ç»œå±‚åœ°å€åˆ°ä»»æ„ç‰©ç†åœ°å€çš„è½¬æ¢ï¼Œä¸è¿‡æœ¬ä¹¦ä»…è®¨è®ºä»IPåœ°å€åˆ°ä»¥å¤ªç½‘åœ°å€ï¼ˆMACåœ°å€ï¼‰çš„è½¬æ¢ã€‚å…¶å·¥ä½œåŸç†æ˜¯ï¼šä¸»æœºå‘è‡ªå·±æ‰€åœ¨çš„ç½‘ç»œå¹¿æ’­ä¸€ä¸ªARPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŒ…å«ç›®æ ‡æœºå™¨çš„ç½‘ç»œåœ°å€ã€‚æ­¤ç½‘ç»œä¸Šçš„å…¶ä»–æœºå™¨éƒ½å°†æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œä½†åªæœ‰è¢«è¯·æ±‚çš„ç›®æ ‡æœºå™¨ä¼šå›åº”ä¸€ä¸ªARPåº”ç­”ï¼Œå…¶ä¸­åŒ…å«è‡ªå·±çš„ç‰©ç†åœ°å€ã€‚ ä»¥å¤ªç½‘ARPè¯·æ±‚&#x2F;åº”ç­”æŠ¥æ–‡è¯¦è§£ ç¡¬ä»¶ç±»å‹å­—æ®µå®šä¹‰ç‰©ç†åœ°å€çš„ç±»å‹ï¼Œå®ƒçš„å€¼ä¸º1è¡¨ç¤ºMACåœ°å€ åè®®ç±»å‹å­—æ®µè¡¨ç¤ºè¦æ˜ å°„çš„åè®®åœ°å€ç±»å‹ï¼Œå®ƒçš„å€¼ä¸º0x800ï¼Œè¡¨ç¤ºIPåœ°å€ ç¡¬ä»¶åœ°å€é•¿åº¦å­—æ®µå’Œåè®®åœ°å€é•¿åº¦å­—æ®µï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶å•ä½æ˜¯å­—èŠ‚ã€‚å¯¹MACåœ°å€æ¥è¯´ï¼Œå…¶é•¿åº¦ä¸º6ï¼›å¯¹IPï¼ˆv4ï¼‰åœ°å€æ¥è¯´ï¼Œå…¶é•¿åº¦ä¸º4ã€‚ æ“ä½œå­—æ®µæŒ‡å‡º4ç§æ“ä½œç±»å‹ï¼šARPè¯·æ±‚ï¼ˆå€¼ä¸º1ï¼‰ã€ARPåº”ç­”ï¼ˆå€¼ä¸º2ï¼‰ã€RARPè¯·æ±‚ï¼ˆå€¼ä¸º3ï¼‰å’ŒRARPåº”ç­”ï¼ˆå€¼ä¸º4ï¼‰ã€‚ æœ€å4ä¸ªå­—æ®µæŒ‡å®šé€šä¿¡åŒæ–¹çš„ä»¥å¤ªç½‘åœ°å€å’ŒIPåœ°å€ã€‚å‘é€ç«¯å¡«å……é™¤ç›®çš„ç«¯ä»¥å¤ªç½‘åœ°å€å¤–çš„å…¶ä»–3ä¸ªå­—æ®µï¼Œä»¥æ„å»ºARPè¯·æ±‚å¹¶å‘é€ä¹‹ã€‚æ¥æ”¶ç«¯å‘ç°è¯¥è¯·æ±‚çš„ç›®çš„ç«¯IPåœ°å€æ˜¯è‡ªå·±ï¼Œå°±æŠŠè‡ªå·±çš„ä»¥å¤ªç½‘åœ°å€å¡«è¿›å»ï¼Œç„¶åäº¤æ¢ä¸¤ä¸ªç›®çš„ç«¯åœ°å€å’Œä¸¤ä¸ªå‘é€ç«¯åœ°å€ï¼Œä»¥æ„å»ºARPåº”ç­”å¹¶è¿”å›ä¹‹ï¼ˆå½“ç„¶ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæ“ä½œå­—æ®µéœ€è¦è®¾ç½®ä¸º2ï¼‰ã€‚ ARPè¯·æ±‚&#x2F;åº”ç­”æŠ¥æ–‡çš„é•¿åº¦ä¸º28å­—èŠ‚ã€‚å¦‚æœå†åŠ ä¸Šä»¥å¤ªç½‘å¸§å¤´éƒ¨å’Œå°¾éƒ¨çš„18å­—èŠ‚(ARPä¸ºæ•°æ®éƒ¨åˆ†)ï¼Œåˆ™ä¸€ä¸ªæºå¸¦ARPè¯·æ±‚&#x2F;åº”ç­”æŠ¥æ–‡çš„ä»¥å¤ªç½‘å¸§é•¿åº¦ä¸º46å­—èŠ‚ã€‚ä¸è¿‡æœ‰çš„å®ç°è¦æ±‚ä»¥å¤ªç½‘å¸§æ•°æ®éƒ¨åˆ†é•¿åº¦è‡³å°‘ä¸º46å­—èŠ‚ï¼Œæ­¤æ—¶ARPè¯·æ±‚&#x2F;åº”ç­”æŠ¥æ–‡å°†å¢åŠ ä¸€äº›å¡«å……å­—èŠ‚ï¼Œä»¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæºå¸¦ARPè¯·æ±‚&#x2F;åº”ç­”æŠ¥æ–‡çš„ä»¥å¤ªç½‘å¸§é•¿åº¦ä¸º64å­—èŠ‚(512bit)ã€‚ ARPé«˜é€Ÿç¼“å­˜çš„æŸ¥çœ‹å’Œä¿®æ”¹é€šå¸¸ï¼ŒARPç»´æŠ¤ä¸€ä¸ªé«˜é€Ÿç¼“å­˜ï¼Œå…¶ä¸­åŒ…å«ç»å¸¸è®¿é—®ï¼ˆæ¯”å¦‚ç½‘å…³åœ°å€ï¼‰æˆ–æœ€è¿‘è®¿é—®çš„æœºå™¨çš„IPåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚è¿™æ ·å°±é¿å…äº†é‡å¤çš„ARPè¯·æ±‚ï¼Œæé«˜äº†å‘é€æ•°æ®åŒ…çš„é€Ÿåº¦ Linuxä¸‹å¯ä»¥ä½¿ç”¨arpå‘½ä»¤æ¥æŸ¥çœ‹å’Œä¿®æ”¹ARPé«˜é€Ÿç¼“å­˜ã€‚æ¯”å¦‚åœ¨æŸä¸€æ—¶åˆ»ï¼ˆæ³¨æ„ï¼ŒARPé«˜é€Ÿç¼“å­˜æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼‰çš„ARPç¼“å­˜å†…å®¹ä½¿ç”¨arp-a 12$sudo arp-d 192.168.1.109 #åˆ é™¤å¯¹åº”çš„ARPç¼“å­˜é¡¹$sudo arp-s 192.168.1.109 08:00:27:53:10:67 #æ·»åŠ å¯¹åº”çš„ARPç¼“å­˜é¡¹ ä½¿ç”¨tcpdumpè§‚å¯ŸARPé€šä¿¡è¿‡ç¨‹ ä¸ºäº†æ¸…æ¥šåœ°äº†è§£ARPçš„è¿ä½œè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä»ernest-laptopä¸Šæ‰§è¡Œtelnetå‘½ä»¤ç™»å½•Kongming20çš„echoæœåŠ¡ï¼ˆå·²ç»å¼€å¯ï¼‰ï¼Œå¹¶ç”¨tcpdumpæŠ“å–è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸¤å°æµ‹è¯•æœºå™¨ä¹‹é—´äº¤æ¢çš„ä»¥å¤ªç½‘å¸§ã€‚å…·ä½“çš„æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 12345678910$sudo arp-d 192.168.1.109#æ¸…é™¤ARPç¼“å­˜ä¸­Kongming20å¯¹åº”çš„é¡¹$sudo tcpdump-i eth0-ent&#x27;(dst 192.168.1.109 and src 192.168.1.108)or(dst 192.168.1.108 and src 192.168.1.109)&#x27;#å¦‚æ— ç‰¹æ®Šå£°æ˜ï¼ŒæŠ“åŒ…éƒ½åœ¨æœºå™¨ernest-laptopä¸Šæ‰§è¡Œ$telnet 192.168.1.109 echo#å¼€å¯å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œtelnetå‘½ä»¤Trying 192.168.1.109...Connected to 192.168.1.109.Escape character is&#x27;^]&#x27;.^]ï¼ˆå›è½¦ï¼‰#è¾“å…¥Ctrl+]å¹¶å›è½¦telnetï¼quitï¼ˆå›è½¦ï¼‰Connection closed. åº”å…ˆæ¸…é™¤ARPç¼“å­˜ä¸­ä¸Kongming20å¯¹åº”çš„é¡¹ï¼Œå¦åˆ™ARPé€šä¿¡ä¸è¢«æ‰§è¡Œ å½“æ‰§è¡Œtelnetå‘½ä»¤å¹¶åœ¨ä¸¤å°é€šä¿¡ä¸»æœºä¹‹é—´å»ºç«‹TCPè¿æ¥åï¼ˆtelnetè¾“å‡ºâ€œConnected to 192.168.1.109â€ï¼‰ï¼Œè¾“å…¥Ctrl+]ä»¥è°ƒå‡ºtelnetç¨‹åºçš„å‘½ä»¤æç¤ºç¬¦ï¼Œç„¶ååœ¨telnetå‘½ä»¤æç¤ºç¬¦åè¾“å…¥quitï¼Œé€€å‡ºtelnetå®¢æˆ·ç«¯ç¨‹åºï¼ˆå› ä¸ºARPé€šä¿¡åœ¨TCPè¿æ¥å»ºç«‹ä¹‹å‰å°±å·²ç»å®Œæˆï¼Œæ•…æˆ‘ä»¬ä¸å…³å¿ƒåç»­å†…å®¹ï¼‰ã€‚tcpdumpæŠ“å–åˆ°çš„ä¼—å¤šæ•°æ®åŒ…ä¸­ï¼Œåªæœ‰æœ€é å‰çš„ä¸¤ä¸ªå’ŒARPé€šä¿¡æœ‰å…³ç³»ï¼Œç°åœ¨å°†å®ƒä»¬åˆ—å‡ºï¼ˆæ•°æ®åŒ…å‰é¢çš„ç¼–å·æ˜¯ç¬”è€…åŠ å…¥çš„ï¼ŒååŒï¼‰ï¼š 12345671. 00:16:d3:5c:b9:e3ï¼ff:ff:ff:ff:ff:ff,ethertypeARP(0x0806),length 42:Request who-has 192.168.1.109 tell192.168.1.108,length 282. 08:00:27:53:10:67ï¼00:16:d3:5c:b9:e3,ethertypeARP(0x0806),length 60:Reply 192.168.1.109 is-at08:00:27:53:10:67,length 46 ç”±tcpdumpæŠ“å–çš„æ•°æ®åŒ…æœ¬è´¨ä¸Šæ˜¯ä»¥å¤ªç½‘å¸§ï¼Œæˆ‘ä»¬é€šè¿‡è¯¥å‘½ä»¤çš„ä¼—å¤šé€‰é¡¹æ¥æ§åˆ¶å¸§çš„è¿‡æ»¤ï¼ˆæ¯”å¦‚ç”¨dstå’ŒsrcæŒ‡å®šé€šä¿¡çš„ç›®çš„ç«¯IPåœ°å€å’Œæºç«¯IPåœ°å€ï¼‰å’Œæ˜¾ç¤ºï¼ˆæ¯”å¦‚ç”¨-eé€‰é¡¹å¼€å¯ä»¥å¤ªç½‘å¸§å¤´éƒ¨ä¿¡æ¯çš„æ˜¾ç¤ºï¼‰ã€‚ ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸­ï¼ŒARPé€šä¿¡çš„æºç«¯çš„ç‰©ç†åœ°å€æ˜¯00:16:d3:5c:b9:e3ï¼ˆernest-laptopï¼‰ï¼Œç›®çš„ç«¯çš„ç‰©ç†åœ°å€æ˜¯ff:ff:ff:ff:ff:ffï¼Œè¿™æ˜¯ä»¥å¤ªç½‘çš„å¹¿æ’­åœ°å€ï¼Œç”¨ä»¥è¡¨ç¤ºæ•´ä¸ªLANã€‚è¯¥LANä¸Šçš„æ‰€æœ‰æœºå™¨éƒ½ä¼šæ”¶åˆ°å¹¶å¤„ç†è¿™æ ·çš„å¸§ã€‚æ•°å€¼0x806æ˜¯ä»¥å¤ªç½‘å¸§å¤´éƒ¨çš„ç±»å‹å­—æ®µçš„å€¼ï¼Œå®ƒè¡¨ç¤ºåˆ†ç”¨çš„ç›®æ ‡æ˜¯ARPæ¨¡å—ã€‚è¯¥ä»¥å¤ªç½‘å¸§çš„é•¿åº¦ä¸º42å­—èŠ‚ï¼ˆå®é™…ä¸Šæ˜¯46å­—èŠ‚ï¼Œtcpdumpæœªç»Ÿè®¡ä»¥å¤ªç½‘å¸§å°¾éƒ¨4å­—èŠ‚çš„CRCå­—æ®µï¼‰ï¼Œå…¶ä¸­æ•°æ®éƒ¨åˆ†é•¿åº¦ä¸º28å­—èŠ‚ã€‚â€œRequestâ€è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªARPè¯·æ±‚ï¼Œâ€œwho-has 192.168.1.109 tell 192.168.1.108â€åˆ™è¡¨ç¤ºæ˜¯ernest-laptopè¦æŸ¥è¯¢Kongming20çš„IPåœ°å€ã€‚ ç¬¬äºŒä¸ªæ•°æ®åŒ…ä¸­ï¼ŒARPé€šä¿¡çš„æºç«¯çš„ç‰©ç†åœ°å€æ˜¯08:00:27:53:10:67ï¼ˆKongming20ï¼‰ï¼Œç›®çš„ç«¯çš„ç‰©ç†åœ°å€æ˜¯00:16:d3:5c:b9:e3ï¼ˆernest-laptopï¼‰ã€‚â€œReplyâ€è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªARPåº”ç­”ï¼Œâ€œ192.168.1.109 is-at 08:00:27:53:10:67â€åˆ™è¡¨ç¤ºç›®æ ‡æœºå™¨Kongming20æŠ¥å‘Šå…¶ç‰©ç†åœ°å€ã€‚è¯¥ä»¥å¤ªç½‘å¸§çš„é•¿åº¦ä¸º60å­—èŠ‚ï¼ˆå®é™…ä¸Šæ˜¯64å­—èŠ‚ï¼‰ï¼Œå¯è§å®ƒä½¿ç”¨äº†å¡«å……å­—èŠ‚æ¥æ»¡è¶³æœ€å°å¸§é•¿åº¦ã€‚ ARPè¯·æ±‚å’Œåº”ç­”æ˜¯ä»ä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå‘å‡ºçš„ï¼Œè€Œå¹¶éåƒå›¾ä¸­æè¿°çš„é‚£æ ·ä»ARPæ¨¡å—ç›´æ¥å‘é€åˆ°ä»¥å¤ªç½‘ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒä»¬ç”¨è™šçº¿è¡¨ç¤º è·¯ç”±å™¨ä¹Ÿå°†æ¥æ”¶åˆ°ä»¥å¤ªç½‘å¸§1ï¼Œå› ä¸ºè¯¥å¸§æ˜¯ä¸€ä¸ªå¹¿æ’­å¸§ã€‚ä¸è¿‡å¾ˆæ˜¾ç„¶ï¼Œè·¯ç”±å™¨å¹¶æ²¡æœ‰å›åº”å…¶ä¸­çš„ARPè¯·æ±‚ DNSå·¥ä½œåŸç†æˆ‘ä»¬é€šå¸¸ä½¿ç”¨æœºå™¨çš„åŸŸåæ¥è®¿é—®è¿™å°æœºå™¨ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨å…¶IPåœ°å€ï¼Œæ¯”å¦‚è®¿é—®å› ç‰¹ç½‘ä¸Šçš„å„ç§ç½‘ç«™ã€‚é‚£ä¹ˆå¦‚ä½•å°†æœºå™¨çš„åŸŸåè½¬æ¢æˆIPåœ°å€å‘¢ï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨åŸŸåæŸ¥è¯¢æœåŠ¡ã€‚åŸŸåæŸ¥è¯¢æœåŠ¡æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæ¯”å¦‚NISï¼ˆNetwork Information Serviceï¼Œç½‘ç»œä¿¡æ¯æœåŠ¡ï¼‰ã€DNSå’Œæœ¬åœ°é™æ€æ–‡ä»¶ç­‰ã€‚æœ¬èŠ‚ä¸»è¦è®¨è®ºDNSã€‚ DNSæŸ¥è¯¢å’Œåº”ç­”æŠ¥æ–‡è¯¦è§£DNSæ˜¯ä¸€å¥—åˆ†å¸ƒå¼çš„åŸŸåæœåŠ¡ç³»ç»Ÿã€‚æ¯ä¸ªDNSæœåŠ¡å™¨ä¸Šéƒ½å­˜æ”¾ç€å¤§é‡çš„æœºå™¨åå’ŒIPåœ°å€çš„æ˜ å°„ï¼Œå¹¶ä¸”æ˜¯åŠ¨æ€æ›´æ–°çš„ã€‚ä¼—å¤šç½‘ç»œå®¢æˆ·ç«¯ç¨‹åºéƒ½ä½¿ç”¨DNSåè®®æ¥å‘DNSæœåŠ¡å™¨æŸ¥è¯¢ç›®æ ‡ä¸»æœºçš„IPåœ°å€ã€‚ 16ä½æ ‡è¯†å­—æ®µç”¨äºæ ‡è®°ä¸€å¯¹DNSæŸ¥è¯¢å’Œåº”ç­”ï¼Œä»¥æ­¤åŒºåˆ†ä¸€ä¸ªDNSåº”ç­”æ˜¯å“ªä¸ªDNSæŸ¥è¯¢çš„å›åº”ã€‚ 16ä½æ ‡å¿—å­—æ®µç”¨äºåå•†å…·ä½“çš„é€šä¿¡æ–¹å¼å’Œåé¦ˆé€šä¿¡çŠ¶æ€ã€‚ QRï¼ŒæŸ¥è¯¢&#x2F;åº”ç­”æ ‡å¿—ã€‚0è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢æŠ¥æ–‡ï¼Œ1è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåº”ç­”æŠ¥æ–‡ã€‚ opcodeï¼Œå®šä¹‰æŸ¥è¯¢å’Œåº”ç­”çš„ç±»å‹ã€‚0è¡¨ç¤ºæ ‡å‡†æŸ¥è¯¢ï¼Œ1è¡¨ç¤ºåå‘æŸ¥è¯¢ï¼ˆç”±IPåœ°å€è·å¾—ä¸»æœºåŸŸåï¼‰ï¼Œ2è¡¨ç¤ºè¯·æ±‚æœåŠ¡å™¨çŠ¶æ€ã€‚ AAï¼Œæˆæƒåº”ç­”æ ‡å¿—ï¼Œä»…ç”±åº”ç­”æŠ¥æ–‡ä½¿ç”¨ã€‚1è¡¨ç¤ºåŸŸåæœåŠ¡å™¨æ˜¯æˆæƒæœåŠ¡å™¨ TCï¼Œæˆªæ–­æ ‡å¿—ï¼Œä»…å½“DNSæŠ¥æ–‡ä½¿ç”¨UDPæœåŠ¡æ—¶ä½¿ç”¨ã€‚å› ä¸ºUDPæ•°æ®æŠ¥æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥è¿‡é•¿çš„DNSæŠ¥æ–‡å°†è¢«æˆªæ–­ã€‚1è¡¨ç¤ºDNSæŠ¥æ–‡è¶…è¿‡512å­—èŠ‚ï¼Œå¹¶è¢«æˆªæ–­ RDï¼Œé€’å½’æŸ¥è¯¢æ ‡å¿—ã€‚1è¡¨ç¤ºæ‰§è¡Œé€’å½’æŸ¥è¯¢ï¼Œå³å¦‚æœç›®æ ‡DNSæœåŠ¡å™¨æ— æ³•è§£ææŸä¸ªä¸»æœºåï¼Œåˆ™å®ƒå°†å‘å…¶ä»–DNSæœåŠ¡å™¨ç»§ç»­æŸ¥è¯¢ï¼Œå¦‚æ­¤é€’å½’ï¼Œç›´åˆ°è·å¾—ç»“æœå¹¶æŠŠè¯¥ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚0è¡¨ç¤ºæ‰§è¡Œè¿­ä»£æŸ¥è¯¢ï¼Œå³å¦‚æœç›®æ ‡DNSæœåŠ¡å™¨æ— æ³•è§£ææŸä¸ªä¸»æœºåï¼Œåˆ™å®ƒå°†è‡ªå·±çŸ¥é“çš„å…¶ä»–DNSæœåŠ¡å™¨çš„IPåœ°å€è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥ä¾›å®¢æˆ·ç«¯å‚è€ƒã€‚ RAï¼Œå…è®¸é€’å½’æ ‡å¿—ã€‚ä»…ç”±åº”ç­”æŠ¥æ–‡ä½¿ç”¨ï¼Œ1è¡¨ç¤ºDNSæœåŠ¡å™¨æ”¯æŒé€’å½’æŸ¥è¯¢ zeroï¼Œè¿™3ä½æœªç”¨ï¼Œå¿…é¡»éƒ½è®¾ç½®ä¸º0ã€‚ rcodeï¼Œ4ä½è¿”å›ç ï¼Œè¡¨ç¤ºåº”ç­”çš„çŠ¶æ€ã€‚å¸¸ç”¨å€¼æœ‰0ï¼ˆæ— é”™è¯¯ï¼‰å’Œ3ï¼ˆåŸŸåä¸å­˜åœ¨ï¼‰ã€‚ æ¥ä¸‹æ¥çš„4ä¸ªå­—æ®µåˆ™åˆ†åˆ«æŒ‡å‡ºDNSæŠ¥æ–‡çš„æœ€å4ä¸ªå­—æ®µçš„èµ„æºè®°å½•æ•°ç›®ã€‚å¯¹æŸ¥è¯¢æŠ¥æ–‡è€Œè¨€ï¼Œå®ƒä¸€èˆ¬åŒ…å«1ä¸ªæŸ¥è¯¢é—®é¢˜ï¼Œè€Œåº”ç­”èµ„æºè®°å½•æ•°ã€æˆæƒèµ„æºè®°å½•æ•°å’Œé¢å¤–èµ„æºè®°å½•æ•°åˆ™ä¸º0ã€‚åº”ç­”æŠ¥æ–‡çš„åº”ç­”èµ„æºè®°å½•æ•°åˆ™è‡³å°‘ä¸º1ï¼Œè€Œæˆæƒèµ„æºè®°å½•æ•°å’Œé¢å¤–èµ„æºè®°å½•æ•°å¯ä¸º0æˆ–é0ã€‚ æŸ¥è¯¢åä»¥ä¸€å®šçš„æ ¼å¼å°è£…äº†è¦æŸ¥è¯¢çš„ä¸»æœºåŸŸåã€‚16ä½æŸ¥è¯¢ç±»å‹è¡¨ç¤ºå¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå¸¸è§çš„ç±»å‹æœ‰å¦‚ä¸‹å‡ ç§ ç±»å‹Aï¼Œå€¼æ˜¯1ï¼Œè¡¨ç¤ºè·å–ç›®æ ‡ä¸»æœºçš„IPåœ°å€ã€‚ ç±»å‹CNAMEï¼Œå€¼æ˜¯5ï¼Œè¡¨ç¤ºè·å¾—ç›®æ ‡ä¸»æœºçš„åˆ«å ç±»å‹PTRï¼Œå€¼æ˜¯12ï¼Œè¡¨ç¤ºåå‘æŸ¥è¯¢ 16ä½æŸ¥è¯¢ç±»é€šå¸¸ä¸º1ï¼Œè¡¨ç¤ºè·å–å› ç‰¹ç½‘åœ°å€ï¼ˆIPåœ°å€ï¼‰ åº”ç­”å­—æ®µã€æˆæƒå­—æ®µå’Œé¢å¤–ä¿¡æ¯å­—æ®µéƒ½ä½¿ç”¨èµ„æºè®°å½•ï¼ˆResourceRecordï¼ŒRRï¼‰æ ¼å¼ 32ä½åŸŸåæ˜¯è¯¥è®°å½•ä¸­ä¸èµ„æºå¯¹åº”çš„åå­—ï¼Œå…¶æ ¼å¼å’ŒæŸ¥è¯¢é—®é¢˜ä¸­çš„æŸ¥è¯¢åå­—æ®µç›¸åŒã€‚ 16ä½ç±»å‹å’Œ16ä½ç±»å­—æ®µçš„å«ä¹‰ä¹Ÿä¸DNSæŸ¥è¯¢é—®é¢˜çš„å¯¹åº”å­—æ®µç›¸åŒ 32ä½ç”Ÿå­˜æ—¶é—´è¡¨ç¤ºè¯¥æŸ¥è¯¢è®°å½•ç»“æœå¯è¢«æœ¬åœ°å®¢æˆ·ç«¯ç¨‹åºç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ 16ä½èµ„æºæ•°æ®é•¿åº¦å­—æ®µå’Œèµ„æºæ•°æ®å­—æ®µçš„å†…å®¹å–å†³äºç±»å‹å­—æ®µã€‚å¯¹ç±»å‹Aè€Œè¨€ï¼Œèµ„æºæ•°æ®æ˜¯32ä½çš„IPv4åœ°å€ï¼Œè€Œèµ„æºæ•°æ®é•¿åº¦åˆ™ä¸º4ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ Linuxä¸‹è®¿é—®DNSæœåŠ¡æˆ‘ä»¬è¦è®¿é—®DNSæœåŠ¡ï¼Œå°±å¿…é¡»å…ˆçŸ¥é“DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚Linuxä½¿ç”¨&#x2F;etc&#x2F;resolv.confæ–‡ä»¶æ¥å­˜æ”¾DNSæœåŠ¡å™¨çš„IPåœ°å€ã€‚æœºå™¨ernest-laptopä¸Šï¼Œè¯¥æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ nameserver 219.239.26.42 nameserver 124.207.160.106 æˆ‘çš„æœºå­ä¸Šæ˜¯nameserver 114.114.114.114 nameserver 8.8.8 åˆ†åˆ«æ˜¯é¦–é€‰å’Œå¤‡é€‰ Linuxä¸‹ä¸€ä¸ªå¸¸ç”¨çš„è®¿é—®DNSæœåŠ¡å™¨çš„å®¢æˆ·ç«¯ç¨‹åºæ˜¯host ï¼Ÿï¼Ÿï¼Ÿï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤æ˜¯å‘é¦–é€‰DNSæœåŠ¡å™¨219.239.26.42æŸ¥è¯¢æœºå™¨www.baidu.comçš„IPåœ°å€ï¼š 1234$host -t A www.baidu.comwww.baidu.com is an alias for www.a.shifen.com.www.a.shifen.com has address 119.75.217.56www.a.shifen.com has address 119.75.218.77 hostå‘½ä»¤çš„è¾“å‡ºå‘Šè¯‰æˆ‘ä»¬ï¼Œæœºå™¨åwww.baidu.comæ˜¯www.a.shifen.com.çš„åˆ«åï¼Œå¹¶ä¸”è¯¥æœºå™¨åå¯¹åº”ä¸¤ä¸ªIPåœ°å€ã€‚hostå‘½ä»¤ä½¿ç”¨DNSåè®®å’ŒDNSæœåŠ¡å™¨é€šä¿¡ï¼Œå…¶-té€‰é¡¹å‘Šè¯‰DNSåè®®ä½¿ç”¨å“ªç§æŸ¥è¯¢ç±»å‹ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯Aç±»å‹ï¼Œå³é€šè¿‡æœºå™¨çš„åŸŸåè·å¾—å…¶IPåœ°å€ï¼ˆä½†å®é™…ä¸Šè¿”å›çš„èµ„æºè®°å½•ä¸­è¿˜åŒ…å«æœºå™¨çš„åˆ«åï¼‰ã€‚ ä½¿ç”¨tcpdumpè§‚å¯ŸDNSé€šä¿¡è¿‡ç¨‹ä¸ºäº†çœ‹æ¸…æ¥šDNSé€šä¿¡çš„è¿‡ç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»ernest-laptopä¸Šè¿è¡Œhostå‘½ä»¤ä»¥æŸ¥è¯¢ä¸»æœºwww.baidu.comå¯¹åº”çš„IPåœ°å€ï¼Œå¹¶ä½¿ç”¨tcpdumpæŠ“å–è¿™ä¸€è¿‡ç¨‹ä¸­LANä¸Šä¼ è¾“çš„ä»¥å¤ªç½‘å¸§ã€‚å…·ä½“çš„æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š $sudo tcpdump-i eth0-nt-s 500 port domain $host-t A www.baidu.com è¿™ä¸€æ¬¡æ‰§è¡ŒtcpdumpæŠ“åŒ…æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œport domainâ€æ¥è¿‡æ»¤æ•°æ®åŒ…ï¼Œè¡¨ç¤ºåªæŠ“å–ä½¿ç”¨domainï¼ˆåŸŸåï¼‰æœåŠ¡çš„æ•°æ®åŒ…ï¼Œå³DNSæŸ¥è¯¢å’Œåº”ç­”æŠ¥æ–‡ã€‚tcpdumpçš„è¾“å‡ºå¦‚ä¸‹ï¼š 12341. IP 192.168.1.108.34319ï¼219.239.26.42.53 :57428+A?www.baidu.com.(31)2. IP 219.239.26.42.53ï¼192.168.1.108.34319 :57428 3/4/4 CNAMEwww.a.shifen.com.,A 119.75.218.77,A 119.75.217.56(226) tcpdumpä»¥â€œIPåœ°å€.ç«¯å£å·â€çš„å½¢å¼æ¥æè¿°é€šä¿¡çš„æŸä¸€ç«¯ ç¬¬ä¸€ä¸ªæ˜¯DNSæŸ¥è¯¢æŠ¥æ–‡ç¬¬äºŒä¸ªæ˜¯åº”ç­”æŠ¥æ–‡ ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸­ï¼Œæ•°å€¼57428æ˜¯DNSæŸ¥è¯¢æŠ¥æ–‡çš„æ ‡è¯†å€¼ï¼Œå› æ­¤è¯¥å€¼ä¹Ÿå‡ºç°åœ¨DNSåº”ç­”æŠ¥æ–‡ä¸­ã€‚â€œ+â€è¡¨ç¤ºå¯ç”¨é€’å½’æŸ¥è¯¢æ ‡å¿—ã€‚â€œA?â€è¡¨ç¤ºä½¿ç”¨Aç±»å‹çš„æŸ¥è¯¢æ–¹å¼ã€‚â€œwww.baidu.comâ€åˆ™æ˜¯DNSæŸ¥è¯¢é—®é¢˜ä¸­çš„æŸ¥è¯¢åã€‚æ‹¬å·ä¸­çš„æ•°å€¼31æ˜¯DNSæŸ¥è¯¢æŠ¥æ–‡çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ ç¬¬äºŒä¸ªæ•°æ®åŒ…ä¸­ï¼Œâ€œ3&#x2F;4&#x2F;4â€è¡¨ç¤ºè¯¥æŠ¥æ–‡ä¸­åŒ…å«3ä¸ªåº”ç­”èµ„æºè®°å½•ã€4ä¸ªæˆæƒèµ„æºè®°å½•å’Œ4ä¸ªé¢å¤–ä¿¡æ¯è®°å½•ã€‚â€œCNAME www.a.shifen.com.ï¼ŒA119.75.218.77ï¼ŒA 119.75.217.56â€åˆ™è¡¨ç¤º3ä¸ªåº”ç­”èµ„æºè®°å½•çš„å†…å®¹ã€‚å…¶ä¸­CNAMEè¡¨ç¤ºç´§éšå…¶åçš„è®°å½•æ˜¯æœºå™¨çš„åˆ«åï¼ŒAè¡¨ç¤ºç´§éšå…¶åçš„è®°å½•æ˜¯IPåœ°å€ã€‚è¯¥åº”ç­”æŠ¥æ–‡çš„é•¿åº¦ä¸º226å­—èŠ‚ã€‚ æˆ‘ä»¬æŠ“åŒ…çš„æ—¶å€™æ²¡æœ‰å¼€å¯tcpdumpçš„-Xé€‰é¡¹ï¼ˆæˆ–è€…-xé€‰é¡¹ï¼‰ã€‚å¦‚æœä½¿ç”¨-Xé€‰é¡¹ï¼Œæˆ‘ä»¬å°†èƒ½çœ‹åˆ°DNSæŠ¥æ–‡çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±èƒ½æ˜ç™½ä¸Šé¢31å­—èŠ‚çš„æŸ¥è¯¢æŠ¥æ–‡å’Œ226å­—èŠ‚çš„åº”ç­”æŠ¥æ–‡çš„å…·ä½“å«ä¹‰ socketå’ŒTCP&#x2F;IPåè®®æ—çš„å…³ç³»å‰æ–‡æåˆ°ï¼Œæ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚åè®®æ˜¯åœ¨å†…æ ¸ä¸­å®ç°çš„ã€‚å› æ­¤æ“ä½œç³»ç»Ÿéœ€è¦å®ç°ä¸€ç»„ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®¿é—®è¿™äº›åè®®æä¾›çš„æœåŠ¡ã€‚å®ç°è¿™ç»„ç³»ç»Ÿè°ƒç”¨çš„APIï¼ˆApplication Programming Interfaceï¼Œåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰ä¸»è¦æœ‰ä¸¤å¥—ï¼šsocketå’ŒXTIã€‚XTIç°åœ¨åŸºæœ¬ä¸å†ä½¿ç”¨ï¼Œæœ¬ä¹¦ä»…è®¨è®ºsocketã€‚ ç”±socketå®šä¹‰çš„è¿™ä¸€ç»„APIæä¾›å¦‚ä¸‹ä¸¤ç‚¹åŠŸèƒ½ï¼šä¸€æ˜¯å°†åº”ç”¨ç¨‹åºæ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºä¸­å¤åˆ¶åˆ°TCP&#x2F;UDPå†…æ ¸å‘é€ç¼“å†²åŒºï¼Œä»¥äº¤ä»˜å†…æ ¸æ¥å‘é€æ•°æ®ï¼Œæˆ–è€…æ˜¯ä»å†…æ ¸TCP&#x2F;UDPæ¥æ”¶ç¼“å†²åŒºä¸­å¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œä»¥è¯»å–æ•°æ®ï¼›äºŒæ˜¯åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å®ƒä»¬æ¥ä¿®æ”¹å†…æ ¸ä¸­å„å±‚åè®®çš„æŸäº›å¤´éƒ¨ä¿¡æ¯æˆ–å…¶ä»–æ•°æ®ç»“æ„ï¼Œä»è€Œç²¾ç»†åœ°æ§åˆ¶åº•å±‚é€šä¿¡çš„è¡Œä¸ºã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡setsockoptå‡½æ•°æ¥è®¾ç½®IPæ•°æ®æŠ¥åœ¨ç½‘ç»œä¸Šçš„å­˜æ´»æ—¶é—´ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œsocketæ˜¯ä¸€å¥—é€šç”¨ç½‘ç»œç¼–ç¨‹æ¥å£ï¼Œå®ƒä¸ä½†å¯ä»¥è®¿é—®å†…æ ¸ä¸­TCP&#x2F;IPåè®®æ ˆï¼Œè€Œä¸”å¯ä»¥è®¿é—®å…¶ä»–ç½‘ç»œåè®®æ ˆï¼ˆæ¯”å¦‚X.25åè®®æ ˆã€UNIXæœ¬åœ°åŸŸåè®®æ ˆç­‰ï¼‰ #IPåè®®è¯¦è§£ IPåè®®æ˜¯TCP&#x2F;IPåè®®æ—çš„æ ¸å¿ƒåè®®ï¼Œä¹Ÿæ˜¯socketç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ä¹‹ä¸€ IPå¤´éƒ¨ä¿¡æ¯ã€‚IPå¤´éƒ¨ä¿¡æ¯å‡ºç°åœ¨æ¯ä¸ªIPæ•°æ®æŠ¥ä¸­ï¼Œç”¨äºæŒ‡å®šIPé€šä¿¡çš„æºç«¯IPåœ°å€ã€ç›®çš„ç«¯IPåœ°å€ï¼ŒæŒ‡å¯¼IPåˆ†ç‰‡å’Œé‡ç»„ï¼Œä»¥åŠæŒ‡å®šéƒ¨åˆ†é€šä¿¡è¡Œä¸º IPæ•°æ®æŠ¥çš„è·¯ç”±å’Œè½¬å‘ã€‚IPæ•°æ®æŠ¥çš„è·¯ç”±å’Œè½¬å‘å‘ç”Ÿåœ¨é™¤ç›®æ ‡æœºå™¨ä¹‹å¤–çš„æ‰€æœ‰ä¸»æœºå’Œè·¯ç”±å™¨ä¸Šã€‚å®ƒä»¬å†³å®šæ•°æ®æŠ¥æ˜¯å¦åº”è¯¥è½¬å‘ä»¥åŠå¦‚ä½•è½¬å‘ã€‚ IPæœåŠ¡çš„ç‰¹ç‚¹IPåè®®æ˜¯TCP&#x2F;IPåè®®æ—çš„åŠ¨åŠ›ï¼Œå®ƒä¸ºä¸Šå±‚åè®®æä¾›æ— çŠ¶æ€ã€æ— è¿æ¥ã€ä¸å¯é çš„æœåŠ¡ã€‚ æ— çŠ¶æ€ï¼ˆstatelessï¼‰æ˜¯æŒ‡IPé€šä¿¡åŒæ–¹ä¸åŒæ­¥ä¼ è¾“æ•°æ®çš„çŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤æ‰€æœ‰IPæ•°æ®æŠ¥çš„å‘é€ã€ä¼ è¾“å’Œæ¥æ”¶éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹ã€æ²¡æœ‰ä¸Šä¸‹æ–‡å…³ç³»çš„ã€‚è¿™ç§æœåŠ¡æœ€å¤§çš„ç¼ºç‚¹æ˜¯æ— æ³•å¤„ç†ä¹±åºå’Œé‡å¤çš„IPæ•°æ®æŠ¥ã€‚æ¥æ”¶ç«¯çš„IPæ¨¡å—åªè¦æ”¶åˆ°äº†å®Œæ•´çš„IPæ•°æ®æŠ¥ï¼ˆå¦‚æœæ˜¯IPåˆ†ç‰‡çš„è¯ï¼ŒIPæ¨¡å—å°†å…ˆæ‰§è¡Œé‡ç»„ï¼‰ï¼Œå°±å°†å…¶æ•°æ®éƒ¨åˆ†ï¼ˆTCPæŠ¥æ–‡æ®µã€UDPæ•°æ®æŠ¥æˆ–è€…ICMPæŠ¥æ–‡ï¼‰ä¸Šäº¤ç»™ä¸Šå±‚åè®®ã€‚é‚£ä¹ˆä»ä¸Šå±‚åè®®æ¥çœ‹ï¼Œè¿™äº›æ•°æ®å°±å¯èƒ½æ˜¯ä¹±åºçš„ã€é‡å¤çš„ã€‚ é¢å‘è¿æ¥çš„åè®®ï¼Œæ¯”å¦‚TCPåè®®ï¼Œåˆ™èƒ½å¤Ÿè‡ªå·±å¤„ç†ä¹±åºçš„ã€é‡å¤çš„æŠ¥æ–‡æ®µï¼Œå®ƒé€’äº¤ç»™ä¸Šå±‚åè®®çš„å†…å®¹ç»å¯¹æ˜¯æœ‰åºçš„ã€æ­£ç¡®çš„ã€‚ è™½ç„¶IPæ•°æ®æŠ¥å¤´éƒ¨æä¾›äº†ä¸€ä¸ªæ ‡è¯†å­—æ®µï¼ˆè§åæ–‡ï¼‰ç”¨ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªIPæ•°æ®æŠ¥ï¼Œä½†å®ƒæ˜¯è¢«ç”¨æ¥å¤„ç†IPåˆ†ç‰‡å’Œé‡ç»„çš„ï¼Œè€Œä¸æ˜¯ç”¨æ¥æŒ‡ç¤ºæ¥æ”¶é¡ºåºçš„ã€‚ åœ¨ç½‘ç»œåè®®ä¸­ï¼Œæ— çŠ¶æ€æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ¯”å¦‚UDPåè®®å’ŒHTTPåè®®éƒ½æ˜¯æ— çŠ¶æ€åè®®ã€‚ä»¥HTTPåè®®ä¸ºä¾‹ï¼Œä¸€ä¸ªæµè§ˆå™¨çš„è¿ç»­ä¸¤æ¬¡ç½‘é¡µè¯·æ±‚ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”ï¼Œå®ƒä»¬å°†è¢«WebæœåŠ¡å™¨ç‹¬ç«‹åœ°å¤„ç†ã€‚ æ— è¿æ¥ï¼ˆconnectionlessï¼‰æ˜¯æŒ‡IPé€šä¿¡åŒæ–¹éƒ½ä¸é•¿ä¹…åœ°ç»´æŒå¯¹æ–¹çš„ä»»ä½•ä¿¡æ¯ã€‚è¿™æ ·ï¼Œä¸Šå±‚åè®®æ¯æ¬¡å‘é€æ•°æ®çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»æ˜ç¡®æŒ‡å®šå¯¹æ–¹çš„IPåœ°å€ã€‚ ä¸å¯é æ˜¯æŒ‡IPåè®®ä¸èƒ½ä¿è¯IPæ•°æ®æŠ¥å‡†ç¡®åœ°åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œå®ƒåªæ˜¯æ‰¿è¯ºå°½æœ€å¤§åŠªåŠ›ï¼ˆbest effortï¼‰ã€‚å¾ˆå¤šç§æƒ…å†µéƒ½èƒ½å¯¼è‡´IPæ•°æ®æŠ¥å‘é€å¤±è´¥ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªä¸­è½¬è·¯ç”±å™¨å‘ç°IPæ•°æ®æŠ¥åœ¨ç½‘ç»œä¸Šå­˜æ´»çš„æ—¶é—´å¤ªé•¿ï¼ˆæ ¹æ®IPæ•°æ®æŠ¥å¤´éƒ¨å­—æ®µTTLåˆ¤æ–­ï¼Œè§åæ–‡ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°†ä¸¢å¼ƒä¹‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªICMPé”™è¯¯æ¶ˆæ¯ï¼ˆè¶…æ—¶é”™è¯¯ï¼‰ç»™å‘é€ç«¯ã€‚åˆæ¯”å¦‚ï¼Œæ¥æ”¶ç«¯å‘ç°æ”¶åˆ°çš„IPæ•°æ®æŠ¥ä¸æ­£ç¡®ï¼ˆé€šè¿‡æ ¡éªŒæœºåˆ¶ï¼‰ï¼Œå®ƒä¹Ÿå°†ä¸¢å¼ƒä¹‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªICMPé”™è¯¯æ¶ˆæ¯ï¼ˆIPå¤´éƒ¨å‚æ•°é”™è¯¯ï¼‰ç»™å‘é€ç«¯ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå‘é€ç«¯çš„IPæ¨¡å—ä¸€æ—¦æ£€æµ‹åˆ°IPæ•°æ®æŠ¥å‘é€å¤±è´¥ï¼Œå°±é€šçŸ¥ä¸Šå±‚åè®®å‘é€å¤±è´¥ï¼Œè€Œä¸ä¼šè¯•å›¾é‡ä¼ ã€‚å› æ­¤ï¼Œä½¿ç”¨IPæœåŠ¡çš„ä¸Šå±‚åè®®ï¼ˆæ¯”å¦‚TCPåè®®ï¼‰éœ€è¦è‡ªå·±å®ç°æ•°æ®ç¡®è®¤ã€è¶…æ—¶é‡ä¼ ç­‰æœºåˆ¶ä»¥è¾¾åˆ°å¯é ä¼ è¾“çš„ç›®çš„ IPv4å¤´éƒ¨ç»“æ„IPåˆ†ç‰‡IPè·¯ç”±IPè½¬å‘é‡å®šå‘IPv6å¤´éƒ¨ç»“æ„#TCPåè®®è¯¦è§£ TCPå¤´éƒ¨ä¿¡æ¯ã€‚æºç«¯ç«¯å£å·ã€ç›®çš„ç«¯ç«¯å£å·ï¼Œç®¡ç†TCPè¿æ¥ï¼Œæ§åˆ¶ä¸¤ä¸ªæ–¹å‘çš„æ•°æ®æµ TCPçŠ¶æ€è½¬ç§»è¿‡ç¨‹ã€‚TCPè¿æ¥çš„ä»»æ„ä¸€ç«¯éƒ½æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚åœ¨TCPè¿æ¥ä»å»ºç«‹åˆ°æ–­å¼€çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿æ¥ä¸¤ç«¯çš„çŠ¶æ€æœºå°†ç»å†ä¸åŒçš„çŠ¶æ€å˜è¿ã€‚ TCPæ•°æ®æµã€‚äº¤äº’æ•°æ®æµå’Œæˆå—æ•°æ®æµã€‚TCPæ•°æ®æµä¸­æœ‰ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ï¼Œç§°ä¸ºç´§æ€¥æ•°æ® TCPæ•°æ®æµçš„æ§åˆ¶ã€‚ä¸ºäº†å¯é å’Œé€šä¿¡è´¨é‡ è¶…æ—¶é‡ä¼ å’Œæ‹¥å¡æ§åˆ¶ã€‚ TCPæœåŠ¡çš„ç‰¹ç‚¹ä¸UDPçš„åŒºåˆ«ï¼š å»ºç«‹è¿æ¥ å…¨åŒå·¥ï¼šåŒæ–¹æ•°æ®è¯»å†™é€šè¿‡ä¸€ä¸ªè¿æ¥è¿›è¡Œ UDPé€‚åˆå¤šæ’­å’Œå¹¿æ’­ å­—èŠ‚æµ æ•°æ®æŠ¥ ç¼–ç¨‹ä¸­ï¼Œä½“ç°ä¸ºé€šä¿¡åŒæ–¹æ˜¯å¦å¿…é¡»æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„è¯»ã€å†™æ“ä½œ å½“å‘é€ç«¯åº”ç”¨ç¨‹åºè¿ç»­æ‰§è¡Œå¤šæ¬¡å†™æ“ä½œæ—¶ï¼ŒTCPæ¨¡å—å…ˆå°†è¿™äº›æ•°æ®æ”¾å…¥TCPå‘é€ç¼“å†²åŒºä¸­ã€‚çœŸæ­£å¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå‘é€ç¼“å†²åŒºä¸­è¿™äº›ç­‰å¾…å‘é€çš„æ•°æ®å¯èƒ½è¢«å°è£…æˆä¸€ä¸ªæˆ–å¤šä¸ªTCPæŠ¥æ–‡æ®µå‘å‡ºã€‚å› æ­¤ï¼ŒTCPæ¨¡å—å‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µçš„ä¸ªæ•°å’Œåº”ç”¨ç¨‹åºæ‰§è¡Œçš„å†™æ“ä½œæ¬¡æ•°ä¹‹é—´æ²¡æœ‰å›ºå®šçš„æ•°é‡å…³ç³»ã€‚ å½“æ¥æ”¶ç«¯æ”¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªTCPæŠ¥æ–‡æ®µåï¼ŒTCPæ¨¡å—å°†å®ƒä»¬æºå¸¦çš„åº”ç”¨ç¨‹åºæ•°æ®æŒ‰ç…§TCPæŠ¥æ–‡æ®µçš„åºå·ä¾æ¬¡æ”¾å…¥TCPæ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºè¯»å–æ•°æ®ã€‚æ¥æ”¶ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ä¸€æ¬¡æ€§å°†TCPæ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®å…¨éƒ¨è¯»å‡ºï¼Œä¹Ÿå¯ä»¥åˆ†å¤šæ¬¡è¯»å–ï¼Œè¿™å–å†³äºç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åºè¯»ç¼“å†²åŒºçš„å¤§å°ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºæ‰§è¡Œçš„è¯»æ“ä½œæ¬¡æ•°å’ŒTCPæ¨¡å—æ¥æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µä¸ªæ•°ä¹‹é—´ä¹Ÿæ²¡æœ‰å›ºå®šçš„æ•°é‡å…³ç³»ã€‚ UDPåˆ™ä¸ç„¶ã€‚æ¯æ‰§è¡Œä¸€æ¬¡å†™æ“ä½œï¼ŒUDPæ¨¡å—å°±å°†å…¶å°è£…æˆä¸€ä¸ªUDPæ•°æ®æŠ¥å¹¶å‘é€ã€‚æ¥æ”¶ç«¯å¿…é¡»åŠæ—¶é’ˆå¯¹æ¯ä¸€ä¸ªUDPæ•°æ®æŠ¥æ‰§è¡Œè¯»æ“ä½œï¼Œå¦åˆ™å°±ä¼šä¸¢åŒ…ã€‚å¹¶ä¸”ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„åº”ç”¨ç¨‹åºç¼“å†²åŒºæ¥è¯»å–UDPæ•°æ®ï¼Œåˆ™UDPæ•°æ®å°†è¢«æˆªæ–­ å¯é  TCPåè®®é‡‡ç”¨å‘é€åº”ç­”æœºåˆ¶ï¼Œå³å‘é€ç«¯å‘é€çš„æ¯ä¸ªTCPæŠ¥æ–‡æ®µéƒ½å¿…é¡»å¾—åˆ°æ¥æ”¶æ–¹çš„åº”ç­”ï¼Œæ‰è®¤ä¸ºè¿™ä¸ªTCPæŠ¥æ–‡æ®µä¼ è¾“æˆåŠŸ ç”¨è¶…æ—¶é‡ä¼ æœºåˆ¶ å®šæ—¶å™¨æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°åº”ç­”é‡å‘æŠ¥æ–‡æ®µ æ”¶åˆ°çš„IPæ•°æ®æŠ¥å¯èƒ½ä¹±åºï¼Œé‡å¤ï¼Œtcpåè®®ä¼šæ•´ç†ä¹‹åå†äº¤ä»˜ UDPå’ŒIPéƒ½æ˜¯ä¸å¯é çš„ ###TCPå¤´éƒ¨ å›ºå®šå¤´éƒ¨ç»“æ„â€‹ 16ä½ç«¯å£å·ï¼šæŠ¥æ–‡çš„æºç«¯å£å’Œç›®çš„ç«¯å£ (å®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨çŸ¥åæœåŠ¡ç«¯å£å·ã€‚çŸ¥åæœåŠ¡ä½¿ç”¨çš„ç«¯å£å·éƒ½å®šä¹‰åœ¨&#x2F;etc&#x2F;servicesæ–‡ä»¶ä¸­) 32ä½åºå·ï¼ˆsequence numberï¼‰ï¼šä¸€æ¬¡TCPé€šä¿¡è¿‡ç¨‹ä¸­æŸä¸€ä¸ªä¼ è¾“æ–¹å‘ä¸Šçš„å­—èŠ‚æµçš„æ¯ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚Aå‘é€ç»™Bçš„ç¬¬ä¸€ä¸ªTCPæŠ¥æ–‡æ®µä¸­ï¼Œåºå·å€¼è¢«ç³»ç»Ÿåˆå§‹åŒ–ä¸ºæŸä¸ªéšæœºå€¼ISNï¼ˆInitial Sequence Numberï¼Œåˆå§‹åºå·å€¼ï¼‰ã€‚é‚£ä¹ˆåœ¨è¯¥ä¼ è¾“æ–¹å‘ä¸Šï¼ˆä»Aåˆ°Bï¼‰ï¼Œåç»­çš„TCPæŠ¥æ–‡æ®µä¸­åºå·å€¼å°†è¢«ç³»ç»Ÿè®¾ç½®æˆISNåŠ ä¸Šè¯¥æŠ¥æ–‡æ®µæ‰€æºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨æ•´ä¸ªå­—èŠ‚æµä¸­çš„åç§»ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªTCPæŠ¥æ–‡æ®µä¼ é€çš„æ•°æ®æ˜¯å­—èŠ‚æµä¸­çš„ç¬¬1025ï½2048å­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥æŠ¥æ–‡æ®µçš„åºå·å€¼å°±æ˜¯ISN+1025ã€‚ 32ä½ç¡®è®¤å·ï¼ˆacknowledgement numberï¼‰ï¼šç”¨ä½œå¯¹å¦ä¸€æ–¹å‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„å“åº”ã€‚å…¶å€¼æ˜¯æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚ 4ä½å¤´éƒ¨é•¿åº¦ï¼ˆheader lengthï¼‰ï¼šæ ‡è¯†è¯¥TCPå¤´éƒ¨æœ‰å¤šå°‘ä¸ª32bitå­—ï¼ˆ4å­—èŠ‚ï¼‰ã€‚å› ä¸º4ä½æœ€å¤§èƒ½è¡¨ç¤º15ï¼Œæ‰€ä»¥TCPå¤´éƒ¨æœ€é•¿æ˜¯60å­—èŠ‚ã€‚ï¼Ÿï¼Ÿï¼Ÿ URGæ ‡å¿—ï¼Œè¡¨ç¤ºç´§æ€¥æŒ‡é’ˆï¼ˆurgent pointerï¼‰æ˜¯å¦æœ‰æ•ˆã€‚ ACKæ ‡å¿—ï¼Œè¡¨ç¤ºç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆã€‚æˆ‘ä»¬ç§°æºå¸¦ACKæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºç¡®è®¤æŠ¥æ–‡æ®µã€‚ PSHæ ‡å¿—ï¼Œæç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºåº”è¯¥ç«‹å³ä»TCPæ¥æ”¶ç¼“å†²åŒºä¸­è¯»èµ°æ•°æ®ï¼Œä¸ºæ¥æ”¶åç»­æ•°æ®è…¾å‡ºç©ºé—´ï¼ˆå¦‚æœåº”ç”¨ç¨‹åºä¸å°†æ¥æ”¶åˆ°çš„æ•°æ®è¯»èµ°ï¼Œå®ƒä»¬å°±ä¼šä¸€ç›´åœç•™åœ¨TCPæ¥æ”¶ç¼“å†²åŒºä¸­ï¼‰ã€‚ RSTæ ‡å¿—ï¼Œè¡¨ç¤ºè¦æ±‚å¯¹æ–¹é‡æ–°å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬ç§°æºå¸¦RSTæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºå¤ä½æŠ¥æ–‡æ®µã€‚ SYNæ ‡å¿—ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚æˆ‘ä»¬ç§°æºå¸¦SYNæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºåŒæ­¥æŠ¥æ–‡æ®µ FINæ ‡å¿—ï¼Œè¡¨ç¤ºé€šçŸ¥å¯¹æ–¹æœ¬ç«¯è¦å…³é—­è¿æ¥äº†ã€‚æˆ‘ä»¬ç§°æºå¸¦FINæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºç»“æŸæŠ¥æ–‡æ®µã€‚ 16ä½çª—å£å¤§å°ï¼ˆwindow sizeï¼‰ï¼šæ˜¯TCPæµé‡æ§åˆ¶çš„ä¸€ä¸ªæ‰‹æ®µã€‚è¿™é‡Œè¯´çš„çª—å£ï¼ŒæŒ‡çš„æ˜¯æ¥æ”¶é€šå‘Šçª—å£ï¼ˆReceiver Windowï¼ŒRWNDï¼‰ã€‚å®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚ 16ä½æ ¡éªŒå’Œï¼ˆTCP checksumï¼‰ï¼šç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡ŒCRCç®—æ³•ä»¥æ£€éªŒTCPæŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ ¡éªŒä¸ä»…åŒ…æ‹¬TCPå¤´éƒ¨ï¼Œä¹ŸåŒ…æ‹¬æ•°æ®éƒ¨åˆ†ã€‚è¿™ä¹Ÿæ˜¯TCPå¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚ 16ä½ç´§æ€¥æŒ‡é’ˆï¼ˆurgent pointerï¼‰ï¼šæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ã€‚å®ƒå’Œåºå·å­—æ®µçš„å€¼ç›¸åŠ è¡¨ç¤ºæœ€åä¸€ä¸ªç´§æ€¥æ•°æ®çš„ä¸‹ä¸€å­—èŠ‚çš„åºå·ã€‚å› æ­¤ï¼Œç¡®åˆ‡åœ°è¯´ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ç´§æ€¥æŒ‡é’ˆç›¸å¯¹å½“å‰åºå·çš„åç§»ï¼Œä¸å¦¨ç§°ä¹‹ä¸ºç´§æ€¥åç§»ã€‚TCPçš„ç´§æ€¥æŒ‡é’ˆæ˜¯å‘é€ç«¯å‘æ¥æ”¶ç«¯å‘é€ç´§æ€¥æ•°æ®çš„æ–¹æ³•ã€‚ TCPå¤´éƒ¨çš„æœ€åä¸€ä¸ªé€‰é¡¹å­—æ®µï¼ˆoptionsï¼‰æ˜¯å¯å˜é•¿çš„å¯é€‰ä¿¡æ¯ã€‚è¿™éƒ¨åˆ†æœ€å¤šåŒ…å«40å­—èŠ‚ï¼Œå› ä¸ºTCPå¤´éƒ¨æœ€é•¿æ˜¯60å­—èŠ‚ï¼ˆå…¶ä¸­è¿˜åŒ…å«20å­—èŠ‚çš„å›ºå®šéƒ¨åˆ†ï¼‰ã€‚ ç»“æ„ kind(1å­—èŠ‚)+length(1å­—èŠ‚)+info(nå­—èŠ‚) é€‰é¡¹çš„ç¬¬ä¸€ä¸ªå­—æ®µkindè¯´æ˜é€‰é¡¹çš„ç±»å‹ã€‚æœ‰çš„TCPé€‰é¡¹æ²¡æœ‰åé¢ä¸¤ä¸ªå­—æ®µï¼Œä»…åŒ…å«1å­—èŠ‚çš„kindå­—æ®µã€‚ç¬¬äºŒä¸ªå­—æ®µlengthæŒ‡å®šè¯¥é€‰é¡¹çš„æ€»é•¿åº¦ï¼Œè¯¥é•¿åº¦åŒ…æ‹¬kindå­—æ®µå’Œlengthå­—æ®µå æ®çš„2å­—èŠ‚ã€‚ç¬¬ä¸‰ä¸ªå­—æ®µinfoæ˜¯é€‰é¡¹çš„å…·ä½“ä¿¡æ¯ã€‚å¸¸è§çš„TCPé€‰é¡¹æœ‰7ç§ æ²¡çœ‹å®Œã€‚ã€‚ã€‚ ä½¿ç”¨tcpdumpè§‚å¯ŸTCPå¤´éƒ¨ä¿¡æ¯123456IP 127.0.0.1.41621ï¼127.0.0.1.23 :Flags[S],seq 3499745539,win 32792,options[mss 16396,sackOK,TS val 40781017 ecr 0,nop,wscale 6],length 00x0000:4510 003c a5da 4000 4006 96cf 7f00 00010x0010:7f00 0001 a295 0017 d099 e103 0000 00000x0020:a002 8018 fe30 0000 0204 400c 0402 080a0x0030:026e 44d9 0000 0000 0103 0306 tcpdumpè¾“å‡ºFlags[S]ï¼Œè¡¨ç¤ºè¯¥TCPæŠ¥æ–‡æ®µåŒ…å«SYNæ ‡å¿—ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªåŒæ­¥æŠ¥æ–‡æ®µã€‚ seqæ˜¯åºå·å€¼ã€‚ç¬¬ä¸€ä¸ªtcpæŠ¥æ–‡æ˜¯åˆå§‹çš„ISNå€¼ï¼Œä¸”æ²¡æœ‰ç¡®è®¤å· winæ˜¯æ¥æ”¶é€šå‘Šçª—å£çš„å¤§å°ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªåŒæ­¥æŠ¥æ–‡æ®µï¼Œæ‰€ä»¥winå€¼åæ˜ çš„æ˜¯æ€»å…±çš„æ¥æ”¶é€šå‘Šçª—å£å¤§å° optionsæ˜¯TCPé€‰é¡¹ã€‚mssæ˜¯å‘é€ç«¯é€šå‘Šçš„æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ã€‚é€šè¿‡ifconfigå‘½ä»¤æŸ¥çœ‹å›è·¯æ¥å£çš„MTUä¸º16436å­—èŠ‚ï¼Œå› æ­¤å¯ä»¥é¢„æƒ³åˆ°TCPæŠ¥æ–‡æ®µçš„MSSä¸º16396ï¼ˆ16436-40ï¼‰å­—èŠ‚ã€‚sackOKè¡¨ç¤ºå‘é€ç«¯æ”¯æŒå¹¶åŒæ„ä½¿ç”¨SACKé€‰é¡¹ã€‚TS valæ˜¯å‘é€ç«¯çš„æ—¶é—´æˆ³ã€‚ecræ˜¯æ—¶é—´æˆ³å›æ˜¾åº”ç­”ã€‚å› ä¸ºè¿™æ˜¯ä¸€æ¬¡TCPé€šä¿¡çš„ç¬¬ä¸€ä¸ªTCPæŠ¥æ–‡æ®µï¼Œæ‰€ä»¥å®ƒé’ˆå¯¹å¯¹æ–¹çš„æ—¶é—´æˆ³çš„åº”ç­”ä¸º0ï¼ˆå°šæœªæ”¶åˆ°å¯¹æ–¹çš„æ—¶é—´æˆ³ï¼‰ã€‚ç´§æ¥ç€çš„nopæ˜¯ä¸€ä¸ªç©ºæ“ä½œé€‰é¡¹ã€‚wscaleæŒ‡å‡ºå‘é€ç«¯ä½¿ç”¨çš„çª—å£æ‰©å¤§å› å­ä¸º6ã€‚ ä»¬åˆ†ætcpdumpè¾“å‡ºçš„å­—èŠ‚ç ä¸­TCPå¤´éƒ¨å¯¹åº”çš„ä¿¡æ¯ï¼Œå®ƒä»ç¬¬21å­—èŠ‚å¼€å§‹ ###TCPè¿æ¥çš„å»ºç«‹å’Œå…³é—­ ä½¿ç”¨tcpdumpè§‚å¯ŸTCPè¿æ¥çš„å»ºç«‹å’Œå…³é—­ ä»ernest-laptopä¸Šæ‰§è¡Œtelnetå‘½ä»¤ç™»å½•Kongming20çš„80ç«¯å£ï¼Œç„¶åæŠ“å–è¿™ä¸€è¿‡ç¨‹ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µã€‚ 123456789$sudo tcpdump-i eth0-nt &#x27;(src 192.168.1.109 and dst 192.168.1.108)or(src 192.168.1.108 and dst 192.168.1.109)&#x27;//æ–°å¼€ä¸€ä¸ªç»ˆç«¯$telnet 192.168.1.109 80Trying 192.168.1.109...Connected to 192.168.1.109.Escape character is&#x27;^]&#x27;. #è¾“å…¥ctrl+]å¹¶å›è½¦telnetï¼quit #ç»“æŸtcpè¿æ¥Connection closed. 123456781.IP 192.168.1.108.60871ï¼192.168.1.109.80:Flags[S],seq 535734930,win 5840,length 02.IP 192.168.1.109.80ï¼192.168.1.108.60871:Flags[S.],seq 2159701207,ack 535734931,win 5792,length 03.IP 192.168.1.108.60871ï¼192.168.1.109.80:Flags[.],ack 1,win 92,length 04.IP 192.168.1.108.60871ï¼192.168.1.109.80:Flags[F.],seq 1,ack 1,win 92,length 05.IP 192.168.1.109.80ï¼192.168.1.108.60871:Flags[.],ack 2,win 91,length 06.IP 192.168.1.109.80ï¼192.168.1.108.60871:Flags[F.],seq 1,ack 2,win 91,length 07.IP 192.168.1.108.60871ï¼192.168.1.109.80:Flags[.],ack 2,win 92,length 0 length 0 æ²¡æœ‰åº”ç”¨å±‚æ•°æ® â€‹ ç¬¬1ä¸ªTCPæŠ¥æ–‡æ®µåŒ…å«SYNæ ‡å¿—ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªåŒæ­¥æŠ¥æ–‡æ®µï¼Œå³å‘èµ·è¿æ¥è¯·æ±‚ã€‚åŒæ—¶ï¼Œè¯¥åŒæ­¥æŠ¥æ–‡æ®µåŒ…å«ä¸€ä¸ªISNå€¼ä¸º535734930çš„åºå·ã€‚ ç¬¬2ä¸ªTCPæŠ¥æ–‡æ®µä¹Ÿæ˜¯åŒæ­¥æŠ¥æ–‡æ®µï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ã€‚åŒæ—¶å®ƒå‘é€è‡ªå·±çš„ISNå€¼ä¸º2159701207çš„åºå·ï¼Œå¹¶å¯¹ç¬¬1ä¸ªåŒæ­¥æŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤ã€‚ç¡®è®¤å€¼æ˜¯535734931ï¼Œå³ç¬¬1ä¸ªåŒæ­¥æŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚åŒæ­¥æŠ¥æ–‡æ®µæ¯”è¾ƒç‰¹æ®Šï¼Œå³ä½¿å®ƒå¹¶æ²¡æœ‰æºå¸¦ä»»ä½•åº”ç”¨ç¨‹åºæ•°æ®ï¼Œå®ƒä¹Ÿè¦å ç”¨ä¸€ä¸ªåºå·å€¼ã€‚ ç¬¬3ä¸ªTCPæŠ¥æ–‡æ®µæ˜¯å¯¹ç¬¬2ä¸ªåŒæ­¥æŠ¥æ–‡æ®µçš„ç¡®è®¤ã€‚è‡³æ­¤ï¼ŒTCPè¿æ¥å°±å»ºç«‹èµ·æ¥äº†ã€‚ å»ºç«‹TCPè¿æ¥çš„è¿™3ä¸ªæ­¥éª¤è¢«ç§°ä¸ºTCPä¸‰æ¬¡æ¡æ‰‹ ä»ç¬¬3ä¸ªTCPæŠ¥æ–‡æ®µå¼€å§‹ï¼Œtcpdumpè¾“å‡ºçš„åºå·å€¼å’Œç¡®è®¤å€¼éƒ½æ˜¯ç›¸å¯¹åˆå§‹ISNå€¼çš„åç§»ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯tcpdumpçš„-Sé€‰é¡¹æ¥é€‰æ‹©æ‰“å°åºå·çš„ç»å¯¹å€¼ã€‚ ç¬¬4ä¸ªTCPæŠ¥æ–‡æ®µåŒ…å«FINæ ‡å¿—ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªç»“æŸæŠ¥æ–‡æ®µï¼Œå³è¦æ±‚å…³é—­è¿æ¥ã€‚ç»“æŸæŠ¥æ–‡æ®µå’ŒåŒæ­¥æŠ¥æ–‡æ®µä¸€æ ·ï¼Œä¹Ÿè¦å ç”¨ä¸€ä¸ªåºå·å€¼ã€‚ æŠ¥æ–‡æ®µ5æ¥ç¡®è®¤è¯¥ç»“æŸæŠ¥æ–‡æ®µã€‚ ç´§æ¥ç€å‘é€è‡ªå·±çš„ç»“æŸæŠ¥æ–‡æ®µ6 TCPæŠ¥æ–‡æ®µ7ç»™äºˆç¡®è®¤ã€‚ å®é™…ä¸Šï¼Œä»…ç”¨äºç¡®è®¤ç›®çš„çš„ç¡®è®¤æŠ¥æ–‡æ®µ5æ˜¯å¯ä»¥çœç•¥çš„ï¼Œå› ä¸ºç»“æŸæŠ¥æ–‡æ®µ6ä¹Ÿæºå¸¦äº†è¯¥ç¡®è®¤ä¿¡æ¯ã€‚ç¡®è®¤æŠ¥æ–‡æ®µ5æ˜¯å¦å‡ºç°åœ¨è¿æ¥æ–­å¼€çš„è¿‡ç¨‹ä¸­ï¼Œå–å†³äºTCPçš„å»¶è¿Ÿç¡®è®¤ç‰¹æ€§ã€‚å»¶è¿Ÿç¡®è®¤å°†åœ¨åé¢è®¨è®ºã€‚ æˆ‘è‡ªå·±å°è¯• å…ˆå®‰è£… tcpdump å’Œ telnet tcpdump -i ens160 â€˜(src 192.168.6.208 and dst 192.168.6.131)or(src 192.168.6.131 and dst 192.168.6.208)â€™ 1234567[root@localhost ~]# telnet 192.168.6.131 80Trying 192.168.6.131...telnet: connect to address 192.168.6.131: Connection refused[root@localhost ~]# telnet 192.168.6.131 80Trying 192.168.6.131...telnet: connect to address 192.168.6.131: No route to host 123456789[root@localhost .ssh]# tcpdump -i ens160 &#x27;(src 192.168.6.208 and dst 192.168.6.131)or(src 192.168.6.131 and dst 192.168.6.208)&#x27;22:27:14.825789 IP localhost.localdomain.58904 &gt; 192.168.6.131.http: Flags [S], seq 865449386, win 64240, options [mss 1460,sackOK,TS val 1199749114 ecr 0,nop,wscale 7], length 022:27:14.826569 IP 192.168.6.131 &gt; localhost.localdomain: ICMP host 192.168.6.131 unreachable - admin prohibited filter, length 6822:27:20.093253 ARP, Request who-has localhost.localdomain tell 192.168.6.131, length 4622:27:20.093275 ARP, Reply localhost.localdomain is-at 00:0c:29:a0:76:f3 (oui Unknown), length 2822:27:20.196832 ARP, Request who-has 192.168.6.131 tell localhost.localdomain, length 2822:27:20.197899 ARP, Reply 192.168.6.131 is-at 00:0c:29:1f:61:5b (oui Unknown), length 46 åŠå…³é—­çŠ¶æ€é€šä¿¡çš„ä¸€ç«¯å¯ä»¥å‘é€ç»“æŸæŠ¥æ–‡æ®µç»™å¯¹æ–¹ï¼Œå‘Šè¯‰å®ƒæœ¬ç«¯å·²ç»å®Œæˆäº†æ•°æ®çš„å‘é€ï¼Œä½†å…è®¸ç»§ç»­æ¥æ”¶æ¥è‡ªå¯¹æ–¹çš„æ•°æ®ï¼Œç›´åˆ°å¯¹æ–¹ä¹Ÿå‘é€ç»“æŸæŠ¥æ–‡æ®µä»¥å…³é—­è¿æ¥ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåˆ¤æ–­å¯¹æ–¹æ˜¯å¦å·²ç»å…³é—­è¿æ¥çš„æ–¹æ³•æ˜¯ï¼šreadç³»ç»Ÿè°ƒç”¨è¿”å›0ï¼ˆæ”¶åˆ°ç»“æŸæŠ¥æ–‡æ®µï¼‰ å¾ˆå°‘ä½¿ç”¨åŠå…³é—­çš„ç¨‹åº è¿æ¥è¶…æ—¶å®¢æˆ·ç«¯å‘é€å‡ºçš„åŒæ­¥æŠ¥æ–‡æ®µæ²¡æœ‰åº”ç­” å¯¹äºæä¾›å¯é æœåŠ¡çš„TCPæ¥è¯´ï¼Œå®ƒå¿…ç„¶æ˜¯å…ˆè¿›è¡Œé‡è¿ï¼ˆå¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼‰ï¼Œå¦‚æœé‡è¿ä»ç„¶æ— æ•ˆï¼Œåˆ™é€šçŸ¥åº”ç”¨ç¨‹åºè¿æ¥è¶…æ—¶ã€‚ $sudo iptables-F $sudo iptables-I INPUT-p tcpâ€“syn-i eth0-j DROP iptableå‘½ä»¤ç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å®ƒæ¥ä¸¢å¼ƒæ‰€æœ‰æ¥æ”¶åˆ°çš„è¿æ¥è¯·æ±‚ï¼ˆä¸¢å¼ƒæ‰€æœ‰åŒæ­¥æŠ¥æ–‡æ®µï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±æ— æ³•å¾—åˆ°ä»»ä½•ç¡®è®¤æŠ¥æ–‡æ®µï¼‰ã€‚ 123456$sudo tcpdump-n-i eth0 port 23 #ä»…æŠ“å–telnetå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„æ•°æ®åŒ…$date;telnet 192.168.1.108;date #åœ¨telnetå‘½ä»¤å‰åéƒ½æ‰§è¡Œdateå‘½ä»¤ï¼Œä»¥è®¡ç®—è¶…æ—¶æ—¶é—´Mon Jun 11 21:23:35 CST 2012Trying 192.168.1.108...telnet:connect to address 192.168.1.108:Connection timed outMon Jun 11 21:24:38 CST 2012 å»ºç«‹TCPè¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯63s 1234567891011121.21:23:35.612136 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096ï¼Œlength 02.21:23:36.613146 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096,length 03.21:23:38.617279 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096,length 04.21:23:42.625140 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096,length 05.21:23:50.641344 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096,length 06.21:24:06.673331 IP 192.168.1.109.39385ï¼192.168.1.108.telnet:Flags[S],seq 1355982096,length 0 ä¿ç•™äº†tcpdumpè¾“å‡ºçš„æ—¶é—´æˆ³ ä¸ä½¿ç”¨-t åé¢äº”ä¸ªéƒ½æ˜¯è¶…æ—¶é‡è¿æŠ¥æ–‡ ç¬¬ä¸€æ¬¡2s æ¯æ¬¡å¢å€æ—¶é—´ TCPçŠ¶æ€è½¬ç§»TCPè¿æ¥çš„ä»»æ„ä¸€ç«¯åœ¨ä»»ä¸€æ—¶åˆ»éƒ½å¤„äºæŸç§çŠ¶æ€ï¼Œå½“å‰çŠ¶æ€å¯ä»¥é€šè¿‡netstatå‘½ä»¤æŸ¥çœ‹ ç²—è™šçº¿è¡¨ç¤ºå…¸å‹çš„æœåŠ¡å™¨ç«¯è¿æ¥çš„çŠ¶æ€è½¬ç§» ç²—å®çº¿è¡¨ç¤ºå…¸å‹çš„å®¢æˆ·ç«¯è¿æ¥çš„çŠ¶æ€è½¬ç§»ã€‚ CLOSEDæ˜¯ä¸€ä¸ªå‡æƒ³çš„èµ·å§‹ç‚¹ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå®é™…çš„çŠ¶æ€ã€‚ TCPçŠ¶æ€è½¬ç§»æ€»å›¾å…ˆä»CLOSEDå¼€å§‹æ²¿ç€è™šçº¿èµ°ä¸€éå°±æ˜¯æœåŠ¡å™¨çš„çŠ¶æ€è½¬ç§»è¿‡ç¨‹ å…ˆä¸»åŠ¨è°ƒç”¨listenè¿›å…¥è¢«åŠ¨è¿æ¥çŠ¶æ€ å®¢æˆ·ç«¯é€šè¿‡connectç³»ç»Ÿè°ƒç”¨ä¸»åŠ¨ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚connectç³»ç»Ÿè°ƒç”¨é¦–å…ˆç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒæ­¥æŠ¥æ–‡æ®µï¼Œä½¿è¿æ¥è½¬ç§»åˆ°SYN_SENTçŠ¶æ€ã€‚æ­¤åï¼Œconnectç³»ç»Ÿè°ƒç”¨å¯èƒ½å› ä¸ºå¦‚ä¸‹ä¸¤ä¸ªåŸå› å¤±è´¥ å¦‚æœconnectè¿æ¥çš„ç›®æ ‡ç«¯å£ä¸å­˜åœ¨ï¼ˆæœªè¢«ä»»ä½•è¿›ç¨‹ç›‘å¬ï¼‰ï¼Œæˆ–è€…è¯¥ç«¯å£ä»è¢«å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥æ‰€å ç”¨ï¼Œåˆ™æœåŠ¡å™¨å°†ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¤ä½æŠ¥æ–‡æ®µï¼Œconnectè°ƒç”¨å¤±è´¥ã€‚ å¦‚æœç›®æ ‡ç«¯å£å­˜åœ¨ï¼Œä½†connectåœ¨è¶…æ—¶æ—¶é—´å†…æœªæ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼Œåˆ™connectè°ƒç”¨å¤±è´¥ã€‚ connectè°ƒç”¨å¤±è´¥å°†ä½¿è¿æ¥ç«‹å³è¿”å›åˆ°åˆå§‹çš„CLOSEDçŠ¶æ€ã€‚å¦‚æœå®¢æˆ·ç«¯æˆåŠŸæ”¶åˆ°æœåŠ¡å™¨çš„åŒæ­¥æŠ¥æ–‡æ®µå’Œç¡®è®¤ï¼Œåˆ™connectè°ƒç”¨æˆåŠŸè¿”å›ï¼Œè¿æ¥è½¬ç§»è‡³ESTABLISHEDçŠ¶æ€ã€‚ å½“å®¢æˆ·ç«¯æ‰§è¡Œä¸»åŠ¨å…³é—­æ—¶ï¼Œå®ƒå°†å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç»“æŸæŠ¥æ–‡æ®µï¼ŒåŒæ—¶è¿æ¥è¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚è‹¥æ­¤æ—¶å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨ä¸“é—¨ç”¨äºç¡®è®¤ç›®çš„çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼Œåˆ™è¿æ¥è½¬ç§»è‡³FIN_WAIT_2çŠ¶æ€ã€‚å½“å®¢æˆ·ç«¯å¤„äºFIN_WAIT_2çŠ¶æ€æ—¶ï¼ŒæœåŠ¡å™¨å¤„äºCLOSE_WAITçŠ¶æ€ï¼Œè¿™ä¸€å¯¹çŠ¶æ€æ˜¯å¯èƒ½å‘ç”ŸåŠå…³é—­çš„çŠ¶æ€ã€‚æ­¤æ—¶å¦‚æœæœåŠ¡å™¨ä¹Ÿå…³é—­è¿æ¥ï¼ˆå‘é€ç»“æŸæŠ¥æ–‡æ®µï¼‰ï¼Œåˆ™å®¢æˆ·ç«¯å°†ç»™äºˆç¡®è®¤å¹¶è¿›å…¥TIME_WAITçŠ¶æ€ã€‚ å®¢æˆ·ç«¯ä»FIN_WAIT_1çŠ¶æ€ç›´æ¥è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œå‰ææ˜¯å¤„äºFIN_WAIT_1çŠ¶æ€çš„æœåŠ¡å™¨ç›´æ¥æ”¶åˆ°å¸¦ç¡®è®¤ä¿¡æ¯çš„ç»“æŸæŠ¥æ–‡æ®µï¼ˆè€Œä¸æ˜¯å…ˆæ”¶åˆ°ç¡®è®¤æŠ¥æ–‡æ®µï¼Œå†æ”¶åˆ°ç»“æŸæŠ¥æ–‡æ®µï¼‰ã€‚ å‰é¢è¯´è¿‡ï¼Œå¤„äºFIN_WAIT_2çŠ¶æ€çš„å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…æœåŠ¡å™¨å‘é€ç»“æŸæŠ¥æ–‡æ®µï¼Œæ‰èƒ½è½¬ç§»è‡³TIME_WAITçŠ¶æ€ï¼Œå¦åˆ™å®ƒå°†ä¸€ç›´åœç•™åœ¨è¿™ä¸ªçŠ¶æ€ã€‚å¦‚æœä¸æ˜¯ä¸ºäº†åœ¨åŠå…³é—­çŠ¶æ€ä¸‹ç»§ç»­æ¥æ”¶æ•°æ®ï¼Œè¿æ¥é•¿æ—¶é—´åœ°åœç•™åœ¨FIN_WAIT_2çŠ¶æ€å¹¶æ— ç›Šå¤„ã€‚è¿æ¥åœç•™åœ¨FIN_WAIT_2çŠ¶æ€çš„æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨ï¼šå®¢æˆ·ç«¯æ‰§è¡ŒåŠå…³é—­åï¼Œæœªç­‰æœåŠ¡å™¨å…³é—­è¿æ¥å°±å¼ºè¡Œé€€å‡ºäº†ã€‚æ­¤æ—¶å®¢æˆ·ç«¯è¿æ¥ç”±å†…æ ¸æ¥æ¥ç®¡ï¼Œå¯ç§°ä¹‹ä¸ºå­¤å„¿è¿æ¥ï¼ˆå’Œå­¤å„¿è¿›ç¨‹ç±»ä¼¼ï¼‰ã€‚Linuxä¸ºäº†é˜²æ­¢å­¤å„¿è¿æ¥é•¿æ—¶é—´å­˜ç•™åœ¨å†…æ ¸ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå†…æ ¸å˜é‡ï¼š&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_max_orphanså’Œ&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_fin_timeoutã€‚å‰è€…æŒ‡å®šå†…æ ¸èƒ½æ¥ç®¡çš„å­¤å„¿è¿æ¥æ•°ç›®ï¼Œåè€…æŒ‡å®šå­¤å„¿è¿æ¥åœ¨å†…æ ¸ä¸­ç”Ÿå­˜çš„æ—¶é—´ã€‚ TIME_WAITçŠ¶æ€å®¢æˆ·ç«¯è¿æ¥åœ¨æ”¶åˆ°æœåŠ¡å™¨çš„ç»“æŸæŠ¥æ–‡æ®µï¼ˆTCPæŠ¥æ–‡æ®µ6ï¼‰ä¹‹åï¼Œå¹¶æ²¡æœ‰ç›´æ¥è¿›å…¥CLOSEDçŠ¶æ€ï¼Œè€Œæ˜¯è½¬ç§»åˆ°TIME_WAITçŠ¶æ€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ï¼Œå®¢æˆ·ç«¯è¿æ¥è¦ç­‰å¾…ä¸€æ®µé•¿ä¸º2MSLï¼ˆMaximum Segment Lifeï¼ŒæŠ¥æ–‡æ®µæœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼‰çš„æ—¶é—´ï¼Œæ‰èƒ½å®Œå…¨å…³é—­ã€‚MSLæ˜¯TCPæŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œæ ‡å‡†æ–‡æ¡£RFC 1122çš„å»ºè®®å€¼æ˜¯2min åŸå›  å¯é åœ°ç»ˆæ­¢TCPè¿æ¥ã€‚ å‡è®¾æ–‡æ®µ7ä¸¢å¤±ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†é‡å‘ç»“æŸæŠ¥æ–‡æ®µã€‚å› æ­¤å®¢æˆ·ç«¯éœ€è¦åœç•™åœ¨æŸä¸ªçŠ¶æ€ä»¥å¤„ç†é‡å¤æ”¶åˆ°çš„ç»“æŸæŠ¥æ–‡æ®µï¼ˆå³å‘æœåŠ¡å™¨å‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼‰ã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯å°†ä»¥å¤ä½æŠ¥æ–‡æ®µæ¥å›åº”æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨åˆ™è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå®ƒæœŸæœ›çš„æ˜¯ä¸€ä¸ªåƒTCPæŠ¥æ–‡æ®µ7é‚£æ ·çš„ç¡®è®¤æŠ¥æ–‡æ®µã€‚ ä¿è¯è®©è¿Ÿæ¥çš„TCPæŠ¥æ–‡æ®µæœ‰è¶³å¤Ÿçš„æ—¶é—´è¢«è¯†åˆ«å¹¶ä¸¢å¼ƒ åœ¨Linuxç³»ç»Ÿä¸Šï¼Œä¸€ä¸ªTCPç«¯å£ä¸èƒ½è¢«åŒæ—¶æ‰“å¼€å¤šæ¬¡ï¼ˆä¸¤æ¬¡åŠä»¥ä¸Šï¼‰ã€‚å½“ä¸€ä¸ªTCPè¿æ¥å¤„äºTIME_WAITçŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å°†æ— æ³•ç«‹å³ä½¿ç”¨è¯¥è¿æ¥å ç”¨ç€çš„ç«¯å£æ¥å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ã€‚åè¿‡æ¥æ€è€ƒï¼Œå¦‚æœä¸å­˜åœ¨TIME_WAITçŠ¶æ€ï¼Œåˆ™åº”ç”¨ç¨‹åºèƒ½å¤Ÿç«‹å³å»ºç«‹ä¸€ä¸ªå’Œåˆšå…³é—­çš„è¿æ¥ç›¸ä¼¼çš„è¿æ¥ï¼ˆè¿™é‡Œè¯´çš„ç›¸ä¼¼ï¼Œæ˜¯æŒ‡å®ƒä»¬å…·æœ‰ç›¸åŒçš„IPåœ°å€å’Œç«¯å£å·ï¼‰ã€‚è¿™ä¸ªæ–°çš„ã€å’ŒåŸæ¥ç›¸ä¼¼çš„è¿æ¥è¢«ç§°ä¸ºåŸæ¥çš„è¿æ¥çš„åŒ–èº«ï¼ˆincarnationï¼‰ã€‚æ–°çš„åŒ–èº«å¯èƒ½æ¥æ”¶åˆ°å±äºåŸæ¥çš„è¿æ¥çš„ã€æºå¸¦åº”ç”¨ç¨‹åºæ•°æ®çš„TCPæŠ¥æ–‡æ®µï¼ˆè¿Ÿåˆ°çš„æŠ¥æ–‡æ®µï¼‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åº”è¯¥å‘ç”Ÿçš„ã€‚ å¦å¤–ï¼Œå› ä¸ºTCPæŠ¥æ–‡æ®µçš„æœ€å¤§ç”Ÿå­˜æ—¶é—´æ˜¯MSLï¼Œæ‰€ä»¥åšæŒ2MSLæ—¶é—´çš„TIME_WAITçŠ¶æ€èƒ½å¤Ÿç¡®ä¿ç½‘ç»œä¸Šä¸¤ä¸ªä¼ è¾“æ–¹å‘ä¸Šå°šæœªè¢«æ¥æ”¶åˆ°çš„ã€è¿Ÿåˆ°çš„TCPæŠ¥æ–‡æ®µéƒ½å·²ç»æ¶ˆå¤±ï¼ˆè¢«ä¸­è½¬è·¯ç”±å™¨ä¸¢å¼ƒï¼‰ã€‚å› æ­¤ï¼Œä¸€ä¸ªè¿æ¥çš„æ–°çš„åŒ–èº«å¯ä»¥åœ¨2MSLæ—¶é—´ä¹‹åå®‰å…¨åœ°å»ºç«‹ï¼Œè€Œç»å¯¹ä¸ä¼šæ¥æ”¶åˆ°å±äºåŸæ¥è¿æ¥çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œè¿™å°±æ˜¯TIME_WAITçŠ¶æ€è¦æŒç»­2MSLæ—¶é—´çš„åŸå› ã€‚ æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›é¿å…TIME_WAITçŠ¶æ€ï¼Œå› ä¸ºå½“ç¨‹åºé€€å‡ºåï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç«‹å³é‡å¯å®ƒã€‚ä½†ç”±äºå¤„åœ¨TIME_WAITçŠ¶æ€çš„è¿æ¥è¿˜å ç”¨ç€ç«¯å£ï¼Œç¨‹åºå°†æ— æ³•å¯åŠ¨ï¼ˆç›´åˆ°2MSLè¶…æ—¶æ—¶é—´ç»“æŸï¼‰ã€‚è€ƒè™‘ä¸€ä¸ªä¾‹å­ï¼šåœ¨æµ‹è¯•æœºå™¨ernest-laptopä¸Šä»¥å®¢æˆ·ç«¯æ–¹å¼è¿è¡Œncï¼ˆç”¨äºåˆ›å»ºç½‘ç»œè¿æ¥çš„å·¥å…·ï¼Œè§ç¬¬17ç« ï¼‰å‘½ä»¤ï¼Œç™»å½•æœ¬æœºçš„WebæœåŠ¡ï¼Œä¸”æ˜ç¡®æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨12345ç«¯å£ä¸æœåŠ¡å™¨é€šä¿¡ã€‚ç„¶åä»ç»ˆç«¯è¾“å…¥Ctrl+Cç»ˆæ­¢å®¢æˆ·ç«¯ç¨‹åºï¼Œæ¥ç€åˆç«‹å³é‡å¯ncç¨‹åºï¼Œä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼å†æ¬¡è¿æ¥æœ¬æœºçš„WebæœåŠ¡ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š 12345678$nc-p 12345 192.168.1.108 80ctrl+C#ä¸­æ–­å®¢æˆ·ç«¯ç¨‹åº$nc-p 12345 192.168.1.108 80#é‡å¯å®¢æˆ·ç«¯ç¨‹åºï¼Œé‡æ–°å»ºç«‹è¿æ¥nc:bind failed:Address already in use#è¾“å‡ºæ˜¾ç¤ºè¿æ¥å¤±è´¥ï¼Œå› ä¸º12345ç«¯å£ä»è¢«å ç”¨$netstat-nat#ç”¨netstatå‘½ä»¤æŸ¥çœ‹è¿æ¥çŠ¶æ€Proto Recv-Q Send-Q Local Address Foreign Address Statetcp 0 0 192.168.1.108:12345 192.168.1.108:80 TIME_WAIT ä¸€èˆ¬å®¢æˆ·ç«¯ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„éšæœºç«¯å£ï¼Œæˆ‘ä»¬å¼ºåˆ¶ä½¿ç”¨12345å·ç«¯å£æ‰ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ ä½†å¦‚æœæ˜¯æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥åå¼‚å¸¸ç»ˆæ­¢ï¼Œåˆ™å› ä¸ºå®ƒæ€»æ˜¯ä½¿ç”¨åŒä¸€ä¸ªçŸ¥åæœåŠ¡ç«¯å£å·ï¼Œæ‰€ä»¥è¿æ¥çš„TIME_WAITçŠ¶æ€å°†å¯¼è‡´å®ƒä¸èƒ½ç«‹å³é‡å¯ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡socketé€‰é¡¹SO_REUSEADDRæ¥å¼ºåˆ¶è¿›ç¨‹ç«‹å³ä½¿ç”¨å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥å ç”¨çš„ç«¯å£ ä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥æ¥æ”¶å¤šå°‘tcpè¿æ¥ï¼Ÿ å¤ä½æŠ¥æ–‡æ®µTCPè¿æ¥çš„ä¸€ç«¯ä¼šå‘å¦ä¸€ç«¯å‘é€æºå¸¦RSTæ ‡å¿—çš„æŠ¥æ–‡æ®µï¼Œå³å¤ä½æŠ¥æ–‡æ®µï¼Œä»¥é€šçŸ¥å¯¹æ–¹å…³é—­è¿æ¥æˆ–é‡æ–°å»ºç«‹è¿æ¥ è®¿é—®ä¸å­˜åœ¨çš„ç«¯å£ä¼šå‘é€å¤ä½æŠ¥æ–‡æ®µ 12345678$sudo tcpdump-nt-i eth0 port 54321#ä»…æŠ“å–å‘é€è‡³å’Œæ¥è‡ª54321ç«¯å£çš„TCPæŠ¥æ–‡æ®µ$telnet 192.168.1.108 54321Trying 192.168.1.108...telnet:connect to address 192.168.1.108:Connection refused1.IP 192.168.1.109.42001ï¼192.168.1.108.54321:Flags[S],seq 21621375,win 14600,length 02.IP 192.168.1.108.54321ï¼192.168.1.109.42001:Flags[R.],seq 0,ack 21621376,win 0,length 0 å›å¤ä¸€ä¸ªå¤ä½æŠ¥æ–‡æ®µR æ¥æ”¶é€šå‘Šçª—å£ä¸º0ï¼Œæ‰€ä»¥æ”¶åˆ°å¤ä½çš„ä¸€æ–¹ä¸èƒ½å›åº”å¹¶ä¸”åº”è¯¥å…³é—­æˆ–é‡æ–°è¿æ¥ å½“å®¢æˆ·ç«¯ç¨‹åºå‘æœåŠ¡å™¨çš„æŸä¸ªç«¯å£å‘èµ·è¿æ¥ï¼Œè€Œè¯¥ç«¯å£ä»è¢«å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥æ‰€å ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¹Ÿå°†æ”¶åˆ°å¤ä½æŠ¥æ–‡æ®µ å¼‚å¸¸ç»ˆæ­¢è¿æ¥TCPæä¾›äº†å¼‚å¸¸ç»ˆæ­¢ä¸€ä¸ªè¿æ¥çš„æ–¹æ³•ï¼Œå³ç»™å¯¹æ–¹å‘é€ä¸€ä¸ªå¤ä½æŠ¥æ–‡æ®µã€‚ä¸€æ—¦å‘é€äº†å¤ä½æŠ¥æ–‡æ®µï¼Œå‘é€ç«¯æ‰€æœ‰æ’é˜Ÿç­‰å¾…å‘é€çš„æ•°æ®éƒ½å°†è¢«ä¸¢å¼ƒã€‚ åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨socketé€‰é¡¹SO_LINGERæ¥å‘é€å¤ä½æŠ¥æ–‡æ®µï¼Œä»¥å¼‚å¸¸ç»ˆæ­¢ä¸€ä¸ªè¿æ¥ã€‚ å¤„ç†åŠæ‰“å¼€è¿æ¥æœåŠ¡å™¨ï¼ˆæˆ–å®¢æˆ·ç«¯ï¼‰å…³é—­æˆ–è€…å¼‚å¸¸ç»ˆæ­¢äº†è¿æ¥ï¼Œè€Œå¯¹æ–¹æ²¡æœ‰æ¥æ”¶åˆ°ç»“æŸæŠ¥æ–‡æ®µï¼ˆæ¯”å¦‚å‘ç”Ÿäº†ç½‘ç»œæ•…éšœï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ï¼ˆæˆ–æœåŠ¡å™¨ï¼‰è¿˜ç»´æŒç€åŸæ¥çš„è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨ï¼ˆæˆ–å®¢æˆ·ç«¯ï¼‰å³ä½¿é‡å¯ï¼Œä¹Ÿå·²ç»æ²¡æœ‰è¯¥è¿æ¥çš„ä»»ä½•ä¿¡æ¯äº†ã€‚æˆ‘ä»¬å°†è¿™ç§çŠ¶æ€ç§°ä¸ºåŠæ‰“å¼€çŠ¶æ€ï¼Œå¤„äºè¿™ç§çŠ¶æ€çš„è¿æ¥ç§°ä¸ºåŠæ‰“å¼€è¿æ¥ã€‚å¦‚æœå®¢æˆ·ç«¯ï¼ˆæˆ–æœåŠ¡å™¨ï¼‰å¾€å¤„äºåŠæ‰“å¼€çŠ¶æ€çš„è¿æ¥å†™å…¥æ•°æ®ï¼Œåˆ™å¯¹æ–¹å°†å›åº”ä¸€ä¸ªå¤ä½æŠ¥æ–‡æ®µã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨Kongming20ä¸Šä½¿ç”¨ncå‘½ä»¤æ¨¡æ‹Ÿä¸€ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œä½¿ä¹‹ç›‘å¬12345ç«¯å£ï¼Œç„¶åä»ernest-laptopè¿è¡Œtelnetå‘½ä»¤ç™»å½•åˆ°è¯¥ç«¯å£ä¸Šï¼Œæ¥ç€æ‹”æ‰ernest-laptopçš„ç½‘çº¿ï¼Œå¹¶åœ¨Kongming20ä¸Šä¸­æ–­æœåŠ¡å™¨ç¨‹åºã€‚æ˜¾ç„¶ï¼Œæ­¤æ—¶ernest-laptopä¸Šè¿è¡Œçš„telnetå®¢æˆ·ç«¯ç¨‹åºç»´æŒç€ä¸€ä¸ªåŠæ‰“å¼€è¿æ¥ã€‚ç„¶åæ¥ä¸Šernest-laptopçš„ç½‘çº¿ï¼Œå¹¶ä»å®¢æˆ·ç«¯ç¨‹åºå¾€åŠæ‰“å¼€è¿æ¥å†™å…¥1å­—èŠ‚çš„æ•°æ®â€œaâ€ã€‚åŒæ—¶ï¼Œè¿è¡Œtcpdumpç¨‹åºæŠ“å–æ•´ä¸ªè¿‡ç¨‹ä¸­telnetå®¢æˆ·ç«¯å’ŒncæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µã€‚å…·ä½“æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 1234567891011121314$nc-l 12345#åœ¨Kongming20ä¸Šè¿è¡ŒæœåŠ¡å™¨ç¨‹åº$sudo tcpdump-nt-i eth0 port 12345$telnet 192.168.1.109 12345#åœ¨ernest-laptopä¸Šè¿è¡Œå®¢æˆ·ç«¯ç¨‹åºTrying 192.168.1.109...Connected to 192.168.1.109.Escape character is&#x27;^]&#x27;.#æ­¤æ—¶æ–­å¼€ernest-laptopçš„ç½‘çº¿ï¼Œå¹¶é‡å¯æœåŠ¡å™¨aï¼ˆå›è½¦ï¼‰#å‘åŠæ‰“å¼€è¿æ¥è¾“å…¥å­—ç¬¦aConnection closed by foreign host.1.IP 192.168.1.108.55100ï¼192.168.1.109.12345:Flags[S],seq 3093809365,length 02.IP 192.168.1.109.12345ï¼192.168.1.108.55100:Flags[S.],seq 1495337791,ack 3093809366,length 03.IP 192.168.1.108.55100ï¼192.168.1.109.12345:Flags[.],ack 1,length 04.IP 192.168.1.108.55100ï¼192.168.1.109.12345:Flags[P.],seq 1:4,ack 1,length 35.IP 192.168.1.109.12345ï¼192.168.1.108.55100:Flags[R],seq 1495337792,length 0 è¯¥è¾“å‡ºå†…å®¹ä¸­ï¼Œå‰3ä¸ªTCPæŠ¥æ–‡æ®µæ˜¯æ­£å¸¸å»ºç«‹TCPè¿æ¥çš„3æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚ ç¬¬4ä¸ªTCPæŠ¥æ–‡æ®µç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œå®ƒæºå¸¦äº†3å­—èŠ‚çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œè¿™3å­—èŠ‚ä¾æ¬¡æ˜¯ï¼šå­—æ¯â€œaâ€ã€å›è½¦ç¬¦â€œ\\râ€å’Œæ¢è¡Œç¬¦â€œ\\nâ€ã€‚ä¸è¿‡å› ä¸ºæœåŠ¡å™¨ç¨‹åºå·²ç»è¢«ä¸­æ–­ï¼Œæ‰€ä»¥Kongming20å¯¹å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å›åº”äº†ä¸€ä¸ªå¤ä½æŠ¥æ–‡æ®µ5ã€‚ TCPäº¤äº’æ•°æ®æµTCPæŠ¥æ–‡æ®µæ‰€æºå¸¦çš„åº”ç”¨ç¨‹åºæ•°æ®æŒ‰ç…§é•¿åº¦åˆ†ä¸ºä¸¤ç§ï¼šäº¤äº’æ•°æ®å’Œæˆå—æ•°æ®ã€‚äº¤äº’æ•°æ®ä»…åŒ…å«å¾ˆå°‘çš„å­—èŠ‚ã€‚ ä½¿ç”¨äº¤äº’æ•°æ®çš„åº”ç”¨ç¨‹åºï¼ˆæˆ–åè®®ï¼‰å¯¹å®æ—¶æ€§è¦æ±‚é«˜ï¼Œæ¯”å¦‚telnetã€sshç­‰ã€‚æˆå—æ•°æ®çš„é•¿åº¦åˆ™é€šå¸¸ä¸ºTCPæŠ¥æ–‡æ®µå…è®¸çš„æœ€å¤§æ•°æ®é•¿åº¦ã€‚ä½¿ç”¨æˆå—æ•°æ®çš„åº”ç”¨ç¨‹åºï¼ˆæˆ–åè®®ï¼‰å¯¹ä¼ è¾“æ•ˆç‡è¦æ±‚é«˜ï¼Œæ¯”å¦‚ftpã€‚ è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼šåœ¨ernest-laptopä¸Šæ‰§è¡Œtelnetå‘½ä»¤ç™»å½•åˆ°æœ¬æœºï¼Œç„¶ååœ¨shellå‘½ä»¤æç¤ºç¬¦åæ‰§è¡Œlså‘½ä»¤ï¼ŒåŒæ—¶ç”¨tcpdumpæŠ“å–è¿™ä¸€è¿‡ç¨‹ä¸­telnetå®¢æˆ·ç«¯å’ŒtelnetæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µã€‚å…·ä½“æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021$tcpdump-nt-i lo port 23$telnet 127.0.0.1Trying 127.0.0.1...Connected to 127.0.0.1.Escape character is&#x27;^]&#x27;.Ubuntu 9.10ernest-laptop login:ernestï¼ˆå›è½¦ï¼‰ #è¾“å…¥ç”¨æˆ·åå¹¶å›è½¦Password:ï¼ˆå›è½¦ï¼‰ #è¾“å…¥å¯†ç å¹¶å›è½¦ernest@ernest-laptop:ï½$lsï¼ˆå›è½¦ï¼‰1.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[P.],seq 1408334812:1408334813,ack 1415955507,win 613,length 12.IP 127.0.0.1.23ï¼127.0.0.1.58130:Flags[P.],seq 1:2,ack 1,win 512,length 13.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[.],ack 2,win 613,length 04.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[P.],seq 1:2,ack 2,win 613,length 15.IP 127.0.0.1.23ï¼127.0.0.1.58130:Flags[P.],seq 2:3,ack 2,win 512,length 16.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[.],ack 3,win 613,length 07.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[P.],seq 2:4,ack 3,win 613,length 28.IP 127.0.0.1.23ï¼127.0.0.1.58130:Flags[P.],seq 3:176,ack 4,win 512,length 1739.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[.],ack 176,win 630,length 010.IP 127.0.0.1.23ï¼127.0.0.1.58130:Flags[P.],seq 176:228,ack 4,win 512,length 5211.IP 127.0.0.1.58130ï¼127.0.0.1.23:Flags[.],ack 228,win 630,length 0 TCPæŠ¥æ–‡æ®µ1ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œå®ƒæºå¸¦1ä¸ªå­—èŠ‚çš„åº”ç”¨ç¨‹åºæ•°æ®ï¼Œå³å­—æ¯â€œlâ€ã€‚TCPæŠ¥æ–‡æ®µ2æ˜¯æœåŠ¡å™¨å¯¹TCPæŠ¥æ–‡æ®µ1çš„ç¡®è®¤ï¼ŒåŒæ—¶å›æ˜¾å­—æ¯â€œlâ€ã€‚TCPæŠ¥æ–‡æ®µ3æ˜¯å®¢æˆ·ç«¯å¯¹TCPæŠ¥æ–‡æ®µ2çš„ç¡®è®¤ã€‚ç¬¬4ï½6ä¸ªTCPæŠ¥æ–‡æ®µæ˜¯é’ˆå¯¹å­—æ¯â€œsâ€çš„ä¸Šè¿°è¿‡ç¨‹ã€‚TCPæŠ¥æ–‡æ®µ7ä¼ é€çš„2å­—èŠ‚æ•°æ®åˆ†åˆ«æ˜¯ï¼šå®¢æˆ·ç«¯é”®å…¥çš„å›è½¦ç¬¦å’Œæµç»“æŸç¬¦ï¼ˆEOFï¼Œæœ¬ä¾‹ä¸­æ˜¯0x00ï¼‰ã€‚TCPæŠ¥æ–‡æ®µ8æºå¸¦æœåŠ¡å™¨è¿”å›çš„å®¢æˆ·æŸ¥è¯¢çš„ç›®å½•çš„å†…å®¹ï¼ˆlså‘½ä»¤çš„è¾“å‡ºï¼‰ï¼ŒåŒ…æ‹¬è¯¥ç›®å½•ä¸‹æ–‡ä»¶çš„æ–‡ä»¶ååŠå…¶æ˜¾ç¤ºæ§åˆ¶å‚æ•°ã€‚TCPæŠ¥æ–‡æ®µ9æ˜¯å®¢æˆ·ç«¯å¯¹TCPæŠ¥æ–‡æ®µ8çš„ç¡®è®¤ã€‚TCPæŠ¥æ–‡æ®µ10æºå¸¦çš„ä¹Ÿæ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå›è½¦ç¬¦ã€ä¸€ä¸ªæ¢è¡Œç¬¦ã€å®¢æˆ·ç«¯ç™»å½•ç”¨æˆ·çš„PS1ç¯å¢ƒå˜é‡ï¼ˆç¬¬ä¸€çº§å‘½ä»¤æç¤ºç¬¦ï¼‰ã€‚TCPæŠ¥æ–‡æ®µ11æ˜¯å®¢æˆ·ç«¯å¯¹TCPæŠ¥æ–‡æ®µ10çš„ç¡®è®¤ã€‚ åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ‰€å‘é€çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼ˆTCPæŠ¥æ–‡æ®µ6ã€9å’Œ11ï¼‰éƒ½ä¸æºå¸¦ä»»ä½•åº”ç”¨ç¨‹åºæ•°æ®ï¼ˆé•¿åº¦ä¸º0ï¼‰ï¼Œè€ŒæœåŠ¡å™¨æ¯æ¬¡å‘é€çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼ˆTCPæŠ¥æ–‡æ®µ2ã€5ã€8å’Œ10ï¼‰éƒ½åŒ…å«å®ƒéœ€è¦å‘é€çš„åº”ç”¨ç¨‹åºæ•°æ®ã€‚æœåŠ¡å™¨çš„è¿™ç§å¤„ç†æ–¹å¼ç§°ä¸ºå»¶è¿Ÿç¡®è®¤ï¼Œå³å®ƒä¸é©¬ä¸Šç¡®è®¤ä¸Šæ¬¡æ”¶åˆ°çš„æ•°æ®ï¼Œè€Œæ˜¯åœ¨ä¸€æ®µå»¶è¿Ÿæ—¶é—´åæŸ¥çœ‹æœ¬ç«¯æ˜¯å¦æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å’Œç¡®è®¤ä¿¡æ¯ä¸€èµ·å‘å‡ºã€‚å› ä¸ºæœåŠ¡å™¨å¯¹å®¢æˆ·è¯·æ±‚å¤„ç†å¾—å¾ˆå¿«ï¼Œæ‰€ä»¥å®ƒå‘é€ç¡®è®¤æŠ¥æ–‡æ®µçš„æ—¶å€™æ€»æ˜¯æœ‰æ•°æ®ä¸€èµ·å‘é€ã€‚å»¶è¿Ÿç¡®è®¤å¯ä»¥å‡å°‘å‘é€TCPæŠ¥æ–‡æ®µçš„æ•°é‡ã€‚è€Œç”±äºç”¨æˆ·çš„è¾“å…¥é€Ÿåº¦æ˜æ˜¾æ…¢äºå®¢æˆ·ç«¯ç¨‹åºçš„å¤„ç†é€Ÿåº¦ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡æ®µæ€»æ˜¯ä¸æºå¸¦ä»»ä½•åº”ç”¨ç¨‹åºæ•°æ®ã€‚ å‰æ–‡æ›¾æåˆ°ï¼Œåœ¨TCPè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿå»¶è¿Ÿç¡®è®¤ã€‚ä¸Šä¾‹æ˜¯åœ¨æœ¬åœ°å›è·¯è¿è¡Œçš„ç»“æœï¼Œåœ¨å±€åŸŸç½‘ä¸­ä¹Ÿèƒ½å¾—åˆ°åŸºæœ¬ç›¸åŒçš„ç»“æœï¼Œä½†åœ¨å¹¿åŸŸç½‘å°±æœªå¿…å¦‚æ­¤äº†ã€‚å¹¿åŸŸç½‘ä¸Šçš„äº¤äº’æ•°æ®æµå¯èƒ½ç»å—å¾ˆå¤§çš„å»¶è¿Ÿï¼Œå¹¶ä¸”ï¼Œæºå¸¦äº¤äº’æ•°æ®çš„å¾®å°TCPæŠ¥æ–‡æ®µæ•°é‡ä¸€èˆ¬å¾ˆå¤šï¼ˆä¸€ä¸ªæŒ‰é”®è¾“å…¥å°±å¯¼è‡´ä¸€ä¸ªTCPæŠ¥æ–‡æ®µï¼‰ï¼Œè¿™äº›å› ç´ éƒ½å¯èƒ½å¯¼è‡´æ‹¥å¡å‘ç”Ÿã€‚è§£å†³è¯¥é—®é¢˜çš„ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä½¿ç”¨Nagleç®—æ³•ã€‚Nagleç®—æ³•è¦æ±‚ä¸€ä¸ªTCPè¿æ¥çš„é€šä¿¡åŒæ–¹åœ¨ä»»æ„æ—¶åˆ»éƒ½æœ€å¤šåªèƒ½å‘é€ä¸€ä¸ªæœªè¢«ç¡®è®¤çš„TCPæŠ¥æ–‡æ®µï¼Œåœ¨è¯¥TCPæŠ¥æ–‡æ®µçš„ç¡®è®¤åˆ°è¾¾ä¹‹å‰ä¸èƒ½å‘é€å…¶ä»–TCPæŠ¥æ–‡æ®µã€‚å¦ä¸€æ–¹é¢ï¼Œå‘é€æ–¹åœ¨ç­‰å¾…ç¡®è®¤çš„åŒæ—¶æ”¶é›†æœ¬ç«¯éœ€è¦å‘é€çš„å¾®é‡æ•°æ®ï¼Œå¹¶åœ¨ç¡®è®¤åˆ°æ¥æ—¶ä»¥ä¸€ä¸ªTCPæŠ¥æ–‡æ®µå°†å®ƒä»¬å…¨éƒ¨å‘å‡ºã€‚è¿™æ ·å°±æå¤§åœ°å‡å°‘äº†ç½‘ç»œä¸Šçš„å¾®å°TCPæŠ¥æ–‡æ®µçš„æ•°é‡ã€‚è¯¥ç®—æ³•çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºå…¶è‡ªé€‚åº”æ€§ï¼šç¡®è®¤åˆ°è¾¾å¾—è¶Šå¿«ï¼Œæ•°æ®ä¹Ÿå°±å‘é€å¾—è¶Šå¿«ã€‚ TCPæˆå—æ•°æ®æµä¸‹é¢è€ƒè™‘ç”¨FTPåè®®ä¼ è¾“ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚åœ¨ernest-laptopä¸Šå¯åŠ¨ä¸€ä¸ªvsftpdæœåŠ¡å™¨ç¨‹åºï¼ˆå‡çº§çš„ã€å®‰å…¨ç‰ˆçš„ftpæœåŠ¡å™¨ç¨‹åºï¼‰ï¼Œå¹¶æ‰§è¡Œftpå‘½ä»¤ç™»å½•è¯¥æœåŠ¡å™¨ä¸Šï¼Œç„¶ååœ¨ftpå‘½ä»¤æç¤ºç¬¦åè¾“å…¥getå‘½ä»¤ï¼Œä»æœåŠ¡å™¨ä¸‹è½½ä¸€ä¸ªå‡ ç™¾å…†çš„å¤§æ–‡ä»¶ã€‚åŒæ—¶ç”¨tcpdumpæŠ“å–è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸­ftpå®¢æˆ·ç«¯å’ŒvsftpdæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µã€‚å…·ä½“æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930$sudo tcpdump-nt-i eth0 port 20#vsftpdæœåŠ¡å™¨ç¨‹åºä½¿ç”¨ç«¯å£å·20$ftp 127.0.0.1Connected to 127.0.0.1.220(vsFTPd 2.3.0)Name(127.0.0.1:ernest):ernestï¼ˆå›è½¦ï¼‰#è¾“å…¥ç”¨æˆ·åå¹¶å›è½¦331 Please specify the password.Password:ï¼ˆå›è½¦ï¼‰ #è¾“å…¥å¯†ç å¹¶å›è½¦230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftpï¼get bigfileï¼ˆå›è½¦ï¼‰ #è·å–å¤§æ–‡ä»¶bigfile1.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205783041:205799425,ack 1,win 513,length 163842.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205799425:205815809,ack 1,win 513,length 163843.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205815809:205832193,ack 1,win 513,length 163844.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[P.],seq 205832193:205848577,ack 1,win 513,length 163845.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205848577:205864961,ack 1,win 513,length 163846.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205864961:205881345,ack 1,win 513,length 163847.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205881345:205897729,ack 1,win 513,length 163848.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[P.],seq 205897729:205914113,ack 1,win 513,length 163849.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205914113:205930497,ack 1,win 513,length 1638410.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205930497:205946881,ack 1,win 513,length 1638411.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205946881:205963265,ack 1,win 513,length 1638412.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[P.],seq 205963265:205979649,ack 1,win 513,length 1638413.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205979649:205996033,ack 1,win 513,length 1638414.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 205996033:206012417,ack 1,win 513,length 1638415.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[.],seq 206012417:206028801,ack 1,win 513,length 1638416.IP 127.0.0.1.20ï¼127.0.0.1.39651:Flags[P.],seq 206028801:206045185,ack 1,win 513,length 1638417.IP 127.0.0.1.39651ï¼127.0.0.1.20:Flags[.],ack 205815809,win 30084,length 018.IP 127.0.0.1.39651ï¼127.0.0.1.20:Flags[.],ack 206045185,win 27317,length 0 æ³¨æ„ï¼Œå®¢æˆ·ç«¯å‘é€çš„æœ€åä¸¤ä¸ªTCPæŠ¥æ–‡æ®µ17å’Œ18ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å¯¹TCPæŠ¥æ–‡æ®µ2å’Œ16çš„ç¡®è®¤ï¼ˆä»åºå·å€¼å’Œç¡®è®¤å€¼æ¥åˆ¤æ–­ï¼‰ã€‚ç”±æ­¤å¯è§ï¼Œå½“ä¼ è¾“å¤§é‡å¤§å—æ•°æ®çš„æ—¶å€™ï¼Œå‘é€æ–¹ä¼šè¿ç»­å‘é€å¤šä¸ªTCPæŠ¥æ–‡æ®µï¼Œæ¥æ”¶æ–¹å¯ä»¥ä¸€æ¬¡ç¡®è®¤æ‰€æœ‰è¿™äº›æŠ¥æ–‡æ®µã€‚é‚£ä¹ˆå‘é€æ–¹åœ¨æ”¶åˆ°ä¸Šä¸€æ¬¡ç¡®è®¤åï¼Œèƒ½è¿ç»­å‘é€å¤šå°‘ä¸ªTCPæŠ¥æ–‡æ®µå‘¢ï¼Ÿè¿™æ˜¯ç”±æ¥æ”¶é€šå‘Šçª—å£ï¼ˆè¿˜éœ€è¦è€ƒè™‘æ‹¥å¡çª—å£ï¼Œè§åæ–‡ï¼‰çš„å¤§å°å†³å®šçš„ã€‚TCPæŠ¥æ–‡æ®µ17è¯´æ˜å®¢æˆ·ç«¯è¿˜èƒ½æ¥æ”¶30 084Ã—64å­—èŠ‚ï¼ˆæœ¬ä¾‹ä¸­çª—å£æ‰©å¤§å› å­ä¸º6ï¼‰ï¼Œå³1 925 376å­—èŠ‚çš„æ•°æ®ã€‚è€Œåœ¨TCPæŠ¥æ–‡æ®µ18ä¸­ï¼Œæ¥æ”¶é€šå‘Šçª—å£å¤§å°ä¸º1 748 288å­—èŠ‚ï¼Œå³å®¢æˆ·ç«¯èƒ½æ¥æ”¶çš„æ•°æ®é‡å˜å°äº†ã€‚è¿™è¡¨æ˜å®¢æˆ·ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºæœ‰æ›´å¤šçš„æ•°æ®æœªè¢«åº”ç”¨ç¨‹åºè¯»å–è€Œåœç•™åœ¨å…¶ä¸­ï¼Œè¿™äº›æ•°æ®éƒ½æ¥è‡ªTCPæŠ¥æ–‡æ®µ3ï½16ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æœåŠ¡å™¨æ”¶åˆ°TCPæŠ¥æ–‡æ®µ18åï¼Œå®ƒè‡³å°‘ï¼ˆå› ä¸ºæ¥æ”¶é€šå‘Šçª—å£å¯èƒ½æ‰©å¤§ï¼‰è¿˜èƒ½è¿ç»­å‘é€çš„æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µæ•°é‡æ˜¯1 748288&#x2F;16 384ä¸ªï¼Œå³106ä¸ªï¼ˆä½†ä¸€èˆ¬ä¸ä¼šè¿ç»­å‘é€è¿™ä¹ˆå¤šï¼‰ã€‚å…¶ä¸­ï¼Œ16384æ˜¯æˆå—æ•°æ®çš„é•¿åº¦ï¼ˆè§TCPæŠ¥æ–‡æ®µ1ï½16çš„lengthå€¼ï¼‰ï¼Œå¾ˆæ˜¾ç„¶å®ƒå°äºä½†æ¥è¿‘MSSè§„å®šçš„16 396å­—èŠ‚ã€‚ å¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼ŒæœåŠ¡å™¨æ¯å‘é€4ä¸ªTCPæŠ¥æ–‡æ®µå°±ä¼ é€ä¸€ä¸ªPSHæ ‡å¿—ï¼ˆtcpdumpè¾“å‡ºæ ‡å¿—Pï¼‰ç»™å®¢æˆ·ç«¯ï¼Œä»¥é€šçŸ¥å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºå°½å¿«è¯»å–æ•°æ®ã€‚ä¸è¿‡è¿™å¯¹æœåŠ¡å™¨æ¥è¯´æ˜¾ç„¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå®ƒçŸ¥é“å®¢æˆ·ç«¯çš„TCPæ¥æ”¶ç¼“å†²åŒºä¸­è¿˜æœ‰ç©ºé—²ç©ºé—´ï¼ˆæ¥æ”¶é€šå‘Šçª—å£å¤§å°ä¸ä¸º0ï¼‰ã€‚ ä¸‹é¢æˆ‘ä»¬ä¿®æ”¹ç³»ç»Ÿçš„TCPæ¥æ”¶ç¼“å†²åŒºå’ŒTCPå‘é€ç¼“å†²åŒºçš„å¤§å°ï¼Œä½¿ä¹‹éƒ½ä¸º4096å­—èŠ‚ï¼Œç„¶åé‡å¯vsftpdæœåŠ¡å™¨ï¼Œå¹¶å†æ¬¡æ‰§è¡Œä¸Šè¿°æ“ä½œã€‚ 123451.IP 127.0.0.1.20ï¼127.0.0.1.45227:Flags[.],seq 5195777:5197313,ack 1,win 3072,length 15362.IP 127.0.0.1.20ï¼127.0.0.1.45227:Flags[.],seq 5197313:5198849,ack 1,win 3072,length 15363.IP 127.0.0.1.45227ï¼127.0.0.1.20:Flags[.],ack 5198849,win 3072,length 04.IP 127.0.0.1.20ï¼127.0.0.1.45227:Flags[P.],seq 5198849:5200385,ack 1,win 3072,length 15365.IP 127.0.0.1.45227ï¼127.0.0.1.20:Flags[.],ack 5200385,win 3072,length 0 ä»åŒæ­¥æŠ¥æ–‡æ®µï¼ˆæœªåœ¨ä»£ç ä¸­åˆ—å‡ºï¼‰å¾—çŸ¥åœ¨è¿™æ¬¡é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„çª—å£æ‰©å¤§å› å­éƒ½ä¸º0ï¼Œå› è€Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯æ¬¡é€šå‘Šçš„çª—å£å¤§å°éƒ½æ˜¯3072å­—èŠ‚ï¼ˆæ²¡è¶…è¿‡4096å­—èŠ‚ï¼Œé¢„æ–™ä¹‹ä¸­ï¼‰ã€‚å› ä¸ºæ¯ä¸ªæˆå—æ•°æ®çš„é•¿åº¦ä¸º1536å­—èŠ‚ï¼Œæ‰€ä»¥æœåŠ¡å™¨åœ¨æ”¶åˆ°ä¸Šä¸€ä¸ªTCPæŠ¥æ–‡æ®µçš„ç¡®è®¤ä¹‹å‰æœ€å¤šè¿˜èƒ½å†å‘é€1ä¸ªTCPæŠ¥æ–‡æ®µï¼Œè¿™æ­£æ˜¯TCPæŠ¥æ–‡æ®µ1ï½3æè¿°çš„æƒ…å½¢ã€‚ å¸¦å¤–æ•°æ®å®é™…åº”ç”¨ä¸­ï¼Œå¸¦å¤–æ•°æ®çš„ä½¿ç”¨å¾ˆå°‘è§ï¼Œå·²çŸ¥çš„ä»…æœ‰telnetã€ftpç­‰è¿œç¨‹éæ´»è·ƒç¨‹åºã€‚ TCPè¶…æ—¶é‡ä¼ å¼‚å¸¸ç½‘ç»œçŠ¶å†µä¸‹ï¼ˆå¼€å§‹å‡ºç°è¶…æ—¶æˆ–ä¸¢åŒ…ï¼‰ï¼ŒTCPå¦‚ä½•æ§åˆ¶æ•°æ®ä¼ è¾“ä»¥ä¿è¯å…¶æ‰¿è¯ºçš„å¯é æœåŠ¡ã€‚ TCPæœåŠ¡å¿…é¡»èƒ½å¤Ÿé‡ä¼ è¶…æ—¶æ—¶é—´å†…æœªæ”¶åˆ°ç¡®è®¤çš„TCPæŠ¥æ–‡æ®µã€‚ä¸ºæ­¤ï¼ŒTCPæ¨¡å—ä¸ºæ¯ä¸ªTCPæŠ¥æ–‡æ®µéƒ½ç»´æŠ¤ä¸€ä¸ªé‡ä¼ å®šæ—¶å™¨ï¼Œè¯¥å®šæ—¶å™¨åœ¨TCPæŠ¥æ–‡æ®µç¬¬ä¸€æ¬¡è¢«å‘é€æ—¶å¯åŠ¨ã€‚å¦‚æœè¶…æ—¶æ—¶é—´å†…æœªæ”¶åˆ°æ¥æ”¶æ–¹çš„åº”ç­”ï¼ŒTCPæ¨¡å—å°†é‡ä¼ TCPæŠ¥æ–‡æ®µå¹¶é‡ç½®å®šæ—¶å™¨ã€‚è‡³äºä¸‹æ¬¡é‡ä¼ çš„è¶…æ—¶æ—¶é—´å¦‚ä½•é€‰æ‹©ï¼Œä»¥åŠæœ€å¤šæ‰§è¡Œå¤šå°‘æ¬¡é‡ä¼ ï¼Œå°±æ˜¯TCPçš„é‡ä¼ ç­–ç•¥ã€‚ æˆ‘ä»¬é€šè¿‡å®ä¾‹æ¥ç ”ç©¶Linuxä¸‹TCPçš„è¶…æ—¶é‡ä¼ ç­–ç•¥ã€‚åœ¨ernest-laptopä¸Šå¯åŠ¨iperfæœåŠ¡å™¨ç¨‹åºï¼Œç„¶åä»Kongming20ä¸Šæ‰§è¡Œtelnetå‘½ä»¤ç™»å½•è¯¥æœåŠ¡å™¨ç¨‹åºã€‚æ¥ä¸‹æ¥ï¼Œä»telnetå®¢æˆ·ç«¯å‘é€ä¸€äº›æ•°æ®ï¼ˆæ­¤å¤„æ˜¯â€œ1234â€ï¼‰ç»™æœåŠ¡å™¨ï¼Œç„¶åæ–­å¼€æœåŠ¡å™¨çš„ç½‘çº¿å¹¶å†æ¬¡ä»å®¢æˆ·ç«¯å‘é€ä¸€äº›æ•°æ®ç»™æœåŠ¡å™¨ï¼ˆæ­¤å¤„æ˜¯â€œ12â€ï¼‰ã€‚åŒæ—¶ï¼Œç”¨tcpdumpæŠ“å–è¿™ä¸€è¿‡ç¨‹ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢çš„TCPæŠ¥æ–‡æ®µã€‚å…·ä½“æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789$sudo tcpdump-n-i eth0 port 5001$iperf-s #åœ¨ernest-laptopä¸Šæ‰§è¡Œ$telnet 192.168.1.108 5001 #åœ¨Kongming20ä¸Šæ‰§è¡ŒTrying 192.168.1.108...Connected to 192.168.1.108.Escape character is&#x27;^]&#x27;.1234#å‘é€å®Œä¹‹åæ–­å¼€æœåŠ¡å™¨ç½‘çº¿12Connection closed by foreign host iperfæ˜¯ä¸€ä¸ªæµ‹é‡ç½‘ç»œçŠ¶å†µçš„å·¥å…·ï¼Œ-sé€‰é¡¹è¡¨ç¤ºå°†å…¶ä½œä¸ºæœåŠ¡å™¨è¿è¡Œã€‚iperfé»˜è®¤ç›‘å¬5001ç«¯å£ï¼Œå¹¶ä¸¢å¼ƒè¯¥ç«¯å£ä¸Šæ¥æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ªdiscardæœåŠ¡å™¨ã€‚ ä»£ç å°±ä¸å±•ç¤ºäº† TCPæŠ¥æ–‡æ®µ1ï½3æ˜¯ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼ŒTCPæŠ¥æ–‡æ®µ4ï½5æ˜¯å®¢æˆ·ç«¯å‘é€æ•°æ®â€œ1234â€ï¼ˆåº”ç”¨ç¨‹åºæ•°æ®é•¿åº¦ä¸º6ï¼ŒåŒ…æ‹¬å›è½¦ã€æ¢è¡Œä¸¤ä¸ªå­—ç¬¦ï¼ŒååŒï¼‰åŠæœåŠ¡å™¨ç¡®è®¤çš„è¿‡ç¨‹ã€‚TCPæŠ¥æ–‡æ®µ6æ˜¯å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘é€æ•°æ®â€œ12â€çš„è¿‡ç¨‹ã€‚å› ä¸ºæœåŠ¡å™¨çš„ç½‘çº¿è¢«æ–­å¼€ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ— æ³•æ”¶åˆ°TCPæŠ¥æ–‡æ®µ6çš„ç¡®è®¤æŠ¥æ–‡æ®µã€‚æ­¤åï¼Œå®¢æˆ·ç«¯å¯¹TCPæŠ¥æ–‡æ®µ6æ‰§è¡Œäº†5æ¬¡é‡ä¼ ï¼Œå®ƒä»¬æ˜¯TCPæŠ¥æ–‡æ®µ7ï½11ï¼Œè¿™å¯ä»¥ä»æ¯ä¸ªTCPæŠ¥æ–‡æ®µçš„åºå·å¾—çŸ¥ã€‚æ­¤åï¼Œæ•°æ®åŒ…12ï½23éƒ½æ˜¯ARPæ¨¡å—çš„è¾“å‡ºå†…å®¹ï¼Œå³Kongming20æŸ¥è¯¢ernest-laptopçš„MACåœ°å€ã€‚ æˆ‘ä»¬ä¿ç•™äº†tcpdumpè¾“å‡ºçš„æ—¶é—´æˆ³ï¼Œä»¥ä¾¿æ¨ç†TCPçš„è¶…æ—¶é‡ä¼ ç­–ç•¥ã€‚è§‚å¯ŸTCPæŠ¥æ–‡æ®µ6ï½11è¢«å‘é€çš„æ—¶é—´é—´éš”ï¼Œå®ƒä»¬åˆ†åˆ«ä¸º0.2 sã€0.4sã€0.8 sã€1.6 så’Œ3.2 sã€‚ç”±æ­¤å¯è§ï¼ŒTCPä¸€å…±æ‰§è¡Œ5æ¬¡é‡ä¼ ï¼Œæ¯æ¬¡é‡ä¼ è¶…æ—¶æ—¶é—´éƒ½å¢åŠ ä¸€å€ï¼ˆå› æ­¤ï¼Œå’ŒTCPè¶…æ—¶é‡è¿çš„ç­–ç•¥ç›¸ä¼¼ï¼‰ã€‚åœ¨5æ¬¡é‡ä¼ å‡å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œåº•å±‚çš„IPå’ŒARPå¼€å§‹æ¥ç®¡ï¼Œç›´åˆ°telnetå®¢æˆ·ç«¯æ”¾å¼ƒè¿æ¥ä¸ºæ­¢ã€‚ Linuxæœ‰ä¸¤ä¸ªé‡è¦çš„å†…æ ¸å‚æ•°ä¸TCPè¶…æ—¶é‡ä¼ ç›¸å…³ï¼š&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_retries1å’Œ&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_retries2ã€‚å‰è€…æŒ‡å®šåœ¨åº•å±‚IPæ¥ç®¡ä¹‹å‰TCPæœ€å°‘æ‰§è¡Œçš„é‡ä¼ æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯3ã€‚åè€…æŒ‡å®šè¿æ¥æ”¾å¼ƒå‰TCPæœ€å¤šå¯ä»¥æ‰§è¡Œçš„é‡ä¼ æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯15ï¼ˆä¸€èˆ¬å¯¹åº”13ï½30 minï¼‰ã€‚åœ¨æˆ‘ä»¬çš„å®ä¾‹ä¸­ï¼ŒTCPè¶…æ—¶é‡ä¼ å‘ç”Ÿäº†5æ¬¡ï¼Œè¿æ¥åšæŒçš„æ—¶é—´æ˜¯15 minï¼ˆå¯ä»¥ç”¨dateå‘½ä»¤æ¥æµ‹é‡ï¼‰ã€‚è™½ç„¶è¶…æ—¶ä¼šå¯¼è‡´TCPæŠ¥æ–‡æ®µé‡ä¼ ï¼Œä½†TCPæŠ¥æ–‡æ®µçš„é‡ä¼ å¯ä»¥å‘ç”Ÿåœ¨è¶…æ—¶ä¹‹å‰ï¼Œå³å¿«é€Ÿé‡ä¼  æ‹¥å¡æ§åˆ¶TCPæ¨¡å—è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ï¼Œå°±æ˜¯æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œé™ä½ä¸¢åŒ…ç‡ï¼Œå¹¶ä¿è¯ç½‘ç»œèµ„æºå¯¹æ¯æ¡æ•°æ®æµçš„å…¬å¹³æ€§ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æ‹¥å¡æ§åˆ¶ã€‚ TCPæ‹¥å¡æ§åˆ¶çš„æ ‡å‡†æ–‡æ¡£æ˜¯RFC 5681ï¼Œå…¶ä¸­è¯¦ç»†ä»‹ç»äº†æ‹¥å¡æ§åˆ¶çš„å››ä¸ªéƒ¨åˆ†ï¼šæ…¢å¯åŠ¨ï¼ˆslow startï¼‰ã€æ‹¥å¡é¿å…ï¼ˆcongestion avoidanceï¼‰ã€å¿«é€Ÿé‡ä¼ ï¼ˆfast retransmitï¼‰å’Œå¿«é€Ÿæ¢å¤ï¼ˆfast recoveryï¼‰ã€‚æ‹¥å¡æ§åˆ¶ç®—æ³•åœ¨Linuxä¸‹æœ‰å¤šç§å®ç°ï¼Œæ¯”å¦‚renoç®—æ³•ã€vegasç®—æ³•å’Œcubicç®—æ³•ç­‰ã€‚å®ƒä»¬æˆ–è€…éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å®ç°äº†ä¸Šè¿°å››ä¸ªéƒ¨åˆ†ã€‚&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_congestion_controlæ–‡ä»¶æŒ‡ç¤ºæœºå™¨å½“å‰æ‰€ä½¿ç”¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚ â€¦ #TCP&#x2F;IPé€šä¿¡æ¡ˆä¾‹ï¼šè®¿é—®Internetä¸Šçš„WebæœåŠ¡å™¨ Webå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨HTTPåè®®é€šä¿¡ å®ä¾‹æ€»å›¾åœ¨Kongming20ä¸Šè¿è¡Œwgetå®¢æˆ·ç«¯ç¨‹åºï¼Œåœ¨ernest-laptopä¸Šè¿è¡Œsquidä»£ç†æœåŠ¡å™¨ç¨‹åºã€‚å®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨çš„ä¸­è½¬ï¼Œè·å–Internetä¸Šçš„ä¸»æœºwww.baidu.comçš„é¦–é¡µæ–‡æ¡£index.html wgetå®¢æˆ·ç«¯ç¨‹åºå’Œä»£ç†æœåŠ¡å™¨ä¹‹é—´ï¼Œä»¥åŠä»£ç†æœåŠ¡å™¨ä¸WebæœåŠ¡å™¨ä¹‹é—´éƒ½æ˜¯ä½¿ç”¨HTTPåè®®é€šä¿¡çš„ã€‚HTTPåè®®æ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œå®ƒé»˜è®¤ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®æ˜¯TCPåè®®ã€‚ å°†ernest-laptopè®¾ç½®ä¸ºKongming20çš„HTTPä»£ç†æœåŠ¡å™¨ï¼Œåœ¨Kongming20ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡http_proxyï¼š $export http_proxy&#x3D;â€ernest-laptop:3128â€ 3128æ˜¯squidæœåŠ¡å™¨é»˜è®¤ä½¿ç”¨çš„ç«¯å£å·ï¼ˆå¯ä»¥é€šè¿‡lsofå‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨ç¨‹åºç›‘å¬çš„ç«¯å£å·ï¼‰ã€‚è®¾ç½®å¥½ç¯å¢ƒå˜é‡ä¹‹åï¼ŒKongming20è®¿é—®ä»»ä½•Internetä¸Šçš„WebæœåŠ¡å™¨æ—¶ï¼Œå…¶HTTPè¯·æ±‚éƒ½å°†é¦–å…ˆå‘é€è‡³ernest-laptopçš„3128ç«¯å£ã€‚ squidä»£ç†æœåŠ¡å™¨æ¥æ”¶åˆ°wgetå®¢æˆ·ç«¯çš„HTTPè¯·æ±‚ä¹‹åï¼Œå°†ç®€å•åœ°ä¿®æ”¹è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åæŠŠå®ƒå‘é€ç»™æœ€ç»ˆçš„ç›®æ ‡WebæœåŠ¡å™¨ã€‚ä»£ç†æœåŠ¡å™¨è®¿é—®çš„æ˜¯Internetä¸Šçš„æœºå™¨ï¼Œå¯ä»¥é¢„è§å®ƒå‘é€çš„IPæ•°æ®æŠ¥éƒ½å°†ç»è¿‡è·¯ç”±å™¨çš„ä¸­è½¬ éƒ¨ç½²ä»£ç†æœåŠ¡å™¨ç”±äºé€šä¿¡å®ä¾‹ä¸­ä½¿ç”¨äº†HTTPä»£ç†æœåŠ¡å™¨ï¼ˆsquidç¨‹åºï¼‰ï¼Œæ‰€ä»¥å…ˆç®€å•ä»‹ç»ä¸€ä¸‹HTTPä»£ç†æœåŠ¡å™¨çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•éƒ¨ç½²squidä»£ç†æœåŠ¡å™¨ HTTPä»£ç†æœåŠ¡å™¨çš„å·¥ä½œåŸç†åœ¨HTTPé€šä¿¡é“¾ä¸Šï¼Œä¸€ä¸ªHTTPè¯·æ±‚å¯èƒ½è¢«å¤šä¸ªä»£ç†æœåŠ¡å™¨è½¬å‘ï¼Œåé¢çš„æœåŠ¡å™¨ç§°ä¸ºå‰é¢æœåŠ¡å™¨çš„ä¸Šæ¸¸æœåŠ¡å™¨ã€‚ä»£ç†æœåŠ¡å™¨æŒ‰ç…§å…¶ä½¿ç”¨æ–¹å¼å’Œä½œç”¨ï¼Œ æ­£å‘ä»£ç†è¦æ±‚å®¢æˆ·ç«¯è‡ªå·±è®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚å®¢æˆ·çš„æ¯æ¬¡è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€åˆ°è¯¥ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ç”±ä»£ç†æœåŠ¡å™¨æ¥è¯·æ±‚ç›®æ ‡èµ„æºã€‚æ¯”å¦‚å¤„äºé˜²ç«å¢™å†…çš„å±€åŸŸç½‘æœºå™¨è¦è®¿é—®Internetï¼Œæˆ–è€…è¦è®¿é—®ä¸€äº›è¢«å±è”½æ‰çš„å›½å¤–ç½‘ç«™ï¼Œå°±éœ€è¦ä½¿ç”¨æ­£å‘ä»£ç†æœåŠ¡å™¨ åå‘ä»£ç†åˆ™è¢«è®¾ç½®åœ¨æœåŠ¡å™¨ç«¯ï¼Œå› è€Œå®¢æˆ·ç«¯æ— é¡»è¿›è¡Œä»»ä½•è®¾ç½®ã€‚åå‘ä»£ç†æ˜¯æŒ‡ç”¨ä»£ç†æœåŠ¡å™¨æ¥æ¥æ”¶Internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»å†…éƒ¨æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªçœŸå®çš„æœåŠ¡å™¨ã€‚å„å¤§ç½‘ç«™é€šå¸¸åˆ†åŒºåŸŸè®¾ç½®äº†å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„åœ°æ–¹pingåŒä¸€ä¸ªåŸŸåå¯èƒ½å¾—åˆ°ä¸åŒçš„IPåœ°å€ï¼Œå› ä¸ºè¿™äº›IPåœ°å€å®é™…ä¸Šæ˜¯ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ã€‚ é€æ˜ä»£ç†åªèƒ½è®¾ç½®åœ¨ç½‘å…³ä¸Šã€‚ç”¨æˆ·è®¿é—®Internetçš„æ•°æ®æŠ¥å¿…ç„¶éƒ½ç»è¿‡ç½‘å…³ï¼Œå¦‚æœåœ¨ç½‘å…³ä¸Šè®¾ç½®ä»£ç†ï¼Œåˆ™è¯¥ä»£ç†å¯¹ç”¨æˆ·æ¥è¯´æ˜¾ç„¶æ˜¯é€æ˜çš„ã€‚é€æ˜ä»£ç†å¯ä»¥çœ‹ä½œæ­£å‘ä»£ç†çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ ä»£ç†æœåŠ¡å™¨é€šå¸¸è¿˜æä¾›ç¼“å­˜ç›®æ ‡èµ„æºçš„åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ï¼Œè¿™æ ·ç”¨æˆ·ä¸‹æ¬¡è®¿é—®åŒä¸€èµ„æºæ—¶é€Ÿåº¦å°†å¾ˆå¿«ã€‚ä¼˜ç§€çš„å¼€æºè½¯ä»¶squidã€varnishéƒ½æ˜¯æä¾›äº†ç¼“å­˜èƒ½åŠ›çš„ä»£ç†æœåŠ¡å™¨è½¯ä»¶ï¼Œå…¶ä¸­squidæ”¯æŒæ‰€æœ‰ä»£ç†æ–¹å¼ï¼Œè€Œvarnishä»…èƒ½ç”¨ä½œåå‘ä»£ç† éƒ¨ç½²squidä»£ç†æœåŠ¡å™¨ç°åœ¨æˆ‘ä»¬åœ¨ernest-laptopä¸Šéƒ¨ç½²squidä»£ç†æœåŠ¡å™¨ã€‚ ä¿®æ”¹squidæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;squid3&#x2F;squid.conf 12acl localnet src 192.168.1.0/24http_access allow localnet è¿™ä¸¤è¡Œä»£ç çš„å«ä¹‰æ˜¯ï¼šå…è®¸ç½‘ç»œ192.168.1.0ä¸Šçš„æ‰€æœ‰æœºå™¨é€šè¿‡è¯¥ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®WebæœåŠ¡å™¨ã€‚ æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä¸¤è¡Œä»£ç ç®€å•åœ°é…ç½®äº†squidçš„è®¿é—®æ§åˆ¶ã€‚ä½†å®é™…åº”ç”¨ä¸­ï¼Œsquidæä¾›æ›´å¤šã€æ›´å®‰å…¨çš„é…ç½®ï¼Œæ¯”å¦‚ç”¨æˆ·éªŒè¯ç­‰ã€‚ é‡å¯squidæœåŠ¡å™¨ï¼š $sudo service squid3 restart serviceæ˜¯ä¸€ä¸ªè„šæœ¬ç¨‹åºï¼ˆ&#x2F;usr&#x2F;sbin&#x2F;serviceï¼‰ï¼Œå®ƒä¸º&#x2F;etc&#x2F;init.d&#x2F;ç›®å½•ä¸‹çš„ä¼—å¤šæœåŠ¡å™¨ç¨‹åºï¼ˆæ¯”å¦‚httpdã€vsftpdã€sshdå’Œmysqldç­‰ï¼‰çš„å¯åŠ¨ï¼ˆstartï¼‰ã€åœæ­¢ï¼ˆstopï¼‰å’Œé‡å¯ï¼ˆrestartï¼‰ç­‰åŠ¨ä½œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ç®¡ç†ã€‚ç°åœ¨ï¼ŒLinuxç¨‹åºå‘˜å·²ç»è¶Šæ¥è¶Šåå‘äºä½¿ç”¨serviceè„šæœ¬æ¥ç®¡ç†æœåŠ¡å™¨ç¨‹åºäº† ä½¿ç”¨tcpdumpæŠ“å–ä¼ è¾“æ•°æ®åŒ…åœ¨æ‰§è¡Œwgetå‘½ä»¤å‰ï¼Œæˆ‘ä»¬é¦–å…ˆåº”åˆ é™¤ernest-laptopçš„ARPé«˜é€Ÿç¼“å­˜ä¸­è·¯ç”±å™¨å¯¹åº”çš„é¡¹ï¼Œä»¥ä¾¿è§‚å¯ŸTCP&#x2F;IPé€šä¿¡è¿‡ç¨‹ä¸­ARPåè®®ä½•æ—¶èµ·ä½œç”¨ã€‚ç„¶åï¼Œä½¿ç”¨tcpdumpå‘½ä»¤æŠ“å–æ•´ä¸ªé€šä¿¡è¿‡ç¨‹ä¸­ä¼ è¾“çš„æ•°æ®åŒ…ã€‚ 1234567891011$sudo arp-d 192.168.1.1$sudo tcpdump-s 2000-i eth0-ntX&#x27;(src 192.168.1.108)or(dst 192.168.1.108)or(arp)&#x27;$wget--header=&quot;Connection:close&quot;http://www.baidu.com/index.html--2012-07-03 00:51:12--http://www.baidu.com/index.htmlResolving ernest-laptop...192.168.1.108Connecting to ernest-laptop|192.168.1.108|:3128...connected.Proxy request sent,awaiting response...200 OKLength:8024(7.8K)[text/html]Saving to:â€œindex.htmlâ€100%[=======================ï¼]8,024--.-K/s in 0.001s2012-07-03 00:51:12(8.76 MB/s)-â€œindex.htmlâ€saved[8024/8024] wgetå‘½ä»¤çš„è¾“å‡ºæ˜¾ç¤ºï¼ŒHTTPè¯·æ±‚ç¡®å®æ˜¯å…ˆè¢«é€è‡³ä»£ç†æœåŠ¡å™¨çš„3128ç«¯å£ï¼Œå¹¶ä¸”ä»£ç†æœåŠ¡å™¨æ­£ç¡®åœ°è¿”å›äº†æ–‡ä»¶index.htmlçš„å†…å®¹ã€‚ 43ä¸ªæ•°æ®åŒ…è¿™é‡Œæ²¡æœ‰æ˜¾ç¤º ä»£ç†æœåŠ¡å™¨è®¿é—®DNSæœåŠ¡å™¨ä»¥æŸ¥è¯¢åŸŸåwww.baidu.comå¯¹åº”çš„IPåœ°å€ï¼ŒåŒ…æ‹¬æ•°æ®åŒ…8ã€9ã€‚ ä»£ç†æœåŠ¡å™¨æŸ¥è¯¢è·¯ç”±å™¨MACåœ°å€çš„ARPè¯·æ±‚å’Œåº”ç­”ï¼ŒåŒ…æ‹¬æ•°æ®åŒ…6ã€7ã€‚ wgetå®¢æˆ·ç«¯ï¼ˆ192.168.1.109ï¼‰å’Œä»£ç†æœåŠ¡å™¨ï¼ˆ192.168.1.108ï¼‰ä¹‹é—´çš„HTTPé€šä¿¡ï¼ŒåŒ…æ‹¬æ•°æ®åŒ…1ï½5ã€23ï½25ã€32ï½40ã€42å’Œ43ã€‚ ä»£ç†æœåŠ¡å™¨å’ŒWebæœåŠ¡å™¨ï¼ˆ119.75.218.77ï¼‰ä¹‹é—´çš„HTTPé€šä¿¡ï¼ŒåŒ…æ‹¬æ•°æ®åŒ…10ï½22ã€26ï½31å’Œ41ã€‚ è®¿é—®DNSæœåŠ¡å™¨æ•°æ®åŒ…8ã€9è¡¨ç¤ºä»£ç†æœåŠ¡å™¨ernest-laptopå‘DNSæœåŠ¡å™¨ï¼ˆ219.239.26.42ï¼Œé¦–é€‰DNSæœåŠ¡å™¨çš„IPåœ°å€ï¼‰æŸ¥è¯¢åŸŸåwww.baidu.comå¯¹åº”çš„IPåœ°å€ï¼Œå¹¶å¾—åˆ°äº†å›å¤ã€‚è¯¥å›å¤åŒ…æ‹¬ä¸€ä¸ªä¸»æœºåˆ«åï¼ˆwww.a.shifen.comï¼‰å’Œä¸¤ä¸ªIPåœ°å€ï¼ˆ119.75.218.77å’Œ119.75.217.56ï¼‰ã€‚ squidç¨‹åºé€šè¿‡è¯»å–&#x2F;etc&#x2F;resolv.confæ–‡ä»¶è·å¾—DNSæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç„¶åå°†æ§åˆ¶æƒä¼ é€’ç»™å†…æ ¸ä¸­çš„UDPæ¨¡å—ã€‚ UDPæ¨¡å—å°†DNSæŸ¥è¯¢æŠ¥æ–‡å°è£…æˆUDPæ•°æ®æŠ¥ï¼ŒåŒæ—¶æŠŠæºç«¯å£å·å’Œç›®æ ‡ç«¯å£å·åŠ å…¥UDPæ•°æ®æŠ¥å¤´éƒ¨ï¼Œç„¶åUDPæ¨¡å—è°ƒç”¨IPæœåŠ¡ã€‚ IPæ¨¡å—åˆ™å°†UDPæ•°æ®æŠ¥å°è£…æˆIPæ•°æ®æŠ¥ï¼Œå¹¶æŠŠæºç«¯IPåœ°å€ï¼ˆ192.168.1.108ï¼‰å’ŒDNSæœåŠ¡å™¨çš„IPåœ°å€åŠ å…¥IPæ•°æ®æŠ¥å¤´éƒ¨ã€‚æ¥ä¸‹æ¥ï¼ŒIPæ¨¡å—æŸ¥è¯¢è·¯ç”±è¡¨ä»¥å†³å®šå¦‚ä½•å‘é€è¯¥IPæ•°æ®æŠ¥ã€‚æ ¹æ®è·¯ç”±ç­–ç•¥ï¼Œç›®æ ‡IPåœ°å€ï¼ˆ219.239.26.42ï¼‰ä»…èƒ½åŒ¹é…è·¯ç”±è¡¨ä¸­çš„é»˜è®¤è·¯ç”±é¡¹ï¼Œå› æ­¤è¯¥IPæ•°æ®æŠ¥å…ˆè¢«å‘é€è‡³è·¯ç”±å™¨ï¼ˆIPåœ°å€ä¸º192.168.1.1ï¼‰ï¼Œç„¶åé€šè¿‡è·¯ç”±å™¨æ¥è½¬å‘ã€‚å› ä¸ºernest-laptopçš„ARPç¼“å­˜ä¸­æ²¡æœ‰ä¸è·¯ç”±å™¨å¯¹åº”çš„ç¼“å­˜é¡¹ï¼ˆæˆ‘ä»¬æ‰‹åŠ¨å°†å…¶åˆ é™¤äº†ï¼‰ï¼Œæ‰€ä»¥ernest laptopéœ€è¦å‘èµ·ä¸€ä¸ªARPå¹¿æ’­ä»¥æŸ¥è¯¢è·¯ç”±å™¨çš„IPåœ°å€ï¼Œè€Œè¿™æ­£æ˜¯æ•°æ®åŒ…6æè¿°çš„å†…å®¹ã€‚è·¯ç”±å™¨åˆ™é€šè¿‡ARPåº”ç­”å‘Šè¯‰ernest-laptopè‡ªå·±çš„MACåœ°å€æ˜¯14:e6:e4:93:5b:78ï¼Œå¦‚æ•°æ®åŒ…7æ‰€ç¤ºã€‚æœ€ç»ˆï¼Œä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå°†IPæ•°æ®æŠ¥å°è£…æˆä»¥å¤ªç½‘å¸§å‘é€ç»™è·¯ç”±å™¨ã€‚æ­¤åï¼Œä»£ç†æœåŠ¡å™¨å†æ¬¡å‘é€æ•°æ®åˆ°Internetæ—¶å°†ä¸å†éœ€è¦ARPæŸ¥è¯¢ï¼Œå› ä¸ºernest-laptopçš„ARPé«˜é€Ÿç¼“å­˜ä¸­å·²ç»è®°å½•äº†è·¯ç”±å™¨çš„IPåœ°å€å’ŒMACåœ°å€çš„æ˜ å°„å…³ç³» éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè™½ç„¶IPæ•°æ®æŠ¥æ˜¯å…ˆå‘é€åˆ°è·¯ç”±å™¨ï¼Œå†ç”±å®ƒè½¬å‘ç»™ç›®æ ‡ä¸»æœºï¼Œä½†æ˜¯å…¶å¤´éƒ¨çš„ç›®æ ‡IPåœ°å€å´æ˜¯æœ€ç»ˆçš„ç›®æ ‡ä¸»æœºï¼ˆDNSæœåŠ¡å™¨ï¼‰çš„IPåœ°å€ï¼Œè€Œä¸æ˜¯ä¸­è½¬è·¯ç”±å™¨çš„IPåœ°å€ï¼ˆ192.168.1.1ï¼‰ã€‚è¿™è¯´æ˜ï¼ŒIPå¤´éƒ¨çš„æºç«¯IPåœ°å€å’Œç›®çš„ç«¯IPåœ°å€åœ¨è½¬å‘è¿‡ç¨‹ä¸­æ˜¯å§‹ç»ˆä¸å˜çš„ï¼ˆä¸€ç§ä¾‹å¤–æ˜¯æºè·¯ç”±é€‰æ‹©ï¼‰ã€‚ä½†å¸§å¤´éƒ¨çš„æºç«¯ç‰©ç†åœ°å€å’Œç›®çš„ç«¯ç‰©ç†åœ°å€åœ¨è½¬å‘è¿‡ç¨‹ä¸­åˆ™æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ã€‚ æœ¬åœ°åç§°æŸ¥è¯¢ä¸€èˆ¬æ¥è¯´ï¼Œé€šè¿‡åŸŸåæ¥è®¿é—®æ—¶ï¼Œéœ€è¦ä½¿ç”¨DNSæœåŠ¡æ¥è·å–IPåœ°å€ã€‚ä½†å¦‚æœæˆ‘ä»¬é€šè¿‡ä¸»æœºåæ¥è®¿é—®æœ¬åœ°å±€åŸŸç½‘ä¸Šçš„æœºå™¨ï¼Œåˆ™å¯é€šè¿‡æœ¬åœ°çš„é™æ€æ–‡ä»¶æ¥è·å¾—è¯¥æœºå™¨çš„IPåœ°å€ã€‚Linuxå°†ç›®æ ‡ä¸»æœºååŠå…¶å¯¹åº”çš„IPåœ°å€å­˜å‚¨åœ¨&#x2F;etc&#x2F;hostsé…ç½®æ–‡ä»¶ä¸­ã€‚å½“éœ€è¦æŸ¥è¯¢æŸä¸ªä¸»æœºåå¯¹åº”çš„IPåœ°å€æ—¶ï¼Œç¨‹åºå°†é¦–å…ˆæ£€æŸ¥è¿™ä¸ªæ–‡ä»¶ã€‚Kongming20ä¸Š&#x2F;etc&#x2F;hostsæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼ˆç¬”è€…æ‰‹åŠ¨ä¿®æ”¹è¿‡ï¼‰ï¼š 123127.0.0.1 localhost192.168.1.109 Kongming20192.168.1.108 ernest-laptop å…¶ä¸­ç¬¬ä¸€é¡¹æŒ‡å‡ºæœ¬åœ°å›è·¯åœ°å€127.0.0.1çš„åç§°æ˜¯localhostï¼Œç¬¬äºŒé¡¹å’Œç¬¬ä¸‰é¡¹åˆ™åˆ†åˆ«æè¿°äº†Kongming20å’Œernest-laptopçš„IPåœ°å€åŠå¯¹åº”çš„ä¸» æœºåã€‚ä»£ç æ¸…å•4-1ä¸­ï¼Œwgetå‘½ä»¤è¾“å‡ºâ€œResolving ernest laptopâ€¦192.168.1.108â€ï¼Œå³å®ƒæˆåŠŸåœ°è§£æäº†ä¸»æœºåernest-laptopå¯¹åº”çš„IPåœ°å€ï¼ŒåŸå› å¦‚ä¸‹ï¼šå½“wgetè®¿é—®æŸä¸ªWebæœåŠ¡å™¨æ—¶ï¼Œå®ƒå…ˆè¯»å–ç¯å¢ƒå˜é‡http_proxyã€‚å¦‚æœè¯¥ç¯å¢ƒå˜é‡è¢«è®¾ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰é˜»æ­¢wgetä½¿ç”¨ä»£ç†æœåŠ¡ï¼Œåˆ™wgetå°†é€šè¿‡http_proxyæŒ‡å®šçš„ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®WebæœåŠ¡ã€‚ä½†http_proxyç¯å¢ƒå˜é‡ä¸­åŒ…å«ä¸»æœºåernest-laptopï¼Œå› æ­¤wgetå°†é¦–å…ˆè¯»å–&#x2F;etc&#x2F;hostsé…ç½®æ–‡ä»¶ï¼Œè¯•å›¾é€šè¿‡å®ƒæ¥è§£æä¸»æœºåernest-laptopå¯¹åº”çš„IPåœ°å€ã€‚å…¶ç»“æœæ­£å¦‚wgetçš„è¾“å‡ºæ‰€ç¤ºï¼Œè§£ææˆåŠŸ å¦‚æœç¨‹åºåœ¨&#x2F;etc&#x2F;hostsæ–‡ä»¶ä¸­æœªæ‰¾åˆ°ç›®æ ‡æœºå™¨åå¯¹åº”çš„IPåœ°å€ï¼Œå®ƒå°†æ±‚åŠ©äºDNSæœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹&#x2F;etc&#x2F;host.confæ–‡ä»¶æ¥è‡ªå®šä¹‰ç³»ç»Ÿè§£æä¸»æœºåçš„æ–¹æ³•å’Œé¡ºåºï¼ˆä¸€èˆ¬æ˜¯å…ˆè®¿é—®æœ¬åœ°æ–‡ä»¶&#x2F;etc&#x2F;hostsï¼Œå†è®¿é—®DNSæœåŠ¡ï¼‰ï¼Œ Kongming20ä¸Šçš„è¯¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š order hosts,bind multi on å…¶ä¸­ç¬¬ä¸€è¡Œè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨&#x2F;etc&#x2F;hostsæ–‡ä»¶æ¥è§£æä¸»æœºåï¼ˆhostsï¼‰ï¼Œå¤±è´¥åå†ä½¿ç”¨DNSæœåŠ¡ï¼ˆbindï¼‰ã€‚ç¬¬äºŒè¡Œè¡¨ç¤ºå¦‚æœ&#x2F;etc&#x2F;hostsæ–‡ä»¶ä¸­ä¸€ä¸ªä¸»æœºåå¯¹åº”å¤šä¸ªIPåœ°å€ï¼Œé‚£ä¹ˆè§£æçš„ç»“æœå°±åŒ…å«å¤šä¸ªIPåœ°å€ã€‚ HTTPé€šä¿¡ TCPè¿æ¥ä»å»ºç«‹åˆ°å…³é—­çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä»…ç»™æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªHTTPè¯·æ±‚ï¼ˆå³TCPæŠ¥æ–‡æ®µ4ï¼‰,ä»£ç†æœåŠ¡å™¨è¿”å›äº†å…­ä¸ªtcpæŠ¥æ–‡ï¼Œæ€»é•¿8522å­—èŠ‚ï¼Œå®¢æˆ·ç«¯ç”¨äº†ä¸ƒä¸ªtcpæŠ¥æ–‡ç¡®å®šåº”ç­” HTTPè¯·æ±‚1234GET http://www.baidu.com/index.html HTTP/1.0User-Agent:Wget/1.12(linux-gnu)Host:www.baidu.comConnection:close GETè¯·æ±‚æ–¹æ³•ï¼Œåªè¯» çš„æ–¹å¼è¯·æ±‚ HEADã€GETã€OPTIONSå’ŒTRACEè¢«è§†ä¸ºå®‰å…¨çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬åªæ˜¯ä»æœåŠ¡å™¨è·å¾—èµ„æºæˆ–ä¿¡æ¯ï¼Œè€Œä¸å¯¹æœåŠ¡å™¨è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚è€ŒPOSTã€PUTã€DELETEå’ŒPATCHåˆ™å½±å“æœåŠ¡å™¨ä¸Šçš„èµ„æº GETã€HEADã€OPTIONSã€TRACEã€PUTå’ŒDELETEç­‰è¯·æ±‚æ–¹æ³•è¢«è®¤ä¸ºæ˜¯ç­‰å¹‚çš„ï¼ˆidempotentï¼‰ï¼Œå³å¤šæ¬¡è¿ç»­çš„ã€é‡å¤çš„è¯·æ±‚å’Œåªå‘é€ä¸€æ¬¡è¯¥è¯·æ±‚å…·æœ‰å®Œå…¨ç›¸åŒçš„æ•ˆæœã€‚è€ŒPOSTæ–¹æ³•åˆ™ä¸åŒï¼Œè¿ç»­å¤šæ¬¡å‘é€åŒæ ·ä¸€ä¸ªè¯·æ±‚å¯èƒ½è¿›ä¸€æ­¥å½±å“æœåŠ¡å™¨ä¸Šçš„èµ„æº Linuxä¸Šæä¾›äº†å‡ ä¸ªå‘½ä»¤ï¼šHEADã€GETå’ŒPOSTã€‚å…¶å«ä¹‰åŸºæœ¬ä¸HTTPåè®®ä¸­çš„åŒåè¯·æ±‚æ–¹æ³•ç›¸åŒã€‚å®ƒä»¬é€‚åˆç”¨æ¥å¿«é€Ÿæµ‹è¯•WebæœåŠ¡å™¨ â€œhttp://www.baidu.com/index.htmlâ€æ˜¯ç›®æ ‡èµ„æºçš„URLã€‚å…¶ä¸­â€œhttpâ€æ˜¯æ‰€è°“çš„**scheme**ï¼Œè¡¨ç¤ºè·å–ç›®æ ‡èµ„æºéœ€è¦ä½¿ç”¨çš„åº”ç”¨å±‚åè®®ã€‚å…¶ä»–å¸¸è§çš„schemeè¿˜æœ‰ftpã€rtspå’Œfileç­‰ã€‚â€œwww.baidu.comâ€æŒ‡å®šèµ„æºæ‰€åœ¨çš„ç›®æ ‡ä¸»æœºã€‚â€œindex.htmlâ€æŒ‡å®šèµ„æºæ–‡ä»¶çš„åç§°ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯æœåŠ¡å™¨æ ¹ç›®å½•ï¼ˆç«™ç‚¹çš„æ ¹ç›®å½•ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•â€œ/â€ï¼‰ä¸­çš„ç´¢å¼•æ–‡ä»¶ã€‚â€œHTTP/1. 0â€è¡¨ç¤ºå®¢æˆ·ç«¯ï¼ˆwgetç¨‹åºï¼‰ä½¿ç”¨çš„HTTPçš„ç‰ˆæœ¬å·æ˜¯1.0ã€‚ç›®å‰çš„ä¸»æµHTTPç‰ˆæœ¬æ˜¯1.1ã€‚ HTTPè¯·æ±‚å†…å®¹ä¸­çš„ç¬¬2ï½4è¡Œéƒ½æ˜¯HTTPè¯·æ±‚çš„å¤´éƒ¨å­—æ®µã€‚ä¸€ä¸ªHTTPè¯·æ±‚å¯ä»¥åŒ…å«å¤šä¸ªå¤´éƒ¨å­—æ®µã€‚ä¸€ä¸ªå¤´éƒ¨å­—æ®µç”¨ä¸€è¡Œè¡¨ç¤ºï¼ŒåŒ…å«å­—æ®µåç§°ã€å†’å·ã€ç©ºæ ¼å’Œå­—æ®µçš„å€¼ã€‚HTTPè¯·æ±‚ä¸­çš„å¤´éƒ¨å­—æ®µå¯æŒ‰ä»»æ„é¡ºåºæ’åˆ—ã€‚ â€œUser-Agent:Wget&#x2F;1. 12(linux-gnu)â€è¡¨ç¤ºå®¢æˆ·ç«¯ä½¿ç”¨çš„ç¨‹åºæ˜¯wgetã€‚ â€œHost:www. baidu.comâ€è¡¨ç¤ºç›®æ ‡ä¸»æœºåæ˜¯www.baidu.comã€‚HTTPåè®®è§„å®šHTTPè¯·æ±‚ä¸­å¿…é¡»åŒ…å«çš„å¤´éƒ¨å­—æ®µå°±æ˜¯ç›®æ ‡ä¸»æœºåã€‚ â€œConnection:closeâ€æ˜¯æˆ‘ä»¬æ‰§è¡Œwgetå‘½ä»¤æ—¶ä¼ å…¥çš„ï¼Œå‘Šè¯‰æœåŠ¡å™¨å¤„ç†å®Œè¿™ä¸ªHTTPè¯·æ±‚ä¹‹åå°±å…³é—­è¿æ¥ã€‚åœ¨æ—§çš„HTTPåè®®ä¸­ï¼ŒWebå®¢æˆ·ç«¯å’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ä¸ªTCPè¿æ¥åªèƒ½ä¸ºä¸€ä¸ªHTTPè¯·æ±‚æœåŠ¡ã€‚å½“å¤„ç†å®Œå®¢æˆ·çš„ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹åï¼ŒWebæœåŠ¡å™¨å°±ï¼ˆä¸»åŠ¨ï¼‰å°†TCPè¿æ¥å…³é—­äº†ã€‚æ­¤åï¼ŒåŒä¸€å®¢æˆ·å¦‚æœè¦å†å‘é€ä¸€ä¸ªHTTPè¯·æ±‚çš„è¯ï¼Œå¿…é¡»ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªæ–°çš„TCPè¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªå®¢æˆ·çš„å¤šä¸ªè¿ç»­çš„HTTPè¯·æ±‚ä¸èƒ½å…±ç”¨åŒä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™ç§°ä¸ºçŸ­è¿æ¥ã€‚ é•¿è¿æ¥ä¸ä¹‹ç›¸åï¼Œæ˜¯æŒ‡å¤šä¸ªè¯·æ±‚å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥ã€‚é•¿è¿æ¥åœ¨ç¼–ç¨‹ä¸Šç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½†æ€§èƒ½ä¸Šå´æœ‰å¾ˆå¤§æé«˜ï¼šå®ƒæå¤§åœ°å‡å°‘äº†ç½‘ç»œä¸Šä¸ºå»ºç«‹TCPè¿æ¥å¯¼è‡´çš„è´Ÿè·ï¼ŒåŒæ—¶å¯¹æ¯æ¬¡è¯·æ±‚è€Œè¨€ç¼©å‡äº†å¤„ç†æ—¶é—´ã€‚HTTPè¯·æ±‚å’Œåº”ç­”ä¸­çš„â€œConnectionâ€å¤´éƒ¨å­—æ®µå°±æ˜¯ä¸“é—¨ç”¨äºå‘Šè¯‰å¯¹æ–¹ä¸€ä¸ªè¯·æ±‚å®Œæˆä¹‹åè¯¥å¦‚ä½•å¤„ç†è¿æ¥çš„ï¼Œæ¯”å¦‚ç«‹å³å…³é—­è¿æ¥ï¼ˆè¯¥å¤´éƒ¨å­—æ®µçš„å€¼ä¸ºâ€œcloseâ€ï¼‰æˆ–è€…ä¿æŒä¸€æ®µæ—¶é—´ä»¥ç­‰å¾…åç»­è¯·æ±‚ï¼ˆè¯¥å¤´éƒ¨å­—æ®µçš„å€¼ä¸ºâ€œkeep-aliveâ€ï¼‰ã€‚å½“ç”¨æµè§ˆå™¨è®¿é—®ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œè¯»è€…ä¸å¦¨ä½¿ç”¨netstatå‘½ä»¤æ¥æŸ¥çœ‹æµè§ˆå™¨å’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ˜¯å¦æ˜¯é•¿è¿æ¥ï¼Œä»¥åŠè¯¥è¿æ¥ç»´æŒäº†å¤šé•¿æ—¶é—´ã€‚ åœ¨æ‰€æœ‰å¤´éƒ¨å­—æ®µä¹‹åï¼ŒHTTPè¯·æ±‚å¿…é¡»åŒ…å«ä¸€ä¸ªç©ºè¡Œï¼Œä»¥æ ‡è¯†å¤´éƒ¨å­—æ®µçš„ç»“æŸã€‚è¯·æ±‚è¡Œå’Œæ¯ä¸ªå¤´éƒ¨å­—æ®µéƒ½å¿…é¡»ä»¥ï¼œCRï¼ï¼œLFï¼ç»“æŸï¼ˆå›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ï¼‰ï¼›è€Œç©ºè¡Œåˆ™å¿…é¡»åªåŒ…å«ä¸€ä¸ªï¼œCRï¼ï¼œLFï¼ï¼Œä¸èƒ½æœ‰å…¶ä»–å­—ç¬¦ï¼Œç”šè‡³æ˜¯ç©ºç™½å­—ç¬¦ã€‚åœ¨ç©ºè¡Œä¹‹åï¼ŒHTTPè¯·æ±‚å¯ä»¥åŒ…å«å¯é€‰çš„æ¶ˆæ¯ä½“ã€‚å¦‚æœæ¶ˆæ¯ä½“éç©ºï¼Œåˆ™HTTPè¯·æ±‚çš„å¤´éƒ¨å­—æ®µä¸­å¿…é¡»åŒ…å«æè¿°è¯¥æ¶ˆæ¯ä½“é•¿åº¦çš„å­—æ®µâ€œContent-Lengthâ€ã€‚æˆ‘ä»¬çš„å®ä¾‹åªæ˜¯è·å–ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œæ‰€ä»¥æ²¡æœ‰æ¶ˆæ¯ä½“ HTTPåº”ç­”1234567HTTP/1.0 200 OKServer:BWS/1.0Content-Length:8024Content-Type:text/html;charset=gbkSetCookie:BAIDUID=A5B6C72D68CF639CE8896FD79A03FBD8:FG=1;expires=Wed,04-Jul-42 00:10:47 GMT;path=/;domain=.baidu.comVia:1.0 localhost(squid/3.0 STABLE18) ç¬¬ä¸€è¡Œæ˜¯çŠ¶æ€è¡Œã€‚â€œHTTP&#x2F;1.0â€æ˜¯æœåŠ¡å™¨ä½¿ç”¨çš„HTTPåè®®çš„ç‰ˆæœ¬å·ã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨éœ€è¦ä½¿ç”¨å’Œå®¢æˆ·ç«¯ç›¸åŒçš„HTTPåè®®ç‰ˆæœ¬ã€‚â€œ200 OKâ€æ˜¯çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ ç¬¬2ï½7è¡Œæ˜¯HTTPåº”ç­”çš„å¤´éƒ¨å­—æ®µã€‚å…¶è¡¨ç¤ºæ–¹æ³•ä¸HTTPè¯·æ±‚ä¸­çš„å¤´éƒ¨å­—æ®µç›¸åŒã€‚ â€œServer:BWS&#x2F;1. 0â€è¡¨ç¤ºç›®æ ‡WebæœåŠ¡å™¨ç¨‹åºçš„åå­—æ˜¯BWSï¼ˆBaidu Web Serverï¼‰ â€œContent-Length:8024â€è¡¨ç¤ºç›®æ ‡æ–‡æ¡£çš„é•¿åº¦ä¸º8024å­—èŠ‚ã€‚è¿™ä¸ªå€¼å’Œwgetè¾“å‡ºçš„æ–‡æ¡£é•¿åº¦ä¸€è‡´ â€œContent-Type:text&#x2F;html;charset&#x3D;gbkâ€è¡¨ç¤ºç›®æ ‡æ–‡æ¡£çš„MIMEç±»å‹ã€‚å…¶ä¸­â€œtextâ€æ˜¯ä¸»æ–‡æ¡£ç±»å‹ï¼Œâ€œhtmlâ€æ˜¯å­æ–‡æ¡£ç±»å‹ã€‚â€œtext&#x2F;htmlâ€è¡¨ç¤ºç›®æ ‡æ–‡æ¡£index.htmlæ˜¯textç±»å‹ä¸­çš„htmlæ–‡æ¡£ã€‚â€œcharsetâ€æ˜¯textæ–‡æ¡£ç±»å‹çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šæ–‡æ¡£çš„å­—ç¬¦ç¼–ç  â€œSet Cookie:BAIDUID&#x3D;A5B6C72D68CF639CE8896FD79A03FBD8:FG&#x3D;1;expires&#x3D;Wed,04-Jul-42 00:10:47 GMT;path&#x3D;&#x2F;;domain&#x3D;. baidu.comâ€è¡¨ç¤ºæœåŠ¡å™¨ä¼ é€ä¸€ä¸ªCookieç»™å®¢æˆ·ç«¯ã€‚å…¶ä¸­ï¼Œâ€œBAIDUIDâ€æŒ‡å®šCookieçš„åå­—ï¼Œâ€œexpiresâ€æŒ‡å®šCookieçš„ç”Ÿå­˜æ—¶é—´ï¼Œâ€œdomainâ€å’Œâ€œpathâ€æŒ‡å®šè¯¥Cookieç”Ÿæ•ˆçš„åŸŸåå’Œè·¯å¾„ã€‚ä¸‹é¢æˆ‘ä»¬ç®€å•åˆ†æä¸€ä¸‹Cookieçš„ä½œç”¨ã€‚ HTTPåè®®æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œå³æ¯ä¸ªHTTPè¯·æ±‚ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¸Šä¸‹æ–‡å…³ç³»ã€‚å¦‚æœæœåŠ¡å™¨å¤„ç†åç»­HTTPè¯·æ±‚æ—¶éœ€è¦ç”¨åˆ°å‰é¢çš„HTTPè¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¿…é¡»é‡ä¼ è¿™äº›ä¿¡æ¯ã€‚è¿™æ ·å°±å¯¼è‡´HTTPè¯·æ±‚å¿…é¡»ä¼ è¾“æ›´å¤šçš„æ•°æ®ã€‚åœ¨äº¤äº’å¼Webåº”ç”¨ç¨‹åºå…´èµ·ä¹‹åï¼ŒHTTPåè®®çš„è¿™ç§æ— çŠ¶æ€ç‰¹æ€§å°±æ˜¾å¾—ä¸é€‚åº”äº†ï¼Œå› ä¸ºäº¤äº’ç¨‹åºé€šå¸¸è¦æ‰¿ä¸Šå¯ä¸‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨é¢å¤–çš„æ‰‹æ®µæ¥ä¿æŒHTTPè¿æ¥çŠ¶æ€ï¼Œå¸¸è§çš„è§£å†³æ–¹æ³•å°±æ˜¯Cookieã€‚Cookieæ˜¯æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯ï¼ˆé€šè¿‡HTTPåº”ç­”çš„å¤´éƒ¨å­—æ®µâ€œSet Cookieâ€ï¼‰ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™éƒ½éœ€è¦å¸¦ä¸Šè¿™äº›ä¿¡æ¯ï¼ˆé€šè¿‡HTTPè¯·æ±‚çš„å¤´éƒ¨å­—æ®µâ€œCookieâ€ï¼‰ã€‚è¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·äº†ã€‚åŸºäºæµè§ˆå™¨çš„è‡ªåŠ¨ç™»å½•å°±æ˜¯ç”¨Cookieå®ç°çš„ã€‚ â€œVia:1. 0 localhost(squid&#x2F;3.0 STABLE18)â€è¡¨ç¤ºHTTPåº”ç­”åœ¨è¿”å›è¿‡ç¨‹ä¸­ç»å†è¿‡çš„æ‰€æœ‰ä»£ç†æœåŠ¡å™¨çš„åœ°å€å’Œåç§°ã€‚è¿™é‡Œçš„localhostå®é™…ä¸ŠæŒ‡çš„æ˜¯â€œ192.168.1.108â€ã€‚è¿™ä¸ªå¤´éƒ¨å­—æ®µçš„åŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äºIPåè®®çš„è®°å½•è·¯ç”±åŠŸèƒ½ã€‚ åœ¨æ‰€æœ‰å¤´éƒ¨å­—æ®µä¹‹åï¼ŒHTTPåº”ç­”å¿…é¡»åŒ…å«ä¸€ä¸ªç©ºè¡Œï¼Œä»¥æ ‡è¯†å¤´éƒ¨å­—æ®µçš„ç»“æŸã€‚çŠ¶æ€è¡Œå’Œæ¯ä¸ªå¤´éƒ¨å­—æ®µéƒ½å¿…é¡»ä»¥ï¼œCRï¼ï¼œLFï¼ç»“æŸï¼›è€Œç©ºè¡Œåˆ™å¿…é¡»åªåŒ…å«ä¸€ä¸ªï¼œCRï¼ï¼œLFï¼ï¼Œä¸èƒ½æœ‰å…¶ä»–å­—ç¬¦ï¼Œç”šè‡³æ˜¯ç©ºç™½å­—ç¬¦ã€‚ ç©ºè¡Œä¹‹åæ˜¯è¢«è¯·æ±‚æ–‡æ¡£index.htmlçš„å†…å®¹ï¼Œå…¶é•¿åº¦æ˜¯8024å­—èŠ‚ã€‚","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"æ—¶é—´å †","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/æ—¶é—´å †","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/æ—¶é—´å †/","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/%E6%97%B6%E9%97%B4%E5%A0%86/","excerpt":"","text":"ç”¨å°æ ¹å †çš„æ—¶é—´å † å¤„ç†å®šæ—¶äº‹ä»¶ï¼Œå®šæœŸç›‘æµ‹ä¸€ä¸ªå®¢æˆ·è¿æ¥çš„æ´»åŠ¨çŠ¶æ€ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯å°†æ¯ä¸ªå®šæ—¶äº‹ä»¶å°è£…æˆå®šæ—¶å™¨ï¼Œå¹¶ä½¿ç”¨æŸç§å®¹å™¨ç±»æ•°æ®ç»“æ„å°†æ‰€æœ‰çš„å®šæ—¶å™¨ä¿å­˜å¥½ï¼Œå¸¸ç”¨æ–¹æ³•æœ‰æ’åºé“¾è¡¨ã€çº¢é»‘æ ‘ã€æ—¶é—´å †å’Œæ—¶é—´è½®ã€‚ ä¼ ç»Ÿçš„å®šæ—¶æ–¹æ¡ˆæ˜¯ä»¥å›ºå®šé¢‘ç‡è°ƒç”¨èµ·æå‡½æ•°tickï¼Œè¿›è€Œæ‰§è¡Œå®šæ—¶å™¨ä¸Šçš„å›è°ƒå‡½æ•°ã€‚è€Œæ—¶é—´å †çš„åšæ³•åˆ™æ˜¯å°†æ‰€æœ‰å®šæ—¶å™¨ä¸­è¶…æ—¶æ—¶é—´æœ€å°çš„ä¸€ä¸ªå®šæ—¶å™¨çš„è¶…æ—¶å€¼ä½œä¸ºå¿ƒæé—´éš”ï¼Œå½“è¶…æ—¶æ—¶é—´åˆ°è¾¾æ—¶ï¼Œå¤„ç†è¶…æ—¶äº‹ä»¶ï¼Œç„¶åå†æ¬¡ä»å‰©ä½™å®šæ—¶å™¨ä¸­æ‰¾å‡ºè¶…æ—¶æ—¶é—´æœ€å°çš„ä¸€ä¸ªï¼Œä¾æ¬¡åå¤å³å¯ã€‚ å…³é”®è¯ï¼šå®šæ—¶å™¨ï¼Œå›è°ƒå‡½æ•° ç®€å•è§£é‡Šï¼šèŠ‚ç‚¹ç»„æˆï¼šfd æ—¶é—´ç‚¹ å›è°ƒå‡½æ•° ï¼Œç”¨ä¸€ä¸ªvectorç»´æŠ¤äº†ä¸€ä¸ªå°æ ¹å †ï¼Œä¹Ÿå°±æ˜¯æœ€å¿«åˆ°æ—¶é—´çš„æ’åœ¨ç¬¬ä¸€ä¸ªï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;fd,index&gt;æ¥è®°å½•å¯¹åº”æ–‡ä»¶æè¿°ç¬¦åœ¨vetorä¸­çš„ä½ç½®ï¼Œæ¯æ¬¡æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…ä¿®æ”¹æ—¶é—´æˆ–è€…åˆ é™¤èŠ‚ç‚¹éƒ½éœ€è¦å¯¹å †è¿›è¡Œç»´æŠ¤ï¼Œè¿˜æä¾›ä¸€ä¸ªtickæ£€æŸ¥æ˜¯å¦è¶…æ—¶çš„æ–¹æ³•ï¼Œä¸æ–­å–å‡ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè¶…æ—¶åˆ™åˆ é™¤èŠ‚ç‚¹å¹¶è°ƒç”¨å›è°ƒå‡½æ•° å…³äºc++ 11 æ—¶é—´çš„è°ƒç”¨ï¼š éƒ½æ˜¯å¯ä»¥ä½¿ç”¨typedefé‡å‘½åç®€åŒ–ä»£ç  123456std::chrono::high_resolution_clock::time_point ç”¨äºå­˜æ—¶é—´ç‚¹std::chrono::high_resolution_clock::now() è·å–å½“å‰æ—¶é—´//å°†è®¡ç®—å‡ºæ¥çš„æ—¶é—´å·®ç”¨duration_castæ¨¡æ¿è½¬åŒ–ä¸ºmilliseconds æ¯«ç§’çº§åˆ«std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(std::chrono::high_resolution_clock::time_point - std::chrono::high_resolution_clock::now()).count() è€ƒè™‘å°è£…ä¸€ä¸ªå›ºå®šä¸€ä¸ªæ—¶é—´é¢‘ç‡å–å‡ºçš„æ—¶é—´é˜Ÿåˆ— ä»£ç å®ç°heaptimer.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132#include &quot;heaptimer.h&quot;void HeapTimer::SwapNode_(size_t i, size_t j) &#123; assert(i &gt;= 0 &amp;&amp; i &lt;heap_.size()); assert(j &gt;= 0 &amp;&amp; j &lt;heap_.size()); swap(heap_[i], heap_[j]); ref_[heap_[i].id] = i; // ç»“ç‚¹å†…éƒ¨idæ‰€åœ¨ç´¢å¼•ä½ç½®ä¹Ÿè¦å˜åŒ– ref_[heap_[j].id] = j; &#125;void HeapTimer::siftup_(size_t i) &#123; assert(i &gt;= 0 &amp;&amp; i &lt; heap_.size()); size_t parent = (i-1) / 2; while(parent &gt;= 0) &#123; if(heap_[parent] &gt; heap_[i]) &#123;//ä¿è¯ç¬¬ä¸€ä¸ªvetorçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æœ€å…ˆåˆ°æ—¶é—´çš„ SwapNode_(i, parent); i = parent; parent = (i-1)/2; &#125; else &#123; break; &#125; &#125;&#125;// falseï¼šä¸éœ€è¦ä¸‹æ»‘ trueï¼šä¸‹æ»‘æˆåŠŸbool HeapTimer::siftdown_(size_t i, size_t n) &#123; assert(i &gt;= 0 &amp;&amp; i &lt; heap_.size()); assert(n &gt;= 0 &amp;&amp; n &lt;= heap_.size()); // n:å…±å‡ ä¸ªç»“ç‚¹ auto index = i; auto child = 2*index+1; while(child &lt; n) &#123; if(child+1 &lt; n &amp;&amp; heap_[child+1] &lt; heap_[child]) &#123; child++; &#125; if(heap_[child] &lt; heap_[index]) &#123; SwapNode_(index, child); index = child; child = 2*child+1; &#125; break; // éœ€è¦è·³å‡ºå¾ªç¯ &#125; return index &gt; i;&#125;// åˆ é™¤æŒ‡å®šä½ç½®çš„ç»“ç‚¹void HeapTimer::del_(size_t index) &#123; assert(index &gt;= 0 &amp;&amp; index &lt; heap_.size()); // å°†è¦åˆ é™¤çš„ç»“ç‚¹æ¢åˆ°é˜Ÿå°¾ï¼Œç„¶åè°ƒæ•´å † size_t tmp = index; size_t n = heap_.size() - 1; assert(tmp &lt;= n); // å¦‚æœå°±åœ¨é˜Ÿå°¾ï¼Œå°±ä¸ç”¨ç§»åŠ¨äº† if(index &lt; heap_.size()-1) &#123; SwapNode_(tmp, heap_.size()-1); if(!siftdown_(tmp, n)) &#123; siftup_(tmp); &#125; &#125; ref_.erase(heap_.back().id); heap_.pop_back();&#125;// è°ƒæ•´æŒ‡å®šidçš„ç»“ç‚¹void HeapTimer::adjust(int id, int newExpires) &#123;//è°ƒæ•´æ—¶é—´ç‚¹ å‘ä¸‹æµ®åŠ¨ assert(!heap_.empty() &amp;&amp; ref_.count(id)); heap_[ref_[id]].expires = Clock::now() + MS(newExpires); siftdown_(ref_[id], heap_.size());&#125;void HeapTimer::add(int id, int timeOut, const TimeoutCallBack&amp; cb) &#123; assert(id &gt;= 0); //è¿™é‡Œçš„idæ˜¯fd // å¦‚æœæœ‰ï¼Œåˆ™è°ƒæ•´ if(ref_.count(id)) &#123;//åˆ¤æ–­idè¿™ä¸ªkeyå‡ºç°çš„æ¬¡æ•°ï¼Œunordered_mapä¸å…è®¸é‡å¤ï¼Œæ‰€ä»¥å°±æ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰ int tmp = ref_[id]; heap_[tmp].expires = Clock::now() + MS(timeOut); heap_[tmp].cb = cb; if(!siftdown_(tmp, heap_.size())) &#123; siftup_(tmp); &#125; &#125; else &#123; size_t n = heap_.size();//å½“å‰vetcorçš„å¤§å° ref_[id] = n;//å“ˆå¸Œè¡¨refçš„ä½œç”¨å°±æ˜¯è®°å½•ç³»èŠ‚ç‚¹åœ¨vetcorä¸­çš„ç´¢å¼• heap_.push_back(&#123;id, Clock::now() + MS(timeOut), cb&#125;); // å³å€¼ è®¾ç½®æ—¶é—´ç‚¹ä¸ºä¸‹ä¸€ä¸ªè¶…æ—¶çš„æ—¶é—´ç‚¹ siftup_(n);//ä¸Šæµ®ï¼Œä¸çˆ¶èŠ‚ç‚¹æ¯”è¾ƒï¼Œç›´è‡³å †é¡¶æˆ–è€…å¤§äºçˆ¶èŠ‚ç‚¹ &#125;&#125;// åˆ é™¤æŒ‡å®šidï¼Œå¹¶è§¦å‘å›è°ƒå‡½æ•°void HeapTimer::doWork(int id) &#123; if(heap_.empty() || ref_.count(id) == 0) &#123; return; &#125; size_t i = ref_[id]; auto node = heap_[i]; node.cb(); // è§¦å‘å›è°ƒå‡½æ•° del_(i);&#125;void HeapTimer::tick() &#123; /* æ¸…é™¤è¶…æ—¶ç»“ç‚¹ */ if(heap_.empty()) &#123; return; &#125; while(!heap_.empty()) &#123; TimerNode node = heap_.front();//è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if(std::chrono::duration_cast&lt;MS&gt;(node.expires - Clock::now()).count() &gt; 0) &#123; break; //æ£€æŸ¥æ—¶é—´é—´éš”ï¼Œæ²¡æœ‰è¿‡æœŸåˆ™é€€å‡º &#125; node.cb();//åˆ°æœŸåˆ™è§¦å‘å›è°ƒå¹¶åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ pop(); &#125;&#125;void HeapTimer::pop() &#123; assert(!heap_.empty()); del_(0);&#125;void HeapTimer::clear() &#123; ref_.clear(); heap_.clear();&#125;int HeapTimer::GetNextTick() &#123; tick(); size_t res = -1; if(!heap_.empty()) &#123; res = std::chrono::duration_cast&lt;MS&gt;(heap_.front().expires - Clock::now()).count(); if(res &lt; 0) &#123; res = 0; &#125; &#125; return res;&#125; heaptimer.h12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#ifndef HEAP_TIMER_H#define HEAP_TIMER_H#include &lt;queue&gt;#include &lt;unordered_map&gt;#include &lt;time.h&gt;#include &lt;algorithm&gt;#include &lt;arpa/inet.h&gt; #include &lt;functional&gt; #include &lt;assert.h&gt; #include &lt;chrono&gt;#include &quot;../log/log.h&quot;typedef std::function&lt;void()&gt; TimeoutCallBack;//å‡½æ•°æ¨¡æ¿ æ²¡æœ‰å‚æ•°å’Œè¿”å›å€¼typedef std::chrono::high_resolution_clock Clock;typedef std::chrono::milliseconds MS; //æ¯«ç§’typedef Clock::time_point TimeStamp;//æ—¶é—´ç‚¹ç±»å‹struct TimerNode &#123; int id; TimeStamp expires; // è¶…æ—¶æ—¶é—´ç‚¹ TimeoutCallBack cb; // å›è°ƒfunction&lt;void()&gt; bool operator&lt;(const TimerNode&amp; t) &#123; // é‡è½½æ¯”è¾ƒè¿ç®—ç¬¦ return expires &lt; t.expires; &#125; bool operator&gt;(const TimerNode&amp; t) &#123; // é‡è½½æ¯”è¾ƒè¿ç®—ç¬¦ return expires &gt; t.expires; &#125;&#125;;class HeapTimer &#123;public: HeapTimer() &#123; heap_.reserve(64); &#125; // ä¿ç•™64ä¸ªTimerNodeçš„ç©ºé—´ ~HeapTimer() &#123; clear(); &#125; void adjust(int id, int newExpires); void add(int id, int timeOut, const TimeoutCallBack&amp; cb); void doWork(int id); void clear(); void tick(); void pop(); int GetNextTick();private: void del_(size_t i); void siftup_(size_t i); bool siftdown_(size_t i, size_t n); void SwapNode_(size_t i, size_t j); std::vector&lt;TimerNode&gt; heap_;//å­˜æ”¾ id æ—¶é—´ç‚¹ // key:id value:vectorçš„ä¸‹æ ‡ std::unordered_map&lt;int, size_t&gt; ref_; // idå¯¹åº”çš„åœ¨heap_ä¸­çš„ä¸‹æ ‡ï¼Œæ–¹ä¾¿ç”¨heap_çš„æ—¶å€™æŸ¥æ‰¾&#125;;#endif //HEAP_TIMER_H ###main.cpp 12345678910111213141516171819#include &lt;iostream&gt;#include &quot;heaptimer.h&quot;using namespace std;void hello()&#123; cout&lt;&lt;&quot;hello world!&quot;&lt;&lt;endl;&#125;int main()&#123; HeapTimer ht; ht.add(1, 5000, hello);//å¯ä»¥ä½¿ç”¨bindç»‘å®šå‡½æ•° ht.add(2, 1000, hello); sleep(5);//ç¡2ç§’åªæ‰“å°ä¸€ä¸ªhelloç¡5ç§’æ‰“å°ä¸¤ä¸ª ht.tick(); //è·å–ä¸‹ä¸€ä¸ªåˆ°æœŸæ—¶é—´é—´éš” ht.add(3, 1000, hello); cout&lt;&lt;ht.GetNextTick()&lt;&lt;endl; ht.doWork(3);//åˆ é™¤èŠ‚ç‚¹3å¹¶å›è°ƒ return 0;&#125;","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"è¿æ¥æ± ","slug":"source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/è¿æ¥æ± ","date":"2025-03-01T16:00:00.000Z","updated":"2025-03-03T12:45:53.382Z","comments":true,"path":"2025/03/02/source/Linux/Linixé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹/è¿æ¥æ± /","permalink":"http://example.com/2025/03/02/source/Linux/Linix%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/%E8%BF%9E%E6%8E%A5%E6%B1%A0/","excerpt":"","text":"å®‰è£…mysqlåº“æ–‡ä»¶ #include &lt;mysql&#x2F;mysql.h&gt; sudo yum install epel-release å®‰è£…epelè½¯ä»¶åº“ sudo yum install mysql-devel g++ -o my_program my_program.cpp -lmysqlclient æ—¥å¿—æµ‹è¯•ç¨‹åº 1234567891011121314151617181920212223242526272829303132#include &quot;log/log.h&quot;#include &lt;iostream&gt;#include &quot;log/blockqueue.h&quot;void producer(BlockQueue&lt;int&gt;&amp; queue, int id) &#123; for (int i = 0; i &lt; 10; ++i) &#123; int item = id * 100 + i; queue.push_back(item); std::cout &lt;&lt; &quot;Producer &quot; &lt;&lt; id &lt;&lt; &quot; produced &quot; &lt;&lt; item &lt;&lt; std::endl; //std::this_thread::sleep_for(std::chrono::milliseconds(100)); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ &#125;&#125;// æ¶ˆè´¹è€…çº¿ç¨‹å‡½æ•°void consumer(BlockQueue&lt;int&gt;&amp; queue, int id) &#123; for (int i = 0; i &lt; 10; ++i) &#123; int item; if (queue.pop(item)) &#123; std::cout &lt;&lt; &quot;Consumer &quot; &lt;&lt; id &lt;&lt; &quot; consumed &quot; &lt;&lt; item &lt;&lt; std::endl; //std::this_thread::sleep_for(std::chrono::milliseconds(150)); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ &#125; else &#123; std::cout &lt;&lt; &quot;Consumer &quot; &lt;&lt; id &lt;&lt; &quot; timed out&quot; &lt;&lt; std::endl; &#125; &#125;&#125;int main()&#123; Log::Instance()-&gt;init(0, &quot;./log&quot;, &quot;.log&quot;, 0); LOG_DEBUG(&quot;========== Server init error!==========&quot;); LOG_WARN(&quot;========== Server init error!==========&quot;); LOG_ERROR(&quot;========== Server init error!==========&quot;); LOG_INFO(&quot;========== Server init error!==========&quot;); return 0;&#125; æ•°æ®åº“123456789101112131415161718192021222324252627282930313233æ‹‰å–MySQLé•œåƒbashdocker pull mysql:latestè¿è¡ŒMySQLå®¹å™¨å¹¶è®¾ç½®rootå¯†ç bashdocker run --name mysql-container -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:latestè¿™é‡Œmy-secret-pwæ˜¯ä½ è¦è®¾ç½®çš„rootå¯†ç ï¼Œè¯·æ›¿æ¢ä¸ºä½ è‡ªå·±æƒ³è¦è®¾ç½®çš„å¯†ç ã€‚ç™»å½•MySQLåå°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç™»å½•MySQLå®¹å™¨ï¼šbashdocker exec -it mysql-container mysql -uroot -pè¾“å…¥ä½ è®¾ç½®çš„rootå¯†ç ã€‚åˆ›å»ºæ•°æ®åº“testsqlCREATE DATABASE test;ä½¿ç”¨æ•°æ®åº“testUSE test;CREATE TABLE test ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL, age INT NOT NULL);INSERT INTO test (name, age) VALUES (&#x27;LiMing&#x27;, 30); æŸ¥çœ‹images [root@localhost test]# docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEmysql latest be960704dfac 3 weeks ago 602MBã€ ç¡®å®šç«¯å£å¯ç”¨æƒ…å†µ netstat -tuln | grep 3306 docker ps -a ç¡®å®šcontaineråå­—å¯ç”¨æƒ…å†µ docker rm å¯åŠ¨container 12345678910docker run -id \\-p 3306:3306 \\--name mysql-container \\--restart always \\-v $PWD/conf:/etc/mysql/conf.d \\-v $PWD/log:/var/log/mysql \\-v $PWD/data:/var/lib/mysql \\-e MYSQL_ROOT_PASSWORD=123456 \\mysql:latest \\--lower_case_table_names=1 docker exec -it mysql-container bash è¿›å…¥mysql bashç»ˆç«¯ mysql -uroot -p è¾“å…¥å¯†ç 123456åè¿›å…¥mysql ä½¿ç”¨Navicat æˆåŠŸè¿œç¨‹è¿æ¥ CREATE DATABASE test; USE test; CREATE TABLE test ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL, age INT NOT NULL ); INSERT INTO test (name, age) VALUES (&#39;LiMing&#39;, 30); 12345* é”™è¯¯ test: /root/my_log/code/main.cpp:66: void TestSqlConnPoll(): Assertion `conn&#39; failed. å·²æ”¾å¼ƒ (æ ¸å¿ƒå·²è½¬å‚¨) why?ä¸èƒ½ä½¿ç”¨â€localhostâ€ è¦ä½¿ç”¨ â€œ127.0.0.1â€ è¿˜æ˜¯æœ‰é”™è¯¯æ®µé”™è¯¯ (æ ¸å¿ƒå·²è½¬å‚¨) ã€‚ã€‚ã€‚åŸæ¥æ˜¯æŸ¥è¯¢çš„å‘½ä»¤é”™äº†","categories":[{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"}],"tags":[]},{"title":"é—­å…³ä¸€å¹´","slug":"source/æ‚è¯´/é—­å…³ä¸€å¹´","date":"2025-03-01T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/03/02/source/æ‚è¯´/é—­å…³ä¸€å¹´/","permalink":"http://example.com/2025/03/02/source/%E6%9D%82%E8%AF%B4/%E9%97%AD%E5%85%B3%E4%B8%80%E5%B9%B4/","excerpt":"","text":"ç”Ÿæ­»çœ‹æ·¡ ä¸æœå°±å¹²å†™åœ¨å‰é¢ ä»Šå¤©10.30 æ˜¨å¤©æ˜¯å°ç±³15å’Œæ¾æ¹ƒos2çš„å‘å¸ƒä¼šï¼Œå¼€åœºå°±æ˜¯é‡‘å‡¡çš„é—­å…³ä¸€å¹´ï¼Œæ‰€ä»¥æˆ‘å¤´è„‘ä¸€çƒ­ä¹Ÿæä¸€ä¸ªé—­å…³ä¸€å¹´ï¼Œä¸»è¦æ˜¯æ„Ÿè§‰æœ€è¿‘ç¡®å®æ²¡æ€ä¹ˆè¿›æ­¥ï¼Œä¸è¿‡ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œé›·å†›éƒ½è¯´å¤§å­¦è¯¥ç©å°±ç©ï¼Œè¯´ä¸å®šä»¥åæˆ‘ä¹Ÿèƒ½æŒ¤è¿›ç®¡ç†å²—ï¼Œæ•…ï¼Œä»…ä»¥æ­¤ç¯‡æ¥è®°å½•æˆ‘ä¸€å¹´çš„æ—¥è®°å’Œæˆé•¿è¿‡ç¨‹ï¼Œæœ›ä¸è´Ÿé’æ˜¥ã€‚ è¿˜æœ‰ï¼Œä¸è¦è¿½æ–°å‰§æˆ–è€…æ–°åŠ¨æ¼«ï¼Œå †å‡ åé›†æ”¾åœ¨ä¸€èµ·åˆæƒ³ç†¬å¤œä¸€ç›´çœ‹ï¼Œæ‰€ä»¥ä¸å¦‚æ¯å¤©ç­‰æ›´æ–°ï¼Œåˆ‡è®°æ™šä¸Šä¸è¦åˆ·æŠ–éŸ³ 10.30 è®¡åˆ’å¼€å§‹çš„å‰ä¸€å¤œ cç›˜æ˜¯çœŸçˆ†æ»¡ï¼Œèƒ½ä¸èƒ½åˆ«åˆ†ç›˜æˆ–è€…æ–°æœºå°±æŠŠcç›˜åˆ†å¤§ä¸€ç‚¹ï¼Œæ‰€æœ‰è½¯ä»¶éƒ½è£…åœ¨dç›˜çš„ä¹Ÿä¸€æ ·çˆ†æ»¡ å¸è½½è½¯ä»¶çš„æ—¶å€™å‘ç°steamå¤´åƒè¢«æ¢æˆäº†ã€‚ã€‚ã€‚ï¼ŒçœŸçš„åˆ«åœ¨ç½‘å§ç™»steamï¼ŒçœŸå¾—è¢«ç›—å· 10.31 è®¡åˆ’ï¼šå®Œæˆè¿æ¥æ± çš„è®¾è®¡å¹¶å®Œæˆæµ‹è¯• å…ˆå®Œæˆæµ‹è¯•demoçš„è¿è¡Œ 1:01 ä½¿ç”¨Cmakeé“¾æ¥threadå’Œmysqlå¹¶è¿è¡ŒdemoæˆåŠŸ â€¦..é¥¿äº† åˆ†ææµ‹è¯•ç¨‹åºæµç¨‹ ä½¿ç”¨pythonè„šæœ¬è‡ªåŠ¨git push æ·»åŠ åˆ°ç¯å¢ƒå˜é‡æ–¹ä¾¿cmdä¸­ç›´æ¥è¿è¡Œ 11.1-11.3 è¿‡ç”Ÿæ—¥å»äº† è®¡åˆ’ä¸­é“å´©æ®‚ï¼Œä¸”11.3æ—¥æ™šå¤±çœ åˆ°å‡Œæ™¨4ç‚¹åŠï¼Œå¤©ï¼Œå¤ªææ€–äº†ï¼Œå¯èƒ½æ˜¯ä¸‹é›¨åŠ ä¸Šå¼‚å“ 11.4 ä¸»çº¿ï¼šå®Œæˆè¿æ¥æ±  å‰¯çº¿ï¼šå­¦ä¹ æ™ºèƒ½æŒ‡é’ˆï¼Œlambdaè¡¨è¾¾å¼ï¼Œstd::bindï¼ŒRALLæœºåˆ¶ è¿è¡Œdemoæ•°æ®åº“ä¸€ç›´æ²¡å¼„å¥½ 11.5 11.6è¿™ä¸¤å¤©ä¸€ç›´åœ¨å†™å­¦æ ¡æœºå™¨å­¦ä¹ çš„å¤§ä½œä¸š 11.7 æ‘†çƒ‚ 11.8 ä¼‘æ¯ 11.9 ä¸»çº¿ï¼šæŠŠå¸®å­¦æ ¡è€å¸ˆåšçš„å¾®ä¿¡å°ç¨‹åºbugä¿®å¤äº† + æœ‰é™çŠ¶æ€æœº æ”¯çº¿ï¼šé‡è£…ç³»ç»Ÿ(Cç›˜æ— æ³•æ‹¯æ•‘) + è´­ä¹°ä¸€å¼ æµé‡å¡(é€‰äº†ä¸€å¼ 24å…ƒ100Gçš„) è½®æ’­å›¾æ•°ç›®é—®é¢˜ ç°åœ¨æ˜¯è¯·æ±‚çš„ä¸€é¡µä¸‰å¼ ï¼Œæ•°æ®åº“æœ‰5å¼ ï¼Œæˆ‘çœ‹èƒ½ä¸èƒ½ä½œæˆäº”å¼ ï¼Œæ²¡ç”¨é—®é¢˜ï¼Œé‚£å°±åšæˆæœ‰å¤šå°‘å¼ å°±åšå¤šå°‘å¼ ï¼Œ10å¼ ä¸Šé™ æ–°é—»æ ‡é¢˜æ ¼å¼åŒ–é—®é¢˜ è®¾ç½®æ ‡é¢˜æœ€å¤š16ä¸ªå­—ï¼Œè¶…å‡ºçš„éƒ¨åˆ†è®¾ç½®ä¸ºâ€¦ æˆåŠŸ moreæ–°é—»éƒ¨åˆ† æ ¼å¼åŒ–é—®é¢˜ + åˆ†é¡µé—®é¢˜ ç›´æ¥GPTè§£å†³ ä»¤ç‰Œ2å°æ—¶è¿‡æœŸé—®é¢˜ å®šæœŸå®ç°è‡ªåŠ¨é€€å‡ºåŠŸèƒ½ åœ¨ç™»å½•ä¹‹åä¿å­˜æ—¶é—´æˆ³åˆ°å†…å­˜ä¸­,App.vueä¸­å®ç°å®šæœŸæ£€æŸ¥è¿™ä¸ªæ—¶é—´æˆ³,ç„¶åè§¦å‘é€€å‡ºç™»å½•çš„é€»è¾‘ aiçš„web socketé—®é¢˜ ä»Šå¤©æŠŠç‹è€…è£è€€å¸è½½äº†ï¼Œä¸èƒ½ç”¨æˆ‘çš„æ‰‹æœºæ¥å¹²è¿™äº‹ï¼Œè€½è¯¯æˆ‘ï¼ŒåŠ æ²¹ï¼ 11.10 ä¸»çº¿ï¼šæµ‹è¯•httpè¿æ¥ æ”¯çº¿ï¼šå­¦æ ¡è®¡ç»„çš„å®éªŒä½œä¸š æ‰¾ä¸€ä¸‹å…¬å¸å‡ºå»å›¢å»ºçš„åœ°ç‚¹ï¼šè¿™æ´»å±…ç„¶äº¤ç»™æˆ‘äº†ï¼Œå°±è¦è½»æ˜“åœ¨ç¾¤é‡Œå›ç­”é¢†å¯¼çš„é—®é¢˜ï¼ 11.11 ä¸»çº¿ï¼šæ¢³ç†Tinywebserveræµç¨‹ çœ‹äº†ä¸€äº›ï¼Œä»Šå¤©åˆå¤±çœ äº† 11.12 æ—©ä¸Šå»å…¬å¸ä¸‹é›¨äº†ï¼Œèµ°åˆ°æ¥¼ä¸‹åˆä¸æƒ³å›å»æ‹¿ä¼ï¼Œç»“æœæ·‹ç€é›¨å»çš„ï¼Œéš¾å—ï¼Œæ™šä¸Šè¿˜åŠ ç­ï¼Œç‰©ç†æœºä¸Šå®‰è£…åä¸ºçš„æ¬§æ‹‰æ“ä½œç³»ç»Ÿï¼Œæµ‹è¯•é«˜æ–¯æ•°æ®åº“ï¼Œè¿˜æœ‰é˜¿é‡Œå’Œåä¸ºçš„ 10ç‚¹ä¸‹ç­å›æ¥ç»§ç»­æ¢³ç†ï¼Œç»˜åˆ¶ä¸€ä¸‹æµç¨‹å›¾ï¼Œæ„Ÿè§‰å·®ä¸å¤šéƒ½ç†è§£äº† 11.13 è‡ªå·±æ¢³ç†äº†ä¸€ä¸‹å®Œæ•´çš„tinywebserverçš„æµç¨‹ æˆ‘è§‰å¾—å¯ç”¨åšåˆ°æ›´å¥½ ç°åœ¨çš„é€»è¾‘æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± é é˜Ÿåˆ—æ¥å¤„ç†æ”¶åˆ°çš„æ•°æ®å’Œå‘é€æ•°æ®ï¼Œé‚£æ± å­æ»¡äº†å°±åªæœ‰ç­‰å¾…ï¼Œè€Œä¸”ç°åœ¨é»˜è®¤æ˜¯8ä¸ªçº¿ç¨‹ï¼Œfdå®ŒæˆçŠ¶æ€è½¬å˜åˆ™é‡Šæ”¾çº¿ç¨‹èµ„æºï¼Œå…¶å®ä¹Ÿå¯ä»¥ å®Œæˆæ—¶é—´å † 11.14 å°è£…epoller æ˜æ—¥è®¡åˆ’ï¼šæ·±åº¦ç†è§£è§¦å‘æ¨¡å¼å’Œæ³¨å†Œäº‹ä»¶çš„åŒºåˆ«ï¼Œå¹¶å®é™…åº”ç”¨ï¼Œè®¡åˆ’é¡ºå»¶ï¼Œå‘¨äº”åº”è¯¥ä¼šç© 11.15å‘¨äº” å’Œå¥³æœ‹å‹ä¸€èµ·ç© 11.16-11.17 ç©+å‡†å¤‡17çš„æŠ€æœ¯ç»æµè€ƒè¯• 17å·æ™šä¸Šï¼Œå½»å¤œéš¾çœ ï¼Œå±‹æ¼åé€¢è¿å¤œé›¨ï¼Œè¿™å‡ºç§Ÿå±‹ä¸çŸ¥é“ä»€ä¹ˆä¸œè¥¿ä¸€ç›´å“ï¼Œä¸‹é›¨å¹é£å°±è¿™æ ·ï¼Œçƒ¦ 11.18 ä¼‘æ¯ åé¢å‡†å¤‡è®¡ç®—æœºç»„æˆåŸç†è€ƒè¯•å’ŒITé¡¹ç›®ç®¡ç†çš„å¤§ä½œä¸š 11.30 å‘¨å…­ å®Œæˆè®¡ç®—æœºç»„æˆè€ƒè¯•å’ŒITé¡¹ç›®ç®¡ç†çš„å¤§ä½œä¸š 12.5 ä»Šå¤©å®ä¹ ç»“æŸäº†åŠç†äº†ç¦»èŒï¼Œå‰å‡ å¤©ä¸€ç›´å¿™ç€æ¬è¿ä¸œè¥¿ï¼Œæ€è€ƒä¸‹ä¸€æ­¥çš„è®¡åˆ’ã€‚ç”µè„‘æ¢å¤åˆå§‹åŒ–(å› ä¸ºCç›˜æ»¡äº†?ï¼Œæœ¬æ¥æ¸…ç©ºDç›˜ç„¶ååˆç›˜å°±è§£å†³çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¹‹å‰vmwareä¸‹è½½åœ¨dç›˜çš„å¯¼è‡´å®‰è£…ä¸æˆåŠŸï¼Œå°±ç®—æˆ‘æ’ä¸Šuç›˜ä¿®æ”¹ä¸ºdç›˜ï¼Œå…¶ä»–è½¯ä»¶ä¹Ÿæœ‰å„ç§å„æ ·çš„æ®‹ç•™é—®é¢˜ï¼ŒçœŸçš„æˆ‘è§‰å¾—windowsä¸Šå„ä¸ªè½¯ä»¶è®¾è®¡çš„lowçˆ†äº†ï¼Œæ˜¨å¤©æ™šä¸Šé‡è£…ä¹‹åå‘ç°å¤©å¡Œäº†ï¼Œæˆ‘è°·æ­Œæµè§ˆå™¨ä¸Šçš„ä¹¦ç­¾ä¸€ä¸ªä¹Ÿæ²¡æœ‰äº†ï¼Œåº”è¯¥æ˜¯ä¹‹å‰æ²¡æœ‰é€‰æ‹©åŒæ­¥? æ¥ä¸‹æ¥çš„è®¡åˆ’ï¼š 1.æ¯å¤©è‡³å°‘2-3é“é¢˜ 2. æ‰‹å†™æ“ä½œç³»ç»Ÿ 3. åšä¸€ä¸ªå®Œæ•´çš„webæœåŠ¡å™¨ 4. å®Œæˆåˆ†å¸ƒå¼è¯¾ç¨‹ 5. å®Œå–„æŠ€æœ¯æ ˆï¼Œé˜…è¯»æºç è¯¸å¦‚redis åˆ·é¢˜ 12.6 ä»Šå¤©æ”¶æ‹¾å±‹å­ç„¶åæŠŠä¸œè¥¿æ¬å›å­¦æ ¡ï¼Œåˆ·é¢˜å…ˆæ¬ ç€ï¼Œæ™šä¸Šæ•´ç†äº†ä¸€ä¸‹é€’å½’çš„æ€è·¯ åˆ·é¢˜ 1- [ ] åˆ·é¢˜ 12.7 åˆ·äº†ä¸€é“é¢˜ 12.8 å‡ºå»ç©äº†ä¸€å¤© 12.9 å­¦ä¹ +å­¦æ ¡ä½œä¸šï¼Œä¸ºå•¥æ€»æ˜¯å¿˜è®°åˆ·é¢˜ï¼Œä»¥åæŠŠåˆ·é¢˜æ”¾åˆ°æ¯å¤©ç¬¬ä¸€ä½ 12.10 åˆ·é¢˜ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„é˜»å¡é˜Ÿåˆ— 12.11 å®Œæˆæ“ä½œç³»ç»Ÿç¯å¢ƒæ­å»º åˆ·é¢˜ 12.14 å†™å­¦æ ¡çš„ä½œä¸šï¼Œå‰ç«¯ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨v0 aiä¸€ä¸ª åˆ·é¢˜ ä»Šå¤©6é“æŠŠå‰ä¸¤å¤©çš„è¡¥ä¸Š 12.15 ä»Šå¤©å‡ºå»ç©äº†ï¼Œå›æ¥å†™äº†ä½œä¸š ç›®å‰æ¬ 6é“ 12.16 åˆ·é¢˜ 12.17 åˆ·é¢˜ 12.18-19 å®Œæˆè¯¾ç¨‹æ²¹æ°”ç”°çš„å‰ç«¯ 12.20-22 å‡ºå»ç© 20251æœˆ1.14 æˆªè‡³ç›®å‰ï¼Œç»è¿‡æ¼«é•¿çš„æœŸæœ«è€ƒè¯•å‡†å¤‡ï¼Œä»¥å…¶ä¸­ä¸€ç§‘60çš„æˆç»©å…¨éƒ¨é€šè¿‡ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æœ€è¿‘ä¸€ç›´å¤´æ™•ï¼Œå»è¿‡åŒ»é™¢ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œéš¾å—ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢ˆæ¤æˆ–è€…è„Šæ¤çš„åŸå›  ç°åœ¨æ¢å¤å­¦ä¹ å§ 1.15 æ„Ÿè§‰æç½®é‚£ä¹ˆä¹…æ²¡æœ‰åˆ·é¢˜ä¹‹å‰ç§¯ç´¯çš„æ€è·¯éƒ½æ²¡äº† åˆ·é¢˜ 1é“ï¼Œæ•´ç†å®Œdfsæ€è·¯ 2æœˆ2.27 æœ€è¿‘éƒ½æ²¡æœ‰å†™æ—¥å¿—ï¼Œå¯’å‡ç¡®å®ä¹Ÿå•¥ä¹Ÿæ²¡åšï¼Œå°±çœ‹äº†ä¸€ç‚¹æ‰‹å†™æ“ä½œç³»ç»Ÿï¼Œç›®å‰æ²¡ä»€ä¹ˆå®ç”¨ï¼ŒæŠ•çš„å­—èŠ‚çš„ç®€å†ä¹Ÿæ²¡è¿‡ï¼Œç°åœ¨å°±å…ˆå‡†å¤‡é¢è¯•ç„¶ååé¢æ‰“ç®—æQT","categories":[{"name":"æ‚è¯´","slug":"æ‚è¯´","permalink":"http://example.com/categories/%E6%9D%82%E8%AF%B4/"}],"tags":[]},{"title":"å¤§ä½œä¸š","slug":"source/æ‚è¯´/å¤§ä½œä¸š","date":"2025-03-01T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2025/03/02/source/æ‚è¯´/å¤§ä½œä¸š/","permalink":"http://example.com/2025/03/02/source/%E6%9D%82%E8%AF%B4/%E5%A4%A7%E4%BD%9C%E4%B8%9A/","excerpt":"","text":"å†³ç­–æ ‘ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465!ls /home/aistudio/data!ls /home/aistudio!mkdir /home/aistudio/external-libraries!pip install beautifulsoup4 -t /home/aistudio/external-librariesimport sys sys.path.append(&#x27;/home/aistudio/external-libraries&#x27;)#åŠ è½½åº“å’Œæ–‡ä»¶import pandas as pd from sklearn.preprocessing import LabelEncoderfrom sklearn.model_selection import train_test_splitfrom sklearn.ensemble import RandomForestClassifierfrom sklearn.metrics import f1_score# è¯»å–æ•°æ®train_data = pd.read_csv(&#x27;train_set.csv&#x27;)test_data = pd.read_csv(&#x27;test_set.csv&#x27;)# åˆ é™¤ç¼ºå¤±å€¼train_data.dropna(inplace=True)test_data.dropna(inplace=True)# ç¼–ç éæ•°å€¼ç‰¹å¾label_encoders = &#123;&#125;for column in train_data.select_dtypes(include=[&#x27;object&#x27;]).columns: if column != &#x27;is_fraud&#x27;: le = LabelEncoder() # åœ¨åˆå¹¶æ•°æ®ä¸Šæ‹Ÿåˆç¼–ç å™¨ä»¥ç¡®ä¿ä¸€è‡´æ€§ combined_data = pd.concat([train_data[column], test_data[column]], axis=0) le.fit(combined_data) train_data[column] = le.transform(train_data[column]) test_data[column] = le.transform(test_data[column]) label_encoders[column] = le # ç‰¹å¾å·¥ç¨‹ï¼šé€‰æ‹©ç›¸å…³ç‰¹å¾features = train_data.drop(&#x27;is_fraud&#x27;, axis=1).columnsX = train_data[features]y = train_data[&#x27;is_fraud&#x27;]# åˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=0.2, random_state=42)# è®­ç»ƒæ¨¡å‹model = RandomForestClassifier(random_state=42)model.fit(X_train, y_train)# é¢„æµ‹éªŒè¯é›†y_pred = model.predict(X_val)# è®¡ç®—F1å€¼f1 = f1_score(y_val, y_pred)print(f&#x27;F1 Score: &#123;f1&#125;&#x27;)# é¢„æµ‹æµ‹è¯•é›†# ç¡®ä¿ç‰¹å¾é¡ºåºä¸€è‡´test_features = test_data[features]# é¢„æµ‹æµ‹è¯•é›†test_predictions = model.predict(test_features)# ç”Ÿæˆç»“æœæ–‡ä»¶output = pd.DataFrame(&#123;&#x27;Index&#x27;: test_data[&#x27;index&#x27;], &#x27;is_fraud&#x27;: test_predictions&#125;)output.to_csv(&#x27;202231060621.csv&#x27;, index=False)F1 Score: 0.7398843930635838 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970# åŠ è½½åº“import pandas as pdfrom sklearn.preprocessing import OrdinalEncoder, StandardScalerfrom sklearn.model_selection import train_test_split, GridSearchCVfrom sklearn.linear_model import LogisticRegressionfrom sklearn.metrics import f1_score# è¯»å–æ•°æ®train_data = pd.read_csv(&#x27;train_set.csv&#x27;)test_data = pd.read_csv(&#x27;test_set.csv&#x27;)# åˆ é™¤ç¼ºå¤±å€¼train_data.dropna(inplace=True)test_data.dropna(inplace=True)# ç¼–ç éæ•°å€¼ç‰¹å¾ordinal_encoders = &#123;&#125;categorical_cols = train_data.select_dtypes(include=[&#x27;object&#x27;]).columns.drop(&#x27;is_fraud&#x27;)for column in categorical_cols: oe = OrdinalEncoder() combined_data = pd.concat([train_data[[column]], test_data[[column]]], axis=0) oe.fit(combined_data) train_data[column] = oe.transform(train_data[[column]]) test_data[column] = oe.transform(test_data[[column]]) ordinal_encoders[column] = oe# ç‰¹å¾å·¥ç¨‹ï¼šé€‰æ‹©ç›¸å…³ç‰¹å¾features = train_data.drop(&#x27;is_fraud&#x27;, axis=1).columnsX = train_data[features]y = train_data[&#x27;is_fraud&#x27;]# ç‰¹å¾ç¼©æ”¾scaler = StandardScaler()X = scaler.fit_transform(X)test_data_scaled = scaler.transform(test_data[features])# åˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†X_train, X_val, y_train, y_val = train_test_split(X, y, test_size=0.2, random_state=42)# ä½¿ç”¨ç½‘æ ¼æœç´¢è°ƒæ•´è¶…å‚æ•°param_grid = &#123; &#x27;C&#x27;: [0.01, 0.1, 1, 10, 100], &#x27;solver&#x27;: [&#x27;liblinear&#x27;, &#x27;saga&#x27;]&#125;grid_search = GridSearchCV(LogisticRegression(random_state=42), param_grid, scoring=&#x27;f1&#x27;, cv=5)grid_search.fit(X_train, y_train)# è¾“å‡ºæœ€ä½³å‚æ•°print(f&#x27;Best Parameters: &#123;grid_search.best_params_&#125;&#x27;)# ä½¿ç”¨æœ€ä½³å‚æ•°è®­ç»ƒæ¨¡å‹best_model = grid_search.best_estimator_best_model.fit(X_train, y_train)# é¢„æµ‹éªŒè¯é›†y_pred = best_model.predict(X_val)# è®¡ç®—F1å€¼f1 = f1_score(y_val, y_pred)print(f&#x27;F1 Score: &#123;f1&#125;&#x27;)# é¢„æµ‹æµ‹è¯•é›†test_predictions = best_model.predict(test_data_scaled)# ç”Ÿæˆç»“æœæ–‡ä»¶output = pd.DataFrame(&#123;&#x27;Index&#x27;: test_data[&#x27;index&#x27;], &#x27;is_fraud&#x27;: test_predictions&#125;)output.to_csv(&#x27;202231060621.csv&#x27;, index=False) 12345678910111213141516171819202122232425262728293031323334from sklearn.ensemble import GradientBoostingClassifierfrom sklearn.model_selection import GridSearchCV, cross_val_score# ä½¿ç”¨Gradient Boostinggb_model = GradientBoostingClassifier(random_state=42)# ç½‘æ ¼æœç´¢ä¼˜åŒ–è¶…å‚æ•°param_grid = &#123; &#x27;n_estimators&#x27;: [100, 200], &#x27;max_depth&#x27;: [3, 5], &#x27;learning_rate&#x27;: [0.01, 0.1]&#125;grid_search = GridSearchCV(gb_model, param_grid, cv=5, scoring=&#x27;f1&#x27;)grid_search.fit(X_train, y_train)# ä½¿ç”¨æœ€ä½³å‚æ•°è®­ç»ƒæ¨¡å‹best_model = grid_search.best_estimator_best_model.fit(X_train, y_train)# éªŒè¯é›†é¢„æµ‹y_pred = best_model.predict(X_val)# è®¡ç®—F1å€¼f1 = f1_score(y_val, y_pred)print(f&#x27;Optimized F1 Score: &#123;f1&#125;&#x27;)# æµ‹è¯•é›†é¢„æµ‹test_predictions = best_model.predict(test_features)# ç”Ÿæˆç»“æœæ–‡ä»¶output = pd.DataFrame(&#123;&#x27;Index&#x27;: test_data[&#x27;index&#x27;], &#x27;is_fraud&#x27;: test_predictions&#125;)output.to_csv(&#x27;optimized_results.csv&#x27;, index=False)","categories":[{"name":"æ‚è¯´","slug":"æ‚è¯´","permalink":"http://example.com/categories/%E6%9D%82%E8%AF%B4/"}],"tags":[]},{"title":"åŠ›æ‰£é¢è¯•50é¢˜","slug":"source/åˆ·é¢˜/leetcode","date":"2024-06-08T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2024/06/09/source/åˆ·é¢˜/leetcode/","permalink":"http://example.com/2024/06/09/source/%E5%88%B7%E9%A2%98/leetcode/","excerpt":"","text":"æ•°ç»„&#x2F;å­—ç¬¦ä¸²88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„éé€’å‡é¡ºåºï¼šä»å°åˆ°å¤§æ’åˆ— 1234è¾“å…¥ï¼šnums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3è¾“å‡ºï¼š[1,2,2,3,5,6]è§£é‡Šï¼šéœ€è¦åˆå¹¶ [1,2,3] å’Œ [2,5,6] ã€‚åˆå¹¶ç»“æœæ˜¯ [1,2,2,3,5,6] æˆ‘çš„ï¼šå…ˆnums2ä¸­æ’å…¥åˆ°nums1ä¸­0çš„ä½ç½® ç„¶åä½¿ç”¨é€‰æ‹©æ’åº 123456789101112131415161718class Solution &#123; //æ’åºpublic: void merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) &#123; for(int i=m;i&lt;m+n;i++)&#123; nums1[i]=nums2[i-m]; &#125; int i,j; for(i=1; i&lt;n+m; i++) &#123; //sort(nums1.begin(), nums1.end()); if(nums1[i]&lt;nums1[i-1]) &#123; int temp=nums1[i]; for(j=i-1; j&gt;=0 &amp;&amp; nums1[j]&gt;temp; j--) &#123; nums1[j+1]=nums1[j]; &#125; nums1[j+1]=temp; &#125; &#125; &#125;&#125;; åŒæŒ‡é’ˆ åˆ©ç”¨ä¸¤ä¸ªæ•°ç»„å·²ç»æœ‰åºï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ¯æ¬¡å–ä¸¤ä¸ªæ•°ç»„ä¸­çš„æœ€å°æ”¾è¿›å» 1234567891011121314151617181920212223class Solution &#123;public: void merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) &#123; int p1 = 0, p2 = 0; int sorted[m + n]; int cur; while (p1 &lt; m || p2 &lt; n) &#123; if (p1 == m) &#123; cur = nums2[p2++]; &#125; else if (p2 == n) &#123; cur = nums1[p1++]; &#125; else if (nums1[p1] &lt; nums2[p2]) &#123; cur = nums1[p1++]; &#125; else &#123; cur = nums2[p2++]; &#125; sorted[p1 + p2 - 1] = cur; &#125; for (int i = 0; i != m + n; ++i) &#123; nums1[i] = sorted[i]; &#125; &#125;&#125;; é€†å‘åŒæŒ‡é’ˆ 0ms é¿å…ä½¿ç”¨ä¸´æ—¶å˜é‡åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä¸ç”¨æ‹…å¿ƒè¦†ç›–nums1çš„é—®é¢˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152//æˆ‘çš„class Solution &#123;public: void merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) &#123; int l=m-1; int j=n-1; int i=m+n-1; while(j&gt;=0)&#123; if(l&gt;=0&amp;&amp;nums1[l]&gt;nums2[j])&#123; nums1[i]=nums1[l]; l--; &#125;else&#123; nums1[i]=nums2[j]; j--; &#125; i--; &#125; &#125;&#125;; class Solution &#123;public: void merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) &#123; int p1 = m - 1, p2 = n - 1; int tail = m + n - 1; int cur; while (p1 &gt;= 0 || p2 &gt;= 0) &#123; if (p1 == -1) &#123; cur = nums2[p2--]; &#125; else if (p2 == -1) &#123; cur = nums1[p1--]; &#125; else if (nums1[p1] &gt; nums2[p2]) &#123; cur = nums1[p1--]; &#125; else &#123; cur = nums2[p2--]; &#125; nums1[tail--] = cur; &#125; &#125;&#125;;class Solution &#123;public: void merge(vector&lt;int&gt;&amp; nums1, int m, vector&lt;int&gt;&amp; nums2, int n) &#123; int left = m - 1, right = n - 1, cur = m + n - 1; while (left &gt;= 0 &amp;&amp; right &gt;= 0) nums1[cur--] = nums1[left] &gt; nums2[right] ? nums1[left--] : nums2[right--]; //&gt;ä¼˜å…ˆçº§å¤§äº= // nums1å‰©ä¸‹çš„å·²ç»æ’åºï¼Œå¯ä»¥è·³è¿‡ while (right &gt;= 0) nums1[cur--] = nums2[right--]; &#125;&#125;; 27 ç§»é™¤å…ƒç´ è¿”å›å‰©ä¸‹çš„å…ƒç´ ä¸ªæ•° 12è¾“å…¥ï¼šnums = [0,1,2,2,3,0,4,2], val = 2è¾“å‡ºï¼š5, nums = [0,1,4,0,3] 0ms 12345678910111213class Solution &#123;public: int removeElement(vector&lt;int&gt;&amp; nums, int val) &#123; vector&lt;int&gt;::iterator it=nums.begin(); for(;it&lt;nums.end();it++)&#123; if(*it==val)&#123; nums.erase(it); it--; &#125; &#125; return nums.size(); &#125;&#125;; æˆ– ä½¿ç”¨åŒæŒ‡é’ˆ 26 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ç»™ä½ ä¸€ä¸ª å‡åºæ’åˆ— çš„æ•°ç»„ nums ï¼Œè¯·ä½ ** åŸåœ°** åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´  åªå‡ºç°ä¸€æ¬¡ ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚å…ƒç´ çš„ ç›¸å¯¹é¡ºåº åº”è¯¥ä¿æŒ ä¸€è‡´ ã€‚ç„¶åè¿”å› nums ä¸­å”¯ä¸€å…ƒç´ çš„ä¸ªæ•°ã€‚ 12345678910111213141516//484ms è¿­ä»£å™¨class Solution &#123;public: int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; vector&lt;int&gt;::iterator it=nums.begin(); for(;it&lt;nums.end()-1;it++)&#123; for(vector&lt;int&gt;::iterator j=(it+1);j&lt;nums.end();j++)&#123; if(*j==*it)&#123; nums.erase(j); j--; &#125; &#125; &#125; return nums.size(); &#125;&#125;; å› ä¸ºæ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥åªéœ€è¦ä»å¤´åˆ°å°¾è¿ç»­çš„ä¸¤ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œè‡³å°‘å‰©ä¸€ä¸ª 1234567891011121314//540msclass Solution &#123;public: int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; vector&lt;int&gt;::iterator it=nums.begin(); for(;it&lt;nums.end()-1;it++)&#123; vector&lt;int&gt;::iterator j=(it+1); if(*j==*it)&#123; nums.erase(j);it--; &#125; &#125; return nums.size(); &#125;&#125;; itâ€“&#x3D;&#x3D;???&#x3D;&#x3D; åŒæŒ‡é’ˆ å°†æœ‰åºçš„æ’åœ¨å‰é¢ï¼Œ på‰qå qå¤–å±‚éå† qæ‰¾åˆ°å’Œqä¸ä¸€æ ·çš„å¤åˆ¶åˆ°pçš„ä¸‹ä¸€ä½ 12345678910111213141516171819//12msclass Solution&#123;public: int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; if(nums.empty()) return 0; int p = 0; int q = 1; while(q &lt; nums.size())&#123; if(nums[p] != nums[q])&#123; if(q - p &gt; 1)&#123; nums[p + 1] = nums[q]; &#125; p++; &#125; q++; &#125; return p + 1; &#125;&#125;; 80 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹â…¡1234567891011121314151617//8msclass Solution &#123;public: int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; vector&lt;int&gt;::iterator it=nums.begin(); vector&lt;int&gt;::iterator j; while(it&lt;nums.end()-2)&#123; j=it+1; if(*j==*it&amp;&amp;*(j+1)==*it)&#123; nums.erase(j); &#125;else&#123; it++; //ä¸ç›¸ç­‰æ‰it++ é˜²æ­¢å¤§äºä¸‰ä¸ªç›¸åŒçš„æ¼æ‰ &#125; &#125; return nums.size(); &#125;&#125;; åŒæŒ‡é’ˆ slowè¡¨ç¤ºå¤„ç†å‡ºçš„æ•°ç»„é•¿åº¦ fastè¡¨ç¤ºå·²ç»æ£€æŸ¥è¿‡çš„é•¿åº¦ 12345678910111213141516171819//0msclass Solution &#123;public: int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; int n = nums.size(); if (n &lt;= 2) &#123; return n; &#125; int slow = 2, fast = 2; //ä»2å¼€å§‹ï¼Œå‰é¢2ä¸ªéƒ½æ˜¯ä¸ç”¨åŠ¨çš„ while (fast &lt; n) &#123; if (nums[slow - 2] != nums[fast]) &#123; //ä¸ç›¸ç­‰å¯ä»¥ä¿å­˜ nums[slow] = nums[fast]; //ä¿å­˜ ++slow; //ä¿å­˜æ•°ç›®+1 &#125; ++fast; //æ£€æŸ¥æ•°ç›®+1 &#125; return slow; &#125;&#125;; åˆ é™¤é‡å¤é¡¹çš„é€šè§£&#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; 1234567891011121314//4msclass Solution &#123;public: int work(vector&lt;int&gt;&amp; nums, int k) &#123; int len = 0; for(auto num : nums) if(len &lt; k || nums[len-k] != num) nums[len++] = num; return len; &#125; int removeDuplicates(vector&lt;int&gt;&amp; nums) &#123; return work(nums, 2); &#125;&#125;; 169 å¤šæ•°å…ƒç´ ç»™å®šå¤§å°ä¸ºnçš„æ•°ç»„ï¼Œè¿”å›å¤šæ•°å…ƒç´ ï¼ˆä¸ªæ•°å¤§äºn&#x2F;2ï¼‰ åˆ©ç”¨ä¸¤ä¸ªå¾ªç¯ æ—¶é—´å¤æ‚åº¦OÂ² ä¼šè¶…æ—¶ 1234567891011121314151617class Solution &#123;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; int max=0; for(int i=0;i&lt;nums.size();i++)&#123; for(int j=i;j&lt;nums.size();j++)&#123; if(nums[j]==nums[i]) max++; if(max&gt;nums.size()/2)&#123; return nums[i]; &#125; &#125; max=0; &#125; return 0; &#125;&#125;; å“ˆå¸Œè¡¨ æˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œæ˜ å°„ï¼ˆHashMapï¼‰æ¥å­˜å‚¨æ¯ä¸ªå…ƒç´ ä»¥åŠå‡ºç°çš„æ¬¡æ•°ã€‚å¯¹äºå“ˆå¸Œæ˜ å°„ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ï¼Œé”®è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ï¼Œå€¼è¡¨ç¤ºè¯¥å…ƒç´ å‡ºç°çš„æ¬¡æ•°ã€‚æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥åœ¨éå†æ•°ç»„ nums æ—¶å€™ä½¿ç”¨æ‰“æ“‚å°çš„æ–¹æ³•ï¼Œç»´æŠ¤æœ€å¤§çš„å€¼ï¼Œè¿™æ ·çœå»äº†æœ€åå¯¹å“ˆå¸Œæ˜ å°„çš„éå†ã€‚&#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; 12345678910111213141516//24ms n n class Solution &#123;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; unordered_map&lt;int, int&gt; counts; //åˆ›å»ºå“ˆå¸Œè¡¨ç»Ÿè®¡å…ƒç´ å‡ºç°çš„æ¬¡æ•° int majority = 0, cnt = 0; //å½“å‰çš„ä¼—æ•° å’Œæ¬¡æ•° for (int num: nums) &#123; ++counts[num]; //å¢åŠ countsä¸­nunå¯¹äºçš„å€¼ if (counts[num] &gt; cnt) &#123; //nunå¯¹äºçš„å€¼å‡ºç°çš„æ¬¡æ•°&gt;å½“å‰ä¼—æ•° æ›´æ–° majority = num; cnt = counts[num]; &#125; &#125; return majority; &#125;&#125;; æ’åº ä»å°åˆ°å¤§æ’åº ä¸‹æ ‡n&#x2F;2å¤„ä¸€å®šä¸ºæ¬¡æ•°å¤šçš„ 12345678//20ms nlogn logn è‡ªå·±ç¼–å†™å †æ’åºO1class Solution &#123;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; sort(nums.begin(), nums.end()); return nums[nums.size() / 2]; &#125;&#125;; éšæœºåŒ– 12345678910111213141516//8ms æœŸæœ›n 1class Solution &#123;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; while (true) &#123; int candidate = nums[rand() % nums.size()]; int count = 0; for (int num : nums) if (num == candidate) ++count; if (count &gt; nums.size() / 2) return candidate; &#125; return -1; &#125;&#125;; åˆ†æ²» æ€è·¯ å¦‚æœæ•° a æ˜¯æ•°ç»„ nums çš„ä¼—æ•°ï¼Œå¦‚æœæˆ‘ä»¬å°† nums åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œé‚£ä¹ˆ a å¿…å®šæ˜¯è‡³å°‘ä¸€éƒ¨åˆ†çš„ä¼—æ•°ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åè¯æ³•æ¥è¯æ˜è¿™ä¸ªç»“è®ºã€‚å‡è®¾ a æ—¢ä¸æ˜¯å·¦åŠéƒ¨åˆ†çš„ä¼—æ•°ï¼Œä¹Ÿä¸æ˜¯å³åŠéƒ¨åˆ†çš„ä¼—æ•°ï¼Œé‚£ä¹ˆ a å‡ºç°çš„æ¬¡æ•°å°‘äº l &#x2F; 2 + r &#x2F; 2 æ¬¡ï¼Œå…¶ä¸­ l å’Œ r åˆ†åˆ«æ˜¯å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†çš„é•¿åº¦ã€‚ç”±äº l &#x2F; 2 + r &#x2F; 2 &lt;&#x3D; (l + r) &#x2F; 2ï¼Œè¯´æ˜ a ä¹Ÿä¸æ˜¯æ•°ç»„ nums çš„ä¼—æ•°ï¼Œå› æ­¤å‡ºç°äº†çŸ›ç›¾ã€‚æ‰€ä»¥è¿™ä¸ªç»“è®ºæ˜¯æ­£ç¡®çš„ã€‚ è¿™æ ·ä»¥æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åˆ†æ²»æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå°†æ•°ç»„åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ±‚å‡ºå·¦åŠéƒ¨åˆ†çš„ä¼—æ•° a1 ä»¥åŠå³åŠéƒ¨åˆ†çš„ä¼—æ•° a2ï¼Œéšååœ¨ a1 å’Œ a2 ä¸­é€‰å‡ºæ­£ç¡®çš„ä¼—æ•°ã€‚ ç®—æ³• æˆ‘ä»¬ä½¿ç”¨ç»å…¸çš„åˆ†æ²»ç®—æ³•é€’å½’æ±‚è§£ï¼Œç›´åˆ°æ‰€æœ‰çš„å­é—®é¢˜éƒ½æ˜¯é•¿åº¦ä¸º 1 çš„æ•°ç»„ã€‚é•¿åº¦ä¸º 1 çš„å­æ•°ç»„ä¸­å”¯ä¸€çš„æ•°æ˜¾ç„¶æ˜¯ä¼—æ•°ï¼Œç›´æ¥è¿”å›å³å¯ã€‚å¦‚æœå›æº¯åæŸåŒºé—´çš„é•¿åº¦å¤§äº 1ï¼Œæˆ‘ä»¬å¿…é¡»å°†å·¦å³å­åŒºé—´çš„å€¼åˆå¹¶ã€‚å¦‚æœå®ƒä»¬çš„ä¼—æ•°ç›¸åŒï¼Œé‚£ä¹ˆæ˜¾ç„¶è¿™ä¸€æ®µåŒºé—´çš„ä¼—æ•°æ˜¯å®ƒä»¬ç›¸åŒçš„å€¼ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬éœ€è¦æ¯”è¾ƒä¸¤ä¸ªä¼—æ•°åœ¨æ•´ä¸ªåŒºé—´å†…å‡ºç°çš„æ¬¡æ•°æ¥å†³å®šè¯¥åŒºé—´çš„ä¼—æ•°ã€‚ 1234567891011121314151617181920212223242526// 40ms nlogn lognclass Solution &#123; int count_in_range(vector&lt;int&gt;&amp; nums, int target, int lo, int hi) &#123; int count = 0; for (int i = lo; i &lt;= hi; ++i) if (nums[i] == target) ++count; return count; &#125; int majority_element_rec(vector&lt;int&gt;&amp; nums, int lo, int hi) &#123; if (lo == hi) return nums[lo]; int mid = (lo + hi) / 2; int left_majority = majority_element_rec(nums, lo, mid); int right_majority = majority_element_rec(nums, mid + 1, hi); if (count_in_range(nums, left_majority, lo, hi) &gt; (hi - lo + 1) / 2) return left_majority; if (count_in_range(nums, right_majority, lo, hi) &gt; (hi - lo + 1) / 2) return right_majority; return -1; &#125;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; return majority_element_rec(nums, 0, nums.size() - 1); &#125;&#125;; boyer-moore æŠ•ç¥¨ç®—æ³• æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå€™é€‰ä¼—æ•° candidate å’Œå®ƒå‡ºç°çš„æ¬¡æ•° countã€‚count ä¸º 0ï¼› æˆ‘ä»¬éå†æ•°ç»„ nums ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´  xï¼Œåœ¨åˆ¤æ–­ x ä¹‹å‰ï¼Œå¦‚æœ count çš„å€¼ä¸º 0ï¼Œæˆ‘ä»¬å…ˆå°† x çš„å€¼èµ‹äºˆ candidateï¼Œéšåæˆ‘ä»¬åˆ¤æ–­ xï¼š å¦‚æœ x ä¸ candidate ç›¸ç­‰ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ count çš„å€¼å¢åŠ  1ï¼›å¦‚æœ x ä¸ candidate ä¸ç­‰ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ count çš„å€¼å‡å°‘ 1ã€‚ åœ¨éå†å®Œæˆåï¼Œcandidate å³ä¸ºæ•´ä¸ªæ•°ç»„çš„ä¼—æ•°ã€‚ 123456789101112//16 n 1class Solution &#123;public: int majorityElement(vector&lt;int&gt;&amp; nums) &#123; int x = 0, votes = 0; for (int num : nums)&#123; if (votes == 0) x = num; votes += num == x ? 1 : -1; //å¦‚æœnum=x +1 else -1 &#125; return x; &#125;&#125;; 189 è½®è½¬æ•°ç»„ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³è½®è½¬ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚ ä½¿ç”¨å¦ä¸€ä¸ªæ•°ç»„è¾…åŠ© 12345678910111213//28msclass Solution &#123;public: void rotate(vector&lt;int&gt;&amp; nums, int k) &#123; int a=nums.size(); vector&lt;int&gt; nums2(a); for(int i=0;i&lt;a;i++)&#123; int j=(i+k)%a; nums2[j]=nums[i]; &#125; nums=nums2; &#125;&#125;; ç¯çŠ¶æ›¿æ¢ ä¸€ä¸ªä¸´æ—¶å˜é‡x xä¿å­˜0+kä½ 0+kä½&#x3D;0ä½ 0ä½&#x3D;x xä¿å­˜(0+2k)%nä½ (0+2k)%nä½&#x3D;0ä½ ä¸€ç›´å¾ªç¯ï¼Œå›åˆ°0ä½ï¼Œä½†ä¸èƒ½ä¿è¯å…¨éƒ¨éƒ½è½®äº†ï¼Œè¦æœ‰ä¸€ä¸ªè®¡æ•°å™¨è®¡æ•°æ²¡æœ‰å®Œä¸‹ä¸€è½®ä»1ä½å¼€å§‹ &#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; 123456789101112131415161718//40msclass Solution &#123;public: void rotate(vector&lt;int&gt;&amp; nums, int k) &#123; int n = nums.size(); k = k % n; int count = gcd(k, n); //æœ€å¤§å…¬çº¦æ•° for (int start = 0; start &lt; count; ++start) &#123; int current = start; int prev = nums[start]; do &#123; int next = (current + k) % n; swap(nums[next], prev); current = next; &#125; while (start != current); &#125; &#125;&#125;; æ•°ç»„ç¿»è½¬ æˆ‘ä»¬å¯ä»¥å…ˆå°†æ‰€æœ‰å…ƒç´ ç¿»è½¬ï¼Œè¿™æ ·å°¾éƒ¨çš„ k%nä¸ªå…ƒç´ å°±è¢«ç§»è‡³æ•°ç»„å¤´éƒ¨ï¼Œç„¶åæˆ‘ä»¬å†ç¿»è½¬ [0,k%nâˆ’1] åŒºé—´çš„å…ƒç´ å’Œ [k%n,nâˆ’1] åŒºé—´çš„å…ƒç´ å³èƒ½å¾—åˆ°æœ€åçš„ç­”æ¡ˆã€‚ 123456789101112131415161718//28msclass Solution &#123;public: void reverse(vector&lt;int&gt;&amp; nums, int start, int end) &#123; while (start &lt; end) &#123; swap(nums[start], nums[end]); start += 1; end -= 1; &#125; &#125; void rotate(vector&lt;int&gt;&amp; nums, int k) &#123; k %= nums.size(); reverse(nums, 0, nums.size() - 1); reverse(nums, 0, k - 1); reverse(nums, k, nums.size() - 1); &#125;&#125;; 121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ ä½ åªèƒ½é€‰æ‹© æŸä¸€å¤© ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­ å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚ è¦åœ¨ä¸€æ¡çº¿ä¸Šæ‰¾è·¨åº¦æœ€å¤§çš„ï¼Œç›´æ¥ç”¨åé¢æ•°å­—-å‰é¢çš„çœ‹è°æœ€å¤§n^2 ç›´æ¥è¶…æ—¶ 123456789101112131415161718class Solution &#123;public: int maxProfit(vector&lt;int&gt;&amp; prices) &#123; int temp=0; int n=prices.size(); for(int i=0;i&lt;n;i++)&#123; for(int j=i+1;j&lt;n;j++)&#123; if(prices[i]-prices[j]&lt;temp) temp=prices[i]-prices[j]; &#125; &#125; if(temp&lt;0)&#123; return -1*temp; &#125;else&#123; return 0; &#125; &#125;&#125;; n åŠ¨æ€è§„åˆ’ 123456789101112131415161718192021//96msclass Solution &#123;public: int maxProfit(vector&lt;int&gt;&amp; prices) &#123; int n = prices.size(); if (n &lt;= 1) return 0; int maxProfit = 0; int minPrice = prices[0]; for (int i = 1; i &lt; n; i++) &#123; if (prices[i] &lt; minPrice) minPrice = prices[i]; else if (prices[i] - minPrice &gt; maxProfit) maxProfit = prices[i] - minPrice; &#125; return maxProfit; &#125;&#125;; for(i:)ä¸­iæ˜¯ä¸€ä¸ªä»€ä¹ˆå¯¹è±¡ï¼Ÿ ###122 ä¹°è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºâ…¡ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ prices ï¼Œå…¶ä¸­ prices[i] è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ&#x2F;æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ åŒä¸€å¤© å‡ºå”®ã€‚ è¿”å› ä½ èƒ½è·å¾—çš„ æœ€å¤§ åˆ©æ¶¦ ã€‚ ç¤ºä¾‹ 1ï¼š 12345è¾“å…¥ï¼šprices = [7,1,5,3,6,4]è¾“å‡ºï¼š7è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚ éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6 - 3 = 3 ã€‚ æ€»åˆ©æ¶¦ä¸º 4 + 3 = 7 ã€‚ ç›¸å½“äºå°±æ˜¯æ±‚æ‰€æœ‰èƒ½çš„åˆ©æ¶¦ 1234567891011121314151617180msclass Solution &#123;public: int maxProfit(vector&lt;int&gt;&amp; prices) &#123; int sum=0; int n=prices.size(); int a=prices[0]; for(int i=1;i&lt;n;i++)&#123; if(prices[i]&gt;a)&#123; sum+=prices[i]-a; a=prices[i]; &#125;else&#123; a=prices[i]; &#125; &#125; return sum; &#125;&#125;; ###55 è·³è·ƒæ¸¸æˆ ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ nums ï¼Œä½ æœ€åˆä½äºæ•°ç»„çš„ ç¬¬ä¸€ä¸ªä¸‹æ ‡ ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šnums = [2,3,1,1,4]è¾“å‡ºï¼štrueè§£é‡Šï¼šå¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»ä¸‹æ ‡ 0 åˆ°è¾¾ä¸‹æ ‡ 1, ç„¶åå†ä»ä¸‹æ ‡ 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼šnums = [3,2,1,0,4]è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ— è®ºæ€æ ·ï¼Œæ€»ä¼šåˆ°è¾¾ä¸‹æ ‡ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä¸‹æ ‡çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä¸‹æ ‡ã€‚ 123456789101112//60msclass Solution &#123;public: bool canJump(vector&lt;int&gt;&amp; nums) &#123; int k = 0; //åˆ°è¾¾çš„æœ€å¤§ä¸‹æ ‡ for (int i = 0; i &lt; nums.size(); i++) &#123; if (i &gt; k) return false; //åˆ°ä¸åˆ°è¿™ä¸ªi k = max(k, i + nums[i]);//i + nums[i]åœ¨ä¸‹æ ‡iåŸºç¡€ä¸Šè·³å¤šå°‘ &#125; return true; &#125;&#125;; ###45 è·³è·ƒæ¸¸æˆâ…¡ è¿”å›åˆ°è¾¾ nums[n - 1] çš„æœ€å°è·³è·ƒæ¬¡æ•°ã€‚ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥åˆ°è¾¾ nums[n - 1]ã€‚ ä¸‹æ ‡0çš„ä½ç½®ï¼Œå¦‚æœèƒ½è·³åˆ°ä¸‹æ ‡1ï¼Œ2ï¼Œè¿™æ˜¯æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šæˆ‘ä»¬åº”è¯¥è·³åˆ°å“ªä¸€ä¸ªï¼Œè€Œåº”è¯¥è¿›è¡Œä¸€æ¬¡é€‰æ‹©ï¼Œå¦‚æœä¸‹æ ‡1èƒ½è·³3æ ¼ï¼Œä¹Ÿå°±æ˜¯èƒ½åˆ°è¾¾1+3&#x3D;4çš„ä½ç½®ï¼Œä¸‹æ ‡2åªèƒ½è·³ä¸€æ ¼ï¼Œåªèƒ½åˆ°è¾¾2+1&#x3D;3çš„ä½ç½®ï¼Œè¿™æ˜¯æˆ‘ä»¬å°±åº”è¯¥é€‰æ‹©é¦–å…ˆè·³åˆ°ä¸‹æ ‡1ï¼Œå¹¶ä¸”è®°å½•æ­¥æ•°çš„å˜é‡+1 ä»£ç è¡¨ç¤º 12345678int j = start + nums[start];for (int i = start + 1; i &lt;= j &amp;&amp; i &lt;= end; i++) &#123; if ((nums[i] + i) &gt; Dmax) &#123; Dmax = nums[i] + i; //æœ€è¿œè·ç¦» start = i; //èµ·è·³ç‚¹æ›´æ–° &#125;&#125; count++; ç®—æ³•å†™å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç¨‹åºåº”è¯¥æ˜¯ï¼šæŠŠç®—æ³•æ”¾è¿›whileå¾ªç¯ä¸­ï¼Œç»“æŸæ¡ä»¶æ˜¯å…¶è·ç¦»èƒ½åˆ°è¾¾æœ€åä¸€ä½ 12345678910111213141516171819//12msint jump(vector&lt;int&gt;&amp; nums) &#123; int end = nums.size() - 1; if (end == 0) return 0; int count = 0; int Dmax = nums[0]; int start = 0; while (Dmax &lt; end) &#123; int j = start + nums[start]; for (int i = start + 1; i &lt;= j &amp;&amp; i &lt;= end; i++) &#123; if ((nums[i] + i) &gt; Dmax) &#123; Dmax = nums[i] + i; start = i; &#125; &#125; count++; &#125; return count+1;&#125; ###274 H æŒ‡æ•° ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ citations ï¼Œå…¶ä¸­ citations[i] è¡¨ç¤ºç ”ç©¶è€…çš„ç¬¬ i ç¯‡è®ºæ–‡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚è®¡ç®—å¹¶è¿”å›è¯¥ç ”ç©¶è€…çš„ h æŒ‡æ•°ã€‚ æ ¹æ®ç»´åŸºç™¾ç§‘ä¸Š h æŒ‡æ•°çš„å®šä¹‰ï¼šh ä»£è¡¨â€œé«˜å¼•ç”¨æ¬¡æ•°â€ ï¼Œä¸€åç§‘ç ”äººå‘˜çš„ h æŒ‡æ•° æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰è‡³å°‘å‘è¡¨äº† h ç¯‡è®ºæ–‡ï¼Œå¹¶ä¸”æ¯ç¯‡è®ºæ–‡ è‡³å°‘ è¢«å¼•ç”¨ h æ¬¡ã€‚å¦‚æœ h æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œh æŒ‡æ•° æ˜¯å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚ ç¤ºä¾‹ 1ï¼š 1234è¾“å…¥ï¼šcitations = [3,0,6,1,5]è¾“å‡ºï¼š3 è§£é‡Šï¼šç»™å®šæ•°ç»„è¡¨ç¤ºç ”ç©¶è€…æ€»å…±æœ‰ 5 ç¯‡è®ºæ–‡ï¼Œæ¯ç¯‡è®ºæ–‡ç›¸åº”çš„è¢«å¼•ç”¨äº† 3, 0, 6, 1, 5 æ¬¡ã€‚ ç”±äºç ”ç©¶è€…æœ‰ 3 ç¯‡è®ºæ–‡æ¯ç¯‡ è‡³å°‘ è¢«å¼•ç”¨äº† 3 æ¬¡ï¼Œå…¶ä½™ä¸¤ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨ ä¸å¤šäº 3 æ¬¡ï¼Œæ‰€ä»¥å¥¹çš„ h æŒ‡æ•°æ˜¯ 3ã€‚ ç¤ºä¾‹ 2ï¼š 12è¾“å…¥ï¼šcitations = [1,3,1]è¾“å‡ºï¼š1 ä»å¤§åˆ°å°éå†ï¼ŒHæŒ‡æ•°ä»å¤§åˆ°å°åˆ¤æ–­ï¼Œå†…å±‚éå†å¦‚æœä¸æ»¡è¶³æŒ‡æ•°çš„æ•°ç›®è¿‡å¤šåˆ™Hâ€“é‡æ–°åˆ¤æ–­ 1234567891011121314151617//32msclass Solution &#123;public: int hIndex(vector&lt;int&gt;&amp; citations) &#123; for(int i=citations.size()-1;i&gt;=0;i--)&#123; int count=citations.size(); for(int j=0;j&lt;citations.size();j++)&#123; if(citations[j]&lt;i+1) count--; if(count&lt;=i) break; &#125; if(count&gt;=i+1)&#123; return i+1; &#125; &#125; return 0; &#125;&#125;; å®˜æ–¹ï¼šå…ˆæ’åº hå’Œiå‘ä¸­é—´é æ‹¢ï¼Œä¸€æ¬¡å¾ªç¯æ„å‘³ç€ä¸€ç¯‡æ–‡ç« h++æ¬¡ï¼Œæœ€åè‡³å°‘hç¯‡hæ¬¡ 123456789101112class Solution &#123;public: int hIndex(vector&lt;int&gt;&amp; citations) &#123; sort(citations.begin(), citations.end()); int h = 0, i = citations.size() - 1; while (i &gt;= 0 &amp;&amp; citations[i] &gt; h) &#123; h++; i--; &#125; return h; &#125;&#125;; äºŒåˆ†&#x3D;&#x3D;ï¼Ÿï¼Ÿï¼Ÿ&#x3D;&#x3D; é¦–å…ˆï¼Œå®šä¹‰å·¦å³ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘æ•°ç»„çš„é¦–å°¾ï¼Œç„¶åå–ä¸­é—´å€¼ï¼Œå¹¶è®¡ç®—å¤§äºæˆ–ç­‰äºä¸­é—´å€¼çš„å…ƒç´ ä¸ªæ•°ã€‚å¦‚æœè¿™ä¸ªæ•°å¤§äºæˆ–ç­‰äºä¸­é—´å€¼ï¼Œé‚£ä¹ˆå°†å·¦æŒ‡é’ˆç§»åŠ¨åˆ°ä¸­é—´å€¼ï¼Œåä¹‹ï¼Œå°†å³æŒ‡é’ˆç§»åŠ¨åˆ°ä¸­é—´å€¼å‡1ã€‚è¿™æ ·ï¼Œæ¯æ¬¡å¾ªç¯åï¼Œæœç´¢åŒºé—´å°±ä¼šå‡åŠï¼Œæœ€ç»ˆä¼šæ‰¾åˆ°HæŒ‡æ•°ã€‚ 12345678910111213141516171819202122232425class Solution &#123;public: int hIndex(vector&lt;int&gt;&amp; citations) &#123; int left=0,right=citations.size(); int mid=0,cnt=0; while(left&lt;right)&#123; // +1 é˜²æ­¢æ­»å¾ªç¯ mid=(left+right+1)&gt;&gt;1; cnt=0; for(int i=0;i&lt;citations.size();i++)&#123; if(citations[i]&gt;=mid)&#123; cnt++; &#125; &#125; if(cnt&gt;=mid)&#123; // è¦æ‰¾çš„ç­”æ¡ˆåœ¨ [mid,right] åŒºé—´å†… left=mid; &#125;else&#123; // è¦æ‰¾çš„ç­”æ¡ˆåœ¨ [0,mid) åŒºé—´å†… right=mid-1; &#125; &#125; return left; &#125;&#125;; ###238 é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¿”å› æ•°ç»„ answer ï¼Œå…¶ä¸­ answer[i] ç­‰äº nums ä¸­é™¤ nums[i] ä¹‹å¤–å…¶ä½™å„å…ƒç´ çš„ä¹˜ç§¯ ã€‚ é¢˜ç›®æ•°æ® ä¿è¯ æ•°ç»„ numsä¹‹ä¸­ä»»æ„å…ƒç´ çš„å…¨éƒ¨å‰ç¼€å…ƒç´ å’Œåç¼€çš„ä¹˜ç§¯éƒ½åœ¨ 32 ä½ æ•´æ•°èŒƒå›´å†…ã€‚ è¯· **ä¸è¦ä½¿ç”¨é™¤æ³•ï¼Œ**ä¸”åœ¨ O(*n*) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ­¤é¢˜ã€‚ 12345678910111213141516171819202122//è¶…æ—¶class Solution &#123;public: vector&lt;int&gt; productExceptSelf(vector&lt;int&gt;&amp; nums) &#123; //äºŒåˆ† int left,right; vector&lt;int&gt; nums2(nums.size(),1);//å…¨éƒ¨èµ‹ä¸º1ï¼Œä¸ç”¨newç©ºé—´ for(int mid=0;mid&lt;nums.size();mid++)&#123; left=0;right=nums.size()-1; while(left&lt;mid)&#123; nums2[mid]*=nums[left]; left++; &#125; while(right&gt;mid)&#123; nums2[mid]*=nums[right]; right--; &#125; &#125; return nums2;//è¦ç”³è¯·ç©ºé—´æ‰èƒ½è¿”å›æ•°ç»„ &#125;&#125;;//æ”¹è¿›:å¯ä»¥é¢å¤–å¼€è¾Ÿä¸€ä¸ªæ•°ç»„,å…ˆè®°å½•å·¦è¾¹æ¯ä¸€ä½ç´¯ä¹˜çš„,å†è®°å½•å³è¾¹æ¯ä¸€ä½ç´¯ä¹˜çš„s,è¿™æ ·å°±ä¸ä¼šè¶…æ—¶äº† ä¸Šä¸‰è§’ä¸‹ä¸‰è§’æ³• B[i]&#x3D;å¯¹åº”è¡Œä¹˜ç§¯ è¿”å›Bæ•°ç»„ å…ˆç®—ä¸‹ä¸‰è§’ ex:B[2]&#x3D;B[1]*A[1] for (int i &#x3D; 1; i &lt; len; i++) { ans[i] &#x3D; ans[i - 1] * nums[i - 1];} å†ç®—ä¸Šä¸‰è§’ ex: ans *&#x3D;(temp*nums) 12345678910111213141516171819//20msclass Solution &#123;public: vector&lt;int&gt; productExceptSelf(vector&lt;int&gt;&amp; nums) &#123; int len = nums.size(); if (len == 0) return &#123;&#125;; vector&lt;int&gt; ans(len, 1); ans[0] = 1; int tmp = 1; for (int i = 1; i &lt; len; i++) &#123; ans[i] = ans[i - 1] * nums[i - 1]; &#125; for (int i = len - 2; i &gt;= 0; i--) &#123; tmp *= nums[i + 1]; ans[i] *= tmp; &#125; return ans; &#125;&#125;; 134 åŠ æ²¹ç«™åœ¨ä¸€æ¡ç¯è·¯ä¸Šæœ‰ n ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ gas[i] å‡ã€‚ ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»ç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ cost[i] å‡ã€‚ä½ ä»å…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚ ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ gas å’Œ cost ï¼Œå¦‚æœä½ å¯ä»¥æŒ‰é¡ºåºç»•ç¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›å‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å› -1 ã€‚å¦‚æœå­˜åœ¨è§£ï¼Œåˆ™ ä¿è¯ å®ƒæ˜¯ å”¯ä¸€ çš„ã€‚ ç¤ºä¾‹ 1: 12345678910è¾“å…¥: gas = [1,2,3,4,5], cost = [3,4,5,1,2]è¾“å‡º: 3è§£é‡Š:ä» 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯è·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›åˆ° 3 å·åŠ æ²¹ç«™ã€‚å› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚ 123456789101112131415161718192021222324252627//112msclass Solution &#123;public: int canCompleteCircuit(vector&lt;int&gt;&amp; gas, vector&lt;int&gt;&amp; cost) &#123; int n=gas.size(); int m=cost.size(); vector&lt;int&gt;temp(n); auto it=temp.begin(); int min =0; int sum=0,index,l=0; for(int i=0,j=0;i&lt;n&amp;&amp;j&lt;m;i++,j++)&#123; (*it)=gas[i]-cost[j]; sum+=(*it); if(sum&lt;min)&#123; //minè®°å½•æœ€å°æ²¹é‡æ—¶åˆ»ï¼ˆè´Ÿæ²¹æœ€å¤šï¼‰ï¼Œå®ƒä¹‹åå°±æ˜¯å‡ºå‘ç‚¹ min=sum; index=i+1; &#125; ++it; &#125; if(sum&lt;0)&#123; return -1; &#125; if(min&gt;=0) return 0; //&gt;0æ˜¯å¤šè§£æƒ…å†µï¼Œä»0å¼€å§‹èµ°éƒ½å¯ä»¥ return index%n; &#125;&#125;; 12345678910111213141516171819202122//ç®€åŒ–ï¼Œä½†æ˜¯è€—æ—¶æ›´å¤šï¼Ÿclass Solution &#123;public: int canCompleteCircuit(vector&lt;int&gt;&amp; gas, vector&lt;int&gt;&amp; cost) &#123; int n=gas.size(); int min =0; int sum=0,index; for(int i=0;i&lt;n;i++)&#123; sum+=gas[i]-cost[i]; if(sum&lt;min)&#123; // min=sum; index=i+1; &#125; &#125; if(sum&lt;0)&#123; return -1; &#125; if(min&gt;=0) return 0; return index%n; &#125;&#125;; 135 åˆ†å‘ç³–æœn ä¸ªå­©å­ç«™æˆä¸€æ’ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ ratings è¡¨ç¤ºæ¯ä¸ªå­©å­çš„è¯„åˆ†ã€‚ ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ï¼Œç»™è¿™äº›å­©å­åˆ†å‘ç³–æœï¼š æ¯ä¸ªå­©å­è‡³å°‘åˆ†é…åˆ° 1 ä¸ªç³–æœã€‚ ç›¸é‚»ä¸¤ä¸ªå­©å­è¯„åˆ†æ›´é«˜çš„å­©å­ä¼šè·å¾—æ›´å¤šçš„ç³–æœã€‚ è¯·ä½ ç»™æ¯ä¸ªå­©å­åˆ†å‘ç³–æœï¼Œè®¡ç®—å¹¶è¿”å›éœ€è¦å‡†å¤‡çš„ æœ€å°‘ç³–æœæ•°ç›® ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šratings = [1,2,2]è¾“å‡ºï¼š4è§£é‡Šï¼šä½ å¯ä»¥åˆ†åˆ«ç»™ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå­©å­åˆ†å‘ 1ã€2ã€1 é¢—ç³–æœã€‚ç¬¬ä¸‰ä¸ªå­©å­åªå¾—åˆ° 1 é¢—ç³–æœï¼Œè¿™æ»¡è¶³é¢˜é¢ä¸­çš„ä¸¤ä¸ªæ¡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647//840ms æ¯æ¬¡ä¸¤ä¸ªéå†int candy(vector&lt;int&gt;&amp; ratings) &#123; int all = 0; auto it = ratings.begin(); int temp1 = 0,temp2=0; for (; it != ratings.end(); ++it) &#123; int b = 0,c=0; if (it + 1 != ratings.end() &amp;&amp; *(it) &gt; *(it + 1)) &#123;//æ³¨æ„ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸çŸ¥é“åä¸€ä½æ˜¯å¦æ¯”åä¸¤ä½å¤§ int count = 2; auto j = it+1; while (j+1!=ratings.end()&amp;&amp; (*j) &gt; *(j + 1)) &#123; j++; count++; &#125; temp1 = count; b = 1; &#125; if (it != ratings.begin() &amp;&amp; *(it) &gt; *(it - 1)) &#123; int count = 2; auto j = it-1; while (j != ratings.begin() &amp;&amp; (*j) &gt; *(j - 1)) &#123; j--; count++; &#125; temp2 = count; c = 1; &#125; if (b == 0&amp;&amp;c==0) &#123; all += 1; &#125; else if (b == 1&amp;&amp;c==1) &#123; if (temp1 &gt;= temp2) &#123; all += temp1; &#125; else &#123; all += temp2; &#125; &#125; else if(b==0)&#123; all += temp2; &#125; else &#123; all += temp1; &#125; &#125; return all;&#125; 1234567891011121314151617181920212223242526//ä¼˜åŒ–ç‰ˆæœ¬16msclass Solution &#123;public: int candy(vector&lt;int&gt;&amp; ratings) &#123; int n = ratings.size(); vector&lt;int&gt; candies(n, 1); // åˆå§‹åŒ–æ¯ä¸ªå­©å­è‡³å°‘æœ‰ä¸€ä¸ªç³–æœ // ä»å·¦åˆ°å³éå†ï¼Œä¿è¯å³è¾¹è¯„åˆ†æ›´é«˜çš„å­©å­è·å¾—æ›´å¤šç³–æœ for (int i = 1; i &lt; n; ++i) &#123; if (ratings[i] &gt; ratings[i - 1]) &#123; candies[i] = candies[i - 1] + 1; &#125; &#125; // ä»å³åˆ°å·¦éå†ï¼Œä¿è¯å·¦è¾¹è¯„åˆ†æ›´é«˜çš„å­©å­è·å¾—æ›´å¤šç³–æœï¼ŒåŒæ—¶è€ƒè™‘ä¸¤è¾¹éƒ½è¯„åˆ†æ›´é«˜çš„æƒ…å†µ for (int i = n - 2; i &gt;= 0; --i) &#123; if (ratings[i] &gt; ratings[i + 1]) &#123; candies[i] = max(candies[i], candies[i + 1] + 1); &#125; &#125; // è®¡ç®—æ€»ç³–æœæ•°é‡ int total = 0; for (int i = 0; i &lt; n; ++i) &#123; total += candies[i]; &#125; return total; &#125; &#125;; 12345678910111213141516171819202122232425//12ms ,ä¸å¥½æƒ³class Solution &#123;public: int candy(vector&lt;int&gt;&amp; ratings) &#123; int n = ratings.size(); int ret = 1; int inc = 1, dec = 0, pre = 1; for (int i = 1; i &lt; n; i++) &#123; if (ratings[i] &gt;= ratings[i - 1]) &#123; dec = 0;//å‡ºç°å¤§äºï¼Œ-åºåˆ—å½’0 pre = ratings[i] == ratings[i - 1] ? 1 : pre + 1;//ç›¸ç­‰=1ï¼Œå‰ä¸€ä¸ª+1 ret += pre;//æ€»ç³– inc = pre;//é€’å¢åºåˆ— &#125; else &#123; dec++;//é€’å‡åºåˆ— if (dec == inc) &#123;//å¢åºåˆ—=å‡åºåˆ—æ—¶æ˜¯ç‰¹æ®Šç‚¹ dec++; &#125; ret += dec; pre = 1; &#125; &#125; return ret; &#125;&#125;; åŒæŒ‡é’ˆæ ¸å¿ƒæ€æƒ³ï¼šåˆ›å»ºä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘å¤´ï¼Œä¸€ä¸ªæŒ‡å°¾ï¼Œæ ¹æ®æ¡ä»¶éå† 15 ä¸‰æ•°ä¹‹å’Œç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ [nums[i], nums[j], nums[k]] æ»¡è¶³ i != jã€i != k ä¸” j != k ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ nums[i] + nums[j] + nums[k] == 0 ã€‚è¯· ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚ **æ³¨æ„ï¼š**ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚ ç¤ºä¾‹ 1ï¼š 12345678è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]è§£é‡Šï¼šnums[0] + nums[1] + nums[2] = (-1) + 0 + 1 = 0 ã€‚nums[1] + nums[2] + nums[4] = 0 + 1 + (-1) = 0 ã€‚nums[0] + nums[3] + nums[4] = (-1) + 2 + (-1) = 0 ã€‚ä¸åŒçš„ä¸‰å…ƒç»„æ˜¯ [-1,0,1] å’Œ [-1,-1,2] ã€‚æ³¨æ„ï¼Œè¾“å‡ºçš„é¡ºåºå’Œä¸‰å…ƒç»„çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚ éš¾ç‚¹ï¼šå»é™¤é‡å¤ -1 0 1 å’Œ 0 1 -1 å±äºé‡å¤çš„ æ‰€ä»¥å…ˆæ’åºå†å»é™¤é‡å¤éå† 1234567891011121314151617181920212223242526272829303132333435363738//108msclass Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; threeSum(vector&lt;int&gt;&amp; nums) &#123; vector&lt;vector&lt;int&gt;&gt; ans; if(nums.size()&lt;3) return ans; sort(nums.begin(), nums.end()); if(nums[0]&gt;0) return ans; int i = 0; while(i&lt;nums.size())&#123; int left = i+1, right = nums.size()-1; while(left&lt; right)&#123; int y = nums[i]; int x = nums[left]; int z = nums[right]; if(x + y &gt;0-z)//zåå¤§ right--; else if(x + y &lt;0-z) left++; else&#123; ans.push_back(&#123;nums[i], nums[left], nums[right]&#125;); // ç›¸åŒçš„leftå’Œrightä¸åº”è¯¥å†æ¬¡å‡ºç°ï¼Œå› æ­¤è·³è¿‡ while(left&lt;right&amp;&amp;nums[left]==nums[left+1]) left++; while(left&lt;right&amp;&amp;nums[right] == nums[right-1]) right--; left++; right--; &#125; &#125; // é¿å…nums[i]ä½œä¸ºç¬¬ä¸€ä¸ªæ•°é‡å¤å‡ºç° while(i+1&lt;nums.size()&amp;&amp;nums[i] == nums[i+1]) i++; i++; &#125; return ans; &#125;&#125;; ##æ»‘åŠ¨çª—å£ åŒæŒ‡é’ˆçš„åŸºç¡€ä¸Šï¼Œåƒä¸€ä¸ªçª—å£ä¸€æ ·æ»‘åŠ¨éå† 209 é•¿åº¦æœ€å°çš„å­æ•°ç»„ç»™å®šä¸€ä¸ªå«æœ‰ n ä¸ªæ­£æ•´æ•°çš„æ•°ç»„å’Œä¸€ä¸ªæ­£æ•´æ•° target ã€‚ æ‰¾å‡ºè¯¥æ•°ç»„ä¸­æ»¡è¶³å…¶æ€»å’Œå¤§äºç­‰äº target çš„é•¿åº¦æœ€å°çš„ è¿ç»­å­æ•°ç»„ [numsl, numsl+1, ..., numsr-1, numsr] ï¼Œå¹¶è¿”å›å…¶é•¿åº¦**ã€‚**å¦‚æœä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å› 0 ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼štarget = 7, nums = [2,3,1,2,4,3]è¾“å‡ºï¼š2è§£é‡Šï¼šå­æ•°ç»„ [4,3] æ˜¯è¯¥æ¡ä»¶ä¸‹çš„é•¿åº¦æœ€å°çš„å­æ•°ç»„ã€‚ ä»å­æ•°ç»„é•¿åº¦éå†ï¼Œä»1å¼€å§‹ï¼Œå­æ•°ç»„é•¿åº¦è¶Šé•¿æ—¶é—´è¶Šé•¿ è¿˜æœ‰ä¸€ç§ï¼šéå†æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ åœ¨å…¶åŸºç¡€ä¸Šä»1å¼€å§‹ 1234567891011121314151617181920212223//è¶…æ—¶int minSubArrayLen(int target, vector&lt;int&gt;&amp; nums) &#123; int n = nums.size(); int count = 1; while (count &lt;= n) &#123; for (int i = 0; i &lt; n; i++) &#123; int temp = 0; int j = i; while (j&lt;n) &#123; if (j - i &lt;= count - 1) &#123; temp += nums[j]; &#125; else &#123; break; &#125; j++; &#125; if (temp &gt;= target) return count; &#125; count++; &#125; return 0;&#125; æ»‘åŠ¨çª—å£æ³•ï¼šå®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œå’Œä¸€ä¸ªä¸´æ—¶å˜é‡ç”¨æ¥ä¿å­˜æœ€å°çš„å­æ•°ç»„é•¿åº¦ å¼€å§‹lå’Œrä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘å¼€å¤´ï¼ŒåŒºé—´å†…å’Œå°äºæŒ‡å®šå€¼åˆ™rå³ç§»ï¼ŒåŒºé—´å’Œå¤§äºæŒ‡å®šå€¼åˆ™ä¿å­˜é•¿åº¦ä¸”lå·¦ç§»ï¼Œå¯»æ‰¾åé¢æ˜¯å¦æœ‰æ›´çŸ­çš„æ•°ç»„ 12345678910111213141516171819202122class Solution &#123;public: int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123; int n = nums.size(); if (n == 0) &#123; return 0; &#125; int ans = INT_MAX; int start = 0, end = 0; int sum = 0; while (end &lt; n) &#123; sum += nums[end]; while (sum &gt;= s) &#123; ans = min(ans, end - start + 1); sum -= nums[start]; start++; &#125; end++; &#125; return ans == INT_MAX ? 0 : ans; &#125;&#125;; 123456789101112131415161718192021222324//12msclass Solution &#123;public: int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123; int minLen = numeric_limits&lt;int&gt;::max();//æ›´å¿«ï¼ï¼ï¼å¾ˆå¤š int curSum = 0; int start = 0; for (int end = 0; end &lt; nums.size(); end++) &#123; //add current number curSum += nums[end]; // check if the current sum &gt;= s while (curSum &gt;= s) &#123; minLen = min(minLen, end - start + 1); curSum = curSum - nums[start]; start = start + 1; &#125; &#125; return minLen == numeric_limits&lt;int&gt;::max() ? 0 : minLen; &#125;&#125;; çŸ©é˜µ###36 æœ‰æ•ˆçš„æ•°ç‹¬ è¯·ä½ åˆ¤æ–­ä¸€ä¸ª 9 x 9 çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦ æ ¹æ®ä»¥ä¸‹è§„åˆ™ ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ æ•°å­— 1-9 åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„ 3x3 å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ï¼ˆè¯·å‚è€ƒç¤ºä¾‹å›¾ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344//20msclass Solution &#123;public: bool isValidSudoku(vector&lt;vector&lt;char&gt;&gt;&amp; board) &#123; for(int i=0;i&lt;9;i++)&#123; for(int j=0;j&lt;9;j++)&#123; if(isdigit(board[i][j]))&#123; for(int k=0;k&lt;9;k++)&#123; if(k!=j&amp;&amp;board[i][k]==board[i][j])&#123; return false; &#125; &#125; for(int k=0;k&lt;9;k++)&#123; if(k!=i&amp;&amp;board[k][j]==board[i][j])&#123; return false; &#125; &#125; int temp1=0; if(i&gt;5)&#123; temp1=6; &#125;else if(i&gt;2)&#123; temp1=3; &#125;else&#123; temp1=0; &#125; int temp2=0; if(j&gt;5)&#123; temp2=6; &#125;else if(j&gt;2)&#123; temp2=3; &#125;else&#123; temp2=0; &#125; for(int k=temp1;k&lt;temp1+3;k++)&#123; for(int l=temp2;l&lt;temp2+3;l++)&#123; if(k!=i&amp;&amp;l!=j&amp;&amp;board[k][l]==board[i][j]) return false; &#125; &#125; &#125; &#125; &#125; return true; &#125;&#125;; å› ä¸ºéƒ½æ˜¯æ•°å­—ï¼Œç”¨æ•°ç»„ä»£æ›¿å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥å»ºç«‹ä¸‰ä¸ªæ•°ç»„ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„ 12345678910111213141516171819//0msclass Solution &#123;public: bool isValidSudoku(vector&lt;vector&lt;char&gt;&gt;&amp; board) &#123; // äºŒç»´æ•°ç»„ vï¼Œå…±æœ‰ 27 è¡Œï¼Œæ¯è¡Œæœ‰ 128 ä¸ªå…ƒç´ ï¼Œåˆå§‹å€¼éƒ½ä¸º 0 int v[27][128] = &#123;0&#125;;//ä¸ºå•¥128ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ //å‰é¢9è¡Œç”¨äºå­˜æ¯ä¸€è¡Œå‡ºç°çš„æ•°å­—æ¬¡æ•°ï¼Œä¸­é—´9è¡Œå­˜æ¯ä¸€åˆ—ï¼Œæœ€å9è¡Œå­˜å°ä¹å®«æ ¼ for(int i = 0; i &lt; 9; ++i) &#123; for(int j = 0; j &lt; 9; ++j) &#123; if(isdigit(board[i][j]) &amp;&amp; (v[i][board[i][j]]++ || v[9+j][board[i][j]]++ || v[18+(i/3)+(j/3)*3][board[i][j]]++)) &#123; // è‹¥å‡ºç°é‡å¤æ•°å­—-åŠ åˆ°2é€€å‡ºï¼Œè¿”å› false é™¤æ³•æ˜¯èˆå°¾çš„ï¼Œæ¯è¡Œä¸€ä¸ªå°ä¹å®«ï¼Œç«–ç€ä¾æ¬¡ return false; &#125; &#125; &#125; return true; &#125;&#125;; å“ˆå¸Œè¡¨ä½¿ç”¨unordered_map 205åŒæ„å­—ç¬¦ä¸²1234567891011121314151617class Solution &#123;public: bool isIsomorphic(string s, string t) &#123; unordered_map&lt;char, char&gt; s2t; unordered_map&lt;char, char&gt; t2s; int len = s.length(); for (int i = 0; i &lt; len; ++i) &#123; char x = s[i], y = t[i]; if ((s2t.count(x) &amp;&amp; s2t[x] != y) || (t2s.count(y) &amp;&amp; t2s[y] != x)) &#123; return false; &#125; s2t[x] = y; t2s[y] = x; &#125; return true; &#125;&#125;; 383 èµé‡‘ä¿¡ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼šransomNote å’Œ magazine ï¼Œåˆ¤æ–­ ransomNote èƒ½ä¸èƒ½ç”± magazine é‡Œé¢çš„å­—ç¬¦æ„æˆã€‚ å¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™è¿”å› false ã€‚ magazine ä¸­çš„æ¯ä¸ªå­—ç¬¦åªèƒ½åœ¨ ransomNote ä¸­ä½¿ç”¨ä¸€æ¬¡ã€‚ åªéœ€è¦ç»Ÿè®¡æ¯ä¸€ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼ŒransomNoteé‡Œé¢çš„éƒ½è¦&lt;&#x3D;magazine 12345678910111213141516171819class Solution &#123;public: bool canConstruct(string ransomNote, string magazine) &#123; if (ransomNote.size() &gt; magazine.size()) &#123; return false; &#125; vector&lt;int&gt; cnt(26); //ç”¨int cnt[26]=&#123;0&#125;;æ›´å¿« for (auto &amp; c : magazine) &#123; //çŸ¥é“ç±»å‹çš„æƒ…å†µä¸‹ï¼Œcharæ¯”autoå¿« cnt[c - &#x27;a&#x27;]++; //a æ”¾åˆ°0çš„ä½ç½®ä¾æ¬¡ &#125; for (auto &amp; c : ransomNote) &#123; cnt[c - &#x27;a&#x27;]--; if (cnt[c - &#x27;a&#x27;] &lt; 0) &#123; return false; &#125; &#125; return true; &#125;&#125;; ###128 æœ€é•¿è¿ç»­åºåˆ— ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚ è¯·ä½ è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šnums = [100,4,200,1,3,2]è¾“å‡ºï¼š4è§£é‡Šï¼šæœ€é•¿æ•°å­—è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚ æ’åº-&gt;éå†,ä¸‹ä¸€ä¸ªæ˜¯å‰ä¸€ä½+1ç»§ç»­,éå†çš„ä¸‹ä¸€ä½æ˜¯ä¸æ˜¯å‰ä¸€ä½+1 O(n) å“ˆå¸Œè¡¨ O(1) æ ˆstk å›æº¯-ä¸€ç§é€’å½’æ€è·¯ç±»ä¼¼æ·±åº¦ä¼˜å…ˆ 17 ç”µè¯å·ç çš„å­—æ¯ç»„åˆmyideaï¼šç”¨äºŒç»´æ•°ç»„å­˜å‚¨æ˜ å°„å…³ç³»ï¼Œä¸‹æ ‡ä¸ºæ•°å­— 123456789101112131415161718192021222324252627282930313233343536class Solution &#123;public: vector&lt;string&gt; letterCombinations(string digits) &#123; vector&lt;string&gt; combinations;//å­˜å‚¨æ‰€æœ‰å­—æ¯ç»„åˆ if (digits.empty()) &#123; return combinations; &#125; unordered_map&lt;char, string&gt; phoneMap&#123;//å“ˆå¸Œè¡¨å­˜å‚¨æ˜ å°„å…³ç³» &#123;&#x27;2&#x27;, &quot;abc&quot;&#125;, &#123;&#x27;3&#x27;, &quot;def&quot;&#125;, &#123;&#x27;4&#x27;, &quot;ghi&quot;&#125;, &#123;&#x27;5&#x27;, &quot;jkl&quot;&#125;, &#123;&#x27;6&#x27;, &quot;mno&quot;&#125;, &#123;&#x27;7&#x27;, &quot;pqrs&quot;&#125;, &#123;&#x27;8&#x27;, &quot;tuv&quot;&#125;, &#123;&#x27;9&#x27;, &quot;wxyz&quot;&#125; &#125;; string combination;//ä¸´æ—¶å­—æ¯ç»„åˆ backtrack(combinations, phoneMap, digits, 0, combination); return combinations; &#125; void backtrack(vector&lt;string&gt;&amp; combinations, const unordered_map&lt;char, string&gt;&amp; phoneMap, const string&amp; digits, int index, string&amp; combination) &#123; if (index == digits.length()) &#123; combinations.push_back(combination); &#125; else &#123; char digit = digits[index];//è·å–å½“å‰å­—æ•°å­— const string&amp; letters = phoneMap.at(digit);//å½“å‰æ•°å­—å¯¹åº”çš„å­—æ¯ for (const char&amp; letter: letters) &#123; combination.push_back(letter); backtrack(combinations, phoneMap, digits, index + 1, combination);//é€’å½’ combination.pop_back(); &#125; &#125; &#125;&#125;; 12345678910111213141516171819202122class Solution &#123; string MAPPING[10] = &#123;&quot;&quot;, &quot;&quot;, &quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;, &quot;jkl&quot;, &quot;mno&quot;, &quot;pqrs&quot;, &quot;tuv&quot;, &quot;wxyz&quot;&#125;;public: vector&lt;string&gt; letterCombinations(string digits) &#123; int n = digits.length();//æ•°å­—é•¿åº¦ if (n == 0) return &#123;&#125;; vector&lt;string&gt; ans; string path(n, 0); // ä¸´æ—¶å­˜å‚¨å’Œå­—æ¯ç»„åˆ function&lt;void(int)&gt; dfs = [&amp;](int i) &#123; if (i == n) &#123; ans.emplace_back(path);//ä¸€èˆ¬ç”¨äºä¸åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œæ­¤å¤„ç”¨push_backæ•ˆæœä¸€æ · return;//å‡ºå£ &#125; for (char c : MAPPING[digits[i] - &#x27;0&#x27;]) &#123;//char-&gt;int,éå†è¯¥æ•°å­—å¯¹åº”çš„æ¯ä¸ªå­—ç¬¦ path[i] = c; // ç›´æ¥è¦†ç›– dfs(i + 1);//é€’å½’ &#125; &#125;; dfs(0);//è°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥i=0 return ans; &#125;&#125;; function&lt;void(int)&gt; dfs = [&amp;](int i)ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º dfs çš„å‡½æ•°å¯¹è±¡ï¼Œå…¶å‚æ•°ç±»å‹ä¸º intï¼Œè¿”å›ç±»å‹ä¸º voidã€‚å®ƒä½¿ç”¨äº† Lambda è¡¨è¾¾å¼ &amp; æ•è·äº†å½“å‰ä½œç”¨åŸŸå†…çš„æ‰€æœ‰å˜é‡ï¼Œè¿™æ ·å¯ä»¥è®¿é—®å¤–éƒ¨çš„å˜é‡ã€‚ æ€»ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥çš„æ•°å­—å­—ç¬¦ä¸² digits è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å­—æ¯ç»„åˆï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ ans ä¸­ã€‚ 77 ç»„åˆæ¯”ä¸Šä¸€é¢˜å¤šä¸€æ­¥ï¼Œå°±æ˜¯è§£å†³é‡å¤çš„ç»„åˆ ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å›èŒƒå›´ [1, n] ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚ä½ å¯ä»¥æŒ‰ ä»»ä½•é¡ºåº è¿”å›ç­”æ¡ˆã€‚ 12345678910è¾“å…¥ï¼šn = 4, k = 2è¾“å‡ºï¼š[ [2,4], [3,4], [2,3], [1,2], [1,3], [1,4],] 12345678910111213141516171819202122232425class Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; combine(int n, int k) &#123; if(n==0) return&#123;&#125;; vector&lt;int&gt; nums(n); for(int i=0;i&lt;n;i++)&#123; nums[i]=i+1; &#125; vector&lt;vector&lt;int&gt;&gt; ans; vector&lt;int&gt; path(k); function&lt;void(int, int)&gt; dfs = [&amp;](int start, int i) &#123; if(i==k)&#123; ans.push_back(path); return ; &#125; for(int j = start; j &lt; nums.size(); j++)&#123; path[i] = nums[j]; dfs(j + 1, i + 1); &#125; &#125;; dfs(0, 0); return ans; &#125;&#125;; 46 å…¨æ’åˆ—ä¼ ç»Ÿå›æº¯ä¼šæœ‰é‡å¤æƒ…å†µ,ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ ‡è®°æ˜¯å¦å·²ç»è¢«æ ‡è®°ï¼Œé€’å½’å®Œåè¦å›æº¯æ ‡è®°ä¸ºfalse 1234567891011121314151617181920212223242526class Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; permute(vector&lt;int&gt;&amp; nums) &#123; int n = nums.size(); if (n == 0) return &#123;&#125;; vector&lt;int&gt; temp(n); vector&lt;vector&lt;int&gt;&gt; ans; vector&lt;bool&gt; used(n, false); // è®°å½•æ•°å­—æ˜¯å¦è¢«ä½¿ç”¨è¿‡ function&lt;void(int)&gt; dfs = [&amp;](int i) &#123; if (i == n) &#123; ans.push_back(temp); return; &#125; for (int j = 0; j &lt; n; ++j) &#123; if (!used[j]) &#123; temp[i] = nums[j]; used[j] = true; dfs(i + 1); used[j] = false; // å›æº¯ï¼Œæ¢å¤çŠ¶æ€ &#125; &#125; &#125;; dfs(0); return ans; &#125;&#125;;","categories":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/categories/%E5%88%B7%E9%A2%98/"}],"tags":[]},{"title":"14å±Šè“æ¡¥æ¯c/c++bç»„","slug":"source/åˆ·é¢˜/è“æ¡¥æ¯åˆ·é¢˜","date":"2024-06-08T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2024/06/09/source/åˆ·é¢˜/è“æ¡¥æ¯åˆ·é¢˜/","permalink":"http://example.com/2024/06/09/source/%E5%88%B7%E9%A2%98/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98/","excerpt":"","text":"æ˜Ÿè¿ªçš„æ°”åœºè®¡ç®—å¾ªç¯è¯»å…¥å­—ç¬¦ä¸²ï¼Œå•å­—ç¬¦ä¸²æ’åˆ—ï¼Œéå†å­—ç¬¦ä¸²ï¼Œå­—ç¬¦è®¡ç®— 123456789101112131415161718192021222324252627282930313233#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std;bool compareChars(const char&amp; a, const char&amp; b) &#123; return a &lt; b;&#125;int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n; cin &gt;&gt; n; vector&lt;string&gt; a; for (int i = 0; i &lt; n; i++) &#123; string name; cin &gt;&gt; name; a.push_back(name); //å­—ç¬¦ä¸²ä»å°åˆ°å¤§æ’åºã€‚éå† sort(name.begin(), name.end(), compareChars); int count = 1; int all = 0; for (string::const_iterator it = name.begin(); it != name.end(); ++it) &#123; all += (*it - 96) * count; count++; &#125; cout &lt;&lt; all &lt;&lt; endl; &#125; return 0;&#125; æ•°å­—è½¬æ¢æ•´æ•°è½¬å­—ç¬¦ä¸² string str&#x3D;to_string(n); å­—ç¬¦ä¸²é•¿åº¦ï¼šstr.length(); å­—ç¬¦ä¸²è½¬æ•´æ•°ï¼šint n&#x3D;stoi(str); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;bool isIncreasing(int n) &#123; string str_n = to_string(n); // å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸² // æ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦ä»£è¡¨çš„æ•°å€¼ for (size_t i = 0; i &lt; str_n.length() - 1; ++i) &#123; if (str_n[i] &gt;= str_n[i + 1]) &#123; return false; // å¦‚æœå½“å‰å­—ç¬¦ä¸å°äºä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™ä¸æ˜¯é€’å¢çš„ &#125; &#125; return true; // æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯é€’å¢çš„ &#125;bool exchange(int n) &#123; string str = to_string(n); int j = str.length(); if (j == 1) &#123; cout &lt;&lt;n&lt;&lt;endl; &#125;else if (j == 2) &#123; if (str[0] &lt; str[1]) &#123; cout &lt;&lt; n &lt;&lt; endl; return true; &#125; else &#123; int temp = str[0]; str[0] = str[1]; str[1] = temp; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; &#125;else &#123; //ä»å·¦åˆ°å³éå†ä¸¤éï¼Œæ¯æ¬¡æ¯”è¾ƒä¸‰ä¸ªï¼Œæœ€å°çš„åœ¨ç¬¬ä¸‰ä½äº¤æ¢ä¸¤æ¬¡ç»“æŸï¼Œæœ€å°çš„åœ¨ç¬¬äºŒä½äº¤æ¢ä¸€æ¬¡ï¼Œå†æ¬¡éå† //é‡åˆ°232ç»“æ„å…ˆä¸æ…Œï¼Œç»§ç»­æ‰¾321ç»“æ„ï¼Œæ²¡æœ‰å°±å›æ»š for (int i = 0; i &lt; j-2; i++) &#123; if (str[i + 2] &lt; str[i] &amp;&amp; str[i + 2] &lt; str[i + 1]) &#123; int temp1 = str[i]; str[i] = str[i + 2]; str[i + 2] = str[i + 1]; str[i + 1] = temp1; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; else if (str[i + 1] &lt; str[i] &amp;&amp; str[i + 1] &lt; str[i + 2]) &#123; int temp = str[i]; if (str[i] &lt;= str[i + 2]) &#123; str[i] = str[i + 1]; str[i + 1] = temp; &#125; else &#123; str[i] = str[i + 1]; str[i + 1] = str[i + 2]; str[i + 2] = temp; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; &#125; &#125; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125;&#125;int main()&#123; int number; cin &gt;&gt; number; if (isIncreasing(number)) &#123; //ä¸äº¤æ¢ cout &lt;&lt; number&lt;&lt; endl; &#125; else &#123; exchange(number); &#125; return 0;&#125; 01ä¸²çš„ç†µè®¡ç®—å¯¹æ•°ï¼š #include log2(a) æ¯”è¾ƒæµ®ç‚¹æ•°ï¼š fabs(res - 11625907.5798) &lt; 0.0001 1234567891011121314151617181920#include &lt;iostream&gt;#include &lt;cmath&gt;using namespace std;int main()&#123; int n = 23333333; for (int i = 1; i &lt; n; ++i) &#123; double a = i * 1.0 / n; // 0å‡ºç°çš„å æ¯” double b = (n - i) * 1.0 / n; // 1å‡ºç°çš„å æ¯” double res = 0; res -= a * log2(a) * i + b * log2(b) * (n - i); if (fabs(res - 11625907.5798) &lt; 0.0001) &#123; cout &lt;&lt; i &lt;&lt; endl; break; &#125; &#125; return 0;&#125; å†¶ç‚¼é‡‘å±äºŒç»´æ•°ç»„ï¼š vector&lt;vector&gt; num(n, vector(2)); 1234567891011121314151617181920212223242526272829303132333435363738394041#include &lt;iostream&gt;#include &lt;vector&gt;//#include &lt;algorithm&gt;using namespace std;int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n; cin &gt;&gt; n; vector&lt;vector&lt;int&gt;&gt; num(n, vector&lt;int&gt;(2)); int a[2] = &#123;0&#125;; for (int i = 0; i &lt; n; i++) &#123; int j; cin &gt;&gt; j; int k; cin &gt;&gt; k; num[i][0] = j; num[i][1] = k; int temp = j / k; if (temp &lt; a[1]) &#123; a[1] = temp; &#125; if (i == 0) &#123; a[1] = temp; &#125; &#125; int k = a[1]; int flag = 0; while (k != 0) &#123; k--; for (int i = 0; i &lt; n; i++) &#123; if (num[i][0] / k != num[i][0] / a[1]) &#123; a[0] = k + 1; flag = 1; break; &#125; &#125; if (flag == 1) &#123; break; &#125; &#125; cout &lt;&lt; a[0] &lt;&lt; &quot; &quot; &lt;&lt; a[1] &lt;&lt; endl; return 0;&#125; é£æœºé™è½ä¸€ç§å¾ˆå¥½çš„å¾ªç¯ç»“æ„ int T;cin &gt;&gt; T; while (T--)&#123;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;// åˆ›å»ºé£æœºç»“æ„ä½“å˜é‡struct plane&#123; int t, d, l;&#125;;bool vis[15]; // trueè¡¨ç¤ºé£æœºé™è½ï¼Œfalseè¡¨ç¤ºé£æœºæœªé™è½bool flag; // æ ‡è®°æ˜¯å¦å…¨éƒ¨å®‰å…¨é™è½vector&lt;plane&gt; p(15);// æ·±æœvoid dfs(int m, int cnt, int last) // lastè¡¨ç¤ºæ­¤å‰æ‰€æœ‰é£æœºé™è½æ‰€éœ€çš„å•ä½æ—¶é—´&#123; if (cnt == m) &#123; flag = true; return; &#125; for (int i = 0; i &lt; m; i++) &#123; if (!vis[i] &amp;&amp; p[i].t + p[i].d &gt;= last) // åªæœ‰æ¥çš„æ—¶åˆ»+ç›˜æ—‹æ—¶é—´ &gt; last çš„é£æœºæ‰å¯ä»¥å®‰å…¨é™è½ &#123; vis[i] = true; dfs(m, cnt + 1, max(last, p[i].t) + p[i].l); vis[i] = false; &#125; &#125;&#125;int main()&#123; int T; cin &gt;&gt; T; while (T--) &#123; int N; cin &gt;&gt; N; for (int i = 0; i &lt; N; ++i) cin &gt;&gt; p[i].t &gt;&gt; p[i].d &gt;&gt; p[i].l; flag = false; dfs(N, 0, 0); if (flag) cout &lt;&lt; &quot;YES&quot; &lt;&lt; endl; else cout &lt;&lt; &quot;NO&quot; &lt;&lt; endl; &#125; return 0;&#125; æ¥é¾™é—®é¢˜è¯»å­—ç¬¦ä¸²ï¼šé‡ç©ºæ ¼å°±ä¼šåœ å­—ç¬¦ä¸²è½¬æ•°å­—ï¼šint x &#x3D; s[0] - â€˜0â€™, y &#x3D; s[s.size() - 1] - â€˜0â€™; åŠ¨æ€è§„åˆ’DPï¼šé‡å å­é—®é¢˜ï¼Œæœ€ä¼˜å­ç»“æ„é—®é¢˜(é€’å½’) ç›®çš„ï¼šæ‰¾æœ€é•¿çš„æ¥é¾™æ•°åˆ— å…³ç³»ï¼šä»åå¾€å‰çœ‹ï¼Œç¬¬iä¸ªæ•°çš„æœ€é•¿å­åºåˆ—æ•°ä¸ºä»¥ç¬¬iä¸ªæ•°çš„é¦–ä½ä¸ºå°¾æ•°çš„é‚£ä¸ªæ•°çš„æœ€é•¿åºåˆ—+1 ç”¨ä¸€ä¸ªæ•°ç»„æ¥dp[i]è¡¨ç¤ºä»¥iä¸ºå°¾æ•°å­—çš„æœ€é•¿åºåˆ— xè¡¨ç¤ºé¦–ä½ï¼Œyè¡¨ç¤ºå°¾æ•° dp[y]&#x3D;max(dp[x]+1,dp[y]); nè®°å½•æœ€å¤§çš„å­åºåˆ—n&#x3D;max(dp[y],n); 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;int dp[10];int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n; cin &gt;&gt; n; string s; int m = 0; for (int i = 0; i &lt; n; ++i) &#123; cin &gt;&gt; s; int x = s[0] - &#x27;0&#x27;, y = s[s.size() - 1] - &#x27;0&#x27;; dp[y] = max(dp[x] + 1, dp[y]); m = max(m, dp[y]); &#125; cout &lt;&lt; n - m &lt;&lt; endl; return 0;&#125; å²›å±¿ä¸ªæ•°vector&lt;vector&gt; data(m + 2, vector(n + 2, â€˜0â€™)); äºŒç»´å…¨éƒ¨èµ‹0 æ·±åº¦ä¼˜å…ˆDFS 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;int deltaOfSea[8][2] = &#123;&#123;-1, -1&#125;,&#123;-1, 0&#125;,&#123;-1, 1&#125;,&#123;0, 1&#125;,&#123;1, 1&#125;,&#123;1, 0&#125;,&#123;1, -1&#125;,&#123;0, -1&#125;&#125;;//ä¸€æ ¼çš„å…«ä¸ªæ–¹å‘int deltaOfIsland[4][2] = &#123;&#123;-1, 0&#125;,&#123;1, 0&#125;,&#123;0, -1&#125;,&#123;0, 1&#125;&#125;;//å››ä¸ªæ–¹å‘int ans = 0;void DFS_Island(vector&lt;vector&lt;char&gt;&gt;&amp; data, int r, int c, int m, int n)&#123; data[r][c] = &#x27;N&#x27;; for(int i = 0; i &lt; 4; ++i)&#123;//å²›åªçœ‹å››ä¸ªæ–¹å‘ int newR = r + deltaOfIsland[i][0]; int newC = c + deltaOfIsland[i][1]; if(newR &gt;= 0 &amp;&amp; newR &lt; m &amp;&amp; newC &gt;= 0 &amp;&amp; newC &lt; n)&#123; if(data[newR][newC] == &#x27;1&#x27;) DFS_Island(data, newR, newC, m, n); &#125; &#125;&#125;void DFS_Sea(vector&lt;vector&lt;char&gt;&gt;&amp; data, int r, int c, int m, int n)&#123; data[r][c] = &#x27;N&#x27;; //r cè®°å½•å½“å‰è®¿é—®çš„ä½ç½® Nè®°ä½œå·²ç»è®¿é—® for(int i = 0; i &lt; 8; ++i)&#123;//éå†å½“å‰ä½ç½®çš„8ä¸ªæ–¹å‘ int newR = r + deltaOfSea[i][0]; int newC = c + deltaOfSea[i][1]; if(newR &gt;= 0 &amp;&amp; newR &lt; m &amp;&amp; newC &gt;= 0 &amp;&amp; newC &lt; n)&#123;//å½“å‰ç›¸é‚»å•å…ƒæ ¼æœ‰æ•ˆ if(data[newR][newC] == &#x27;1&#x27;)&#123; DFS_Island(data, newR, newC, m, n);//æ‰¾å²›å±¿ ++ans; &#125; else if(data[newR][newC] == &#x27;0&#x27;)&#123; DFS_Sea(data, newR, newC, m, n); &#125; &#125; &#125;&#125;int main()&#123; int t; cin &gt;&gt; t; vector&lt; vector&lt;vector&lt;char&gt;&gt; &gt; datas;//ç”¨ä¸‰ç»´å­˜å‚¨æ¯ä¸€ä¸ªäºŒç»´ for(int i = 0; i &lt; t; ++i)&#123; int m, n; cin &gt;&gt; m &gt;&gt; n; vector&lt;vector&lt;char&gt;&gt; data(m + 2, vector&lt;char&gt;(n + 2, &#x27;0&#x27;)); //æ‰©å±•ä¸€åœˆ0ï¼Œé˜²æ­¢éå†ä¸å®Œï¼Œå¯ä»¥ for(int r = 1; r &lt; m + 1; ++r)&#123; for(int c = 1; c &lt; n + 1; ++c)&#123; cin &gt;&gt; data[r][c]; &#125; &#125; datas.push_back(data); &#125; for(int i = 0; i &lt; t; ++i)&#123; vector&lt;vector&lt;char&gt;&gt; data = datas[i]; int m = data.size(); int n = data[0].size(); DFS_Sea(data, 0, 0, m, n); cout &lt;&lt; ans &lt;&lt; endl; ans = 0; &#125; return 0;&#125; å­—ä¸²ç®€å†™æ­£å¸¸æš´åŠ›åªèƒ½è§£å†³70% æ€è·¯ï¼šæ­£å‘ç»Ÿè®¡aæ•°ç›®ï¼Œé‡åˆ°båˆ™å°†ä¹‹å‰ç»Ÿè®¡çš„é•¿åº¦åŠ åˆ°ansä¸Š 123456789101112131415#include &lt;bits/stdc++.h&gt; using namespace std;int K;long long ans=0,c1_sum=0;string S;char c1,c2;int main()&#123; cin&gt;&gt;K&gt;&gt;S&gt;&gt;c1&gt;&gt;c2; for(int i=K-1,j=0;i&lt;S.length();i++,j++)&#123; if(S[j]==c1) c1_sum++; if(S[i]==c2) ans+=c1_sum; &#125; cout&lt;&lt;ans; return 0;&#125; æ•´æ•°åˆ é™¤#include æ‰¾æœ€å€¼ï¼Œæ’åº 12345678910111213141516171819202122232425262728293031323334353637//30%#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std;int main() &#123; int n,k; cin &gt;&gt; n&gt;&gt;k; vector&lt;int&gt; a; for (int i = 0; i &lt; n; i++) &#123; int temp; cin &gt;&gt; temp; a.push_back(temp); &#125; for (int i = 0; i &lt; k; i++) &#123; auto minelement = min_element(a.begin(), a.end()); int min = *minelement; for (vector&lt;int&gt;::iterator it = a.begin(); it != a.end(); ++it) &#123; if (*it == min) &#123; vector&lt;int&gt;::iterator prev = it; vector&lt;int&gt;::iterator next = it; if (it != a.begin()) &#123; --prev; *prev += min; &#125; ++next; if (next != a.end()) &#123; *next += min; &#125; a.erase(it); break; &#125; &#125; &#125; for (int i:a) &#123; cout &lt;&lt; i &lt;&lt; &#x27; &#x27;; &#125; return 0;&#125; 1234567891011121314151617181920212223242526272829#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;int main() &#123; int n, k; std::cin &gt;&gt; n &gt;&gt; k; std::vector&lt;int&gt; a(n); for (int i = 0; i &lt; n; ++i) &#123; std::cin &gt;&gt; a[i]; &#125; for (int i = 0; i &lt; k; ++i) &#123; auto minIt = std::min_element(a.begin(), a.end());// int minIndex = std::distance(a.begin(), minIt);//è¿™ä¸¤å¤„æ¯æ¬¡éœ€è¦éå†æ‰¾å¾ˆæµªè´¹ int min = *minIt; if (minIndex &gt; 0) &#123; a[minIndex - 1] += min; &#125; if (minIndex &lt; n - 1) &#123; a[minIndex + 1] += min; &#125; a.erase(a.begin() + minIndex);//è´¹æ—¶é—´ &#125; for (int i : a) &#123; std::cout &lt;&lt; i &lt;&lt; &#x27; &#x27;; &#125; return 0;&#125; ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ç»´æŠ¤å…ƒç´ å’Œç´¢å¼•ï¼Œlogæ—¶é—´å†…æ‰¾æœ€å°å€¼ æ›´æ–°åçš„å…ƒç´ å’Œç´¢å¼•æ”¾å…¥å †ä¸­ï¼Œæœ€å°å€¼è¢«æ ‡è®°ä¸ºINT_MAX å£°æ˜ä¼˜å…ˆé˜Ÿåˆ— priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;,greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç±»å‹ä¸ºpairï¼Œé€‰æ‹©vectorå®¹å™¨ï¼Œæ¯”è¾ƒå™¨greaterï¼Œå‡½æ•°å¯¹è±¡ï¼ŒæŒ‰&gt;è¿ç®—ç¬¦ï¼Œé¡¶éƒ¨(æœ€å°)æœ‰æœ€å¤§çš„æƒé‡ï¼Œæ²¡æœ‰æ¯”è¾ƒå™¨é»˜è®¤é¡¶éƒ¨æœ€å°æƒé‡ æ’å…¥æ•°æ® pq.push(&#123; a[i], i &#125;); å–æ•°æ® auto [min, minIndex] = pq.top(); ç§»é™¤é¡¶éƒ¨å…ƒç´  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;queue&gt;#include &lt;functional&gt;#include &lt;climits&gt;using namespace std;int main() &#123; int n, k; cin &gt;&gt; n &gt;&gt; k; vector&lt;int&gt; a(n); priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; vector&lt;int&gt; c(n); vector&lt;int&gt; d(n); vector&lt;int&gt; nums(n, 0); for (int i = 0; i &lt; n; ++i) &#123; cin &gt;&gt; a[i]; pq.push(&#123; a[i], i &#125;); c[i] = i - 1; d[i] = i + 1; &#125; //åˆ›å»ºä¸¤ä¸ªæ•°ç»„å®æ—¶æ›´æ–°æ¯ä¸ªæ•°å·¦å³æœ€è¿‘çš„ä¸‹æ ‡ï¼Œæ›´æ–°å †çš„æ—¶å€™å°±èƒ½å¿«é€Ÿå®šä½åˆ°äº† //ä¸€ä¸ªæ•°ç»„ç”¨æ¥è®°å½•å½“å‰æ•°æ®ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå‡ºæ ˆä¸€æ¬¡åˆ™ä¿®æ”¹æ¬¡æ•°-1 while (k-- &gt; 0 &amp;&amp; !pq.empty()) &#123; auto [min, minIndex] = pq.top(); cout &lt;&lt; min &lt;&lt; &#x27; &#x27; &lt;&lt; minIndex &lt;&lt; endl; pq.pop(); if (nums[minIndex]==0) &#123; //åˆ é™¤ int temp1 = c[minIndex]; int temp2 = d[minIndex]; if (temp1 != -1) &#123; a[temp1] += min; d[temp1] = temp2; pq.push(&#123; a[temp1], temp1 &#125;);//æ›´æ–° nums[temp1]++;//ä¿®æ”¹æ¬¡æ•°+1 &#125; if (temp2 != n) &#123; a[temp2] += min; c[temp2] = temp1; pq.push(&#123; a[temp2], temp2 &#125;); nums[temp2]++; &#125; // æ ‡è®°æœ€å°å…ƒç´ ä¸ºå·²å¤„ç† a[minIndex] = INT_MAX; &#125; else if (nums[minIndex] != 0) &#123; //ä¿®æ”¹æ¬¡æ•°-1 k++; nums[minIndex]--; &#125; &#125; // è¾“å‡ºæœªè¢«æ ‡è®°ä¸ºå·²å¤„ç†çš„å…ƒç´  for (int i = 0; i &lt; n; ++i) &#123; if (a[i] != INT_MAX) &#123; cout &lt;&lt; a[i] &lt;&lt; &#x27; &#x27;; &#125; &#125; return 0;&#125; æ™¯åŒºå¯¼æ¸¸LCAï¼šæœ€è¿‘å…¬å…±ç¥–å…ˆ æš´åŠ›ï¼šä¸€å±‚ä¸€å±‚è·³ï¼Œlcaï¼šå€å¢ DFSï¼šæ·±åº¦ä¼˜å…ˆæœç´¢root-&gt;a BFS:å¹¿åº¦ä¼˜å…ˆ a-bçš„è·ç¦»&#x3D;root-&gt;a+root-&gt;b-2*root-&gt;lca 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;typedef long long ll;const int N = 1e5 + 100;//10^5+100int n, k;int deep[N]; // æ·±åº¦int dp[N][21]; // dp[i][j]è¡¨ç¤ºä»iç»“ç‚¹å¼€å§‹è·³2^jæ­¥å¯åˆ°è¾¾çš„ç»“ç‚¹vector&lt;int&gt; edge[N]; // è¾¹vector&lt;int&gt; weight[N]; // æƒå€¼ll path[N]; // åŸå§‹çš„æ¸¸è§ˆè·¯çº¿ll dist[N]; // dist[i]å­˜å‚¨iåˆ°æ ¹ç»“ç‚¹çš„è·ç¦»void dfs(int u, int father) // LCAçš„å‰ç½®ç®—æ³•(æ¨¡æ¿) å±‚æ•° çˆ¶äº²èŠ‚ç‚¹&#123; deep[u] = deep[father] + 1; dp[u][0] = father; for (int i = 1; i &lt;= 20; i++) &#123; dp[u][i] = dp[dp[u][i - 1]][i - 1]; &#125; for (size_t i = 0; i &lt; edge[u].size(); i++) &#123; int v = edge[u][i], w = weight[u][i]; if (v == father) continue; dist[v] = dist[u] + w; dfs(v, u); //ä¸‹ä¸€å±‚é€’å½’ &#125;&#125;int LCA(int x, int y) // æ±‚xå’Œyçš„æœ€è¿‘å…¬å…±ç¥–å…ˆ(æ¨¡æ¿)&#123; if (deep[x] &lt; deep[y]) swap(x, y); for (int i = 20; i &gt;= 0; i--) &#123; if (deep[dp[x][i]] &gt;= deep[y]) &#123; x = dp[x][i]; &#125; &#125; if (x == y) return x; for (int i = 20; i &gt;= 0; i--) &#123; if (dp[x][i] != dp[y][i]) &#123; x = dp[x][i]; y = dp[y][i]; &#125; &#125; return dp[x][0];&#125;ll get_dist(int x, int y) // æ±‚xå’Œyçš„è·ç¦»&#123; if (x == 0 || y == 0) return 0; return dist[x] + dist[y] - 2 * dist[LCA(x, y)];&#125;int main()&#123; cin &gt;&gt; n &gt;&gt; k; for (int i = 1; i &lt; n; i++) // æ’å…¥n-1æ¡æ— å‘è¾¹ &#123; int u, v, w; cin &gt;&gt; u &gt;&gt; v &gt;&gt; w; edge[u].push_back(v); edge[v].push_back(u); weight[u].push_back(w); weight[v].push_back(w); &#125; dfs(1, 0); // è·‘ä¸€édfsä¸ºLCAåšå‡†å¤‡ ll sum = 0; // sumå­˜å‚¨åŸå§‹æ¸¸è§ˆè·¯çº¿çš„æ€»è·¯å¾„é•¿åº¦ for (int i = 1; i &lt;= k; i++) &#123; cin &gt;&gt; path[i]; if (i &gt; 1) // ä»ç¬¬äºŒä¸ªæ™¯ç‚¹å¼€å§‹è®¡ç®— &#123; sum += get_dist(path[i], path[i - 1]); // ä¾æ¬¡ç´¯åŠ  &#125; &#125; for (int i = 1; i &lt;= k; i++) // é™¤å»ç¬¬iä¸ªæ™¯ç‚¹ &#123; ll dist1 = get_dist(path[i], path[i - 1]); ll dist2 = get_dist(path[i], path[i + 1]); ll dist3 = get_dist(path[i - 1], path[i + 1]); cout &lt;&lt; sum - dist1 - dist2 + dist3 &lt;&lt; &quot; &quot;; // å¥—å…¬å¼è®¡ç®—å³å¯ &#125; cout &lt;&lt; endl; return 0;&#125; åŸºç¡€ç®—æ³•ï¼šæšä¸¾ è´ªå¿ƒ æ¨¡æ‹ŸäºŒåˆ† æ’åºï¼šæ¡¶æ’åº å½’å¹¶æ’åº å¿«é€Ÿæ’åº æœç´¢ï¼šDFS BFS å‰ªæ åŠ¨æ€è§„åˆ’ï¼šä¸€ç»´dp èƒŒåŒ…dp æ ‘å½¢dp çŠ¶å‹dp æ•°ä½dp","categories":[{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/categories/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"http://example.com/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"}]},{"title":"HTML+CSS","slug":"source/å‰ç«¯/Web HTML5 CSS3","date":"2024-06-08T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2024/06/09/source/å‰ç«¯/Web HTML5 CSS3/","permalink":"http://example.com/2024/06/09/source/%E5%89%8D%E7%AB%AF/Web%20HTML5%20CSS3/","excerpt":"","text":"vscode å®‰è£…æ’ä»¶ open in browser #HTML ##æ ‡ç­¾ æ ‡ç­¾ 123&lt;strong&gt;å†…å®¹&lt;/strong&gt;&lt;br&gt; &lt;!-- æ¢è¡Œ --&gt; æ³¨é‡Šï¼šctrl+/&lt;hr&gt; &lt;!-- æ°´å¹³çº¿ --&gt; å³é”®open in browseræˆ–è€…alt+b ###htmléª¨æ¶ 12345678&lt;html&gt; &lt;head&gt; &lt;title&gt;ç½‘é¡µæ ‡é¢˜&lt;/title&gt; &lt;/head&gt; &lt;body&gt; ç½‘é¡µä¸»ä½“ &lt;/body&gt;&lt;/html&gt; åœ¨vscodeä¸­ !+enter&#x2F;tabè‡ªåŠ¨ç”Ÿæˆéª¨æ¶ 1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;Document&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;/body&gt;&lt;/html&gt; æ ‡ç­¾çš„å…³ç³»ï¼šçˆ¶å­é›†ï¼Œå¹³è¡Œ ###æ ‡é¢˜ h1~h6 åŒæ ‡ç­¾ h1åªç”¨ä¸€æ¬¡ ###æ®µè½ p åŒ æ®µè½ä¹‹é—´æœ‰ç©ºéš™ ###æ–‡æœ¬æ ¼å¼åŒ– ###å›¾åƒæ ‡ç­¾ å›¾ç‰‡çš„å¤§å°ä¸€èˆ¬ç”¨cssæ§åˆ¶ è·¯å¾„ ç›¸å¯¹ï¼šä»å½“å‰æ–‡ä»¶å¤¹å‡ºå‘ . .. ç»å¯¹ï¼šwinï¼šä»ç›˜ iosï¼šä»æ ¹å‡ºå‘ C:&#x2F; å¯ä»¥ç”¨åœ¨çº¿ç½‘ç«™çš„å›¾ç‰‡ç½‘å€ ###è¶…é“¾æ¥ 12&lt;a href=&quot;#&quot;&gt;ç©ºé“¾æ¥&lt;/a&gt;&lt;a href=&quot;&quot; target=&quot;_blank&quot;&gt;text&lt;/a&gt; æ–°çª—å£æ‰“å¼€ ###éŸ³é¢‘æ ‡ç­¾ åä¸‰ä¸ªå±æ€§éƒ½å¯ä»¥ç®€å†™ å¼•å·é‡Œé¢çš„å†…å®¹å’Œåå­—ä¸€æ · ###è§†é¢‘æ ‡ç­¾ ###åˆ—è¡¨-æ’åˆ—æ•´é½ æ— åºulåµŒå¥—li æœ‰åºolåµŒå¥—li å®šä¹‰åˆ—è¡¨dlåµŒå¥—dtæ ‡é¢˜ dd ###è¡¨æ ¼ åŒ…è£¹ä½trå³å¯ï¼Œä½†æ˜¯è§†è§‰ä¸Šæ²¡å˜åŒ– åˆå¹¶å•å…ƒæ ¼ è¡¨å•-æ”¶é›†ç”¨æˆ·ä¿¡æ¯input å ä½æ–‡æœ¬-æç¤º placeholder&#x3D;â€â€ å…¶ä»–å±æ€§ file multitipleå¯ä»¥å¤šé€‰ä¸Šä¼  checkbox checked ä¸‹æ‹‰èœå• ###æ–‡æœ¬åŸŸ å¤šè¡Œè¾“å…¥ textarea åŒ ###labelæ ‡ç­¾ åŒ ç»‘å®šæ–‡å­—å’Œè¡¨å•æ§ä»¶çš„å…³ç³»ï¼Œå¢å¤§è¡¨å•æ§ä»¶çš„ç‚¹å‡»èŒƒå›´ æŒ‰é’®button ###æ— è¯­ä¹‰å¸ƒå±€æ ‡ç­¾ div ç‹¬å ä¸€è¡Œ å¤§ç›’å­(å¯ä»¥æ¢è¡Œå±•ç¤ºå†…å®¹) span ä¸æ¢è¡Œ å°ç›’å­(ä¸æ¢è¡Œå±•ç¤º) å­—ç¬¦å®ä½“ å¤šä¸ªé”®ç›˜ç©ºæ ¼ç½‘é¡µä¸Šåªæœ‰ä¸€ä¸ª CSSå±‚å æ ·å¼è¡¨ å¼•å…¥æ–¹å¼å†…éƒ¨ csså†™åœ¨styleæ ‡ç­¾é‡Œé¢ å¤–éƒ¨ å•ç‹¬æ”¾ .css htmlä½¿ç”¨linkæ ‡ç­¾å¼•å…¥ è¡Œå†… é…åˆJavascriptä½¿ç”¨ 123&lt;div style=&quot;color: blueviolet;font-size: 30px;&quot;&gt; test2 &lt;/div&gt;","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"HTML","slug":"HTML","permalink":"http://example.com/tags/HTML/"},{"name":"CSS","slug":"CSS","permalink":"http://example.com/tags/CSS/"}]},{"title":"å¾®ä¿¡å…¬ä¼—å·å¼€å‘","slug":"source/å‰ç«¯/å¾®ä¿¡å…¬ä¼—å·å¼€å‘","date":"2024-06-08T16:00:00.000Z","updated":"2025-08-31T08:06:09.543Z","comments":true,"path":"2024/06/09/source/å‰ç«¯/å¾®ä¿¡å…¬ä¼—å·å¼€å‘/","permalink":"http://example.com/2024/06/09/source/%E5%89%8D%E7%AB%AF/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/","excerpt":"","text":"ä¸€å¼€å§‹æ¯”è¾ƒå¥½å¥‡å¦‚ä½•å®ç°å…¬ä¼—å·ä¸Šç‚¹å‡»æŒ‰é’®è¿”å›æŸ¥è¯¢å½“åœ°çš„å¤©æ°”è¿™ä¸ªåŠŸèƒ½ï¼ŒåŠ ä¸Šæƒ³è¦çŸ¥é“å¦‚ä½•è°ƒç”¨apiæ¥å£è¿›è¡Œå¼€å‘ï¼Œè¿˜æœ‰å¯¹ç½‘é¡µçš„ä¸€äº›ç–‘é—®ï¼Ÿ æˆ‘æ³¨å†Œäº†ä¸€ä¸ªå…¬ä¼—å·ï¼Œç½‘å€åº”è¯¥æ˜¯è¿™ä¸ªï¼šhttps://mp.weixin.qq.com è®¾ç½®ä¸å¼€å‘-å…¬ä¼—å·è®¾ç½®-åŠŸèƒ½è®¾ç½®ä¸­æœ‰ä¸€ä¸ªJSæ¥å£å®‰å…¨åŸŸåè®¾ç½® åªè¦æˆ‘ç»‘å®šè¿™ä¸ªåº”è¯¥å°±å¯ä»¥è¿›è¡Œå¼€å‘äº† ä½†æ˜¯æˆ‘æ²¡æœ‰åŸŸåï¼Ÿ åŸŸåé€šè¿‡ICPå¤‡æ¡ˆï¼Ÿ ç°åœ¨æˆ‘ç•™æœ‰ä¸¤ä¸ªé—®é¢˜ æˆ‘æœåˆ°çš„èµ„æ–™ï¼š ç‚¹å‡»å‘é€å¤©æ°”é¢„æŠ¥çš„jsä»£ç ï¼šhttps://cloud.tencent.com/developer/article/1676360 é˜¿é‡Œäº‘ICPå¤‡æ¡ˆç½‘å€(å…è´¹)ï¼šhttps://beian.aliyun.com/?spm=5176.27043851.J_5642934430.8.27b175baCO8rQF é‡äº‹ä¸å†³è¿˜æ˜¯çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ è®¾ç½®ä¸å¼€å‘-å¼€å‘è€…å·¥å…·-å¼€å‘è€…æ–‡æ¡£ https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Getting_Started_Guide.html åŸºæœ¬é…ç½® è´­ä¹°äº‘æœåŠ¡å™¨ âˆš æ­å»ºæœåŠ¡ pythonå®˜ç½‘ä¸‹è½½å‹ç¼©åŒ…https://www.python.org/downloads/source/ é€‰æ‹©ç¬¬äºŒä¸ªxzç‰ˆæœ¬ï¼Œä¸‹è½½åä¼ åˆ°&#x2F;home&#x2F;myhome ä¸‹è½½python python â€“versionæ²¡æœ‰,ä½†æ˜¯whereis pythonæ˜¾ç¤ºpython3.6è¯´æ˜æˆ‘å·²ç»æœ‰äº†ï¼Œæˆ‘éœ€è¦ä½¿ç”¨python3æŒ‡ä»¤ python3 â€“version âˆš pip3 install web-py âˆš yum install libxml2 libxslt âˆš è¿™ä¸ªåŸæœ¬å°±æœ‰äº†çš„ pip3 install lxml âˆš vim main.py # -*- coding: utf-8 -*- # filename: main.py import web urls = ( &#39;/wx&#39;, &#39;Handle&#39;, ) class Handle(object): def GET(self): return &quot;hello, this is handle view&quot; if __name__ == &#39;__main__&#39;: app = web.application(urls, globals()) app.run() 12345678910111213141516171819202122232425262728* python3 main.py 80* è®¿é—®http://localhost/wxä¼šå‡ºç°hello, this is handle view3. å¼€å‘è€…åŸºæœ¬é…ç½®* ä¿®æ”¹é…ç½®* URLï¼šhttp://47.115.215.143/wx* Tokenï¼š123456xxx* éšæœºç”ŸæˆEncodingAESKey:livQRyv3bSWTW8qW3llMVPNsnhi50maBaPinbfOnJcu* æ”¹åŠ¨main.py* ~~~py # -*- coding: utf-8 -*- # filename: main.py import web from handle import Handle urls = ( &#x27;/wx&#x27;, &#x27;Handle&#x27;, ) if __name__ == &#x27;__main__&#x27;: app = web.application(urls, globals()) app.run() vim handle.py è¿™é‡Œå¾®ä¿¡å¹³å°æä¾›çš„æ˜¯é”™çš„ï¼Œä¹Ÿæ˜¯æœ‰ç‚¹æ— è¯­äº† # -*- coding: utf-8 -*- # filename: handle.py import hashlib import web class Handle(object): def GET(self): try: data = web.input() if len(data) == 0: return &quot;hello, this is handle view&quot; signature = data.signature timestamp = data.timestamp nonce = data.nonce echostr = data.echostr token = &quot;123456xxx&quot; #è¯·æŒ‰ç…§å…¬ä¼—å¹³å°å®˜ç½‘\\åŸºæœ¬é…ç½®ä¸­ä¿¡æ¯å¡«å†™ list = [token, timestamp, nonce] list.sort() tmp_str = &#39;&#39;.join(list) hashcode = hashlib.sha1(tmp_str.encode(&#39;utf-8&#39;)).hexdigest() #sha1 = hashlib.sha1() #map(sha1.update, list) #hashcode = sha1.hexdigest() print (&quot;handle/GET func: hashcode, signature: &quot;, hashcode, signature) if hashcode == signature: return int(echostr) else: return &quot;&quot; except Exception as Argument: return Argument 123456789101112131415161718192021222324252627282930* python3 main.py 80* æäº¤* å¯åŠ¨[å¾®ä¿¡å…¬ä¼—å· | å¦‚ä½•è®¾ç½®JS-APIå¯¹æ¥å¾®ä¿¡é«˜çº§èƒ½åŠ› - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/149965575)å…³æ³¨è‡ªåŠ¨å›å¤æ¶ˆæ¯ï¼š[koa2å®ç°å¾®ä¿¡å…¬ä¼—å·å…³æ³¨è‡ªåŠ¨å›å¤æ¶ˆæ¯-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/developer/article/1672853)[å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µæˆæƒåŸŸåå’ŒJSæ¥å£å®‰å…¨åŸŸåé…ç½®æ”»ç•¥_åŸŸåä¸åŒ¹é…å½“å‰æœåŠ¡å·çš„jså®‰å…¨åŸŸå-CSDNåšå®¢](https://blog.csdn.net/hadues/article/details/106639473)[å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå¼€å‘â€”â€”æˆæƒç™»å½•ï¼Œjså®‰å…¨åŸŸåï¼Œjssdkä½¿ç”¨ - web_study - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/web-wjg/p/11346656.html)# å®ç°ä½ é—®æˆ‘ç­”ç²‰ä¸ç»™å…¬ä¼—å·å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼šâ€œæ¬¢è¿å¼€å¯å…¬ä¼—å·å¼€å‘è€…æ¨¡å¼â€ï¼Œåœ¨å¼€å‘è€…åå°ï¼Œæ”¶åˆ°å…¬ä¼—å¹³å°å‘é€çš„xml å¦‚ä¸‹ï¼šï¼ˆä¸‹æ–‡å‡éšè—äº†ToUserName åŠ FromUserName ä¿¡æ¯ï¼‰~~~xml&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[å…¬ä¼—å·]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[ç²‰ä¸å·]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;1460537339&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt; &lt;Content&gt;&lt;![CDATA[æ¬¢è¿å¼€å¯å…¬ä¼—å·å¼€å‘è€…æ¨¡å¼]]&gt;&lt;/Content&gt; &lt;MsgId&gt;6272960105994287618&lt;/MsgId&gt;&lt;/xml&gt; å…¬ä¼—å·æƒ³å›å¤ç»™ç²‰ä¸ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯ï¼Œå†…å®¹ä¸ºâ€œtestâ€, é‚£ä¹ˆå¼€å‘è€…å‘é€ç»™å…¬ä¼—å¹³å°åå°çš„xml å†…å®¹å¦‚ä¸‹ï¼š 1234567&lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[ç²‰ä¸å·]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[å…¬ä¼—å·]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;1460541339&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt; &lt;Content&gt;&lt;![CDATA[test]]&gt;&lt;/Content&gt;&lt;/xml&gt; æ”¶åˆ°ç²‰ä¸æ¶ˆæ¯åä¸æƒ³æˆ–è€…ä¸èƒ½5ç§’å†…å›å¤æ—¶ï¼Œéœ€å›å¤â€œsuccessâ€å­—ç¬¦ä¸²ï¼Œå¦‚æœèƒ½ä¸éœ€è¦å›å¤ å¦‚æœå¼€å‘è€…ä¸è¿›è¡Œå›å¤ï¼Œå¾®ä¿¡åå°æ²¡åŠæ³•ç¡®è®¤å¼€å‘è€…å·²æ”¶åˆ°æ¶ˆæ¯ ä¸‰æ¬¡é‡è¯•åï¼Œä¾æ—§æ²¡æœ‰åŠæ—¶å›å¤ä»»ä½•å†…å®¹ï¼Œç³»ç»Ÿè‡ªåŠ¨åœ¨ç²‰ä¸ä¼šè¯ç•Œé¢å‡ºç°é”™è¯¯æç¤ºâ€œè¯¥å…¬ä¼—å·æš‚æ—¶æ— æ³•æä¾›æœåŠ¡ï¼Œè¯·ç¨åå†è¯•â€ã€‚ vim handle.py 12345678910111213141516171819202122232425# -*- coding: utf-8 -*-# # filename: handle.pyimport hashlibimport replyimport receiveimport webclass Handle(object): def POST(self): try: webData = web.data() print &quot;Handle Post webdata is &quot;, webData #åå°æ‰“æ—¥å¿— recMsg = receive.parse_xml(webData) if isinstance(recMsg, receive.Msg) and recMsg.MsgType == &#x27;text&#x27;: toUser = recMsg.FromUserName fromUser = recMsg.ToUserName content = &quot;test&quot; replyMsg = reply.TextMsg(toUser, fromUser, content) return replyMsg.send() else: print &quot;æš‚ä¸”ä¸å¤„ç†&quot; return &quot;success&quot; except Exception, Argment: return Argment vim receive.py 123456789101112131415161718192021222324252627282930313233343536# -*- coding: utf-8 -*-## filename: receive.pyimport xml.etree.ElementTree as ETdef parse_xml(web_data): if len(web_data) == 0: return None xmlData = ET.fromstring(web_data) msg_type = xmlData.find(&#x27;MsgType&#x27;).text if msg_type == &#x27;text&#x27;: return TextMsg(xmlData) elif msg_type == &#x27;image&#x27;: return ImageMsg(xmlData)class Msg(object): def __init__(self, xmlData): self.ToUserName = xmlData.find(&#x27;ToUserName&#x27;).text self.FromUserName = xmlData.find(&#x27;FromUserName&#x27;).text self.CreateTime = xmlData.find(&#x27;CreateTime&#x27;).text self.MsgType = xmlData.find(&#x27;MsgType&#x27;).text self.MsgId = xmlData.find(&#x27;MsgId&#x27;).textclass TextMsg(Msg): def __init__(self, xmlData): Msg.__init__(self, xmlData) self.Content = xmlData.find(&#x27;Content&#x27;).text.encode(&quot;utf-8&quot;)class ImageMsg(Msg): def __init__(self, xmlData): Msg.__init__(self, xmlData) self.PicUrl = xmlData.find(&#x27;PicUrl&#x27;).text self.MediaId = xmlData.find(&#x27;MediaId&#x27;).text vim reply.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# -*- coding: utf-8 -*-## filename: reply.pyimport timeclass Msg(object): def __init__(self): pass def send(self): return &quot;success&quot;class TextMsg(Msg): def __init__(self, toUserName, fromUserName, content): self.__dict = dict() self.__dict[&#x27;ToUserName&#x27;] = toUserName self.__dict[&#x27;FromUserName&#x27;] = fromUserName self.__dict[&#x27;CreateTime&#x27;] = int(time.time()) self.__dict[&#x27;Content&#x27;] = content def send(self): XmlForm = &quot;&quot;&quot; &lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[&#123;ToUserName&#125;]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[&#123;FromUserName&#125;]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;&#123;CreateTime&#125;&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt; &lt;Content&gt;&lt;![CDATA[&#123;Content&#125;]]&gt;&lt;/Content&gt; &lt;/xml&gt; &quot;&quot;&quot; return XmlForm.format(**self.__dict)class ImageMsg(Msg): def __init__(self, toUserName, fromUserName, mediaId): self.__dict = dict() self.__dict[&#x27;ToUserName&#x27;] = toUserName self.__dict[&#x27;FromUserName&#x27;] = fromUserName self.__dict[&#x27;CreateTime&#x27;] = int(time.time()) self.__dict[&#x27;MediaId&#x27;] = mediaId def send(self): XmlForm = &quot;&quot;&quot; &lt;xml&gt; &lt;ToUserName&gt;&lt;![CDATA[&#123;ToUserName&#125;]]&gt;&lt;/ToUserName&gt; &lt;FromUserName&gt;&lt;![CDATA[&#123;FromUserName&#125;]]&gt;&lt;/FromUserName&gt; &lt;CreateTime&gt;&#123;CreateTime&#125;&lt;/CreateTime&gt; &lt;MsgType&gt;&lt;![CDATA[image]]&gt;&lt;/MsgType&gt; &lt;Image&gt; &lt;MediaId&gt;&lt;![CDATA[&#123;MediaId&#125;]]&gt;&lt;/MediaId&gt; &lt;/Image&gt; &lt;/xml&gt; &quot;&quot;&quot; return XmlForm.format(**self.__dict) è®¾ç½®JSæ¥å£å®‰å…¨åŸŸå","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"http://example.com/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"}]},{"title":"vmware","slug":"source/å·¥å…·-ç¯å¢ƒ/VMware win11","date":"2024-06-08T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2024/06/09/source/å·¥å…·-ç¯å¢ƒ/VMware win11/","permalink":"http://example.com/2024/06/09/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/VMware%20win11/","excerpt":"","text":"å¼€å§‹-æœç´¢â€œå¯ç”¨æˆ–å…³é—­windowsåŠŸèƒ½â€-å‹¾é€‰â€œwindowsè™šæ‹Ÿæœºç›‘æ§ç¨‹åºå¹³å°â€å’Œâ€œè™šæ‹Ÿæœºå¹³å°â€ ä¸‹è½½win11 ISODownload Windows 11 (microsoft.com)ç‰ˆæœ¬ä»»æ„ ä¸‹è½½wmwareæ­¤å¤„ä¸å±•ç¤ºæ–°å»ºè™šæ‹Ÿæœº-å…¼å®¹æ€§workstation 16.x -å…¸å‹-ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ-windows-ç‰ˆæœ¬ win11 x64-è™šæ‹Ÿæœºåç§°&#x2F;ä½ç½®-å›ºä»¶ç±»å‹UEFI-åªæœ‰æ”¯æŒtmp..åŠ å¯†-è®¾ç½®8ä½ä»¥ä¸Šå¯†ç -è®°ä½å¯†ç -æœ€å¤§ç£ç›˜å¤§å°64gb-å°†è™šæ‹Ÿæœºæ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶-è‡ªå®šä¹‰ç¡¬ä»¶-å…³é—­-å®Œæˆ æˆ‘è®¾ç½®çš„å¯†ç ï¼šï¼niubiplus007 è®¾ç½®-é€‰é¡¹-è®¿é—®æ§åˆ¶-åŠ å¯† â€‹ -é«˜çº§-å›ºä»¶ç±»å‹-UEFI -ç¡¬ä»¶-æ·»åŠ -å¯ä¿¡å¹³å°æ¨¡å— -CD&#x2F;DVD-ä½¿ç”¨ISOæ˜ åƒæ–‡ä»¶-è®¾å¤‡çŠ¶æ€-å·²è¿æ¥å¯åŠ¨æ—¶è¿æ¥ -å†…å­˜-4GB(4096MB) æˆ‘æ²¡æœ‰äº§å“å¯†é’¥-win11ä¸“ä¸šç‰ˆ-è‡ªå®šä¹‰å®‰è£…-ä¸åˆ†åŒº ç™»å½•è´¦å·ç›´æ¥è¾“å…¥é”™è¯¯çš„è´¦å·å’Œå¯†ç ï¼Œç”¨åå­—ç™»å½• ä¸‹æ–¹é»„è‰²æç¤ºæ æˆ–è€…å³é”®å®‰è£…vmware tools-win+r-D:\\setup.exe-å…¸å‹å®‰è£… å¯ä»¥ç›´æ¥ä½¿ç”¨å¤åˆ¶ç²˜è´´åŒ…æ‹¬æ–‡ä»¶ï¼Œæ‹‰ä¼¸æ¯”ä¾‹ ç½‘ç»œé…ç½®-ä¸€èµ·é…å¥½äº†çš„è¿™é‡Œæ˜¯192.168.6.129 g++ server.cpp -lpthread -lws2_32 https://blog.csdn.net/qq_42417071/article/details/137438374","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"http://example.com/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"}]},{"title":"c++é¢è¯•","slug":"source/é¢è¯•/C++é¢è¯•å‡†å¤‡","date":"2024-06-08T16:00:00.000Z","updated":"2025-03-11T14:51:50.761Z","comments":true,"path":"2024/06/09/source/é¢è¯•/C++é¢è¯•å‡†å¤‡/","permalink":"http://example.com/2024/06/09/source/%E9%9D%A2%E8%AF%95/C++%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/","excerpt":"","text":"STLé¡ºåºå®¹å™¨ std::vectorï¼š åŠ¨æ€æ•°ç»„ï¼Œå¯ä»¥éšæœºè®¿é—®å…ƒç´ ï¼Œæ”¯æŒé«˜æ•ˆçš„å°¾éƒ¨æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ è¿ç»­å†…å­˜ std::dequeï¼š åŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒé«˜æ•ˆçš„å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ æ•°ç»„å—+æ˜ å°„è¡¨ dequeæ²¡æœ‰capacity(),è¿”å›å½“å‰å¯å®¹çº³å…ƒç´ æ•°ç›® std::listï¼š åŒå‘é“¾è¡¨ï¼Œæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œä½†ä¸æ”¯æŒéšæœºè®¿é—®ã€‚ std::forward_listï¼š å•å‘é“¾è¡¨ï¼Œä»…æ”¯æŒå•å‘éå†ï¼ŒèŠ‚çœç©ºé—´ã€‚ å…³è”å®¹å™¨ std::mapï¼š æœ‰åºå…³è”å®¹å™¨ï¼Œå­˜å‚¨é”®å€¼å¯¹ï¼Œé”®æ˜¯å”¯ä¸€çš„ï¼ŒæŒ‰ç…§é”®çš„é¡ºåºæ’åº(åº•å±‚çº¢é»‘æ ‘ï¼Œé»˜è®¤å‡åº)ã€‚ std::multimapï¼š æœ‰åºå…³è”å®¹å™¨ï¼Œå…è®¸é”®é‡å¤ï¼ŒæŒ‰ç…§é”®çš„é¡ºåºæ’åºã€‚ std::setï¼š æœ‰åºé›†åˆï¼Œå­˜å‚¨å”¯ä¸€çš„å…ƒç´ ï¼ŒæŒ‰ç…§å…ƒç´ çš„é¡ºåºæ’åºã€‚ std::multisetï¼š æœ‰åºé›†åˆï¼Œå…è®¸å…ƒç´ é‡å¤ï¼ŒæŒ‰ç…§å…ƒç´ çš„é¡ºåºæ’åºã€‚ æ— åºå®¹å™¨ std::unordered_mapï¼š æ— åºå…³è”å®¹å™¨ï¼Œå­˜å‚¨é”®å€¼å¯¹ï¼Œé”®æ˜¯å”¯ä¸€çš„ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚ std::unordered_multimapï¼š æ— åºå…³è”å®¹å™¨ï¼Œå…è®¸é”®é‡å¤ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚ std::unordered_setï¼š æ— åºé›†åˆï¼Œå­˜å‚¨å”¯ä¸€çš„å…ƒç´ ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚ std::unordered_multisetï¼š æ— åºé›†åˆï¼Œå…è®¸å…ƒç´ é‡å¤ï¼ŒåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚ å®¹å™¨é€‚é…å™¨ std::stackï¼š æ ˆé€‚é…å™¨ï¼Œé€šå¸¸åŸºäº std::deque å®ç°ï¼Œä¹Ÿå¯ä»¥åŸºäº std::vector æˆ– std::list å®ç°ã€‚ std::queueï¼š é˜Ÿåˆ—é€‚é…å™¨ï¼Œé€šå¸¸åŸºäº std::deque å®ç°ã€‚ std::priority_queueï¼š ä¼˜å…ˆé˜Ÿåˆ—é€‚é…å™¨ï¼Œé€šå¸¸åŸºäº std::vector å®ç°ï¼Œç”¨äºç»´æŠ¤ä¸€ä¸ªå †ç»“æ„ã€‚ ç‰¹æ®Šå®¹å™¨ std::arrayï¼š å®šé•¿æ•°ç»„ï¼Œå¤§å°åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚ std::bitsetï¼š å®šé•¿äºŒè¿›åˆ¶æ•°ç»„ï¼Œç”¨äºé«˜æ•ˆå­˜å‚¨å’Œæ“ä½œäºŒè¿›åˆ¶ä½ã€‚ é€‰æ‹©åˆé€‚çš„å®¹å™¨é€‰æ‹©åˆé€‚çš„å®¹å™¨å–å†³äºå…·ä½“éœ€æ±‚ï¼š éœ€è¦éšæœºè®¿é—®ï¼šstd::vector æˆ– std::deque éœ€è¦é«˜æ•ˆçš„å¤´å°¾éƒ¨æ’å…¥&#x2F;åˆ é™¤ï¼šstd::deque éœ€è¦é«˜æ•ˆçš„ä»»æ„ä½ç½®æ’å…¥&#x2F;åˆ é™¤ï¼šstd::list æˆ– std::forward_list éœ€è¦é”®å€¼å¯¹å­˜å‚¨ä¸”æŒ‰é”®æ’åºï¼šstd::map éœ€è¦é”®å€¼å¯¹å­˜å‚¨ä¸”æŒ‰å“ˆå¸Œè¡¨å­˜å‚¨ï¼šstd::unordered_map éœ€è¦å­˜å‚¨å”¯ä¸€å…ƒç´ ä¸”æŒ‰é¡ºåºæ’åºï¼šstd::set éœ€è¦å­˜å‚¨å”¯ä¸€å…ƒç´ ä¸”æŒ‰å“ˆå¸Œè¡¨å­˜å‚¨ï¼šstd::unordered_set éœ€è¦LIFOç»“æ„ï¼šstd::stack éœ€è¦FIFOç»“æ„ï¼šstd::queue éœ€è¦ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼šstd::priority_queue å…¶ä»–å®¹å™¨ä¸æ•°æ®ç»“æ„vectorä¸­push_backå’Œemplace_backçš„åŒºåˆ«ï¼Ÿpush_back() å‘å®¹å™¨å°¾éƒ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºè¿™ä¸ªå…ƒç´ ï¼Œç„¶åå†å°†è¿™ä¸ªå…ƒç´ æ‹·è´æˆ–è€…ç§»åŠ¨åˆ°å®¹å™¨ä¸­ï¼ˆå¦‚æœæ˜¯æ‹·è´çš„è¯ï¼Œäº‹åä¼šè‡ªè¡Œé”€æ¯å…ˆå‰åˆ›å»ºçš„è¿™ä¸ªå…ƒç´ ï¼‰ï¼›è€Œ emplace_back() åœ¨å®ç°æ—¶ï¼Œåˆ™æ˜¯ç›´æ¥åœ¨å®¹å™¨å°¾éƒ¨åˆ›å»ºè¿™ä¸ªå…ƒç´ ï¼Œçœå»äº†æ‹·è´æˆ–ç§»åŠ¨å…ƒç´ çš„è¿‡ç¨‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ä¼ é€’å¯¹è±¡ï¼Œé‚£ä¹ˆäºŒè€…éƒ½æ˜¯ä¸€æ ·çš„ mapå’Œsetçš„åŒºåˆ«å’Œåº•å±‚å®ç°ï¼Œmapå–å€¼çš„findã€[]ã€atæ–¹æ³•çš„åŒºåˆ«mapå’Œsetéƒ½æ˜¯å…³è”å¼å®¹å™¨ï¼Œåº•å±‚å®ç°æ˜¯çº¢é»‘æ ‘ï¼Œå¢åˆ æŸ¥æ”¹çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(logn)ã€‚mapå­˜å‚¨é”®å€¼å¯¹ï¼Œsetåªå­˜é”® å–å€¼æ–¹æ³•åŒºåˆ« findï¼šæ‰¾é”®è¿”å›è¿­ä»£å™¨ï¼Œè‹¥æ— ï¼Œè¿”å›end()ï¼Œå®‰å…¨[]ï¼šæ‰¾é”®è¿”å›å€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨æ’å…¥atï¼šæ‰¾é”®è¿”å›å€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡ºstd::out_of_rangeå¼‚å¸¸ï¼Œå®‰å…¨ã€‚ ###ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ*** ä»–æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡ï¼‰ ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆå†…ï¼Œå…·æœ‰è¿è¡Œå¿«é€Ÿï¼Œå†…å­˜å ç”¨å°çš„ç‰¹ç‚¹ã€‚ä»–åªèƒ½å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªå…ƒç´ ç»å¯¹ä¸åœ¨é›†åˆå†…æˆ–å¯èƒ½åœ¨é›†åˆå†…ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¾ˆéš¾å®ç°åˆ é™¤æ“ä½œã€‚ å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢redisç¼“å­˜å‡»ç©¿é—®é¢˜ï¼ˆå‰ç«¯è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œä½†æ˜¯redisæ²¡æœ‰è¿™ä¸ªæ•°æ®ï¼Œå°±ä¼šå»æ•°æ®åº“æŸ¥è¯¢ï¼Œæ•°æ®åº“å¯èƒ½æ‰¿å—ä¸äº†è¿™ä¹ˆå¤§çš„æµé‡å°±æŒ‚æ‰äº†ï¼‰ã€‚æœ‰äº†å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°±èƒ½åˆ¤æ–­å“ªäº›æ•°æ®ä¸åœ¨æ•°æ®åº“ä¸­ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿ã€‚ ###çº¢é»‘æ ‘è®²ä¸€ä¸‹ï¼Œæ€ä¹ˆç¿»è½¬ï¼Ÿçº¢é»‘æ ‘çš„ç‰¹æ€§ï¼š èŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²çš„æ ¹èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆnullã€ç©ºèŠ‚ç‚¹ï¼‰éƒ½æ˜¯é»‘è‰²çš„å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œé‚£ä¹ˆä»–çš„ä¸¤ä¸ªå­ç»“ç‚¹å¿…ç„¶æ˜¯é»‘è‰²ä»ä»»æ„èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„é»‘è‰²èŠ‚ç‚¹æ•°ç›¸åŒç¿»è½¬ å·¦æ—‹ï¼šä»¥æŸä¸ªèŠ‚ç‚¹(A)ä¸ºè½´ï¼Œå°†å…¶å³èŠ‚ç‚¹ï¼ˆBï¼‰ä¸Šç§»è‡³Açš„ä½ç½®ï¼Œå°†Aä½œä¸ºBçš„å·¦å­ç»“ç‚¹ã€‚åŸBçš„å·¦å­èŠ‚ç‚¹å˜ä¸ºAçš„å³å­ç»“ç‚¹å³æ—‹ï¼šä»¥æŸä¸ªèŠ‚ç‚¹(A)ä¸ºè½´ï¼Œå°†å…¶å·¦èŠ‚ç‚¹ï¼ˆBï¼‰ä¸Šç§»è‡³Açš„ä½ç½®ï¼Œå°†Aä½œä¸ºBçš„å³å­èŠ‚ç‚¹ã€‚åŸBçš„å³å­èŠ‚ç‚¹å˜ä¸ºAçš„å·¦å­èŠ‚ç‚¹ ###unordered_mapä¸­å“ˆå¸Œå†²çªçš„è§£å†³æ–¹æ³• é“¾åœ°å€æ³•ï¼šé”®å€¼æ·»åŠ åˆ°ç›¸åº”ç´¢å¼•å¤„çš„é“¾è¡¨ï¼ˆunordered_mapå®ç°çš„æ–¹æ³•ï¼‰ ä¼˜ç‚¹ï¼šå¯¹å“ˆå¸Œå‡½æ•°è¦æ±‚ä½ï¼Œåˆ é™¤æ“ä½œç®€å• ç¼ºç‚¹ï¼šå…ƒç´ è¿‡å¤šä¼šå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼›ç”±äºé“¾è¡¨ä½¿å¾—æ•°æ®è®¿é—®ä¸è¿ç»­ï¼Œå¯¹CPUç¼“å­˜ä¸å‹å¥½ ä¼˜åŒ–æ–¹æ³• ä½¿ç”¨å¹³è¡¡æ ‘ä»£æ›¿é“¾è¡¨è‡ªé€‚åº”åº“å®¹&#x2F;ç¼©å®¹ï¼šéšç€å…ƒç´ å¢åŠ ï¼Œå“ˆå¸Œè¡¨åŠ¨æ€è°ƒæ•´å…¶å¤§å°ï¼Œæ¯”å¦‚rehash å¼€æ”¾åœ°å€æ³•ï¼šè¯•å›¾æ‰¾åˆ°å†²çªç´¢å¼•åçš„æ•°ç»„ä½ç½®çš„ä¸€ä¸ªç©ºä½ ä¼˜ç‚¹ï¼šæ— éœ€é¢å¤–çš„ç©ºé—´å­˜å‚¨é“¾è¡¨ï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜ï¼›å¯ä»¥æœ‰æ•ˆåˆ©ç”¨CPUç¼“å­˜ç¼ºç‚¹ï¼šå¯¹å“ˆå¸Œå‡½æ•°è¦æ±‚è¾ƒé«˜ï¼›åˆ é™¤æ“ä½œç›¸å¯¹å¤æ‚unordered_mapä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°æ˜¯ä½¿ç”¨çš„std::hashä½œä¸ºå“ˆå¸Œå‡½æ•°ã€‚ å†å“ˆå¸Œ æ–°ç‰¹æ€§c++11####C++11çš„å•ä¾‹æ¨¡å¼ çº¿ç¨‹å®‰å…¨ï¼šC++11çš„å•ä¾‹æ¨¡å¼æä¾›äº†çº¿ç¨‹å®‰å…¨çš„åˆå§‹åŒ–å’Œä½¿ç”¨æ‰‹æ®µï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å•ä¾‹çš„æ­£ç¡®æ€§ã€‚ä¸»è¦æ˜¯å› ä¸ºC++11å¼•å…¥äº†æ–°çš„å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œã€‚ c++11çš„ç‰¹æ€§ä½¿æ‡’æ±‰æ¨¡å¼ä¸ç”¨åŠ é” ####æ™ºèƒ½æŒ‡é’ˆçš„è¿ç”¨åœºæ™¯ï¼Ÿ*** èµ„æºå…±äº«ï¼šå½“å¤šä¸ªå¯¹è±¡éœ€è¦å…±äº«ç›¸åŒçš„èµ„æºæ—¶ï¼Œå¯ä»¥é‡‡ç”¨shared_ptrï¼Œä¾‹å¦‚è§‚å¯Ÿè€…æ¨¡å¼ ç®¡ç†ç‹¬å èµ„æºï¼šå¯ä»¥é‡‡ç”¨unique_ptr å®ç°RAIIï¼šä½¿å¾—ç¨‹åºå‘˜ä¸ç”¨æ‹…å¿ƒå†…å­˜æ³„æ¼çš„é—®é¢˜ è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œï¼šä½¿ç”¨weak_ptrï¼Œå¼•ç”¨ä¸è®¡æ•°ï¼›ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢é‡å¤é‡Šæ”¾èµ„æºï¼Œweak_pträ¸èƒ½ç›´æ¥è®¿é—®æŒ‡å‘çš„å¯¹è±¡ï¼Œstd::shared_ptr a_shared &#x3D; b-&gt;a_ptr.lock();è½¬æ¢æˆshared_ptråè®¿é—®ã€‚ ####æ™ºèƒ½æŒ‡é’ˆçš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Ÿ ä¸¤ä¸ªæ™ºèƒ½æŒ‡é’ˆæŒ‡å‘äº’ç›¸æŒ‡å‘å¯¹æ–¹ï¼Œå¯¼è‡´åŒæ–¹ä¸èƒ½æ­£å¸¸ææ„ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚å¯ä»¥ä½¿ç”¨weak_ptrï¼Œä»–ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ã€‚ shapre_ptrçš„åˆ›å»ºã€å¤åˆ¶ã€é”€æ¯æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œå½“å­˜åœ¨å…±äº«å¯¹è±¡çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦åŠ é”ï¼›æ€»ä¹‹ï¼Œshared_ptrçš„éƒ¨åˆ†æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚shapred_ptrçš„å¼•ç”¨è®¡æ•°æ˜¯é€šè¿‡åŸå­æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ c++20åç¨‹ æ¯”çº¿ç¨‹æ›´å°çš„ å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹####æˆ‘åœ¨è°ƒç”¨forkä¹‹å‰æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£æˆ‘å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å¯¹è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå†™å…¥æ˜¯è¿½åŠ è¿˜æ˜¯é‡å†™ï¼Ÿ äºŒè€…å…±äº«ç›¸åŒçš„æ–‡ä»¶åç§»é‡ï¼Œæ‰€ä»¥ä¸ä¼šç›¸äº’è¦†ç›–ï¼Œè€Œæ˜¯è¿½åŠ åˆ°å½¼æ­¤å†™å…¥çš„å†…å®¹ä¸­ã€‚ä½†æ˜¯ä¸ºäº†é¿å…æ„å¤–ï¼Œè¿˜æ˜¯åŠ é”æ›´åŠ å®‰å…¨ã€‚ ####è®²è®²åç¨‹ï¼Œåç¨‹ä¸€å®šæ— é”å—ï¼Ÿ åç¨‹æ˜¯æ›´è½»é‡çº§çš„çº¿ç¨‹ï¼Œä¸»è¦æ˜¯ä»–å¯ä»¥åœ¨ç”¨æˆ·æ€è°ƒåº¦ï¼Œè¿™æ ·è¯´æ˜åç¨‹çš„åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦å¯ä»¥ç”±ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶ï¼Œè€Œéæ“ä½œç³»ç»Ÿã€‚ åç¨‹ä¸èƒ½ä¿è¯ä»£ç å®Œå…¨æ— é”ã€‚åç¨‹é™ä½äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€äº›æ½œåœ¨çš„å¹¶å‘éšæ‚£ï¼Œä½†è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä»ç„¶éœ€è¦åŠ é”ã€‚ ###è¿›ç¨‹é—´é€šä¿¡IPC ç®¡é“pipeï¼ŒåŠåŒå·¥(å•æ–¹å‘)ï¼Œåªèƒ½ç”¨äºçˆ¶å­ç­‰å…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´ä½¿ç”¨ æ¶ˆæ¯é˜Ÿåˆ—ï¼šå…¨åŒå·¥ msgget msgsnd msgrcv å…±äº«å†…å­˜ï¼šshmget shmat shmdt ä¿¡å·é‡ï¼šä¿¡å·é‡ä¸»è¦ç”¨äºè¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—® semget semop semctl å¥—æ¥å­— ###çº¿ç¨‹é€šä¿¡ å…±äº«å˜é‡ï¼šå…¨å±€å˜é‡æˆ–ç±»çš„æˆå‘˜å˜é‡ï¼Œç»“åˆé”æˆ–ä¿¡å·é‡ æ¶ˆæ¯é˜Ÿåˆ— æ¡ä»¶å˜é‡ï¼šæ»¡è¶³æ¡ä»¶é€šçŸ¥ ä¿¡å·é‡ï¼šè®¡æ•°å™¨ï¼Œä¸º0ç­‰å¾… çº¿ç¨‹å®‰å…¨ï¼šåŸå­æ“ä½œatomicï¼Œthread_local å¦‚æœæœ‰ä¸€ä¸ªå˜é‡å·²ç»å®šä¹‰ï¼Œç„¶åå†ç”³è¯·å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ï¼Œä»–ä»¬ä¹Ÿä¼šæœ‰è¿™ä¸ªå˜é‡å—è¿›ç¨‹ï¼šä¼šæœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œè¿›è¡Œæ•°æ®å¤åˆ¶äº’ä¸å½±å“ çº¿ç¨‹ï¼šå…±äº«å…¨å±€å˜é‡ï¼Œå±€éƒ¨å˜é‡æœ‰å„è‡ªå‰¯æœ¬(çº¿ç¨‹æŒ‡å®šå‡½æ•°è¿è¡Œ) è¿›ç¨‹è°ƒåº¦ç®—æ³•å…ˆæ¥å…ˆæœåŠ¡ï¼Œæœ€çŸ­ä½œä¸šä¼˜å…ˆï¼Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼Œæ—¶é—´ç‰‡è½®è½¬ï¼Œå¤šçº§åé¦ˆé˜Ÿåˆ—ç®—æ³•ï¼šè®¾ç½®å¤šä¸ªä¸åŒä¼˜å…ˆçº§çš„å°±ç»ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—é‡‡ç”¨ä¸åŒçš„è°ƒåº¦ç®—æ³•ã€‚æ–°è¿›ç¨‹ä¼šé¦–å…ˆè¿›å…¥æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒæŒ‰ç…§æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ‰§è¡Œã€‚å¦‚æœåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¼šè¢«é™åˆ°ä¸‹ä¸€çº§é˜Ÿåˆ—ã€‚å„çº§é˜Ÿåˆ—ä¹‹é—´é‡‡ç”¨ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚ é¢å‘å¯¹è±¡####é‡è½½ã€é‡å†™ï¼ˆè¦†ç›–ï¼‰ã€éšè— ï¼Ÿ é‡è½½æ˜¯å‡½æ•°åç›¸åŒï¼Œä½†æ˜¯å‚æ•°æˆ–è¿”å›å€¼ä¸åŒï¼Œå¯ä»¥æœ‰ä¸åŒåœ°å®ç°ã€‚ é‡å†™æ˜¯å¤šæ€çš„å†…å®¹ï¼Œæ˜¯çˆ¶ç±»å†™äº†è™šå‡½æ•°ï¼Œå­ç±»æœ‰è‡ªå·±çš„å®ç°ã€‚ éšè—æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†çˆ¶ç±»å®Œå…¨ç›¸åŒçš„å˜é‡æˆ–å‡½æ•°ï¼Œå¯¼è‡´çˆ¶ç±»çš„åŒåå…ƒç´ è¢«éšè—ã€‚ ####è™šå‡½æ•°çš„åº•å±‚å®ç°ï¼Œå¤šç»§æ‰¿ï¼ˆä¸€ä¸ªæ´¾ç”Ÿç±»ç»§æ‰¿å¤šä¸ªåŸºç±»ï¼‰çš„è™šæŒ‡é’ˆçš„è™šè¡¨çš„å½¢å¼ è™šå‡½æ•°çš„åº•å±‚ä¾èµ–è™šæŒ‡é’ˆ(vptr)å’Œè™šå‡½æ•°è¡¨(vtable)ã€‚å¤šç»§æ‰¿æ˜¯ä¸€ä¸ªæ´¾ç”Ÿç±»ç»§æ‰¿å¤šä¸ªåŸºç±»ï¼Œå¤šç»§æ‰¿ä¸­çš„è™šæŒ‡é’ˆå’Œè™šå‡½æ•°ä¸ºå¦‚ä¸‹ï¼š è™šæŒ‡é’ˆï¼ˆ4&#x2F;8å­—èŠ‚ï¼‰ï¼šæ¯ä¸ªå«æœ‰è™šå‡½æ•°çš„ç±»éƒ½ä¼šæœ‰ä¸€ä¸ªè™šæŒ‡é’ˆï¼ŒæŒ‡å‘è™šå‡½æ•°è¡¨è™šå‡½æ•°è¡¨ï¼šè™šå‡½æ•°è¡¨æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼Œå­˜æ”¾ç€è™šå‡½æ•°çš„åœ°å€ã€‚æ¯ä¸ªç»§æ‰¿è‡ªåŸºç±»çš„æ´¾ç”Ÿç±»éƒ½æœ‰è‡ªå·±çš„è™šå‡½æ•°è¡¨ï¼Œè™šå‡½æ•°è¡¨ä¸­çš„å‡½æ•°æŒ‡é’ˆé¡ºåºä¸åŸºç±»çš„å‡½æ•°å£°æ˜é¡ºåºä¸€è‡´ã€‚ï¼ˆæœ‰å¤šå°‘ä¸ªè™šå‡½æ•°ï¼Œå°±æœ‰å¤šå°‘ä¸ªå‡½æ•°æŒ‡é’ˆï¼‰è™šææ„å‡½æ•°ï¼šåœ¨åˆ é™¤æŒ‡é’ˆçš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ã€‚å¦‚æœåŸºç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šçš„ï¼Œé‚£ä¹ˆåˆ é™¤åŸºç±»æŒ‡é’ˆæ—¶åªä¼šè°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œä»è€Œå¯¼è‡´èµ„æºæœªæ­£ç¡®é‡Šæ”¾ä»¥åŠå†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚ å¦‚æœä¸€ä¸ªç±»ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåˆ™sizeof()æ˜¯1ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè™šå‡½æ•°ï¼Œåˆ™sizeof()æ˜¯8ï¼Œå› ä¸ºè™šæŒ‡é’ˆ8ä¸ªå­—èŠ‚ã€‚è™šå‡½æ•°æŒ‡é’ˆé€šå¸¸ä½äºå¯¹è±¡çš„å¼€å§‹ä½ç½®ã€‚ å¦å¤–ï¼Œè™šå‡½æ•°è¡¨å­˜å‚¨åœ¨å¸¸é‡åŒºçš„æ•°æ®æ®µï¼ˆåªè¯»æ•°æ®æ®µï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€æ•°æ®ç»“æ„ï¼Œåœ¨ç¼–è¯‘å¼å°±ç¡®å®šäº†ï¼Œåé¢ä¸ä¼šä¿®æ”¹ã€‚ ####é™¤äº†å¤šæ€å’Œç»§æ‰¿è¿˜æœ‰ä»€ä¹ˆé¢å‘å¯¹è±¡æ–¹æ³•*** å°è£…ï¼šå°†å¯¹è±¡å±æ€§å’Œè¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¹¶é™åˆ¶å¯¹è¿™äº›å±æ€§çš„è®¿é—®ï¼Œéšè—ç»†èŠ‚ æŠ½è±¡ï¼šé€šè¿‡åˆ›å»ºå¤–ç•Œæ¥å£ï¼Œéšè—åº•å±‚ç»†èŠ‚ ç»„åˆï¼šä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼ŒäºŒè€…æ˜¯åŒç”Ÿæ­»çš„å…³ç³» èšåˆï¼šå¼±ç»„åˆï¼Œå¯ä»¥å•ç‹¬å­˜åœ¨ï¼ˆç»“æ„ä½“ï¼‰ åŠ¨æ€ç»‘å®šç¨‹åºè¿è¡Œæ—¶æ‰ç¡®å®šè¦è°ƒç”¨çš„å‡½æ•°ç‰ˆæœ¬ æ¯ä¸ªåŒ…å«è™šå‡½æ•°çš„å¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘è™šå‡½æ•°è¡¨çš„æŒ‡é’ˆ åŸºç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œä½¿ç”¨æŒ‡é’ˆè°ƒç”¨è™šå‡½æ•°ï¼Œä¼šæ ¹æ®å®é™…çš„æ´¾ç”Ÿç±»å¯¹è±¡è°ƒç”¨è™šå‡½æ•° ####æŠ½è±¡ç±»ä¸çº¯è™šå‡½æ•°ï¼Œä½œç”¨ï¼Œæœ‰å‡½æ•°ä½“æ˜¯å¦ç¼–è¯‘ æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚çº¯è™šå‡½æ•°æ˜¯æ²¡æœ‰å‡½æ•°ä½“çš„è™šå‡½æ•°ï¼Œç›®çš„å°±æ˜¯è®©æ´¾ç”Ÿç±»é‡å†™ã€‚å½“ä¸€ä¸ªç±»æœ‰çº¯è™šå‡½æ•°çš„æ—¶å€™ï¼Œå°±æ˜¯æŠ½è±¡ç±»ã€‚ çº¯è™šå‡½æ•°ï¼švirtual float getArea() = 0; ####overrideå’Œfinalçš„ä½œç”¨ overrideç”¨äºæŒ‡å®šæ´¾ç”Ÿç±»ä¸­ä¸€ä¸ªå‡½æ•°æ˜¯ç”¨æ¥é‡å†™çš„ï¼Œä»¥ç¡®ä¿å­ç±»å‡½æ•°å’Œçˆ¶ç±»å‡½æ•°åæ‰ç›¸åŒï¼Œè¡¨æ˜äº†å‡½æ•°é‡å†™çš„æ„å›¾ finalä½œç”¨äºç±»çš„æ—¶å€™ï¼Œè¡¨æ˜è¯¥ç±»ä¸èƒ½è¢«å…¶ä»–ç±»ç»§æ‰¿ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ç±»çš„ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ã€‚åŒæ—¶ï¼Œæœ‰finalçš„å‡½æ•°ï¼Œä¸èƒ½åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™ã€‚ ç»†è®²staticï¼ŒåŒ…æ‹¬staticæˆå‘˜å˜é‡ä¸å‡½æ•°staticæˆå‘˜å˜é‡è¢«ç±»çš„æ‰€æœ‰å¯¹è±¡å…±äº«ã€‚ staticæˆå‘˜å‡½æ•°æ˜¯å±äºç±»çš„ï¼Œåœ¨æ²¡æœ‰åˆ›å»ºç±»çš„å®ä¾‹æ—¶ä¹Ÿå¯ç›´æ¥åªç”¨ã€‚å®ƒä»¬ä¸èƒ½è®¿é—®ç±»çš„éé™æ€æˆå‘˜ï¼Œå› ä¸ºéé™æ€æˆå‘˜éœ€è¦ç±»çš„å®ä¾‹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstaticæˆå‘˜å˜é‡å’Œå‡½æ•°çš„ä½œç”¨åŸŸä»…é™äºå®šä¹‰å®ƒä»¬çš„ç±»ã€‚è¦åœ¨ç±»å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åŠ :: ####ç»™å®šç±»ï¼Œåˆ¤æ–­å¤§å°ï¼ŒåŒ…æ‹¬ç©ºç±»ï¼ŒåŠ å…¥staticï¼ŒåŠ å…¥è™šå‡½æ•°ï¼Œè€ƒè™‘åˆ°å†…å­˜å¯¹é½ç©ºç±»çš„å¤§å°ä¸º1staticæˆå‘˜å˜é‡ä¸å½±å“ç±»çš„å¤§å°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„ã€‚é™æ€æˆå‘˜å˜é‡åœ¨å­ç±»çš„å®ä¾‹ä¹‹å¤–å•ç‹¬åˆ†é…å†…å­˜è™šå‡½æ•°ï¼šæœ‰è™šå‡½æ•°çš„ç±»ä¼šæ¯”æ²¡æœ‰è™šå‡½æ•°çš„ç±»å¤šä¸€ä¸ª8å­—èŠ‚çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆå†…å­˜å¯¹é½ï¼šæ ¹æ®ä¸åŒå¹³å°å’Œç¼–è¯‘å™¨ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šåœ¨ç±»æˆå‘˜ä¹‹é—´æ·»åŠ å¡«å……å­—èŠ‚ï¼Œä»¥ç¡®ä¿æ•°æ®å¯¹é½ã€‚ å¦‚ä½•è®©ç±»åªèƒ½åœ¨å †ä¸Šåˆ›å»ºï¼Œä¸èƒ½åœ¨æ ˆä¸Šåˆ›å»ºï¼Ÿ12345678910111213141516class HeapOnly &#123;private: HeapOnly() &#123;&#125; // ç§æœ‰æ„é€ å‡½æ•° ~HeapOnly() &#123;&#125; // ç§æœ‰ææ„å‡½æ•°public: // ä½¿ç”¨é™æ€æˆå‘˜å‡½æ•°åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡çš„å®ä¾‹ static HeapOnly* Create() &#123; return new HeapOnly(); &#125; // æ·»åŠ æˆå‘˜å‡½æ•°ä»¥é‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ void Destroy() &#123; delete this; &#125;&#125;; å…¶ä»– RPCï¼šæ˜¯ä¸€ç§å…è®¸ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼ˆé€šå¸¸åœ¨å¦ä¸€å°å…±äº«ç½‘ç»œçš„è®¡ç®—æœºä¸Šï¼‰çš„ç¨‹åºçš„æŠ€æœ¯ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°å­ç¨‹åºä¸€æ · æ•°æ®åºåˆ—åŒ–ï¼šæ•°æ®åºåˆ—åŒ–æ˜¯å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„æ ¼å¼çš„è¿‡ç¨‹ã€‚é€šè¿‡åºåˆ—åŒ–ï¼Œå¤æ‚çš„æ•°æ®ç»“æ„å¯ä»¥è¢«è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œä»è€Œä¾¿äºå­˜å‚¨åˆ°æ–‡ä»¶ã€æ•°æ®åº“ï¼Œæˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“ã€‚å¦‚json xml ååºåˆ—åŒ–åˆ™æ˜¯å°†å­—èŠ‚æµæ¢å¤æˆåŸå§‹æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€çš„è¿‡ç¨‹ã€‚ ç½‘ç»œä¼ è¾“ç”¨çš„å¤§ç«¯-é«˜å­—èŠ‚å­˜ä½åœ°å€ ###å¼•ç”¨å’ŒæŒ‡é’ˆ 123456int x=10;int *p=&amp;x;int &amp;y=x;int z=*p;ä½¿ç”¨éœ€è¦è§£å¼•ç”¨int z=y; yæ˜¯xçš„åˆ«å ###é™æ€å˜é‡åœ¨å“ªé‡Œåˆå§‹åŒ– ç¨‹åºå¼€å§‹æ—¶åˆå§‹åŒ–ï¼Œå†…å­˜åˆ†é…åœ¨ç¼–è¯‘æœŸé—´å®Œæˆï¼Œå ç”¨å†…å­˜å¤§å°å›ºå®šã€‚ åœ¨å†…å­˜çš„é™æ€&#x2F;å…¨å±€åŒºï¼Œè¿™éƒ¨åˆ†ç”¨äºå­˜å‚¨å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚ ç¼–è¯‘è¿‡ç¨‹ï¼Œé‚£é™æ€å˜é‡æ˜¯åœ¨å“ªä¸ªé˜¶æ®µåˆå§‹åŒ–çš„?é¢„å¤„ç†ï¼šå®æ›¿æ¢ã€å¤´æ–‡ä»¶åŒ…å«ç­‰ç¼–è¯‘ï¼šè½¬ä¸ºæ±‡ç¼–æ±‡ç¼–ï¼šè½¬ä¸ºæœºå™¨è¯­è¨€é“¾æ¥ï¼šå°†å¤šä¸ªæ–‡ä»¶å’Œéœ€è¦çš„åº“æ–‡ä»¶é“¾æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå…¨å±€é™æ€å˜é‡çš„åˆå§‹åŒ–å€¼å­˜å‚¨åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè€Œå‡½æ•°å†…çš„å±€éƒ¨é™æ€å˜é‡åœ¨å‡½æ•°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚ ä¸ºä»€ä¹ˆéœ€è¦é“¾æ¥è¿™ä¸ªè¿‡ç¨‹ï¼Ÿ æ•´åˆæºæ–‡ä»¶ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé“¾æ¥æ‰€éœ€çš„åŠ¨æ€åº“ï¼Œæ–¹ä¾¿åŠ¨æ€åº“çš„æ›¿æ¢ã€‚ å·¦å€¼å’Œå³å€¼ï¼Ÿå·¦å€¼ å¯ä»¥å–åœ°å€ å…·æœ‰æŒä¹…æ€§ å³å€¼ å°†äº¡å€¼ ä¸èƒ½å–åœ°å€ è¡¨ç¤ºä¸´æ—¶ç»“æœï¼Œå­—é¢å€¼æˆ–ä¸èƒ½è¢«èµ‹å€¼çš„å¯¹è±¡ ###å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ„ä¹‰ï¼Ÿ å·¦å€¼å¼•ç”¨ï¼š ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’é¿å…æ‹·è´ å¯ä»¥æ ¹æ®å‚æ•°æ˜¯å·¦å€¼å¼•ç”¨è¿˜æ˜¯å¸¸é‡å·¦å€¼å¼•ç”¨è¿›è¡Œå‡½æ•°é‡è½½ æ“ä½œç¬¦é‡è½½ å®ç°é“¾å¼è°ƒç”¨ Vector&amp; operator+&#x3D;(const Vector&amp; other) å³å€¼å¼•ç”¨ï¼šå³å€¼å¼•ç”¨å£°æ˜ç¬¦ &amp;&amp; ç§»åŠ¨è¯­ä¹‰ï¼šç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦é…åˆstd::moveä½¿ç”¨ MyString(MyString&amp;&amp; other) noexcept : data(other.data), length(other.length) MyString&amp; operator&#x3D;(MyString&amp;&amp; other) noexcept å®Œç¾è½¬å‘ï¼šstd::forward()ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ä¿æŒå‚æ•°çš„ç±»å‹å’Œå€¼ç±»åˆ«ï¼ˆå·¦å€¼æˆ–å³å€¼ï¼‰ä¸å˜ å£°æ˜å‡ºæ¥çš„å·¦å€¼å¼•ç”¨ã€å³å€¼å¼•ç”¨éƒ½æ˜¯å·¦å€¼###æ¶‰åŠatoiå‡½æ•°è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Ÿè¿™æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼ˆconst char* -&gt; intï¼‰ï¼Œéœ€è¦è€ƒè™‘ï¼š ç©ºå­—ç¬¦ä¸²å¤„ç†ç©ºæ ¼å¤„ç†æ•°å€¼èŒƒå›´ç¬¦å·ï¼Œå¯èƒ½æ•°å­—å‰é¢æœ‰æ­£è´Ÿå·ï¼Œä»¥ç¡®å®šè¿”å›çš„æ•´æ•°åº”è¯¥æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•° æ‰¾ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ï¼Œè¯†åˆ«åŠ å‡å·æˆ–æ•°å­—ï¼Œè¿”å›int11aè¿”å›11 æ— å½±å“a11è¿”å›0 newå’Œmallocçš„åŒºåˆ«ï¼Ÿ***newæ˜¯C++çš„ä¸€ä¸ªæ“ä½œç¬¦ï¼Œmallocæ˜¯åº“å‡½æ•°newä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œmallocåªæ˜¯åˆ†é…å†…å­˜å…³äºè¿”å›å€¼ï¼Œnewä¼šè¿”å›å¯¹åº”ç±»å‹çš„æŒ‡é’ˆï¼Œmallocè¿”å›void* ï¼ˆvoid*éœ€è¦æ˜¾ç¤ºè½¬æ¢æ‰èƒ½è§£å¼•ç”¨ï¼Œå¯ä»¥ç”¨äºé€šç”¨å‡½æ•°å‚æ•°ï¼‰åœ¨å›æ”¶å†…å­˜çš„æ—¶å€™ï¼Œnewé‡‡ç”¨deleteæˆ–delete[]ï¼Œmallocé‡‡ç”¨freeä½¿ç”¨newçš„æ—¶å€™å…ˆè°ƒç”¨mallocï¼Œå†è°ƒç”¨æ„é€ ï¼›deleteæ—¶ï¼Œå…ˆè°ƒç”¨ææ„ï¼Œå†è°ƒç”¨free defineå’Œconstçš„åŒºåˆ«ï¼Ÿ#defineå¸¸å¸¸ç”¨äºå®å®šä¹‰ï¼Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µï¼Œä½†æ˜¯æ²¡æœ‰ç±»å‹æ£€æŸ¥å¯¼è‡´éš¾ä»¥å‘ç°çš„é”™è¯¯ï¼Œå¹¶ä¸”æ²¡æœ‰ä½œç”¨åŸŸï¼Œèƒ½ä½¿ç”¨#undefå–æ¶ˆå®šä¹‰ cosntæ˜¯å¸¸é‡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µã€‚æœ‰ä½œç”¨åŸŸå’Œç±»å‹æ£€æŸ¥ï¼Œä¾¿äºè°ƒè¯•ã€‚ ###å†…å­˜æ³„æ¼çš„æŸ¥æ‰¾æ–¹æ³•æ£€æŸ¥ä»£ç ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰åˆ†é…å†…å­˜ä½†æ˜¯æ²¡æœ‰é‡Šæ”¾çš„æƒ…å†µå†…å­˜åˆ†æå·¥å…·ï¼Œæ¯”å¦‚C++çš„Valgrindï¼ŒGoå†…ç½®çš„pprofåŠŸèƒ½ä½¿ç”¨RAIIï¼Œæ¯”å¦‚C++çš„åªèƒ½æŒ‡é’ˆä¸€èˆ¬å †å†…å­˜æ³„éœ²å°±æ˜¯ç”³è¯·äº†å†…å­˜èµ„æºæ²¡æœ‰é‡Šæ”¾ï¼Œæ ˆå†…å­˜æ³„æ¼æ¯”è¾ƒå°‘è§ï¼Œä¸€èˆ¬å‘ç”Ÿåœ¨æ ˆæº¢å‡ºçš„æƒ…å†µï¼Œæ˜¯ç”±äºé€’å½’è¿‡æ·±å¯¼è‡´çš„ï¼Œæˆ–è€…ç”¨äº†è¿‡å¤§çš„å±€éƒ¨å˜é‡ï¼Œéœ€è¦æ£€æŸ¥ä»£ç ã€‚ Linuxè¿›ç¨‹é—´é€šä¿¡ ç®¡é“(pipe)ã€æµç®¡é“(s_pipe)ã€æœ‰åç®¡é“(FIFO) ä¿¡å·(signal) æ¶ˆæ¯é˜Ÿåˆ— å…±äº«å†…å­˜ ä¿¡å·é‡ å¥—æ¥å­—(socket) ###æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«ï¼Œå¼•ç”¨åˆå§‹åŒ–åæ˜¯å¯å˜çš„å— æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼Œå¼•ç”¨æ˜¯ä¸€ä¸ªå˜é‡çš„åˆ«åï¼Œå¼•ç”¨å¿…é¡»åˆå§‹åŒ–ï¼Œå› ä¸ºåœ¨ä¹‹åæ— æ³•æ”¹å˜å¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡ã€‚ å¼•ç”¨åœ¨æœ¬è´¨ä¸Š æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œå³æ‰€æŒ‡çš„å¯¹è±¡ä¸èƒ½å‘ç”Ÿæ”¹å˜ï¼Œä½†å¯ä»¥æ”¹å˜æŒ‡å‘å¯¹è±¡çš„å€¼ã€‚ ###sizeofå¼•ç”¨å’ŒsizeofæŒ‡é’ˆçš„åŒºåˆ«ï¼ŒæŒ‡é’ˆå’Œå¼•ç”¨å ç”¨å†…å­˜ç©ºé—´å—ï¼Ÿç†è§£å¼•ç”¨æ˜¯å•¥æ„æ€å— sizeofæŒ‡é’ˆè¿”å›çš„æ˜¯æŒ‡é’ˆçš„å¤§å°ï¼Œ4ä¸ªå­—èŠ‚ï¼Œsizeofå¼•ç”¨è¿”å›çš„æ˜¯æŒ‡å‘å¯¹è±¡çš„å¤§å°ï¼Œæ¯”å¦‚ä¸€ä¸ªfloatå°±æ˜¯8å­—èŠ‚ã€‚ ###å†…å­˜ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿæ˜¾å¼deleteæ‰ä¼šå›æ”¶å—ï¼Ÿä»€ä¹ˆæ—¶å€™å¯¹è±¡ç”Ÿå‘½å‘¨æœŸåˆ°è¾¾ï¼Ÿæ ˆé‡Œé¢çš„å¯¹è±¡ä¼šè‡ªåŠ¨å›æ”¶å—ï¼Ÿå¸¸é‡ä¼šè‡ªåŠ¨å›æ”¶å—ï¼ŸC++æ˜¯è¿™æ ·çš„ï¼Œæ˜¾ç¤ºdeleteå›æ”¶ã€‚å¯¹äºæ ˆä¸­çš„å¯¹è±¡ï¼Œæ— éœ€æ˜¾ç¤ºåˆ é™¤ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œä¼šè‡ªåŠ¨å›æ”¶ã€‚ å…¨å±€å¸¸é‡åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œå‘¨æœŸéƒ½åœ¨ï¼Œå±€éƒ¨å¸¸é‡ä¸ä½œç”¨åŸŸæœ‰å…³ã€‚ä¹Ÿä¸éœ€è¦æ˜¾ç¤ºå›æ”¶ã€‚ memcpyå‡½æ•°å®ç°ï¼Œmemmoveå‘¢1234567891011121314151617181920212223242526272829//memcpyvoid *my_memcpy(void *dest, const void *src, size_t n) &#123; char *d = (char *)dest; const char *s = (const char *)src; for (size_t i = 0; i &lt; n; i++) &#123; d[i] = s[i]; &#125; return dest;&#125;//memmoveèƒ½å¤„ç†å†…å­˜é‡å void *my_memmove(void *dest, const void *src, size_t n) &#123; char *d = (char *)dest; const char *s = (const char *)src; if (d &lt; s) &#123; // ä»å‰å¾€åå¤åˆ¶ for (size_t i = 0; i &lt; n; i++) &#123; d[i] = s[i]; &#125; &#125; else &#123; // ä»åå¾€å‰å¤åˆ¶ï¼Œå¤„ç†å†…å­˜é‡å æƒ…å†µ for (size_t i = n; i &gt; 0; i--) &#123; d[i - 1] = s[i - 1]; &#125; &#125; return dest;&#125; å¦‚æœå°†ä¸€ä¸ªæ¨¡æ¿ç±»çš„.hæ–‡ä»¶å’Œ.cppæ–‡ä»¶åˆ†å¼€ï¼Œåˆ«çš„æ–‡ä»¶è°ƒç”¨è¯¥åŒ…ï¼Œä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ï¼Ÿä¸ºä»€ä¹ˆæ™®é€šçš„ç±»å°±å¯ä»¥åˆ†å¼€å‘¢ï¼Ÿæ¨¡æ¿ç±»æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œå¦‚æœå°†å®šä¹‰æ”¾åœ¨.cppæ–‡ä»¶ä¸­ä¼šå¯¼è‡´ç¼–è¯‘å™¨åœ¨å¤„ç†å…¶ä»–æºæ–‡ä»¶çš„æ—¶å€™æ‰¾ä¸åˆ°å®Œæ•´çš„æ¨¡æ¿å®šä¹‰ã€‚å¯¹äºæ¨¡æ¿ç±»ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“å¯èƒ½çš„æ‰€æœ‰ç±»å‹å‚æ•°ï¼Œå› æ­¤éœ€è¦åœ¨ä½¿ç”¨æ¨¡æ¿æ—¶ç”Ÿæˆå…·ä½“å®ä¾‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªæœ‰ä¿ç•™æ¨¡æ¿ç±»çš„å£°æ˜ï¼Œå¹¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­æ·»åŠ å®ç°ã€‚ æ¨¡æ¿ç±»æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šçš„ï¼Œä¸æ˜¯åŠ¨æ€ç»‘å®šçš„ã€‚ ä¸ºä»€ä¹ˆæ™®é€šçš„ç±»å°±å¯ä»¥åˆ†å¼€å‘¢ï¼Ÿ ç”Ÿæˆç¨‹åºçš„æ—¶å€™æœ‰ç¼–è¯‘åˆ°é“¾æ¥çš„æœºåˆ¶ï¼Œé“¾æ¥é˜¶æ®µä¼šæŠŠè¿™äº›æ–‡ä»¶è¿æ¥èµ·æ¥ï¼Œè€Œæ¨¡æ¿ç±»åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“å¯èƒ½çš„æ‰€æœ‰ç±»å‹å‚æ•°ï¼Œå› æ­¤éœ€è¦åœ¨ä½¿ç”¨æ¨¡æ¿æ—¶ç”Ÿæˆå…·ä½“å®ä¾‹ã€‚åœ¨é“¾æ¥é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ‰€æœ‰å…·ä½“ç±»å‹çš„æ¨¡æ¿å®ä¾‹æ˜¯å¦ç”Ÿæˆäº†ç›¸åº”çš„ä»£ç ï¼Œå¦‚æœæ‰¾ä¸åˆ°å®ä¾‹ï¼Œå°±ä¼šæŠ¥é“¾æ¥é”™è¯¯ã€‚æ€»ç»“ï¼šé“¾æ¥çš„æ—¶å€™ä¸çŸ¥é“å…·ä½“ç±»å‹ï¼Œæ— æ³•æ•´åˆ .hppæ–‡ä»¶å£°æ˜å’Œå®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ å¦‚ï¼šå†…è”å‡½æ•°ï¼Œæ¨¡æ¿ç±»æ¨¡æ¿å‡½æ•°ï¼Œå°å‹åº“","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"Qté¢è¯•","slug":"source/é¢è¯•/Qté¢è¯•å‡†å¤‡","date":"2024-06-08T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2024/06/09/source/é¢è¯•/Qté¢è¯•å‡†å¤‡/","permalink":"http://example.com/2024/06/09/source/%E9%9D%A2%E8%AF%95/Qt%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/","excerpt":"","text":"æ ¸å¿ƒæœºåˆ¶å…ƒå¯¹è±¡ç³»ç»Ÿ (ä¿¡å·ä¸æ§½ è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ åŠ¨æ€å±æ€§) â€‹ ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿QObjectå¯ä»¥ä½¿ç”¨ â€‹ å£°æ˜Q_OBJECTå® â€‹ å…ƒå¯¹è±¡ç¼–è¯‘å™¨moc å°†ä»£ç è½¬åŒ–ç»™c++ç¼–è¯‘å™¨ å±æ€§ç³»ç»Ÿ ä¿¡å·ä¸æ§½ Qtåˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ QThread æœ€æ–¹ä¾¿ å¯å¼€å¯äº‹ä»¶å¾ªç¯ å¯ä¿¡å· 123QThread *t=new QThread;server * worker=new server;worker-&gt;moveToThread(t); æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿è‡ªQthread è¿™æ ·å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’å‚æ•° 12server *serverthread=new server(seed,myserver-&gt;nextPendingConnection());serverthread-&gt;start(); QtConcurrent::run() åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¼‚æ­¥å¤„ç†äº‹åŠ¡ æ›´ç®€æ´æ–¹ä¾¿ 12345678QT += core gui concurrent QFuture&lt;void&gt; future = QtConcurrent::run([this]() &#123; //æˆ–è°ƒç”¨ä¸€ä¸ªå‡½æ•° // Simulate a long-running task QThread::sleep(5); // Sleep for 5 seconds // Update the label text (this part runs in the main thread) QMetaObject::invokeMethod(this, &quot;updateLabel&quot;, Qt::QueuedConnection); &#125;); QThreadPool å’Œ QRunnable é€‚åˆå¤šä¸ªå¯¹è±¡å’Œå¤æ‚æƒ…å†µ 12345678910111213MyTask *task = new MyTask(label);QThreadPool::globalInstance()-&gt;start(task);class MyTask : public QRunnable &#123;public: MyTask(QLabel *label) : m_label(label) &#123;&#125; void run() override &#123; // Simulate a long-running task QThread::sleep(5); // Sleep for 5 seconds QMetaObject::invokeMethod(m_label, &quot;setText&quot;, Qt::QueuedConnection,Q_ARG(QString, &quot;Task Completed!&quot;)); &#125;private: QLabel *m_label;&#125;; ä¿¡å·ä¸æ§½ç±»ä¼¼è§‚å¯Ÿè€…æ¨¡å¼ å¯¹è±¡é—´ä¼ é€’æ¶ˆæ¯ï¼šå›è°ƒå‡½æ•° MFCå°±æ˜¯ä½¿ç”¨è¿™ä¸ª ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ ä¸ä¿è¯ç±»å‹å®‰å…¨ 12345678910void printWelcome(int len)&#123;printf(&quot;æ¬¢è¿æ¬¢è¿ -- %d/n&quot;, len);&#125;void printGoodbye(int len)&#123;printf(&quot;é€å®¢é€å®¢ -- %d/n&quot;, len);&#125;void callback(int times, void(*print)(int))&#123; int i; for (i = 0; i &lt; times; ++i) &#123; print(i); &#125; printf(&quot;/næˆ‘ä¸çŸ¥é“ä½ æ˜¯è¿å®¢è¿˜æ˜¯é€å®¢!/n/n&quot;);&#125; void main(void)&#123; callback(2, printWelcome); callback(2, printGoodbye);&#125; å¯¹è±¡æ ‘ï¼šè‡ªåŠ¨æœ‰æ•ˆç®¡ç†ç»§æ‰¿è‡ªQObjectçš„Qtå¯¹è±¡ çˆ¶å¯¹è±¡è¢«ææ„æ—¶å­å¯¹è±¡ä¹Ÿææ„ é¿å…å†…å­˜æ³„æ¼ 1234567891011121314151617signalsemitslots å¯ä»¥ä¸ç”¨å£°æ˜è¿™ä¸ªå…³é”®å­—ï¼Œä½†æ˜¯ä¸€èˆ¬éœ€è¦è®¾ç½®connectçš„ç¬¬äº”ä¸ªå‚æ•°å¯ä»¥ä¸ç”¨é˜»å¡ç­‰å¾…æ§½å‡½æ•°å®Œæˆæ‰§è¡Œ//ä¸¤ä¸ªåŸå‹ï¼šconnect(pushButton, SIGNAL(clicked()), dialog, SLOT(close()));connect(pushButton, &amp;QPushButton::clicked, dialog, &amp;QDialog::close);//ä¿¡å·å‘é€è€…æŒ‡é’ˆï¼Œä¿¡å·å‡½æ•°å­—ç¬¦ä¸²/ä¿¡å·å‡½æ•°åœ°å€ï¼Œæ§½//lambdaè¡¨è¾¾å¼connect(anysocket, &amp;QTcpSocket::disconnected, this, [=]() &#123; &#125;);//åŒä¸€ä¸ªç±»ä¸­çš„åŒ¿åå‡½æ•°connect(this, &amp;A::sig_hello, []&#123; qDebug() &lt;&lt; &quot;hello world!&quot;;&#125;); å¯é€šè¿‡uiç•Œé¢ç»‘å®šä¿¡å·ä¸æ§½ https://blog.csdn.net/ddllrrbb/article/details/88374350 QSignalMapper ç»‘å®šå¯¹è±¡æ•°æ®ä¸€å¹¶ä¼ é€’ ç¬¬äº”ä¸ªå‚æ•°ï¼š äº‹ä»¶è¿‡æ»¤å™¨é‡å†™eventFilteræ–¹æ³• ä¸ä¼šå¤„ç†è¿™ä¸ªä¿¡å· ç»™QApplicationå®‰è£…ï¼Œå®ç°å…¨å±€ 12345678910111213bool eventFilter(QObject *watched, QEvent *event) override &#123; if (event-&gt;type() == QEvent::MouseButtonPress) &#123; qDebug() &lt;&lt; &quot;Button clicked&quot;; // å¤„ç†äº‹ä»¶ï¼Œè¿”å› true è¡¨ç¤ºäº‹ä»¶å·²ç»è¢«å¤„ç†ï¼Œä¸éœ€è¦ç»§ç»­ä¼ æ’­ return true; &#125; // å…¶ä»–äº‹ä»¶ï¼Œç»§ç»­ä¼ æ’­ return QObject::eventFilter(watched, event); &#125;MyEventFilter *eventFilter = new MyEventFilter();// åœ¨æŒ‰é’®ä¸Šå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨button-&gt;installEventFilter(eventFilter); ä¿è¯çº¿ç¨‹å®‰å…¨ äº’æ–¥é‡ï¼ˆQMutexï¼‰QMutex m_Mutex; m_Mutex.lock(); m_Mutex.unlock(); äº’æ–¥é”ï¼ˆQMutexLockerï¼‰QMutexLocker mutexLocker(&amp;m_Mutex);ä»å£°æ˜å¤„å¼€å§‹ï¼ˆåœ¨æ„é€ å‡½æ•°ä¸­åŠ é”ï¼‰ï¼Œå‡ºäº†ä½œç”¨åŸŸè‡ªåŠ¨è§£é”ï¼ˆåœ¨ææ„å‡½æ•°ä¸­è§£é”ï¼‰ã€‚ ç­‰å¾…æ¡ä»¶ï¼ˆQWaitConditionï¼‰QWaitCondtion m_WaitCondition; m_WaitConditon.wait(&amp;m_muxtex, time);m_WaitCondition.wakeAll(); QReadWriteLockç±»ã€‹ä¸€ä¸ªçº¿ç¨‹è¯•å›¾å¯¹ä¸€ä¸ªåŠ äº†è¯»é”çš„äº’æ–¥é‡è¿›è¡Œä¸Šè¯»é”ï¼Œå…è®¸ï¼›ã€‹ä¸€ä¸ªçº¿ç¨‹è¯•å›¾å¯¹ä¸€ä¸ªåŠ äº†è¯»é”çš„äº’æ–¥é‡è¿›è¡Œä¸Šå†™é”ï¼Œé˜»å¡ï¼›ã€‹ä¸€ä¸ªçº¿ç¨‹è¯•å›¾å¯¹ä¸€ä¸ªåŠ äº†å†™é”çš„äº’æ–¥é‡è¿›è¡Œä¸Šè¯»é”ï¼Œé˜»å¡ï¼›ã€ã€‹ä¸€ä¸ªçº¿ç¨‹è¯•å›¾å¯¹ä¸€ä¸ªåŠ äº†å†™é”çš„äº’æ–¥é‡è¿›è¡Œä¸Šå†™é”ï¼Œé˜»å¡ã€‚è¯»å†™é”æ¯”è¾ƒé€‚ç”¨çš„æƒ…å†µæ˜¯ï¼šéœ€è¦å¤šæ¬¡å¯¹å…±äº«çš„æ•°æ®è¿›è¡Œè¯»æ“ä½œçš„é˜…è¯»çº¿ç¨‹ã€‚QReadWriterLock ä¸QMutexç›¸ä¼¼ï¼Œé™¤äº†å®ƒå¯¹ â€œreadâ€,â€writeâ€è®¿é—®è¿›è¡ŒåŒºåˆ«å¯¹å¾…ã€‚å®ƒä½¿å¾—å¤šä¸ªè¯»è€…å¯ä»¥å…±æ—¶è®¿é—®æ•°æ®ã€‚ä½¿ç”¨QReadWriteLockè€Œä¸æ˜¯QMutexï¼Œå¯ä»¥ä½¿å¾—å¤šçº¿ç¨‹ç¨‹åºæ›´å…·æœ‰å¹¶å‘æ€§ã€‚ ä¿¡å·é‡QSemaphoreä½†æ˜¯è¿˜æœ‰äº›äº’æ–¥é‡ï¼ˆèµ„æºï¼‰çš„æ•°é‡å¹¶ä¸æ­¢ä¸€ä¸ªï¼Œæ¯”å¦‚ä¸€ä¸ªç”µè„‘å®‰è£…äº†2ä¸ªæ‰“å°æœºï¼Œæˆ‘å·²ç»ç”³è¯·äº†ä¸€ä¸ªï¼Œä½†æ˜¯æˆ‘ä¸èƒ½éœ¸å è¿™ä¸¤ä¸ªï¼Œä½ æ¥è®¿é—®çš„æ—¶å€™å¦‚æœå‘ç°è¿˜æœ‰ç©ºé—²çš„ä»ç„¶å¯ä»¥ç”³è¯·åˆ°çš„ã€‚äºæ˜¯è¿™ä¸ªäº’æ–¥é‡å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå·²ä½¿ç”¨å’Œæœªä½¿ç”¨ã€‚ QReadLockerä¾¿åˆ©ç±»å’ŒQWriteLockerä¾¿åˆ©ç±»å¯¹QReadWriteLockè¿›è¡ŒåŠ è§£é” å…¶ä»–QTä¸­çš„æ™ºèƒ½æŒ‡é’ˆå°è£…ä¸ºQPointerç±» æ–‡ä»¶æµ æ–‡ä»¶æµ(QTextStream):æ“ä½œè½»é‡çº§æ•°æ®ï¼ˆint,double,QStringï¼‰æ•°æ®å†™å…¥æ–‡æœ¬ä»¶ä¸­ä»¥åä»¥æ–‡æœ¬çš„æ–¹å¼å‘ˆç°ã€‚æ•°æ®æµ(QDataStream):é€šè¿‡æ•°æ®æµå¯ä»¥æ“ä½œå„ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹è±¡ï¼Œå­˜å‚¨åˆ°æ–‡ä»¶ä¸­æ•°æ®ä¸ºäºŒè¿›åˆ¶ã€‚ æ–‡ä»¶æµï¼Œæ•°æ®æµéƒ½å¯ä»¥æ“ä½œç£ç›˜æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ“ä½œå†…å­˜æ•°æ®ã€‚é€šè¿‡æµå¯¹è±¡å¯ä»¥å°†å¯¹è±¡æ‰“åŒ…åˆ°å†…å­˜ï¼Œè¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ postè¯·æ±‚ Qtå¦‚ä½•å‘é€ä¸€ä¸ªHTTP postè¯·æ±‚å¹¶æ¥æ”¶æ¶ˆæ¯ï¼Ÿåœ¨proæ–‡ä»¶æ·»åŠ networkæ¨¡å—ï¼ˆä½¿ç”¨qmakeæ—¶ï¼‰ä½¿ç”¨ç½‘ç»œè¿æ¥è¯·æ±‚ç±»(QNetworkRequest)ï¼Œæ·»åŠ URLç½‘å€ï¼Œå¹¶è®¾ç½®HTTPçš„å¤´éƒ¨è¡Œä½¿ç”¨ç½‘ç»œè®¿é—®ç®¡ç†å™¨ç±»(QNetworkAccessManager)å‘é€postè¯·æ±‚ï¼ŒåŒæ—¶éœ€è¦æ·»åŠ HTTPé™„å±ä½“å†…å®¹ï¼Œè¿”å›å¾—åˆ°ç½‘ç»œå›å¤ç±»(QNetworkReply)å¯¹è±¡å½“ç½‘ç»œå›å¤å¯¹è±¡æ”¶åˆ°è¿”å›çš„æ¶ˆæ¯æ—¶ä¼šè§¦å‘ç›¸åº”çš„ä¿¡å·ï¼Œå¯ä»¥é€šè¿‡è¿æ¥æ§½å‡½æ•°ï¼Œåœ¨æ§½å‡½æ•°ä¸­è·å–è¿”å›çš„æ•°æ®","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"æ ¡æ‹›ä¸€è§ˆ","slug":"source/é¢è¯•/æ ¡å›­æ‹›è˜","date":"2024-06-08T16:00:00.000Z","updated":"2025-03-03T12:45:53.375Z","comments":true,"path":"2024/06/09/source/é¢è¯•/æ ¡å›­æ‹›è˜/","permalink":"http://example.com/2024/06/09/source/%E9%9D%A2%E8%AF%95/%E6%A0%A1%E5%9B%AD%E6%8B%9B%E8%81%98/","excerpt":"","text":"#è…¾è®¯ è…¾è®¯ï¼šTencent è…¾è®¯ åªèƒ½æŠ•ä¸€ä¸ªå²—ä½ å²—ä½æŠ•é€’ | è…¾è®¯æ ¡æ‹› (qq.com) å·¥ä½œåœ°ï¼šæˆéƒ½ å®ä¹ ç”Ÿå²—ä½æŠ•é€’ | è…¾è®¯æ ¡æ‹› (qq.com) è½¯ä»¶å¼€å‘-åå°å¼€å‘æ–¹å‘ ç™»å½•æ–¹å¼ï¼šå¾®ä¿¡ ç®€å†é¡µï¼šæˆ‘çš„ç®€å† | è…¾è®¯æ ¡æ‹› (qq.com) åº”è˜è¿›åº¦ï¼šåº”è˜è¿›åº¦ | è…¾è®¯æ ¡æ‹› (qq.com) #å°ç±³ å°ç±³ï¼šæ ¡å›­æ‹›è˜ (xiaomi.com) å®ä¹ ç”Ÿæ‹›è˜ï¼šå°ç±³å®ä¹ ç”Ÿæ‹›è˜ (mioffice.cn) åœ¨æˆéƒ½æ²¡æœ‰ç›¸å…³æ‹›è˜ #é˜¿é‡Œ é˜¿é‡Œç³»åˆ—ï¼šé˜¿é‡Œå·´å·´é›†å›¢æ‹›è˜å®˜ç½‘ (alibaba.com) â€‹ æ€»å…¬å¸é˜¿é‡Œå·´å·´ï¼šé˜¿é‡Œå·´å·´æ§è‚¡é›†å›¢æ‹›è˜å®˜ç½‘ (alibaba.com) ITæœåŠ¡å·¥ç¨‹å¸ˆï¼šITæœåŠ¡å·¥ç¨‹å¸ˆ (alibaba.com) â€‹ é˜¿é‡Œäº‘ï¼šé˜¿é‡Œäº‘æ ¡å›­æ‹›è˜ (aliyun.com) é¡¹ç›®åˆ¶å®ä¹ ç”Ÿä¸ç”¨çœ‹ å¯ä»¥æŠ•ä¸¤ä¸ªå²—ä½ ç ”å‘å·¥ç¨‹å¸ˆC&#x2F;C++ æ¯•ä¸šæ—¶é—´ä¸æ»¡è¶³æ— æ³•æŠ•é€’ â€‹ æ·˜å®ï¼šæ·˜å¤©é›†å›¢æ‹›è˜å®˜ç½‘ (taotian.com) å®ä¹ ç”Ÿï¼šæ·˜å¤©é›†å›¢æ ¡å›­æ‹›è˜ (taotian.com) æ²¡æˆéƒ½ â€‹ é¥¿äº†ä¹ˆï¼šé¥¿äº†ä¹ˆæ‹›è˜å®˜ç½‘ (ele.me) æ²¡æˆéƒ½ â€‹ é«˜å¾·ï¼šé«˜å¾·åœ°å›¾æ‹›è˜å®˜ç½‘ (amap.com) æ²¡æˆéƒ½ â€‹ é˜¿é‡Œå›½é™…ï¼šé˜¿é‡Œå›½é™…æ•°å­—å•†ä¸šé›†å›¢æ‹›è˜å®˜ç½‘ (alibaba.com) æ²¡æˆéƒ½ â€‹ èœé¸Ÿï¼šã€èœé¸Ÿæ‹›è˜å®˜ç½‘ã€‘èœé¸Ÿæ‹›è˜_èœé¸Ÿæ ¡æ‹›_cainiao recruitment æ²¡æˆéƒ½ â€‹ é˜¿é‡Œæ–‡å¨±ï¼šå¤§æ–‡å¨±é›†å›¢æ‹›è˜å®˜ç½‘ (alibaba-dme.com) æ²¡æˆéƒ½ è¿˜æœ‰å…¶ä»–ç±»åˆ«éƒ½æ²¡æˆéƒ½ä¼°è®¡ï¼Œçœ‹æ€»ç½‘ã€‚ è¾¾æ‘©é™¢ é“¶æ³°å•†ä¸š â€‹ ç½‘æ˜“ç½‘æ˜“æ ¡å›­æ‹›è˜ (163.com) å®ä¹ ç”Ÿï¼šèŒä½ | ç½‘æ˜“ç¤¾ä¼šæ‹›è˜ (163.com) HR éŸ³ä¹äººè¿è¥ ITè¿ç»´ ç™¾åº¦ç™¾åº¦æ‹›è˜ (baidu.com) å®ä¹ ç”Ÿ-æˆéƒ½ï¼šç™¾åº¦æ ¡å›­æ‹›è˜ (baidu.com) å¯åç»­å…³æ³¨ æ™ºèƒ½å®¢æœç ”å‘ç»„_JAVAå·¥ç¨‹å®ä¹ ç”Ÿ(J71934) ç®€å†ï¼šç™¾åº¦æ ¡å›­æ‹›è˜ (baidu.com) å­—èŠ‚å­—èŠ‚è·³åŠ¨ (bytedance.com) æˆéƒ½-å®ä¹ -ç ”å‘https://jobs.bytedance.com/campus/position?keywords=&amp;category=&amp;location=CT_22&amp;project=&amp;type=3&amp;job_hot_flag=&amp;current=1&amp;limit=10&amp;functionCategory=&amp;tag= åç«¯å¼€å‘å®ä¹ ç”Ÿ-æŠ–éŸ³ ç™»å½•ï¼š191 åº”è˜è®°å½•ï¼šhttps://jobs.bytedance.com/campus/position/application æ»´æ»´æ»´æ»´æ‹›è˜ (didiglobal.com) æˆéƒ½-å®ä¹ ç”Ÿæ»´æ»´ -å®ä¹ ç”Ÿæ‹›è˜ (mokahr.com) åç»­å…³æ³¨ äº¬ä¸œäº¬ä¸œæ‹›è˜-é¦–é¡µ (jd.com) äº¬ä¸œæ ¡æ‹› (jd.com) äº¬ä¸œappæ‰«ç  æŠ•é€’è¿›åº¦ï¼šäº¬ä¸œæ ¡æ‹› (jd.com) ç¾å›¢æ ¡å›­æ‹›è˜ | ç¾å›¢æ‹›è˜ (meituan.com) å®ä¹ -æˆéƒ½èŒä½åˆ—è¡¨ | ç¾å›¢æ‹›è˜ (meituan.com) å¾®ä¿¡æ‰«ç +191 è¿›åº¦ï¼šä¸ªäººä¸­å¿ƒ | ç¾å›¢æ‹›è˜ (meituan.com) oppoOPPOæ‹›è˜ - åŠ å…¥æˆ‘ä»¬ join us æˆéƒ½-OPPOæ‹›è˜ - åŠ å…¥æˆ‘ä»¬ join us çŸ¥ä¹çŸ¥ä¹æ ¡å›­æ‹›è˜ - æ™ºè€…å››æµ·ï¼ˆåŒ—äº¬ï¼‰æŠ€æœ¯æœ‰é™å…¬å¸ (mokahr.com)","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"}]},{"title":"oatpp-nginx","slug":"source/Linux/oatpp+nginx","date":"2024-03-26T16:00:00.000Z","updated":"2025-03-03T12:45:53.386Z","comments":true,"path":"2024/03/27/source/Linux/oatpp+nginx/","permalink":"http://example.com/2024/03/27/source/Linux/oatpp+nginx/","excerpt":"","text":"å®‰è£…oatppæˆ‘å…ˆåœ¨oatppçš„githubçš„å®˜æ–¹ç½‘ç«™ä¸Šæ‰¾åˆ°windowsçš„ä¸‹è½½æ–¹å¼ å®˜æ–¹ç½‘ç«™ï¼šhttps://github.com/oatpp/oatpp ä¸‹è½½æ–¹å¼ï¼šhttps://oatpp.io/docs/installation/windows/ è€Œåæˆ‘å°è¯•è¿›è¡Œä¸‹è½½ï¼Œç¬¬ä¸€æ¬¡æˆ‘å¿½ç•¥äº†ä¸‹æ–¹çš„cmakeå‚æ•°ï¼Œä¸‹é¢æˆ‘æ•´ç†äº†å®Œæ•´æŒ‡ä»¤ï¼Œåœ¨æƒ³è¦å®‰è£…oatppçš„åœ°æ–¹cmdè¾“å…¥æŒ‡ä»¤ 123456git clone https://github.com/oatpp/oatpp.gitcd oatppMD buildcd buildcmake -DCMAKE_BUILD_TYPE=Debug -DBUILD_SHARED_LIBS=OFF ..#æ›´å¤šå‚æ•°å¯é€‰é¡¹æ ¹æ®éœ€æ±‚ï¼Œæˆ‘è§‰å¾—è¿™ä¸¤ä¸ªæ˜¯å¿…é¡»çš„cmake --build . --target INSTALL æ­¤å¤„å»ºè®®ç›´æ¥è·³è½¬åˆ°é“¾æ¥æ–¹æ³• æ—¢ç„¶åº“å®‰å¥½äº†ï¼Œæˆ‘å¼€å§‹æƒ³é€šè¿‡VSæ–°å»ºCMakeé¡¹ç›®é“¾æ¥åº“è¿›è¡Œï¼Œä½†æ˜¯æˆ‘ä¸€ç›´å°è¯•éƒ½æ²¡æœ‰æˆåŠŸï¼Œæ–‡æ¡£æ”¾åœ¨è¿™ä¸ªæœ€å(ç›´æ¥å¿½ç•¥) ç›®å½•ç»“æ„ä¸ºå¤–å±‚lib-oatpp test[ä»£ç å­˜æ”¾] CMakelists.txt lib-oatppä¸­è¿˜æœ‰cmakelists testä¸­æœ‰src-include-cmakelists è€Œåæˆ‘åˆæƒ³ç›´æ¥æŠŠoatppçš„æºç æ”¾è¿›é¡¹ç›®ä¸­ä½†æ˜¯ä¸€ç›´æç¤ºæ— æ³•æ‰“å¼€æ–‡ä»¶&#x2F;æˆ–æ‰¾ä¸åˆ°æ–‡ä»¶ å†å°½åƒè¾›ä¸‡è‹¦æˆ‘ç»ˆäºçŸ¥é“å¦‚ä½•é“¾æ¥äº† ##é“¾æ¥æ–¹æ³• æ‰¾åˆ°ä¹‹å‰ä¸‹è½½çš„oatpp&#x2F;srcçš„ä½ç½®â€D:\\oatpp\\srcâ€å¡«å…¥ å³é”®é¡¹ç›®-å±æ€§-c&#x2F;c++-é™„åŠ åŒ…å«ç›®å½• æ‰¾åˆ°D:\\oatpp\\build\\src\\Debug å¡«å…¥ä¸‹å›¾ï¼Œé‡Œé¢æœ‰å››ä¸ªåº“æ–‡ä»¶ å¡«å…¥å››ä¸ªåº“ oatpp-test.lib oatpp.lib wsock32.lib ws2_32.lib ç„¶åå®Œäº‹ ##CMakelistst(å¿½ç•¥) ä»¥åä¹Ÿè®¸æˆ‘ä¼šå†æ¬¡å°è¯• é¡¶å±‚cmakeæ–‡ä»¶ï¼Œæ‰§è¡Œå…¨å±€é…ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950cmake_minimum_required (VERSION 3.8)project (&quot;cmake-oatpp-nginx&quot;)set (CMAKE_CXX_STANDARD 17)set (CMAKE_CXX_STANDARD_REQUIRED ON) #ä¸¥æ ¼éµå¾ªc++æ ‡å‡†# æ·»åŠ å®å®šä¹‰if (ZO_BT STREQUAL &quot;r&quot;) add_definitions(-DOATPP_DISABLE_ENV_OBJECT_COUNTERS) message (STATUS &quot;Build type release&quot;)endif()if (UNIX) add_definitions(-D_CRT_SECURE_NO_WARNINGS -D_SILENCE_ALL_CXX17_DEPRECATION_WARNINGS) add_definitions(-DCPP_JWT_USE_VENDORED_NLOHMANN_JSON) add_definitions(-DLINUX) add_definitions(-DCHECK_TOKEN) add_definitions(-DSTOP_PWD=&quot;01star&quot;) add_definitions(-DOATPP_SWAGGER_SERVICE_NAME=&quot;$&#123;PROJECT_NAME&#125; for linux&quot;) add_definitions(-DOATPP_SWAGGER_RES_PATH=&quot;res&quot;) add_definitions(-DBSONCXX_STATIC -DMONGOCXX_STATIC -DENABLE_AUTOMATIC_INIT_AND_CLEANUP=OFF)else() add_definitions(-DOATPP_SWAGGER_SERVICE_NAME=&quot;$&#123;PROJECT_NAME&#125; for windows&quot;) add_definitions(-DOATPP_SWAGGER_RES_PATH=&quot;res&quot;)endif()# åœ¨camke .. çš„æ—¶å€™ä¼šè¾“å‡ºæç¤ºç›®å½•è·¯å¾„message (STATUS &quot;Prefix dir is $&#123;CMAKE_INSTALL_PREFIX&#125;&quot;) #å®‰è£…message (STATUS &quot;Binary dir is $&#123;PROJECT_BINARY_DIR&#125;&quot;) #äºŒè¿›åˆ¶message (STATUS &quot;Source dir is $&#123;PROJECT_SOURCE_DIR&#125;&quot;) #æºä»£ç message (STATUS &quot;Build type is $&#123;CMAKE_BUILD_TYPE&#125;&quot;) #æ„å»ºç±»å‹message (STATUS &quot;Platform for x64 = $&#123;CMAKE_CL_64&#125;&quot;) #å¹³å°# å®šä¹‰ä¸€ä¸ªé¢„ç¼–è¯‘æ ‡å¤´å®MACRO(ADD_MSVC_PRECOMPILED_HEADER PrecompiledHeader PrecompiledSource SourcesVar) IF(MSVC) GET_FILENAME_COMPONENT(PrecompiledBasename $&#123;PrecompiledHeader&#125; NAME_WE) SET(PrecompiledBinary &quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/$&#123;PrecompiledBasename&#125;.pch&quot;) SET(Sources $&#123;$&#123;SourcesVar&#125;&#125;) SET_SOURCE_FILES_PROPERTIES($&#123;PrecompiledSource&#125; PROPERTIES COMPILE_FLAGS &quot;/Yc\\&quot;$&#123;PrecompiledHeader&#125;\\&quot; /Fp\\&quot;$&#123;PrecompiledBinary&#125;\\&quot;&quot; OBJECT_OUTPUTS &quot;$&#123;PrecompiledBinary&#125;&quot;) SET_SOURCE_FILES_PROPERTIES($&#123;Sources&#125; PROPERTIES COMPILE_FLAGS &quot;/Yu\\&quot;$&#123;PrecompiledHeader&#125;\\&quot; /FI\\&quot;$&#123;PrecompiledHeader&#125;\\&quot; /Fp\\&quot;$&#123;PrecompiledBinary&#125;\\&quot;&quot; OBJECT_DEPENDS &quot;$&#123;PrecompiledBinary&#125;&quot;) LIST(APPEND $&#123;SourcesVar&#125; $&#123;PrecompiledSource&#125;) ENDIF(MSVC)ENDMACRO(ADD_MSVC_PRECOMPILED_HEADER)add_subdirectory (&quot;lib-oatpp&quot;)add_subdirectory (&quot;test&quot;) testç›®å½•ä¸‹cmakelists 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465cmake_minimum_required (VERSION 3.8)set (appName test)include_directories (&quot;./&quot;)include_directories (&quot;../lib-oatpp/include&quot;)# é“¾æ¥åº“è·¯å¾„ï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™ä¹Ÿåœ¨è¿™é‡Œæ‰¾link_directories ($&#123;PROJECT_BINARY_DIR&#125;/lib-oatpp)#é“¾æ¥åº“çš„æœç´¢è·¯å¾„if(UNIX) link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib64)# å¦‚æœæ˜¯Windowsç¯å¢ƒelseif(WIN32) if (CMAKE_CL_64) link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib64/openssl) if(ZO_BT STREQUAL &quot;r&quot;) link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib64) else() link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib64/debug) endif() else() link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib/openssl) if(ZO_BT STREQUAL &quot;r&quot;) link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib) else() link_directories ($&#123;PROJECT_SOURCE_DIR&#125;/lib-oatpp/lib/debug) endif() endif()endif()# è·å–è¦ç¼–è¯‘çš„æºä»£ç file (GLOB_RECURSE SC_FILES ./*.cpp) #é€šé…ç¬¦-å½“å‰ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹æ‰€æœ‰çš„.cppæ–‡ä»¶list (REMOVE_ITEM SC_FILES &quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/./stdafx.cpp&quot;) #ä»åˆ—è¡¨SC_FILESä¸­ç§»é™¤æŒ‡å®šæ–‡ä»¶-é¢„ç¼–è¯‘å¤´æ–‡ä»¶# è®¾ç½®é¢„ç¼–è¯‘æ ‡å¤´if(WIN32) ADD_MSVC_PRECOMPILED_HEADER(&quot;stdafx.h&quot; &quot;stdafx.cpp&quot; SC_FILES)endif()# ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶add_executable ($&#123;appName&#125; $&#123;SC_FILES&#125;)# é“¾æ¥åº“target_link_libraries ($&#123;appName&#125; &quot;lib-oatpp&quot;)# Windowå¹³å°å¤åˆ¶dllæ–‡ä»¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•if(WIN32) file (GLOB_RECURSE dycopy $&#123;ZO_DY_DIR&#125;/*.dll) file (COPY $&#123;dycopy&#125; DESTINATION &quot;$&#123;PROJECT_BINARY_DIR&#125;/$&#123;appName&#125;&quot;)endif()# Windowå¹³å°å¤åˆ¶é¡¹ç›®é…ç½®åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•if(WIN32) file (GLOB conf &quot;conf/*&quot;) file (COPY $&#123;conf&#125; DESTINATION $&#123;PROJECT_BINARY_DIR&#125;/$&#123;appName&#125;/conf)endif()# å®‰è£…æ–‡ä»¶# publicç›®å½•if(IS_ARCH_DEMO) install (DIRECTORY &quot;public&quot; DESTINATION $&#123;appName&#125;)endif()# å¯æ‰§è¡Œæ–‡ä»¶install (TARGETS $&#123;appName&#125; RUNTIME DESTINATION $&#123;appName&#125;)# Windowå¹³å°å¤åˆ¶é¡¹ç›®é…ç½®åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•if(WIN32) install (DIRECTORY &quot;conf&quot; DESTINATION $&#123;appName&#125;)endif() 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// main.cpp#include &quot;oatpp/web/server/HttpConnectionHandler.hpp&quot;#include &quot;oatpp/web/server/HttpRouter.hpp&quot;#include &quot;oatpp/web/server/HttpRequestHandler.hpp&quot;#include &quot;oatpp/web/protocol/http/outgoing/ResponseFactory.hpp&quot;#include &quot;oatpp/network/tcp/server/ConnectionProvider.hpp&quot;#include &quot;oatpp/core/macro/component.hpp&quot;class MyController : public oatpp::web::server::HttpRequestHandler &#123;public: /** * Handle incoming HTTP request */ std::shared_ptr&lt;OutgoingResponse&gt; handle(const std::shared_ptr&lt;IncomingRequest&gt;&amp; /*request*/) override &#123; // Return &quot;Hello, World!&quot; response return oatpp::web::protocol::http::outgoing::ResponseFactory::createResponse(Status::CODE_200, &quot;Hello, World!&quot;); &#125;&#125;;/** * Example ConnectionProvider component that listens on port 8080 */OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::network::ServerConnectionProvider&gt;, serverConnectionProvider)([] &#123; return oatpp::network::tcp::server::ConnectionProvider::createShared(&#123; &quot;0.0.0.0&quot;, 8080, oatpp::network::Address::IP_4 &#125;);&#125;());/** * Example Router component */OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::web::server::HttpRouter&gt;, httpRouter)([] &#123; auto router = oatpp::web::server::HttpRouter::createShared(); router-&gt;route(&quot;GET&quot;, &quot;/api/hello&quot;, std::make_shared&lt;MyController&gt;()); return router;&#125;());/** * Example ConnectionHandler component that combines ConnectionProvider and Router */OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::network::ConnectionHandler&gt;, serverConnectionHandler)([] &#123; OATPP_COMPONENT(std::shared_ptr&lt;oatpp::network::ServerConnectionProvider&gt;, connectionProvider); // get ConnectionProvider component OATPP_COMPONENT(std::shared_ptr&lt;oatpp::web::server::HttpRouter&gt;, router); // get Router component auto connectionHandler = oatpp::web::server::HttpConnectionHandler::createShared(router); connectionHandler-&gt;setConnectionProvider(connectionProvider); return connectionHandler;&#125;());int main() &#123; OATPP_COMPONENT(std::shared_ptr&lt;oatpp::network::ServerConnectionProvider&gt;, connectionProvider); OATPP_COMPONENT(std::shared_ptr&lt;oatpp::network::ConnectionHandler&gt;, connectionHandler); oatpp::network::Server server(connectionProvider, connectionHandler); // Print info about server port OATPP_LOGI(&quot;MyApp&quot;, &quot;Server running on port %s&quot;, connectionProvider-&gt;getProperty(&quot;port&quot;).toString()-&gt;c_str()); // Run server server.run(); return 0;&#125; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º MyController çš„ç±»ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚ï¼Œå¹¶è¿”å› â€œHello, World!â€ æ¶ˆæ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª HTTP è·¯ç”±ï¼Œå°† /api/hello è·¯å¾„æ˜ å°„åˆ° MyController ç±»ã€‚æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬åœ¨ 8080 ç«¯å£ä¸Šï¼Œå¹¶å°†è·¯ç”±å’Œè¿æ¥æä¾›å™¨ä¸ä¹‹å…³è”ã€‚ ç¼–è¯‘å¹¶è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬åœ¨ 8080 ç«¯å£ä¸Šã€‚æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦é…ç½® Nginxï¼Œå°† /api/hello è¯·æ±‚ä»£ç†åˆ°è¿™ä¸ªç«¯å£ä¸Šã€‚åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æ·»åŠ ç±»ä¼¼ä»¥ä¸‹çš„é…ç½®ï¼š 12345678nginxCopy codeserver &#123; listen 80; server_name your_server_domain.com; location /api/hello &#123; proxy_pass http://127.0.0.1:8080; &#125;&#125; ä¿å­˜å¹¶é‡æ–°åŠ è½½ Nginx é…ç½®ï¼Œç„¶åè®¿é—® http://your_server_domain.com/api/helloï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ° â€œHello, World!â€ çš„å“åº”ã€‚ Step by Step1234567891011121314151617181920212223242526272829303132333435#include &quot;oatpp/web/server/HttpConnectionHandler.hpp&quot;#include &quot;oatpp/network/Server.hpp&quot;#include &quot;oatpp/network/tcp/server/ConnectionProvider.hpp&quot;void run() &#123; /* Create Router for HTTP requests routing */ auto router = oatpp::web::server::HttpRouter::createShared();//Httpè¯·æ±‚çš„è·¯ç”±ï¼Œurlæ˜ å°„åˆ°ç«¯ç‚¹å¤„ç†ç¨‹åºï¼Œç°åœ¨æ²¡æœ‰å£°æ˜ç«¯ç‚¹ï¼Œè¿”å›404 /* Create HTTP connection handler with router *///httpè¿æ¥å¤„ç†ï¼Œæ¯ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ auto connectionHandler = oatpp::web::server::HttpConnectionHandler::createShared(router); /* Create TCP connection provider *///tcpè¿æ¥ï¼Œç»‘å®šä¸€ä¸ªç«¯å£ auto connectionProvider = oatpp::network::tcp::server::ConnectionProvider::createShared(&#123; &quot;localhost&quot;, 8000, oatpp::network::Address::IP_4 &#125;); /* Create server which takes provided TCP connections and passes them to HTTP connection handler */ oatpp::network::Server server(connectionProvider, connectionHandler);//serverè¿è¡Œä¸€ä¸ªå¾ªç¯ï¼Œè·å–tcpè¿æ¥ï¼Œä¼ åˆ°è¿æ¥å¤„ç† /* Print info about server port */ OATPP_LOGI(&quot;MyApp&quot;, &quot;Server running on port %s&quot;, connectionProvider-&gt;getProperty(&quot;port&quot;).getData()); /* Run server */ server.run();&#125;int main() &#123; /* Init oatpp Environment */ oatpp::base::Environment::init(); /* Run App */ run(); /* Destroy oatpp Environment */ oatpp::base::Environment::destroy(); return 0;&#125; ###æ·»åŠ è¯·æ±‚å¤„ç†ç¨‹åº å½“url &#x2F;helloè¯·æ±‚åšå‡ºå¤„ç† è®¿é—®http:&#x2F;localhost:8000&#x2F;hello è¿”å›hello worldæ¶ˆæ¯ 12345678910class Handler : public oatpp::web::server::HttpRequestHandler &#123;public: std::shared_ptr&lt;OutgoingResponse&gt; handle(const std::shared_ptr&lt;IncomingRequest&gt;&amp; request) override &#123; return ResponseFactory::createResponse(Status::CODE_200, &quot;Hello World!&quot;); &#125;&#125;;void run()&#123; router-&gt;route(&quot;GET&quot;, &quot;/hello&quot;, std::make_shared&lt;Handler&gt;());&#125; ä½¿ç”¨JSONå¯¹è±¡è¿›è¡Œå“åº”ä¸ºäº†åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–å¯¹è±¡ï¼Œoatpp ä½¿ç”¨ç‰¹æ®Šçš„[æ•°æ®ä¼ è¾“å¯¹è±¡(DTO)å’ŒObjectMappers 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#include &quot;oatpp/parser/json/mapping/ObjectMapper.hpp&quot;#include &quot;oatpp/core/macro/codegen.hpp&quot;/* Begin DTO code-generation */#include OATPP_CODEGEN_BEGIN(DTO)/** * Message Data-Transfer-Object */class MessageDto : public oatpp::DTO &#123; DTO_INIT(MessageDto, DTO /* Extends */) DTO_FIELD(Int32, statusCode); // Status code field DTO_FIELD(String, message); // Message field&#125;;/* End DTO code-generation */#include OATPP_CODEGEN_END(DTO)class Handler : public oatpp::web::server::HttpRequestHandler &#123;private: std::shared_ptr&lt;oatpp::data::mapping::ObjectMapper&gt; m_objectMapper;public: /** * Constructor with object mapper. * @param objectMapper - object mapper used to serialize objects. */ Handler(const std::shared_ptr&lt;oatpp::data::mapping::ObjectMapper&gt;&amp; objectMapper) : m_objectMapper(objectMapper) &#123;&#125; /** * Handle incoming request and return outgoing response. */ std::shared_ptr&lt;OutgoingResponse&gt; handle(const std::shared_ptr&lt;IncomingRequest&gt;&amp; request) override &#123; auto message = MessageDto::createShared(); message-&gt;statusCode = 1024; message-&gt;message = &quot;Hello DTO!&quot;; return ResponseFactory::createResponse(Status::CODE_200, message, m_objectMapper); &#125;&#125;;void run() &#123; /* Create json object mapper */ auto objectMapper = oatpp::parser::json::mapping::ObjectMapper::createShared(); /* Create Router for HTTP requests routing */ auto router = oatpp::web::server::HttpRouter::createShared(); /* Route GET - &quot;/hello&quot; requests to Handler */ router-&gt;route(&quot;GET&quot;, &quot;/hello&quot;, std::make_shared&lt;Handler&gt;(objectMapper /* json object mapper */ )); &#125; oatppçš„ç»“æ„DTO æ•°æ®ä¼ è¾“å¯¹è±¡ å®šä¹‰äº†æ•°æ®çš„æ ¼å¼ controller ä½¿ç”¨api controller ç«¯ç‚¹å¤„ç†ç¨‹åº(å¤„ç†è·¯ç”±è¯·æ±‚) ä½¿ç”¨dtoä¸­çš„ç±»å°è£…æ¶ˆæ¯ AppComponent.hpp å®šä¹‰å¿…é¡»çš„ç»„ä»¶(HTTPè¿æ¥ï¼Œè¯·æ±‚è·¯ç”±ï¼ŒTCPè¿æ¥ï¼ŒObjectMapper) App.cpp main è·¯ç”±å™¨(è¯·æ±‚) è·å–ä¸Šè¿°ç»„ä»¶ä¸­çš„è·¯ç”±-è·å–controllerä¸­çš„å¤„ç†ç¨‹åº-å»ºç«‹è·¯ç”±åˆ°å¤„ç†ç¨‹åºçš„æ˜ å°„ â€‹ è·å–HTTPè¿æ¥-è·å–TCPè¿æ¥-å»ºç«‹æœåŠ¡-ä»TCPè¿æ¥æä¾›è€…å‘é€æ¶ˆæ¯åˆ°httpè¿æ¥å¤„ç† ä»£ç DTOs.hpp 123456789101112131415161718192021222324252627282930313233#ifndef DTOs_hpp#define DTOs_hpp#include &quot;oatpp/core/data/mapping/type/Object.hpp&quot;#include &quot;oatpp/core/macro/codegen.hpp&quot;#include &quot;oatpp/parser/json/mapping/ObjectMapper.hpp&quot;#include &quot;oatpp/web/server/HttpConnectionHandler.hpp&quot;#include &quot;oatpp/network/Server.hpp&quot;#include &quot;oatpp/network/tcp/server/ConnectionProvider.hpp&quot;/* Begin DTO code-generation */#include OATPP_CODEGEN_BEGIN(DTO)/** * Message Data-Transfer-Object */class MessageDto : public oatpp::DTO &#123; DTO_INIT(MessageDto, DTO /* Extends */) DTO_FIELD(Int32, statusCode); // Status code field DTO_FIELD(String, message); // Message field&#125;;/* TODO - Add more DTOs here *//* End DTO code-generation */#include OATPP_CODEGEN_END(DTO)#endif /* DTOs_hpp */ MyController.hpp 123456789101112131415161718192021222324252627282930313233343536373839#ifndef MyController_hpp#define MyController_hpp#include &quot;dto/DTOs.hpp&quot;#include &quot;oatpp/web/server/api/ApiController.hpp&quot;#include &quot;oatpp/core/macro/codegen.hpp&quot;#include &quot;oatpp/core/macro/component.hpp&quot;#include OATPP_CODEGEN_BEGIN(ApiController) ///&lt; Begin Codegen/** * Sample Api Controller. */class MyController : public oatpp::web::server::api::ApiController &#123;public: /** * Constructor with object mapper. * @param objectMapper - default object mapper used to serialize/deserialize DTOs. */ MyController(OATPP_COMPONENT(std::shared_ptr&lt;ObjectMapper&gt;, objectMapper)) : oatpp::web::server::api::ApiController(objectMapper) &#123;&#125;public: ENDPOINT(&quot;GET&quot;, &quot;/hello&quot;, root) &#123; auto dto = MessageDto::createShared(); dto-&gt;statusCode = 200; dto-&gt;message = &quot;Hello World!&quot;; return createDtoResponse(Status::CODE_200, dto); &#125; // TODO Insert Your endpoints here !!!&#125;;#include OATPP_CODEGEN_END(ApiController) ///&lt; End Codegen#endif /* MyController_hpp */ AppComponent.hpp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#ifndef AppComponent_hpp#define AppComponent_hpp#include &quot;oatpp/parser/json/mapping/ObjectMapper.hpp&quot;#include &quot;oatpp/web/server/HttpConnectionHandler.hpp&quot;#include &quot;oatpp/network/tcp/server/ConnectionProvider.hpp&quot;#include &quot;oatpp/core/macro/component.hpp&quot;/** * Class which creates and holds Application components and registers components in oatpp::base::Environment * Order of components initialization is from top to bottom */class AppComponent &#123;public: /** * Create ConnectionProvider component which listens on the port */ OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::network::ServerConnectionProvider&gt;, serverConnectionProvider)([] &#123; return oatpp::network::tcp::server::ConnectionProvider::createShared(&#123; &quot;localhost&quot;, 8000, oatpp::network::Address::IP_4 &#125;); &#125;()); /** * Create Router component */ OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::web::server::HttpRouter&gt;, httpRouter)([] &#123; return oatpp::web::server::HttpRouter::createShared(); &#125;()); /** * Create ConnectionHandler component which uses Router component to route requests */ OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::network::ConnectionHandler&gt;, serverConnectionHandler)([] &#123; OATPP_COMPONENT(std::shared_ptr&lt;oatpp::web::server::HttpRouter&gt;, router); // get Router component return oatpp::web::server::HttpConnectionHandler::createShared(router); &#125;()); /** * Create ObjectMapper component to serialize/deserialize DTOs in Contoller&#x27;s API */ OATPP_CREATE_COMPONENT(std::shared_ptr&lt;oatpp::data::mapping::ObjectMapper&gt;, apiObjectMapper)([] &#123; return oatpp::parser::json::mapping::ObjectMapper::createShared(); &#125;());&#125;;#endif /* AppComponent_hpp */ App.cpp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &quot;controller/MyController.hpp&quot;#include &quot;AppComponent.hpp&quot;#include &quot;oatpp/network/Server.hpp&quot;void run() &#123; /* Register Components in scope of run() method */ AppComponent components; /* Get router component */ OATPP_COMPONENT(std::shared_ptr&lt;oatpp::web::server::HttpRouter&gt;, router); /* Create MyController and add all of its endpoints to router */ auto myController = std::make_shared&lt;MyController&gt;(); router-&gt;addController(myController); /* Get connection handler component */ OATPP_COMPONENT(std::shared_ptr&lt;oatpp::network::ConnectionHandler&gt;, connectionHandler); /* Get connection provider component */ OATPP_COMPONENT(std::shared_ptr&lt;oatpp::network::ServerConnectionProvider&gt;, connectionProvider); /* Create server which takes provided TCP connections and passes them to HTTP connection handler */ oatpp::network::Server server(connectionProvider, connectionHandler); /* Priny info about server port */ OATPP_LOGI(&quot;MyApp&quot;, &quot;Server running on port %s&quot;, connectionProvider-&gt;getProperty(&quot;port&quot;).getData()); /* Run server */ server.run();&#125;int main(int argc, const char* argv[]) &#123; /* Init oatpp Environment */ oatpp::base::Environment::init(); /* Run App */ run(); /* Destroy oatpp Environment */ oatpp::base::Environment::destroy(); return 0;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#ifndef MyController_hpp#define MyController_hpp#include &quot;dto/DTOs.hpp&quot;#include &quot;oatpp/web/server/api/ApiController.hpp&quot;#include &quot;oatpp/core/macro/codegen.hpp&quot;#include &quot;oatpp/core/macro/component.hpp&quot;#include OATPP_CODEGEN_BEGIN(ApiController) ///&lt; Begin Codegen/** * Sample Api Controller. */class MyController : public oatpp::web::server::api::ApiController &#123;public: /** * Constructor with object mapper. * @param objectMapper - default object mapper used to serialize/deserialize DTOs. */ MyController(OATPP_COMPONENT(std::shared_ptr&lt;oatpp::data::mapping::ObjectMapper&gt;, objectMapper)) : oatpp::web::server::api::ApiController(objectMapper) &#123;&#125;public: ENDPOINT(&quot;GET&quot;, &quot;/hello&quot;, roothello) &#123; auto dto = MessageDto::createShared(); dto-&gt;statusCode = 200; dto-&gt;message = &quot;Hello World!&quot;; return createDtoResponse(Status::CODE_200, dto); &#125; // TODO Insert Your endpoints here !!! ENDPOINT(&quot;GET&quot;, &quot;/&quot;, root) &#123; auto response = createResponse(Status::CODE_200, &quot;&lt;html&gt;&lt;body&gt;&lt;form action=\\&quot;/submit\\&quot; method=\\&quot;post\\&quot;&gt;&lt;input type=\\&quot;text\\&quot; name=\\&quot;input\\&quot; placeholder=\\&quot;Enter something\\&quot;&gt;&lt;button type=\\&quot;submit\\&quot;&gt;Submit&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&quot;); response-&gt;putHeader(oatpp::web::protocol::http::Header::CONTENT_TYPE, &quot;text/html&quot;); return response; &#125; ENDPOINT(&quot;POST&quot;, &quot;/submit&quot;, submit, BODY_STRING(String, body)) &#123; OATPP_LOGI(&quot;MyController&quot;, &quot;Received input: %s&quot;, body-&gt;c_str()); auto response = createResponse(Status::CODE_200, &quot;Received input: &quot; + *body); response-&gt;putHeader(oatpp::web::protocol::http::Header::CONTENT_TYPE, &quot;text/plain&quot;); return response; &#125;&#125;;#include OATPP_CODEGEN_END(ApiController) ///&lt; End Codegen#endif /* MyController_hpp */","categories":[{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"}],"tags":[{"name":"HTTP è¯·æ±‚å¤„ç†ã€è·¯ç”±ã€JSON åºåˆ—åŒ–","slug":"HTTP-è¯·æ±‚å¤„ç†ã€è·¯ç”±ã€JSON-åºåˆ—åŒ–","permalink":"http://example.com/tags/HTTP-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E3%80%81%E8%B7%AF%E7%94%B1%E3%80%81JSON-%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"Webå¼€å‘æ¡†æ¶","slug":"Webå¼€å‘æ¡†æ¶","permalink":"http://example.com/tags/Web%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/"}]},{"title":"git","slug":"source/å·¥å…·-ç¯å¢ƒ/git","date":"2024-03-24T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2024/03/25/source/å·¥å…·-ç¯å¢ƒ/git/","permalink":"http://example.com/2024/03/25/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/git/","excerpt":"","text":"é›†ä¸­ç‰ˆæœ¬æ§åˆ¶ SVN æ‰€æœ‰çš„ç‰ˆæœ¬æ•°æ®éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œç›¸å½“äºåœ¨çº¿ä¿®æ”¹ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ Git ä¸‹è½½windows https://git-scm.com/ æ— è„‘ä¸‹ä¸€æ­¥yum install git SSHç”ŸæˆSSH keyssh-keygen -t ed25519 -C â€œGitee SSH Keyâ€ #ä¸‰æ¬¡å›è½¦ï¼Œæ³¨é‡Šå¯æ”¹æˆ–è€…ä¸è¦æ³¨é‡ŠæŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥ls ~&#x2F;.ssh&#x2F; # id_ed25519 id_ed25519.pubè¯»å–å…¬é’¥æ–‡ä»¶cat ~&#x2F;.ssh&#x2F;id_ed25519.pubå¤åˆ¶å…¬é’¥åˆ°æ‰€éœ€è´¦æˆ·ä¸­ Gitä½¿ç”¨æ–°å»ºä»“åº“å¹¶å…³è”è¿œç¨‹ä»“åº“git init #åœ¨éœ€è¦ç®¡ç†çš„é¡¹ç›®çš„æ ¹ç›®å½•git add .git commit -m â€˜xxxxâ€™git remote add origin xxx(ä»“åº“ç½‘å€) # å…³è”è¿œç«¯ä»“åº“git push -u origin main # ç¬¬ä¸€æ¬¡æ¨é€å…³è”åˆ†æ”¯ æˆ–è€…git push -f origin master # å¼ºåˆ¶è¦†ç›–è¿œç«¯å‚è‚¡ çˆ¶ä»“åº“ç‰ˆæœ¬æ›´é«˜åˆ‡æ¢åˆ°å­ä»“åº“git fetch origin xxx # æ‹‰å–æœ€æ–°çš„çˆ¶ä»“åº“git merge origin&#x2F;xxxx # çˆ¶ä»“åº“å‘å­ä»“åº“åˆå¹¶git status # æŸ¥çœ‹æ˜¯å¦æœ‰å†²çªï¼Œæœ‰å†²çªåœ¨é¡¹ç›®ä¸­è§£å†³(å¸¦æœ‰&gt;&gt;&gt;)git add .git commit æˆ–è€… git config pull.rebase false ç›´æ¥æ°¸ä¹…è®¾ç½®åˆå¹¶ç­–ç•¥ æ–°å»ºæ ‡ç­¾123456789git tag -a v1.0 -m &quot;Release version 1.1&quot;# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾git tag# åˆ é™¤æ ‡ç­¾git tag -d v1.0git push origin v1.0 æ–°å»ºåˆ†æ”¯123git checkout -b æ–°åˆ†æ”¯å æˆ– git switch -c æ–°åˆ†æ”¯ågit push -u origin æ–°åˆ†æ”¯ågit branch -a åˆå¹¶åˆ†æ”¯12345git branch -vv # æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åŠæœ€æ–°æäº¤ä¿¡æ¯git checkout qs # åˆ‡æ¢åˆ°qsåˆ†æ”¯git pull origin qs # æ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç git merge main # å°†mainåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯(qs)ã€‚# å¤„ç†å†²çª å…¶ä»–æŒ‡ä»¤git pull â€“prune # ä»è¿œç¨‹æ‹‰å–å¹¶ä¸”åˆ é™¤æœ¬åœ°å¤šä½™çš„æ–‡ä»¶ git pull â€“prune git status git branch git checkout xxxx #åˆ‡æ¢åˆ†æ”¯ git commit -F â€¦&#x2F;log.txt git config â€“global http.sslVerify false # å½“æ‹‰å–ä»“åº“é‡åˆ°sslé—®é¢˜git branch -r æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ git branch -a æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ git branch -d xjz åˆ é™¤åˆ†æ”¯xjz æ”¾å¼ƒæ›´æ”¹123git reset --hard &lt;id&gt;git checkout -- .git push -f origin &lt;åˆ†æ”¯å&gt; åˆ é™¤å†å²-å‹ç¼©ä½“ç§¯123456789101112131415161718192021222324# 1. æŸ¥çœ‹è¿œç¨‹åœ°å€ git@gitee.com:tutuLP/titus_utils.gitgit remote -v# 2. å¤åˆ¶ remote URLï¼Œä¾‹å¦‚ï¼š# 3. åˆ é™¤æ—§çš„ .git ä»“åº“rm -rf .git# 4. åˆå§‹åŒ–æ–°çš„ Git ä»“åº“git init# 5. æ·»åŠ æ‰€æœ‰å½“å‰æ–‡ä»¶git add .# 6. åˆ›å»ºä¸€æ¬¡å¹²å‡€çš„æäº¤git commit -m &quot;Cleaned history, keep current state&quot;# 7. é‡æ–°æ·»åŠ è¿œç¨‹ origingit remote add origin git@gitee.com:tutuLP/titus_utils.git# 8. å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ï¼ˆè¦†ç›–åŸä»“åº“å†å²ï¼‰git push -f origin master # æˆ– mainï¼Œçœ‹ä½ åŸæ¥æ˜¯å“ªä¸ªåˆ†æ”¯git push --set-upstream origin master","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"git","slug":"git","permalink":"http://example.com/tags/git/"}]},{"title":"vscode","slug":"source/å·¥å…·-ç¯å¢ƒ/vscode","date":"2024-03-24T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2024/03/25/source/å·¥å…·-ç¯å¢ƒ/vscode/","permalink":"http://example.com/2024/03/25/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/vscode/","excerpt":"","text":"sshè¿œç¨‹è¿æ¥é”™è¯¯æŠ¥é”™ï¼š æ— æ³•å»ºç«‹è¿æ¥ï¼Œä¸‹è½½vscodeæœåŠ¡å™¨å¤±è´¥-è¯·åœ¨è¿œç¨‹å®‰è£…curl è§£å†³åŠæ³•ï¼š åˆ é™¤è¿œç¨‹æœåŠ¡å™¨å®¶ç›®å½•ä¸‹çš„.vscode-serveræ–‡ä»¶å¤¹ï¼Œlinuxçš„å®¶ç›®å½•è·¯å¾„æ˜¯ï¼š&#x2F;home&#x2F;yourusername ctrl+shift+p è¾“å…¥kill è¾“å…¥å¯†ç ååˆ é™¤æœåŠ¡å™¨ä¸­çš„æœåŠ¡æ–‡ä»¶ å†æ¬¡è¿æ¥ä¼šé‡æ–°ä¸‹è½½è§£å†³é—®é¢˜ é…ç½®cè¯­è¨€ç¯å¢ƒä¸‹è½½ä¸‹è½½MinGW https://sourceforge.net/projects/mingw-w64/ å®‰è£…åˆ°ä½ æ‰¾å¾—åˆ°è‹±æ–‡è·¯å¾„ä¸‹ æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹æ‰¾åˆ°binæ–‡ä»¶å¤¹çš„ä½ç½® â€œD:\\MinGW\\binâ€ é…ç½®ç¯å¢ƒå˜é‡ å³é”®æ­¤ç”µè„‘-å±æ€§-é«˜çº§ç³»ç»Ÿè®¾ç½®-ç¯å¢ƒå˜é‡-ä¸Šæ–¹Path-ç¼–è¾‘-æ–°å»º-æ”¾å…¥åœ°å€(ä¸è¦â€â€) ä¸‹è½½vscode VScodeæ’ä»¶C&#x2F;C++ Chinese(å¯é€‰)ä¸¤ä¸ªæ’ä»¶ å·¥ä½œåŒºé…ç½®####å»ºç«‹å·¥ä½œåŒº å…ˆåœ¨å–œæ¬¢çš„åœ°æ–¹å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾ä½ çš„ä»£ç å’Œå·¥ä½œåŒºçš„åœ°æ–¹ æ‰“å¼€æ–‡ä»¶å¤¹ï¼Œåœ¨ç©ºç™½å¤„å³é”®é€šè¿‡vscodeæ‰“å¼€ æ–‡ä»¶-å°†å·¥ä½œåŒºå¦å­˜ä¸º-é€‰æ‹©è¿™ä¸ªæ–‡ä»¶å¤¹ é…ç½®.vscodeæ–‡ä»¶å¯ä»¥ä¸ç”¨ä¸‹è½½è€ç‰ˆæœ¬çš„c&#x2F;c++æ’ä»¶ï¼Œåªéœ€è¦æ‰‹åŠ¨å»ºç«‹ä¸€ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¤¹å’Œä¸¤ä¸ªæ–‡ä»¶ æ‰‹åŠ¨è¾“å…¥æ–‡ä»¶åå’Œåç¼€ ä¸‹é¢æˆ‘é™„ä¸Šé…ç½®å†…å®¹ æˆ‘å·²ç»åŠ ä¸Šäº†æ³¨é‡Šï¼Œå¯ä»¥æ ¹æ®è‡ªå·±å–œå¥½é…ç½® 1234567891011121314151617181920212223242526272829303132333435//launch.json&#123; // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚ // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387 &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; &quot;name&quot;: &quot;gcc.exe - ç”Ÿæˆå’Œè°ƒè¯•æ´»åŠ¨æ–‡ä»¶&quot;, &quot;type&quot;: &quot;cppdbg&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;$&#123;fileDirname&#125;\\\\a.exe&quot;, &quot;args&quot;: [], &quot;stopAtEntry&quot;: false, &quot;cwd&quot;: &quot;D:\\\\MinGW\\\\bin&quot;, &quot;environment&quot;: [], &quot;externalConsole&quot;: true, //åœ¨å¤–éƒ¨æ§åˆ¶å°ä¸­æ‰“å¼€-è¾“å‡ºå†…å®¹å°†ä¸ä¼šå‡ºç°åœ¨ä¸‹æ–¹ &quot;MIMode&quot;: &quot;gdb&quot;, &quot;miDebuggerPath&quot;: &quot;D:\\\\MinGW\\\\bin\\\\gdb.exe&quot;, &quot;setupCommands&quot;: [ &#123; &quot;description&quot;: &quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°&quot;, &quot;text&quot;: &quot;-enable-pretty-printing&quot;, &quot;ignoreFailures&quot;: true &#125;, &#123; &quot;description&quot;: &quot;å°†åæ±‡ç¼–é£æ ¼è®¾ç½®ä¸º Intel&quot;, &quot;text&quot;: &quot;-gdb-set disassembly-flavor intel&quot;, &quot;ignoreFailures&quot;: true &#125; ], &quot;preLaunchTask&quot;: &quot;C/C++: gcc.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶&quot; &#125; ]&#125; 123456789101112131415161718192021222324252627282930//tasks.json&#123; &quot;tasks&quot;: [ &#123; &quot;type&quot;: &quot;cppbuild&quot;, &quot;label&quot;: &quot;C/C++: gcc.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶&quot;, &quot;command&quot;: &quot;D:\\\\MinGW\\\\bin\\\\gcc.exe&quot;, &quot;args&quot;: [ &quot;-fdiagnostics-color=always&quot;, &quot;-g&quot;, &quot;$&#123;file&#125;&quot;, &quot;-o&quot;, &quot;$&#123;fileDirname&#125;\\\\a.exe&quot;, &quot;-fexec-charset=GBK&quot; //è§£å†³ä¸­æ–‡ä¹±ç  ], &quot;options&quot;: &#123; &quot;cwd&quot;: &quot;D:\\\\MinGW\\\\bin&quot; &#125;, &quot;problemMatcher&quot;: [ &quot;$gcc&quot; ], &quot;group&quot;: &#123; &quot;kind&quot;: &quot;build&quot;, &quot;isDefault&quot;: true &#125;, &quot;detail&quot;: &quot;è°ƒè¯•å™¨ç”Ÿæˆçš„ä»»åŠ¡ã€‚&quot; &#125; ], &quot;version&quot;: &quot;2.0.0&quot;&#125; ####å»ºç«‹a.exe åœ¨æ¯ä¸€ä¸ªæœ‰ä»£ç çš„åŒçº§ç›®å½•ä¸‹éƒ½è¦æ–°å»ºä¸€ä¸ªa.exe æ¯æ¬¡è¿è¡Œä»£ç éƒ½ä¼šè¦†ç›–å†™å…¥å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé¿å…å‡ºç°ä¸€å †exeæ–‡ä»¶ï¼Œæˆ‘å·²ç»åœ¨ä¸Šæ–¹ä¸¤ä¸ªæ–‡ä»¶ä¸­æ”¹åŠ¨ä¼˜åŒ–äº† ä¾‹å¦‚ä¸Šæ–¹çš„ç›®å½•ç»“æ„ï¼Œå…¶ä¸­å¯ä»¥å†…æ¶µå¾ˆå¤šæ–‡ä»¶å¤¹ï¼Œåªéœ€è¦æ¯ä¸ªæ–‡ä»¶å¤¹éƒ½æœ‰ä¸€ä¸ªa.exe è¿è¡Œä»£ç åœ¨ä»£ç çš„å¤´æ–‡ä»¶ä¸­åŠ ä¸Š #include&lt;stdlib.h&gt; mainå‡½æ•°ä½“æœ«å°¾åŠ ä¸Š system(â€œpauseâ€); è¿è¡Œ-GDB-gcc ä¸ºäº†æ–¹ä¾¿æ‰“å¼€ï¼Œæˆ‘ä»¬æ‰¾åˆ°vscodeçš„å®‰è£…ç›®å½•ï¼Œå³é”®å›¾æ ‡-å‘é€åˆ°æ¡Œé¢ å³é”®æ¡Œé¢çš„è¿™ä¸ªvscodeå›¾æ ‡-å±æ€§-åœ¨ç›®æ ‡åé¢åŠ ä¸Šæ–‡ä»¶å¤¹çš„ä½ç½® å°±å¯ä»¥åŒå‡»æ‰“å¼€äº† æˆ–è€…ç›´æ¥åŒå‡»æˆ‘ä»¬ä¹‹å‰ä¿å­˜çš„å·¥ä½œåŒºä¹ŸåŒæ ·çš„æ•ˆæœ vscodeå ç”¨è¿‡å¤§pkill -f vscode rm -rf ~&#x2F;.vscode-server","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"http://example.com/tags/vscode/"}]},{"title":"Nginx","slug":"source/å·¥å…·-ç¯å¢ƒ/Nginx","date":"2024-03-24T16:00:00.000Z","updated":"2025-08-31T08:06:09.544Z","comments":true,"path":"2024/03/25/source/å·¥å…·-ç¯å¢ƒ/Nginx/","permalink":"http://example.com/2024/03/25/source/%E5%B7%A5%E5%85%B7-%E7%8E%AF%E5%A2%83/Nginx/","excerpt":"","text":"å®‰è£…Nginxé»˜è®¤ç½‘é¡µä½ç½®ï¼šå®‰è£…ä½ç½®&#x2F;usr&#x2F;share&#x2F;nginx ä¸­htmlæ–‡ä»¶å¤¹é‡Œçš„index.html mac12345brew install nginx# é…ç½®æ–‡ä»¶ï¼š/opt/homebrew/etc/nginx/nginx.conf# runsudo nginx windows1234567# ä¸‹è½½åœ°å€ https://nginx.org/en/download.html# åœ¨å®‰è£…ç›®å½•ä¸­æ‰§è¡Œ C:\\APP\\nginx-1.24.0\\nginx-1.24.0cd C:\\app\\nginx-1.24.0\\nginx-1.24.0.\\nginx.exe -s reload centos12345yum install nginxnginxnginx -s stop å¸¸ç”¨æŒ‡ä»¤123456789nginx # å¯åŠ¨Nginxnginx -c filename # æŒ‡å®šé…ç½®â½‚ä»¶nginx -V # æŸ¥çœ‹Nginxçš„ç‰ˆæœ¬å’Œç¼–è¯‘å‚æ•°ç­‰ä¿¡æ¯å®‰è£…ç›®å½•ï¼š--prefix=/usr/share/nginx é…ç½®æ–‡ä»¶ä½ç½®ï¼š--conf-path=/etc/nginx/nginx.confnginx -t # æ£€æŸ¥é…ç½®â½‚ä»¶æ˜¯å¦æ­£ç¡®ï¼Œå®šä½é…ç½®â½‚ä»¶çš„ä½ç½®nginx -s quit # ä¼˜é›…åœâ½ŒNginxnginx -s stop # å¿«é€Ÿåœâ½ŒNginxnginx -s reload # é‡æ–°åŠ è½½é…ç½®â½‚ä»¶nginx -s reopen # é‡æ–°æ‰“å¼€â½‡å¿—â½‚ä»¶ å»ºè®® worker_processes 1ps -ef |grep nginx å¯ä»¥çœ‹è¿›ç¨‹çš„æ•°é‡ è®¾ç½®æˆå’ŒæœåŠ¡å™¨å†…æ ¸æ•°é‡ç›¸åŒæ¯”è¾ƒåˆé€‚è®¾ç½®æˆautoè‡ªåŠ¨è®¾ç½® åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡åœ¨serverå—ä¸Šæ–¹æ·»åŠ åå‘ä»£ç†é…ç½® 12345upstream backend&#123; server 47.115.215.143:8000; server 47.115.215.143:8001; server 47.115.215.143:8002;&#125; åœ¨serverä¸­æ·»åŠ locationé…ç½® 123location&#123; proxy_pass http://backend; #ä¸ä¸Šæ–¹åå‘ä»£ç†ä¸€è‡´&#125; nginx -s reloadè®¿é—®47.115.215.143&#x2F;app é»˜è®¤è½®è¯¢è®¿é—®ï¼Œå¯ä»¥è®¾ç½®æƒé‡ä¹Ÿå°±æ˜¯è®¿é—®åˆ°çš„æ¦‚ç‡ï¼Œä¿®æ”¹é…ç½® 123456upstream backend&#123; ip_hash; #æ ¹æ®å®¢æˆ·ç«¯çš„ipåœ°å€è¿›è¡Œå“ˆå¸Œï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ server 47.115.215.143:8000 weight=3; server 47.115.215.143:8001; server 47.115.215.143:8002;&#125; é…ç½®demoæ–¹å‘ä»£ç†ä¸€ä¸ªå‰ç«¯ä¸€ä¸ªåç«¯+https+websocketä»£ç†å‰ç«¯åç«¯éƒ½ä»£ç†åˆ°1003ç«¯å£ä¸Šï¼Œç„¶åå†è®²è¯·æ±‚åå‘ä»£ç†åˆ°ä¸åŒçš„ç«¯å£ 12345678910111213141516171819mkdir -p ~/ssl &amp;&amp; cd ~/sslopenssl req -x509 -nodes -days 365 -newkey rsa:2048 \\ -keyout app.test.key \\ -out app.test.crt \\ -subj &quot;/C=CN/ST=Shanghai/L=Shanghai/O=Test/OU=Dev/CN=app.test&quot; # git bash æ‰‹åŠ¨è¾“å…¥openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\ -keyout app.test.key \\ -out app.test.crtcp /opt/homebrew/etc/nginx/nginx.conf /opt/homebrew/etc/nginx/nginx.conf.bakvim /opt/homebrew/etc/nginx/nginx.conf# runsudo nginx -s quitsudo nginxhttps://127.0.0.1:1003/home nginx.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970worker_processes 1;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; client_max_body_size 20m; # å®šä¹‰ WebSocket ä»£ç† upstream upstream pub &#123; server localhost:3001; &#125;sdsdsddwdwdsdsd # æ”¯æŒ WebSocket å‡çº§ map $http_upgrade $connection_upgrade &#123; default upgrade; &#x27;&#x27; close; &#125; server &#123; listen 1003 ssl; server_name app.test; ssl_certificate /Users/tutu/ssl/app.test.crt; ssl_certificate_key /Users/tutu/ssl/app.test.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; # ä»£ç†å‰ç«¯ location / &#123; proxy_pass http://localhost:8848/; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; # ä»£ç†åç«¯ API location /api/ &#123; proxy_pass http://localhost:8888/api/; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; # ä»£ç† WebSocket æœåŠ¡ location /pub/ &#123; proxy_pass http://pub/; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_read_timeout 3600s; &#125; &#125;&#125;","categories":[{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://example.com/tags/Nginx/"}]},{"title":"è“æ¡¥æ¯å¾€å±Šè€ƒè¯•é¢˜","slug":"source/C++/è“æ¡¥æ¯åˆ·é¢˜","date":"2024-03-01T16:00:00.000Z","updated":"2025-03-11T14:51:50.710Z","comments":true,"path":"2024/03/02/source/C++/è“æ¡¥æ¯åˆ·é¢˜/","permalink":"http://example.com/2024/03/02/source/C++/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98/","excerpt":"","text":"æ˜Ÿè¿ªçš„æ°”åœºè®¡ç®—å¾ªç¯è¯»å…¥å­—ç¬¦ä¸²ï¼Œå•å­—ç¬¦ä¸²æ’åˆ—ï¼Œéå†å­—ç¬¦ä¸²ï¼Œå­—ç¬¦è®¡ç®— for (string::const_iterator it &#x3D; name.begin(); it !&#x3D; name.end(); ++it) bool compareChars(const char&amp; a, const char&amp; b) {return a &lt; b;} sort(name.begin(), name.end(), compareChars);ä»å°åˆ°å¤§æ’åº &#x2F;&#x2F; å…ˆæä¾›è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°bool caseSensitiveCompare(const string&amp; a, const string&amp; b) {return a &lt; b;} sort(strings.begin(), strings.end(), caseSensitiveCompare); for (const auto&amp; str : strings) {cout &lt;&lt; str;} &#x2F;&#x2F;å¿½ç•¥å¤§å°å†™bool caseInsensitiveCompare(const std::string&amp; a, const string&amp; b) { string lowerA &#x3D; a, lowerB &#x3D; b; transform(lowerA.begin(), lowerA.end(), lowerA.begin(), ::tolower); transform(lowerB.begin(), lowerB.end(), lowerB.begin(), ::tolower); return lowerA &lt; lowerB;} 12345678910111213141516171819202122232425262728#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std;bool compareChars(const char&amp; a, const char&amp; b) &#123;return a &lt; b;&#125;int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n;cin &gt;&gt; n; vector&lt;string&gt; a; for (int i = 0; i &lt; n; i++) &#123; string name;cin &gt;&gt; name; a.push_back(name); //å­—ç¬¦ä¸²ä»å°åˆ°å¤§æ’åºã€‚éå† sort(name.begin(), name.end(), compareChars); int count = 1;int all = 0; for (string::const_iterator it = name.begin(); it != name.end(); ++it) &#123; all += (*it - 96) * count; count++; &#125; cout &lt;&lt; all &lt;&lt; endl; &#125; return 0;&#125; æ•°å­—è½¬æ¢æ•´æ•°è½¬å­—ç¬¦ä¸² string str&#x3D;to_string(n); å­—ç¬¦ä¸²é•¿åº¦ï¼šstr.length(); å­—ç¬¦ä¸²è½¬æ•´æ•°ï¼šint n&#x3D;stoi(str); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;bool isIncreasing(int n) &#123; string str_n = to_string(n); // å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸² // æ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦ä»£è¡¨çš„æ•°å€¼ for (size_t i = 0; i &lt; str_n.length() - 1; ++i) &#123; if (str_n[i] &gt;= str_n[i + 1]) &#123; return false; // å¦‚æœå½“å‰å­—ç¬¦ä¸å°äºä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™ä¸æ˜¯é€’å¢çš„ &#125; &#125; return true; // æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯é€’å¢çš„ &#125;bool exchange(int n) &#123; string str = to_string(n); int j = str.length(); if (j == 1) &#123; cout &lt;&lt;n&lt;&lt;endl; &#125;else if (j == 2) &#123; if (str[0] &lt; str[1]) &#123; cout &lt;&lt; n &lt;&lt; endl; return true; &#125; else &#123; int temp = str[0]; str[0] = str[1]; str[1] = temp; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; &#125;else &#123; //ä»å·¦åˆ°å³éå†ä¸¤éï¼Œæ¯æ¬¡æ¯”è¾ƒä¸‰ä¸ªï¼Œæœ€å°çš„åœ¨ç¬¬ä¸‰ä½äº¤æ¢ä¸¤æ¬¡ç»“æŸï¼Œæœ€å°çš„åœ¨ç¬¬äºŒä½äº¤æ¢ä¸€æ¬¡ï¼Œå†æ¬¡éå† //é‡åˆ°232ç»“æ„å…ˆä¸æ…Œï¼Œç»§ç»­æ‰¾321ç»“æ„ï¼Œæ²¡æœ‰å°±å›æ»š for (int i = 0; i &lt; j-2; i++) &#123; if (str[i + 2] &lt; str[i] &amp;&amp; str[i + 2] &lt; str[i + 1]) &#123; int temp1 = str[i]; str[i] = str[i + 2]; str[i + 2] = str[i + 1]; str[i + 1] = temp1; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; else if (str[i + 1] &lt; str[i] &amp;&amp; str[i + 1] &lt; str[i + 2]) &#123; int temp = str[i]; if (str[i] &lt;= str[i + 2]) &#123; str[i] = str[i + 1]; str[i + 1] = temp; &#125; else &#123; str[i] = str[i + 1]; str[i + 1] = str[i + 2]; str[i + 2] = temp; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125; &#125; &#125; int end = stoi(str); cout &lt;&lt; end &lt;&lt; endl; return true; &#125;&#125;int main()&#123; int number; cin &gt;&gt; number; if (isIncreasing(number)) &#123; //ä¸äº¤æ¢ cout &lt;&lt; number&lt;&lt; endl; &#125; else &#123; exchange(number); &#125; return 0;&#125; 01ä¸²çš„ç†µè®¡ç®—å¯¹æ•°ï¼š #include log2(a) æ¯”è¾ƒæµ®ç‚¹æ•°ï¼š fabs(res - 11625907.5798) &lt; 0.0001 åˆ¤æ–­æµ®ç‚¹æ•°ç›¸åŒç”¨å·®&lt;0.01 1234567891011121314151617181920#include &lt;iostream&gt;#include &lt;cmath&gt;using namespace std;int main()&#123; int n = 23333333; for (int i = 1; i &lt; n; ++i) &#123; double a = i * 1.0 / n; // 0å‡ºç°çš„å æ¯” double b = (n - i) * 1.0 / n; // 1å‡ºç°çš„å æ¯” double res = 0; res -= a * log2(a) * i + b * log2(b) * (n - i); if (fabs(res - 11625907.5798) &lt; 0.0001) &#123; cout &lt;&lt; i &lt;&lt; endl; break; &#125; &#125; return 0;&#125; å†¶ç‚¼é‡‘å±äºŒç»´æ•°ç»„ï¼š vector&lt;vector&gt; num(n, vector(2)); 1234567891011121314151617181920212223242526272829303132333435363738394041#include &lt;iostream&gt;#include &lt;vector&gt;//#include &lt;algorithm&gt;using namespace std;int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n; cin &gt;&gt; n; vector&lt;vector&lt;int&gt;&gt; num(n, vector&lt;int&gt;(2)); int a[2] = &#123;0&#125;; for (int i = 0; i &lt; n; i++) &#123; int j; cin &gt;&gt; j; int k; cin &gt;&gt; k; num[i][0] = j; num[i][1] = k; int temp = j / k; if (temp &lt; a[1]) &#123; a[1] = temp; &#125; if (i == 0) &#123; a[1] = temp; &#125; &#125; int k = a[1]; int flag = 0; while (k != 0) &#123; k--; for (int i = 0; i &lt; n; i++) &#123; if (num[i][0] / k != num[i][0] / a[1]) &#123; a[0] = k + 1; flag = 1; break; &#125; &#125; if (flag == 1) &#123; break; &#125; &#125; cout &lt;&lt; a[0] &lt;&lt; &quot; &quot; &lt;&lt; a[1] &lt;&lt; endl; return 0;&#125; é£æœºé™è½ä¸€ç§å¾ˆå¥½çš„å¾ªç¯ç»“æ„ int T;cin &gt;&gt; T; while (T--)&#123;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;// åˆ›å»ºé£æœºç»“æ„ä½“å˜é‡struct plane&#123; int t, d, l;&#125;;bool vis[15]; // trueè¡¨ç¤ºé£æœºé™è½ï¼Œfalseè¡¨ç¤ºé£æœºæœªé™è½bool flag; // æ ‡è®°æ˜¯å¦å…¨éƒ¨å®‰å…¨é™è½vector&lt;plane&gt; p(15);// æ·±æœvoid dfs(int m, int cnt, int last) // lastè¡¨ç¤ºæ­¤å‰æ‰€æœ‰é£æœºé™è½æ‰€éœ€çš„å•ä½æ—¶é—´&#123; if (cnt == m) &#123; flag = true; return; &#125; for (int i = 0; i &lt; m; i++) &#123; if (!vis[i] &amp;&amp; p[i].t + p[i].d &gt;= last) // åªæœ‰æ¥çš„æ—¶åˆ»+ç›˜æ—‹æ—¶é—´ &gt; last çš„é£æœºæ‰å¯ä»¥å®‰å…¨é™è½ &#123; vis[i] = true; dfs(m, cnt + 1, max(last, p[i].t) + p[i].l); vis[i] = false; &#125; &#125;&#125;int main()&#123; int T; cin &gt;&gt; T; while (T--) &#123; int N; cin &gt;&gt; N; for (int i = 0; i &lt; N; ++i) cin &gt;&gt; p[i].t &gt;&gt; p[i].d &gt;&gt; p[i].l; flag = false; dfs(N, 0, 0); if (flag) cout &lt;&lt; &quot;YES&quot; &lt;&lt; endl; else cout &lt;&lt; &quot;NO&quot; &lt;&lt; endl; &#125; return 0;&#125; æ¥é¾™é—®é¢˜è¯»å­—ç¬¦ä¸²ï¼šé‡ç©ºæ ¼å°±ä¼šåœ å­—ç¬¦ä¸²è½¬æ•°å­—ï¼šint x &#x3D; s[0] - â€˜0â€™, y &#x3D; s[s.size() - 1] - â€˜0â€™; åŠ¨æ€è§„åˆ’DPï¼šé‡å å­é—®é¢˜ï¼Œæœ€ä¼˜å­ç»“æ„é—®é¢˜(é€’å½’) ç›®çš„ï¼šæ‰¾æœ€é•¿çš„æ¥é¾™æ•°åˆ— å…³ç³»ï¼šä»åå¾€å‰çœ‹ï¼Œç¬¬iä¸ªæ•°çš„æœ€é•¿å­åºåˆ—æ•°ä¸ºä»¥ç¬¬iä¸ªæ•°çš„é¦–ä½ä¸ºå°¾æ•°çš„é‚£ä¸ªæ•°çš„æœ€é•¿åºåˆ—+1 ç”¨ä¸€ä¸ªæ•°ç»„æ¥dp[i]è¡¨ç¤ºä»¥iä¸ºå°¾æ•°å­—çš„æœ€é•¿åºåˆ— xè¡¨ç¤ºé¦–ä½ï¼Œyè¡¨ç¤ºå°¾æ•° dp[y]&#x3D;max(dp[x]+1,dp[y]); nè®°å½•æœ€å¤§çš„å­åºåˆ—n&#x3D;max(dp[y],n); 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;int dp[10];int main()&#123; // è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ä»£ç  int n; cin &gt;&gt; n; string s; int m = 0; for (int i = 0; i &lt; n; ++i) &#123; cin &gt;&gt; s; int x = s[0] - &#x27;0&#x27;, y = s[s.size() - 1] - &#x27;0&#x27;; dp[y] = max(dp[x] + 1, dp[y]); m = max(m, dp[y]); &#125; cout &lt;&lt; n - m &lt;&lt; endl; return 0;&#125; å²›å±¿ä¸ªæ•°vector&lt;vector&gt; data(m + 2, vector(n + 2, â€˜0â€™)); äºŒç»´å…¨éƒ¨èµ‹0 æ·±åº¦ä¼˜å…ˆDFS 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;int deltaOfSea[8][2] = &#123;&#123;-1, -1&#125;,&#123;-1, 0&#125;,&#123;-1, 1&#125;,&#123;0, 1&#125;,&#123;1, 1&#125;,&#123;1, 0&#125;,&#123;1, -1&#125;,&#123;0, -1&#125;&#125;;//ä¸€æ ¼çš„å…«ä¸ªæ–¹å‘int deltaOfIsland[4][2] = &#123;&#123;-1, 0&#125;,&#123;1, 0&#125;,&#123;0, -1&#125;,&#123;0, 1&#125;&#125;;//å››ä¸ªæ–¹å‘int ans = 0;void DFS_Island(vector&lt;vector&lt;char&gt;&gt;&amp; data, int r, int c, int m, int n)&#123; data[r][c] = &#x27;N&#x27;; for(int i = 0; i &lt; 4; ++i)&#123;//å²›åªçœ‹å››ä¸ªæ–¹å‘ int newR = r + deltaOfIsland[i][0]; int newC = c + deltaOfIsland[i][1]; if(newR &gt;= 0 &amp;&amp; newR &lt; m &amp;&amp; newC &gt;= 0 &amp;&amp; newC &lt; n)&#123; if(data[newR][newC] == &#x27;1&#x27;) DFS_Island(data, newR, newC, m, n); &#125; &#125;&#125;void DFS_Sea(vector&lt;vector&lt;char&gt;&gt;&amp; data, int r, int c, int m, int n)&#123; data[r][c] = &#x27;N&#x27;; //r cè®°å½•å½“å‰è®¿é—®çš„ä½ç½® Nè®°ä½œå·²ç»è®¿é—® for(int i = 0; i &lt; 8; ++i)&#123;//éå†å½“å‰ä½ç½®çš„8ä¸ªæ–¹å‘ int newR = r + deltaOfSea[i][0]; int newC = c + deltaOfSea[i][1]; if(newR &gt;= 0 &amp;&amp; newR &lt; m &amp;&amp; newC &gt;= 0 &amp;&amp; newC &lt; n)&#123;//å½“å‰ç›¸é‚»å•å…ƒæ ¼æœ‰æ•ˆ if(data[newR][newC] == &#x27;1&#x27;)&#123; DFS_Island(data, newR, newC, m, n);//æ‰¾å²›å±¿ ++ans; &#125; else if(data[newR][newC] == &#x27;0&#x27;)&#123; DFS_Sea(data, newR, newC, m, n); &#125; &#125; &#125;&#125;int main()&#123; int t; cin &gt;&gt; t; vector&lt; vector&lt;vector&lt;char&gt;&gt; &gt; datas;//ç”¨ä¸‰ç»´å­˜å‚¨æ¯ä¸€ä¸ªäºŒç»´ for(int i = 0; i &lt; t; ++i)&#123; int m, n; cin &gt;&gt; m &gt;&gt; n; vector&lt;vector&lt;char&gt;&gt; data(m + 2, vector&lt;char&gt;(n + 2, &#x27;0&#x27;)); //æ‰©å±•ä¸€åœˆ0ï¼Œé˜²æ­¢éå†ä¸å®Œï¼Œå¯ä»¥ for(int r = 1; r &lt; m + 1; ++r)&#123; for(int c = 1; c &lt; n + 1; ++c)&#123; cin &gt;&gt; data[r][c]; &#125; &#125; datas.push_back(data); &#125; for(int i = 0; i &lt; t; ++i)&#123; vector&lt;vector&lt;char&gt;&gt; data = datas[i]; int m = data.size(); int n = data[0].size(); DFS_Sea(data, 0, 0, m, n); cout &lt;&lt; ans &lt;&lt; endl; ans = 0; &#125; return 0;&#125; å­—ä¸²ç®€å†™æ­£å¸¸æš´åŠ›åªèƒ½è§£å†³70% æ€è·¯ï¼šæ­£å‘ç»Ÿè®¡aæ•°ç›®ï¼Œé‡åˆ°båˆ™å°†ä¹‹å‰ç»Ÿè®¡çš„é•¿åº¦åŠ åˆ°ansä¸Š 123456789101112131415#include &lt;bits/stdc++.h&gt; using namespace std;int K;long long ans=0,c1_sum=0;string S;char c1,c2;int main()&#123; cin&gt;&gt;K&gt;&gt;S&gt;&gt;c1&gt;&gt;c2; for(int i=K-1,j=0;i&lt;S.length();i++,j++)&#123; if(S[j]==c1) c1_sum++; if(S[i]==c2) ans+=c1_sum; &#125; cout&lt;&lt;ans; return 0;&#125; æ•´æ•°åˆ é™¤#include æ‰¾æœ€å€¼ï¼Œæ’åº 12345678910111213141516171819202122232425262728293031323334353637//30%#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std;int main() &#123; int n,k; cin &gt;&gt; n&gt;&gt;k; vector&lt;int&gt; a; for (int i = 0; i &lt; n; i++) &#123; int temp; cin &gt;&gt; temp; a.push_back(temp); &#125; for (int i = 0; i &lt; k; i++) &#123; auto minelement = min_element(a.begin(), a.end()); int min = *minelement; for (vector&lt;int&gt;::iterator it = a.begin(); it != a.end(); ++it) &#123; if (*it == min) &#123; vector&lt;int&gt;::iterator prev = it; vector&lt;int&gt;::iterator next = it; if (it != a.begin()) &#123; --prev; *prev += min; &#125; ++next; if (next != a.end()) &#123; *next += min; &#125; a.erase(it); break; &#125; &#125; &#125; for (int i:a) &#123; cout &lt;&lt; i &lt;&lt; &#x27; &#x27;; &#125; return 0;&#125; 1234567891011121314151617181920212223242526272829#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;int main() &#123; int n, k; std::cin &gt;&gt; n &gt;&gt; k; std::vector&lt;int&gt; a(n); for (int i = 0; i &lt; n; ++i) &#123; std::cin &gt;&gt; a[i]; &#125; for (int i = 0; i &lt; k; ++i) &#123; auto minIt = std::min_element(a.begin(), a.end());// int minIndex = std::distance(a.begin(), minIt);//è¿™ä¸¤å¤„æ¯æ¬¡éœ€è¦éå†æ‰¾å¾ˆæµªè´¹ int min = *minIt; if (minIndex &gt; 0) &#123; a[minIndex - 1] += min; &#125; if (minIndex &lt; n - 1) &#123; a[minIndex + 1] += min; &#125; a.erase(a.begin() + minIndex);//è´¹æ—¶é—´ &#125; for (int i : a) &#123; std::cout &lt;&lt; i &lt;&lt; &#x27; &#x27;; &#125; return 0;&#125; ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ç»´æŠ¤å…ƒç´ å’Œç´¢å¼•ï¼Œlogæ—¶é—´å†…æ‰¾æœ€å°å€¼ æ›´æ–°åçš„å…ƒç´ å’Œç´¢å¼•æ”¾å…¥å †ä¸­ï¼Œæœ€å°å€¼è¢«æ ‡è®°ä¸ºINT_MAX å£°æ˜ä¼˜å…ˆé˜Ÿåˆ— priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;,greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç±»å‹ä¸ºpairï¼Œé€‰æ‹©vectorå®¹å™¨ï¼Œæ¯”è¾ƒå™¨greaterï¼Œå‡½æ•°å¯¹è±¡ï¼ŒæŒ‰&gt;è¿ç®—ç¬¦ï¼Œé¡¶éƒ¨(æœ€å°)æœ‰æœ€å¤§çš„æƒé‡ï¼Œæ²¡æœ‰æ¯”è¾ƒå™¨é»˜è®¤é¡¶éƒ¨æœ€å°æƒé‡ æ’å…¥æ•°æ® pq.push(&#123; a[i], i &#125;); å–æ•°æ® auto [min, minIndex] = pq.top(); ç§»é™¤é¡¶éƒ¨å…ƒç´  pq.pop(); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;queue&gt;#include &lt;functional&gt;#include &lt;climits&gt;using namespace std;int main() &#123; int n, k; cin &gt;&gt; n &gt;&gt; k; vector&lt;int&gt; a(n); priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; vector&lt;int&gt; c(n); vector&lt;int&gt; d(n); vector&lt;int&gt; nums(n, 0); for (int i = 0; i &lt; n; ++i) &#123; cin &gt;&gt; a[i]; pq.push(&#123; a[i], i &#125;); c[i] = i - 1; d[i] = i + 1; &#125; //åˆ›å»ºä¸¤ä¸ªæ•°ç»„å®æ—¶æ›´æ–°æ¯ä¸ªæ•°å·¦å³æœ€è¿‘çš„ä¸‹æ ‡ï¼Œæ›´æ–°å †çš„æ—¶å€™å°±èƒ½å¿«é€Ÿå®šä½åˆ°äº† //ä¸€ä¸ªæ•°ç»„ç”¨æ¥è®°å½•å½“å‰æ•°æ®ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå‡ºæ ˆä¸€æ¬¡åˆ™ä¿®æ”¹æ¬¡æ•°-1 while (k-- &gt; 0 &amp;&amp; !pq.empty()) &#123; auto [min, minIndex] = pq.top(); cout &lt;&lt; min &lt;&lt; &#x27; &#x27; &lt;&lt; minIndex &lt;&lt; endl; pq.pop(); if (nums[minIndex]==0) &#123; //åˆ é™¤ int temp1 = c[minIndex]; int temp2 = d[minIndex]; if (temp1 != -1) &#123; a[temp1] += min; d[temp1] = temp2; pq.push(&#123; a[temp1], temp1 &#125;);//æ›´æ–° nums[temp1]++;//ä¿®æ”¹æ¬¡æ•°+1 &#125; if (temp2 != n) &#123; a[temp2] += min; c[temp2] = temp1; pq.push(&#123; a[temp2], temp2 &#125;); nums[temp2]++; &#125; // æ ‡è®°æœ€å°å…ƒç´ ä¸ºå·²å¤„ç† a[minIndex] = INT_MAX; &#125; else if (nums[minIndex] != 0) &#123; //ä¿®æ”¹æ¬¡æ•°-1 k++; nums[minIndex]--; &#125; &#125; // è¾“å‡ºæœªè¢«æ ‡è®°ä¸ºå·²å¤„ç†çš„å…ƒç´  for (int i = 0; i &lt; n; ++i) &#123; if (a[i] != INT_MAX) &#123; cout &lt;&lt; a[i] &lt;&lt; &#x27; &#x27;; &#125; &#125; return 0;&#125; æ™¯åŒºå¯¼æ¸¸LCAï¼šæœ€è¿‘å…¬å…±ç¥–å…ˆ æš´åŠ›ï¼šä¸€å±‚ä¸€å±‚è·³ï¼Œlcaï¼šå€å¢ DFSï¼šæ·±åº¦ä¼˜å…ˆæœç´¢root-&gt;a BFS:å¹¿åº¦ä¼˜å…ˆ a-bçš„è·ç¦»&#x3D;root-&gt;a+root-&gt;b-2*root-&gt;lca 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;typedef long long ll;const int N = 1e5 + 100;//10^5+100int n, k;int deep[N]; // æ·±åº¦int dp[N][21]; // dp[i][j]è¡¨ç¤ºä»iç»“ç‚¹å¼€å§‹è·³2^jæ­¥å¯åˆ°è¾¾çš„ç»“ç‚¹vector&lt;int&gt; edge[N]; // è¾¹vector&lt;int&gt; weight[N]; // æƒå€¼ll path[N]; // åŸå§‹çš„æ¸¸è§ˆè·¯çº¿ll dist[N]; // dist[i]å­˜å‚¨iåˆ°æ ¹ç»“ç‚¹çš„è·ç¦»void dfs(int u, int father) // LCAçš„å‰ç½®ç®—æ³•(æ¨¡æ¿) å±‚æ•° çˆ¶äº²èŠ‚ç‚¹&#123; deep[u] = deep[father] + 1; dp[u][0] = father; for (int i = 1; i &lt;= 20; i++) &#123; dp[u][i] = dp[dp[u][i - 1]][i - 1]; &#125; for (size_t i = 0; i &lt; edge[u].size(); i++) &#123; int v = edge[u][i], w = weight[u][i]; if (v == father) continue; dist[v] = dist[u] + w; dfs(v, u); //ä¸‹ä¸€å±‚é€’å½’ &#125;&#125;int LCA(int x, int y) // æ±‚xå’Œyçš„æœ€è¿‘å…¬å…±ç¥–å…ˆ(æ¨¡æ¿)&#123; if (deep[x] &lt; deep[y]) swap(x, y); for (int i = 20; i &gt;= 0; i--) &#123; if (deep[dp[x][i]] &gt;= deep[y]) &#123; x = dp[x][i]; &#125; &#125; if (x == y) return x; for (int i = 20; i &gt;= 0; i--) &#123; if (dp[x][i] != dp[y][i]) &#123; x = dp[x][i]; y = dp[y][i]; &#125; &#125; return dp[x][0];&#125;ll get_dist(int x, int y) // æ±‚xå’Œyçš„è·ç¦»&#123; if (x == 0 || y == 0) return 0; return dist[x] + dist[y] - 2 * dist[LCA(x, y)];&#125;int main()&#123; cin &gt;&gt; n &gt;&gt; k; for (int i = 1; i &lt; n; i++) // æ’å…¥n-1æ¡æ— å‘è¾¹ &#123; int u, v, w; cin &gt;&gt; u &gt;&gt; v &gt;&gt; w; edge[u].push_back(v); edge[v].push_back(u); weight[u].push_back(w); weight[v].push_back(w); &#125; dfs(1, 0); // è·‘ä¸€édfsä¸ºLCAåšå‡†å¤‡ ll sum = 0; // sumå­˜å‚¨åŸå§‹æ¸¸è§ˆè·¯çº¿çš„æ€»è·¯å¾„é•¿åº¦ for (int i = 1; i &lt;= k; i++) &#123; cin &gt;&gt; path[i]; if (i &gt; 1) // ä»ç¬¬äºŒä¸ªæ™¯ç‚¹å¼€å§‹è®¡ç®— &#123; sum += get_dist(path[i], path[i - 1]); // ä¾æ¬¡ç´¯åŠ  &#125; &#125; for (int i = 1; i &lt;= k; i++) // é™¤å»ç¬¬iä¸ªæ™¯ç‚¹ &#123; ll dist1 = get_dist(path[i], path[i - 1]); ll dist2 = get_dist(path[i], path[i + 1]); ll dist3 = get_dist(path[i - 1], path[i + 1]); cout &lt;&lt; sum - dist1 - dist2 + dist3 &lt;&lt; &quot; &quot;; // å¥—å…¬å¼è®¡ç®—å³å¯ &#125; cout &lt;&lt; endl; return 0;&#125; åŸºç¡€ç®—æ³•ï¼šæšä¸¾ è´ªå¿ƒ æ¨¡æ‹ŸäºŒåˆ† æ’åºï¼šæ¡¶æ’åº å½’å¹¶æ’åº å¿«é€Ÿæ’åº æœç´¢ï¼šDFS BFS å‰ªæ åŠ¨æ€è§„åˆ’ï¼šä¸€ç»´dp èƒŒåŒ…dp æ ‘å½¢dp çŠ¶å‹dp æ•°ä½dp","categories":[{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"}],"tags":[]}],"categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"},{"name":"utils","slug":"utils","permalink":"http://example.com/categories/utils/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"},{"name":"rust","slug":"rust","permalink":"http://example.com/categories/rust/"},{"name":"æ‚è¯´","slug":"æ‚è¯´","permalink":"http://example.com/categories/%E6%9D%82%E8%AF%B4/"},{"name":"python","slug":"python","permalink":"http://example.com/categories/python/"},{"name":"PM","slug":"PM","permalink":"http://example.com/categories/PM/"},{"name":"c++","slug":"c","permalink":"http://example.com/categories/c/"},{"name":"åˆ·é¢˜","slug":"åˆ·é¢˜","permalink":"http://example.com/categories/%E5%88%B7%E9%A2%98/"},{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"},{"name":"å››å¤§ä»¶","slug":"å››å¤§ä»¶","permalink":"http://example.com/categories/%E5%9B%9B%E5%A4%A7%E4%BB%B6/"},{"name":"åº“","slug":"åº“","permalink":"http://example.com/categories/%E5%BA%93/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/categories/%E9%9D%A2%E8%AF%95/"},{"name":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","slug":"Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹","permalink":"http://example.com/categories/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/"},{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"}],"tags":[{"name":"go-zero","slug":"go-zero","permalink":"http://example.com/tags/go-zero/"},{"name":"è¿œç¨‹","slug":"è¿œç¨‹","permalink":"http://example.com/tags/%E8%BF%9C%E7%A8%8B/"},{"name":"DAW","slug":"DAW","permalink":"http://example.com/tags/DAW/"},{"name":"mysql","slug":"mysql","permalink":"http://example.com/tags/mysql/"},{"name":"container","slug":"container","permalink":"http://example.com/tags/container/"},{"name":"milkdown","slug":"milkdown","permalink":"http://example.com/tags/milkdown/"},{"name":"Podman","slug":"Podman","permalink":"http://example.com/tags/Podman/"},{"name":"uni-app","slug":"uni-app","permalink":"http://example.com/tags/uni-app/"},{"name":"hexo","slug":"hexo","permalink":"http://example.com/tags/hexo/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95/"},{"name":"QT","slug":"QT","permalink":"http://example.com/tags/QT/"},{"name":"æ–‡å¿ƒä¸€è¨€","slug":"æ–‡å¿ƒä¸€è¨€","permalink":"http://example.com/tags/%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80/"},{"name":"shell","slug":"shell","permalink":"http://example.com/tags/shell/"},{"name":"è“æ¡¥æ¯","slug":"è“æ¡¥æ¯","permalink":"http://example.com/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"},{"name":"HTML","slug":"HTML","permalink":"http://example.com/tags/HTML/"},{"name":"CSS","slug":"CSS","permalink":"http://example.com/tags/CSS/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","permalink":"http://example.com/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"},{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"http://example.com/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"},{"name":"HTTP è¯·æ±‚å¤„ç†ã€è·¯ç”±ã€JSON åºåˆ—åŒ–","slug":"HTTP-è¯·æ±‚å¤„ç†ã€è·¯ç”±ã€JSON-åºåˆ—åŒ–","permalink":"http://example.com/tags/HTTP-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E3%80%81%E8%B7%AF%E7%94%B1%E3%80%81JSON-%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"Webå¼€å‘æ¡†æ¶","slug":"Webå¼€å‘æ¡†æ¶","permalink":"http://example.com/tags/Web%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/"},{"name":"git","slug":"git","permalink":"http://example.com/tags/git/"},{"name":"vscode","slug":"vscode","permalink":"http://example.com/tags/vscode/"},{"name":"Nginx","slug":"Nginx","permalink":"http://example.com/tags/Nginx/"}]}